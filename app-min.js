(()=>{var FG=Object.create;var Ru=Object.defineProperty,BG=Object.defineProperties,NG=Object.getOwnPropertyDescriptor,UG=Object.getOwnPropertyDescriptors,zG=Object.getOwnPropertyNames,ST=Object.getOwnPropertySymbols,GG=Object.getPrototypeOf,CT=Object.prototype.hasOwnProperty,HG=Object.prototype.propertyIsEnumerable;var J_=(t,e,i)=>e in t?Ru(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Mt=(t,e)=>{for(var i in e||(e={}))CT.call(e,i)&&J_(t,i,e[i]);if(ST)for(var i of ST(e))HG.call(e,i)&&J_(t,i,e[i]);return t},Qs=(t,e)=>BG(t,UG(e));var tm=(t,e)=>()=>(t&&(e=t(t=0)),e);var oe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),im=(t,e)=>{for(var i in e)Ru(t,i,{get:e[i],enumerable:!0})},ET=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of zG(e))!CT.call(t,n)&&n!==i&&Ru(t,n,{get:()=>e[n],enumerable:!(r=NG(e,n))||r.enumerable});return t};var hn=(t,e,i)=>(i=t!=null?FG(GG(t)):{},ET(e||!t||!t.__esModule?Ru(i,"default",{value:t,enumerable:!0}):i,t)),MT=t=>ET(Ru({},"__esModule",{value:!0}),t);var Kn=(t,e,i)=>(J_(t,typeof e!="symbol"?e+"":e,i),i);function GD(t,e,i,r){switch(t){case-2:return i<e;case-1:return r>=e&&i<e;case 0:return i<e&&r>e;case 1:return i<=e&&r>e;case 2:return r>e;case 4:return!0}}function Bc(t,e,i,r){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let a=!r&&t instanceof Bs&&t.index<0?null:t.parent;if(!a)return t;t=a}let o=r?0:Qi.IgnoreOverlays;if(r)for(let a=t,l=a.parent;l;a=l,l=a.parent)a instanceof Bs&&a.index<0&&((n=l.enter(e,i,o))===null||n===void 0?void 0:n.from)!=a.from&&(t=l);for(;;){let a=t.enter(e,i,o);if(!a)return t;t=a}}function UD(t,e,i,r){let n=t.cursor(),o=[];if(!n.firstChild())return o;if(i!=null){for(let a=!1;!a;)if(a=n.type.is(i),!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function Bb(t,e,i=e.length-1){for(let r=t.parent;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[i]&&e[i]!=r.name)return!1;i--}}return!0}function HD(t){if(!t.length)return null;let e=0,i=t[0];for(let o=1;o<t.length;o++){let a=t[o];(a.from>i.from||a.to<i.to)&&(i=a,e=o)}let r=i instanceof Bs&&i.index<0?null:i.parent,n=t.slice();return r?n[e]=r:n.splice(e,1),new Ub(n,i)}function YW(t,e,i){let r=t.resolveInner(e,i),n=null;for(let o=r instanceof Bs?r:r.context.parent;o;o=o.parent)if(o.index<0){let a=o.parent;(n||(n=[r])).push(a.resolve(e,i)),o=a}else{let a=_h.get(o.tree);if(a&&a.overlay&&a.overlay[0].from<=e&&a.overlay[a.overlay.length-1].to>=e){let l=new Bs(a.tree,a.overlay[0].from+o.from,-1,o);(n||(n=[r])).push(Bc(l,e,i,!1))}}return n?HD(n):r}function Gb(t){return t.children.some(e=>e instanceof ra||!e.type.isAnonymous||Gb(e))}function ZW(t){var e;let{buffer:i,nodeSet:r,maxBufferLength:n=1024,reused:o=[],minRepeatType:a=r.types.length}=t,l=Array.isArray(i)?new Fb(i,i.length):i,h=r.types,u=0,c=0;function f(S,w,M,C,E,P){let{id:A,start:R,end:k,size:I}=l,L=c;for(;I<0;)if(l.next(),I==-1){let B=o[A];M.push(B),C.push(R-S);return}else if(I==-3){u=A;return}else if(I==-4){c=A;return}else throw new RangeError(`Unrecognized record size: ${I}`);let T=h[A],O,D,F=R-S;if(k-R<=n&&(D=g(l.pos-w,E))){let B=new Uint16Array(D.size-D.skip),U=l.pos-D.size,G=B.length;for(;l.pos>U;)G=_(D.start,B,G);O=new ra(B,k-D.start,r),F=D.start-S}else{let B=l.pos-I;l.next();let U=[],G=[],Y=A>=a?A:-1,re=0,N=k;for(;l.pos>B;)Y>=0&&l.id==Y&&l.size>=0?(l.end<=N-n&&(p(U,G,R,re,l.end,N,Y,L),re=U.length,N=l.end),l.next()):P>2500?d(R,B,U,G):f(R,B,U,G,Y,P+1);if(Y>=0&&re>0&&re<U.length&&p(U,G,R,re,R,N,Y,L),U.reverse(),G.reverse(),Y>-1&&re>0){let z=m(T);O=Hb(T,U,G,0,U.length,0,k-R,z,z)}else O=v(T,U,G,k-R,L-k)}M.push(O),C.push(F)}function d(S,w,M,C){let E=[],P=0,A=-1;for(;l.pos>w;){let{id:R,start:k,end:I,size:L}=l;if(L>4)l.next();else{if(A>-1&&k<A)break;A<0&&(A=I-n),E.push(R,k,I),P++,l.next()}}if(P){let R=new Uint16Array(P*4),k=E[E.length-2];for(let I=E.length-3,L=0;I>=0;I-=3)R[L++]=E[I],R[L++]=E[I+1]-k,R[L++]=E[I+2]-k,R[L++]=L;M.push(new ra(R,E[2]-k,r)),C.push(k-S)}}function m(S){return(w,M,C)=>{let E=0,P=w.length-1,A,R;if(P>=0&&(A=w[P])instanceof cr){if(!P&&A.type==S&&A.length==C)return A;(R=A.prop(Tt.lookAhead))&&(E=M[P]+A.length+R)}return v(S,w,M,C,E)}}function p(S,w,M,C,E,P,A,R){let k=[],I=[];for(;S.length>C;)k.push(S.pop()),I.push(w.pop()+M-E);S.push(v(r.types[A],k,I,P-E,R-P)),w.push(E-M)}function v(S,w,M,C,E=0,P){if(u){let A=[Tt.contextHash,u];P=P?[A].concat(P):[A]}if(E>25){let A=[Tt.lookAhead,E];P=P?[A].concat(P):[A]}return new cr(S,w,M,C,P)}function g(S,w){let M=l.fork(),C=0,E=0,P=0,A=M.end-n,R={size:0,start:0,skip:0};e:for(let k=M.pos-S;M.pos>k;){let I=M.size;if(M.id==w&&I>=0){R.size=C,R.start=E,R.skip=P,P+=4,C+=4,M.next();continue}let L=M.pos-I;if(I<0||L<k||M.start<A)break;let T=M.id>=a?4:0,O=M.start;for(M.next();M.pos>L;){if(M.size<0)if(M.size==-3)T+=4;else break e;else M.id>=a&&(T+=4);M.next()}E=O,C+=I,P+=T}return(w<0||C==S)&&(R.size=C,R.start=E,R.skip=P),R.size>4?R:void 0}function _(S,w,M){let{id:C,start:E,end:P,size:A}=l;if(l.next(),A>=0&&C<a){let R=M;if(A>4){let k=l.pos-(A-4);for(;l.pos>k;)M=_(S,w,M)}w[--M]=R,w[--M]=P-S,w[--M]=E-S,w[--M]=C}else A==-3?u=C:A==-4&&(c=C);return M}let x=[],b=[];for(;l.pos>0;)f(t.start||0,t.bufferStart||0,x,b,-1,0);let y=(e=t.length)!==null&&e!==void 0?e:x.length?b[0]+x[0].length:0;return new cr(h[t.topID],x.reverse(),b.reverse(),y)}function zg(t,e){if(!t.isAnonymous||e instanceof ra||e.type!=t)return 1;let i=zD.get(e);if(i==null){i=1;for(let r of e.children){if(r.type!=t||!(r instanceof cr)){i=1;break}i+=zg(t,r)}zD.set(e,i)}return i}function Hb(t,e,i,r,n,o,a,l,h){let u=0;for(let p=r;p<n;p++)u+=zg(t,e[p]);let c=Math.ceil(u*1.5/8),f=[],d=[];function m(p,v,g,_,x){for(let b=g;b<_;){let y=b,S=v[b],w=zg(t,p[b]);for(b++;b<_;b++){let M=zg(t,p[b]);if(w+M>=c)break;w+=M}if(b==y+1){if(w>c){let M=p[y];m(M.children,M.positions,0,M.children.length,v[y]+x);continue}f.push(p[y])}else{let M=v[b-1]+p[b-1].length-S;f.push(Hb(t,p,v,y,b,S,M,null,h))}d.push(S+x-o)}}return m(e,i,r,n,0),(l||h)(f,d,a)}var qW,Fc,Tt,_h,XW,Jr,Ug,ND,Qi,cr,Fb,ra,Gg,Bs,Nb,Nc,Ub,Uc,zD,el,zc,zb,mSe,Gc=tm(()=>{qW=0,Fc=class{constructor(e,i){this.from=e,this.to=i}},Tt=class{constructor(e={}){this.id=qW++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Jr.match(e)),i=>{let r=e(i);return r===void 0?null:[this,r]}}};Tt.closedBy=new Tt({deserialize:t=>t.split(" ")});Tt.openedBy=new Tt({deserialize:t=>t.split(" ")});Tt.group=new Tt({deserialize:t=>t.split(" ")});Tt.isolate=new Tt({deserialize:t=>{if(t&&t!="rtl"&&t!="ltr"&&t!="auto")throw new RangeError("Invalid value for isolate: "+t);return t||"auto"}});Tt.contextHash=new Tt({perNode:!0});Tt.lookAhead=new Tt({perNode:!0});Tt.mounted=new Tt({perNode:!0});_h=class{constructor(e,i,r){this.tree=e,this.overlay=i,this.parser=r}static get(e){return e&&e.props&&e.props[Tt.mounted.id]}},XW=Object.create(null),Jr=class t{constructor(e,i,r,n=0){this.name=e,this.props=i,this.id=r,this.flags=n}static define(e){let i=e.props&&e.props.length?Object.create(null):XW,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new t(e.name||"",i,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(Tt.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let r in e)for(let n of r.split(" "))i[n]=e[r];return r=>{for(let n=r.prop(Tt.group),o=-1;o<(n?n.length:0);o++){let a=i[o<0?r.name:n[o]];if(a)return a}}}};Jr.none=new Jr("",Object.create(null),0,8);Ug=new WeakMap,ND=new WeakMap;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Qi||(Qi={}));cr=class t{constructor(e,i,r,n,o){if(this.type=e,this.children=i,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[a,l]of o)this.props[typeof a=="number"?a:a.id]=l}}toString(){let e=_h.get(this);if(e&&!e.overlay)return e.tree.toString();let i="";for(let r of this.children){let n=r.toString();n&&(i&&(i+=","),i+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new Uc(this.topNode,e)}cursorAt(e,i=0,r=0){let n=Ug.get(this)||this.topNode,o=new Uc(n);return o.moveTo(e,i),Ug.set(this,o._tree),o}get topNode(){return new Bs(this,0,0,null)}resolve(e,i=0){let r=Bc(Ug.get(this)||this.topNode,e,i,!1);return Ug.set(this,r),r}resolveInner(e,i=0){let r=Bc(ND.get(this)||this.topNode,e,i,!0);return ND.set(this,r),r}resolveStack(e,i=0){return YW(this,e,i)}iterate(e){let{enter:i,leave:r,from:n=0,to:o=this.length}=e,a=e.mode||0,l=(a&Qi.IncludeAnonymous)>0;for(let h=this.cursor(a|Qi.IncludeAnonymous);;){let u=!1;if(h.from<=o&&h.to>=n&&(!l&&h.type.isAnonymous||i(h)!==!1)){if(h.firstChild())continue;u=!0}for(;u&&r&&(l||!h.type.isAnonymous)&&r(h),!h.nextSibling();){if(!h.parent())return;u=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:Hb(Jr.none,this.children,this.positions,0,this.children.length,0,this.length,(i,r,n)=>new t(this.type,i,r,n,this.propValues),e.makeTree||((i,r,n)=>new t(Jr.none,i,r,n)))}static build(e){return ZW(e)}};cr.empty=new cr(Jr.none,[],[],0);Fb=class t{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new t(this.buffer,this.index)}},ra=class t{constructor(e,i,r){this.buffer=e,this.length=i,this.set=r}get type(){return Jr.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],r=this.buffer[e+3],n=this.set.types[i],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return o+"("+a.join(",")+")"}findChild(e,i,r,n,o){let{buffer:a}=this,l=-1;for(let h=e;h!=i&&!(GD(o,n,a[h+1],a[h+2])&&(l=h,r>0));h=a[h+3]);return l}slice(e,i,r){let n=this.buffer,o=new Uint16Array(i-e),a=0;for(let l=e,h=0;l<i;){o[h++]=n[l++],o[h++]=n[l++]-r;let u=o[h++]=n[l++]-r;o[h++]=n[l++]-e,a=Math.max(a,u)}return new t(o,a,this.set)}};Gg=class{cursor(e=0){return new Uc(this,e)}getChild(e,i=null,r=null){let n=UD(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return UD(this,e,i,r)}resolve(e,i=0){return Bc(this,e,i,!1)}resolveInner(e,i=0){return Bc(this,e,i,!0)}matchContext(e){return Bb(this,e)}enterUnfinishedNodesBefore(e){let i=this.childBefore(e),r=this;for(;i;){let n=i.lastChild;if(!n||n.to!=i.to)break;n.type.isError&&n.from==n.to?(r=i,i=n.prevSibling):i=n}return r}get node(){return this}get next(){return this.parent}},Bs=class t extends Gg{constructor(e,i,r,n){super(),this._tree=e,this.from=i,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,r,n,o=0){for(let a=this;;){for(let{children:l,positions:h}=a._tree,u=i>0?l.length:-1;e!=u;e+=i){let c=l[e],f=h[e]+a.from;if(GD(n,r,f,f+c.length)){if(c instanceof ra){if(o&Qi.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,i,r-f,n);if(d>-1)return new Nc(new Nb(a,c,e,f),null,d)}else if(o&Qi.IncludeAnonymous||!c.type.isAnonymous||Gb(c)){let d;if(!(o&Qi.IgnoreMounts)&&(d=_h.get(c))&&!d.overlay)return new t(d.tree,f,e,a);let m=new t(c,f,e,a);return o&Qi.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(i<0?c.children.length-1:0,i,r,n)}}}if(o&Qi.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+i:e=i<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,r=0){let n;if(!(r&Qi.IgnoreOverlays)&&(n=_h.get(this._tree))&&n.overlay){let o=e-this.from;for(let{from:a,to:l}of n.overlay)if((i>0?a<=o:a<o)&&(i<0?l>=o:l>o))return new t(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}};Nb=class{constructor(e,i,r,n){this.parent=e,this.buffer=i,this.index=r,this.start=n}},Nc=class t extends Gg{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,i,r){super(),this.context=e,this._parent=i,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,i,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.context.start,r);return o<0?null:new t(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,r=0){if(r&Qi.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return o<0?null:new t(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new t(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new t(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],i=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let a=r.buffer[this.index+1];e.push(r.slice(n,o,a)),i.push(0)}return new cr(this.type,e,i,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}};Ub=class{constructor(e,i){this.heads=e,this.node=i}get next(){return HD(this.heads)}};Uc=class{get name(){return this.type.name}constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Bs)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=i||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof Bs?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,r,this.mode));let{buffer:n}=this.buffer,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.buffer.start,r);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,r=this.mode){return this.buffer?r&Qi.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Qi.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Qi.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(i.findChild(n,this.index,-1,0,4))}else{let n=i.buffer[this.index+3];if(n<(r<0?i.buffer.length:i.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(n.buffer.buffer[o+3]<this.index)return!1;({index:i,parent:r}=n)}else({index:i,_parent:r}=this._tree);for(;r;{index:i,_parent:r}=r)if(i>-1)for(let o=i+e,a=e<0?-1:r._tree.children.length;o!=a;o+=e){let l=r._tree.children[o];if(this.mode&Qi.IncludeAnonymous||l instanceof ra||!l.type.isAnonymous||Gb(l))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,o=this.stack.length;o>=0;){for(let a=e;a;a=a._parent)if(a.index==n){if(n==this.index)return a;i=a,r=o+1;break e}n=this.stack[--o]}for(let n=r;n<this.stack.length;n++)i=new Nc(this.buffer,i,this.stack[n]);return this.bufferNode=new Nc(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&i&&i(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return Bb(this.node,e);let{buffer:i}=this.buffer,{types:r}=i.set;for(let n=e.length-1,o=this.stack.length-1;n>=0;o--){if(o<0)return Bb(this.node,e,n);let a=r[i.buffer[this.stack[o]]];if(!a.isAnonymous){if(e[n]&&e[n]!=a.name)return!1;n--}}return!0}};zD=new WeakMap;el=class t{constructor(e,i,r,n,o=!1,a=!1){this.from=e,this.to=i,this.tree=r,this.offset=n,this.open=(o?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],r=!1){let n=[new t(0,e.length,e,0,!1,r)];for(let o of i)o.to>e.length&&n.push(o);return n}static applyChanges(e,i,r=128){if(!i.length)return e;let n=[],o=1,a=e.length?e[0]:null;for(let l=0,h=0,u=0;;l++){let c=l<i.length?i[l]:null,f=c?c.fromA:1e9;if(f-h>=r)for(;a&&a.from<f;){let d=a;if(h>=d.from||f<=d.to||u){let m=Math.max(d.from,h)-u,p=Math.min(d.to,f)-u;d=m>=p?null:new t(m,p,d.tree,d.offset+u,l>0,!!c)}if(d&&n.push(d),a.to>f)break;a=o<e.length?e[o++]:null}if(!c)break;h=c.toA,u=c.toA-c.toB}return n}},zc=class{startParse(e,i,r){return typeof e=="string"&&(e=new zb(e)),r=r?r.length?r.map(n=>new Fc(n.from,n.to)):[new Fc(0,0)]:[new Fc(0,e.length)],this.createParse(e,i||[],r)}parse(e,i,r){let n=this.startParse(e,i,r);for(;;){let o=n.advance();if(o)return o}}},zb=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}},mSe=new Tt({perNode:!0})});var hk=oe(Ft=>{"use strict";var qV=0,$r=class{constructor(e,i){this.from=e,this.to=i}},ri=class{constructor(e={}){this.id=qV++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Bn.match(e)),i=>{let r=e(i);return r===void 0?null:[this,r]}}};ri.closedBy=new ri({deserialize:t=>t.split(" ")});ri.openedBy=new ri({deserialize:t=>t.split(" ")});ri.group=new ri({deserialize:t=>t.split(" ")});ri.isolate=new ri({deserialize:t=>{if(t&&t!="rtl"&&t!="ltr"&&t!="auto")throw new RangeError("Invalid value for isolate: "+t);return t||"auto"}});ri.contextHash=new ri({perNode:!0});ri.lookAhead=new ri({perNode:!0});ri.mounted=new ri({perNode:!0});var ha=class{constructor(e,i,r){this.tree=e,this.overlay=i,this.parser=r}static get(e){return e&&e.props&&e.props[ri.mounted.id]}},XV=Object.create(null),Bn=class t{constructor(e,i,r,n=0){this.name=e,this.props=i,this.id=r,this.flags=n}static define(e){let i=e.props&&e.props.length?Object.create(null):XV,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new t(e.name||"",i,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(ri.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let r in e)for(let n of r.split(" "))i[n]=e[r];return r=>{for(let n=r.prop(ri.group),o=-1;o<(n?n.length:0);o++){let a=i[o<0?r.name:n[o]];if(a)return a}}}};Bn.none=new Bn("",Object.create(null),0,8);var yw=class t{constructor(e){this.types=e;for(let i=0;i<e.length;i++)if(e[i].id!=i)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let i=[];for(let r of this.types){let n=null;for(let o of e){let a=o(r);a&&(n||(n=Object.assign({},r.props)),n[a[0].id]=a[1])}i.push(n?new Bn(r.name,n,r.id,r.flags):r)}return new t(i)}},f0=new WeakMap,ek=new WeakMap;Ft.IterMode=void 0;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Ft.IterMode||(Ft.IterMode={}));var vn=class t{constructor(e,i,r,n,o){if(this.type=e,this.children=i,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[a,l]of o)this.props[typeof a=="number"?a:a.id]=l}}toString(){let e=ha.get(this);if(e&&!e.overlay)return e.tree.toString();let i="";for(let r of this.children){let n=r.toString();n&&(i&&(i+=","),i+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new ol(this.topNode,e)}cursorAt(e,i=0,r=0){let n=f0.get(this)||this.topNode,o=new ol(n);return o.moveTo(e,i),f0.set(this,o._tree),o}get topNode(){return new en(this,0,0,null)}resolve(e,i=0){let r=Jc(f0.get(this)||this.topNode,e,i,!1);return f0.set(this,r),r}resolveInner(e,i=0){let r=Jc(ek.get(this)||this.topNode,e,i,!0);return ek.set(this,r),r}resolveStack(e,i=0){return YV(this,e,i)}iterate(e){let{enter:i,leave:r,from:n=0,to:o=this.length}=e,a=e.mode||0,l=(a&Ft.IterMode.IncludeAnonymous)>0;for(let h=this.cursor(a|Ft.IterMode.IncludeAnonymous);;){let u=!1;if(h.from<=o&&h.to>=n&&(!l&&h.type.isAnonymous||i(h)!==!1)){if(h.firstChild())continue;u=!0}for(;u&&r&&(l||!h.type.isAnonymous)&&r(h),!h.nextSibling();){if(!h.parent())return;u=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:Ow(Bn.none,this.children,this.positions,0,this.children.length,0,this.length,(i,r,n)=>new t(this.type,i,r,n,this.propValues),e.makeTree||((i,r,n)=>new t(Bn.none,i,r,n)))}static build(e){return ZV(e)}};vn.empty=new vn(Bn.none,[],[],0);var xw=class t{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new t(this.buffer,this.index)}},yo=class t{constructor(e,i,r){this.buffer=e,this.length=i,this.set=r}get type(){return Bn.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],r=this.buffer[e+3],n=this.set.types[i],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return o+"("+a.join(",")+")"}findChild(e,i,r,n,o){let{buffer:a}=this,l=-1;for(let h=e;h!=i&&!(ak(o,n,a[h+1],a[h+2])&&(l=h,r>0));h=a[h+3]);return l}slice(e,i,r){let n=this.buffer,o=new Uint16Array(i-e),a=0;for(let l=e,h=0;l<i;){o[h++]=n[l++],o[h++]=n[l++]-r;let u=o[h++]=n[l++]-r;o[h++]=n[l++]-e,a=Math.max(a,u)}return new t(o,a,this.set)}};function ak(t,e,i,r){switch(t){case-2:return i<e;case-1:return r>=e&&i<e;case 0:return i<e&&r>e;case 1:return i<=e&&r>e;case 2:return r>e;case 4:return!0}}function Jc(t,e,i,r){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let a=!r&&t instanceof en&&t.index<0?null:t.parent;if(!a)return t;t=a}let o=r?0:Ft.IterMode.IgnoreOverlays;if(r)for(let a=t,l=a.parent;l;a=l,l=a.parent)a instanceof en&&a.index<0&&((n=l.enter(e,i,o))===null||n===void 0?void 0:n.from)!=a.from&&(t=l);for(;;){let a=t.enter(e,i,o);if(!a)return t;t=a}}var p0=class{cursor(e=0){return new ol(this,e)}getChild(e,i=null,r=null){let n=tk(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return tk(this,e,i,r)}resolve(e,i=0){return Jc(this,e,i,!1)}resolveInner(e,i=0){return Jc(this,e,i,!0)}matchContext(e){return bw(this,e)}enterUnfinishedNodesBefore(e){let i=this.childBefore(e),r=this;for(;i;){let n=i.lastChild;if(!n||n.to!=i.to)break;n.type.isError&&n.from==n.to?(r=i,i=n.prevSibling):i=n}return r}get node(){return this}get next(){return this.parent}},en=class t extends p0{constructor(e,i,r,n){super(),this._tree=e,this.from=i,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,r,n,o=0){for(let a=this;;){for(let{children:l,positions:h}=a._tree,u=i>0?l.length:-1;e!=u;e+=i){let c=l[e],f=h[e]+a.from;if(ak(n,r,f,f+c.length)){if(c instanceof yo){if(o&Ft.IterMode.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,i,r-f,n);if(d>-1)return new sl(new ww(a,c,e,f),null,d)}else if(o&Ft.IterMode.IncludeAnonymous||!c.type.isAnonymous||Lw(c)){let d;if(!(o&Ft.IterMode.IgnoreMounts)&&(d=ha.get(c))&&!d.overlay)return new t(d.tree,f,e,a);let m=new t(c,f,e,a);return o&Ft.IterMode.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(i<0?c.children.length-1:0,i,r,n)}}}if(o&Ft.IterMode.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+i:e=i<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,r=0){let n;if(!(r&Ft.IterMode.IgnoreOverlays)&&(n=ha.get(this._tree))&&n.overlay){let o=e-this.from;for(let{from:a,to:l}of n.overlay)if((i>0?a<=o:a<o)&&(i<0?l>=o:l>o))return new t(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}};function tk(t,e,i,r){let n=t.cursor(),o=[];if(!n.firstChild())return o;if(i!=null){for(let a=!1;!a;)if(a=n.type.is(i),!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function bw(t,e,i=e.length-1){for(let r=t.parent;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[i]&&e[i]!=r.name)return!1;i--}}return!0}var ww=class{constructor(e,i,r,n){this.parent=e,this.buffer=i,this.index=r,this.start=n}},sl=class t extends p0{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,i,r){super(),this.context=e,this._parent=i,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,i,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.context.start,r);return o<0?null:new t(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,r=0){if(r&Ft.IterMode.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return o<0?null:new t(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new t(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new t(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],i=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let a=r.buffer[this.index+1];e.push(r.slice(n,o,a)),i.push(0)}return new vn(this.type,e,i,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}};function lk(t){if(!t.length)return null;let e=0,i=t[0];for(let o=1;o<t.length;o++){let a=t[o];(a.from>i.from||a.to<i.to)&&(i=a,e=o)}let r=i instanceof en&&i.index<0?null:i.parent,n=t.slice();return r?n[e]=r:n.splice(e,1),new Sw(n,i)}var Sw=class{constructor(e,i){this.heads=e,this.node=i}get next(){return lk(this.heads)}};function YV(t,e,i){let r=t.resolveInner(e,i),n=null;for(let o=r instanceof en?r:r.context.parent;o;o=o.parent)if(o.index<0){let a=o.parent;(n||(n=[r])).push(a.resolve(e,i)),o=a}else{let a=ha.get(o.tree);if(a&&a.overlay&&a.overlay[0].from<=e&&a.overlay[a.overlay.length-1].to>=e){let l=new en(a.tree,a.overlay[0].from+o.from,-1,o);(n||(n=[r])).push(Jc(l,e,i,!1))}}return n?lk(n):r}var ol=class{get name(){return this.type.name}constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof en)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=i||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof en?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,r,this.mode));let{buffer:n}=this.buffer,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.buffer.start,r);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,r=this.mode){return this.buffer?r&Ft.IterMode.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Ft.IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Ft.IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(i.findChild(n,this.index,-1,0,4))}else{let n=i.buffer[this.index+3];if(n<(r<0?i.buffer.length:i.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(n.buffer.buffer[o+3]<this.index)return!1;({index:i,parent:r}=n)}else({index:i,_parent:r}=this._tree);for(;r;{index:i,_parent:r}=r)if(i>-1)for(let o=i+e,a=e<0?-1:r._tree.children.length;o!=a;o+=e){let l=r._tree.children[o];if(this.mode&Ft.IterMode.IncludeAnonymous||l instanceof yo||!l.type.isAnonymous||Lw(l))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,o=this.stack.length;o>=0;){for(let a=e;a;a=a._parent)if(a.index==n){if(n==this.index)return a;i=a,r=o+1;break e}n=this.stack[--o]}for(let n=r;n<this.stack.length;n++)i=new sl(this.buffer,i,this.stack[n]);return this.bufferNode=new sl(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&i&&i(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return bw(this.node,e);let{buffer:i}=this.buffer,{types:r}=i.set;for(let n=e.length-1,o=this.stack.length-1;n>=0;o--){if(o<0)return bw(this.node,e,n);let a=r[i.buffer[this.stack[o]]];if(!a.isAnonymous){if(e[n]&&e[n]!=a.name)return!1;n--}}return!0}};function Lw(t){return t.children.some(e=>e instanceof yo||!e.type.isAnonymous||Lw(e))}function ZV(t){var e;let{buffer:i,nodeSet:r,maxBufferLength:n=1024,reused:o=[],minRepeatType:a=r.types.length}=t,l=Array.isArray(i)?new xw(i,i.length):i,h=r.types,u=0,c=0;function f(S,w,M,C,E,P){let{id:A,start:R,end:k,size:I}=l,L=c;for(;I<0;)if(l.next(),I==-1){let B=o[A];M.push(B),C.push(R-S);return}else if(I==-3){u=A;return}else if(I==-4){c=A;return}else throw new RangeError(`Unrecognized record size: ${I}`);let T=h[A],O,D,F=R-S;if(k-R<=n&&(D=g(l.pos-w,E))){let B=new Uint16Array(D.size-D.skip),U=l.pos-D.size,G=B.length;for(;l.pos>U;)G=_(D.start,B,G);O=new yo(B,k-D.start,r),F=D.start-S}else{let B=l.pos-I;l.next();let U=[],G=[],Y=A>=a?A:-1,re=0,N=k;for(;l.pos>B;)Y>=0&&l.id==Y&&l.size>=0?(l.end<=N-n&&(p(U,G,R,re,l.end,N,Y,L),re=U.length,N=l.end),l.next()):P>2500?d(R,B,U,G):f(R,B,U,G,Y,P+1);if(Y>=0&&re>0&&re<U.length&&p(U,G,R,re,R,N,Y,L),U.reverse(),G.reverse(),Y>-1&&re>0){let z=m(T);O=Ow(T,U,G,0,U.length,0,k-R,z,z)}else O=v(T,U,G,k-R,L-k)}M.push(O),C.push(F)}function d(S,w,M,C){let E=[],P=0,A=-1;for(;l.pos>w;){let{id:R,start:k,end:I,size:L}=l;if(L>4)l.next();else{if(A>-1&&k<A)break;A<0&&(A=I-n),E.push(R,k,I),P++,l.next()}}if(P){let R=new Uint16Array(P*4),k=E[E.length-2];for(let I=E.length-3,L=0;I>=0;I-=3)R[L++]=E[I],R[L++]=E[I+1]-k,R[L++]=E[I+2]-k,R[L++]=L;M.push(new yo(R,E[2]-k,r)),C.push(k-S)}}function m(S){return(w,M,C)=>{let E=0,P=w.length-1,A,R;if(P>=0&&(A=w[P])instanceof vn){if(!P&&A.type==S&&A.length==C)return A;(R=A.prop(ri.lookAhead))&&(E=M[P]+A.length+R)}return v(S,w,M,C,E)}}function p(S,w,M,C,E,P,A,R){let k=[],I=[];for(;S.length>C;)k.push(S.pop()),I.push(w.pop()+M-E);S.push(v(r.types[A],k,I,P-E,R-P)),w.push(E-M)}function v(S,w,M,C,E=0,P){if(u){let A=[ri.contextHash,u];P=P?[A].concat(P):[A]}if(E>25){let A=[ri.lookAhead,E];P=P?[A].concat(P):[A]}return new vn(S,w,M,C,P)}function g(S,w){let M=l.fork(),C=0,E=0,P=0,A=M.end-n,R={size:0,start:0,skip:0};e:for(let k=M.pos-S;M.pos>k;){let I=M.size;if(M.id==w&&I>=0){R.size=C,R.start=E,R.skip=P,P+=4,C+=4,M.next();continue}let L=M.pos-I;if(I<0||L<k||M.start<A)break;let T=M.id>=a?4:0,O=M.start;for(M.next();M.pos>L;){if(M.size<0)if(M.size==-3)T+=4;else break e;else M.id>=a&&(T+=4);M.next()}E=O,C+=I,P+=T}return(w<0||C==S)&&(R.size=C,R.start=E,R.skip=P),R.size>4?R:void 0}function _(S,w,M){let{id:C,start:E,end:P,size:A}=l;if(l.next(),A>=0&&C<a){let R=M;if(A>4){let k=l.pos-(A-4);for(;l.pos>k;)M=_(S,w,M)}w[--M]=R,w[--M]=P-S,w[--M]=E-S,w[--M]=C}else A==-3?u=C:A==-4&&(c=C);return M}let x=[],b=[];for(;l.pos>0;)f(t.start||0,t.bufferStart||0,x,b,-1,0);let y=(e=t.length)!==null&&e!==void 0?e:x.length?b[0]+x[0].length:0;return new vn(h[t.topID],x.reverse(),b.reverse(),y)}var ik=new WeakMap;function d0(t,e){if(!t.isAnonymous||e instanceof yo||e.type!=t)return 1;let i=ik.get(e);if(i==null){i=1;for(let r of e.children){if(r.type!=t||!(r instanceof vn)){i=1;break}i+=d0(t,r)}ik.set(e,i)}return i}function Ow(t,e,i,r,n,o,a,l,h){let u=0;for(let p=r;p<n;p++)u+=d0(t,e[p]);let c=Math.ceil(u*1.5/8),f=[],d=[];function m(p,v,g,_,x){for(let b=g;b<_;){let y=b,S=v[b],w=d0(t,p[b]);for(b++;b<_;b++){let M=d0(t,p[b]);if(w+M>=c)break;w+=M}if(b==y+1){if(w>c){let M=p[y];m(M.children,M.positions,0,M.children.length,v[y]+x);continue}f.push(p[y])}else{let M=v[b-1]+p[b-1].length-S;f.push(Ow(t,p,v,y,b,S,M,null,h))}d.push(S+x-o)}}return m(e,i,r,n,0),(l||h)(f,d,a)}var Cw=class{constructor(){this.map=new WeakMap}setBuffer(e,i,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(i,r)}getBuffer(e,i){let r=this.map.get(e);return r&&r.get(i)}set(e,i){e instanceof sl?this.setBuffer(e.context.buffer,e.index,i):e instanceof en&&this.map.set(e.tree,i)}get(e){return e instanceof sl?this.getBuffer(e.context.buffer,e.index):e instanceof en?this.map.get(e.tree):void 0}cursorSet(e,i){e.buffer?this.setBuffer(e.buffer.buffer,e.index,i):this.map.set(e.tree,i)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}},$c=class t{constructor(e,i,r,n,o=!1,a=!1){this.from=e,this.to=i,this.tree=r,this.offset=n,this.open=(o?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],r=!1){let n=[new t(0,e.length,e,0,!1,r)];for(let o of i)o.to>e.length&&n.push(o);return n}static applyChanges(e,i,r=128){if(!i.length)return e;let n=[],o=1,a=e.length?e[0]:null;for(let l=0,h=0,u=0;;l++){let c=l<i.length?i[l]:null,f=c?c.fromA:1e9;if(f-h>=r)for(;a&&a.from<f;){let d=a;if(h>=d.from||f<=d.to||u){let m=Math.max(d.from,h)-u,p=Math.min(d.to,f)-u;d=m>=p?null:new t(m,p,d.tree,d.offset+u,l>0,!!c)}if(d&&n.push(d),a.to>f)break;a=o<e.length?e[o++]:null}if(!c)break;h=c.toA,u=c.toA-c.toB}return n}},Ew=class{startParse(e,i,r){return typeof e=="string"&&(e=new Mw(e)),r=r?r.length?r.map(n=>new $r(n.from,n.to)):[new $r(0,0)]:[new $r(0,e.length)],this.createParse(e,i||[],r)}parse(e,i,r){let n=this.startParse(e,i,r);for(;;){let o=n.advance();if(o)return o}}},Mw=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}};function KV(t){return(e,i,r,n)=>new Pw(e,t,i,r,n)}var m0=class{constructor(e,i,r,n,o){this.parser=e,this.parse=i,this.overlay=r,this.target=n,this.from=o}};function rk(t){if(!t.length||t.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(t))}var Tw=class{constructor(e,i,r,n,o,a,l){this.parser=e,this.predicate=i,this.mounts=r,this.index=n,this.start=o,this.target=a,this.prev=l,this.depth=0,this.ranges=[]}},Aw=new ri({perNode:!0}),Pw=class{constructor(e,i,r,n,o){this.nest=i,this.input=r,this.fragments=n,this.ranges=o,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let n of this.inner)n.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new vn(r.type,r.children,r.positions,r.length,r.propValues.concat([[Aw,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],i=e.parse.advance();if(i){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[ri.mounted.id]=new ha(i,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].from<e&&(e=Math.min(e,this.inner[i].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].parse.stopAt(e)}startInner(){let e=new Rw(this.fragments),i=null,r=null,n=new ol(new en(this.baseTree,this.ranges[0].from,0,null),Ft.IterMode.IncludeAnonymous|Ft.IterMode.IgnoreMounts);e:for(let o,a;;){let l=!0,h;if(this.stoppedAt!=null&&n.from>=this.stoppedAt)l=!1;else if(e.hasNode(n)){if(i){let u=i.mounts.find(c=>c.frag.from<=n.from&&c.frag.to>=n.to&&c.mount.overlay);if(u)for(let c of u.mount.overlay){let f=c.from+u.pos,d=c.to+u.pos;f>=n.from&&d<=n.to&&!i.ranges.some(m=>m.from<d&&m.to>f)&&i.ranges.push({from:f,to:d})}}l=!1}else if(r&&(a=QV(r.ranges,n.from,n.to)))l=a!=2;else if(!n.type.isAnonymous&&(o=this.nest(n,this.input))&&(n.from<n.to||!o.overlay)){n.tree||JV(n);let u=e.findMounts(n.from,o.parser);if(typeof o.overlay=="function")i=new Tw(o.parser,o.overlay,u,this.inner.length,n.from,n.tree,i);else{let c=sk(this.ranges,o.overlay||(n.from<n.to?[new $r(n.from,n.to)]:[]));c.length&&rk(c),(c.length||!o.overlay)&&this.inner.push(new m0(o.parser,c.length?o.parser.startParse(this.input,ok(u,c),c):o.parser.startParse(""),o.overlay?o.overlay.map(f=>new $r(f.from-n.from,f.to-n.from)):null,n.tree,c.length?c[0].from:n.from)),o.overlay?c.length&&(r={ranges:c,depth:0,prev:r}):l=!1}}else i&&(h=i.predicate(n))&&(h===!0&&(h=new $r(n.from,n.to)),h.from<h.to&&i.ranges.push(h));if(l&&n.firstChild())i&&i.depth++,r&&r.depth++;else for(;!n.nextSibling();){if(!n.parent())break e;if(i&&!--i.depth){let u=sk(this.ranges,i.ranges);u.length&&(rk(u),this.inner.splice(i.index,0,new m0(i.parser,i.parser.startParse(this.input,ok(i.mounts,u),u),i.ranges.map(c=>new $r(c.from-i.start,c.to-i.start)),i.target,u[0].from))),i=i.prev}r&&!--r.depth&&(r=r.prev)}}}};function QV(t,e,i){for(let r of t){if(r.from>=i)break;if(r.to>e)return r.from<=e&&r.to>=i?2:1}return 0}function nk(t,e,i,r,n,o){if(e<i){let a=t.buffer[e+1];r.push(t.slice(e,i,a)),n.push(a-o)}}function JV(t){let{node:e}=t,i=[],r=e.context.buffer;do i.push(t.index),t.parent();while(!t.tree);let n=t.tree,o=n.children.indexOf(r),a=n.children[o],l=a.buffer,h=[o];function u(c,f,d,m,p,v){let g=i[v],_=[],x=[];nk(a,c,g,_,x,m);let b=l[g+1],y=l[g+2];h.push(_.length);let S=v?u(g+4,l[g+3],a.set.types[l[g]],b,y-b,v-1):e.toTree();return _.push(S),x.push(b-m),nk(a,l[g+3],f,_,x,m),new vn(d,_,x,p)}n.children[o]=u(0,l.length,Bn.none,0,a.length,i.length-1);for(let c of h){let f=t.tree.children[c],d=t.tree.positions[c];t.yield(new en(f,d+t.from,c,t._tree))}}var g0=class{constructor(e,i){this.offset=i,this.done=!1,this.cursor=e.cursor(Ft.IterMode.IncludeAnonymous|Ft.IterMode.IgnoreMounts)}moveTo(e){let{cursor:i}=this,r=e-this.offset;for(;!this.done&&i.from<r;)i.to>=e&&i.enter(r,1,Ft.IterMode.IgnoreOverlays|Ft.IterMode.ExcludeBuffers)||i.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let i=this.cursor.tree;;){if(i==e.tree)return!0;if(i.children.length&&i.positions[0]==0&&i.children[0]instanceof vn)i=i.children[0];else break}return!1}},Rw=class{constructor(e){var i;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(i=r.tree.prop(Aw))!==null&&i!==void 0?i:r.to,this.inner=new g0(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let i=this.curFrag=this.fragments[this.fragI];this.curTo=(e=i.tree.prop(Aw))!==null&&e!==void 0?e:i.to,this.inner=new g0(i.tree,-i.offset)}}findMounts(e,i){var r;let n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let o=this.inner.cursor.node;o;o=o.parent){let a=(r=o.tree)===null||r===void 0?void 0:r.prop(ri.mounted);if(a&&a.parser==i)for(let l=this.fragI;l<this.fragments.length;l++){let h=this.fragments[l];if(h.from>=o.to)break;h.tree==this.curFrag.tree&&n.push({frag:h,pos:o.from-h.offset,mount:a})}}}return n}};function sk(t,e){let i=null,r=e;for(let n=1,o=0;n<t.length;n++){let a=t[n-1].to,l=t[n].from;for(;o<r.length;o++){let h=r[o];if(h.from>=l)break;h.to<=a||(i||(r=i=e.slice()),h.from<a?(i[o]=new $r(h.from,a),h.to>l&&i.splice(o+1,0,new $r(l,h.to))):h.to>l?i[o--]=new $r(l,h.to):i.splice(o--,1))}}return r}function $V(t,e,i,r){let n=0,o=0,a=!1,l=!1,h=-1e9,u=[];for(;;){let c=n==t.length?1e9:a?t[n].to:t[n].from,f=o==e.length?1e9:l?e[o].to:e[o].from;if(a!=l){let d=Math.max(h,i),m=Math.min(c,f,r);d<m&&u.push(new $r(d,m))}if(h=Math.min(c,f),h==1e9)break;c==h&&(a?(a=!1,n++):a=!0),f==h&&(l?(l=!1,o++):l=!0)}return u}function ok(t,e){let i=[];for(let{pos:r,mount:n,frag:o}of t){let a=r+(n.overlay?n.overlay[0].from:0),l=a+n.tree.length,h=Math.max(o.from,a),u=Math.min(o.to,l);if(n.overlay){let c=n.overlay.map(d=>new $r(d.from+r,d.to+r)),f=$V(e,c,h,u);for(let d=0,m=h;;d++){let p=d==f.length,v=p?u:f[d].from;if(v>m&&i.push(new $c(m,v,n.tree,-a,o.from>=m||o.openStart,o.to<=v||o.openEnd)),p)break;m=f[d].to}}else i.push(new $c(h,u,n.tree,-a,o.from>=a||o.openStart,o.to<=l||o.openEnd))}return i}Ft.DefaultBufferLength=1024;Ft.MountedTree=ha;Ft.NodeProp=ri;Ft.NodeSet=yw;Ft.NodeType=Bn;Ft.NodeWeakMap=Cw;Ft.Parser=Ew;Ft.Tree=vn;Ft.TreeBuffer=yo;Ft.TreeCursor=ol;Ft.TreeFragment=$c;Ft.parseMixed=KV});var Vw=oe(al=>{"use strict";var Nn=hk(),v0=class t{constructor(e,i,r,n,o,a,l,h,u,c=0,f){this.p=e,this.stack=i,this.state=r,this.reducePos=n,this.pos=o,this.score=a,this.buffer=l,this.bufferBase=h,this.curContext=u,this.lookAhead=c,this.parent=f}toString(){return`[${this.stack.filter((e,i)=>i%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,i,r=0){let n=e.parser.context;return new t(e,[],i,r,r,0,[],0,n?new _0(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,i){this.stack.push(this.state,i,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var i;let r=e>>19,n=e&65535,{parser:o}=this.p,a=o.dynamicPrecedence(n);if(a&&(this.score+=a),r==0){this.pushState(o.getGoto(this.state,n,!0),this.reducePos),n<o.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),this.reduceContext(n,this.reducePos);return}let l=this.stack.length-(r-1)*3-(e&262144?6:0),h=l?this.stack[l-2]:this.p.ranges[0].from,u=this.reducePos-h;u>=2e3&&!(!((i=this.p.parser.nodeSet.types[n])===null||i===void 0)&&i.isAnonymous)&&(h==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=u):this.p.lastBigReductionSize<u&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=h,this.p.lastBigReductionSize=u));let c=l?this.stack[l-1]:0,f=this.bufferBase+this.buffer.length-c;if(n<o.minRepeatTerm||e&131072){let d=o.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,h,d,f+4,!0)}if(e&262144)this.state=this.stack[l];else{let d=this.stack[l-3];this.state=o.getGoto(d,n,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(n,h)}storeNode(e,i,r,n=4,o=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let a=this,l=this.buffer.length;if(l==0&&a.parent&&(l=a.bufferBase-a.parent.bufferBase,a=a.parent),l>0&&a.buffer[l-4]==0&&a.buffer[l-1]>-1){if(i==r)return;if(a.buffer[l-2]>=i){a.buffer[l-2]=r;return}}}if(!o||this.pos==r)this.buffer.push(e,i,r,n);else{let a=this.buffer.length;if(a>0&&this.buffer[a-4]!=0)for(;a>0&&this.buffer[a-2]>r;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,n>4&&(n-=4);this.buffer[a]=e,this.buffer[a+1]=i,this.buffer[a+2]=r,this.buffer[a+3]=n}}shift(e,i,r,n){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=n,this.shiftContext(i,r),i<=this.p.parser.maxNode&&this.buffer.push(i,r,n,4);else{let o=e,{parser:a}=this.p;(n>this.pos||i<=a.maxNode)&&(this.pos=n,a.stateFlag(o,1)||(this.reducePos=n)),this.pushState(o,r),this.shiftContext(i,r),i<=a.maxNode&&this.buffer.push(i,r,n,4)}}apply(e,i,r,n){e&65536?this.reduce(e):this.shift(e,i,r,n)}useNode(e,i){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(i,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,i=e.buffer.length;for(;i>0&&e.buffer[i-2]>e.reducePos;)i-=4;let r=e.buffer.slice(i),n=e.bufferBase+i;for(;e&&n==e.bufferBase;)e=e.parent;return new t(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,i){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,i,4),this.storeNode(0,this.pos,i,r?8:4),this.pos=this.reducePos=i,this.score-=190}canShift(e){for(let i=new kw(this);;){let r=this.p.parser.stateSlot(i.state,4)||this.p.parser.hasAction(i.state,e);if(r==0)return!1;if(!(r&65536))return!0;i.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let i=this.p.parser.nextStates(this.state);if(i.length>8||this.stack.length>=120){let n=[];for(let o=0,a;o<i.length;o+=2)(a=i[o+1])!=this.state&&this.p.parser.hasAction(a,e)&&n.push(i[o],a);if(this.stack.length<120)for(let o=0;n.length<8&&o<i.length;o+=2){let a=i[o+1];n.some((l,h)=>h&1&&l==a)||n.push(i[o],a)}i=n}let r=[];for(let n=0;n<i.length&&r.length<4;n+=2){let o=i[n+1];if(o==this.state)continue;let a=this.split();a.pushState(o,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(i[n],this.pos),a.reducePos=this.pos,a.score-=200,r.push(a)}return r}forceReduce(){let{parser:e}=this.p,i=e.stateSlot(this.state,5);if(!(i&65536))return!1;if(!e.validAction(this.state,i)){let r=i>>19,n=i&65535,o=this.stack.length-r*3;if(o<0||e.getGoto(this.stack[o],n,!1)<0){let a=this.findForcedReduction();if(a==null)return!1;i=a}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(i),!0}findForcedReduction(){let{parser:e}=this.p,i=[],r=(n,o)=>{if(!i.includes(n))return i.push(n),e.allActions(n,a=>{if(!(a&393216))if(a&65536){let l=(a>>19)-o;if(l>1){let h=a&65535,u=this.stack.length-l*3;if(u>=0&&e.getGoto(this.stack[u],h,!1)>=0)return l<<19|65536|h}}else{let l=r(a,o+1);if(l!=null)return l}})};return r(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let i=0;i<this.stack.length;i+=3)if(this.stack[i]!=e.stack[i])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(i)))}reduceContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(i)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let i=new _0(this.curContext.tracker,e);i.hash!=this.curContext.hash&&this.emitContext(),this.curContext=i}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}},_0=class{constructor(e,i){this.tracker=e,this.context=i,this.hash=e.strict?e.hash(i):0}},kw=class{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let i=e&65535,r=e>>19;r==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(r-1)*3;let n=this.start.p.parser.getGoto(this.stack[this.base-3],i,!0);this.state=n}},Fw=class t{constructor(e,i,r){this.stack=e,this.pos=i,this.index=r,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,i=e.bufferBase+e.buffer.length){return new t(e,i,i-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new t(this.stack,this.pos,this.index)}};function ef(t,e=Uint16Array){if(typeof t!="string")return t;let i=null;for(let r=0,n=0;r<t.length;){let o=0;for(;;){let a=t.charCodeAt(r++),l=!1;if(a==126){o=65535;break}a>=92&&a--,a>=34&&a--;let h=a-32;if(h>=46&&(h-=46,l=!0),o+=h,l)break;o*=46}i?i[n++]=o:i=new e(o)}return i}var Mh=class{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}},uk=new Mh,y0=class{constructor(e,i){this.input=e,this.ranges=i,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=uk,this.rangeIndex=0,this.pos=this.chunkPos=i[0].from,this.range=i[0],this.end=i[i.length-1].to,this.readNext()}resolveOffset(e,i){let r=this.range,n=this.rangeIndex,o=this.pos+e;for(;o<r.from;){if(!n)return null;let a=this.ranges[--n];o-=r.from-a.to,r=a}for(;i<0?o>r.to:o>=r.to;){if(n==this.ranges.length-1)return null;let a=this.ranges[++n];o+=a.from-r.to,r=a}return o}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let i of this.ranges)if(i.to>e)return Math.max(e,i.from);return this.end}peek(e){let i=this.chunkOff+e,r,n;if(i>=0&&i<this.chunk.length)r=this.pos+e,n=this.chunk.charCodeAt(i);else{let o=this.resolveOffset(e,1);if(o==null)return-1;if(r=o,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let a=this.rangeIndex,l=this.range;for(;l.to<=r;)l=this.ranges[++a];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-r)),n=this.chunk2.charCodeAt(0)}}return r>=this.token.lookAhead&&(this.token.lookAhead=r+1),n}acceptToken(e,i=0){let r=i?this.resolveOffset(i,-1):this.pos;if(r==null||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}acceptTokenTo(e,i){this.token.value=e,this.token.end=i}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:i}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=i,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),i=this.pos+e.length;this.chunk=i>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,i){if(i?(this.token=i,i.start=e,i.lookAhead=e+1,i.value=i.extended=-1):this.token=uk,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,i){if(e>=this.chunkPos&&i<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,i-this.chunkPos);if(e>=this.chunk2Pos&&i<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,i-this.chunk2Pos);if(e>=this.range.from&&i<=this.range.to)return this.input.read(e,i);let r="";for(let n of this.ranges){if(n.from>=i)break;n.to>e&&(r+=this.input.read(Math.max(n.from,e),Math.min(n.to,i)))}return r}},ua=class{constructor(e,i){this.data=e,this.id=i}token(e,i){let{parser:r}=i.p;mk(this.data,e,i,this.id,r.data,r.tokenPrecTable)}};ua.prototype.contextual=ua.prototype.fallback=ua.prototype.extend=!1;var x0=class{constructor(e,i,r){this.precTable=i,this.elseToken=r,this.data=typeof e=="string"?ef(e):e}token(e,i){let r=e.pos,n=0;for(;;){let o=e.next<0,a=e.resolveOffset(1,1);if(mk(this.data,e,i,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(o||n++,a==null)break;e.reset(a,e.token)}n&&(e.reset(r,e.token),e.acceptToken(this.elseToken,n))}};x0.prototype.contextual=ua.prototype.fallback=ua.prototype.extend=!1;var Bw=class{constructor(e,i={}){this.token=e,this.contextual=!!i.contextual,this.fallback=!!i.fallback,this.extend=!!i.extend}};function mk(t,e,i,r,n,o){let a=0,l=1<<r,{dialect:h}=i.p.parser;e:for(;l&t[a];){let u=t[a+1];for(let m=a+3;m<u;m+=2)if((t[m+1]&l)>0){let p=t[m];if(h.allows(p)&&(e.token.value==-1||e.token.value==p||e7(p,e.token.value,n,o))){e.acceptToken(p);break}}let c=e.next,f=0,d=t[a+2];if(e.next<0&&d>f&&t[u+d*3-3]==65535){a=t[u+d*3-1];continue e}for(;f<d;){let m=f+d>>1,p=u+m+(m<<1),v=t[p],g=t[p+1]||65536;if(c<v)d=m;else if(c>=g)f=m+1;else{a=t[p+2],e.advance();continue e}}break}}function ck(t,e,i){for(let r=e,n;(n=t[r])!=65535;r++)if(n==i)return r-e;return-1}function e7(t,e,i,r){let n=ck(i,r,e);return n<0||ck(i,r,t)<n}var _n=typeof process!="undefined"&&process.env&&/\bparse\b/.test(process.env.LOG),Dw=null;function fk(t,e,i){let r=t.cursor(Nn.IterMode.IncludeAnonymous);for(r.moveTo(e);;)if(!(i<0?r.childBefore(e):r.childAfter(e)))for(;;){if((i<0?r.to<e:r.from>e)&&!r.type.isError)return i<0?Math.max(0,Math.min(r.to-1,e-25)):Math.min(t.length,Math.max(r.from+1,e+25));if(i<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return i<0?0:t.length}}var Nw=class{constructor(e,i){this.fragments=e,this.nodeSet=i,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?fk(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?fk(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let i=this.trees.length-1;if(i<0)return this.nextFragment(),null;let r=this.trees[i],n=this.index[i];if(n==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let o=r.children[n],a=this.start[i]+r.positions[n];if(a>e)return this.nextStart=a,null;if(o instanceof Nn.Tree){if(a==e){if(a<this.safeFrom)return null;let l=a+o.length;if(l<=this.safeTo){let h=o.prop(Nn.NodeProp.lookAhead);if(!h||l+h<this.fragment.to)return o}}this.index[i]++,a+o.length>=Math.max(this.safeFrom,e)&&(this.trees.push(o),this.start.push(a),this.index.push(0))}else this.index[i]++,this.nextStart=a+o.length}}},Uw=class{constructor(e,i){this.stream=i,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(r=>new Mh)}getActions(e){let i=0,r=null,{parser:n}=e.p,{tokenizers:o}=n,a=n.stateSlot(e.state,3),l=e.curContext?e.curContext.hash:0,h=0;for(let u=0;u<o.length;u++){if(!(1<<u&a))continue;let c=o[u],f=this.tokens[u];if(!(r&&!c.fallback)&&((c.contextual||f.start!=e.pos||f.mask!=a||f.context!=l)&&(this.updateCachedToken(f,c,e),f.mask=a,f.context=l),f.lookAhead>f.end+25&&(h=Math.max(f.lookAhead,h)),f.value!=0)){let d=i;if(f.extended>-1&&(i=this.addActions(e,f.extended,f.end,i)),i=this.addActions(e,f.value,f.end,i),!c.extend&&(r=f,i>d))break}}for(;this.actions.length>i;)this.actions.pop();return h&&e.setLookAhead(h),!r&&e.pos==this.stream.end&&(r=new Mh,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,i=this.addActions(e,r.value,r.end,i)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let i=new Mh,{pos:r,p:n}=e;return i.start=r,i.end=Math.min(r+1,n.stream.end),i.value=r==n.stream.end?n.parser.eofTerm:0,i}updateCachedToken(e,i,r){let n=this.stream.clipPos(r.pos);if(i.token(this.stream.reset(n,e),r),e.value>-1){let{parser:o}=r.p;for(let a=0;a<o.specialized.length;a++)if(o.specialized[a]==e.value){let l=o.specializers[a](this.stream.read(e.start,e.end),r);if(l>=0&&r.p.parser.dialect.allows(l>>1)){l&1?e.extended=l>>1:e.value=l>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,i,r,n){for(let o=0;o<n;o+=3)if(this.actions[o]==e)return n;return this.actions[n++]=e,this.actions[n++]=i,this.actions[n++]=r,n}addActions(e,i,r,n){let{state:o}=e,{parser:a}=e.p,{data:l}=a;for(let h=0;h<2;h++)for(let u=a.stateSlot(o,h?2:1);;u+=3){if(l[u]==65535)if(l[u+1]==1)u=xo(l,u+2);else{n==0&&l[u+1]==2&&(n=this.putAction(xo(l,u+2),i,r,n));break}l[u]==i&&(n=this.putAction(xo(l,u+1),i,r,n))}return n}},zw=class{constructor(e,i,r,n){this.parser=e,this.input=i,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new y0(i,n),this.tokens=new Uw(e,this.stream),this.topTerm=e.top[1];let{from:o}=n[0];this.stacks=[v0.start(this,e.top[0],o)],this.fragments=r.length&&this.stream.end-o>e.bufferLength*4?new Nw(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,i=this.minStackPos,r=this.stacks=[],n,o;if(this.bigReductionCount>300&&e.length==1){let[a]=e;for(;a.forceReduce()&&a.stack.length&&a.stack[a.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let a=0;a<e.length;a++){let l=e[a];for(;;){if(this.tokens.mainToken=null,l.pos>i)r.push(l);else{if(this.advanceStack(l,r,e))continue;{n||(n=[],o=[]),n.push(l);let h=this.tokens.getMainToken(l);o.push(h.value,h.end)}}break}}if(!r.length){let a=n&&t7(n);if(a)return _n&&console.log("Finish with "+this.stackID(a)),this.stackToTree(a);if(this.parser.strict)throw _n&&n&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+i);this.recovering||(this.recovering=5)}if(this.recovering&&n){let a=this.stoppedAt!=null&&n[0].pos>this.stoppedAt?n[0]:this.runRecovery(n,o,r);if(a)return _n&&console.log("Force-finish "+this.stackID(a)),this.stackToTree(a.forceAll())}if(this.recovering){let a=this.recovering==1?1:this.recovering*3;if(r.length>a)for(r.sort((l,h)=>h.score-l.score);r.length>a;)r.pop();r.some(l=>l.reducePos>i)&&this.recovering--}else if(r.length>1){e:for(let a=0;a<r.length-1;a++){let l=r[a];for(let h=a+1;h<r.length;h++){let u=r[h];if(l.sameState(u)||l.buffer.length>500&&u.buffer.length>500)if((l.score-u.score||l.buffer.length-u.buffer.length)>0)r.splice(h--,1);else{r.splice(a--,1);continue e}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let a=1;a<r.length;a++)r[a].pos<this.minStackPos&&(this.minStackPos=r[a].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,i,r){let n=e.pos,{parser:o}=this,a=_n?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let u=e.curContext&&e.curContext.tracker.strict,c=u?e.curContext.hash:0;for(let f=this.fragments.nodeAt(n);f;){let d=this.parser.nodeSet.types[f.type.id]==f.type?o.getGoto(e.state,f.type.id):-1;if(d>-1&&f.length&&(!u||(f.prop(Nn.NodeProp.contextHash)||0)==c))return e.useNode(f,d),_n&&console.log(a+this.stackID(e)+` (via reuse of ${o.getName(f.type.id)})`),!0;if(!(f instanceof Nn.Tree)||f.children.length==0||f.positions[0]>0)break;let m=f.children[0];if(m instanceof Nn.Tree&&f.positions[0]==0)f=m;else break}}let l=o.stateSlot(e.state,4);if(l>0)return e.reduce(l),_n&&console.log(a+this.stackID(e)+` (via always-reduce ${o.getName(l&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let h=this.tokens.getActions(e);for(let u=0;u<h.length;){let c=h[u++],f=h[u++],d=h[u++],m=u==h.length||!r,p=m?e:e.split(),v=this.tokens.mainToken;if(p.apply(c,f,v?v.start:p.pos,d),_n&&console.log(a+this.stackID(p)+` (via ${c&65536?`reduce of ${o.getName(c&65535)}`:"shift"} for ${o.getName(f)} @ ${n}${p==e?"":", split"})`),m)return!0;p.pos>n?i.push(p):r.push(p)}return!1}advanceFully(e,i){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return dk(e,i),!0}}runRecovery(e,i,r){let n=null,o=!1;for(let a=0;a<e.length;a++){let l=e[a],h=i[a<<1],u=i[(a<<1)+1],c=_n?this.stackID(l)+" -> ":"";if(l.deadEnd&&(o||(o=!0,l.restart(),_n&&console.log(c+this.stackID(l)+" (restarted)"),this.advanceFully(l,r))))continue;let f=l.split(),d=c;for(let m=0;f.forceReduce()&&m<10&&(_n&&console.log(d+this.stackID(f)+" (via force-reduce)"),!this.advanceFully(f,r));m++)_n&&(d=this.stackID(f)+" -> ");for(let m of l.recoverByInsert(h))_n&&console.log(c+this.stackID(m)+" (via recover-insert)"),this.advanceFully(m,r);this.stream.end>l.pos?(u==l.pos&&(u++,h=0),l.recoverByDelete(h,u),_n&&console.log(c+this.stackID(l)+` (via recover-delete ${this.parser.getName(h)})`),dk(l,r)):(!n||n.score<l.score)&&(n=l)}return n}stackToTree(e){return e.close(),Nn.Tree.build({buffer:Fw.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let i=(Dw||(Dw=new WeakMap)).get(e);return i||Dw.set(e,i=String.fromCodePoint(this.nextStackID++)),i+e}};function dk(t,e){for(let i=0;i<e.length;i++){let r=e[i];if(r.pos==t.pos&&r.sameState(t)){e[i].score<t.score&&(e[i]=t);return}}e.push(t)}var Gw=class{constructor(e,i,r){this.source=e,this.flags=i,this.disabled=r}allows(e){return!this.disabled||this.disabled[e]==0}},Iw=t=>t,Hw=class{constructor(e){this.start=e.start,this.shift=e.shift||Iw,this.reduce=e.reduce||Iw,this.reuse=e.reuse||Iw,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}},Ww=class t extends Nn.Parser{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let i=e.nodeNames.split(" ");this.minRepeatTerm=i.length;for(let l=0;l<e.repeatNodeCount;l++)i.push("");let r=Object.keys(e.topRules).map(l=>e.topRules[l][1]),n=[];for(let l=0;l<i.length;l++)n.push([]);function o(l,h,u){n[l].push([h,h.deserialize(String(u))])}if(e.nodeProps)for(let l of e.nodeProps){let h=l[0];typeof h=="string"&&(h=Nn.NodeProp[h]);for(let u=1;u<l.length;){let c=l[u++];if(c>=0)o(c,h,l[u++]);else{let f=l[u+-c];for(let d=-c;d>0;d--)o(l[u++],h,f);u++}}}this.nodeSet=new Nn.NodeSet(i.map((l,h)=>Nn.NodeType.define({name:h>=this.minRepeatTerm?void 0:l,id:h,props:n[h],top:r.indexOf(h)>-1,error:h==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(h)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=Nn.DefaultBufferLength;let a=ef(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(pk),this.states=ef(e.states,Uint32Array),this.data=ef(e.stateData),this.goto=ef(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(l=>typeof l=="number"?new ua(a,l):l),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,i,r){let n=new zw(this,e,i,r);for(let o of this.wrappers)n=o(n,e,i,r);return n}getGoto(e,i,r=!1){let n=this.goto;if(i>=n[0])return-1;for(let o=n[i+1];;){let a=n[o++],l=a&1,h=n[o++];if(l&&r)return h;for(let u=o+(a>>1);o<u;o++)if(n[o]==e)return h;if(l)return-1}}hasAction(e,i){let r=this.data;for(let n=0;n<2;n++)for(let o=this.stateSlot(e,n?2:1),a;;o+=3){if((a=r[o])==65535)if(r[o+1]==1)a=r[o=xo(r,o+2)];else{if(r[o+1]==2)return xo(r,o+2);break}if(a==i||a==0)return xo(r,o+1)}return 0}stateSlot(e,i){return this.states[e*6+i]}stateFlag(e,i){return(this.stateSlot(e,0)&i)>0}validAction(e,i){return!!this.allActions(e,r=>r==i?!0:null)}allActions(e,i){let r=this.stateSlot(e,4),n=r?i(r):void 0;for(let o=this.stateSlot(e,1);n==null;o+=3){if(this.data[o]==65535)if(this.data[o+1]==1)o=xo(this.data,o+2);else break;n=i(xo(this.data,o+1))}return n}nextStates(e){let i=[];for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=xo(this.data,r+2);else break;if(!(this.data[r+2]&1)){let n=this.data[r+1];i.some((o,a)=>a&1&&o==n)||i.push(this.data[r],n)}}return i}configure(e){let i=Object.assign(Object.create(t.prototype),this);if(e.props&&(i.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);i.top=r}return e.tokenizers&&(i.tokenizers=this.tokenizers.map(r=>{let n=e.tokenizers.find(o=>o.from==r);return n?n.to:r})),e.specializers&&(i.specializers=this.specializers.slice(),i.specializerSpecs=this.specializerSpecs.map((r,n)=>{let o=e.specializers.find(l=>l.from==r.external);if(!o)return r;let a=Object.assign(Object.assign({},r),{external:o.to});return i.specializers[n]=pk(a),a})),e.contextTracker&&(i.context=e.contextTracker),e.dialect&&(i.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(i.strict=e.strict),e.wrap&&(i.wrappers=i.wrappers.concat(e.wrap)),e.bufferLength!=null&&(i.bufferLength=e.bufferLength),i}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let i=this.dynamicPrecedences;return i==null?0:i[e]||0}parseDialect(e){let i=Object.keys(this.dialects),r=i.map(()=>!1);if(e)for(let o of e.split(" ")){let a=i.indexOf(o);a>=0&&(r[a]=!0)}let n=null;for(let o=0;o<i.length;o++)if(!r[o])for(let a=this.dialects[i[o]],l;(l=this.data[a++])!=65535;)(n||(n=new Uint8Array(this.maxTerm+1)))[l]=1;return new Gw(e,r,n)}static deserialize(e){return new t(e)}};function xo(t,e){return t[e]|t[e+1]<<16}function t7(t){let e=null;for(let i of t){let r=i.p.stoppedAt;(i.pos==i.p.stream.end||r!=null&&i.pos>r)&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i)}return e}function pk(t){if(t.external){let e=t.extend?1:0;return(i,r)=>t.external(i,r)<<1|e}return t.get}al.ContextTracker=Hw;al.ExternalTokenizer=Bw;al.InputStream=y0;al.LRParser=Ww;al.LocalTokenGroup=x0;al.Stack=v0});function i7(t,e=Uint16Array){if(typeof t!="string")return t;let i=null;for(let r=0,n=0;r<t.length;){let o=0;for(;;){let a=t.charCodeAt(r++),l=!1;if(a==126){o=65535;break}a>=92&&a--,a>=34&&a--;let h=a-32;if(h>=46&&(h-=46,l=!0),o+=h,l)break;o*=46}i?i[n++]=o:i=new e(o)}return i}function vk(t,e,i,r,n,o){let a=0,l=1<<r,{dialect:h}=i.p.parser;e:for(;l&t[a];){let u=t[a+1];for(let m=a+3;m<u;m+=2)if((t[m+1]&l)>0){let p=t[m];if(h.allows(p)&&(e.token.value==-1||e.token.value==p||r7(p,e.token.value,n,o))){e.acceptToken(p);break}}let c=e.next,f=0,d=t[a+2];if(e.next<0&&d>f&&t[u+d*3-3]==65535){a=t[u+d*3-1];continue e}for(;f<d;){let m=f+d>>1,p=u+m+(m<<1),v=t[p],g=t[p+1]||65536;if(c<v)d=m;else if(c>=g)f=m+1;else{a=t[p+2],e.advance();continue e}}break}}function gk(t,e,i){for(let r=e,n;(n=t[r])!=65535;r++)if(n==i)return r-e;return-1}function r7(t,e,i,r){let n=gk(i,r,e);return n<0||gk(i,r,t)<n}var jw,HSe,ll,qw,kr,WSe,Xw=tm(()=>{Gc();jw=class{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}},HSe=new jw,ll=class{constructor(e,i){this.data=e,this.id=i}token(e,i){let{parser:r}=i.p;vk(this.data,e,i,this.id,r.data,r.tokenPrecTable)}};ll.prototype.contextual=ll.prototype.fallback=ll.prototype.extend=!1;qw=class{constructor(e,i,r){this.precTable=i,this.elseToken=r,this.data=typeof e=="string"?i7(e):e}token(e,i){let r=e.pos,n=0;for(;;){let o=e.next<0,a=e.resolveOffset(1,1);if(vk(this.data,e,i,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(o||n++,a==null)break;e.reset(a,e.token)}n&&(e.reset(r,e.token),e.acceptToken(this.elseToken,n))}};qw.prototype.contextual=ll.prototype.fallback=ll.prototype.extend=!1;kr=class{constructor(e,i={}){this.token=e,this.contextual=!!i.contextual,this.fallback=!!i.fallback,this.extend=!!i.extend}};WSe=typeof process!="undefined"&&process.env&&/\bparse\b/.test(process.env.LOG)});var yk=oe((jSe,_k)=>{_k.exports={EndLine:1,ServerParamTextNoDQuote:2,ServerParamTextNoSQuote:3,ServerParamTextNoSpace:4,NumberParam:5,String:6,string:77,LineError:7,GeneralServerCommand:8,StartFunction:9,EndFunction:10,StartWhile:11,EndWhile:12,StartDialog:13,EndDialog:14,StartIf:15,EndIf:16,SCSet:17,SCUnset:18,SCCall:19,SCDialogInput:20,SCReportVariables:21,SCDialogInputDropdown:22,SCCallAndSave:23,SCMonitorCall:24,SCTimedCall:25,SCNoParam:26,SC1Param:27,SC2Params:28,SCCall1:29,GCodeParam:30,GCodeCodeLetter:31,gCodeIdentifier:78,Scope:32,Program:33,ServerLine:34,Function:36,ServerParameterList:37,ServerParameter:38,SQuote:39,CExpressionStart:40,CExpression:41,ParenOpen:42,Comma:43,ParenClose:44,Operator:45,Number:46,ScopeVar:47,Dot:48,Varname:49,CExpressionEnd:50,DQuote:51,While:52,ScopeVarParam:54,Function_params:56,OptScopeVar:57,DialogOption:58,OneToOne:59,GCodeLine:60,LineComment:64,NonGcodeLine:65,SimpleOperator:67}});var wk={};im(wk,{errorLine:()=>p7,gcodeNamePartClassification:()=>a7,generalServerCommand:()=>n7,newlines:()=>l7,quotedString:()=>f7,quotedstring:()=>d7,serverParamTextNoDQuote:()=>h7,serverParamTextNoSQuote:()=>u7,serverParamTextNoSpace:()=>c7,specializeScope:()=>o7});function n7(t,e){let i=t[0]===";"?t.substring(1):t;return xk[i]?xk[i]:he.GeneralServerCommand}function o7(t,e){return s7.includes(t)?he.Scope:(t.startsWith("ext_")||t.startsWith("bed_"))&&bk.test(t.substr(4))?he.Scope:t.startsWith("chamber_")&&bk.test(t.substr(8))?he.Scope:-1}function a7(t,e){return t.length===1?t[0]==="G"||t[0]==="g"||t[0]==="M"||t[0]==="m"?he.GCodeCodeLetter:he.GCodeParam:he.gCodeIdentifier}var he,xk,s7,bk,l7,h7,u7,b0,c7,f7,d7,p7,Sk=tm(()=>{Xw();he=hn(yk()),xk={"@func":he.StartFunction,"@deleteFunc":he.SCCall1,"@listFunctions":he.SCNoParam,"@callAndSave":he.SCCallAndSave,"@endfunc":he.EndFunction,"@while":he.StartWhile,"@endwhile":he.EndWhile,"@dialogStart":he.StartDialog,"@dialogShow":he.EndDialog,"@endif":he.EndIf,"@set":he.SCSet,"@unset":he.SCUnset,"@call":he.SCCall,"@execute":he.SCCall,"@quickCommand":he.SCCall1,"@wizardCommand":he.SCCall1,"@runButtonCommand":he.SCCall1,"@webAction":he.SCCall,"@dialogInputInt":he.SCDialogInput,"@dialogInputDouble":he.SCDialogInput,"@dialogInputString":he.SCDialogInput,"@dialogLabel":he.SCDialogInput,"@dialogInputCheckbox":he.SCDialogInput,"@dialogInputDropdown":he.SCDialogInputDropdown,"@reportVariables":he.SCReportVariables,"@if":he.StartIf,"@ifTimerBelow":he.StartIf,"@monitorCall":he.SCMonitorCall,"@timedCall":he.SCTimedCall,"@ifPaused":he.StartIf,"@outOfFilament":he.SC1Param,"@continue":he.SCNoParam,"@continueReheat":he.SCNoParam,"@stopPrint":he.SCNoParam,"@powerloss":he.SCNoParam,"@triggerRescue":he.SCNoParam,"@updatePrinterState":he.SCNoParam,"@isathome":he.SCNoParam,"@kill":he.SCNoParam,"@waitForAllTemperatures":he.SC1Param,"@cancelWaitForTemperatures":he.SCNoParam,"@event":he.SC2Params,"@make_snapshot":he.SC1Param,"@makeSnapshot":he.SC1Param,"@getip":he.SCNoParam,"@skip":he.SC1Param,"@adderror":he.SC1Param,"@addError":he.SC1Param,"@autostart_next_job":he.SCNoParam,"@autostartNextJob":he.SCNoParam,"@startNextPrintInQueue":he.SCNoParam,"@stop_next_autostart":he.SCNoParam,"@stopNextAutostart":he.SCNoParam,"@debugcon":he.SCNoParam,"@explaincom":he.SCNoParam,"@syncMotion":he.SCNoParam,"@nosize":he.SCNoParam,"@noSize":he.SCNoParam,"@size":he.SCNoParam,"@extruderColor":he.SC2Params,"@dialogIcon":he.SC1Param,"@dialogButton":he.SC2Param,"@dialogButtonNC":he.SC2Param,"@dialogBlocking":he.SCNoParam,"@dialogBlockingJob":he.SCNoParam,"@dialogHide":he.SC1Param,"@dialogHideAll":he.SCNoParam,"@reportTimer":he.SC1Param,"@setTimer":he.SC1Param,"@reloadLua":he.SCNoParam,"@resetStack":he.SCNoParam,"@reportStack":he.SCNoParam,"@debug":he.SC1Param,"@return":he.SC1Param,"@listMonitorCalls":he.SCNoParam,"@deleteTimedCall":he.SC1Param,"@callOnEvent":he.SC2Params,"@removeCallOnEvent":he.SC2Params,"@reportCallOnEvents":he.SCNoParam,"@printModelById":he.SC1Param,"@printModelByName":he.SC1Param,"@addDefaultWizard":he.SC2Params,"@listDefaultWizards":he.SCNoParam};s7=["global","local","deeplocal","perm","func","job","config","transfer","state","const","form","gperm","sglobal"],bk=/^\d+$/;l7=new kr((t,e)=>{if(t.next<0)t.acceptToken(he.EndLine);else if(!(t.next!==10&&t.next!==13)){for(t.advance();t.next===10||t.next===13||t.next===32||t.next===9;)t.advance();t.acceptToken(he.EndLine)}},{contextual:!0,fallback:!0}),h7=new kr((t,e)=>{let i=0,r="",n="";if(String.fromCharCode(t.next)!=='"')for(;;){let o=String.fromCharCode(t.next);if(t.next<0){i&&t.acceptToken(he.ServerParamTextNoDQuote);return}if(n+=o,o==='"'||o===`
`){i&&t.acceptToken(he.ServerParamTextNoDQuote);return}if(o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&t.acceptToken(he.ServerParamTextNoDQuote,-1);return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),u7=new kr((t,e)=>{let i=0,r="",n="";if(String.fromCharCode(t.next)!=="'")for(;;){let o=String.fromCharCode(t.next);if(n+=o,t.next<0){i&&t.acceptToken(he.ServerParamTextNoSQuote);return}if(o==="'"||o===`
`){i&&t.acceptToken(he.ServerParamTextNoSQuote);return}if(o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&t.acceptToken(he.ServerParamTextNoSQuote,-1);return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),b0=/^(?:nan|-?(?:(?:\d+|\d*\.\d*)(?:[E|e][+|-]?\d+)?|-?inf))$/,c7=new kr((t,e)=>{let i=0,r="",n="";if(!(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'"))for(;;){let o=String.fromCharCode(t.next);if(t.next<0){i&&(b0.test(n)?t.acceptToken(he.NumberParam):t.acceptToken(he.ServerParamTextNoSpace));return}if(o===" "||o===`
`){i&&(b0.test(n)?t.acceptToken(he.NumberParam):t.acceptToken(he.ServerParamTextNoSpace));return}if(n+=o,o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&(b0.test(n.substr(0,n.length-2))?t.acceptToken(he.NumberParam,-1):t.acceptToken(he.ServerParamTextNoSpace,-1));return}if(o==="}"&&r==="}"){i>1&&(b0.test(n.substr(0,n.length-2))?t.acceptToken(he.NumberParam,-1):t.acceptToken(he.ServerParamTextNoSpace,-1));return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),f7=new kr((t,e)=>{let i=-1;if(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'")i=t.next,t.advance();else return;for(;;){let r=String.fromCharCode(t.next);if(t.next<0)return;if(t.next===10){t.acceptToken(he.String);return}if(t.next===i){t.advance(),t.acceptToken(he.String);return}if(r==="\\"){t.advance(2);continue}t.advance()}},{contextual:!0,fallback:!0}),d7=new kr((t,e)=>{let i=-1;if(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'")i=t.next,t.advance();else return;for(;;){let r=String.fromCharCode(t.next);if(t.next<0)return;if(t.next===10){t.acceptToken(he.string);return}if(t.next===i){t.advance(),t.acceptToken(he.string);return}if(r==="\\"){t.advance(2);continue}t.advance()}},{contextual:!0,fallback:!0}),p7=new kr((t,e)=>{let i=!1;if(t.next===32)return-1;for(;;){let r=String.fromCharCode(t.next);if(t.next===10||t.next<0){i?t.acceptToken(he.LineError):t.acceptToken(-1);return}r!==" "&&(i=!0),t.advance()}},{contextual:!0,fallback:!0})});var Ak=oe(Tk=>{var{LRParser:m7}=Vw(),{newlines:g7,serverParamTextNoDQuote:v7,serverParamTextNoSQuote:_7,serverParamTextNoSpace:y7,quotedString:x7,quotedstring:b7,errorLine:w7,generalServerCommand:Ck,gcodeNamePartClassification:Ek,specializeScope:Mk}=(Sk(),MT(wk));Tk.parser=m7.deserialize({version:14,states:"7dQVQ#tOOO!pQ'[O'#DPO!xQ#|O'#DbO#ZQ#}O'#DcO!xQ#|O'#DeOOQP'#DO'#DOO#bQ&rO'#DOO#bQ&rO'#DOO!pQ'[O'#DOO!pQ'[O'#DOO!pQ'[O'#DOO#iQ&jO'#DOO!xQ#|O'#DOO!xQ#|O'#DOO!xQ#|O'#DOO!xQ#|O'#DOO#nQ%XO'#DOO!xQ#|O'#DOO!xQ#|O'#DOO#ZQ#}O'#DOO#vQ#tO'#DkOOQP'#EZ'#EZO#{Q$UO'#EZO$WQ#uO'#DjOOQa'#Dp'#DpO$zQ&{O'#DoO%RQ#uO'#EPOOQO'#Dr'#DrQVQ#tOOOOQ#]'#DQ'#DQO#ZQ#}O,59kO%lQ-WO'#ESO%sQ#xO'#ERO&OQ#vO'#EXOOQ#]'#EY'#EYOOQ#]'#DS'#DSO&ZQ%XO,59|OOQX'#Ds'#DsO&cQ#}O'#DRO&jQ#uO,59}O&oQ%XO,5:PO&wQ7[O'#DdOOQ!k'#Dd'#DdO!xQ#|O,59jO&|Q%XO,59jO#ZQ#}O'#DfOOQP,59j,59jO#bQ&rO,59jO'UQ&rO,59jO'UQ&rO,59jO!xQ#|O,59jO!xQ#|O,59jOOQP,5:V,5:VOOQa'#D['#D[OOQP,5:u,5:uO'`Q#tO'#DlOOQP'#Dm'#DmOOQP'#E['#E[O'eQ$UO'#E[OOQP'#Dx'#DxO'pQ#uO,5:UOOQP,5:U,5:UOOQ#m'#D_'#D_OOQa'#Dy'#DyO(RQ&{O,5:ZOOQO,5:k,5:kOOQO-E7p-E7pO(YQ#uO1G/VO(_Q7[O'#D]OOQO'#EV'#EVO(dQ7[O,5:nOOQO'#EU'#EUO%WQ-WO'#ETOOQO'#ET'#ETO(lQ#tO'#DVOOQO'#DV'#DVOOQ#s,5:n,5:nOOQS'#Dt'#DtO(qQ#xO,5:mOOQ#],5:m,5:mOOQQ'#Dv'#DvO(|Q#vO,5:sOOQ#],5:s,5:sO)XQ#tO1G/hO)`Q#uO1G/hOOQX-E7q-E7qO)eQ#tO1G/iO)lQ#tO1G/kO)sQ#uO1G/kO)xQ&jO,5:OO)}Q%XO1G/UOOQP1G/U1G/UOOQP,5:Q,5:QO#ZQ#}O1G/UO*VQ7[O'#DgOOQy'#Dg'#DgO*[Q']O1G/UO!xQ#|O1G/UO!xQ#|O1G/UO!pQ'[O1G/UOOQP,5:W,5:WOOQP,5:v,5:vOOQP-E7v-E7vOOQP1G/p1G/pOOQa-E7w-E7wO*gQ#tO7+$qO)xQ&jO,59wO%WQ-WO,5:pOOQ#s1G0Y1G0YO*nQ7[O,5:oO*vQ-WO,59qOOQS-E7r-E7rOOQ#]1G0X1G0XOOQQ-E7t-E7tOOQ#]1G0_1G0_O+QQ%XO7+%SO+YQ#tO7+%SO+YQ#tO7+%SO+aQ&sO7+%TO+kQ#tO7+%TO+rQ%XO7+%VO+zQ#tO7+%VO+zQ#tO7+%VOOQ!k1G/j1G/jOOQP7+$p7+$pO)xQ&jO,5:RO,RQ#tO'#DhOOQq'#Dw'#DwO,WQ']O7+$pO,WQ']O7+$pO!pQ'[O7+$pO,cQ%XO7+$pOOQP<<H]<<H]O,kQ#tO<<H]OOQO1G/c1G/cOOQO1G0[1G0[OOQO1G0Z1G0ZO%WQ-WO'#DuO,rQ#tO1G/]O,zQ7[O1G/]OOQO1G/]1G/]OOQP<<Hn<<HnO-VQ%XO<<HnO-_Q#tO<<HnOOQP<<Ho<<HoO-fQ&sO<<HoOOQP<<Hq<<HqO-pQ%XO<<HqO-xQ#tO<<HqOOQy1G/m1G/mO.PQ$UO,5:SOOQq-E7u-E7uO.[Q']O<<H[O!pQ'[O<<H[OOQP<<H[<<H[OOQPAN=wAN=wO.gQ7[O,5:aOOQO-E7s-E7sOOQO7+$w7+$wO.rQ#tO7+$wOOQPAN>YAN>YO.zQ%XOAN>YOOQPAN>ZAN>ZOOQPAN>]AN>]O/SQ%XOAN>]O/[Q#tO1G/nO/aQ%XOAN=vOOQO<<Hc<<HcOOQPG23tG23tOOQPG23wG23wOOQq7+%Y7+%YOOQPG23bG23b",stateData:"/i~O!rOS~OWcOXPOZQO]RO_SOaUObVOcWOd[OeZOf]OgYOh^Oi_Oj`OkaOlbOmXOnfOodO!]jO!bjO!phO~O!omO!tmO~OSrOTrOwpOxoO!TqO~OPuP~P!xOpyO~P!xOp|O~OV!OOPrX~O!z!UO~OU!WOxoO!z!VO~On![Oo!XO!b!_O!p!YOP!^X~OU!aOxoO!e!aO!t!`O!z!VO~OP!cX~P$iOP!cO~OU!gOp!fOz!jO!omO!tmO!z!VO~O!S!nO~P%WOR!oOw!qOxoO~OQ!rOxoO!T!tO~OP!uOV!vO~OPuX~P!xOP!xO~OP!yOV!zO~O!Q!{O~OV!}OPra~Op#QO!t!`O~P!xO!z#WO~OU#XOxoO!z!VO~On![Oo!XO!b#ZO!p!YOP!^a~OP!ca~P$iOP#]O~O!Q#^O~O}#_O!S#`O~Oz#bO~OR!oOw#dOxoO~OQ!rOxoO!T#fO~O[#gO~PVOP#iO~O^#jO~PVO`#lO~PVOP#nO~O!t!`O~OV#pOPri~O!Q#qO~O!omO!tmOPri~OY#xO~PVO|#|O}#_O~O{#}O|$QO~P%WOV$ROP!Uq~O[$SO~PVOpyOP!Vq~P!xO^$VO~PVOV$WOP!Xq~O`$XO~PVOz$[O~O!omO!tmOPrq~OV$`OPrq~OY$aO~PVO{#}O|$dO~O{#}O|$dO}#_O~OV$fOP!Uy~O[$gO~PVOpyOP!Vy~P!xOV$iOP!Xy~O`$jO~PVOU$kOxoO!z!VO~O!omO!tmOPry~O}#_O{!ia|!ia~O{#}O|$mO~OV$nOP!U!R~OV$oOP!X!R~O|$pO~OV$qOPr!R~O",goto:"-h#PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP#Q#b#r$f$uPP&RPPPP&b&vP&}PP#b#b'`#b'o'r'xP#Q(O(`(`P#Q(dP(t)d)n)t*O*U*`*fPPPPP*lP*|+j,m,t,{P*|*|-S-dmjOl!u!x!y#]#h#i#k#m#n#y$T$YmTOl!u!x!y#]#h#i#k#m#n#y$T$YQnPQ|XQ}WQ!PYY!lo!j#_#b#}W#r#S#t#u$^Q#w#VQ$_#vR$l$_QwRQ!OcQ!enQ#O}R#p#PQtQ[uRcnv}#PQxSYzUV!P#j$VQ{bQ|aQ!Q[Q!R]Q!S^Q!T_Q!|{S#R!Q!RQ#U!SQ#V!TQ#u#TR#v#UQ!hoQ#a!jQ#{#_Q$P#bR$b#}Q!WfS!ai!bY!go!j#_#b#}Q#X![R$k$[Z!go!j#_#b#}S!ai!bS#R!Q!RQ#o!{Q#z#^R$Z#qQ{UQ|VQ#P!PQ$U#jR$h$VR!OWQ#S!QR#T!RX#s#S#t#u$^meOl!u!x!y#]#h#i#k#m#n#y$T$YT!Zg!^miOl!u!x!y#]#h#i#k#m#n#y$T$YQlO^!dl#h#k#m#y$T$YQ#h!uQ#k!xQ#m!yQ#y#]Q$T#iR$Y#nYvRcn}#PR!wvQ!ppR#c!pQ$O#bS$c$O$eR$e$PQ!sqR#e!sQ#t#SS$]#t$^R$^#uQ!^gR#Y!^Q!biR#[!bmkOl!u!x!y#]#h#i#k#m#n#y$T$Y!VsQRSUV[]^_abcnv{}!P!Q!R!S!T#P#T#U#j$V!UrQRSUV[]^_abcnv{}!P!Q!R!S!T#P#T#U#j$VQ!WfS!ai!bS!op!pS!rq!sQ#X![R$k$[Z!mo!j#_#b#}Z!ko!j#_#b#}Z!io!j#_#b#}mgOl!u!x!y#]#h#i#k#m#n#y$T$YT!]g!^",nodeNames:"\u26A0 EndLine ServerParamTextNoDQuote ServerParamTextNoSQuote ServerParamTextNoSpace NumberParam String LineError GeneralServerCommand StartFunction EndFunction StartWhile EndWhile StartDialog EndDialog StartIf EndIf SCSet SCUnset SCCall SCDialogInput SCReportVariables SCDialogInputDropdown SCCallAndSave SCMonitorCall SCTimedCall SCNoParam SC1Param SC2Params SCCall1 GCodeParam GCodeCodeLetter Scope Program ServerLine Function Function ServerParameterList ServerParameter SQuote CExpressionStart CExpression ParenOpen Comma ParenClose Operator Number ScopeVar Dot Varname CExpressionEnd DQuote While Dialog ScopeVarParam If Function_params OptScopeVar DialogOption OneToOne GCodeLine GCodeCode GCodeCode GCodeIdentifier LineComment NonGcodeLine NonGCodeFunction SimpleOperator",maxTerm:94,nodeProps:[["closedBy",9,"EndFunction",11,"EndWhile",13,"EndDialog",15,"EndIf",40,"CExpressionEnd",42,"ParenClose"],["openedBy",10,"StartFunction",12,"StartWhile",14,"StartDialog",16,"StartIf",44,"ParenOpen",50,"CExpressionStart"]],skippedNodes:[0],repeatNodeCount:8,tokenData:"+w~RqXY#Ypq#Yqr#ers#rst#wtu$`vw%Twx%]xy%byz%iz{%p{|%w|}'_}!O%w!O!P'd!P!Q%p!Q![&|!]!^'t!^!_*X!_!`#e!`!a*X!b!c(z!c!}*c!}#O+S#P#Q+S#R#S*c#T#o*c#o#p+X#p#q+d#q#r+l$g;'S$`;'S;=`$}<%lO$`~#_Q!r~XY#Ypq#YY#jP!eQ!_!`#mW#rO}W~#wO!T~~#|S!]~OY#wZ;'S#w;'S;=`$Y<%lO#w~$]P;=`<%l#wU$eW!tUtu$`!Q![$`!c!}$`#R#S$`#T#o$`$g;'S$`;'S;=`$}<%lO$`U%QP;=`<%l$`Y%YP!eQvw#m~%bOw~V%iOzT!eQ_%pO|]!eQY%wO}W!eQ_%|Q}W!O!P&S!Q![&|V&XR!zV!Q![&S!g!h&b#X#Y&bV&eR{|&n}!O&n!Q![&tV&qP!Q![&tV&yP!zV!Q![&tV'RS!zV!O!P&S!Q![&|!g!h&b#X#Y&b~'dO{~_'kR!QW!zV!Q![&S!g!h&b#X#Y&b~'wVOY(^YZ(uZ!b(^!b!c(z!c;'S(^;'S;=`(o<%lO(^~(cS!b~OY(^Z;'S(^;'S;=`(o<%lO(^~(rP;=`<%l(^~(zO!b~~(}Vtu)d!c!})d#R#S)d#T#o)d$g;'S)d;'S;=`*R<%lO)d~)iW#P~tu)d!Q![)d!c!})d#R#S)d#T#o)d$g;'S)d;'S;=`*R<%lO)d~*UP;=`<%l)dY*`P}W!eQ!_!`#mV*jW#QP!tUtu$`!Q![$`!c!}*c#R#S*c#T#o*c$g;'S$`;'S;=`$}<%lO$`Q+XO!eQ~+[P#o#p+_~+dOx~Y+iP!eQ#p#q#m~+oP#q#r+r~+wO!S~",tokenizers:[g7,v7,_7,y7,x7,b7,w7,0,1,2,3],topRules:{Program:[0,33]},specialized:[{term:93,get:(t,e)=>Ck(t,e)<<1,external:Ck},{term:94,get:(t,e)=>Ek(t,e)<<1,external:Ek},{term:82,get:(t,e)=>Mk(t,e)<<1,external:Mk}],tokenPrec:0})});var Yk=oe((lCe,Xk)=>{Xk.exports={EndLine:1,RemainingLine:2,Special:3,GCodeLine:4,Section:5,Comment:6,ConfigOption:7,EmptyLine:8,Program:9}});var Zk={};im(Zk,{gcodeLine:()=>nj,newlines:()=>tj,remainingLine:()=>rj,special:()=>ij});var Ai,tj,ij,rj,nj,Kk=tm(()=>{Xw();Ai=hn(Yk()),tj=new kr((t,e)=>{if(t.next<0)t.acceptToken(Ai.EndLine);else if(!(t.next!==10&&t.next!==13)){for(t.advance();t.next===10||t.next===13;)t.advance();t.acceptToken(Ai.EndLine)}},{contextual:!0,fallback:!0}),ij=new kr((t,e)=>{let i=!1;for(;;){let r=String.fromCharCode(t.next);if(t.next<0||"!^~".indexOf(r)===-1){i?t.acceptToken(Ai.Special):t.acceptToken(-1);return}i=!0,t.advance()}},{contextual:!0,fallback:!0}),rj=new kr((t,e)=>{let i=!1;for(;;){let r=String.fromCharCode(t.next);if(t.next===10||t.next<0||"!^~#".indexOf(r)!==-1){i?t.acceptToken(Ai.RemainingLine):t.acceptToken(-1);return}i=!0,t.advance()}},{contextual:!0,fallback:!0}),nj=new kr((t,e)=>{let i=!1,r=!1,n=Ai.EmptyLine,o=0;for(;;){let a=String.fromCharCode(t.next);if(t.next===10||t.next<0){t.acceptToken(o?n:-1);return}if(!i&&a==="["&&(n=Ai.Section),!i&&a==="#"&&(n=Ai.Comment),i&&(a===" "||t.next===9)&&(r=!0),!i&&a===":"&&(n=Ai.ConfigOption),i&&!r&&a===":"&&(n===Ai.EmptyLine||n===Ai.GCodeLine)){t.acceptToken(Ai.ConfigOption);return}if(i&&a==="#"){t.acceptToken(n);return}a!==" "&&t.next!==9&&(!i&&n===Ai.EmptyLine&&(n=Ai.GCodeLine),i=!0),t.advance(),o++}},{contextual:!0,fallback:!0})});var Jk=oe(Qk=>{var{LRParser:sj}=Vw(),{newlines:oj,remainingLine:aj,special:lj,gcodeLine:hj}=(Kk(),MT(Zk));Qk.parser=sj.deserialize({version:14,states:"!|QQOWOOOcOPO'#CiOhOXO'#CiOpO_O'#CiOOOW'#Cf'#CfQQOWOOOOOW,59T,59TO!OOPO,59TOOO_'#Cg'#CgO!TO_O,59TOOOW-E6d-E6dOOOW1G.o1G.oOOO_-E6e-E6eO!cOPO1G.oOOOW7+$Z7+$Z",stateData:"!h~OSQOTQOUPOVROWPO~OPUO~OPUOUVO~OPUOQWORWOUVO~OPZO~OPZOQWORWOU]O~OP^O~O",goto:"o^PPPPPPPPPP_ePkQTORYTQXRR[XTSOT",nodeNames:"\u26A0 EndLine RemainingLine Special GCodeLine Section Comment ConfigOption EmptyLine Program",maxTerm:13,skippedNodes:[0],repeatNodeCount:2,tokenData:"RORO",tokenizers:[oj,aj,lj,hj],topRules:{Program:[0,9]},tokenPrec:0})});var ZF=oe((B1,YF)=>{YF.exports=F1(typeof Buffer!="undefined"&&Buffer)||F1(B1.Buffer)||F1(typeof window!="undefined"&&window.Buffer)||B1.Buffer;function F1(t){return t&&t.isBuffer&&t}});var av=oe((YTe,KF)=>{var Dq={}.toString;KF.exports=Array.isArray||function(t){return Dq.call(t)=="[object Array]"}});var $F=oe((Fh,JF)=>{var kh=bn(),Fh=JF.exports=QF(0);Fh.alloc=QF;Fh.concat=kh.concat;Fh.from=Iq;function QF(t){return new Array(t)}function Iq(t){if(!kh.isBuffer(t)&&kh.isView(t))t=kh.Uint8Array.from(t);else if(kh.isArrayBuffer(t))t=new Uint8Array(t);else{if(typeof t=="string")return kh.from.call(Fh,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(t)}});var iB=oe((Nh,tB)=>{var So=bn(),Bh=So.global,Nh=tB.exports=So.hasBuffer?eB(0):[];Nh.alloc=So.hasBuffer&&Bh.alloc||eB;Nh.concat=So.concat;Nh.from=kq;function eB(t){return new Bh(t)}function kq(t){if(!So.isBuffer(t)&&So.isView(t))t=So.Uint8Array.from(t);else if(So.isArrayBuffer(t))t=new Uint8Array(t);else{if(typeof t=="string")return So.from.call(Nh,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return Bh.from&&Bh.from.length!==1?Bh.from(t):new Bh(t)}});var sB=oe((Uh,nB)=>{var lv=bn(),Uh=nB.exports=lv.hasArrayBuffer?rB(0):[];Uh.alloc=rB;Uh.concat=lv.concat;Uh.from=Fq;function rB(t){return new Uint8Array(t)}function Fq(t){if(lv.isView(t)){var e=t.byteOffset,i=t.byteLength;t=t.buffer,t.byteLength!==i&&(t.slice?t=t.slice(e,e+i):(t=new Uint8Array(t),t.byteLength!==i&&(t=Array.prototype.slice.call(t,e,e+i))))}else{if(typeof t=="string")return lv.from.call(Uh,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return new Uint8Array(t)}});var oB=oe(hv=>{hv.copy=Uq;hv.toString=Nq;hv.write=Bq;function Bq(t,e){for(var i=this,r=e||(e|=0),n=t.length,o=0,a=0;a<n;)o=t.charCodeAt(a++),o<128?i[r++]=o:o<2048?(i[r++]=192|o>>>6,i[r++]=128|o&63):o<55296||o>57343?(i[r++]=224|o>>>12,i[r++]=128|o>>>6&63,i[r++]=128|o&63):(o=(o-55296<<10|t.charCodeAt(a++)-56320)+65536,i[r++]=240|o>>>18,i[r++]=128|o>>>12&63,i[r++]=128|o>>>6&63,i[r++]=128|o&63);return r-e}function Nq(t,e,i){var r=this,n=e|0;i||(i=r.length);for(var o="",a=0;n<i;){if(a=r[n++],a<128){o+=String.fromCharCode(a);continue}(a&224)===192?a=(a&31)<<6|r[n++]&63:(a&240)===224?a=(a&15)<<12|(r[n++]&63)<<6|r[n++]&63:(a&248)===240&&(a=(a&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63),a>=65536?(a-=65536,o+=String.fromCharCode((a>>>10)+55296,(a&1023)+56320)):o+=String.fromCharCode(a)}return o}function Uq(t,e,i,r){var n;i||(i=0),!r&&r!==0&&(r=this.length),e||(e=0);var o=r-i;if(t===this&&i<e&&e<r)for(n=o-1;n>=0;n--)t[n+e]=this[n+i];else for(n=0;n<o;n++)t[n+e]=this[n+i];return o}});var uv=oe(_f=>{var N1=oB();_f.copy=uB;_f.slice=cB;_f.toString=zq;_f.write=Gq("write");var va=bn(),aB=va.global,lB=va.hasBuffer&&"TYPED_ARRAY_SUPPORT"in aB,hB=lB&&!aB.TYPED_ARRAY_SUPPORT;function uB(t,e,i,r){var n=va.isBuffer(this),o=va.isBuffer(t);if(n&&o)return this.copy(t,e,i,r);if(!hB&&!n&&!o&&va.isView(this)&&va.isView(t)){var a=i||r!=null?cB.call(this,i,r):this;return t.set(a,e),a.length}else return N1.copy.call(this,t,e,i,r)}function cB(t,e){var i=this.slice||!hB&&this.subarray;if(i)return i.call(this,t,e);var r=va.alloc.call(this,e-t);return uB.call(this,r,0,t,e),r}function zq(t,e,i){var r=!lB&&va.isBuffer(this)?this.toString:N1.toString;return r.apply(this,arguments)}function Gq(t){return e;function e(){var i=this[t]||N1[t];return i.apply(this,arguments)}}});var bn=oe(wr=>{var U1=wr.global=ZF(),mB=wr.hasBuffer=U1&&!!U1.isBuffer,G1=wr.hasArrayBuffer=typeof ArrayBuffer!="undefined",Hq=wr.isArray=av();wr.isArrayBuffer=G1?Yq:W1;var Wq=wr.isBuffer=mB?U1.isBuffer:W1,Vq=wr.isView=G1?ArrayBuffer.isView||vB("ArrayBuffer","buffer"):W1;wr.alloc=H1;wr.concat=qq;wr.from=jq;var fB=wr.Array=$F(),dB=wr.Buffer=iB(),pB=wr.Uint8Array=sB(),z1=wr.prototype=uv();function jq(t){return typeof t=="string"?Zq.call(this,t):gB(this).from(t)}function H1(t){return gB(this).alloc(t)}function qq(t,e){e||(e=0,Array.prototype.forEach.call(t,o));var i=this!==wr&&this||t[0],r=H1.call(i,e),n=0;return Array.prototype.forEach.call(t,a),r;function o(l){e+=l.length}function a(l){n+=z1.copy.call(l,r,n)}}var Xq=vB("ArrayBuffer");function Yq(t){return t instanceof ArrayBuffer||Xq(t)}function Zq(t){var e=t.length*3,i=H1.call(this,e),r=z1.write.call(i,t);return e!==r&&(i=z1.slice.call(i,0,r)),i}function gB(t){return Wq(t)?dB:Vq(t)?pB:Hq(t)?fB:mB?dB:G1?pB:fB}function W1(){return!1}function vB(t,e){return t="[object "+t+"]",function(i){return i!=null&&{}.toString.call(e?i[e]:i)===t}}});var cv=oe(_B=>{_B.ExtBuffer=V1;var Kq=bn();function V1(t,e){if(!(this instanceof V1))return new V1(t,e);this.buffer=Kq.from(t),this.type=e}});var xB=oe(yB=>{yB.setExtPackers=$q;var fv=bn(),Qq=fv.global,ps=fv.Uint8Array.from,j1,Jq={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function $q(t){t.addExtPacker(14,Error,[ul,zn]),t.addExtPacker(1,EvalError,[ul,zn]),t.addExtPacker(2,RangeError,[ul,zn]),t.addExtPacker(3,ReferenceError,[ul,zn]),t.addExtPacker(4,SyntaxError,[ul,zn]),t.addExtPacker(5,TypeError,[ul,zn]),t.addExtPacker(6,URIError,[ul,zn]),t.addExtPacker(10,RegExp,[eX,zn]),t.addExtPacker(11,Boolean,[q1,zn]),t.addExtPacker(12,String,[q1,zn]),t.addExtPacker(13,Date,[Number,zn]),t.addExtPacker(15,Number,[q1,zn]),typeof Uint8Array!="undefined"&&(t.addExtPacker(17,Int8Array,ps),t.addExtPacker(18,Uint8Array,ps),t.addExtPacker(19,Int16Array,ps),t.addExtPacker(20,Uint16Array,ps),t.addExtPacker(21,Int32Array,ps),t.addExtPacker(22,Uint32Array,ps),t.addExtPacker(23,Float32Array,ps),typeof Float64Array!="undefined"&&t.addExtPacker(24,Float64Array,ps),typeof Uint8ClampedArray!="undefined"&&t.addExtPacker(25,Uint8ClampedArray,ps),t.addExtPacker(26,ArrayBuffer,ps),t.addExtPacker(29,DataView,ps)),fv.hasBuffer&&t.addExtPacker(27,Qq,fv.from)}function zn(t){return j1||(j1=X1().encode),j1(t)}function q1(t){return t.valueOf()}function eX(t){t=RegExp.prototype.toString.call(t).split("/"),t.shift();var e=[t.pop()];return e.unshift(t.join("/")),e}function ul(t){var e={};for(var i in Jq)e[i]=t[i];return e}});var dv=oe(yf=>{var tX,iX,rX,nX;(function(t){var e="undefined",i=e!==typeof Buffer&&Buffer,r=e!==typeof Uint8Array&&Uint8Array,n=e!==typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],a=Array.isArray||S,l=4294967296,h=16777216,u;tX=c("Uint64BE",!0,!0),iX=c("Int64BE",!0,!1),rX=c("Uint64LE",!1,!0),nX=c("Int64LE",!1,!1);function c(w,M,C){var E=M?0:4,P=M?4:0,A=M?0:3,R=M?1:2,k=M?2:1,I=M?3:0,L=M?_:b,T=M?x:y,O=B.prototype,D="is"+w,F="_"+D;return O.buffer=void 0,O.offset=0,O[F]=!0,O.toNumber=re,O.toString=N,O.toJSON=re,O.toArray=f,i&&(O.toBuffer=d),r&&(O.toArrayBuffer=m),B[D]=U,t[w]=B,B;function B(Z,ne,K,ae){return this instanceof B?G(this,Z,ne,K,ae):new B(Z,ne,K,ae)}function U(Z){return!!(Z&&Z[F])}function G(Z,ne,K,ae,ue){if(r&&n&&(ne instanceof n&&(ne=new r(ne)),ae instanceof n&&(ae=new r(ae))),!ne&&!K&&!ae&&!u){Z.buffer=g(o,0);return}if(!p(ne,K)){var _e=u||Array;ue=K,ae=ne,K=0,ne=new _e(8)}Z.buffer=ne,Z.offset=K|=0,e!==typeof ae&&(typeof ae=="string"?Y(ne,K,ae,ue||10):p(ae,ue)?v(ne,K,ae,ue):typeof ue=="number"?(z(ne,K+E,ae),z(ne,K+P,ue)):ae>0?L(ne,K,ae):ae<0?T(ne,K,ae):v(ne,K,o,0))}function Y(Z,ne,K,ae){var ue=0,_e=K.length,Re=0,Le=0;K[0]==="-"&&ue++;for(var Et=ue;ue<_e;){var it=parseInt(K[ue++],ae);if(!(it>=0))break;Le=Le*ae+it,Re=Re*ae+Math.floor(Le/l),Le%=l}Et&&(Re=~Re,Le?Le=l-Le:Re++),z(Z,ne+E,Re),z(Z,ne+P,Le)}function re(){var Z=this.buffer,ne=this.offset,K=ie(Z,ne+E),ae=ie(Z,ne+P);return C||(K|=0),K?K*l+ae:ae}function N(Z){var ne=this.buffer,K=this.offset,ae=ie(ne,K+E),ue=ie(ne,K+P),_e="",Re=!C&&ae&2147483648;for(Re&&(ae=~ae,ue=l-ue),Z=Z||10;;){var Le=ae%Z*l+ue;if(ae=Math.floor(ae/Z),ue=Math.floor(Le/Z),_e=(Le%Z).toString(Z)+_e,!ae&&!ue)break}return Re&&(_e="-"+_e),_e}function z(Z,ne,K){Z[ne+I]=K&255,K=K>>8,Z[ne+k]=K&255,K=K>>8,Z[ne+R]=K&255,K=K>>8,Z[ne+A]=K&255}function ie(Z,ne){return Z[ne+A]*h+(Z[ne+R]<<16)+(Z[ne+k]<<8)+Z[ne+I]}}function f(w){var M=this.buffer,C=this.offset;return u=null,w!==!1&&C===0&&M.length===8&&a(M)?M:g(M,C)}function d(w){var M=this.buffer,C=this.offset;if(u=i,w!==!1&&C===0&&M.length===8&&Buffer.isBuffer(M))return M;var E=new i(8);return v(E,0,M,C),E}function m(w){var M=this.buffer,C=this.offset,E=M.buffer;if(u=r,w!==!1&&C===0&&E instanceof n&&E.byteLength===8)return E;var P=new r(8);return v(P,0,M,C),P.buffer}function p(w,M){var C=w&&w.length;return M|=0,C&&M+8<=C&&typeof w[M]!="string"}function v(w,M,C,E){M|=0,E|=0;for(var P=0;P<8;P++)w[M++]=C[E++]&255}function g(w,M){return Array.prototype.slice.call(w,M,M+8)}function _(w,M,C){for(var E=M+8;E>M;)w[--E]=C&255,C/=256}function x(w,M,C){var E=M+8;for(C++;E>M;)w[--E]=-C&255^255,C/=256}function b(w,M,C){for(var E=M+8;M<E;)w[M++]=C&255,C/=256}function y(w,M,C){var E=M+8;for(C++;M<E;)w[M++]=-C&255^255,C/=256}function S(w){return!!w&&Object.prototype.toString.call(w)=="[object Array]"}})(typeof yf=="object"&&typeof yf.nodeName!="string"?yf:yf||{})});var Z1=oe(Y1=>{Y1.read=function(t,e,i,r,n){var o,a,l=n*8-r-1,h=(1<<l)-1,u=h>>1,c=-7,f=i?n-1:0,d=i?-1:1,m=t[e+f];for(f+=d,o=m&(1<<-c)-1,m>>=-c,c+=l;c>0;o=o*256+t[e+f],f+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=a*256+t[e+f],f+=d,c-=8);if(o===0)o=1-u;else{if(o===h)return a?NaN:(m?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-u}return(m?-1:1)*a*Math.pow(2,o-r)};Y1.write=function(t,e,i,r,n,o){var a,l,h,u=o*8-n-1,c=(1<<u)-1,f=c>>1,d=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:o-1,p=r?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+f>=1?e+=d/h:e+=d*Math.pow(2,1-f),e*h>=2&&(a++,h/=2),a+f>=c?(l=0,a=c):a+f>=1?(l=(e*h-1)*Math.pow(2,n),a=a+f):(l=e*Math.pow(2,f-1)*Math.pow(2,n),a=0));n>=8;t[i+m]=l&255,m+=p,l/=256,n-=8);for(a=a<<n|l,u+=n;u>0;t[i+m]=a&255,m+=p,a/=256,u-=8);t[i+m-p]|=v*128}});var K1=oe(bB=>{var sX=bB.uint8=new Array(256);for(xf=0;xf<=255;xf++)sX[xf]=oX(xf);var xf;function oX(t){return function(e){var i=e.reserve(1);e.buffer[i]=t}}});var OB=oe(LB=>{var SB=Z1(),CB=dv(),aX=CB.Uint64BE,lX=CB.Int64BE,EB=K1().uint8,pv=bn(),ci=pv.global,hX=pv.hasBuffer&&"TYPED_ARRAY_SUPPORT"in ci,uX=hX&&!ci.TYPED_ARRAY_SUPPORT,wB=pv.hasBuffer&&ci.prototype||{};LB.getWriteToken=cX;function cX(t){return t&&t.uint8array?fX():uX||pv.hasBuffer&&t&&t.safe?dX():MB()}function fX(){var t=MB();return t[202]=Yt(202,4,PB),t[203]=Yt(203,8,RB),t}function MB(){var t=EB.slice();return t[196]=bf(196),t[197]=cl(197),t[198]=fl(198),t[199]=bf(199),t[200]=cl(200),t[201]=fl(201),t[202]=Yt(202,4,wB.writeFloatBE||PB,!0),t[203]=Yt(203,8,wB.writeDoubleBE||RB,!0),t[204]=bf(204),t[205]=cl(205),t[206]=fl(206),t[207]=Yt(207,8,TB),t[208]=bf(208),t[209]=cl(209),t[210]=fl(210),t[211]=Yt(211,8,AB),t[217]=bf(217),t[218]=cl(218),t[219]=fl(219),t[220]=cl(220),t[221]=fl(221),t[222]=cl(222),t[223]=fl(223),t}function dX(){var t=EB.slice();return t[196]=Yt(196,1,ci.prototype.writeUInt8),t[197]=Yt(197,2,ci.prototype.writeUInt16BE),t[198]=Yt(198,4,ci.prototype.writeUInt32BE),t[199]=Yt(199,1,ci.prototype.writeUInt8),t[200]=Yt(200,2,ci.prototype.writeUInt16BE),t[201]=Yt(201,4,ci.prototype.writeUInt32BE),t[202]=Yt(202,4,ci.prototype.writeFloatBE),t[203]=Yt(203,8,ci.prototype.writeDoubleBE),t[204]=Yt(204,1,ci.prototype.writeUInt8),t[205]=Yt(205,2,ci.prototype.writeUInt16BE),t[206]=Yt(206,4,ci.prototype.writeUInt32BE),t[207]=Yt(207,8,TB),t[208]=Yt(208,1,ci.prototype.writeInt8),t[209]=Yt(209,2,ci.prototype.writeInt16BE),t[210]=Yt(210,4,ci.prototype.writeInt32BE),t[211]=Yt(211,8,AB),t[217]=Yt(217,1,ci.prototype.writeUInt8),t[218]=Yt(218,2,ci.prototype.writeUInt16BE),t[219]=Yt(219,4,ci.prototype.writeUInt32BE),t[220]=Yt(220,2,ci.prototype.writeUInt16BE),t[221]=Yt(221,4,ci.prototype.writeUInt32BE),t[222]=Yt(222,2,ci.prototype.writeUInt16BE),t[223]=Yt(223,4,ci.prototype.writeUInt32BE),t}function bf(t){return function(e,i){var r=e.reserve(2),n=e.buffer;n[r++]=t,n[r]=i}}function cl(t){return function(e,i){var r=e.reserve(3),n=e.buffer;n[r++]=t,n[r++]=i>>>8,n[r]=i}}function fl(t){return function(e,i){var r=e.reserve(5),n=e.buffer;n[r++]=t,n[r++]=i>>>24,n[r++]=i>>>16,n[r++]=i>>>8,n[r]=i}}function Yt(t,e,i,r){return function(n,o){var a=n.reserve(e+1);n.buffer[a++]=t,i.call(n.buffer,o,a,r)}}function TB(t,e){new aX(this,e,t)}function AB(t,e){new lX(this,e,t)}function PB(t,e){SB.write(this,t,e,!1,23,4)}function RB(t,e){SB.write(this,t,e,!1,52,8)}});var BB=oe(FB=>{var pX=av(),kB=dv(),mX=kB.Uint64BE,gX=kB.Int64BE,DB=bn(),IB=uv(),vX=OB(),_X=K1().uint8,yX=cv().ExtBuffer,xX=typeof Uint8Array!="undefined",bX=typeof Map!="undefined",zh=[];zh[1]=212;zh[2]=213;zh[4]=214;zh[8]=215;zh[16]=216;FB.getWriteType=wX;function wX(t){var e=vX.getWriteToken(t),i=t&&t.useraw,r=xX&&t&&t.binarraybuffer,n=r?DB.isArrayBuffer:DB.isBuffer,o=r?S:y,a=bX&&t&&t.usemap,l=a?C:M,h={boolean:u,function:x,number:c,object:i?_:g,string:v(i?p:m),symbol:x,undefined:x};return h;function u(P,A){var R=A?195:194;e[R](P,A)}function c(P,A){var R=A|0,k;if(A!==R){k=203,e[k](P,A);return}else-32<=R&&R<=127?k=R&255:0<=R?k=R<=255?204:R<=65535?205:206:k=-128<=R?208:-32768<=R?209:210;e[k](P,R)}function f(P,A){var R=207;e[R](P,A.toArray())}function d(P,A){var R=211;e[R](P,A.toArray())}function m(P){return P<32?1:P<=255?2:P<=65535?3:5}function p(P){return P<32?1:P<=65535?3:5}function v(P){return A;function A(R,k){var I=k.length,L=5+I*3;R.offset=R.reserve(L);var T=R.buffer,O=P(I),D=R.offset+O;I=IB.write.call(T,k,D);var F=P(I);if(O!==F){var B=D+F-O,U=D+I;IB.copy.call(T,T,B,D,U)}var G=F===1?160+I:F<=3?215+F:219;e[G](R,I),R.offset+=I}}function g(P,A){if(A===null)return x(P,A);if(n(A))return o(P,A);if(pX(A))return b(P,A);if(mX.isUint64BE(A))return f(P,A);if(gX.isInt64BE(A))return d(P,A);var R=P.codec.getExtPacker(A);if(R&&(A=R(A)),A instanceof yX)return w(P,A);l(P,A)}function _(P,A){if(n(A))return E(P,A);g(P,A)}function x(P,A){var R=192;e[R](P,A)}function b(P,A){var R=A.length,k=R<16?144+R:R<=65535?220:221;e[k](P,R);for(var I=P.codec.encode,L=0;L<R;L++)I(P,A[L])}function y(P,A){var R=A.length,k=R<255?196:R<=65535?197:198;e[k](P,R),P.send(A)}function S(P,A){y(P,new Uint8Array(A))}function w(P,A){var R=A.buffer,k=R.length,I=zh[k]||(k<255?199:k<=65535?200:201);e[I](P,k),_X[A.type](P),P.send(R)}function M(P,A){var R=Object.keys(A),k=R.length,I=k<16?128+k:k<=65535?222:223;e[I](P,k);var L=P.codec.encode;R.forEach(function(T){L(P,T),L(P,A[T])})}function C(P,A){if(!(A instanceof Map))return M(P,A);var R=A.size,k=R<16?128+R:R<=65535?222:223;e[k](P,R);var I=P.codec.encode;A.forEach(function(L,T,O){I(P,T),I(P,L)})}function E(P,A){var R=A.length,k=R<32?160+R:R<=65535?218:219;e[k](P,R),P.send(A)}}});var Sf=oe(wf=>{var SX=av();wf.createCodec=NB;wf.install=EX;wf.filter=AX;var CX=bn();function Gh(t){if(!(this instanceof Gh))return new Gh(t);this.options=t,this.init()}Gh.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=CX.Uint8Array),this};function EX(t){for(var e in t)Gh.prototype[e]=MX(Gh.prototype[e],t[e])}function MX(t,e){return t&&e?i:t||e;function i(){return t.apply(this,arguments),e.apply(this,arguments)}}function TX(t){return t=t.slice(),function(i){return t.reduce(e,i)};function e(i,r){return r(i)}}function AX(t){return SX(t)?TX(t):t}function NB(t){return new Gh(t)}wf.preset=NB({preset:!0})});var mv=oe(zB=>{var PX=cv().ExtBuffer,RX=xB(),LX=BB(),Q1=Sf();Q1.install({addExtPacker:DX,getExtPacker:IX,init:UB});zB.preset=UB.call(Q1.preset);function OX(t){var e=LX.getWriteType(t);return i;function i(r,n){var o=e[typeof n];if(!o)throw new Error('Unsupported type "'+typeof n+'": '+n);o(r,n)}}function UB(){var t=this.options;return this.encode=OX(t),t&&t.preset&&RX.setExtPackers(this),this}function DX(t,e,i){i=Q1.filter(i);var r=e.name;if(r&&r!=="Object"){var n=this.extPackers||(this.extPackers={});n[r]=a}else{var o=this.extEncoderList||(this.extEncoderList=[]);o.unshift([e,a])}function a(l){return i&&(l=i(l)),new PX(l,t)}}function IX(t){var e=this.extPackers||(this.extPackers={}),i=t.constructor,r=i&&i.name&&e[i.name];if(r)return r;for(var n=this.extEncoderList||(this.extEncoderList=[]),o=n.length,a=0;a<o;a++){var l=n[a];if(i===l[0])return l[1]}}});var $1=oe(J1=>{J1.FlexDecoder=Hh;J1.FlexEncoder=Wh;var Cf=bn(),kX=2048,FX=65536,GB="BUFFER_SHORTAGE";function Hh(){if(!(this instanceof Hh))return new Hh}function Wh(){if(!(this instanceof Wh))return new Wh}Hh.mixin=VB(BX());Hh.mixin(Hh.prototype);Wh.mixin=VB(NX());Wh.mixin(Wh.prototype);function BX(){return{bufferish:Cf,write:t,fetch:zX,flush:e,push:WB,pull:GX,read:HB,reserve:i,offset:0};function t(r){var n=this.offset?Cf.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=n?r?this.bufferish.concat([n,r]):n:r,this.offset=0}function e(){for(;this.offset<this.buffer.length;){var r=this.offset,n;try{n=this.fetch()}catch(o){if(o&&o.message!=GB)throw o;this.offset=r;break}this.push(n)}}function i(r){var n=this.offset,o=n+r;if(o>this.buffer.length)throw new Error(GB);return this.offset=o,n}}function NX(){return{bufferish:Cf,write:UX,fetch:t,flush:e,push:WB,pull:i,read:HB,reserve:r,send:n,maxBufferSize:FX,minBufferSize:kX,offset:0,start:0};function t(){var o=this.start;if(o<this.offset){var a=this.start=this.offset;return Cf.prototype.slice.call(this.buffer,o,a)}}function e(){for(;this.start<this.offset;){var o=this.fetch();o&&this.push(o)}}function i(){var o=this.buffers||(this.buffers=[]),a=o.length>1?this.bufferish.concat(o):o[0];return o.length=0,a}function r(o){var a=o|0;if(this.buffer){var l=this.buffer.length,h=this.offset|0,u=h+a;if(u<l)return this.offset=u,h;this.flush(),o=Math.max(o,Math.min(l*2,this.maxBufferSize))}return o=Math.max(o,this.minBufferSize),this.buffer=this.bufferish.alloc(o),this.start=0,this.offset=a,0}function n(o){var a=o.length;if(a>this.minBufferSize)this.flush(),this.push(o);else{var l=this.reserve(a);Cf.prototype.copy.call(o,this.buffer,l)}}}function UX(){throw new Error("method not implemented: write()")}function zX(){throw new Error("method not implemented: fetch()")}function HB(){var t=this.buffers&&this.buffers.length;return t?(this.flush(),this.pull()):this.fetch()}function WB(t){var e=this.buffers||(this.buffers=[]);e.push(t)}function GX(){var t=this.buffers||(this.buffers=[]);return t.shift()}function VB(t){return e;function e(i){for(var r in t)i[r]=t[r];return i}}});var eS=oe(jB=>{jB.EncodeBuffer=Vh;var HX=mv().preset,WX=$1().FlexEncoder;WX.mixin(Vh.prototype);function Vh(t){if(!(this instanceof Vh))return new Vh(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}Vh.prototype.codec=HX;Vh.prototype.write=function(t){this.codec.encode(this,t)}});var X1=oe(qB=>{qB.encode=jX;var VX=eS().EncodeBuffer;function jX(t,e){var i=new VX(e);return i.write(t),i.read()}});var ZB=oe(YB=>{YB.setExtUnpackers=YX;var XB=bn(),qX=XB.global,tS,XX={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function YX(t){t.addExtUnpacker(14,[Gn,dl(Error)]),t.addExtUnpacker(1,[Gn,dl(EvalError)]),t.addExtUnpacker(2,[Gn,dl(RangeError)]),t.addExtUnpacker(3,[Gn,dl(ReferenceError)]),t.addExtUnpacker(4,[Gn,dl(SyntaxError)]),t.addExtUnpacker(5,[Gn,dl(TypeError)]),t.addExtUnpacker(6,[Gn,dl(URIError)]),t.addExtUnpacker(10,[Gn,ZX]),t.addExtUnpacker(11,[Gn,Nr(Boolean)]),t.addExtUnpacker(12,[Gn,Nr(String)]),t.addExtUnpacker(13,[Gn,Nr(Date)]),t.addExtUnpacker(15,[Gn,Nr(Number)]),typeof Uint8Array!="undefined"&&(t.addExtUnpacker(17,Nr(Int8Array)),t.addExtUnpacker(18,Nr(Uint8Array)),t.addExtUnpacker(19,[_a,Nr(Int16Array)]),t.addExtUnpacker(20,[_a,Nr(Uint16Array)]),t.addExtUnpacker(21,[_a,Nr(Int32Array)]),t.addExtUnpacker(22,[_a,Nr(Uint32Array)]),t.addExtUnpacker(23,[_a,Nr(Float32Array)]),typeof Float64Array!="undefined"&&t.addExtUnpacker(24,[_a,Nr(Float64Array)]),typeof Uint8ClampedArray!="undefined"&&t.addExtUnpacker(25,Nr(Uint8ClampedArray)),t.addExtUnpacker(26,_a),t.addExtUnpacker(29,[_a,Nr(DataView)])),XB.hasBuffer&&t.addExtUnpacker(27,Nr(qX))}function Gn(t){return tS||(tS=iS().decode),tS(t)}function ZX(t){return RegExp.apply(null,t)}function dl(t){return function(e){var i=new t;for(var r in XX)i[r]=e[r];return i}}function Nr(t){return function(e){return new t(e)}}function _a(t){return new Uint8Array(t).buffer}});var sS=oe(nS=>{var KB=Z1(),QB=dv(),JB=QB.Uint64BE,$B=QB.Int64BE;nS.getReadFormat=JX;nS.readUint8=e3;var rS=bn(),vv=uv(),KX=typeof Map!="undefined",QX=!0;function JX(t){var e=rS.hasArrayBuffer&&t&&t.binarraybuffer,i=t&&t.int64,r=KX&&t&&t.usemap,n={map:r?eY:$X,array:tY,str:iY,bin:e?nY:rY,ext:sY,uint8:e3,uint16:aY,uint32:hY,uint64:gv(8,i?dY:cY),int8:oY,int16:lY,int32:uY,int64:gv(8,i?pY:fY),float32:gv(4,mY),float64:gv(8,gY)};return n}function $X(t,e){var i={},r,n=new Array(e),o=new Array(e),a=t.codec.decode;for(r=0;r<e;r++)n[r]=a(t),o[r]=a(t);for(r=0;r<e;r++)i[n[r]]=o[r];return i}function eY(t,e){var i=new Map,r,n=new Array(e),o=new Array(e),a=t.codec.decode;for(r=0;r<e;r++)n[r]=a(t),o[r]=a(t);for(r=0;r<e;r++)i.set(n[r],o[r]);return i}function tY(t,e){for(var i=new Array(e),r=t.codec.decode,n=0;n<e;n++)i[n]=r(t);return i}function iY(t,e){var i=t.reserve(e),r=i+e;return vv.toString.call(t.buffer,"utf-8",i,r)}function rY(t,e){var i=t.reserve(e),r=i+e,n=vv.slice.call(t.buffer,i,r);return rS.from(n)}function nY(t,e){var i=t.reserve(e),r=i+e,n=vv.slice.call(t.buffer,i,r);return rS.Uint8Array.from(n).buffer}function sY(t,e){var i=t.reserve(e+1),r=t.buffer[i++],n=i+e,o=t.codec.getExtUnpacker(r);if(!o)throw new Error("Invalid ext type: "+(r&&"0x"+r.toString(16)));var a=vv.slice.call(t.buffer,i,n);return o(a)}function e3(t){var e=t.reserve(1);return t.buffer[e]}function oY(t){var e=t.reserve(1),i=t.buffer[e];return i&128?i-256:i}function aY(t){var e=t.reserve(2),i=t.buffer;return i[e++]<<8|i[e]}function lY(t){var e=t.reserve(2),i=t.buffer,r=i[e++]<<8|i[e];return r&32768?r-65536:r}function hY(t){var e=t.reserve(4),i=t.buffer;return i[e++]*16777216+(i[e++]<<16)+(i[e++]<<8)+i[e]}function uY(t){var e=t.reserve(4),i=t.buffer;return i[e++]<<24|i[e++]<<16|i[e++]<<8|i[e]}function gv(t,e){return function(i){var r=i.reserve(t);return e.call(i.buffer,r,QX)}}function cY(t){return new JB(this,t).toNumber()}function fY(t){return new $B(this,t).toNumber()}function dY(t){return new JB(this,t)}function pY(t){return new $B(this,t)}function mY(t){return KB.read(this,t,!1,23,4)}function gY(t){return KB.read(this,t,!1,52,8)}});var r3=oe(i3=>{var vY=sS();i3.getReadToken=_Y;function _Y(t){var e=vY.getReadFormat(t);return t&&t.useraw?yY(e):t3(e)}function t3(t){var e,i=new Array(256);for(e=0;e<=127;e++)i[e]=Ef(e);for(e=128;e<=143;e++)i[e]=Co(e-128,t.map);for(e=144;e<=159;e++)i[e]=Co(e-144,t.array);for(e=160;e<=191;e++)i[e]=Co(e-160,t.str);for(i[192]=Ef(null),i[193]=null,i[194]=Ef(!1),i[195]=Ef(!0),i[196]=wn(t.uint8,t.bin),i[197]=wn(t.uint16,t.bin),i[198]=wn(t.uint32,t.bin),i[199]=wn(t.uint8,t.ext),i[200]=wn(t.uint16,t.ext),i[201]=wn(t.uint32,t.ext),i[202]=t.float32,i[203]=t.float64,i[204]=t.uint8,i[205]=t.uint16,i[206]=t.uint32,i[207]=t.uint64,i[208]=t.int8,i[209]=t.int16,i[210]=t.int32,i[211]=t.int64,i[212]=Co(1,t.ext),i[213]=Co(2,t.ext),i[214]=Co(4,t.ext),i[215]=Co(8,t.ext),i[216]=Co(16,t.ext),i[217]=wn(t.uint8,t.str),i[218]=wn(t.uint16,t.str),i[219]=wn(t.uint32,t.str),i[220]=wn(t.uint16,t.array),i[221]=wn(t.uint32,t.array),i[222]=wn(t.uint16,t.map),i[223]=wn(t.uint32,t.map),e=224;e<=255;e++)i[e]=Ef(e-256);return i}function yY(t){var e,i=t3(t).slice();for(i[217]=i[196],i[218]=i[197],i[219]=i[198],e=160;e<=191;e++)i[e]=Co(e-160,t.bin);return i}function Ef(t){return function(){return t}}function wn(t,e){return function(i){var r=t(i);return e(i,r)}}function Co(t,e){return function(i){return e(i,t)}}});var _v=oe(s3=>{var xY=cv().ExtBuffer,bY=ZB(),wY=sS().readUint8,SY=r3(),oS=Sf();oS.install({addExtUnpacker:EY,getExtUnpacker:MY,init:n3});s3.preset=n3.call(oS.preset);function CY(t){var e=SY.getReadToken(t);return i;function i(r){var n=wY(r),o=e[n];if(!o)throw new Error("Invalid type: "+(n&&"0x"+n.toString(16)));return o(r)}}function n3(){var t=this.options;return this.decode=CY(t),t&&t.preset&&bY.setExtUnpackers(this),this}function EY(t,e){var i=this.extUnpackers||(this.extUnpackers=[]);i[t]=oS.filter(e)}function MY(t){var e=this.extUnpackers||(this.extUnpackers=[]);return e[t]||i;function i(r){return new xY(r,t)}}});var aS=oe(o3=>{o3.DecodeBuffer=jh;var TY=_v().preset,AY=$1().FlexDecoder;AY.mixin(jh.prototype);function jh(t){if(!(this instanceof jh))return new jh(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}jh.prototype.codec=TY;jh.prototype.fetch=function(){return this.codec.decode(this)}});var iS=oe(a3=>{a3.decode=RY;var PY=aS().DecodeBuffer;function RY(t,e){var i=new PY(e);return i.write(t),i.read()}});var uS=oe((gAe,hS)=>{function lS(){if(!(this instanceof lS))return new lS}(function(t){typeof hS!="undefined"&&(hS.exports=t);var e="listeners",i={on:n,once:o,off:a,emit:l};r(t.prototype),t.mixin=r;function r(u){for(var c in i)u[c]=i[c];return u}function n(u,c){return h(this,u).push(c),this}function o(u,c){var f=this;return d.originalListener=c,h(f,u).push(d),f;function d(){a.call(f,u,d),c.apply(this,arguments)}}function a(u,c){var f=this,d;if(!arguments.length)delete f[e];else if(c){if(d=h(f,u,!0),d){if(d=d.filter(m),!d.length)return a.call(f,u);f[e][u]=d}}else if(d=f[e],d&&(delete d[u],!Object.keys(d).length))return a.call(f);return f;function m(p){return p!==c&&p.originalListener!==c}}function l(u,c){var f=this,d=h(f,u,!0);if(!d)return!1;var m=arguments.length;if(m===1)d.forEach(v);else if(m===2)d.forEach(g);else{var p=Array.prototype.slice.call(arguments,1);d.forEach(_)}return!!d.length;function v(x){x.call(f)}function g(x){x.call(f,c)}function _(x){x.apply(f,p)}}function h(u,c,f){if(!(f&&!u[e])){var d=u[e]||(u[e]={});return d[c]||(d[c]=[])}}})(lS)});var u3=oe(h3=>{h3.Encoder=pl;var LY=uS(),l3=eS().EncodeBuffer;function pl(t){if(!(this instanceof pl))return new pl(t);l3.call(this,t)}pl.prototype=new l3;LY.mixin(pl.prototype);pl.prototype.encode=function(t){this.write(t),this.emit("data",this.read())};pl.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end")}});var d3=oe(f3=>{f3.Decoder=ya;var OY=uS(),c3=aS().DecodeBuffer;function ya(t){if(!(this instanceof ya))return new ya(t);c3.call(this,t)}ya.prototype=new c3;OY.mixin(ya.prototype);ya.prototype.decode=function(t){arguments.length&&this.write(t),this.flush()};ya.prototype.push=function(t){this.emit("data",t)};ya.prototype.end=function(t){this.decode(t),this.emit("end")}});var m3=oe(p3=>{_v();mv();p3.createCodec=Sf().createCodec});var v3=oe(g3=>{_v();mv();g3.codec={preset:Sf().preset}});var _3=oe(ml=>{ml.encode=X1().encode;ml.decode=iS().decode;ml.Encoder=u3().Encoder;ml.Decoder=d3().Decoder;ml.createCodec=m3().createCodec;ml.codec=v3().codec});var A3=oe((Sv,dS)=>{(function(t,e){if(typeof Sv=="object"&&typeof dS=="object")dS.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var i=e();for(var r in i)(typeof Sv=="object"?Sv:t)[r]=i[r]}})(self,()=>(()=>{"use strict";var t={4567:function(n,o,a){var l=this&&this.__decorate||function(_,x,b,y){var S,w=arguments.length,M=w<3?x:y===null?y=Object.getOwnPropertyDescriptor(x,b):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,x,b,y);else for(var C=_.length-1;C>=0;C--)(S=_[C])&&(M=(w<3?S(M):w>3?S(x,b,M):S(x,b))||M);return w>3&&M&&Object.defineProperty(x,b,M),M},h=this&&this.__param||function(_,x){return function(b,y){x(b,y,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.AccessibilityManager=void 0;let u=a(9042),c=a(6114),f=a(9924),d=a(844),m=a(5596),p=a(4725),v=a(3656),g=o.AccessibilityManager=class extends d.Disposable{constructor(_,x){super(),this._terminal=_,this._renderService=x,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let b=0;b<this._terminal.rows;b++)this._rowElements[b]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[b]);if(this._topBoundaryFocusListener=b=>this._handleBoundaryFocus(b,0),this._bottomBoundaryFocusListener=b=>this._handleBoundaryFocus(b,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new f.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(b=>this._handleResize(b.rows))),this.register(this._terminal.onRender(b=>this._refreshRows(b.start,b.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(b=>this._handleChar(b))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(b=>this._handleTab(b))),this.register(this._terminal.onKey(b=>this._handleKey(b.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new m.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,v.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,d.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(_){for(let x=0;x<_;x++)this._handleChar(" ")}_handleChar(_){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==_&&(this._charsToAnnounce+=_):this._charsToAnnounce+=_,_===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=u.tooMuchOutput)),c.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,c.isMac&&this._liveRegion.remove()}_handleKey(_){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(_)||this._charsToConsume.push(_)}_refreshRows(_,x){this._liveRegionDebouncer.refresh(_,x,this._terminal.rows)}_renderRows(_,x){let b=this._terminal.buffer,y=b.lines.length.toString();for(let S=_;S<=x;S++){let w=b.translateBufferLineToString(b.ydisp+S,!0),M=(b.ydisp+S+1).toString(),C=this._rowElements[S];C&&(w.length===0?C.innerText="\xA0":C.textContent=w,C.setAttribute("aria-posinset",M),C.setAttribute("aria-setsize",y))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(_,x){let b=_.target,y=this._rowElements[x===0?1:this._rowElements.length-2];if(b.getAttribute("aria-posinset")===(x===0?"1":`${this._terminal.buffer.lines.length}`)||_.relatedTarget!==y)return;let S,w;if(x===0?(S=b,w=this._rowElements.pop(),this._rowContainer.removeChild(w)):(S=this._rowElements.shift(),w=b,this._rowContainer.removeChild(S)),S.removeEventListener("focus",this._topBoundaryFocusListener),w.removeEventListener("focus",this._bottomBoundaryFocusListener),x===0){let M=this._createAccessibilityTreeNode();this._rowElements.unshift(M),this._rowContainer.insertAdjacentElement("afterbegin",M)}else{let M=this._createAccessibilityTreeNode();this._rowElements.push(M),this._rowContainer.appendChild(M)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(x===0?-1:1),this._rowElements[x===0?1:this._rowElements.length-2].focus(),_.preventDefault(),_.stopImmediatePropagation()}_handleResize(_){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let x=this._rowContainer.children.length;x<this._terminal.rows;x++)this._rowElements[x]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[x]);for(;this._rowElements.length>_;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let _=document.createElement("div");return _.setAttribute("role","listitem"),_.tabIndex=-1,this._refreshRowDimensions(_),_}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let _=0;_<this._terminal.rows;_++)this._refreshRowDimensions(this._rowElements[_])}}_refreshRowDimensions(_){_.style.height=`${this._renderService.dimensions.css.cell.height}px`}};o.AccessibilityManager=g=l([h(1,p.IRenderService)],g)},3614:(n,o)=>{function a(c){return c.replace(/\r?\n/g,"\r")}function l(c,f){return f?"\x1B[200~"+c+"\x1B[201~":c}function h(c,f,d,m){c=l(c=a(c),d.decPrivateModes.bracketedPasteMode&&m.rawOptions.ignoreBracketedPasteMode!==!0),d.triggerDataEvent(c,!0),f.value=""}function u(c,f,d){let m=d.getBoundingClientRect(),p=c.clientX-m.left-10,v=c.clientY-m.top-10;f.style.width="20px",f.style.height="20px",f.style.left=`${p}px`,f.style.top=`${v}px`,f.style.zIndex="1000",f.focus()}Object.defineProperty(o,"__esModule",{value:!0}),o.rightClickHandler=o.moveTextAreaUnderMouseCursor=o.paste=o.handlePasteEvent=o.copyHandler=o.bracketTextForPaste=o.prepareTextForTerminal=void 0,o.prepareTextForTerminal=a,o.bracketTextForPaste=l,o.copyHandler=function(c,f){c.clipboardData&&c.clipboardData.setData("text/plain",f.selectionText),c.preventDefault()},o.handlePasteEvent=function(c,f,d,m){c.stopPropagation(),c.clipboardData&&h(c.clipboardData.getData("text/plain"),f,d,m)},o.paste=h,o.moveTextAreaUnderMouseCursor=u,o.rightClickHandler=function(c,f,d,m,p){u(c,f,d),p&&m.rightClickSelect(c),f.value=m.selectionText,f.select()}},7239:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorContrastCache=void 0;let l=a(1505);o.ColorContrastCache=class{constructor(){this._color=new l.TwoKeyMap,this._css=new l.TwoKeyMap}setCss(h,u,c){this._css.set(h,u,c)}getCss(h,u){return this._css.get(h,u)}setColor(h,u,c){this._color.set(h,u,c)}getColor(h,u){return this._color.get(h,u)}clear(){this._color.clear(),this._css.clear()}}},3656:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.addDisposableDomListener=void 0,o.addDisposableDomListener=function(a,l,h,u){a.addEventListener(l,h,u);let c=!1;return{dispose:()=>{c||(c=!0,a.removeEventListener(l,h,u))}}}},6465:function(n,o,a){var l=this&&this.__decorate||function(p,v,g,_){var x,b=arguments.length,y=b<3?v:_===null?_=Object.getOwnPropertyDescriptor(v,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(p,v,g,_);else for(var S=p.length-1;S>=0;S--)(x=p[S])&&(y=(b<3?x(y):b>3?x(v,g,y):x(v,g))||y);return b>3&&y&&Object.defineProperty(v,g,y),y},h=this&&this.__param||function(p,v){return function(g,_){v(g,_,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Linkifier2=void 0;let u=a(3656),c=a(8460),f=a(844),d=a(2585),m=o.Linkifier2=class extends f.Disposable{get currentLink(){return this._currentLink}constructor(p){super(),this._bufferService=p,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new c.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new c.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,f.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,f.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(p){return this._linkProviders.push(p),{dispose:()=>{let v=this._linkProviders.indexOf(p);v!==-1&&this._linkProviders.splice(v,1)}}}attachToDom(p,v,g){this._element=p,this._mouseService=v,this._renderService=g,this.register((0,u.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,u.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,u.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,u.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(p){if(this._lastMouseEvent=p,!this._element||!this._mouseService)return;let v=this._positionFromMouseEvent(p,this._element,this._mouseService);if(!v)return;this._isMouseOut=!1;let g=p.composedPath();for(let _=0;_<g.length;_++){let x=g[_];if(x.classList.contains("xterm"))break;if(x.classList.contains("xterm-hover"))return}this._lastBufferCell&&v.x===this._lastBufferCell.x&&v.y===this._lastBufferCell.y||(this._handleHover(v),this._lastBufferCell=v)}_handleHover(p){if(this._activeLine!==p.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(p,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,p)||(this._clearCurrentLink(),this._askForLink(p,!0))}_askForLink(p,v){var g,_;this._activeProviderReplies&&v||((g=this._activeProviderReplies)===null||g===void 0||g.forEach(b=>{b==null||b.forEach(y=>{y.link.dispose&&y.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=p.y);let x=!1;for(let[b,y]of this._linkProviders.entries())v?!((_=this._activeProviderReplies)===null||_===void 0)&&_.get(b)&&(x=this._checkLinkProviderResult(b,p,x)):y.provideLinks(p.y,S=>{var w,M;if(this._isMouseOut)return;let C=S==null?void 0:S.map(E=>({link:E}));(w=this._activeProviderReplies)===null||w===void 0||w.set(b,C),x=this._checkLinkProviderResult(b,p,x),((M=this._activeProviderReplies)===null||M===void 0?void 0:M.size)===this._linkProviders.length&&this._removeIntersectingLinks(p.y,this._activeProviderReplies)})}_removeIntersectingLinks(p,v){let g=new Set;for(let _=0;_<v.size;_++){let x=v.get(_);if(x)for(let b=0;b<x.length;b++){let y=x[b],S=y.link.range.start.y<p?0:y.link.range.start.x,w=y.link.range.end.y>p?this._bufferService.cols:y.link.range.end.x;for(let M=S;M<=w;M++){if(g.has(M)){x.splice(b--,1);break}g.add(M)}}}}_checkLinkProviderResult(p,v,g){var _;if(!this._activeProviderReplies)return g;let x=this._activeProviderReplies.get(p),b=!1;for(let y=0;y<p;y++)this._activeProviderReplies.has(y)&&!this._activeProviderReplies.get(y)||(b=!0);if(!b&&x){let y=x.find(S=>this._linkAtPosition(S.link,v));y&&(g=!0,this._handleNewLink(y))}if(this._activeProviderReplies.size===this._linkProviders.length&&!g)for(let y=0;y<this._activeProviderReplies.size;y++){let S=(_=this._activeProviderReplies.get(y))===null||_===void 0?void 0:_.find(w=>this._linkAtPosition(w.link,v));if(S){g=!0,this._handleNewLink(S);break}}return g}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(p){if(!this._element||!this._mouseService||!this._currentLink)return;let v=this._positionFromMouseEvent(p,this._element,this._mouseService);v&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,v)&&this._currentLink.link.activate(p,this._currentLink.link.text)}_clearCurrentLink(p,v){this._element&&this._currentLink&&this._lastMouseEvent&&(!p||!v||this._currentLink.link.range.start.y>=p&&this._currentLink.link.range.end.y<=v)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,f.disposeArray)(this._linkCacheDisposables))}_handleNewLink(p){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let v=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);v&&this._linkAtPosition(p.link,v)&&(this._currentLink=p,this._currentLink.state={decorations:{underline:p.link.decorations===void 0||p.link.decorations.underline,pointerCursor:p.link.decorations===void 0||p.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,p.link,this._lastMouseEvent),p.link.decorations={},Object.defineProperties(p.link.decorations,{pointerCursor:{get:()=>{var g,_;return(_=(g=this._currentLink)===null||g===void 0?void 0:g.state)===null||_===void 0?void 0:_.decorations.pointerCursor},set:g=>{var _,x;!((_=this._currentLink)===null||_===void 0)&&_.state&&this._currentLink.state.decorations.pointerCursor!==g&&(this._currentLink.state.decorations.pointerCursor=g,this._currentLink.state.isHovered&&((x=this._element)===null||x===void 0||x.classList.toggle("xterm-cursor-pointer",g)))}},underline:{get:()=>{var g,_;return(_=(g=this._currentLink)===null||g===void 0?void 0:g.state)===null||_===void 0?void 0:_.decorations.underline},set:g=>{var _,x,b;!((_=this._currentLink)===null||_===void 0)&&_.state&&((b=(x=this._currentLink)===null||x===void 0?void 0:x.state)===null||b===void 0?void 0:b.decorations.underline)!==g&&(this._currentLink.state.decorations.underline=g,this._currentLink.state.isHovered&&this._fireUnderlineEvent(p.link,g))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(g=>{if(!this._currentLink)return;let _=g.start===0?0:g.start+1+this._bufferService.buffer.ydisp,x=this._bufferService.buffer.ydisp+1+g.end;if(this._currentLink.link.range.start.y>=_&&this._currentLink.link.range.end.y<=x&&(this._clearCurrentLink(_,x),this._lastMouseEvent&&this._element)){let b=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);b&&this._askForLink(b,!1)}})))}_linkHover(p,v,g){var _;!((_=this._currentLink)===null||_===void 0)&&_.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(v,!0),this._currentLink.state.decorations.pointerCursor&&p.classList.add("xterm-cursor-pointer")),v.hover&&v.hover(g,v.text)}_fireUnderlineEvent(p,v){let g=p.range,_=this._bufferService.buffer.ydisp,x=this._createLinkUnderlineEvent(g.start.x-1,g.start.y-_-1,g.end.x,g.end.y-_-1,void 0);(v?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(x)}_linkLeave(p,v,g){var _;!((_=this._currentLink)===null||_===void 0)&&_.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(v,!1),this._currentLink.state.decorations.pointerCursor&&p.classList.remove("xterm-cursor-pointer")),v.leave&&v.leave(g,v.text)}_linkAtPosition(p,v){let g=p.range.start.y*this._bufferService.cols+p.range.start.x,_=p.range.end.y*this._bufferService.cols+p.range.end.x,x=v.y*this._bufferService.cols+v.x;return g<=x&&x<=_}_positionFromMouseEvent(p,v,g){let _=g.getCoords(p,v,this._bufferService.cols,this._bufferService.rows);if(_)return{x:_[0],y:_[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(p,v,g,_,x){return{x1:p,y1:v,x2:g,y2:_,cols:this._bufferService.cols,fg:x}}};o.Linkifier2=m=l([h(0,d.IBufferService)],m)},9042:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tooMuchOutput=o.promptLabel=void 0,o.promptLabel="Terminal input",o.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(n,o,a){var l=this&&this.__decorate||function(m,p,v,g){var _,x=arguments.length,b=x<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(m,p,v,g);else for(var y=m.length-1;y>=0;y--)(_=m[y])&&(b=(x<3?_(b):x>3?_(p,v,b):_(p,v))||b);return x>3&&b&&Object.defineProperty(p,v,b),b},h=this&&this.__param||function(m,p){return function(v,g){p(v,g,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkProvider=void 0;let u=a(511),c=a(2585),f=o.OscLinkProvider=class{constructor(m,p,v){this._bufferService=m,this._optionsService=p,this._oscLinkService=v}provideLinks(m,p){var v;let g=this._bufferService.buffer.lines.get(m-1);if(!g)return void p(void 0);let _=[],x=this._optionsService.rawOptions.linkHandler,b=new u.CellData,y=g.getTrimmedLength(),S=-1,w=-1,M=!1;for(let C=0;C<y;C++)if(w!==-1||g.hasContent(C)){if(g.loadCell(C,b),b.hasExtendedAttrs()&&b.extended.urlId){if(w===-1){w=C,S=b.extended.urlId;continue}M=b.extended.urlId!==S}else w!==-1&&(M=!0);if(M||w!==-1&&C===y-1){let E=(v=this._oscLinkService.getLinkData(S))===null||v===void 0?void 0:v.uri;if(E){let P={start:{x:w+1,y:m},end:{x:C+(M||C!==y-1?0:1),y:m}},A=!1;if(!(x!=null&&x.allowNonHttpProtocols))try{let R=new URL(E);["http:","https:"].includes(R.protocol)||(A=!0)}catch(R){A=!0}A||_.push({text:E,range:P,activate:(R,k)=>x?x.activate(R,k,P):d(0,k),hover:(R,k)=>{var I;return(I=x==null?void 0:x.hover)===null||I===void 0?void 0:I.call(x,R,k,P)},leave:(R,k)=>{var I;return(I=x==null?void 0:x.leave)===null||I===void 0?void 0:I.call(x,R,k,P)}})}M=!1,b.hasExtendedAttrs()&&b.extended.urlId?(w=C,S=b.extended.urlId):(w=-1,S=-1)}}p(_)}};function d(m,p){if(confirm(`Do you want to navigate to ${p}?

WARNING: This link could potentially be dangerous`)){let v=window.open();if(v){try{v.opener=null}catch(g){}v.location.href=p}else console.warn("Opening link blocked as opener could not be cleared")}}o.OscLinkProvider=f=l([h(0,c.IBufferService),h(1,c.IOptionsService),h(2,c.IOscLinkService)],f)},6193:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.RenderDebouncer=void 0,o.RenderDebouncer=class{constructor(a,l){this._parentWindow=a,this._renderCallback=l,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(a,l,h){this._rowCount=h,a=a!==void 0?a:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let a=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,l),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},5596:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ScreenDprMonitor=void 0;let l=a(844);class h extends l.Disposable{constructor(c){super(),this._parentWindow=c,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,l.toDisposable)(()=>{this.clearListener()}))}setListener(c){this._listener&&this.clearListener(),this._listener=c,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var c;this._outerListener&&((c=this._resolutionMediaMatchList)===null||c===void 0||c.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}o.ScreenDprMonitor=h},3236:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Terminal=void 0;let l=a(3614),h=a(3656),u=a(6465),c=a(9042),f=a(3730),d=a(1680),m=a(3107),p=a(5744),v=a(2950),g=a(1296),_=a(428),x=a(4269),b=a(5114),y=a(8934),S=a(3230),w=a(9312),M=a(4725),C=a(6731),E=a(8055),P=a(8969),A=a(8460),R=a(844),k=a(6114),I=a(8437),L=a(2584),T=a(7399),O=a(5941),D=a(9074),F=a(2585),B=a(5435),U=a(4567),G=typeof window!="undefined"?window.document:null;class Y extends P.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(N={}){super(N),this.browser=k,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new R.MutableDisposable),this._onCursorMove=this.register(new A.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new A.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new A.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new A.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new A.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new A.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new A.EventEmitter),this._onBlur=this.register(new A.EventEmitter),this._onA11yCharEmitter=this.register(new A.EventEmitter),this._onA11yTabEmitter=this.register(new A.EventEmitter),this._onWillOpen=this.register(new A.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(u.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(f.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(D.DecorationService),this._instantiationService.setService(F.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((z,ie)=>this.refresh(z,ie))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(z=>this._reportWindowsOptions(z))),this.register(this._inputHandler.onColor(z=>this._handleColorEvent(z))),this.register((0,A.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,A.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,A.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,A.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(z=>this._afterResize(z.cols,z.rows))),this.register((0,R.toDisposable)(()=>{var z,ie;this._customKeyEventHandler=void 0,(ie=(z=this.element)===null||z===void 0?void 0:z.parentNode)===null||ie===void 0||ie.removeChild(this.element)}))}_handleColorEvent(N){if(this._themeService)for(let z of N){let ie,Z="";switch(z.index){case 256:ie="foreground",Z="10";break;case 257:ie="background",Z="11";break;case 258:ie="cursor",Z="12";break;default:ie="ansi",Z="4;"+z.index}switch(z.type){case 0:let ne=E.color.toColorRGB(ie==="ansi"?this._themeService.colors.ansi[z.index]:this._themeService.colors[ie]);this.coreService.triggerDataEvent(`${L.C0.ESC}]${Z};${(0,O.toRgbString)(ne)}${L.C1_ESCAPED.ST}`);break;case 1:if(ie==="ansi")this._themeService.modifyColors(K=>K.ansi[z.index]=E.rgba.toColor(...z.color));else{let K=ie;this._themeService.modifyColors(ae=>ae[K]=E.rgba.toColor(...z.color))}break;case 2:this._themeService.restoreColor(z.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(N){N?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(U.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(N){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(L.C0.ESC+"[I"),this.updateCursorStyle(N),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var N;return(N=this.textarea)===null||N===void 0?void 0:N.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(L.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let N=this.buffer.ybase+this.buffer.y,z=this.buffer.lines.get(N);if(!z)return;let ie=Math.min(this.buffer.x,this.cols-1),Z=this._renderService.dimensions.css.cell.height,ne=z.getWidth(ie),K=this._renderService.dimensions.css.cell.width*ne,ae=this.buffer.y*this._renderService.dimensions.css.cell.height,ue=ie*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ue+"px",this.textarea.style.top=ae+"px",this.textarea.style.width=K+"px",this.textarea.style.height=Z+"px",this.textarea.style.lineHeight=Z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,h.addDisposableDomListener)(this.element,"copy",z=>{this.hasSelection()&&(0,l.copyHandler)(z,this._selectionService)}));let N=z=>(0,l.handlePasteEvent)(z,this.textarea,this.coreService,this.optionsService);this.register((0,h.addDisposableDomListener)(this.textarea,"paste",N)),this.register((0,h.addDisposableDomListener)(this.element,"paste",N)),k.isFirefox?this.register((0,h.addDisposableDomListener)(this.element,"mousedown",z=>{z.button===2&&(0,l.rightClickHandler)(z,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,h.addDisposableDomListener)(this.element,"contextmenu",z=>{(0,l.rightClickHandler)(z,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),k.isLinux&&this.register((0,h.addDisposableDomListener)(this.element,"auxclick",z=>{z.button===1&&(0,l.moveTextAreaUnderMouseCursor)(z,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,h.addDisposableDomListener)(this.textarea,"keyup",N=>this._keyUp(N),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keydown",N=>this._keyDown(N),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keypress",N=>this._keyPress(N),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionupdate",N=>this._compositionHelper.compositionupdate(N))),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,h.addDisposableDomListener)(this.textarea,"input",N=>this._inputEvent(N),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(N){var z;if(!N)throw new Error("Terminal requires a parent element.");N.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=N.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),N.appendChild(this.element);let ie=G.createDocumentFragment();this._viewportElement=G.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),ie.appendChild(this._viewportElement),this._viewportScrollArea=G.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=G.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=G.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),ie.appendChild(this.screenElement),this.textarea=G.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",c.promptLabel),k.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(b.CoreBrowserService,this.textarea,(z=this._document.defaultView)!==null&&z!==void 0?z:window),this._instantiationService.setService(M.ICoreBrowserService,this._coreBrowserService),this.register((0,h.addDisposableDomListener)(this.textarea,"focus",Z=>this._handleTextAreaFocus(Z))),this.register((0,h.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(_.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(M.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(C.ThemeService),this._instantiationService.setService(M.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(x.CharacterJoinerService),this._instantiationService.setService(M.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(S.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(M.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(Z=>this._onRender.fire(Z))),this.onResize(Z=>this._renderService.resize(Z.cols,Z.rows)),this._compositionView=G.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(v.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(ie);try{this._onWillOpen.fire(this.element)}catch(Z){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(y.MouseService),this._instantiationService.setService(M.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(d.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(Z=>this.scrollLines(Z.amount,Z.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(w.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(M.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(Z=>this.scrollLines(Z.amount,Z.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(Z=>this._renderService.handleSelectionChanged(Z.start,Z.end,Z.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(Z=>{this.textarea.value=Z,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(Z=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,h.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(m.BufferDecorationRenderer,this.screenElement)),this.register((0,h.addDisposableDomListener)(this.element,"mousedown",Z=>this._selectionService.handleMouseDown(Z))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(U.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",Z=>this._handleScreenReaderModeOptionChange(Z))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(p.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",Z=>{!this._overviewRulerRenderer&&Z&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(p.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(g.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let N=this,z=this.element;function ie(K){let ae=N._mouseService.getMouseReportCoords(K,N.screenElement);if(!ae)return!1;let ue,_e;switch(K.overrideType||K.type){case"mousemove":_e=32,K.buttons===void 0?(ue=3,K.button!==void 0&&(ue=K.button<3?K.button:3)):ue=1&K.buttons?0:4&K.buttons?1:2&K.buttons?2:3;break;case"mouseup":_e=0,ue=K.button<3?K.button:3;break;case"mousedown":_e=1,ue=K.button<3?K.button:3;break;case"wheel":if(N.viewport.getLinesScrolled(K)===0)return!1;_e=K.deltaY<0?0:1,ue=4;break;default:return!1}return!(_e===void 0||ue===void 0||ue>4)&&N.coreMouseService.triggerMouseEvent({col:ae.col,row:ae.row,x:ae.x,y:ae.y,button:ue,action:_e,ctrl:K.ctrlKey,alt:K.altKey,shift:K.shiftKey})}let Z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},ne={mouseup:K=>(ie(K),K.buttons||(this._document.removeEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.removeEventListener("mousemove",Z.mousedrag)),this.cancel(K)),wheel:K=>(ie(K),this.cancel(K,!0)),mousedrag:K=>{K.buttons&&ie(K)},mousemove:K=>{K.buttons||ie(K)}};this.register(this.coreMouseService.onProtocolChange(K=>{K?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(K)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&K?Z.mousemove||(z.addEventListener("mousemove",ne.mousemove),Z.mousemove=ne.mousemove):(z.removeEventListener("mousemove",Z.mousemove),Z.mousemove=null),16&K?Z.wheel||(z.addEventListener("wheel",ne.wheel,{passive:!1}),Z.wheel=ne.wheel):(z.removeEventListener("wheel",Z.wheel),Z.wheel=null),2&K?Z.mouseup||(z.addEventListener("mouseup",ne.mouseup),Z.mouseup=ne.mouseup):(this._document.removeEventListener("mouseup",Z.mouseup),z.removeEventListener("mouseup",Z.mouseup),Z.mouseup=null),4&K?Z.mousedrag||(Z.mousedrag=ne.mousedrag):(this._document.removeEventListener("mousemove",Z.mousedrag),Z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,h.addDisposableDomListener)(z,"mousedown",K=>{if(K.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(K))return ie(K),Z.mouseup&&this._document.addEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.addEventListener("mousemove",Z.mousedrag),this.cancel(K)})),this.register((0,h.addDisposableDomListener)(z,"wheel",K=>{if(!Z.wheel){if(!this.buffer.hasScrollback){let ae=this.viewport.getLinesScrolled(K);if(ae===0)return;let ue=L.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(K.deltaY<0?"A":"B"),_e="";for(let Re=0;Re<Math.abs(ae);Re++)_e+=ue;return this.coreService.triggerDataEvent(_e,!0),this.cancel(K,!0)}return this.viewport.handleWheel(K)?this.cancel(K):void 0}},{passive:!1})),this.register((0,h.addDisposableDomListener)(z,"touchstart",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(K),this.cancel(K)},{passive:!0})),this.register((0,h.addDisposableDomListener)(z,"touchmove",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(K)?void 0:this.cancel(K)},{passive:!1}))}refresh(N,z){var ie;(ie=this._renderService)===null||ie===void 0||ie.refreshRows(N,z)}updateCursorStyle(N){var z;!((z=this._selectionService)===null||z===void 0)&&z.shouldColumnSelect(N)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(N,z,ie=0){var Z;ie===1?(super.scrollLines(N,z,ie),this.refresh(0,this.rows-1)):(Z=this.viewport)===null||Z===void 0||Z.scrollLines(N)}paste(N){(0,l.paste)(N,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(N){this._customKeyEventHandler=N}registerLinkProvider(N){return this.linkifier2.registerLinkProvider(N)}registerCharacterJoiner(N){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let z=this._characterJoinerService.register(N);return this.refresh(0,this.rows-1),z}deregisterCharacterJoiner(N){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(N)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(N){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+N)}registerDecoration(N){return this._decorationService.registerDecoration(N)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(N,z,ie){this._selectionService.setSelection(N,z,ie)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var N;(N=this._selectionService)===null||N===void 0||N.clearSelection()}selectAll(){var N;(N=this._selectionService)===null||N===void 0||N.selectAll()}selectLines(N,z){var ie;(ie=this._selectionService)===null||ie===void 0||ie.selectLines(N,z)}_keyDown(N){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(N)===!1)return!1;let z=this.browser.isMac&&this.options.macOptionIsMeta&&N.altKey;if(!z&&!this._compositionHelper.keydown(N))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;z||N.key!=="Dead"&&N.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let ie=(0,T.evaluateKeyboardEvent)(N,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(N),ie.type===3||ie.type===2){let Z=this.rows-1;return this.scrollLines(ie.type===2?-Z:Z),this.cancel(N,!0)}return ie.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,N)||(ie.cancel&&this.cancel(N,!0),!ie.key||!!(N.key&&!N.ctrlKey&&!N.altKey&&!N.metaKey&&N.key.length===1&&N.key.charCodeAt(0)>=65&&N.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(ie.key!==L.C0.ETX&&ie.key!==L.C0.CR||(this.textarea.value=""),this._onKey.fire({key:ie.key,domEvent:N}),this._showCursor(),this.coreService.triggerDataEvent(ie.key,!0),!this.optionsService.rawOptions.screenReaderMode||N.altKey||N.ctrlKey?this.cancel(N,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(N,z){let ie=N.isMac&&!this.options.macOptionIsMeta&&z.altKey&&!z.ctrlKey&&!z.metaKey||N.isWindows&&z.altKey&&z.ctrlKey&&!z.metaKey||N.isWindows&&z.getModifierState("AltGraph");return z.type==="keypress"?ie:ie&&(!z.keyCode||z.keyCode>47)}_keyUp(N){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(N)===!1||(function(z){return z.keyCode===16||z.keyCode===17||z.keyCode===18}(N)||this.focus(),this.updateCursorStyle(N),this._keyPressHandled=!1)}_keyPress(N){let z;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(N)===!1)return!1;if(this.cancel(N),N.charCode)z=N.charCode;else if(N.which===null||N.which===void 0)z=N.keyCode;else{if(N.which===0||N.charCode===0)return!1;z=N.which}return!(!z||(N.altKey||N.ctrlKey||N.metaKey)&&!this._isThirdLevelShift(this.browser,N)||(z=String.fromCharCode(z),this._onKey.fire({key:z,domEvent:N}),this._showCursor(),this.coreService.triggerDataEvent(z,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(N){if(N.data&&N.inputType==="insertText"&&(!N.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let z=N.data;return this.coreService.triggerDataEvent(z,!0),this.cancel(N),!0}return!1}resize(N,z){N!==this.cols||z!==this.rows?super.resize(N,z):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(N,z){var ie,Z;(ie=this._charSizeService)===null||ie===void 0||ie.measure(),(Z=this.viewport)===null||Z===void 0||Z.syncScrollArea(!0)}clear(){var N;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let z=1;z<this.rows;z++)this.buffer.lines.push(this.buffer.getBlankLine(I.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(N=this.viewport)===null||N===void 0||N.reset(),this.refresh(0,this.rows-1)}}reset(){var N,z;this.options.rows=this.rows,this.options.cols=this.cols;let ie=this._customKeyEventHandler;this._setup(),super.reset(),(N=this._selectionService)===null||N===void 0||N.reset(),this._decorationService.reset(),(z=this.viewport)===null||z===void 0||z.reset(),this._customKeyEventHandler=ie,this.refresh(0,this.rows-1)}clearTextureAtlas(){var N;(N=this._renderService)===null||N===void 0||N.clearTextureAtlas()}_reportFocus(){var N;!((N=this.element)===null||N===void 0)&&N.classList.contains("focus")?this.coreService.triggerDataEvent(L.C0.ESC+"[I"):this.coreService.triggerDataEvent(L.C0.ESC+"[O")}_reportWindowsOptions(N){if(this._renderService)switch(N){case B.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let z=this._renderService.dimensions.css.canvas.width.toFixed(0),ie=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${L.C0.ESC}[4;${ie};${z}t`);break;case B.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let Z=this._renderService.dimensions.css.cell.width.toFixed(0),ne=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${L.C0.ESC}[6;${ne};${Z}t`)}}cancel(N,z){if(this.options.cancelEvents||z)return N.preventDefault(),N.stopPropagation(),!1}}o.Terminal=Y},9924:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TimeBasedDebouncer=void 0,o.TimeBasedDebouncer=class{constructor(a,l=1e3){this._renderCallback=a,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,l,h){this._rowCount=h,a=a!==void 0?a:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l;let u=Date.now();if(u-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=u,this._innerRefresh();else if(!this._additionalRefreshRequested){let c=u-this._lastRefreshMs,f=this._debounceThresholdMS-c;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},f)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let a=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,l)}}},1680:function(n,o,a){var l=this&&this.__decorate||function(v,g,_,x){var b,y=arguments.length,S=y<3?g:x===null?x=Object.getOwnPropertyDescriptor(g,_):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(v,g,_,x);else for(var w=v.length-1;w>=0;w--)(b=v[w])&&(S=(y<3?b(S):y>3?b(g,_,S):b(g,_))||S);return y>3&&S&&Object.defineProperty(g,_,S),S},h=this&&this.__param||function(v,g){return function(_,x){g(_,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Viewport=void 0;let u=a(3656),c=a(4725),f=a(8460),d=a(844),m=a(2585),p=o.Viewport=class extends d.Disposable{constructor(v,g,_,x,b,y,S,w){super(),this._viewportElement=v,this._scrollArea=g,this._bufferService=_,this._optionsService=x,this._charSizeService=b,this._renderService=y,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(M=>this._activeBuffer=M.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(M=>this._renderDimensions=M)),this._handleThemeChange(w.colors),this.register(w.onChangeColors(M=>this._handleThemeChange(M))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(v){this._viewportElement.style.backgroundColor=v.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(v){if(v)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let g=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==g&&(this._lastRecordedBufferHeight=g,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let v=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==v&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=v),this._refreshAnimationFrame=null}syncScrollArea(v=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(v);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(v)}_handleScroll(v){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let g=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:g,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let v=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(v*(this._smoothScrollState.target-this._smoothScrollState.origin)),v<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(v,g){let _=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(g<0&&this._viewportElement.scrollTop!==0||g>0&&_<this._lastRecordedBufferHeight)||(v.cancelable&&v.preventDefault(),!1)}handleWheel(v){let g=this._getPixelsScrolled(v);return g!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+g:this._smoothScrollState.target+=g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=g,this._bubbleScroll(v,g))}scrollLines(v){if(v!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let g=v*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:v,suppressScrollEvent:!1})}_getPixelsScrolled(v){if(v.deltaY===0||v.shiftKey)return 0;let g=this._applyScrollModifier(v.deltaY,v);return v.deltaMode===WheelEvent.DOM_DELTA_LINE?g*=this._currentRowHeight:v.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._currentRowHeight*this._bufferService.rows),g}getBufferElements(v,g){var _;let x,b="",y=[],S=g!=null?g:this._bufferService.buffer.lines.length,w=this._bufferService.buffer.lines;for(let M=v;M<S;M++){let C=w.get(M);if(!C)continue;let E=(_=w.get(M+1))===null||_===void 0?void 0:_.isWrapped;if(b+=C.translateToString(!E),!E||M===w.length-1){let P=document.createElement("div");P.textContent=b,y.push(P),b.length>0&&(x=P),b=""}}return{bufferElements:y,cursorElement:x}}getLinesScrolled(v){if(v.deltaY===0||v.shiftKey)return 0;let g=this._applyScrollModifier(v.deltaY,v);return v.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(g/=this._currentRowHeight+0,this._wheelPartialScroll+=g,g=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):v.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._bufferService.rows),g}_applyScrollModifier(v,g){let _=this._optionsService.rawOptions.fastScrollModifier;return _==="alt"&&g.altKey||_==="ctrl"&&g.ctrlKey||_==="shift"&&g.shiftKey?v*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:v*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(v){this._lastTouchY=v.touches[0].pageY}handleTouchMove(v){let g=this._lastTouchY-v.touches[0].pageY;return this._lastTouchY=v.touches[0].pageY,g!==0&&(this._viewportElement.scrollTop+=g,this._bubbleScroll(v,g))}};o.Viewport=p=l([h(2,m.IBufferService),h(3,m.IOptionsService),h(4,c.ICharSizeService),h(5,c.IRenderService),h(6,c.ICoreBrowserService),h(7,c.IThemeService)],p)},3107:function(n,o,a){var l=this&&this.__decorate||function(p,v,g,_){var x,b=arguments.length,y=b<3?v:_===null?_=Object.getOwnPropertyDescriptor(v,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(p,v,g,_);else for(var S=p.length-1;S>=0;S--)(x=p[S])&&(y=(b<3?x(y):b>3?x(v,g,y):x(v,g))||y);return b>3&&y&&Object.defineProperty(v,g,y),y},h=this&&this.__param||function(p,v){return function(g,_){v(g,_,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferDecorationRenderer=void 0;let u=a(3656),c=a(4725),f=a(844),d=a(2585),m=o.BufferDecorationRenderer=class extends f.Disposable{constructor(p,v,g,_){super(),this._screenElement=p,this._bufferService=v,this._decorationService=g,this._renderService=_,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,u.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(x=>this._removeDecoration(x))),this.register((0,f.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let p of this._decorationService.decorations)this._renderDecoration(p);this._dimensionsChanged=!1}_renderDecoration(p){this._refreshStyle(p),this._dimensionsChanged&&this._refreshXPosition(p)}_createElement(p){var v,g;let _=document.createElement("div");_.classList.add("xterm-decoration"),_.classList.toggle("xterm-decoration-top-layer",((v=p==null?void 0:p.options)===null||v===void 0?void 0:v.layer)==="top"),_.style.width=`${Math.round((p.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,_.style.height=(p.options.height||1)*this._renderService.dimensions.css.cell.height+"px",_.style.top=(p.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",_.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let x=(g=p.options.x)!==null&&g!==void 0?g:0;return x&&x>this._bufferService.cols&&(_.style.display="none"),this._refreshXPosition(p,_),_}_refreshStyle(p){let v=p.marker.line-this._bufferService.buffers.active.ydisp;if(v<0||v>=this._bufferService.rows)p.element&&(p.element.style.display="none",p.onRenderEmitter.fire(p.element));else{let g=this._decorationElements.get(p);g||(g=this._createElement(p),p.element=g,this._decorationElements.set(p,g),this._container.appendChild(g),p.onDispose(()=>{this._decorationElements.delete(p),g.remove()})),g.style.top=v*this._renderService.dimensions.css.cell.height+"px",g.style.display=this._altBufferIsActive?"none":"block",p.onRenderEmitter.fire(g)}}_refreshXPosition(p,v=p.element){var g;if(!v)return;let _=(g=p.options.x)!==null&&g!==void 0?g:0;(p.options.anchor||"left")==="right"?v.style.right=_?_*this._renderService.dimensions.css.cell.width+"px":"":v.style.left=_?_*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(p){var v;(v=this._decorationElements.get(p))===null||v===void 0||v.remove(),this._decorationElements.delete(p),p.dispose()}};o.BufferDecorationRenderer=m=l([h(1,d.IBufferService),h(2,d.IDecorationService),h(3,c.IRenderService)],m)},5871:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorZoneStore=void 0,o.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(let l of this._zones)if(l.color===a.options.overviewRulerOptions.color&&l.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(l,a.marker.line))return;if(this._lineAdjacentToZone(l,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(l,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,l){return l>=a.startBufferLine&&l<=a.endBufferLine}_lineAdjacentToZone(a,l,h){return l>=a.startBufferLine-this._linePadding[h||"full"]&&l<=a.endBufferLine+this._linePadding[h||"full"]}_addLineToZone(a,l){a.startBufferLine=Math.min(a.startBufferLine,l),a.endBufferLine=Math.max(a.endBufferLine,l)}}},5744:function(n,o,a){var l=this&&this.__decorate||function(x,b,y,S){var w,M=arguments.length,C=M<3?b:S===null?S=Object.getOwnPropertyDescriptor(b,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(x,b,y,S);else for(var E=x.length-1;E>=0;E--)(w=x[E])&&(C=(M<3?w(C):M>3?w(b,y,C):w(b,y))||C);return M>3&&C&&Object.defineProperty(b,y,C),C},h=this&&this.__param||function(x,b){return function(y,S){b(y,S,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OverviewRulerRenderer=void 0;let u=a(5871),c=a(3656),f=a(4725),d=a(844),m=a(2585),p={full:0,left:0,center:0,right:0},v={full:0,left:0,center:0,right:0},g={full:0,left:0,center:0,right:0},_=o.OverviewRulerRenderer=class extends d.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(x,b,y,S,w,M,C){var E;super(),this._viewportElement=x,this._screenElement=b,this._bufferService=y,this._decorationService=S,this._renderService=w,this._optionsService=M,this._coreBrowseService=C,this._colorZoneStore=new u.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(E=this._viewportElement.parentElement)===null||E===void 0||E.insertBefore(this._canvas,this._viewportElement);let P=this._canvas.getContext("2d");if(!P)throw new Error("Ctx cannot be null");this._ctx=P,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,d.toDisposable)(()=>{var A;(A=this._canvas)===null||A===void 0||A.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,c.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let x=Math.floor(this._canvas.width/3),b=Math.ceil(this._canvas.width/3);v.full=this._canvas.width,v.left=x,v.center=b,v.right=x,this._refreshDrawHeightConstants(),g.full=0,g.left=0,g.center=v.left,g.right=v.left+v.center}_refreshDrawHeightConstants(){p.full=Math.round(2*this._coreBrowseService.dpr);let x=this._canvas.height/this._bufferService.buffer.lines.length,b=Math.round(Math.max(Math.min(x,12),6)*this._coreBrowseService.dpr);p.left=b,p.center=b,p.right=b}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*p.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*p.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*p.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*p.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let b of this._decorationService.decorations)this._colorZoneStore.addDecoration(b);this._ctx.lineWidth=1;let x=this._colorZoneStore.zones;for(let b of x)b.position!=="full"&&this._renderColorZone(b);for(let b of x)b.position==="full"&&this._renderColorZone(b);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(x){this._ctx.fillStyle=x.color,this._ctx.fillRect(g[x.position||"full"],Math.round((this._canvas.height-1)*(x.startBufferLine/this._bufferService.buffers.active.lines.length)-p[x.position||"full"]/2),v[x.position||"full"],Math.round((this._canvas.height-1)*((x.endBufferLine-x.startBufferLine)/this._bufferService.buffers.active.lines.length)+p[x.position||"full"]))}_queueRefresh(x,b){this._shouldUpdateDimensions=x||this._shouldUpdateDimensions,this._shouldUpdateAnchor=b||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};o.OverviewRulerRenderer=_=l([h(2,m.IBufferService),h(3,m.IDecorationService),h(4,f.IRenderService),h(5,m.IOptionsService),h(6,f.ICoreBrowserService)],_)},2950:function(n,o,a){var l=this&&this.__decorate||function(m,p,v,g){var _,x=arguments.length,b=x<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(m,p,v,g);else for(var y=m.length-1;y>=0;y--)(_=m[y])&&(b=(x<3?_(b):x>3?_(p,v,b):_(p,v))||b);return x>3&&b&&Object.defineProperty(p,v,b),b},h=this&&this.__param||function(m,p){return function(v,g){p(v,g,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CompositionHelper=void 0;let u=a(4725),c=a(2585),f=a(2584),d=o.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(m,p,v,g,_,x){this._textarea=m,this._compositionView=p,this._bufferService=v,this._optionsService=g,this._coreService=_,this._renderService=x,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(m){this._compositionView.textContent=m.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(m){if(this._isComposing||this._isSendingComposition){if(m.keyCode===229||m.keyCode===16||m.keyCode===17||m.keyCode===18)return!1;this._finalizeComposition(!1)}return m.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(m){if(this._compositionView.classList.remove("active"),this._isComposing=!1,m){let p={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let v;this._isSendingComposition=!1,p.start+=this._dataAlreadySent.length,v=this._isComposing?this._textarea.value.substring(p.start,p.end):this._textarea.value.substring(p.start),v.length>0&&this._coreService.triggerDataEvent(v,!0)}},0)}else{this._isSendingComposition=!1;let p=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(p,!0)}}_handleAnyTextareaChanges(){let m=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let p=this._textarea.value,v=p.replace(m,"");this._dataAlreadySent=v,p.length>m.length?this._coreService.triggerDataEvent(v,!0):p.length<m.length?this._coreService.triggerDataEvent(`${f.C0.DEL}`,!0):p.length===m.length&&p!==m&&this._coreService.triggerDataEvent(p,!0)}},0)}updateCompositionElements(m){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let p=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),v=this._renderService.dimensions.css.cell.height,g=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,_=p*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=_+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=v+"px",this._compositionView.style.lineHeight=v+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let x=this._compositionView.getBoundingClientRect();this._textarea.style.left=_+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max(x.width,1)+"px",this._textarea.style.height=Math.max(x.height,1)+"px",this._textarea.style.lineHeight=x.height+"px"}m||setTimeout(()=>this.updateCompositionElements(!0),0)}}};o.CompositionHelper=d=l([h(2,c.IBufferService),h(3,c.IOptionsService),h(4,c.ICoreService),h(5,u.IRenderService)],d)},9806:(n,o)=>{function a(l,h,u){let c=u.getBoundingClientRect(),f=l.getComputedStyle(u),d=parseInt(f.getPropertyValue("padding-left")),m=parseInt(f.getPropertyValue("padding-top"));return[h.clientX-c.left-d,h.clientY-c.top-m]}Object.defineProperty(o,"__esModule",{value:!0}),o.getCoords=o.getCoordsRelativeToElement=void 0,o.getCoordsRelativeToElement=a,o.getCoords=function(l,h,u,c,f,d,m,p,v){if(!d)return;let g=a(l,h,u);return g?(g[0]=Math.ceil((g[0]+(v?m/2:0))/m),g[1]=Math.ceil(g[1]/p),g[0]=Math.min(Math.max(g[0],1),c+(v?1:0)),g[1]=Math.min(Math.max(g[1],1),f),g):void 0}},9504:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.moveToCellSequence=void 0;let l=a(2584);function h(p,v,g,_){let x=p-u(p,g),b=v-u(v,g),y=Math.abs(x-b)-function(S,w,M){let C=0,E=S-u(S,M),P=w-u(w,M);for(let A=0;A<Math.abs(E-P);A++){let R=c(S,w)==="A"?-1:1,k=M.buffer.lines.get(E+R*A);k!=null&&k.isWrapped&&C++}return C}(p,v,g);return m(y,d(c(p,v),_))}function u(p,v){let g=0,_=v.buffer.lines.get(p),x=_==null?void 0:_.isWrapped;for(;x&&p>=0&&p<v.rows;)g++,_=v.buffer.lines.get(--p),x=_==null?void 0:_.isWrapped;return g}function c(p,v){return p>v?"A":"B"}function f(p,v,g,_,x,b){let y=p,S=v,w="";for(;y!==g||S!==_;)y+=x?1:-1,x&&y>b.cols-1?(w+=b.buffer.translateBufferLineToString(S,!1,p,y),y=0,p=0,S++):!x&&y<0&&(w+=b.buffer.translateBufferLineToString(S,!1,0,p+1),y=b.cols-1,p=y,S--);return w+b.buffer.translateBufferLineToString(S,!1,p,y)}function d(p,v){let g=v?"O":"[";return l.C0.ESC+g+p}function m(p,v){p=Math.floor(p);let g="";for(let _=0;_<p;_++)g+=v;return g}o.moveToCellSequence=function(p,v,g,_){let x=g.buffer.x,b=g.buffer.y;if(!g.buffer.hasScrollback)return function(w,M,C,E,P,A){return h(M,E,P,A).length===0?"":m(f(w,M,w,M-u(M,P),!1,P).length,d("D",A))}(x,b,0,v,g,_)+h(b,v,g,_)+function(w,M,C,E,P,A){let R;R=h(M,E,P,A).length>0?E-u(E,P):M;let k=E,I=function(L,T,O,D,F,B){let U;return U=h(O,D,F,B).length>0?D-u(D,F):T,L<O&&U<=D||L>=O&&U<D?"C":"D"}(w,M,C,E,P,A);return m(f(w,R,C,k,I==="C",P).length,d(I,A))}(x,b,p,v,g,_);let y;if(b===v)return y=x>p?"D":"C",m(Math.abs(x-p),d(y,_));y=b>v?"D":"C";let S=Math.abs(b-v);return m(function(w,M){return M.cols-w}(b>v?p:x,g)+(S-1)*g.cols+1+((b>v?x:p)-1),d(y,_))}},1296:function(n,o,a){var l=this&&this.__decorate||function(P,A,R,k){var I,L=arguments.length,T=L<3?A:k===null?k=Object.getOwnPropertyDescriptor(A,R):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(P,A,R,k);else for(var O=P.length-1;O>=0;O--)(I=P[O])&&(T=(L<3?I(T):L>3?I(A,R,T):I(A,R))||T);return L>3&&T&&Object.defineProperty(A,R,T),T},h=this&&this.__param||function(P,A){return function(R,k){A(R,k,P)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRenderer=void 0;let u=a(3787),c=a(2550),f=a(2223),d=a(6171),m=a(4725),p=a(8055),v=a(8460),g=a(844),_=a(2585),x="xterm-dom-renderer-owner-",b="xterm-rows",y="xterm-fg-",S="xterm-bg-",w="xterm-focus",M="xterm-selection",C=1,E=o.DomRenderer=class extends g.Disposable{constructor(P,A,R,k,I,L,T,O,D,F){super(),this._element=P,this._screenElement=A,this._viewportElement=R,this._linkifier2=k,this._charSizeService=L,this._optionsService=T,this._bufferService=O,this._coreBrowserService=D,this._themeService=F,this._terminalClass=C++,this._rowElements=[],this.onRequestRedraw=this.register(new v.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(b),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(M),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,d.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(B=>this._injectCss(B))),this._injectCss(this._themeService.colors),this._rowFactory=I.createInstance(u.DomRendererRowFactory,document),this._element.classList.add(x+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(B=>this._handleLinkHover(B))),this.register(this._linkifier2.onHideLinkUnderline(B=>this._handleLinkLeave(B))),this.register((0,g.toDisposable)(()=>{this._element.classList.remove(x+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new c.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let P=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*P,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*P),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/P),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/P),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let R of this._rowElements)R.style.width=`${this.dimensions.css.canvas.width}px`,R.style.height=`${this.dimensions.css.cell.height}px`,R.style.lineHeight=`${this.dimensions.css.cell.height}px`,R.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let A=`${this._terminalSelector} .${b} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=A,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(P){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let A=`${this._terminalSelector} .${b} { color: ${P.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;A+=`${this._terminalSelector} .${b} .xterm-dim { color: ${p.color.multiplyOpacity(P.foreground,.5).css};}`,A+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,A+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",A+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${P.cursor.css};  color: ${P.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${P.cursor.css}; }}`,A+=`${this._terminalSelector} .${b}.${w} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${b}.${w} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-block { background-color: ${P.cursor.css}; color: ${P.cursorAccent.css};}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${P.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${P.cursor.css} inset;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${P.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,A+=`${this._terminalSelector} .${M} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${M} div { position: absolute; background-color: ${P.selectionBackgroundOpaque.css};}${this._terminalSelector} .${M} div { position: absolute; background-color: ${P.selectionInactiveBackgroundOpaque.css};}`;for(let[R,k]of P.ansi.entries())A+=`${this._terminalSelector} .${y}${R} { color: ${k.css}; }${this._terminalSelector} .${y}${R}.xterm-dim { color: ${p.color.multiplyOpacity(k,.5).css}; }${this._terminalSelector} .${S}${R} { background-color: ${k.css}; }`;A+=`${this._terminalSelector} .${y}${f.INVERTED_DEFAULT_COLOR} { color: ${p.color.opaque(P.background).css}; }${this._terminalSelector} .${y}${f.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${p.color.multiplyOpacity(p.color.opaque(P.background),.5).css}; }${this._terminalSelector} .${S}${f.INVERTED_DEFAULT_COLOR} { background-color: ${P.foreground.css}; }`,this._themeStyleElement.textContent=A}_setDefaultSpacing(){let P=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${P}px`,this._rowFactory.defaultSpacing=P}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(P,A){for(let R=this._rowElements.length;R<=A;R++){let k=document.createElement("div");this._rowContainer.appendChild(k),this._rowElements.push(k)}for(;this._rowElements.length>A;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(P,A){this._refreshRowElements(P,A),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(w)}handleFocus(){this._rowContainer.classList.add(w),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(P,A,R){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(P,A,R),this.renderRows(0,this._bufferService.rows-1),!P||!A)return;let k=P[1]-this._bufferService.buffer.ydisp,I=A[1]-this._bufferService.buffer.ydisp,L=Math.max(k,0),T=Math.min(I,this._bufferService.rows-1);if(L>=this._bufferService.rows||T<0)return;let O=document.createDocumentFragment();if(R){let D=P[0]>A[0];O.appendChild(this._createSelectionElement(L,D?A[0]:P[0],D?P[0]:A[0],T-L+1))}else{let D=k===L?P[0]:0,F=L===I?A[0]:this._bufferService.cols;O.appendChild(this._createSelectionElement(L,D,F));let B=T-L-1;if(O.appendChild(this._createSelectionElement(L+1,0,this._bufferService.cols,B)),L!==T){let U=I===T?A[0]:this._bufferService.cols;O.appendChild(this._createSelectionElement(T,0,U))}}this._selectionContainer.appendChild(O)}_createSelectionElement(P,A,R,k=1){let I=document.createElement("div");return I.style.height=k*this.dimensions.css.cell.height+"px",I.style.top=P*this.dimensions.css.cell.height+"px",I.style.left=A*this.dimensions.css.cell.width+"px",I.style.width=this.dimensions.css.cell.width*(R-A)+"px",I}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let P of this._rowElements)P.replaceChildren()}renderRows(P,A){let R=this._bufferService.buffer,k=R.ybase+R.y,I=Math.min(R.x,this._bufferService.cols-1),L=this._optionsService.rawOptions.cursorBlink,T=this._optionsService.rawOptions.cursorStyle,O=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=P;D<=A;D++){let F=D+R.ydisp,B=this._rowElements[D],U=R.lines.get(F);if(!B||!U)break;B.replaceChildren(...this._rowFactory.createRow(U,F,F===k,T,O,I,L,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${x}${this._terminalClass}`}_handleLinkHover(P){this._setCellUnderline(P.x1,P.x2,P.y1,P.y2,P.cols,!0)}_handleLinkLeave(P){this._setCellUnderline(P.x1,P.x2,P.y1,P.y2,P.cols,!1)}_setCellUnderline(P,A,R,k,I,L){R<0&&(P=0),k<0&&(A=0);let T=this._bufferService.rows-1;R=Math.max(Math.min(R,T),0),k=Math.max(Math.min(k,T),0),I=Math.min(I,this._bufferService.cols);let O=this._bufferService.buffer,D=O.ybase+O.y,F=Math.min(O.x,I-1),B=this._optionsService.rawOptions.cursorBlink,U=this._optionsService.rawOptions.cursorStyle,G=this._optionsService.rawOptions.cursorInactiveStyle;for(let Y=R;Y<=k;++Y){let re=Y+O.ydisp,N=this._rowElements[Y],z=O.lines.get(re);if(!N||!z)break;N.replaceChildren(...this._rowFactory.createRow(z,re,re===D,U,G,F,B,this.dimensions.css.cell.width,this._widthCache,L?Y===R?P:0:-1,L?(Y===k?A:I)-1:-1))}}};o.DomRenderer=E=l([h(4,_.IInstantiationService),h(5,m.ICharSizeService),h(6,_.IOptionsService),h(7,_.IBufferService),h(8,m.ICoreBrowserService),h(9,m.IThemeService)],E)},3787:function(n,o,a){var l=this&&this.__decorate||function(y,S,w,M){var C,E=arguments.length,P=E<3?S:M===null?M=Object.getOwnPropertyDescriptor(S,w):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(y,S,w,M);else for(var A=y.length-1;A>=0;A--)(C=y[A])&&(P=(E<3?C(P):E>3?C(S,w,P):C(S,w))||P);return E>3&&P&&Object.defineProperty(S,w,P),P},h=this&&this.__param||function(y,S){return function(w,M){S(w,M,y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRendererRowFactory=void 0;let u=a(2223),c=a(643),f=a(511),d=a(2585),m=a(8055),p=a(4725),v=a(4269),g=a(6171),_=a(3734),x=o.DomRendererRowFactory=class{constructor(y,S,w,M,C,E,P){this._document=y,this._characterJoinerService=S,this._optionsService=w,this._coreBrowserService=M,this._coreService=C,this._decorationService=E,this._themeService=P,this._workCell=new f.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(y,S,w){this._selectionStart=y,this._selectionEnd=S,this._columnSelectMode=w}createRow(y,S,w,M,C,E,P,A,R,k,I){let L=[],T=this._characterJoinerService.getJoinedCharacters(S),O=this._themeService.colors,D,F=y.getNoBgTrimmedLength();w&&F<E+1&&(F=E+1);let B=0,U="",G=0,Y=0,re=0,N=!1,z=0,ie=!1,Z=0,ne=[],K=k!==-1&&I!==-1;for(let ae=0;ae<F;ae++){y.loadCell(ae,this._workCell);let ue=this._workCell.getWidth();if(ue===0)continue;let _e=!1,Re=ae,Le=this._workCell;if(T.length>0&&ae===T[0][0]){_e=!0;let Ge=T.shift();Le=new v.JoinedCellData(this._workCell,y.translateToString(!0,Ge[0],Ge[1]),Ge[1]-Ge[0]),Re=Ge[1]-1,ue=Le.getWidth()}let Et=this._isCellInSelection(ae,S),it=w&&ae===E,je=K&&ae>=k&&ae<=I,ut=!1;this._decorationService.forEachDecorationAtCell(ae,S,void 0,Ge=>{ut=!0});let jt=Le.getChars()||c.WHITESPACE_CELL_CHAR;if(jt===" "&&(Le.isUnderline()||Le.isOverline())&&(jt="\xA0"),Z=ue*A-R.get(jt,Le.isBold(),Le.isItalic()),D){if(B&&(Et&&ie||!Et&&!ie&&Le.bg===G)&&(Et&&ie&&O.selectionForeground||Le.fg===Y)&&Le.extended.ext===re&&je===N&&Z===z&&!it&&!_e&&!ut){U+=jt,B++;continue}B&&(D.textContent=U),D=this._document.createElement("span"),B=0,U=""}else D=this._document.createElement("span");if(G=Le.bg,Y=Le.fg,re=Le.extended.ext,N=je,z=Z,ie=Et,_e&&E>=ae&&E<=Re&&(E=ae),!this._coreService.isCursorHidden&&it){if(ne.push("xterm-cursor"),this._coreBrowserService.isFocused)P&&ne.push("xterm-cursor-blink"),ne.push(M==="bar"?"xterm-cursor-bar":M==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(C)switch(C){case"outline":ne.push("xterm-cursor-outline");break;case"block":ne.push("xterm-cursor-block");break;case"bar":ne.push("xterm-cursor-bar");break;case"underline":ne.push("xterm-cursor-underline")}}if(Le.isBold()&&ne.push("xterm-bold"),Le.isItalic()&&ne.push("xterm-italic"),Le.isDim()&&ne.push("xterm-dim"),U=Le.isInvisible()?c.WHITESPACE_CELL_CHAR:Le.getChars()||c.WHITESPACE_CELL_CHAR,Le.isUnderline()&&(ne.push(`xterm-underline-${Le.extended.underlineStyle}`),U===" "&&(U="\xA0"),!Le.isUnderlineColorDefault()))if(Le.isUnderlineColorRGB())D.style.textDecorationColor=`rgb(${_.AttributeData.toColorRGB(Le.getUnderlineColor()).join(",")})`;else{let Ge=Le.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Le.isBold()&&Ge<8&&(Ge+=8),D.style.textDecorationColor=O.ansi[Ge].css}Le.isOverline()&&(ne.push("xterm-overline"),U===" "&&(U="\xA0")),Le.isStrikethrough()&&ne.push("xterm-strikethrough"),je&&(D.style.textDecoration="underline");let Wt=Le.getFgColor(),X=Le.getFgColorMode(),V=Le.getBgColor(),me=Le.getBgColorMode(),Ce=!!Le.isInverse();if(Ce){let Ge=Wt;Wt=V,V=Ge;let gt=X;X=me,me=gt}let De,He,Qe,de=!1;switch(this._decorationService.forEachDecorationAtCell(ae,S,void 0,Ge=>{Ge.options.layer!=="top"&&de||(Ge.backgroundColorRGB&&(me=50331648,V=Ge.backgroundColorRGB.rgba>>8&16777215,De=Ge.backgroundColorRGB),Ge.foregroundColorRGB&&(X=50331648,Wt=Ge.foregroundColorRGB.rgba>>8&16777215,He=Ge.foregroundColorRGB),de=Ge.options.layer==="top")}),!de&&Et&&(De=this._coreBrowserService.isFocused?O.selectionBackgroundOpaque:O.selectionInactiveBackgroundOpaque,V=De.rgba>>8&16777215,me=50331648,de=!0,O.selectionForeground&&(X=50331648,Wt=O.selectionForeground.rgba>>8&16777215,He=O.selectionForeground)),de&&ne.push("xterm-decoration-top"),me){case 16777216:case 33554432:Qe=O.ansi[V],ne.push(`xterm-bg-${V}`);break;case 50331648:Qe=m.rgba.toColor(V>>16,V>>8&255,255&V),this._addStyle(D,`background-color:#${b((V>>>0).toString(16),"0",6)}`);break;default:Ce?(Qe=O.foreground,ne.push(`xterm-bg-${u.INVERTED_DEFAULT_COLOR}`)):Qe=O.background}switch(De||Le.isDim()&&(De=m.color.multiplyOpacity(Qe,.5)),X){case 16777216:case 33554432:Le.isBold()&&Wt<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Wt+=8),this._applyMinimumContrast(D,Qe,O.ansi[Wt],Le,De,void 0)||ne.push(`xterm-fg-${Wt}`);break;case 50331648:let Ge=m.rgba.toColor(Wt>>16&255,Wt>>8&255,255&Wt);this._applyMinimumContrast(D,Qe,Ge,Le,De,He)||this._addStyle(D,`color:#${b(Wt.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(D,Qe,O.foreground,Le,De,void 0)||Ce&&ne.push(`xterm-fg-${u.INVERTED_DEFAULT_COLOR}`)}ne.length&&(D.className=ne.join(" "),ne.length=0),it||_e||ut?D.textContent=U:B++,Z!==this.defaultSpacing&&(D.style.letterSpacing=`${Z}px`),L.push(D),ae=Re}return D&&B&&(D.textContent=U),L}_applyMinimumContrast(y,S,w,M,C,E){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,g.excludeFromContrastRatioDemands)(M.getCode()))return!1;let P=this._getContrastCache(M),A;if(C||E||(A=P.getColor(S.rgba,w.rgba)),A===void 0){let R=this._optionsService.rawOptions.minimumContrastRatio/(M.isDim()?2:1);A=m.color.ensureContrastRatio(C||S,E||w,R),P.setColor((C||S).rgba,(E||w).rgba,A!=null?A:null)}return!!A&&(this._addStyle(y,`color:${A.css}`),!0)}_getContrastCache(y){return y.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(y,S){y.setAttribute("style",`${y.getAttribute("style")||""}${S};`)}_isCellInSelection(y,S){let w=this._selectionStart,M=this._selectionEnd;return!(!w||!M)&&(this._columnSelectMode?w[0]<=M[0]?y>=w[0]&&S>=w[1]&&y<M[0]&&S<=M[1]:y<w[0]&&S>=w[1]&&y>=M[0]&&S<=M[1]:S>w[1]&&S<M[1]||w[1]===M[1]&&S===w[1]&&y>=w[0]&&y<M[0]||w[1]<M[1]&&S===M[1]&&y<M[0]||w[1]<M[1]&&S===w[1]&&y>=w[0])}};function b(y,S,w){for(;y.length<w;)y=S+y;return y}o.DomRendererRowFactory=x=l([h(1,p.ICharacterJoinerService),h(2,d.IOptionsService),h(3,p.ICoreBrowserService),h(4,d.ICoreService),h(5,d.IDecorationService),h(6,p.IThemeService)],x)},2550:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WidthCache=void 0,o.WidthCache=class{constructor(a){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let l=a.createElement("span"),h=a.createElement("span");h.style.fontWeight="bold";let u=a.createElement("span");u.style.fontStyle="italic";let c=a.createElement("span");c.style.fontWeight="bold",c.style.fontStyle="italic",this._measureElements=[l,h,u,c],this._container.appendChild(l),this._container.appendChild(h),this._container.appendChild(u),this._container.appendChild(c),a.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,l,h,u){a===this._font&&l===this._fontSize&&h===this._weight&&u===this._weightBold||(this._font=a,this._fontSize=l,this._weight=h,this._weightBold=u,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${h}`,this._measureElements[1].style.fontWeight=`${u}`,this._measureElements[2].style.fontWeight=`${h}`,this._measureElements[3].style.fontWeight=`${u}`,this.clear())}get(a,l,h){let u=0;if(!l&&!h&&a.length===1&&(u=a.charCodeAt(0))<256)return this._flat[u]!==-9999?this._flat[u]:this._flat[u]=this._measure(a,0);let c=a;l&&(c+="B"),h&&(c+="I");let f=this._holey.get(c);if(f===void 0){let d=0;l&&(d|=1),h&&(d|=2),f=this._measure(a,d),this._holey.set(c,f)}return f}_measure(a,l){let h=this._measureElements[l];return h.textContent=a.repeat(32),h.offsetWidth/32}}},2223:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;let l=a(6114);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=l.isFirefox||l.isLegacyEdge?"bottom":"ideographic"},6171:(n,o)=>{function a(l){return 57508<=l&&l<=57558}Object.defineProperty(o,"__esModule",{value:!0}),o.createRenderDimensions=o.excludeFromContrastRatioDemands=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(l){if(!l)throw new Error("value must not be falsy");return l},o.isPowerlineGlyph=a,o.isRestrictedPowerlineGlyph=function(l){return 57520<=l&&l<=57527},o.excludeFromContrastRatioDemands=function(l){return a(l)||function(h){return 9472<=h&&h<=9631}(l)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionModel=void 0,o.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let a=this.selectionStart,l=this.selectionEnd;return!(!a||!l)&&(a[1]>l[1]||a[1]===l[1]&&a[0]>l[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(n,o,a){var l=this&&this.__decorate||function(p,v,g,_){var x,b=arguments.length,y=b<3?v:_===null?_=Object.getOwnPropertyDescriptor(v,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(p,v,g,_);else for(var S=p.length-1;S>=0;S--)(x=p[S])&&(y=(b<3?x(y):b>3?x(v,g,y):x(v,g))||y);return b>3&&y&&Object.defineProperty(v,g,y),y},h=this&&this.__param||function(p,v){return function(g,_){v(g,_,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharSizeService=void 0;let u=a(2585),c=a(8460),f=a(844),d=o.CharSizeService=class extends f.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(p,v,g){super(),this._optionsService=g,this.width=0,this.height=0,this._onCharSizeChange=this.register(new c.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new m(p,v,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let p=this._measureStrategy.measure();p.width===this.width&&p.height===this.height||(this.width=p.width,this.height=p.height,this._onCharSizeChange.fire())}};o.CharSizeService=d=l([h(2,u.IOptionsService)],d);class m{constructor(v,g,_){this._document=v,this._parentElement=g,this._optionsService=_,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let v={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return v.width!==0&&v.height!==0&&(this._result.width=v.width/32,this._result.height=Math.ceil(v.height)),this._result}}},4269:function(n,o,a){var l=this&&this.__decorate||function(v,g,_,x){var b,y=arguments.length,S=y<3?g:x===null?x=Object.getOwnPropertyDescriptor(g,_):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(v,g,_,x);else for(var w=v.length-1;w>=0;w--)(b=v[w])&&(S=(y<3?b(S):y>3?b(g,_,S):b(g,_))||S);return y>3&&S&&Object.defineProperty(g,_,S),S},h=this&&this.__param||function(v,g){return function(_,x){g(_,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;let u=a(3734),c=a(643),f=a(511),d=a(2585);class m extends u.AttributeData{constructor(g,_,x){super(),this.content=0,this.combinedData="",this.fg=g.fg,this.bg=g.bg,this.combinedData=_,this._width=x}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(g){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=m;let p=o.CharacterJoinerService=class T3{constructor(g){this._bufferService=g,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new f.CellData}register(g){let _={id:this._nextCharacterJoinerId++,handler:g};return this._characterJoiners.push(_),_.id}deregister(g){for(let _=0;_<this._characterJoiners.length;_++)if(this._characterJoiners[_].id===g)return this._characterJoiners.splice(_,1),!0;return!1}getJoinedCharacters(g){if(this._characterJoiners.length===0)return[];let _=this._bufferService.buffer.lines.get(g);if(!_||_.length===0)return[];let x=[],b=_.translateToString(!0),y=0,S=0,w=0,M=_.getFg(0),C=_.getBg(0);for(let E=0;E<_.getTrimmedLength();E++)if(_.loadCell(E,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==M||this._workCell.bg!==C){if(E-y>1){let P=this._getJoinedRanges(b,w,S,_,y);for(let A=0;A<P.length;A++)x.push(P[A])}y=E,w=S,M=this._workCell.fg,C=this._workCell.bg}S+=this._workCell.getChars().length||c.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-y>1){let E=this._getJoinedRanges(b,w,S,_,y);for(let P=0;P<E.length;P++)x.push(E[P])}return x}_getJoinedRanges(g,_,x,b,y){let S=g.substring(_,x),w=[];try{w=this._characterJoiners[0].handler(S)}catch(M){console.error(M)}for(let M=1;M<this._characterJoiners.length;M++)try{let C=this._characterJoiners[M].handler(S);for(let E=0;E<C.length;E++)T3._mergeRanges(w,C[E])}catch(C){console.error(C)}return this._stringRangesToCellRanges(w,b,y),w}_stringRangesToCellRanges(g,_,x){let b=0,y=!1,S=0,w=g[b];if(w){for(let M=x;M<this._bufferService.cols;M++){let C=_.getWidth(M),E=_.getString(M).length||c.WHITESPACE_CELL_CHAR.length;if(C!==0){if(!y&&w[0]<=S&&(w[0]=M,y=!0),w[1]<=S){if(w[1]=M,w=g[++b],!w)break;w[0]<=S?(w[0]=M,y=!0):y=!1}S+=E}}w&&(w[1]=this._bufferService.cols)}}static _mergeRanges(g,_){let x=!1;for(let b=0;b<g.length;b++){let y=g[b];if(x){if(_[1]<=y[0])return g[b-1][1]=_[1],g;if(_[1]<=y[1])return g[b-1][1]=Math.max(_[1],y[1]),g.splice(b,1),g;g.splice(b,1),b--}else{if(_[1]<=y[0])return g.splice(b,0,_),g;if(_[1]<=y[1])return y[0]=Math.min(_[0],y[0]),g;_[0]<y[1]&&(y[0]=Math.min(_[0],y[0]),x=!0)}}return x?g[g.length-1][1]=_[1]:g.push(_),g}};o.CharacterJoinerService=p=l([h(0,d.IBufferService)],p)},5114:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreBrowserService=void 0,o.CoreBrowserService=class{constructor(a,l){this._textarea=a,this.window=l,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(n,o,a){var l=this&&this.__decorate||function(d,m,p,v){var g,_=arguments.length,x=_<3?m:v===null?v=Object.getOwnPropertyDescriptor(m,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(d,m,p,v);else for(var b=d.length-1;b>=0;b--)(g=d[b])&&(x=(_<3?g(x):_>3?g(m,p,x):g(m,p))||x);return _>3&&x&&Object.defineProperty(m,p,x),x},h=this&&this.__param||function(d,m){return function(p,v){m(p,v,d)}};Object.defineProperty(o,"__esModule",{value:!0}),o.MouseService=void 0;let u=a(4725),c=a(9806),f=o.MouseService=class{constructor(d,m){this._renderService=d,this._charSizeService=m}getCoords(d,m,p,v,g){return(0,c.getCoords)(window,d,m,p,v,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,g)}getMouseReportCoords(d,m){let p=(0,c.getCoordsRelativeToElement)(window,d,m);if(this._charSizeService.hasValidSize)return p[0]=Math.min(Math.max(p[0],0),this._renderService.dimensions.css.canvas.width-1),p[1]=Math.min(Math.max(p[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(p[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(p[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(p[0]),y:Math.floor(p[1])}}};o.MouseService=f=l([h(0,u.IRenderService),h(1,u.ICharSizeService)],f)},3230:function(n,o,a){var l=this&&this.__decorate||function(x,b,y,S){var w,M=arguments.length,C=M<3?b:S===null?S=Object.getOwnPropertyDescriptor(b,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(x,b,y,S);else for(var E=x.length-1;E>=0;E--)(w=x[E])&&(C=(M<3?w(C):M>3?w(b,y,C):w(b,y))||C);return M>3&&C&&Object.defineProperty(b,y,C),C},h=this&&this.__param||function(x,b){return function(y,S){b(y,S,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.RenderService=void 0;let u=a(3656),c=a(6193),f=a(5596),d=a(4725),m=a(8460),p=a(844),v=a(7226),g=a(2585),_=o.RenderService=class extends p.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(x,b,y,S,w,M,C,E){if(super(),this._rowCount=x,this._charSizeService=S,this._renderer=this.register(new p.MutableDisposable),this._pausedResizeTask=new v.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new m.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new m.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new m.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new m.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new c.RenderDebouncer(C.window,(P,A)=>this._renderRows(P,A)),this.register(this._renderDebouncer),this._screenDprMonitor=new f.ScreenDprMonitor(C.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(M.onResize(()=>this._fullRefresh())),this.register(M.buffers.onBufferActivate(()=>{var P;return(P=this._renderer.value)===null||P===void 0?void 0:P.clear()})),this.register(y.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(w.onDecorationRegistered(()=>this._fullRefresh())),this.register(w.onDecorationRemoved(()=>this._fullRefresh())),this.register(y.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(M.cols,M.rows),this._fullRefresh()})),this.register(y.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(M.buffer.y,M.buffer.y,!0))),this.register((0,u.addDisposableDomListener)(C.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(E.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in C.window){let P=new C.window.IntersectionObserver(A=>this._handleIntersectionChange(A[A.length-1]),{threshold:0});P.observe(b),this.register({dispose:()=>P.disconnect()})}}_handleIntersectionChange(x){this._isPaused=x.isIntersecting===void 0?x.intersectionRatio===0:!x.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(x,b,y=!1){this._isPaused?this._needsFullRefresh=!0:(y||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(x,b,this._rowCount))}_renderRows(x,b){this._renderer.value&&(x=Math.min(x,this._rowCount-1),b=Math.min(b,this._rowCount-1),this._renderer.value.renderRows(x,b),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:x,end:b}),this._onRender.fire({start:x,end:b}),this._isNextRenderRedrawOnly=!0)}resize(x,b){this._rowCount=b,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(x){this._renderer.value=x,this._renderer.value.onRequestRedraw(b=>this.refreshRows(b.start,b.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(x){return this._renderDebouncer.addRefreshCallback(x)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var x,b;this._renderer.value&&((b=(x=this._renderer.value).clearTextureAtlas)===null||b===void 0||b.call(x),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(x,b){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(x,b)):this._renderer.value.handleResize(x,b),this._fullRefresh())}handleCharSizeChanged(){var x;(x=this._renderer.value)===null||x===void 0||x.handleCharSizeChanged()}handleBlur(){var x;(x=this._renderer.value)===null||x===void 0||x.handleBlur()}handleFocus(){var x;(x=this._renderer.value)===null||x===void 0||x.handleFocus()}handleSelectionChanged(x,b,y){var S;this._selectionState.start=x,this._selectionState.end=b,this._selectionState.columnSelectMode=y,(S=this._renderer.value)===null||S===void 0||S.handleSelectionChanged(x,b,y)}handleCursorMove(){var x;(x=this._renderer.value)===null||x===void 0||x.handleCursorMove()}clear(){var x;(x=this._renderer.value)===null||x===void 0||x.clear()}};o.RenderService=_=l([h(2,g.IOptionsService),h(3,d.ICharSizeService),h(4,g.IDecorationService),h(5,g.IBufferService),h(6,d.ICoreBrowserService),h(7,d.IThemeService)],_)},9312:function(n,o,a){var l=this&&this.__decorate||function(w,M,C,E){var P,A=arguments.length,R=A<3?M:E===null?E=Object.getOwnPropertyDescriptor(M,C):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(w,M,C,E);else for(var k=w.length-1;k>=0;k--)(P=w[k])&&(R=(A<3?P(R):A>3?P(M,C,R):P(M,C))||R);return A>3&&R&&Object.defineProperty(M,C,R),R},h=this&&this.__param||function(w,M){return function(C,E){M(C,E,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionService=void 0;let u=a(9806),c=a(9504),f=a(456),d=a(4725),m=a(8460),p=a(844),v=a(6114),g=a(4841),_=a(511),x=a(2585),b="\xA0",y=new RegExp(b,"g"),S=o.SelectionService=class extends p.Disposable{constructor(w,M,C,E,P,A,R,k,I){super(),this._element=w,this._screenElement=M,this._linkifier=C,this._bufferService=E,this._coreService=P,this._mouseService=A,this._optionsService=R,this._renderService=k,this._coreBrowserService=I,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new _.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new m.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new m.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new m.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new m.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=L=>this._handleMouseMove(L),this._mouseUpListener=L=>this._handleMouseUp(L),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(L=>this._handleTrim(L)),this.register(this._bufferService.buffers.onBufferActivate(L=>this._handleBufferActivate(L))),this.enable(),this._model=new f.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,p.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let w=this._model.finalSelectionStart,M=this._model.finalSelectionEnd;return!(!w||!M||w[0]===M[0]&&w[1]===M[1])}get selectionText(){let w=this._model.finalSelectionStart,M=this._model.finalSelectionEnd;if(!w||!M)return"";let C=this._bufferService.buffer,E=[];if(this._activeSelectionMode===3){if(w[0]===M[0])return"";let P=w[0]<M[0]?w[0]:M[0],A=w[0]<M[0]?M[0]:w[0];for(let R=w[1];R<=M[1];R++){let k=C.translateBufferLineToString(R,!0,P,A);E.push(k)}}else{let P=w[1]===M[1]?M[0]:void 0;E.push(C.translateBufferLineToString(w[1],!0,w[0],P));for(let A=w[1]+1;A<=M[1]-1;A++){let R=C.lines.get(A),k=C.translateBufferLineToString(A,!0);R!=null&&R.isWrapped?E[E.length-1]+=k:E.push(k)}if(w[1]!==M[1]){let A=C.lines.get(M[1]),R=C.translateBufferLineToString(M[1],!0,0,M[0]);A&&A.isWrapped?E[E.length-1]+=R:E.push(R)}}return E.map(P=>P.replace(y," ")).join(v.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(w){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),v.isLinux&&w&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(w){let M=this._getMouseBufferCoords(w),C=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!!(C&&E&&M)&&this._areCoordsInSelection(M,C,E)}isCellInSelection(w,M){let C=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!(!C||!E)&&this._areCoordsInSelection([w,M],C,E)}_areCoordsInSelection(w,M,C){return w[1]>M[1]&&w[1]<C[1]||M[1]===C[1]&&w[1]===M[1]&&w[0]>=M[0]&&w[0]<C[0]||M[1]<C[1]&&w[1]===C[1]&&w[0]<C[0]||M[1]<C[1]&&w[1]===M[1]&&w[0]>=M[0]}_selectWordAtCursor(w,M){var C,E;let P=(E=(C=this._linkifier.currentLink)===null||C===void 0?void 0:C.link)===null||E===void 0?void 0:E.range;if(P)return this._model.selectionStart=[P.start.x-1,P.start.y-1],this._model.selectionStartLength=(0,g.getRangeLength)(P,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let A=this._getMouseBufferCoords(w);return!!A&&(this._selectWordAt(A,M),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(w,M){this._model.clearSelection(),w=Math.max(w,0),M=Math.min(M,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,w],this._model.selectionEnd=[this._bufferService.cols,M],this.refresh(),this._onSelectionChange.fire()}_handleTrim(w){this._model.handleTrim(w)&&this.refresh()}_getMouseBufferCoords(w){let M=this._mouseService.getCoords(w,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(M)return M[0]--,M[1]--,M[1]+=this._bufferService.buffer.ydisp,M}_getMouseEventScrollAmount(w){let M=(0,u.getCoordsRelativeToElement)(this._coreBrowserService.window,w,this._screenElement)[1],C=this._renderService.dimensions.css.canvas.height;return M>=0&&M<=C?0:(M>C&&(M-=C),M=Math.min(Math.max(M,-50),50),M/=50,M/Math.abs(M)+Math.round(14*M))}shouldForceSelection(w){return v.isMac?w.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:w.shiftKey}handleMouseDown(w){if(this._mouseDownTimeStamp=w.timeStamp,(w.button!==2||!this.hasSelection)&&w.button===0){if(!this._enabled){if(!this.shouldForceSelection(w))return;w.stopPropagation()}w.preventDefault(),this._dragScrollAmount=0,this._enabled&&w.shiftKey?this._handleIncrementalClick(w):w.detail===1?this._handleSingleClick(w):w.detail===2?this._handleDoubleClick(w):w.detail===3&&this._handleTripleClick(w),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(w){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(w))}_handleSingleClick(w){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(w)?3:0,this._model.selectionStart=this._getMouseBufferCoords(w),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let M=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);M&&M.length!==this._model.selectionStart[0]&&M.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(w){this._selectWordAtCursor(w,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(w){let M=this._getMouseBufferCoords(w);M&&(this._activeSelectionMode=2,this._selectLineAt(M[1]))}shouldColumnSelect(w){return w.altKey&&!(v.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(w){if(w.stopImmediatePropagation(),!this._model.selectionStart)return;let M=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(w),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(w),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let C=this._bufferService.buffer;if(this._model.selectionEnd[1]<C.lines.length){let E=C.lines.get(this._model.selectionEnd[1]);E&&E.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}M&&M[0]===this._model.selectionEnd[0]&&M[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let w=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(w.ydisp+this._bufferService.rows,w.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=w.ydisp),this.refresh()}}_handleMouseUp(w){let M=w.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&M<500&&w.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let C=this._mouseService.getCoords(w,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(C&&C[0]!==void 0&&C[1]!==void 0){let E=(0,c.moveToCellSequence)(C[0]-1,C[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(E,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let w=this._model.finalSelectionStart,M=this._model.finalSelectionEnd,C=!(!w||!M||w[0]===M[0]&&w[1]===M[1]);C?w&&M&&(this._oldSelectionStart&&this._oldSelectionEnd&&w[0]===this._oldSelectionStart[0]&&w[1]===this._oldSelectionStart[1]&&M[0]===this._oldSelectionEnd[0]&&M[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(w,M,C)):this._oldHasSelection&&this._fireOnSelectionChange(w,M,C)}_fireOnSelectionChange(w,M,C){this._oldSelectionStart=w,this._oldSelectionEnd=M,this._oldHasSelection=C,this._onSelectionChange.fire()}_handleBufferActivate(w){this.clearSelection(),this._trimListener.dispose(),this._trimListener=w.activeBuffer.lines.onTrim(M=>this._handleTrim(M))}_convertViewportColToCharacterIndex(w,M){let C=M;for(let E=0;M>=E;E++){let P=w.loadCell(E,this._workCell).getChars().length;this._workCell.getWidth()===0?C--:P>1&&M!==E&&(C+=P-1)}return C}setSelection(w,M,C){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[w,M],this._model.selectionStartLength=C,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(w){this._isClickInSelection(w)||(this._selectWordAtCursor(w,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(w,M,C=!0,E=!0){if(w[0]>=this._bufferService.cols)return;let P=this._bufferService.buffer,A=P.lines.get(w[1]);if(!A)return;let R=P.translateBufferLineToString(w[1],!1),k=this._convertViewportColToCharacterIndex(A,w[0]),I=k,L=w[0]-k,T=0,O=0,D=0,F=0;if(R.charAt(k)===" "){for(;k>0&&R.charAt(k-1)===" ";)k--;for(;I<R.length&&R.charAt(I+1)===" ";)I++}else{let G=w[0],Y=w[0];A.getWidth(G)===0&&(T++,G--),A.getWidth(Y)===2&&(O++,Y++);let re=A.getString(Y).length;for(re>1&&(F+=re-1,I+=re-1);G>0&&k>0&&!this._isCharWordSeparator(A.loadCell(G-1,this._workCell));){A.loadCell(G-1,this._workCell);let N=this._workCell.getChars().length;this._workCell.getWidth()===0?(T++,G--):N>1&&(D+=N-1,k-=N-1),k--,G--}for(;Y<A.length&&I+1<R.length&&!this._isCharWordSeparator(A.loadCell(Y+1,this._workCell));){A.loadCell(Y+1,this._workCell);let N=this._workCell.getChars().length;this._workCell.getWidth()===2?(O++,Y++):N>1&&(F+=N-1,I+=N-1),I++,Y++}}I++;let B=k+L-T+D,U=Math.min(this._bufferService.cols,I-k+T+O-D-F);if(M||R.slice(k,I).trim()!==""){if(C&&B===0&&A.getCodePoint(0)!==32){let G=P.lines.get(w[1]-1);if(G&&A.isWrapped&&G.getCodePoint(this._bufferService.cols-1)!==32){let Y=this._getWordAt([this._bufferService.cols-1,w[1]-1],!1,!0,!1);if(Y){let re=this._bufferService.cols-Y.start;B-=re,U+=re}}}if(E&&B+U===this._bufferService.cols&&A.getCodePoint(this._bufferService.cols-1)!==32){let G=P.lines.get(w[1]+1);if(G!=null&&G.isWrapped&&G.getCodePoint(0)!==32){let Y=this._getWordAt([0,w[1]+1],!1,!1,!0);Y&&(U+=Y.length)}}return{start:B,length:U}}}_selectWordAt(w,M){let C=this._getWordAt(w,M);if(C){for(;C.start<0;)C.start+=this._bufferService.cols,w[1]--;this._model.selectionStart=[C.start,w[1]],this._model.selectionStartLength=C.length}}_selectToWordAt(w){let M=this._getWordAt(w,!0);if(M){let C=w[1];for(;M.start<0;)M.start+=this._bufferService.cols,C--;if(!this._model.areSelectionValuesReversed())for(;M.start+M.length>this._bufferService.cols;)M.length-=this._bufferService.cols,C++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?M.start:M.start+M.length,C]}}_isCharWordSeparator(w){return w.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(w.getChars())>=0}_selectLineAt(w){let M=this._bufferService.buffer.getWrappedRangeForLine(w),C={start:{x:0,y:M.first},end:{x:this._bufferService.cols-1,y:M.last}};this._model.selectionStart=[0,M.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,g.getRangeLength)(C,this._bufferService.cols)}};o.SelectionService=S=l([h(3,x.IBufferService),h(4,x.ICoreService),h(5,d.IMouseService),h(6,x.IOptionsService),h(7,d.IRenderService),h(8,d.ICoreBrowserService)],S)},4725:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IThemeService=o.ICharacterJoinerService=o.ISelectionService=o.IRenderService=o.IMouseService=o.ICoreBrowserService=o.ICharSizeService=void 0;let l=a(8343);o.ICharSizeService=(0,l.createDecorator)("CharSizeService"),o.ICoreBrowserService=(0,l.createDecorator)("CoreBrowserService"),o.IMouseService=(0,l.createDecorator)("MouseService"),o.IRenderService=(0,l.createDecorator)("RenderService"),o.ISelectionService=(0,l.createDecorator)("SelectionService"),o.ICharacterJoinerService=(0,l.createDecorator)("CharacterJoinerService"),o.IThemeService=(0,l.createDecorator)("ThemeService")},6731:function(n,o,a){var l=this&&this.__decorate||function(S,w,M,C){var E,P=arguments.length,A=P<3?w:C===null?C=Object.getOwnPropertyDescriptor(w,M):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(S,w,M,C);else for(var R=S.length-1;R>=0;R--)(E=S[R])&&(A=(P<3?E(A):P>3?E(w,M,A):E(w,M))||A);return P>3&&A&&Object.defineProperty(w,M,A),A},h=this&&this.__param||function(S,w){return function(M,C){w(M,C,S)}};Object.defineProperty(o,"__esModule",{value:!0}),o.ThemeService=o.DEFAULT_ANSI_COLORS=void 0;let u=a(7239),c=a(8055),f=a(8460),d=a(844),m=a(2585),p=c.css.toColor("#ffffff"),v=c.css.toColor("#000000"),g=c.css.toColor("#ffffff"),_=c.css.toColor("#000000"),x={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};o.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let S=[c.css.toColor("#2e3436"),c.css.toColor("#cc0000"),c.css.toColor("#4e9a06"),c.css.toColor("#c4a000"),c.css.toColor("#3465a4"),c.css.toColor("#75507b"),c.css.toColor("#06989a"),c.css.toColor("#d3d7cf"),c.css.toColor("#555753"),c.css.toColor("#ef2929"),c.css.toColor("#8ae234"),c.css.toColor("#fce94f"),c.css.toColor("#729fcf"),c.css.toColor("#ad7fa8"),c.css.toColor("#34e2e2"),c.css.toColor("#eeeeec")],w=[0,95,135,175,215,255];for(let M=0;M<216;M++){let C=w[M/36%6|0],E=w[M/6%6|0],P=w[M%6];S.push({css:c.channels.toCss(C,E,P),rgba:c.channels.toRgba(C,E,P)})}for(let M=0;M<24;M++){let C=8+10*M;S.push({css:c.channels.toCss(C,C,C),rgba:c.channels.toRgba(C,C,C)})}return S})());let b=o.ThemeService=class extends d.Disposable{get colors(){return this._colors}constructor(S){super(),this._optionsService=S,this._contrastCache=new u.ColorContrastCache,this._halfContrastCache=new u.ColorContrastCache,this._onChangeColors=this.register(new f.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:p,background:v,cursor:g,cursorAccent:_,selectionForeground:void 0,selectionBackgroundTransparent:x,selectionBackgroundOpaque:c.color.blend(v,x),selectionInactiveBackgroundTransparent:x,selectionInactiveBackgroundOpaque:c.color.blend(v,x),ansi:o.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(S={}){let w=this._colors;if(w.foreground=y(S.foreground,p),w.background=y(S.background,v),w.cursor=y(S.cursor,g),w.cursorAccent=y(S.cursorAccent,_),w.selectionBackgroundTransparent=y(S.selectionBackground,x),w.selectionBackgroundOpaque=c.color.blend(w.background,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundTransparent=y(S.selectionInactiveBackground,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundOpaque=c.color.blend(w.background,w.selectionInactiveBackgroundTransparent),w.selectionForeground=S.selectionForeground?y(S.selectionForeground,c.NULL_COLOR):void 0,w.selectionForeground===c.NULL_COLOR&&(w.selectionForeground=void 0),c.color.isOpaque(w.selectionBackgroundTransparent)&&(w.selectionBackgroundTransparent=c.color.opacity(w.selectionBackgroundTransparent,.3)),c.color.isOpaque(w.selectionInactiveBackgroundTransparent)&&(w.selectionInactiveBackgroundTransparent=c.color.opacity(w.selectionInactiveBackgroundTransparent,.3)),w.ansi=o.DEFAULT_ANSI_COLORS.slice(),w.ansi[0]=y(S.black,o.DEFAULT_ANSI_COLORS[0]),w.ansi[1]=y(S.red,o.DEFAULT_ANSI_COLORS[1]),w.ansi[2]=y(S.green,o.DEFAULT_ANSI_COLORS[2]),w.ansi[3]=y(S.yellow,o.DEFAULT_ANSI_COLORS[3]),w.ansi[4]=y(S.blue,o.DEFAULT_ANSI_COLORS[4]),w.ansi[5]=y(S.magenta,o.DEFAULT_ANSI_COLORS[5]),w.ansi[6]=y(S.cyan,o.DEFAULT_ANSI_COLORS[6]),w.ansi[7]=y(S.white,o.DEFAULT_ANSI_COLORS[7]),w.ansi[8]=y(S.brightBlack,o.DEFAULT_ANSI_COLORS[8]),w.ansi[9]=y(S.brightRed,o.DEFAULT_ANSI_COLORS[9]),w.ansi[10]=y(S.brightGreen,o.DEFAULT_ANSI_COLORS[10]),w.ansi[11]=y(S.brightYellow,o.DEFAULT_ANSI_COLORS[11]),w.ansi[12]=y(S.brightBlue,o.DEFAULT_ANSI_COLORS[12]),w.ansi[13]=y(S.brightMagenta,o.DEFAULT_ANSI_COLORS[13]),w.ansi[14]=y(S.brightCyan,o.DEFAULT_ANSI_COLORS[14]),w.ansi[15]=y(S.brightWhite,o.DEFAULT_ANSI_COLORS[15]),S.extendedAnsi){let M=Math.min(w.ansi.length-16,S.extendedAnsi.length);for(let C=0;C<M;C++)w.ansi[C+16]=y(S.extendedAnsi[C],o.DEFAULT_ANSI_COLORS[C+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(S){this._restoreColor(S),this._onChangeColors.fire(this.colors)}_restoreColor(S){if(S!==void 0)switch(S){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[S]=this._restoreColors.ansi[S]}else for(let w=0;w<this._restoreColors.ansi.length;++w)this._colors.ansi[w]=this._restoreColors.ansi[w]}modifyColors(S){S(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function y(S,w){if(S!==void 0)try{return c.css.toColor(S)}catch(M){}return w}o.ThemeService=b=l([h(0,m.IOptionsService)],b)},6349:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CircularList=void 0;let l=a(8460),h=a(844);class u extends h.Disposable{constructor(f){super(),this._maxLength=f,this.onDeleteEmitter=this.register(new l.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new l.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new l.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(f){if(this._maxLength===f)return;let d=new Array(f);for(let m=0;m<Math.min(f,this.length);m++)d[m]=this._array[this._getCyclicIndex(m)];this._array=d,this._maxLength=f,this._startIndex=0}get length(){return this._length}set length(f){if(f>this._length)for(let d=this._length;d<f;d++)this._array[d]=void 0;this._length=f}get(f){return this._array[this._getCyclicIndex(f)]}set(f,d){this._array[this._getCyclicIndex(f)]=d}push(f){this._array[this._getCyclicIndex(this._length)]=f,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(f,d,...m){if(d){for(let p=f;p<this._length-d;p++)this._array[this._getCyclicIndex(p)]=this._array[this._getCyclicIndex(p+d)];this._length-=d,this.onDeleteEmitter.fire({index:f,amount:d})}for(let p=this._length-1;p>=f;p--)this._array[this._getCyclicIndex(p+m.length)]=this._array[this._getCyclicIndex(p)];for(let p=0;p<m.length;p++)this._array[this._getCyclicIndex(f+p)]=m[p];if(m.length&&this.onInsertEmitter.fire({index:f,amount:m.length}),this._length+m.length>this._maxLength){let p=this._length+m.length-this._maxLength;this._startIndex+=p,this._length=this._maxLength,this.onTrimEmitter.fire(p)}else this._length+=m.length}trimStart(f){f>this._length&&(f=this._length),this._startIndex+=f,this._length-=f,this.onTrimEmitter.fire(f)}shiftElements(f,d,m){if(!(d<=0)){if(f<0||f>=this._length)throw new Error("start argument out of range");if(f+m<0)throw new Error("Cannot shift elements in list beyond index 0");if(m>0){for(let v=d-1;v>=0;v--)this.set(f+v+m,this.get(f+v));let p=f+d+m-this._length;if(p>0)for(this._length+=p;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let p=0;p<d;p++)this.set(f+p+m,this.get(f+p))}}_getCyclicIndex(f){return(this._startIndex+f)%this._maxLength}}o.CircularList=u},1439:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clone=void 0,o.clone=function a(l,h=5){if(typeof l!="object")return l;let u=Array.isArray(l)?[]:{};for(let c in l)u[c]=h<=1?l[c]:l[c]&&a(l[c],h-1);return u}},8055:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let l=a(6114),h=0,u=0,c=0,f=0;var d,m,p,v,g;function _(b){let y=b.toString(16);return y.length<2?"0"+y:y}function x(b,y){return b<y?(y+.05)/(b+.05):(b+.05)/(y+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},function(b){b.toCss=function(y,S,w,M){return M!==void 0?`#${_(y)}${_(S)}${_(w)}${_(M)}`:`#${_(y)}${_(S)}${_(w)}`},b.toRgba=function(y,S,w,M=255){return(y<<24|S<<16|w<<8|M)>>>0}}(d||(o.channels=d={})),function(b){function y(S,w){return f=Math.round(255*w),[h,u,c]=g.toChannels(S.rgba),{css:d.toCss(h,u,c,f),rgba:d.toRgba(h,u,c,f)}}b.blend=function(S,w){if(f=(255&w.rgba)/255,f===1)return{css:w.css,rgba:w.rgba};let M=w.rgba>>24&255,C=w.rgba>>16&255,E=w.rgba>>8&255,P=S.rgba>>24&255,A=S.rgba>>16&255,R=S.rgba>>8&255;return h=P+Math.round((M-P)*f),u=A+Math.round((C-A)*f),c=R+Math.round((E-R)*f),{css:d.toCss(h,u,c),rgba:d.toRgba(h,u,c)}},b.isOpaque=function(S){return(255&S.rgba)==255},b.ensureContrastRatio=function(S,w,M){let C=g.ensureContrastRatio(S.rgba,w.rgba,M);if(C)return g.toColor(C>>24&255,C>>16&255,C>>8&255)},b.opaque=function(S){let w=(255|S.rgba)>>>0;return[h,u,c]=g.toChannels(w),{css:d.toCss(h,u,c),rgba:w}},b.opacity=y,b.multiplyOpacity=function(S,w){return f=255&S.rgba,y(S,f*w/255)},b.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}}(m||(o.color=m={})),function(b){let y,S;if(!l.isNode){let w=document.createElement("canvas");w.width=1,w.height=1;let M=w.getContext("2d",{willReadFrequently:!0});M&&(y=M,y.globalCompositeOperation="copy",S=y.createLinearGradient(0,0,1,1))}b.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return h=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),c=parseInt(w.slice(3,4).repeat(2),16),g.toColor(h,u,c);case 5:return h=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),c=parseInt(w.slice(3,4).repeat(2),16),f=parseInt(w.slice(4,5).repeat(2),16),g.toColor(h,u,c,f);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}let M=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(M)return h=parseInt(M[1]),u=parseInt(M[2]),c=parseInt(M[3]),f=Math.round(255*(M[5]===void 0?1:parseFloat(M[5]))),g.toColor(h,u,c,f);if(!y||!S)throw new Error("css.toColor: Unsupported css format");if(y.fillStyle=S,y.fillStyle=w,typeof y.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(y.fillRect(0,0,1,1),[h,u,c,f]=y.getImageData(0,0,1,1).data,f!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:d.toRgba(h,u,c,f),css:w}}}(p||(o.css=p={})),function(b){function y(S,w,M){let C=S/255,E=w/255,P=M/255;return .2126*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.7152*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.0722*(P<=.03928?P/12.92:Math.pow((P+.055)/1.055,2.4))}b.relativeLuminance=function(S){return y(S>>16&255,S>>8&255,255&S)},b.relativeLuminance2=y}(v||(o.rgb=v={})),function(b){function y(w,M,C){let E=w>>24&255,P=w>>16&255,A=w>>8&255,R=M>>24&255,k=M>>16&255,I=M>>8&255,L=x(v.relativeLuminance2(R,k,I),v.relativeLuminance2(E,P,A));for(;L<C&&(R>0||k>0||I>0);)R-=Math.max(0,Math.ceil(.1*R)),k-=Math.max(0,Math.ceil(.1*k)),I-=Math.max(0,Math.ceil(.1*I)),L=x(v.relativeLuminance2(R,k,I),v.relativeLuminance2(E,P,A));return(R<<24|k<<16|I<<8|255)>>>0}function S(w,M,C){let E=w>>24&255,P=w>>16&255,A=w>>8&255,R=M>>24&255,k=M>>16&255,I=M>>8&255,L=x(v.relativeLuminance2(R,k,I),v.relativeLuminance2(E,P,A));for(;L<C&&(R<255||k<255||I<255);)R=Math.min(255,R+Math.ceil(.1*(255-R))),k=Math.min(255,k+Math.ceil(.1*(255-k))),I=Math.min(255,I+Math.ceil(.1*(255-I))),L=x(v.relativeLuminance2(R,k,I),v.relativeLuminance2(E,P,A));return(R<<24|k<<16|I<<8|255)>>>0}b.ensureContrastRatio=function(w,M,C){let E=v.relativeLuminance(w>>8),P=v.relativeLuminance(M>>8);if(x(E,P)<C){if(P<E){let k=y(w,M,C),I=x(E,v.relativeLuminance(k>>8));if(I<C){let L=S(w,M,C);return I>x(E,v.relativeLuminance(L>>8))?k:L}return k}let A=S(w,M,C),R=x(E,v.relativeLuminance(A>>8));if(R<C){let k=y(w,M,C);return R>x(E,v.relativeLuminance(k>>8))?A:k}return A}},b.reduceLuminance=y,b.increaseLuminance=S,b.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]},b.toColor=function(w,M,C,E){return{css:d.toCss(w,M,C,E),rgba:d.toRgba(w,M,C,E)}}}(g||(o.rgba=g={})),o.toPaddedHex=_,o.contrastRatio=x},8969:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreTerminal=void 0;let l=a(844),h=a(2585),u=a(4348),c=a(7866),f=a(744),d=a(7302),m=a(6975),p=a(8460),v=a(1753),g=a(1480),_=a(7994),x=a(9282),b=a(5435),y=a(5981),S=a(2660),w=!1;class M extends l.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new p.EventEmitter),this._onScroll.event(E=>{var P;(P=this._onScrollApi)===null||P===void 0||P.fire(E.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(E){for(let P in E)this.optionsService.options[P]=E[P]}constructor(E){super(),this._windowsWrappingHeuristics=this.register(new l.MutableDisposable),this._onBinary=this.register(new p.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new p.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new p.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new p.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new p.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new p.EventEmitter),this._instantiationService=new u.InstantiationService,this.optionsService=this.register(new d.OptionsService(E)),this._instantiationService.setService(h.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(f.BufferService)),this._instantiationService.setService(h.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(c.LogService)),this._instantiationService.setService(h.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(m.CoreService)),this._instantiationService.setService(h.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(v.CoreMouseService)),this._instantiationService.setService(h.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(g.UnicodeService)),this._instantiationService.setService(h.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(_.CharsetService),this._instantiationService.setService(h.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(S.OscLinkService),this._instantiationService.setService(h.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new b.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,p.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,p.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,p.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,p.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new y.WriteBuffer((P,A)=>this._inputHandler.parse(P,A))),this.register((0,p.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(E,P){this._writeBuffer.write(E,P)}writeSync(E,P){this._logService.logLevel<=h.LogLevelEnum.WARN&&!w&&(this._logService.warn("writeSync is unreliable and will be removed soon."),w=!0),this._writeBuffer.writeSync(E,P)}resize(E,P){isNaN(E)||isNaN(P)||(E=Math.max(E,f.MINIMUM_COLS),P=Math.max(P,f.MINIMUM_ROWS),this._bufferService.resize(E,P))}scroll(E,P=!1){this._bufferService.scroll(E,P)}scrollLines(E,P,A){this._bufferService.scrollLines(E,P,A)}scrollPages(E){this.scrollLines(E*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(E){let P=E-this._bufferService.buffer.ydisp;P!==0&&this.scrollLines(P)}registerEscHandler(E,P){return this._inputHandler.registerEscHandler(E,P)}registerDcsHandler(E,P){return this._inputHandler.registerDcsHandler(E,P)}registerCsiHandler(E,P){return this._inputHandler.registerCsiHandler(E,P)}registerOscHandler(E,P){return this._inputHandler.registerOscHandler(E,P)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let E=!1,P=this.optionsService.rawOptions.windowsPty;P&&P.buildNumber!==void 0&&P.buildNumber!==void 0?E=P.backend==="conpty"&&P.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(E=!0),E?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let E=[];E.push(this.onLineFeed(x.updateWindowsModeWrappedState.bind(null,this._bufferService))),E.push(this.registerCsiHandler({final:"H"},()=>((0,x.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,l.toDisposable)(()=>{for(let P of E)P.dispose()})}}}o.CoreTerminal=M},8460:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let l=0;l<this._listeners.length;l++)if(this._listeners[l]===a)return void this._listeners.splice(l,1)}}})),this._event}fire(a,l){let h=[];for(let u=0;u<this._listeners.length;u++)h.push(this._listeners[u]);for(let u=0;u<h.length;u++)h[u].call(void 0,a,l)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(a,l){return a(h=>l.fire(h))}},5435:function(n,o,a){var l=this&&this.__decorate||function(L,T,O,D){var F,B=arguments.length,U=B<3?T:D===null?D=Object.getOwnPropertyDescriptor(T,O):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")U=Reflect.decorate(L,T,O,D);else for(var G=L.length-1;G>=0;G--)(F=L[G])&&(U=(B<3?F(U):B>3?F(T,O,U):F(T,O))||U);return B>3&&U&&Object.defineProperty(T,O,U),U},h=this&&this.__param||function(L,T){return function(O,D){T(O,D,L)}};Object.defineProperty(o,"__esModule",{value:!0}),o.InputHandler=o.WindowsOptionsReportType=void 0;let u=a(2584),c=a(7116),f=a(2015),d=a(844),m=a(482),p=a(8437),v=a(8460),g=a(643),_=a(511),x=a(3734),b=a(2585),y=a(6242),S=a(6351),w=a(5941),M={"(":0,")":1,"*":2,"+":3,"-":1,".":2},C=131072;function E(L,T){if(L>24)return T.setWinLines||!1;switch(L){case 1:return!!T.restoreWin;case 2:return!!T.minimizeWin;case 3:return!!T.setWinPosition;case 4:return!!T.setWinSizePixels;case 5:return!!T.raiseWin;case 6:return!!T.lowerWin;case 7:return!!T.refreshWin;case 8:return!!T.setWinSizeChars;case 9:return!!T.maximizeWin;case 10:return!!T.fullscreenWin;case 11:return!!T.getWinState;case 13:return!!T.getWinPosition;case 14:return!!T.getWinSizePixels;case 15:return!!T.getScreenSizePixels;case 16:return!!T.getCellSizePixels;case 18:return!!T.getWinSizeChars;case 19:return!!T.getScreenSizeChars;case 20:return!!T.getIconTitle;case 21:return!!T.getWinTitle;case 22:return!!T.pushTitle;case 23:return!!T.popTitle;case 24:return!!T.setWinLines}return!1}var P;(function(L){L[L.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",L[L.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(P||(o.WindowsOptionsReportType=P={}));let A=0;class R extends d.Disposable{getAttrData(){return this._curAttrData}constructor(T,O,D,F,B,U,G,Y,re=new f.EscapeSequenceParser){super(),this._bufferService=T,this._charsetService=O,this._coreService=D,this._logService=F,this._optionsService=B,this._oscLinkService=U,this._coreMouseService=G,this._unicodeService=Y,this._parser=re,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new m.StringToUtf32,this._utf8Decoder=new m.Utf8ToUtf32,this._workCell=new _.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=p.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new v.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new v.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new v.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new v.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new v.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new v.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new v.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new v.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new v.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new v.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new v.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new v.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new v.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new k(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(N=>this._activeBuffer=N.activeBuffer)),this._parser.setCsiHandlerFallback((N,z)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(N),params:z.toArray()})}),this._parser.setEscHandlerFallback(N=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(N)})}),this._parser.setExecuteHandlerFallback(N=>{this._logService.debug("Unknown EXECUTE code: ",{code:N})}),this._parser.setOscHandlerFallback((N,z,ie)=>{this._logService.debug("Unknown OSC code: ",{identifier:N,action:z,data:ie})}),this._parser.setDcsHandlerFallback((N,z,ie)=>{z==="HOOK"&&(ie=ie.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(N),action:z,payload:ie})}),this._parser.setPrintHandler((N,z,ie)=>this.print(N,z,ie)),this._parser.registerCsiHandler({final:"@"},N=>this.insertChars(N)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},N=>this.scrollLeft(N)),this._parser.registerCsiHandler({final:"A"},N=>this.cursorUp(N)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},N=>this.scrollRight(N)),this._parser.registerCsiHandler({final:"B"},N=>this.cursorDown(N)),this._parser.registerCsiHandler({final:"C"},N=>this.cursorForward(N)),this._parser.registerCsiHandler({final:"D"},N=>this.cursorBackward(N)),this._parser.registerCsiHandler({final:"E"},N=>this.cursorNextLine(N)),this._parser.registerCsiHandler({final:"F"},N=>this.cursorPrecedingLine(N)),this._parser.registerCsiHandler({final:"G"},N=>this.cursorCharAbsolute(N)),this._parser.registerCsiHandler({final:"H"},N=>this.cursorPosition(N)),this._parser.registerCsiHandler({final:"I"},N=>this.cursorForwardTab(N)),this._parser.registerCsiHandler({final:"J"},N=>this.eraseInDisplay(N,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},N=>this.eraseInDisplay(N,!0)),this._parser.registerCsiHandler({final:"K"},N=>this.eraseInLine(N,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},N=>this.eraseInLine(N,!0)),this._parser.registerCsiHandler({final:"L"},N=>this.insertLines(N)),this._parser.registerCsiHandler({final:"M"},N=>this.deleteLines(N)),this._parser.registerCsiHandler({final:"P"},N=>this.deleteChars(N)),this._parser.registerCsiHandler({final:"S"},N=>this.scrollUp(N)),this._parser.registerCsiHandler({final:"T"},N=>this.scrollDown(N)),this._parser.registerCsiHandler({final:"X"},N=>this.eraseChars(N)),this._parser.registerCsiHandler({final:"Z"},N=>this.cursorBackwardTab(N)),this._parser.registerCsiHandler({final:"`"},N=>this.charPosAbsolute(N)),this._parser.registerCsiHandler({final:"a"},N=>this.hPositionRelative(N)),this._parser.registerCsiHandler({final:"b"},N=>this.repeatPrecedingCharacter(N)),this._parser.registerCsiHandler({final:"c"},N=>this.sendDeviceAttributesPrimary(N)),this._parser.registerCsiHandler({prefix:">",final:"c"},N=>this.sendDeviceAttributesSecondary(N)),this._parser.registerCsiHandler({final:"d"},N=>this.linePosAbsolute(N)),this._parser.registerCsiHandler({final:"e"},N=>this.vPositionRelative(N)),this._parser.registerCsiHandler({final:"f"},N=>this.hVPosition(N)),this._parser.registerCsiHandler({final:"g"},N=>this.tabClear(N)),this._parser.registerCsiHandler({final:"h"},N=>this.setMode(N)),this._parser.registerCsiHandler({prefix:"?",final:"h"},N=>this.setModePrivate(N)),this._parser.registerCsiHandler({final:"l"},N=>this.resetMode(N)),this._parser.registerCsiHandler({prefix:"?",final:"l"},N=>this.resetModePrivate(N)),this._parser.registerCsiHandler({final:"m"},N=>this.charAttributes(N)),this._parser.registerCsiHandler({final:"n"},N=>this.deviceStatus(N)),this._parser.registerCsiHandler({prefix:"?",final:"n"},N=>this.deviceStatusPrivate(N)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},N=>this.softReset(N)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},N=>this.setCursorStyle(N)),this._parser.registerCsiHandler({final:"r"},N=>this.setScrollRegion(N)),this._parser.registerCsiHandler({final:"s"},N=>this.saveCursor(N)),this._parser.registerCsiHandler({final:"t"},N=>this.windowOptions(N)),this._parser.registerCsiHandler({final:"u"},N=>this.restoreCursor(N)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},N=>this.insertColumns(N)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},N=>this.deleteColumns(N)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},N=>this.selectProtected(N)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},N=>this.requestMode(N,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},N=>this.requestMode(N,!1)),this._parser.setExecuteHandler(u.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(u.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(u.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(u.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(u.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(u.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(u.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(u.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(u.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(u.C1.IND,()=>this.index()),this._parser.setExecuteHandler(u.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(u.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new y.OscHandler(N=>(this.setTitle(N),this.setIconName(N),!0))),this._parser.registerOscHandler(1,new y.OscHandler(N=>this.setIconName(N))),this._parser.registerOscHandler(2,new y.OscHandler(N=>this.setTitle(N))),this._parser.registerOscHandler(4,new y.OscHandler(N=>this.setOrReportIndexedColor(N))),this._parser.registerOscHandler(8,new y.OscHandler(N=>this.setHyperlink(N))),this._parser.registerOscHandler(10,new y.OscHandler(N=>this.setOrReportFgColor(N))),this._parser.registerOscHandler(11,new y.OscHandler(N=>this.setOrReportBgColor(N))),this._parser.registerOscHandler(12,new y.OscHandler(N=>this.setOrReportCursorColor(N))),this._parser.registerOscHandler(104,new y.OscHandler(N=>this.restoreIndexedColor(N))),this._parser.registerOscHandler(110,new y.OscHandler(N=>this.restoreFgColor(N))),this._parser.registerOscHandler(111,new y.OscHandler(N=>this.restoreBgColor(N))),this._parser.registerOscHandler(112,new y.OscHandler(N=>this.restoreCursorColor(N))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let N in c.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:N},()=>this.selectCharset("("+N)),this._parser.registerEscHandler({intermediates:")",final:N},()=>this.selectCharset(")"+N)),this._parser.registerEscHandler({intermediates:"*",final:N},()=>this.selectCharset("*"+N)),this._parser.registerEscHandler({intermediates:"+",final:N},()=>this.selectCharset("+"+N)),this._parser.registerEscHandler({intermediates:"-",final:N},()=>this.selectCharset("-"+N)),this._parser.registerEscHandler({intermediates:".",final:N},()=>this.selectCharset("."+N)),this._parser.registerEscHandler({intermediates:"/",final:N},()=>this.selectCharset("/"+N));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(N=>(this._logService.error("Parsing error: ",N),N)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new S.DcsHandler((N,z)=>this.requestStatusString(N,z)))}_preserveStack(T,O,D,F){this._parseStack.paused=!0,this._parseStack.cursorStartX=T,this._parseStack.cursorStartY=O,this._parseStack.decodedLength=D,this._parseStack.position=F}_logSlowResolvingAsync(T){this._logService.logLevel<=b.LogLevelEnum.WARN&&Promise.race([T,new Promise((O,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(O=>{if(O!=="#SLOW_TIMEOUT")throw O;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(T,O){let D,F=this._activeBuffer.x,B=this._activeBuffer.y,U=0,G=this._parseStack.paused;if(G){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,O))return this._logSlowResolvingAsync(D),D;F=this._parseStack.cursorStartX,B=this._parseStack.cursorStartY,this._parseStack.paused=!1,T.length>C&&(U=this._parseStack.position+C)}if(this._logService.logLevel<=b.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof T=="string"?` "${T}"`:` "${Array.prototype.map.call(T,Y=>String.fromCharCode(Y)).join("")}"`),typeof T=="string"?T.split("").map(Y=>Y.charCodeAt(0)):T),this._parseBuffer.length<T.length&&this._parseBuffer.length<C&&(this._parseBuffer=new Uint32Array(Math.min(T.length,C))),G||this._dirtyRowTracker.clearRange(),T.length>C)for(let Y=U;Y<T.length;Y+=C){let re=Y+C<T.length?Y+C:T.length,N=typeof T=="string"?this._stringDecoder.decode(T.substring(Y,re),this._parseBuffer):this._utf8Decoder.decode(T.subarray(Y,re),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,N))return this._preserveStack(F,B,N,Y),this._logSlowResolvingAsync(D),D}else if(!G){let Y=typeof T=="string"?this._stringDecoder.decode(T,this._parseBuffer):this._utf8Decoder.decode(T,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,Y))return this._preserveStack(F,B,Y,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===F&&this._activeBuffer.y===B||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(T,O,D){let F,B,U=this._charsetService.charset,G=this._optionsService.rawOptions.screenReaderMode,Y=this._bufferService.cols,re=this._coreService.decPrivateModes.wraparound,N=this._coreService.modes.insertMode,z=this._curAttrData,ie=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-O>0&&ie.getWidth(this._activeBuffer.x-1)===2&&ie.setCellFromCodePoint(this._activeBuffer.x-1,0,1,z.fg,z.bg,z.extended);for(let Z=O;Z<D;++Z){if(F=T[Z],B=this._unicodeService.wcwidth(F),F<127&&U){let ne=U[String.fromCharCode(F)];ne&&(F=ne.charCodeAt(0))}if(G&&this._onA11yChar.fire((0,m.stringFromCodePoint)(F)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),B||!this._activeBuffer.x){if(this._activeBuffer.x+B-1>=Y){if(re){for(;this._activeBuffer.x<Y;)ie.setCellFromCodePoint(this._activeBuffer.x++,0,1,z.fg,z.bg,z.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),ie=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=Y-1,B===2)continue}if(N&&(ie.insertCells(this._activeBuffer.x,B,this._activeBuffer.getNullCell(z),z),ie.getWidth(Y-1)===2&&ie.setCellFromCodePoint(Y-1,g.NULL_CELL_CODE,g.NULL_CELL_WIDTH,z.fg,z.bg,z.extended)),ie.setCellFromCodePoint(this._activeBuffer.x++,F,B,z.fg,z.bg,z.extended),B>0)for(;--B;)ie.setCellFromCodePoint(this._activeBuffer.x++,0,0,z.fg,z.bg,z.extended)}else ie.getWidth(this._activeBuffer.x-1)?ie.addCodepointToCell(this._activeBuffer.x-1,F):ie.addCodepointToCell(this._activeBuffer.x-2,F)}D-O>0&&(ie.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<Y&&D-O>0&&ie.getWidth(this._activeBuffer.x)===0&&!ie.hasContent(this._activeBuffer.x)&&ie.setCellFromCodePoint(this._activeBuffer.x,0,1,z.fg,z.bg,z.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(T,O){return T.final!=="t"||T.prefix||T.intermediates?this._parser.registerCsiHandler(T,O):this._parser.registerCsiHandler(T,D=>!E(D.params[0],this._optionsService.rawOptions.windowOptions)||O(D))}registerDcsHandler(T,O){return this._parser.registerDcsHandler(T,new S.DcsHandler(O))}registerEscHandler(T,O){return this._parser.registerEscHandler(T,O)}registerOscHandler(T,O){return this._parser.registerOscHandler(T,new y.OscHandler(O))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var T;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((T=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||T===void 0)&&T.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);O.hasWidth(this._activeBuffer.x)&&!O.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let T=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-T),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(T=this._bufferService.cols-1){this._activeBuffer.x=Math.min(T,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(T,O){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=T,this._activeBuffer.y=this._activeBuffer.scrollTop+O):(this._activeBuffer.x=T,this._activeBuffer.y=O),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(T,O){this._restrictCursor(),this._setCursor(this._activeBuffer.x+T,this._activeBuffer.y+O)}cursorUp(T){let O=this._activeBuffer.y-this._activeBuffer.scrollTop;return O>=0?this._moveCursor(0,-Math.min(O,T.params[0]||1)):this._moveCursor(0,-(T.params[0]||1)),!0}cursorDown(T){let O=this._activeBuffer.scrollBottom-this._activeBuffer.y;return O>=0?this._moveCursor(0,Math.min(O,T.params[0]||1)):this._moveCursor(0,T.params[0]||1),!0}cursorForward(T){return this._moveCursor(T.params[0]||1,0),!0}cursorBackward(T){return this._moveCursor(-(T.params[0]||1),0),!0}cursorNextLine(T){return this.cursorDown(T),this._activeBuffer.x=0,!0}cursorPrecedingLine(T){return this.cursorUp(T),this._activeBuffer.x=0,!0}cursorCharAbsolute(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(T){return this._setCursor(T.length>=2?(T.params[1]||1)-1:0,(T.params[0]||1)-1),!0}charPosAbsolute(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(T){return this._moveCursor(T.params[0]||1,0),!0}linePosAbsolute(T){return this._setCursor(this._activeBuffer.x,(T.params[0]||1)-1),!0}vPositionRelative(T){return this._moveCursor(0,T.params[0]||1),!0}hVPosition(T){return this.cursorPosition(T),!0}tabClear(T){let O=T.params[0];return O===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:O===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let O=T.params[0]||1;for(;O--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let O=T.params[0]||1;for(;O--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(T){let O=T.params[0];return O===1&&(this._curAttrData.bg|=536870912),O!==2&&O!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(T,O,D,F=!1,B=!1){let U=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);U.replaceCells(O,D,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),B),F&&(U.isWrapped=!1)}_resetBufferLine(T,O=!1){let D=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),O),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+T),D.isWrapped=!1)}eraseInDisplay(T,O=!1){let D;switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,O);D<this._bufferService.rows;D++)this._resetBufferLine(D,O);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,O),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,O);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,O);this._dirtyRowTracker.markDirty(0);break;case 3:let F=this._activeBuffer.lines.length-this._bufferService.rows;F>0&&(this._activeBuffer.lines.trimStart(F),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-F,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-F,0),this._onScroll.fire(0))}return!0}eraseInLine(T,O=!1){switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,O);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,O);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,O)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(T){this._restrictCursor();let O=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,B=this._bufferService.rows-1+this._activeBuffer.ybase-F+1;for(;O--;)this._activeBuffer.lines.splice(B-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(T){this._restrictCursor();let O=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let D=this._activeBuffer.ybase+this._activeBuffer.y,F;for(F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,F=this._bufferService.rows-1+this._activeBuffer.ybase-F;O--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(F,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(T){this._restrictCursor();let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return O&&(O.insertCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(T){this._restrictCursor();let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return O&&(O.deleteCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(T){let O=T.params[0]||1;for(;O--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(T){let O=T.params[0]||1;for(;O--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(p.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=T.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);F.deleteCells(0,O,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=T.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);F.insertCells(0,O,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=T.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);F.insertCells(this._activeBuffer.x,O,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=T.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);F.deleteCells(this._activeBuffer.x,O,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(T){this._restrictCursor();let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return O&&(O.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(T.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(T){if(!this._parser.precedingCodepoint)return!0;let O=T.params[0]||1,D=new Uint32Array(O);for(let F=0;F<O;++F)D[F]=this._parser.precedingCodepoint;return this.print(D,0,D.length),!0}sendDeviceAttributesPrimary(T){return T.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(u.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(u.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(T){return T.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(u.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(u.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(T.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(u.C0.ESC+"[>83;40003;0c")),!0}_is(T){return(this._optionsService.rawOptions.termName+"").indexOf(T)===0}setMode(T){for(let O=0;O<T.length;O++)switch(T.params[O]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(T){for(let O=0;O<T.length;O++)switch(T.params[O]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),this._charsetService.setgCharset(1,c.DEFAULT_CHARSET),this._charsetService.setgCharset(2,c.DEFAULT_CHARSET),this._charsetService.setgCharset(3,c.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(T){for(let O=0;O<T.length;O++)switch(T.params[O]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(T){for(let O=0;O<T.length;O++)switch(T.params[O]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),T.params[O]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(T,O){let D=this._coreService.decPrivateModes,{activeProtocol:F,activeEncoding:B}=this._coreMouseService,U=this._coreService,{buffers:G,cols:Y}=this._bufferService,{active:re,alt:N}=G,z=this._optionsService.rawOptions,ie=ae=>ae?1:2,Z=T.params[0];return ne=Z,K=O?Z===2?4:Z===4?ie(U.modes.insertMode):Z===12?3:Z===20?ie(z.convertEol):0:Z===1?ie(D.applicationCursorKeys):Z===3?z.windowOptions.setWinLines?Y===80?2:Y===132?1:0:0:Z===6?ie(D.origin):Z===7?ie(D.wraparound):Z===8?3:Z===9?ie(F==="X10"):Z===12?ie(z.cursorBlink):Z===25?ie(!U.isCursorHidden):Z===45?ie(D.reverseWraparound):Z===66?ie(D.applicationKeypad):Z===67?4:Z===1e3?ie(F==="VT200"):Z===1002?ie(F==="DRAG"):Z===1003?ie(F==="ANY"):Z===1004?ie(D.sendFocus):Z===1005?4:Z===1006?ie(B==="SGR"):Z===1015?4:Z===1016?ie(B==="SGR_PIXELS"):Z===1048?1:Z===47||Z===1047||Z===1049?ie(re===N):Z===2004?ie(D.bracketedPasteMode):0,U.triggerDataEvent(`${u.C0.ESC}[${O?"":"?"}${ne};${K}$y`),!0;var ne,K}_updateAttrColor(T,O,D,F,B){return O===2?(T|=50331648,T&=-16777216,T|=x.AttributeData.fromColorRGB([D,F,B])):O===5&&(T&=-50331904,T|=33554432|255&D),T}_extractColor(T,O,D){let F=[0,0,-1,0,0,0],B=0,U=0;do{if(F[U+B]=T.params[O+U],T.hasSubParams(O+U)){let G=T.getSubParams(O+U),Y=0;do F[1]===5&&(B=1),F[U+Y+1+B]=G[Y];while(++Y<G.length&&Y+U+1+B<F.length);break}if(F[1]===5&&U+B>=2||F[1]===2&&U+B>=5)break;F[1]&&(B=1)}while(++U+O<T.length&&U+B<F.length);for(let G=2;G<F.length;++G)F[G]===-1&&(F[G]=0);switch(F[0]){case 38:D.fg=this._updateAttrColor(D.fg,F[1],F[3],F[4],F[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,F[1],F[3],F[4],F[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,F[1],F[3],F[4],F[5])}return U}_processUnderline(T,O){O.extended=O.extended.clone(),(!~T||T>5)&&(T=1),O.extended.underlineStyle=T,O.fg|=268435456,T===0&&(O.fg&=-268435457),O.updateExtended()}_processSGR0(T){T.fg=p.DEFAULT_ATTR_DATA.fg,T.bg=p.DEFAULT_ATTR_DATA.bg,T.extended=T.extended.clone(),T.extended.underlineStyle=0,T.extended.underlineColor&=-67108864,T.updateExtended()}charAttributes(T){if(T.length===1&&T.params[0]===0)return this._processSGR0(this._curAttrData),!0;let O=T.length,D,F=this._curAttrData;for(let B=0;B<O;B++)D=T.params[B],D>=30&&D<=37?(F.fg&=-50331904,F.fg|=16777216|D-30):D>=40&&D<=47?(F.bg&=-50331904,F.bg|=16777216|D-40):D>=90&&D<=97?(F.fg&=-50331904,F.fg|=16777224|D-90):D>=100&&D<=107?(F.bg&=-50331904,F.bg|=16777224|D-100):D===0?this._processSGR0(F):D===1?F.fg|=134217728:D===3?F.bg|=67108864:D===4?(F.fg|=268435456,this._processUnderline(T.hasSubParams(B)?T.getSubParams(B)[0]:1,F)):D===5?F.fg|=536870912:D===7?F.fg|=67108864:D===8?F.fg|=1073741824:D===9?F.fg|=2147483648:D===2?F.bg|=134217728:D===21?this._processUnderline(2,F):D===22?(F.fg&=-134217729,F.bg&=-134217729):D===23?F.bg&=-67108865:D===24?(F.fg&=-268435457,this._processUnderline(0,F)):D===25?F.fg&=-536870913:D===27?F.fg&=-67108865:D===28?F.fg&=-1073741825:D===29?F.fg&=2147483647:D===39?(F.fg&=-67108864,F.fg|=16777215&p.DEFAULT_ATTR_DATA.fg):D===49?(F.bg&=-67108864,F.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?B+=this._extractColor(T,B,F):D===53?F.bg|=1073741824:D===55?F.bg&=-1073741825:D===59?(F.extended=F.extended.clone(),F.extended.underlineColor=-1,F.updateExtended()):D===100?(F.fg&=-67108864,F.fg|=16777215&p.DEFAULT_ATTR_DATA.fg,F.bg&=-67108864,F.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(T){switch(T.params[0]){case 5:this._coreService.triggerDataEvent(`${u.C0.ESC}[0n`);break;case 6:let O=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${u.C0.ESC}[${O};${D}R`)}return!0}deviceStatusPrivate(T){if(T.params[0]===6){let O=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${u.C0.ESC}[?${O};${D}R`)}return!0}softReset(T){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(T){let O=T.params[0]||1;switch(O){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let D=O%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(T){let O=T.params[0]||1,D;return(T.length<2||(D=T.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>O&&(this._activeBuffer.scrollTop=O-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(T){if(!E(T.params[0],this._optionsService.rawOptions.windowOptions))return!0;let O=T.length>1?T.params[1]:0;switch(T.params[0]){case 14:O!==2&&this._onRequestWindowsOptionsReport.fire(P.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(P.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${u.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:O!==0&&O!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),O!==0&&O!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:O!==0&&O!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),O!==0&&O!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(T){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(T){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(T){return this._windowTitle=T,this._onTitleChange.fire(T),!0}setIconName(T){return this._iconName=T,!0}setOrReportIndexedColor(T){let O=[],D=T.split(";");for(;D.length>1;){let F=D.shift(),B=D.shift();if(/^\d+$/.exec(F)){let U=parseInt(F);if(I(U))if(B==="?")O.push({type:0,index:U});else{let G=(0,w.parseColor)(B);G&&O.push({type:1,index:U,color:G})}}}return O.length&&this._onColor.fire(O),!0}setHyperlink(T){let O=T.split(";");return!(O.length<2)&&(O[1]?this._createHyperlink(O[0],O[1]):!O[0]&&this._finishHyperlink())}_createHyperlink(T,O){this._getCurrentLinkId()&&this._finishHyperlink();let D=T.split(":"),F,B=D.findIndex(U=>U.startsWith("id="));return B!==-1&&(F=D[B].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:F,uri:O}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(T,O){let D=T.split(";");for(let F=0;F<D.length&&!(O>=this._specialColors.length);++F,++O)if(D[F]==="?")this._onColor.fire([{type:0,index:this._specialColors[O]}]);else{let B=(0,w.parseColor)(D[F]);B&&this._onColor.fire([{type:1,index:this._specialColors[O],color:B}])}return!0}setOrReportFgColor(T){return this._setOrReportSpecialColor(T,0)}setOrReportBgColor(T){return this._setOrReportSpecialColor(T,1)}setOrReportCursorColor(T){return this._setOrReportSpecialColor(T,2)}restoreIndexedColor(T){if(!T)return this._onColor.fire([{type:2}]),!0;let O=[],D=T.split(";");for(let F=0;F<D.length;++F)if(/^\d+$/.exec(D[F])){let B=parseInt(D[F]);I(B)&&O.push({type:2,index:B})}return O.length&&this._onColor.fire(O),!0}restoreFgColor(T){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(T){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(T){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),!0}selectCharset(T){return T.length!==2?(this.selectDefaultCharset(),!0):(T[0]==="/"||this._charsetService.setgCharset(M[T[0]],c.CHARSETS[T[1]]||c.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let T=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,T,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=p.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(T){return this._charsetService.setgLevel(T),!0}screenAlignmentPattern(){let T=new _.CellData;T.content=4194373,T.fg=this._curAttrData.fg,T.bg=this._curAttrData.bg,this._setCursor(0,0);for(let O=0;O<this._bufferService.rows;++O){let D=this._activeBuffer.ybase+this._activeBuffer.y+O,F=this._activeBuffer.lines.get(D);F&&(F.fill(T),F.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(T,O){let D=this._bufferService.buffer,F=this._optionsService.rawOptions;return(B=>(this._coreService.triggerDataEvent(`${u.C0.ESC}${B}${u.C0.ESC}\\`),!0))(T==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:T==='"p'?'P1$r61;1"p':T==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:T==="m"?"P1$r0m":T===" q"?`P1$r${{block:2,underline:4,bar:6}[F.cursorStyle]-(F.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(T,O){this._dirtyRowTracker.markRangeDirty(T,O)}}o.InputHandler=R;let k=class{constructor(L){this._bufferService=L,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(L){L<this.start?this.start=L:L>this.end&&(this.end=L)}markRangeDirty(L,T){L>T&&(A=L,L=T,T=A),L<this.start&&(this.start=L),T>this.end&&(this.end=T)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function I(L){return 0<=L&&L<256}k=l([h(0,b.IBufferService)],k)},844:(n,o)=>{function a(l){for(let h of l)h.dispose();l.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let l of this._disposables)l.dispose();this._disposables.length=0}register(l){return this._disposables.push(l),l}unregister(l){let h=this._disposables.indexOf(l);h!==-1&&this._disposables.splice(h,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(l){var h;this._isDisposed||l===this._value||((h=this._value)===null||h===void 0||h.dispose(),this._value=l)}clear(){this.value=void 0}dispose(){var l;this._isDisposed=!0,(l=this._value)===null||l===void 0||l.dispose(),this._value=void 0}},o.toDisposable=function(l){return{dispose:l}},o.disposeArray=a,o.getDisposeArrayDisposable=function(l){return{dispose:()=>a(l)}}},1505:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(h,u,c){this._data[h]||(this._data[h]={}),this._data[h][u]=c}get(h,u){return this._data[h]?this._data[h][u]:void 0}clear(){this._data={}}}o.TwoKeyMap=a,o.FourKeyMap=class{constructor(){this._data=new a}set(l,h,u,c,f){this._data.get(l,h)||this._data.set(l,h,new a),this._data.get(l,h).set(u,c,f)}get(l,h,u,c){var f;return(f=this._data.get(l,h))===null||f===void 0?void 0:f.get(u,c)}clear(){this._data.clear()}}},6114:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof navigator=="undefined";let a=o.isNode?"node":navigator.userAgent,l=o.isNode?"node":navigator.platform;o.isFirefox=a.includes("Firefox"),o.isLegacyEdge=a.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(a),o.getSafariVersion=function(){if(!o.isSafari)return 0;let h=a.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(l),o.isIpad=l==="iPad",o.isIphone=l==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(l),o.isLinux=l.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(a)},6106:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SortedList=void 0;let a=0;o.SortedList=class{constructor(l){this._getKey=l,this._array=[]}clear(){this._array.length=0}insert(l){this._array.length!==0?(a=this._search(this._getKey(l)),this._array.splice(a,0,l)):this._array.push(l)}delete(l){if(this._array.length===0)return!1;let h=this._getKey(l);if(h===void 0||(a=this._search(h),a===-1)||this._getKey(this._array[a])!==h)return!1;do if(this._array[a]===l)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===h);return!1}*getKeyIterator(l){if(this._array.length!==0&&(a=this._search(l),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===l))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===l)}forEachByKey(l,h){if(this._array.length!==0&&(a=this._search(l),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===l))do h(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===l)}values(){return[...this._array].values()}_search(l){let h=0,u=this._array.length-1;for(;u>=h;){let c=h+u>>1,f=this._getKey(this._array[c]);if(f>l)u=c-1;else{if(!(f<l)){for(;c>0&&this._getKey(this._array[c-1])===l;)c--;return c}h=c+1}}return h}}},7226:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;let l=a(6114);class h{constructor(){this._tasks=[],this._i=0}enqueue(f){this._tasks.push(f),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(f){this._idleCallback=void 0;let d=0,m=0,p=f.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(d=Date.now(),this._tasks[this._i]()||this._i++,d=Math.max(1,Date.now()-d),m=Math.max(d,m),v=f.timeRemaining(),1.5*m>v)return p-d<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(p-d))}ms`),void this._start();p=v}this.clear()}}class u extends h{_requestCallback(f){return setTimeout(()=>f(this._createDeadline(16)))}_cancelCallback(f){clearTimeout(f)}_createDeadline(f){let d=Date.now()+f;return{timeRemaining:()=>Math.max(0,d-Date.now())}}}o.PriorityTaskQueue=u,o.IdleTaskQueue=!l.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(c){return requestIdleCallback(c)}_cancelCallback(c){cancelIdleCallback(c)}}:u,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(c){this._queue.clear(),this._queue.enqueue(c)}flush(){this._queue.flush()}}},9282:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateWindowsModeWrappedState=void 0;let l=a(643);o.updateWindowsModeWrappedState=function(h){let u=h.buffer.lines.get(h.buffer.ybase+h.buffer.y-1),c=u==null?void 0:u.get(h.cols-1),f=h.buffer.lines.get(h.buffer.ybase+h.buffer.y);f&&c&&(f.isWrapped=c[l.CHAR_DATA_CODE_INDEX]!==l.NULL_CELL_CODE&&c[l.CHAR_DATA_CODE_INDEX]!==l.WHITESPACE_CELL_CODE)}},3734:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new l}static toColorRGB(u){return[u>>>16&255,u>>>8&255,255&u]}static fromColorRGB(u){return(255&u[0])<<16|(255&u[1])<<8|255&u[2]}clone(){let u=new a;return u.fg=this.fg,u.bg=this.bg,u.extended=this.extended.clone(),u}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}o.AttributeData=a;class l{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(u){this._ext=u}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(u){this._ext&=-469762049,this._ext|=u<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(u){this._ext&=-67108864,this._ext|=67108863&u}get urlId(){return this._urlId}set urlId(u){this._urlId=u}constructor(u=0,c=0){this._ext=0,this._urlId=0,this._ext=u,this._urlId=c}clone(){return new l(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=l},9092:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Buffer=o.MAX_BUFFER_SIZE=void 0;let l=a(6349),h=a(7226),u=a(3734),c=a(8437),f=a(4634),d=a(511),m=a(643),p=a(4863),v=a(7116);o.MAX_BUFFER_SIZE=4294967295,o.Buffer=class{constructor(g,_,x){this._hasScrollback=g,this._optionsService=_,this._bufferService=x,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=c.DEFAULT_ATTR_DATA.clone(),this.savedCharset=v.DEFAULT_CHARSET,this.markers=[],this._nullCell=d.CellData.fromCharData([0,m.NULL_CELL_CHAR,m.NULL_CELL_WIDTH,m.NULL_CELL_CODE]),this._whitespaceCell=d.CellData.fromCharData([0,m.WHITESPACE_CELL_CHAR,m.WHITESPACE_CELL_WIDTH,m.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new h.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(g){return g?(this._nullCell.fg=g.fg,this._nullCell.bg=g.bg,this._nullCell.extended=g.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new u.ExtendedAttrs),this._nullCell}getWhitespaceCell(g){return g?(this._whitespaceCell.fg=g.fg,this._whitespaceCell.bg=g.bg,this._whitespaceCell.extended=g.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new u.ExtendedAttrs),this._whitespaceCell}getBlankLine(g,_){return new c.BufferLine(this._bufferService.cols,this.getNullCell(g),_)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let g=this.ybase+this.y-this.ydisp;return g>=0&&g<this._rows}_getCorrectBufferLength(g){if(!this._hasScrollback)return g;let _=g+this._optionsService.rawOptions.scrollback;return _>o.MAX_BUFFER_SIZE?o.MAX_BUFFER_SIZE:_}fillViewportRows(g){if(this.lines.length===0){g===void 0&&(g=c.DEFAULT_ATTR_DATA);let _=this._rows;for(;_--;)this.lines.push(this.getBlankLine(g))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(g,_){let x=this.getNullCell(c.DEFAULT_ATTR_DATA),b=0,y=this._getCorrectBufferLength(_);if(y>this.lines.maxLength&&(this.lines.maxLength=y),this.lines.length>0){if(this._cols<g)for(let w=0;w<this.lines.length;w++)b+=+this.lines.get(w).resize(g,x);let S=0;if(this._rows<_)for(let w=this._rows;w<_;w++)this.lines.length<_+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new c.BufferLine(g,x)):this.ybase>0&&this.lines.length<=this.ybase+this.y+S+1?(this.ybase--,S++,this.ydisp>0&&this.ydisp--):this.lines.push(new c.BufferLine(g,x)));else for(let w=this._rows;w>_;w--)this.lines.length>_+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(y<this.lines.maxLength){let w=this.lines.length-y;w>0&&(this.lines.trimStart(w),this.ybase=Math.max(this.ybase-w,0),this.ydisp=Math.max(this.ydisp-w,0),this.savedY=Math.max(this.savedY-w,0)),this.lines.maxLength=y}this.x=Math.min(this.x,g-1),this.y=Math.min(this.y,_-1),S&&(this.y+=S),this.savedX=Math.min(this.savedX,g-1),this.scrollTop=0}if(this.scrollBottom=_-1,this._isReflowEnabled&&(this._reflow(g,_),this._cols>g))for(let S=0;S<this.lines.length;S++)b+=+this.lines.get(S).resize(g,x);this._cols=g,this._rows=_,this._memoryCleanupQueue.clear(),b>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let g=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,g=!1);let _=0;for(;this._memoryCleanupPosition<this.lines.length;)if(_+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),_>100)return!0;return g}get _isReflowEnabled(){let g=this._optionsService.rawOptions.windowsPty;return g&&g.buildNumber?this._hasScrollback&&g.backend==="conpty"&&g.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(g,_){this._cols!==g&&(g>this._cols?this._reflowLarger(g,_):this._reflowSmaller(g,_))}_reflowLarger(g,_){let x=(0,f.reflowLargerGetLinesToRemove)(this.lines,this._cols,g,this.ybase+this.y,this.getNullCell(c.DEFAULT_ATTR_DATA));if(x.length>0){let b=(0,f.reflowLargerCreateNewLayout)(this.lines,x);(0,f.reflowLargerApplyNewLayout)(this.lines,b.layout),this._reflowLargerAdjustViewport(g,_,b.countRemoved)}}_reflowLargerAdjustViewport(g,_,x){let b=this.getNullCell(c.DEFAULT_ATTR_DATA),y=x;for(;y-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<_&&this.lines.push(new c.BufferLine(g,b))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-x,0)}_reflowSmaller(g,_){let x=this.getNullCell(c.DEFAULT_ATTR_DATA),b=[],y=0;for(let S=this.lines.length-1;S>=0;S--){let w=this.lines.get(S);if(!w||!w.isWrapped&&w.getTrimmedLength()<=g)continue;let M=[w];for(;w.isWrapped&&S>0;)w=this.lines.get(--S),M.unshift(w);let C=this.ybase+this.y;if(C>=S&&C<S+M.length)continue;let E=M[M.length-1].getTrimmedLength(),P=(0,f.reflowSmallerGetNewLineLengths)(M,this._cols,g),A=P.length-M.length,R;R=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+A):Math.max(0,this.lines.length-this.lines.maxLength+A);let k=[];for(let F=0;F<A;F++){let B=this.getBlankLine(c.DEFAULT_ATTR_DATA,!0);k.push(B)}k.length>0&&(b.push({start:S+M.length+y,newLines:k}),y+=k.length),M.push(...k);let I=P.length-1,L=P[I];L===0&&(I--,L=P[I]);let T=M.length-A-1,O=E;for(;T>=0;){let F=Math.min(O,L);if(M[I]===void 0)break;if(M[I].copyCellsFrom(M[T],O-F,L-F,F,!0),L-=F,L===0&&(I--,L=P[I]),O-=F,O===0){T--;let B=Math.max(T,0);O=(0,f.getWrappedLineTrimmedLength)(M,B,this._cols)}}for(let F=0;F<M.length;F++)P[F]<g&&M[F].setCell(P[F],x);let D=A-R;for(;D-- >0;)this.ybase===0?this.y<_-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+y)-_&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+A,this.ybase+_-1)}if(b.length>0){let S=[],w=[];for(let I=0;I<this.lines.length;I++)w.push(this.lines.get(I));let M=this.lines.length,C=M-1,E=0,P=b[E];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+y);let A=0;for(let I=Math.min(this.lines.maxLength-1,M+y-1);I>=0;I--)if(P&&P.start>C+A){for(let L=P.newLines.length-1;L>=0;L--)this.lines.set(I--,P.newLines[L]);I++,S.push({index:C+1,amount:P.newLines.length}),A+=P.newLines.length,P=b[++E]}else this.lines.set(I,w[C--]);let R=0;for(let I=S.length-1;I>=0;I--)S[I].index+=R,this.lines.onInsertEmitter.fire(S[I]),R+=S[I].amount;let k=Math.max(0,M+y-this.lines.maxLength);k>0&&this.lines.onTrimEmitter.fire(k)}}translateBufferLineToString(g,_,x=0,b){let y=this.lines.get(g);return y?y.translateToString(_,x,b):""}getWrappedRangeForLine(g){let _=g,x=g;for(;_>0&&this.lines.get(_).isWrapped;)_--;for(;x+1<this.lines.length&&this.lines.get(x+1).isWrapped;)x++;return{first:_,last:x}}setupTabStops(g){for(g!=null?this.tabs[g]||(g=this.prevStop(g)):(this.tabs={},g=0);g<this._cols;g+=this._optionsService.rawOptions.tabStopWidth)this.tabs[g]=!0}prevStop(g){for(g==null&&(g=this.x);!this.tabs[--g]&&g>0;);return g>=this._cols?this._cols-1:g<0?0:g}nextStop(g){for(g==null&&(g=this.x);!this.tabs[++g]&&g<this._cols;);return g>=this._cols?this._cols-1:g<0?0:g}clearMarkers(g){this._isClearing=!0;for(let _=0;_<this.markers.length;_++)this.markers[_].line===g&&(this.markers[_].dispose(),this.markers.splice(_--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let g=0;g<this.markers.length;g++)this.markers[g].dispose(),this.markers.splice(g--,1);this._isClearing=!1}addMarker(g){let _=new p.Marker(g);return this.markers.push(_),_.register(this.lines.onTrim(x=>{_.line-=x,_.line<0&&_.dispose()})),_.register(this.lines.onInsert(x=>{_.line>=x.index&&(_.line+=x.amount)})),_.register(this.lines.onDelete(x=>{_.line>=x.index&&_.line<x.index+x.amount&&_.dispose(),_.line>x.index&&(_.line-=x.amount)})),_.register(_.onDispose(()=>this._removeMarker(_))),_}_removeMarker(g){this._isClearing||this.markers.splice(this.markers.indexOf(g),1)}}},8437:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLine=o.DEFAULT_ATTR_DATA=void 0;let l=a(3734),h=a(511),u=a(643),c=a(482);o.DEFAULT_ATTR_DATA=Object.freeze(new l.AttributeData);let f=0;class d{constructor(p,v,g=!1){this.isWrapped=g,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*p);let _=v||h.CellData.fromCharData([0,u.NULL_CELL_CHAR,u.NULL_CELL_WIDTH,u.NULL_CELL_CODE]);for(let x=0;x<p;++x)this.setCell(x,_);this.length=p}get(p){let v=this._data[3*p+0],g=2097151&v;return[this._data[3*p+1],2097152&v?this._combined[p]:g?(0,c.stringFromCodePoint)(g):"",v>>22,2097152&v?this._combined[p].charCodeAt(this._combined[p].length-1):g]}set(p,v){this._data[3*p+1]=v[u.CHAR_DATA_ATTR_INDEX],v[u.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[p]=v[1],this._data[3*p+0]=2097152|p|v[u.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*p+0]=v[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[u.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(p){return this._data[3*p+0]>>22}hasWidth(p){return 12582912&this._data[3*p+0]}getFg(p){return this._data[3*p+1]}getBg(p){return this._data[3*p+2]}hasContent(p){return 4194303&this._data[3*p+0]}getCodePoint(p){let v=this._data[3*p+0];return 2097152&v?this._combined[p].charCodeAt(this._combined[p].length-1):2097151&v}isCombined(p){return 2097152&this._data[3*p+0]}getString(p){let v=this._data[3*p+0];return 2097152&v?this._combined[p]:2097151&v?(0,c.stringFromCodePoint)(2097151&v):""}isProtected(p){return 536870912&this._data[3*p+2]}loadCell(p,v){return f=3*p,v.content=this._data[f+0],v.fg=this._data[f+1],v.bg=this._data[f+2],2097152&v.content&&(v.combinedData=this._combined[p]),268435456&v.bg&&(v.extended=this._extendedAttrs[p]),v}setCell(p,v){2097152&v.content&&(this._combined[p]=v.combinedData),268435456&v.bg&&(this._extendedAttrs[p]=v.extended),this._data[3*p+0]=v.content,this._data[3*p+1]=v.fg,this._data[3*p+2]=v.bg}setCellFromCodePoint(p,v,g,_,x,b){268435456&x&&(this._extendedAttrs[p]=b),this._data[3*p+0]=v|g<<22,this._data[3*p+1]=_,this._data[3*p+2]=x}addCodepointToCell(p,v){let g=this._data[3*p+0];2097152&g?this._combined[p]+=(0,c.stringFromCodePoint)(v):(2097151&g?(this._combined[p]=(0,c.stringFromCodePoint)(2097151&g)+(0,c.stringFromCodePoint)(v),g&=-2097152,g|=2097152):g=v|4194304,this._data[3*p+0]=g)}insertCells(p,v,g,_){if((p%=this.length)&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs),v<this.length-p){let x=new h.CellData;for(let b=this.length-p-v-1;b>=0;--b)this.setCell(p+v+b,this.loadCell(p+b,x));for(let b=0;b<v;++b)this.setCell(p+b,g)}else for(let x=p;x<this.length;++x)this.setCell(x,g);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs)}deleteCells(p,v,g,_){if(p%=this.length,v<this.length-p){let x=new h.CellData;for(let b=0;b<this.length-p-v;++b)this.setCell(p+b,this.loadCell(p+v+b,x));for(let b=this.length-v;b<this.length;++b)this.setCell(b,g)}else for(let x=p;x<this.length;++x)this.setCell(x,g);p&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs),this.getWidth(p)!==0||this.hasContent(p)||this.setCellFromCodePoint(p,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs)}replaceCells(p,v,g,_,x=!1){if(x)for(p&&this.getWidth(p-1)===2&&!this.isProtected(p-1)&&this.setCellFromCodePoint(p-1,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs),v<this.length&&this.getWidth(v-1)===2&&!this.isProtected(v)&&this.setCellFromCodePoint(v,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs);p<v&&p<this.length;)this.isProtected(p)||this.setCell(p,g),p++;else for(p&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs),v<this.length&&this.getWidth(v-1)===2&&this.setCellFromCodePoint(v,0,1,(_==null?void 0:_.fg)||0,(_==null?void 0:_.bg)||0,(_==null?void 0:_.extended)||new l.ExtendedAttrs);p<v&&p<this.length;)this.setCell(p++,g)}resize(p,v){if(p===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let g=3*p;if(p>this.length){if(this._data.buffer.byteLength>=4*g)this._data=new Uint32Array(this._data.buffer,0,g);else{let _=new Uint32Array(g);_.set(this._data),this._data=_}for(let _=this.length;_<p;++_)this.setCell(_,v)}else{this._data=this._data.subarray(0,g);let _=Object.keys(this._combined);for(let b=0;b<_.length;b++){let y=parseInt(_[b],10);y>=p&&delete this._combined[y]}let x=Object.keys(this._extendedAttrs);for(let b=0;b<x.length;b++){let y=parseInt(x[b],10);y>=p&&delete this._extendedAttrs[y]}}return this.length=p,4*g*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let p=new Uint32Array(this._data.length);return p.set(this._data),this._data=p,1}return 0}fill(p,v=!1){if(v)for(let g=0;g<this.length;++g)this.isProtected(g)||this.setCell(g,p);else{this._combined={},this._extendedAttrs={};for(let g=0;g<this.length;++g)this.setCell(g,p)}}copyFrom(p){this.length!==p.length?this._data=new Uint32Array(p._data):this._data.set(p._data),this.length=p.length,this._combined={};for(let v in p._combined)this._combined[v]=p._combined[v];this._extendedAttrs={};for(let v in p._extendedAttrs)this._extendedAttrs[v]=p._extendedAttrs[v];this.isWrapped=p.isWrapped}clone(){let p=new d(0);p._data=new Uint32Array(this._data),p.length=this.length;for(let v in this._combined)p._combined[v]=this._combined[v];for(let v in this._extendedAttrs)p._extendedAttrs[v]=this._extendedAttrs[v];return p.isWrapped=this.isWrapped,p}getTrimmedLength(){for(let p=this.length-1;p>=0;--p)if(4194303&this._data[3*p+0])return p+(this._data[3*p+0]>>22);return 0}getNoBgTrimmedLength(){for(let p=this.length-1;p>=0;--p)if(4194303&this._data[3*p+0]||50331648&this._data[3*p+2])return p+(this._data[3*p+0]>>22);return 0}copyCellsFrom(p,v,g,_,x){let b=p._data;if(x)for(let S=_-1;S>=0;S--){for(let w=0;w<3;w++)this._data[3*(g+S)+w]=b[3*(v+S)+w];268435456&b[3*(v+S)+2]&&(this._extendedAttrs[g+S]=p._extendedAttrs[v+S])}else for(let S=0;S<_;S++){for(let w=0;w<3;w++)this._data[3*(g+S)+w]=b[3*(v+S)+w];268435456&b[3*(v+S)+2]&&(this._extendedAttrs[g+S]=p._extendedAttrs[v+S])}let y=Object.keys(p._combined);for(let S=0;S<y.length;S++){let w=parseInt(y[S],10);w>=v&&(this._combined[w-v+g]=p._combined[w])}}translateToString(p=!1,v=0,g=this.length){p&&(g=Math.min(g,this.getTrimmedLength()));let _="";for(;v<g;){let x=this._data[3*v+0],b=2097151&x;_+=2097152&x?this._combined[v]:b?(0,c.stringFromCodePoint)(b):u.WHITESPACE_CELL_CHAR,v+=x>>22||1}return _}}o.BufferLine=d},4841:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getRangeLength=void 0,o.getRangeLength=function(a,l){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return l*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(n,o)=>{function a(l,h,u){if(h===l.length-1)return l[h].getTrimmedLength();let c=!l[h].hasContent(u-1)&&l[h].getWidth(u-1)===1,f=l[h+1].getWidth(0)===2;return c&&f?u-1:u}Object.defineProperty(o,"__esModule",{value:!0}),o.getWrappedLineTrimmedLength=o.reflowSmallerGetNewLineLengths=o.reflowLargerApplyNewLayout=o.reflowLargerCreateNewLayout=o.reflowLargerGetLinesToRemove=void 0,o.reflowLargerGetLinesToRemove=function(l,h,u,c,f){let d=[];for(let m=0;m<l.length-1;m++){let p=m,v=l.get(++p);if(!v.isWrapped)continue;let g=[l.get(m)];for(;p<l.length&&v.isWrapped;)g.push(v),v=l.get(++p);if(c>=m&&c<p){m+=g.length-1;continue}let _=0,x=a(g,_,h),b=1,y=0;for(;b<g.length;){let w=a(g,b,h),M=w-y,C=u-x,E=Math.min(M,C);g[_].copyCellsFrom(g[b],y,x,E,!1),x+=E,x===u&&(_++,x=0),y+=E,y===w&&(b++,y=0),x===0&&_!==0&&g[_-1].getWidth(u-1)===2&&(g[_].copyCellsFrom(g[_-1],u-1,x++,1,!1),g[_-1].setCell(u-1,f))}g[_].replaceCells(x,u,f);let S=0;for(let w=g.length-1;w>0&&(w>_||g[w].getTrimmedLength()===0);w--)S++;S>0&&(d.push(m+g.length-S),d.push(S)),m+=g.length-1}return d},o.reflowLargerCreateNewLayout=function(l,h){let u=[],c=0,f=h[c],d=0;for(let m=0;m<l.length;m++)if(f===m){let p=h[++c];l.onDeleteEmitter.fire({index:m-d,amount:p}),m+=p-1,d+=p,f=h[++c]}else u.push(m);return{layout:u,countRemoved:d}},o.reflowLargerApplyNewLayout=function(l,h){let u=[];for(let c=0;c<h.length;c++)u.push(l.get(h[c]));for(let c=0;c<u.length;c++)l.set(c,u[c]);l.length=h.length},o.reflowSmallerGetNewLineLengths=function(l,h,u){let c=[],f=l.map((v,g)=>a(l,g,h)).reduce((v,g)=>v+g),d=0,m=0,p=0;for(;p<f;){if(f-p<u){c.push(f-p);break}d+=u;let v=a(l,m,h);d>v&&(d-=v,m++);let g=l[m].getWidth(d-1)===2;g&&d--;let _=g?u-1:u;c.push(_),p+=_}return c},o.getWrappedLineTrimmedLength=a},5295:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferSet=void 0;let l=a(8460),h=a(844),u=a(9092);class c extends h.Disposable{constructor(d,m){super(),this._optionsService=d,this._bufferService=m,this._onBufferActivate=this.register(new l.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new u.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new u.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(d){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(d),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(d,m){this._normal.resize(d,m),this._alt.resize(d,m),this.setupTabStops(d)}setupTabStops(d){this._normal.setupTabStops(d),this._alt.setupTabStops(d)}}o.BufferSet=c},511:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;let l=a(482),h=a(643),u=a(3734);class c extends u.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new u.ExtendedAttrs,this.combinedData=""}static fromCharData(d){let m=new c;return m.setFromCharData(d),m}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(d){this.fg=d[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let m=!1;if(d[h.CHAR_DATA_CHAR_INDEX].length>2)m=!0;else if(d[h.CHAR_DATA_CHAR_INDEX].length===2){let p=d[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=p&&p<=56319){let v=d[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(p-55296)+v-56320+65536|d[h.CHAR_DATA_WIDTH_INDEX]<<22:m=!0}else m=!0}else this.content=d[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|d[h.CHAR_DATA_WIDTH_INDEX]<<22;m&&(this.combinedData=d[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|d[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=c},643:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},4863:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Marker=void 0;let l=a(8460),h=a(844);class u{get id(){return this._id}constructor(f){this.line=f,this.isDisposed=!1,this._disposables=[],this._id=u._nextId++,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,h.disposeArray)(this._disposables),this._disposables.length=0)}register(f){return this._disposables.push(f),f}}o.Marker=u,u._nextId=1},7116:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DEFAULT_CHARSET=o.CHARSETS=void 0,o.CHARSETS={},o.DEFAULT_CHARSET=o.CHARSETS.B,o.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},o.CHARSETS.A={"#":"\xA3"},o.CHARSETS.B=void 0,o.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},o.CHARSETS.C=o.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},o.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},o.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},o.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},o.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},o.CHARSETS.E=o.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},o.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},o.CHARSETS.H=o.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},o.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(n,o)=>{var a,l,h;Object.defineProperty(o,"__esModule",{value:!0}),o.C1_ESCAPED=o.C1=o.C0=void 0,function(u){u.NUL="\0",u.SOH="",u.STX="",u.ETX="",u.EOT="",u.ENQ="",u.ACK="",u.BEL="\x07",u.BS="\b",u.HT="	",u.LF=`
`,u.VT="\v",u.FF="\f",u.CR="\r",u.SO="",u.SI="",u.DLE="",u.DC1="",u.DC2="",u.DC3="",u.DC4="",u.NAK="",u.SYN="",u.ETB="",u.CAN="",u.EM="",u.SUB="",u.ESC="\x1B",u.FS="",u.GS="",u.RS="",u.US="",u.SP=" ",u.DEL="\x7F"}(a||(o.C0=a={})),function(u){u.PAD="\x80",u.HOP="\x81",u.BPH="\x82",u.NBH="\x83",u.IND="\x84",u.NEL="\x85",u.SSA="\x86",u.ESA="\x87",u.HTS="\x88",u.HTJ="\x89",u.VTS="\x8A",u.PLD="\x8B",u.PLU="\x8C",u.RI="\x8D",u.SS2="\x8E",u.SS3="\x8F",u.DCS="\x90",u.PU1="\x91",u.PU2="\x92",u.STS="\x93",u.CCH="\x94",u.MW="\x95",u.SPA="\x96",u.EPA="\x97",u.SOS="\x98",u.SGCI="\x99",u.SCI="\x9A",u.CSI="\x9B",u.ST="\x9C",u.OSC="\x9D",u.PM="\x9E",u.APC="\x9F"}(l||(o.C1=l={})),function(u){u.ST=`${a.ESC}\\`}(h||(o.C1_ESCAPED=h={}))},7399:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.evaluateKeyboardEvent=void 0;let l=a(2584),h={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};o.evaluateKeyboardEvent=function(u,c,f,d){let m={type:0,cancel:!1,key:void 0},p=(u.shiftKey?1:0)|(u.altKey?2:0)|(u.ctrlKey?4:0)|(u.metaKey?8:0);switch(u.keyCode){case 0:u.key==="UIKeyInputUpArrow"?m.key=c?l.C0.ESC+"OA":l.C0.ESC+"[A":u.key==="UIKeyInputLeftArrow"?m.key=c?l.C0.ESC+"OD":l.C0.ESC+"[D":u.key==="UIKeyInputRightArrow"?m.key=c?l.C0.ESC+"OC":l.C0.ESC+"[C":u.key==="UIKeyInputDownArrow"&&(m.key=c?l.C0.ESC+"OB":l.C0.ESC+"[B");break;case 8:if(u.altKey){m.key=l.C0.ESC+l.C0.DEL;break}m.key=l.C0.DEL;break;case 9:if(u.shiftKey){m.key=l.C0.ESC+"[Z";break}m.key=l.C0.HT,m.cancel=!0;break;case 13:m.key=u.altKey?l.C0.ESC+l.C0.CR:l.C0.CR,m.cancel=!0;break;case 27:m.key=l.C0.ESC,u.altKey&&(m.key=l.C0.ESC+l.C0.ESC),m.cancel=!0;break;case 37:if(u.metaKey)break;p?(m.key=l.C0.ESC+"[1;"+(p+1)+"D",m.key===l.C0.ESC+"[1;3D"&&(m.key=l.C0.ESC+(f?"b":"[1;5D"))):m.key=c?l.C0.ESC+"OD":l.C0.ESC+"[D";break;case 39:if(u.metaKey)break;p?(m.key=l.C0.ESC+"[1;"+(p+1)+"C",m.key===l.C0.ESC+"[1;3C"&&(m.key=l.C0.ESC+(f?"f":"[1;5C"))):m.key=c?l.C0.ESC+"OC":l.C0.ESC+"[C";break;case 38:if(u.metaKey)break;p?(m.key=l.C0.ESC+"[1;"+(p+1)+"A",f||m.key!==l.C0.ESC+"[1;3A"||(m.key=l.C0.ESC+"[1;5A")):m.key=c?l.C0.ESC+"OA":l.C0.ESC+"[A";break;case 40:if(u.metaKey)break;p?(m.key=l.C0.ESC+"[1;"+(p+1)+"B",f||m.key!==l.C0.ESC+"[1;3B"||(m.key=l.C0.ESC+"[1;5B")):m.key=c?l.C0.ESC+"OB":l.C0.ESC+"[B";break;case 45:u.shiftKey||u.ctrlKey||(m.key=l.C0.ESC+"[2~");break;case 46:m.key=p?l.C0.ESC+"[3;"+(p+1)+"~":l.C0.ESC+"[3~";break;case 36:m.key=p?l.C0.ESC+"[1;"+(p+1)+"H":c?l.C0.ESC+"OH":l.C0.ESC+"[H";break;case 35:m.key=p?l.C0.ESC+"[1;"+(p+1)+"F":c?l.C0.ESC+"OF":l.C0.ESC+"[F";break;case 33:u.shiftKey?m.type=2:u.ctrlKey?m.key=l.C0.ESC+"[5;"+(p+1)+"~":m.key=l.C0.ESC+"[5~";break;case 34:u.shiftKey?m.type=3:u.ctrlKey?m.key=l.C0.ESC+"[6;"+(p+1)+"~":m.key=l.C0.ESC+"[6~";break;case 112:m.key=p?l.C0.ESC+"[1;"+(p+1)+"P":l.C0.ESC+"OP";break;case 113:m.key=p?l.C0.ESC+"[1;"+(p+1)+"Q":l.C0.ESC+"OQ";break;case 114:m.key=p?l.C0.ESC+"[1;"+(p+1)+"R":l.C0.ESC+"OR";break;case 115:m.key=p?l.C0.ESC+"[1;"+(p+1)+"S":l.C0.ESC+"OS";break;case 116:m.key=p?l.C0.ESC+"[15;"+(p+1)+"~":l.C0.ESC+"[15~";break;case 117:m.key=p?l.C0.ESC+"[17;"+(p+1)+"~":l.C0.ESC+"[17~";break;case 118:m.key=p?l.C0.ESC+"[18;"+(p+1)+"~":l.C0.ESC+"[18~";break;case 119:m.key=p?l.C0.ESC+"[19;"+(p+1)+"~":l.C0.ESC+"[19~";break;case 120:m.key=p?l.C0.ESC+"[20;"+(p+1)+"~":l.C0.ESC+"[20~";break;case 121:m.key=p?l.C0.ESC+"[21;"+(p+1)+"~":l.C0.ESC+"[21~";break;case 122:m.key=p?l.C0.ESC+"[23;"+(p+1)+"~":l.C0.ESC+"[23~";break;case 123:m.key=p?l.C0.ESC+"[24;"+(p+1)+"~":l.C0.ESC+"[24~";break;default:if(!u.ctrlKey||u.shiftKey||u.altKey||u.metaKey)if(f&&!d||!u.altKey||u.metaKey)!f||u.altKey||u.ctrlKey||u.shiftKey||!u.metaKey?u.key&&!u.ctrlKey&&!u.altKey&&!u.metaKey&&u.keyCode>=48&&u.key.length===1?m.key=u.key:u.key&&u.ctrlKey&&(u.key==="_"&&(m.key=l.C0.US),u.key==="@"&&(m.key=l.C0.NUL)):u.keyCode===65&&(m.type=1);else{let v=h[u.keyCode],g=v==null?void 0:v[u.shiftKey?1:0];if(g)m.key=l.C0.ESC+g;else if(u.keyCode>=65&&u.keyCode<=90){let _=u.ctrlKey?u.keyCode-64:u.keyCode+32,x=String.fromCharCode(_);u.shiftKey&&(x=x.toUpperCase()),m.key=l.C0.ESC+x}else if(u.keyCode===32)m.key=l.C0.ESC+(u.ctrlKey?l.C0.NUL:" ");else if(u.key==="Dead"&&u.code.startsWith("Key")){let _=u.code.slice(3,4);u.shiftKey||(_=_.toLowerCase()),m.key=l.C0.ESC+_,m.cancel=!0}}else u.keyCode>=65&&u.keyCode<=90?m.key=String.fromCharCode(u.keyCode-64):u.keyCode===32?m.key=l.C0.NUL:u.keyCode>=51&&u.keyCode<=55?m.key=String.fromCharCode(u.keyCode-51+27):u.keyCode===56?m.key=l.C0.DEL:u.keyCode===219?m.key=l.C0.ESC:u.keyCode===220?m.key=l.C0.FS:u.keyCode===221&&(m.key=l.C0.GS)}return m}},482:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},o.utf32ToString=function(a,l=0,h=a.length){let u="";for(let c=l;c<h;++c){let f=a[c];f>65535?(f-=65536,u+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):u+=String.fromCharCode(f)}return u},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,l){let h=a.length;if(!h)return 0;let u=0,c=0;if(this._interim){let f=a.charCodeAt(c++);56320<=f&&f<=57343?l[u++]=1024*(this._interim-55296)+f-56320+65536:(l[u++]=this._interim,l[u++]=f),this._interim=0}for(let f=c;f<h;++f){let d=a.charCodeAt(f);if(55296<=d&&d<=56319){if(++f>=h)return this._interim=d,u;let m=a.charCodeAt(f);56320<=m&&m<=57343?l[u++]=1024*(d-55296)+m-56320+65536:(l[u++]=d,l[u++]=m)}else d!==65279&&(l[u++]=d)}return u}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,l){let h=a.length;if(!h)return 0;let u,c,f,d,m=0,p=0,v=0;if(this.interim[0]){let x=!1,b=this.interim[0];b&=(224&b)==192?31:(240&b)==224?15:7;let y,S=0;for(;(y=63&this.interim[++S])&&S<4;)b<<=6,b|=y;let w=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,M=w-S;for(;v<M;){if(v>=h)return 0;if(y=a[v++],(192&y)!=128){v--,x=!0;break}this.interim[S++]=y,b<<=6,b|=63&y}x||(w===2?b<128?v--:l[m++]=b:w===3?b<2048||b>=55296&&b<=57343||b===65279||(l[m++]=b):b<65536||b>1114111||(l[m++]=b)),this.interim.fill(0)}let g=h-4,_=v;for(;_<h;){for(;!(!(_<g)||128&(u=a[_])||128&(c=a[_+1])||128&(f=a[_+2])||128&(d=a[_+3]));)l[m++]=u,l[m++]=c,l[m++]=f,l[m++]=d,_+=4;if(u=a[_++],u<128)l[m++]=u;else if((224&u)==192){if(_>=h)return this.interim[0]=u,m;if(c=a[_++],(192&c)!=128){_--;continue}if(p=(31&u)<<6|63&c,p<128){_--;continue}l[m++]=p}else if((240&u)==224){if(_>=h)return this.interim[0]=u,m;if(c=a[_++],(192&c)!=128){_--;continue}if(_>=h)return this.interim[0]=u,this.interim[1]=c,m;if(f=a[_++],(192&f)!=128){_--;continue}if(p=(15&u)<<12|(63&c)<<6|63&f,p<2048||p>=55296&&p<=57343||p===65279)continue;l[m++]=p}else if((248&u)==240){if(_>=h)return this.interim[0]=u,m;if(c=a[_++],(192&c)!=128){_--;continue}if(_>=h)return this.interim[0]=u,this.interim[1]=c,m;if(f=a[_++],(192&f)!=128){_--;continue}if(_>=h)return this.interim[0]=u,this.interim[1]=c,this.interim[2]=f,m;if(d=a[_++],(192&d)!=128){_--;continue}if(p=(7&u)<<18|(63&c)<<12|(63&f)<<6|63&d,p<65536||p>1114111)continue;l[m++]=p}}return m}}},225:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeV6=void 0;let a=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],l=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],h;o.UnicodeV6=class{constructor(){if(this.version="6",!h){h=new Uint8Array(65536),h.fill(1),h[0]=0,h.fill(0,1,32),h.fill(0,127,160),h.fill(2,4352,4448),h[9001]=2,h[9002]=2,h.fill(2,11904,42192),h[12351]=1,h.fill(2,44032,55204),h.fill(2,63744,64256),h.fill(2,65040,65050),h.fill(2,65072,65136),h.fill(2,65280,65377),h.fill(2,65504,65511);for(let u=0;u<a.length;++u)h.fill(0,a[u][0],a[u][1]+1)}}wcwidth(u){return u<32?0:u<127?1:u<65536?h[u]:function(c,f){let d,m=0,p=f.length-1;if(c<f[0][0]||c>f[p][1])return!1;for(;p>=m;)if(d=m+p>>1,c>f[d][1])m=d+1;else{if(!(c<f[d][0]))return!0;p=d-1}return!1}(u,l)?0:u>=131072&&u<=196605||u>=196608&&u<=262141?2:1}}},5981:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WriteBuffer=void 0;let l=a(8460),h=a(844);class u extends h.Disposable{constructor(f){super(),this._action=f,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(f,d){if(d!==void 0&&this._syncCalls>d)return void(this._syncCalls=0);if(this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let m;for(this._isSyncWriting=!0;m=this._writeBuffer.shift();){this._action(m);let p=this._callbacks.shift();p&&p()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(f,d){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(d),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(d)}_innerWrite(f=0,d=!0){let m=f||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let p=this._writeBuffer[this._bufferOffset],v=this._action(p,d);if(v){let _=x=>Date.now()-m>=12?setTimeout(()=>this._innerWrite(0,x)):this._innerWrite(m,x);return void v.catch(x=>(queueMicrotask(()=>{throw x}),Promise.resolve(!1))).then(_)}let g=this._callbacks[this._bufferOffset];if(g&&g(),this._bufferOffset++,this._pendingData-=p.length,Date.now()-m>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}o.WriteBuffer=u},5941:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toRgbString=o.parseColor=void 0;let a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,l=/^[\da-f]+$/;function h(u,c){let f=u.toString(16),d=f.length<2?"0"+f:f;switch(c){case 4:return f[0];case 8:return d;case 12:return(d+d).slice(0,3);default:return d+d}}o.parseColor=function(u){if(!u)return;let c=u.toLowerCase();if(c.indexOf("rgb:")===0){c=c.slice(4);let f=a.exec(c);if(f){let d=f[1]?15:f[4]?255:f[7]?4095:65535;return[Math.round(parseInt(f[1]||f[4]||f[7]||f[10],16)/d*255),Math.round(parseInt(f[2]||f[5]||f[8]||f[11],16)/d*255),Math.round(parseInt(f[3]||f[6]||f[9]||f[12],16)/d*255)]}}else if(c.indexOf("#")===0&&(c=c.slice(1),l.exec(c)&&[3,6,9,12].includes(c.length))){let f=c.length/3,d=[0,0,0];for(let m=0;m<3;++m){let p=parseInt(c.slice(f*m,f*m+f),16);d[m]=f===1?p<<4:f===2?p:f===3?p>>4:p>>8}return d}},o.toRgbString=function(u,c=16){let[f,d,m]=u;return`rgb:${h(f,c)}/${h(d,c)}/${h(m,c)}`}},5770:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PAYLOAD_LIMIT=void 0,o.PAYLOAD_LIMIT=1e7},6351:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DcsHandler=o.DcsParser=void 0;let l=a(482),h=a(8742),u=a(5770),c=[];o.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=c,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=c}registerHandler(d,m){this._handlers[d]===void 0&&(this._handlers[d]=[]);let p=this._handlers[d];return p.push(m),{dispose:()=>{let v=p.indexOf(m);v!==-1&&p.splice(v,1)}}}clearHandler(d){this._handlers[d]&&delete this._handlers[d]}setHandlerFallback(d){this._handlerFb=d}reset(){if(this._active.length)for(let d=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;d>=0;--d)this._active[d].unhook(!1);this._stack.paused=!1,this._active=c,this._ident=0}hook(d,m){if(this.reset(),this._ident=d,this._active=this._handlers[d]||c,this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].hook(m);else this._handlerFb(this._ident,"HOOK",m)}put(d,m,p){if(this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].put(d,m,p);else this._handlerFb(this._ident,"PUT",(0,l.utf32ToString)(d,m,p))}unhook(d,m=!0){if(this._active.length){let p=!1,v=this._active.length-1,g=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,p=m,g=this._stack.fallThrough,this._stack.paused=!1),!g&&p===!1){for(;v>=0&&(p=this._active[v].unhook(d),p!==!0);v--)if(p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,p;v--}for(;v>=0;v--)if(p=this._active[v].unhook(!1),p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,p}else this._handlerFb(this._ident,"UNHOOK",d);this._active=c,this._ident=0}};let f=new h.Params;f.addParam(0),o.DcsHandler=class{constructor(d){this._handler=d,this._data="",this._params=f,this._hitLimit=!1}hook(d){this._params=d.length>1||d.params[0]?d.clone():f,this._data="",this._hitLimit=!1}put(d,m,p){this._hitLimit||(this._data+=(0,l.utf32ToString)(d,m,p),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(d){let m=!1;if(this._hitLimit)m=!1;else if(d&&(m=this._handler(this._data,this._params),m instanceof Promise))return m.then(p=>(this._params=f,this._data="",this._hitLimit=!1,p));return this._params=f,this._data="",this._hitLimit=!1,m}}},2015:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.EscapeSequenceParser=o.VT500_TRANSITION_TABLE=o.TransitionTable=void 0;let l=a(844),h=a(8742),u=a(6242),c=a(6351);class f{constructor(v){this.table=new Uint8Array(v)}setDefault(v,g){this.table.fill(v<<4|g)}add(v,g,_,x){this.table[g<<8|v]=_<<4|x}addMany(v,g,_,x){for(let b=0;b<v.length;b++)this.table[g<<8|v[b]]=_<<4|x}}o.TransitionTable=f;let d=160;o.VT500_TRANSITION_TABLE=function(){let p=new f(4095),v=Array.apply(null,Array(256)).map((S,w)=>w),g=(S,w)=>v.slice(S,w),_=g(32,127),x=g(0,24);x.push(25),x.push.apply(x,g(28,32));let b=g(0,14),y;for(y in p.setDefault(1,0),p.addMany(_,0,2,0),b)p.addMany([24,26,153,154],y,3,0),p.addMany(g(128,144),y,3,0),p.addMany(g(144,152),y,3,0),p.add(156,y,0,0),p.add(27,y,11,1),p.add(157,y,4,8),p.addMany([152,158,159],y,0,7),p.add(155,y,11,3),p.add(144,y,11,9);return p.addMany(x,0,3,0),p.addMany(x,1,3,1),p.add(127,1,0,1),p.addMany(x,8,0,8),p.addMany(x,3,3,3),p.add(127,3,0,3),p.addMany(x,4,3,4),p.add(127,4,0,4),p.addMany(x,6,3,6),p.addMany(x,5,3,5),p.add(127,5,0,5),p.addMany(x,2,3,2),p.add(127,2,0,2),p.add(93,1,4,8),p.addMany(_,8,5,8),p.add(127,8,5,8),p.addMany([156,27,24,26,7],8,6,0),p.addMany(g(28,32),8,0,8),p.addMany([88,94,95],1,0,7),p.addMany(_,7,0,7),p.addMany(x,7,0,7),p.add(156,7,0,0),p.add(127,7,0,7),p.add(91,1,11,3),p.addMany(g(64,127),3,7,0),p.addMany(g(48,60),3,8,4),p.addMany([60,61,62,63],3,9,4),p.addMany(g(48,60),4,8,4),p.addMany(g(64,127),4,7,0),p.addMany([60,61,62,63],4,0,6),p.addMany(g(32,64),6,0,6),p.add(127,6,0,6),p.addMany(g(64,127),6,0,0),p.addMany(g(32,48),3,9,5),p.addMany(g(32,48),5,9,5),p.addMany(g(48,64),5,0,6),p.addMany(g(64,127),5,7,0),p.addMany(g(32,48),4,9,5),p.addMany(g(32,48),1,9,2),p.addMany(g(32,48),2,9,2),p.addMany(g(48,127),2,10,0),p.addMany(g(48,80),1,10,0),p.addMany(g(81,88),1,10,0),p.addMany([89,90,92],1,10,0),p.addMany(g(96,127),1,10,0),p.add(80,1,11,9),p.addMany(x,9,0,9),p.add(127,9,0,9),p.addMany(g(28,32),9,0,9),p.addMany(g(32,48),9,9,12),p.addMany(g(48,60),9,8,10),p.addMany([60,61,62,63],9,9,10),p.addMany(x,11,0,11),p.addMany(g(32,128),11,0,11),p.addMany(g(28,32),11,0,11),p.addMany(x,10,0,10),p.add(127,10,0,10),p.addMany(g(28,32),10,0,10),p.addMany(g(48,60),10,8,10),p.addMany([60,61,62,63],10,0,11),p.addMany(g(32,48),10,9,12),p.addMany(x,12,0,12),p.add(127,12,0,12),p.addMany(g(28,32),12,0,12),p.addMany(g(32,48),12,9,12),p.addMany(g(48,64),12,0,11),p.addMany(g(64,127),12,12,13),p.addMany(g(64,127),10,12,13),p.addMany(g(64,127),9,12,13),p.addMany(x,13,13,13),p.addMany(_,13,13,13),p.add(127,13,0,13),p.addMany([27,156,24,26],13,14,0),p.add(d,0,2,0),p.add(d,8,5,8),p.add(d,6,0,6),p.add(d,11,0,11),p.add(d,13,13,13),p}();class m extends l.Disposable{constructor(v=o.VT500_TRANSITION_TABLE){super(),this._transitions=v,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new h.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(g,_,x)=>{},this._executeHandlerFb=g=>{},this._csiHandlerFb=(g,_)=>{},this._escHandlerFb=g=>{},this._errorHandlerFb=g=>g,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,l.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new u.OscParser),this._dcsParser=this.register(new c.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(v,g=[64,126]){let _=0;if(v.prefix){if(v.prefix.length>1)throw new Error("only one byte as prefix supported");if(_=v.prefix.charCodeAt(0),_&&60>_||_>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(v.intermediates){if(v.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let b=0;b<v.intermediates.length;++b){let y=v.intermediates.charCodeAt(b);if(32>y||y>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");_<<=8,_|=y}}if(v.final.length!==1)throw new Error("final must be a single byte");let x=v.final.charCodeAt(0);if(g[0]>x||x>g[1])throw new Error(`final must be in range ${g[0]} .. ${g[1]}`);return _<<=8,_|=x,_}identToString(v){let g=[];for(;v;)g.push(String.fromCharCode(255&v)),v>>=8;return g.reverse().join("")}setPrintHandler(v){this._printHandler=v}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(v,g){let _=this._identifier(v,[48,126]);this._escHandlers[_]===void 0&&(this._escHandlers[_]=[]);let x=this._escHandlers[_];return x.push(g),{dispose:()=>{let b=x.indexOf(g);b!==-1&&x.splice(b,1)}}}clearEscHandler(v){this._escHandlers[this._identifier(v,[48,126])]&&delete this._escHandlers[this._identifier(v,[48,126])]}setEscHandlerFallback(v){this._escHandlerFb=v}setExecuteHandler(v,g){this._executeHandlers[v.charCodeAt(0)]=g}clearExecuteHandler(v){this._executeHandlers[v.charCodeAt(0)]&&delete this._executeHandlers[v.charCodeAt(0)]}setExecuteHandlerFallback(v){this._executeHandlerFb=v}registerCsiHandler(v,g){let _=this._identifier(v);this._csiHandlers[_]===void 0&&(this._csiHandlers[_]=[]);let x=this._csiHandlers[_];return x.push(g),{dispose:()=>{let b=x.indexOf(g);b!==-1&&x.splice(b,1)}}}clearCsiHandler(v){this._csiHandlers[this._identifier(v)]&&delete this._csiHandlers[this._identifier(v)]}setCsiHandlerFallback(v){this._csiHandlerFb=v}registerDcsHandler(v,g){return this._dcsParser.registerHandler(this._identifier(v),g)}clearDcsHandler(v){this._dcsParser.clearHandler(this._identifier(v))}setDcsHandlerFallback(v){this._dcsParser.setHandlerFallback(v)}registerOscHandler(v,g){return this._oscParser.registerHandler(v,g)}clearOscHandler(v){this._oscParser.clearHandler(v)}setOscHandlerFallback(v){this._oscParser.setHandlerFallback(v)}setErrorHandler(v){this._errorHandler=v}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(v,g,_,x,b){this._parseStack.state=v,this._parseStack.handlers=g,this._parseStack.handlerPos=_,this._parseStack.transition=x,this._parseStack.chunkPos=b}parse(v,g,_){let x,b=0,y=0,S=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,S=this._parseStack.chunkPos+1;else{if(_===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let w=this._parseStack.handlers,M=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(_===!1&&M>-1){for(;M>=0&&(x=w[M](this._params),x!==!0);M--)if(x instanceof Promise)return this._parseStack.handlerPos=M,x}this._parseStack.handlers=[];break;case 4:if(_===!1&&M>-1){for(;M>=0&&(x=w[M](),x!==!0);M--)if(x instanceof Promise)return this._parseStack.handlerPos=M,x}this._parseStack.handlers=[];break;case 6:if(b=v[this._parseStack.chunkPos],x=this._dcsParser.unhook(b!==24&&b!==26,_),x)return x;b===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(b=v[this._parseStack.chunkPos],x=this._oscParser.end(b!==24&&b!==26,_),x)return x;b===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,S=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let w=S;w<g;++w){switch(b=v[w],y=this._transitions.table[this.currentState<<8|(b<160?b:d)],y>>4){case 2:for(let A=w+1;;++A){if(A>=g||(b=v[A])<32||b>126&&b<d){this._printHandler(v,w,A),w=A-1;break}if(++A>=g||(b=v[A])<32||b>126&&b<d){this._printHandler(v,w,A),w=A-1;break}if(++A>=g||(b=v[A])<32||b>126&&b<d){this._printHandler(v,w,A),w=A-1;break}if(++A>=g||(b=v[A])<32||b>126&&b<d){this._printHandler(v,w,A),w=A-1;break}}break;case 3:this._executeHandlers[b]?this._executeHandlers[b]():this._executeHandlerFb(b),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:w,code:b,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let M=this._csiHandlers[this._collect<<8|b],C=M?M.length-1:-1;for(;C>=0&&(x=M[C](this._params),x!==!0);C--)if(x instanceof Promise)return this._preserveStack(3,M,C,y,w),x;C<0&&this._csiHandlerFb(this._collect<<8|b,this._params),this.precedingCodepoint=0;break;case 8:do switch(b){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(b-48)}while(++w<g&&(b=v[w])>47&&b<60);w--;break;case 9:this._collect<<=8,this._collect|=b;break;case 10:let E=this._escHandlers[this._collect<<8|b],P=E?E.length-1:-1;for(;P>=0&&(x=E[P](),x!==!0);P--)if(x instanceof Promise)return this._preserveStack(4,E,P,y,w),x;P<0&&this._escHandlerFb(this._collect<<8|b),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|b,this._params);break;case 13:for(let A=w+1;;++A)if(A>=g||(b=v[A])===24||b===26||b===27||b>127&&b<d){this._dcsParser.put(v,w,A),w=A-1;break}break;case 14:if(x=this._dcsParser.unhook(b!==24&&b!==26),x)return this._preserveStack(6,[],0,y,w),x;b===27&&(y|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let A=w+1;;A++)if(A>=g||(b=v[A])<32||b>127&&b<d){this._oscParser.put(v,w,A),w=A-1;break}break;case 6:if(x=this._oscParser.end(b!==24&&b!==26),x)return this._preserveStack(5,[],0,y,w),x;b===27&&(y|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&y}}}o.EscapeSequenceParser=m},6242:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OscHandler=o.OscParser=void 0;let l=a(5770),h=a(482),u=[];o.OscParser=class{constructor(){this._state=0,this._active=u,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(c,f){this._handlers[c]===void 0&&(this._handlers[c]=[]);let d=this._handlers[c];return d.push(f),{dispose:()=>{let m=d.indexOf(f);m!==-1&&d.splice(m,1)}}}clearHandler(c){this._handlers[c]&&delete this._handlers[c]}setHandlerFallback(c){this._handlerFb=c}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=u}reset(){if(this._state===2)for(let c=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;c>=0;--c)this._active[c].end(!1);this._stack.paused=!1,this._active=u,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||u,this._active.length)for(let c=this._active.length-1;c>=0;c--)this._active[c].start();else this._handlerFb(this._id,"START")}_put(c,f,d){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(c,f,d);else this._handlerFb(this._id,"PUT",(0,h.utf32ToString)(c,f,d))}start(){this.reset(),this._state=1}put(c,f,d){if(this._state!==3){if(this._state===1)for(;f<d;){let m=c[f++];if(m===59){this._state=2,this._start();break}if(m<48||57<m)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+m-48}this._state===2&&d-f>0&&this._put(c,f,d)}}end(c,f=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let d=!1,m=this._active.length-1,p=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,d=f,p=this._stack.fallThrough,this._stack.paused=!1),!p&&d===!1){for(;m>=0&&(d=this._active[m].end(c),d!==!0);m--)if(d instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,d;m--}for(;m>=0;m--)if(d=this._active[m].end(!1),d instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,d}else this._handlerFb(this._id,"END",c);this._active=u,this._id=-1,this._state=0}}},o.OscHandler=class{constructor(c){this._handler=c,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(c,f,d){this._hitLimit||(this._data+=(0,h.utf32ToString)(c,f,d),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(c){let f=!1;if(this._hitLimit)f=!1;else if(c&&(f=this._handler(this._data),f instanceof Promise))return f.then(d=>(this._data="",this._hitLimit=!1,d));return this._data="",this._hitLimit=!1,f}}},8742:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Params=void 0;let a=2147483647;class l{static fromArray(u){let c=new l;if(!u.length)return c;for(let f=Array.isArray(u[0])?1:0;f<u.length;++f){let d=u[f];if(Array.isArray(d))for(let m=0;m<d.length;++m)c.addSubParam(d[m]);else c.addParam(d)}return c}constructor(u=32,c=32){if(this.maxLength=u,this.maxSubParamsLength=c,c>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(u),this.length=0,this._subParams=new Int32Array(c),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(u),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let u=new l(this.maxLength,this.maxSubParamsLength);return u.params.set(this.params),u.length=this.length,u._subParams.set(this._subParams),u._subParamsLength=this._subParamsLength,u._subParamsIdx.set(this._subParamsIdx),u._rejectDigits=this._rejectDigits,u._rejectSubDigits=this._rejectSubDigits,u._digitIsSub=this._digitIsSub,u}toArray(){let u=[];for(let c=0;c<this.length;++c){u.push(this.params[c]);let f=this._subParamsIdx[c]>>8,d=255&this._subParamsIdx[c];d-f>0&&u.push(Array.prototype.slice.call(this._subParams,f,d))}return u}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(u){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=u>a?a:u}}addSubParam(u){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=u>a?a:u,this._subParamsIdx[this.length-1]++}}hasSubParams(u){return(255&this._subParamsIdx[u])-(this._subParamsIdx[u]>>8)>0}getSubParams(u){let c=this._subParamsIdx[u]>>8,f=255&this._subParamsIdx[u];return f-c>0?this._subParams.subarray(c,f):null}getSubParamsAll(){let u={};for(let c=0;c<this.length;++c){let f=this._subParamsIdx[c]>>8,d=255&this._subParamsIdx[c];d-f>0&&(u[c]=this._subParams.slice(f,d))}return u}addDigit(u){let c;if(this._rejectDigits||!(c=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let f=this._digitIsSub?this._subParams:this.params,d=f[c-1];f[c-1]=~d?Math.min(10*d+u,a):u}}o.Params=l},5741:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.AddonManager=void 0,o.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,l){let h={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(h),l.dispose=()=>this._wrappedAddonDispose(h),l.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let l=-1;for(let h=0;h<this._addons.length;h++)if(this._addons[h]===a){l=h;break}if(l===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(l,1)}}},8771:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferApiView=void 0;let l=a(3785),h=a(511);o.BufferApiView=class{constructor(u,c){this._buffer=u,this.type=c}init(u){return this._buffer=u,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(u){let c=this._buffer.lines.get(u);if(c)return new l.BufferLineApiView(c)}getNullCell(){return new h.CellData}}},3785:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLineApiView=void 0;let l=a(511);o.BufferLineApiView=class{constructor(h){this._line=h}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(h,u){if(!(h<0||h>=this._line.length))return u?(this._line.loadCell(h,u),u):this._line.loadCell(h,new l.CellData)}translateToString(h,u,c){return this._line.translateToString(h,u,c)}}},8285:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferNamespaceApi=void 0;let l=a(8771),h=a(8460),u=a(844);class c extends u.Disposable{constructor(d){super(),this._core=d,this._onBufferChange=this.register(new h.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new l.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new l.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}o.BufferNamespaceApi=c},7975:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ParserApi=void 0,o.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,l){return this._core.registerCsiHandler(a,h=>l(h.toArray()))}addCsiHandler(a,l){return this.registerCsiHandler(a,l)}registerDcsHandler(a,l){return this._core.registerDcsHandler(a,(h,u)=>l(h,u.toArray()))}addDcsHandler(a,l){return this.registerDcsHandler(a,l)}registerEscHandler(a,l){return this._core.registerEscHandler(a,l)}addEscHandler(a,l){return this.registerEscHandler(a,l)}registerOscHandler(a,l){return this._core.registerOscHandler(a,l)}addOscHandler(a,l){return this.registerOscHandler(a,l)}}},7090:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeApi=void 0,o.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(n,o,a){var l=this&&this.__decorate||function(p,v,g,_){var x,b=arguments.length,y=b<3?v:_===null?_=Object.getOwnPropertyDescriptor(v,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(p,v,g,_);else for(var S=p.length-1;S>=0;S--)(x=p[S])&&(y=(b<3?x(y):b>3?x(v,g,y):x(v,g))||y);return b>3&&y&&Object.defineProperty(v,g,y),y},h=this&&this.__param||function(p,v){return function(g,_){v(g,_,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferService=o.MINIMUM_ROWS=o.MINIMUM_COLS=void 0;let u=a(8460),c=a(844),f=a(5295),d=a(2585);o.MINIMUM_COLS=2,o.MINIMUM_ROWS=1;let m=o.BufferService=class extends c.Disposable{get buffer(){return this.buffers.active}constructor(p){super(),this.isUserScrolling=!1,this._onResize=this.register(new u.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new u.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(p.rawOptions.cols||0,o.MINIMUM_COLS),this.rows=Math.max(p.rawOptions.rows||0,o.MINIMUM_ROWS),this.buffers=this.register(new f.BufferSet(p,this))}resize(p,v){this.cols=p,this.rows=v,this.buffers.resize(p,v),this._onResize.fire({cols:p,rows:v})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(p,v=!1){let g=this.buffer,_;_=this._cachedBlankLine,_&&_.length===this.cols&&_.getFg(0)===p.fg&&_.getBg(0)===p.bg||(_=g.getBlankLine(p,v),this._cachedBlankLine=_),_.isWrapped=v;let x=g.ybase+g.scrollTop,b=g.ybase+g.scrollBottom;if(g.scrollTop===0){let y=g.lines.isFull;b===g.lines.length-1?y?g.lines.recycle().copyFrom(_):g.lines.push(_.clone()):g.lines.splice(b+1,0,_.clone()),y?this.isUserScrolling&&(g.ydisp=Math.max(g.ydisp-1,0)):(g.ybase++,this.isUserScrolling||g.ydisp++)}else{let y=b-x+1;g.lines.shiftElements(x+1,y-1,-1),g.lines.set(b,_.clone())}this.isUserScrolling||(g.ydisp=g.ybase),this._onScroll.fire(g.ydisp)}scrollLines(p,v,g){let _=this.buffer;if(p<0){if(_.ydisp===0)return;this.isUserScrolling=!0}else p+_.ydisp>=_.ybase&&(this.isUserScrolling=!1);let x=_.ydisp;_.ydisp=Math.max(Math.min(_.ydisp+p,_.ybase),0),x!==_.ydisp&&(v||this._onScroll.fire(_.ydisp))}};o.BufferService=m=l([h(0,d.IOptionsService)],m)},7994:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CharsetService=void 0,o.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,l){this._charsets[a]=l,this.glevel===a&&(this.charset=l)}}},1753:function(n,o,a){var l=this&&this.__decorate||function(_,x,b,y){var S,w=arguments.length,M=w<3?x:y===null?y=Object.getOwnPropertyDescriptor(x,b):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,x,b,y);else for(var C=_.length-1;C>=0;C--)(S=_[C])&&(M=(w<3?S(M):w>3?S(x,b,M):S(x,b))||M);return w>3&&M&&Object.defineProperty(x,b,M),M},h=this&&this.__param||function(_,x){return function(b,y){x(b,y,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreMouseService=void 0;let u=a(2585),c=a(8460),f=a(844),d={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:_=>_.button!==4&&_.action===1&&(_.ctrl=!1,_.alt=!1,_.shift=!1,!0)},VT200:{events:19,restrict:_=>_.action!==32},DRAG:{events:23,restrict:_=>_.action!==32||_.button!==3},ANY:{events:31,restrict:_=>!0}};function m(_,x){let b=(_.ctrl?16:0)|(_.shift?4:0)|(_.alt?8:0);return _.button===4?(b|=64,b|=_.action):(b|=3&_.button,4&_.button&&(b|=64),8&_.button&&(b|=128),_.action===32?b|=32:_.action!==0||x||(b|=3)),b}let p=String.fromCharCode,v={DEFAULT:_=>{let x=[m(_,!1)+32,_.col+32,_.row+32];return x[0]>255||x[1]>255||x[2]>255?"":`\x1B[M${p(x[0])}${p(x[1])}${p(x[2])}`},SGR:_=>{let x=_.action===0&&_.button!==4?"m":"M";return`\x1B[<${m(_,!0)};${_.col};${_.row}${x}`},SGR_PIXELS:_=>{let x=_.action===0&&_.button!==4?"m":"M";return`\x1B[<${m(_,!0)};${_.x};${_.y}${x}`}},g=o.CoreMouseService=class extends f.Disposable{constructor(_,x){super(),this._bufferService=_,this._coreService=x,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new c.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let b of Object.keys(d))this.addProtocol(b,d[b]);for(let b of Object.keys(v))this.addEncoding(b,v[b]);this.reset()}addProtocol(_,x){this._protocols[_]=x}addEncoding(_,x){this._encodings[_]=x}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(_){if(!this._protocols[_])throw new Error(`unknown protocol "${_}"`);this._activeProtocol=_,this._onProtocolChange.fire(this._protocols[_].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(_){if(!this._encodings[_])throw new Error(`unknown encoding "${_}"`);this._activeEncoding=_}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(_){if(_.col<0||_.col>=this._bufferService.cols||_.row<0||_.row>=this._bufferService.rows||_.button===4&&_.action===32||_.button===3&&_.action!==32||_.button!==4&&(_.action===2||_.action===3)||(_.col++,_.row++,_.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,_,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(_))return!1;let x=this._encodings[this._activeEncoding](_);return x&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(x):this._coreService.triggerDataEvent(x,!0)),this._lastEvent=_,!0}explainEvents(_){return{down:!!(1&_),up:!!(2&_),drag:!!(4&_),move:!!(8&_),wheel:!!(16&_)}}_equalEvents(_,x,b){if(b){if(_.x!==x.x||_.y!==x.y)return!1}else if(_.col!==x.col||_.row!==x.row)return!1;return _.button===x.button&&_.action===x.action&&_.ctrl===x.ctrl&&_.alt===x.alt&&_.shift===x.shift}};o.CoreMouseService=g=l([h(0,u.IBufferService),h(1,u.ICoreService)],g)},6975:function(n,o,a){var l=this&&this.__decorate||function(g,_,x,b){var y,S=arguments.length,w=S<3?_:b===null?b=Object.getOwnPropertyDescriptor(_,x):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,_,x,b);else for(var M=g.length-1;M>=0;M--)(y=g[M])&&(w=(S<3?y(w):S>3?y(_,x,w):y(_,x))||w);return S>3&&w&&Object.defineProperty(_,x,w),w},h=this&&this.__param||function(g,_){return function(x,b){_(x,b,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreService=void 0;let u=a(1439),c=a(8460),f=a(844),d=a(2585),m=Object.freeze({insertMode:!1}),p=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),v=o.CoreService=class extends f.Disposable{constructor(g,_,x){super(),this._bufferService=g,this._logService=_,this._optionsService=x,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new c.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new c.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new c.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new c.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,u.clone)(m),this.decPrivateModes=(0,u.clone)(p)}reset(){this.modes=(0,u.clone)(m),this.decPrivateModes=(0,u.clone)(p)}triggerDataEvent(g,_=!1){if(this._optionsService.rawOptions.disableStdin)return;let x=this._bufferService.buffer;_&&this._optionsService.rawOptions.scrollOnUserInput&&x.ybase!==x.ydisp&&this._onRequestScrollToBottom.fire(),_&&this._onUserInput.fire(),this._logService.debug(`sending data "${g}"`,()=>g.split("").map(b=>b.charCodeAt(0))),this._onData.fire(g)}triggerBinaryEvent(g){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${g}"`,()=>g.split("").map(_=>_.charCodeAt(0))),this._onBinary.fire(g))}};o.CoreService=v=l([h(0,d.IBufferService),h(1,d.ILogService),h(2,d.IOptionsService)],v)},9074:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DecorationService=void 0;let l=a(8055),h=a(8460),u=a(844),c=a(6106),f=0,d=0;class m extends u.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new c.SortedList(g=>g==null?void 0:g.marker.line),this._onDecorationRegistered=this.register(new h.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new h.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,u.toDisposable)(()=>this.reset()))}registerDecoration(g){if(g.marker.isDisposed)return;let _=new p(g);if(_){let x=_.marker.onDispose(()=>_.dispose());_.onDispose(()=>{_&&(this._decorations.delete(_)&&this._onDecorationRemoved.fire(_),x.dispose())}),this._decorations.insert(_),this._onDecorationRegistered.fire(_)}return _}reset(){for(let g of this._decorations.values())g.dispose();this._decorations.clear()}*getDecorationsAtCell(g,_,x){var b,y,S;let w=0,M=0;for(let C of this._decorations.getKeyIterator(_))w=(b=C.options.x)!==null&&b!==void 0?b:0,M=w+((y=C.options.width)!==null&&y!==void 0?y:1),g>=w&&g<M&&(!x||((S=C.options.layer)!==null&&S!==void 0?S:"bottom")===x)&&(yield C)}forEachDecorationAtCell(g,_,x,b){this._decorations.forEachByKey(_,y=>{var S,w,M;f=(S=y.options.x)!==null&&S!==void 0?S:0,d=f+((w=y.options.width)!==null&&w!==void 0?w:1),g>=f&&g<d&&(!x||((M=y.options.layer)!==null&&M!==void 0?M:"bottom")===x)&&b(y)})}}o.DecorationService=m;class p extends u.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=l.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=l.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(g){super(),this.options=g,this.onRenderEmitter=this.register(new h.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=g.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.InstantiationService=o.ServiceCollection=void 0;let l=a(2585),h=a(8343);class u{constructor(...f){this._entries=new Map;for(let[d,m]of f)this.set(d,m)}set(f,d){let m=this._entries.get(f);return this._entries.set(f,d),m}forEach(f){for(let[d,m]of this._entries.entries())f(d,m)}has(f){return this._entries.has(f)}get(f){return this._entries.get(f)}}o.ServiceCollection=u,o.InstantiationService=class{constructor(){this._services=new u,this._services.set(l.IInstantiationService,this)}setService(c,f){this._services.set(c,f)}getService(c){return this._services.get(c)}createInstance(c,...f){let d=(0,h.getServiceDependencies)(c).sort((v,g)=>v.index-g.index),m=[];for(let v of d){let g=this._services.get(v.id);if(!g)throw new Error(`[createInstance] ${c.name} depends on UNKNOWN service ${v.id}.`);m.push(g)}let p=d.length>0?d[0].index:f.length;if(f.length!==p)throw new Error(`[createInstance] First service dependency of ${c.name} at position ${p+1} conflicts with ${f.length} static arguments`);return new c(...f,...m)}}},7866:function(n,o,a){var l=this&&this.__decorate||function(p,v,g,_){var x,b=arguments.length,y=b<3?v:_===null?_=Object.getOwnPropertyDescriptor(v,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(p,v,g,_);else for(var S=p.length-1;S>=0;S--)(x=p[S])&&(y=(b<3?x(y):b>3?x(v,g,y):x(v,g))||y);return b>3&&y&&Object.defineProperty(v,g,y),y},h=this&&this.__param||function(p,v){return function(g,_){v(g,_,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;let u=a(844),c=a(2585),f={trace:c.LogLevelEnum.TRACE,debug:c.LogLevelEnum.DEBUG,info:c.LogLevelEnum.INFO,warn:c.LogLevelEnum.WARN,error:c.LogLevelEnum.ERROR,off:c.LogLevelEnum.OFF},d,m=o.LogService=class extends u.Disposable{get logLevel(){return this._logLevel}constructor(p){super(),this._optionsService=p,this._logLevel=c.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),d=this}_updateLogLevel(){this._logLevel=f[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(p){for(let v=0;v<p.length;v++)typeof p[v]=="function"&&(p[v]=p[v]())}_log(p,v,g){this._evalLazyOptionalParams(g),p.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+v,...g)}trace(p,...v){var g,_;this._logLevel<=c.LogLevelEnum.TRACE&&this._log((_=(g=this._optionsService.options.logger)===null||g===void 0?void 0:g.trace.bind(this._optionsService.options.logger))!==null&&_!==void 0?_:console.log,p,v)}debug(p,...v){var g,_;this._logLevel<=c.LogLevelEnum.DEBUG&&this._log((_=(g=this._optionsService.options.logger)===null||g===void 0?void 0:g.debug.bind(this._optionsService.options.logger))!==null&&_!==void 0?_:console.log,p,v)}info(p,...v){var g,_;this._logLevel<=c.LogLevelEnum.INFO&&this._log((_=(g=this._optionsService.options.logger)===null||g===void 0?void 0:g.info.bind(this._optionsService.options.logger))!==null&&_!==void 0?_:console.info,p,v)}warn(p,...v){var g,_;this._logLevel<=c.LogLevelEnum.WARN&&this._log((_=(g=this._optionsService.options.logger)===null||g===void 0?void 0:g.warn.bind(this._optionsService.options.logger))!==null&&_!==void 0?_:console.warn,p,v)}error(p,...v){var g,_;this._logLevel<=c.LogLevelEnum.ERROR&&this._log((_=(g=this._optionsService.options.logger)===null||g===void 0?void 0:g.error.bind(this._optionsService.options.logger))!==null&&_!==void 0?_:console.error,p,v)}};o.LogService=m=l([h(0,c.IOptionsService)],m),o.setTraceLogger=function(p){d=p},o.traceCall=function(p,v,g){if(typeof g.value!="function")throw new Error("not supported");let _=g.value;g.value=function(...x){if(d.logLevel!==c.LogLevelEnum.TRACE)return _.apply(this,x);d.trace(`GlyphRenderer#${_.name}(${x.map(y=>JSON.stringify(y)).join(", ")})`);let b=_.apply(this,x);return d.trace(`GlyphRenderer#${_.name} return`,b),b}}},7302:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OptionsService=o.DEFAULT_OPTIONS=void 0;let l=a(8460),h=a(844),u=a(6114);o.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:u.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let c=["normal","bold","100","200","300","400","500","600","700","800","900"];class f extends h.Disposable{constructor(m){super(),this._onOptionChange=this.register(new l.EventEmitter),this.onOptionChange=this._onOptionChange.event;let p=Object.assign({},o.DEFAULT_OPTIONS);for(let v in m)if(v in p)try{let g=m[v];p[v]=this._sanitizeAndValidateOption(v,g)}catch(g){console.error(g)}this.rawOptions=p,this.options=Object.assign({},p),this._setupOptions()}onSpecificOptionChange(m,p){return this.onOptionChange(v=>{v===m&&p(this.rawOptions[m])})}onMultipleOptionChange(m,p){return this.onOptionChange(v=>{m.indexOf(v)!==-1&&p()})}_setupOptions(){let m=v=>{if(!(v in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);return this.rawOptions[v]},p=(v,g)=>{if(!(v in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);g=this._sanitizeAndValidateOption(v,g),this.rawOptions[v]!==g&&(this.rawOptions[v]=g,this._onOptionChange.fire(v))};for(let v in this.rawOptions){let g={get:m.bind(this,v),set:p.bind(this,v)};Object.defineProperty(this.options,v,g)}}_sanitizeAndValidateOption(m,p){switch(m){case"cursorStyle":if(p||(p=o.DEFAULT_OPTIONS[m]),!function(v){return v==="block"||v==="underline"||v==="bar"}(p))throw new Error(`"${p}" is not a valid value for ${m}`);break;case"wordSeparator":p||(p=o.DEFAULT_OPTIONS[m]);break;case"fontWeight":case"fontWeightBold":if(typeof p=="number"&&1<=p&&p<=1e3)break;p=c.includes(p)?p:o.DEFAULT_OPTIONS[m];break;case"cursorWidth":p=Math.floor(p);case"lineHeight":case"tabStopWidth":if(p<1)throw new Error(`${m} cannot be less than 1, value: ${p}`);break;case"minimumContrastRatio":p=Math.max(1,Math.min(21,Math.round(10*p)/10));break;case"scrollback":if((p=Math.min(p,4294967295))<0)throw new Error(`${m} cannot be less than 0, value: ${p}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(p<=0)throw new Error(`${m} cannot be less than or equal to 0, value: ${p}`);break;case"rows":case"cols":if(!p&&p!==0)throw new Error(`${m} must be numeric, value: ${p}`);break;case"windowsPty":p=p!=null?p:{}}return p}}o.OptionsService=f},2660:function(n,o,a){var l=this&&this.__decorate||function(f,d,m,p){var v,g=arguments.length,_=g<3?d:p===null?p=Object.getOwnPropertyDescriptor(d,m):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(f,d,m,p);else for(var x=f.length-1;x>=0;x--)(v=f[x])&&(_=(g<3?v(_):g>3?v(d,m,_):v(d,m))||_);return g>3&&_&&Object.defineProperty(d,m,_),_},h=this&&this.__param||function(f,d){return function(m,p){d(m,p,f)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkService=void 0;let u=a(2585),c=o.OscLinkService=class{constructor(f){this._bufferService=f,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(f){let d=this._bufferService.buffer;if(f.id===void 0){let x=d.addMarker(d.ybase+d.y),b={data:f,id:this._nextId++,lines:[x]};return x.onDispose(()=>this._removeMarkerFromLink(b,x)),this._dataByLinkId.set(b.id,b),b.id}let m=f,p=this._getEntryIdKey(m),v=this._entriesWithId.get(p);if(v)return this.addLineToLink(v.id,d.ybase+d.y),v.id;let g=d.addMarker(d.ybase+d.y),_={id:this._nextId++,key:this._getEntryIdKey(m),data:m,lines:[g]};return g.onDispose(()=>this._removeMarkerFromLink(_,g)),this._entriesWithId.set(_.key,_),this._dataByLinkId.set(_.id,_),_.id}addLineToLink(f,d){let m=this._dataByLinkId.get(f);if(m&&m.lines.every(p=>p.line!==d)){let p=this._bufferService.buffer.addMarker(d);m.lines.push(p),p.onDispose(()=>this._removeMarkerFromLink(m,p))}}getLinkData(f){var d;return(d=this._dataByLinkId.get(f))===null||d===void 0?void 0:d.data}_getEntryIdKey(f){return`${f.id};;${f.uri}`}_removeMarkerFromLink(f,d){let m=f.lines.indexOf(d);m!==-1&&(f.lines.splice(m,1),f.lines.length===0&&(f.data.id!==void 0&&this._entriesWithId.delete(f.key),this._dataByLinkId.delete(f.id)))}};o.OscLinkService=c=l([h(0,u.IBufferService)],c)},8343:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;let a="di$target",l="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(h){return h[l]||[]},o.createDecorator=function(h){if(o.serviceRegistry.has(h))return o.serviceRegistry.get(h);let u=function(c,f,d){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(m,p,v){p[a]===p?p[l].push({id:m,index:v}):(p[l]=[{id:m,index:v}],p[a]=p)})(u,c,d)};return u.toString=()=>h,o.serviceRegistry.set(h,u),u}},2585:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;let l=a(8343);var h;o.IBufferService=(0,l.createDecorator)("BufferService"),o.ICoreMouseService=(0,l.createDecorator)("CoreMouseService"),o.ICoreService=(0,l.createDecorator)("CoreService"),o.ICharsetService=(0,l.createDecorator)("CharsetService"),o.IInstantiationService=(0,l.createDecorator)("InstantiationService"),function(u){u[u.TRACE=0]="TRACE",u[u.DEBUG=1]="DEBUG",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.OFF=5]="OFF"}(h||(o.LogLevelEnum=h={})),o.ILogService=(0,l.createDecorator)("LogService"),o.IOptionsService=(0,l.createDecorator)("OptionsService"),o.IOscLinkService=(0,l.createDecorator)("OscLinkService"),o.IUnicodeService=(0,l.createDecorator)("UnicodeService"),o.IDecorationService=(0,l.createDecorator)("DecorationService")},1480:(n,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeService=void 0;let l=a(8460),h=a(225);o.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new l.EventEmitter,this.onChange=this._onChange.event;let u=new h.UnicodeV6;this.register(u),this._active=u.version,this._activeProvider=u}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(u){if(!this._providers[u])throw new Error(`unknown Unicode version "${u}"`);this._active=u,this._activeProvider=this._providers[u],this._onChange.fire(u)}register(u){this._providers[u.version]=u}wcwidth(u){return this._activeProvider.wcwidth(u)}getStringCellWidth(u){let c=0,f=u.length;for(let d=0;d<f;++d){let m=u.charCodeAt(d);if(55296<=m&&m<=56319){if(++d>=f)return c+this.wcwidth(m);let p=u.charCodeAt(d);56320<=p&&p<=57343?m=1024*(m-55296)+p-56320+65536:c+=this.wcwidth(p)}c+=this.wcwidth(m)}return c}}}},e={};function i(n){var o=e[n];if(o!==void 0)return o.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,i),a.exports}var r={};return(()=>{var n=r;Object.defineProperty(n,"__esModule",{value:!0}),n.Terminal=void 0;let o=i(9042),a=i(3236),l=i(844),h=i(5741),u=i(8285),c=i(7975),f=i(7090),d=["cols","rows"];class m extends l.Disposable{constructor(v){super(),this._core=this.register(new a.Terminal(v)),this._addonManager=this.register(new h.AddonManager),this._publicOptions=Object.assign({},this._core.options);let g=x=>this._core.options[x],_=(x,b)=>{this._checkReadonlyOptions(x),this._core.options[x]=b};for(let x in this._core.options){let b={get:g.bind(this,x),set:_.bind(this,x)};Object.defineProperty(this._publicOptions,x,b)}}_checkReadonlyOptions(v){if(d.includes(v))throw new Error(`Option "${v}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new c.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new f.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new u.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let v=this._core.coreService.decPrivateModes,g="none";switch(this._core.coreMouseService.activeProtocol){case"X10":g="x10";break;case"VT200":g="vt200";break;case"DRAG":g="drag";break;case"ANY":g="any"}return{applicationCursorKeysMode:v.applicationCursorKeys,applicationKeypadMode:v.applicationKeypad,bracketedPasteMode:v.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:g,originMode:v.origin,reverseWraparoundMode:v.reverseWraparound,sendFocusMode:v.sendFocus,wraparoundMode:v.wraparound}}get options(){return this._publicOptions}set options(v){for(let g in v)this._publicOptions[g]=v[g]}blur(){this._core.blur()}focus(){this._core.focus()}resize(v,g){this._verifyIntegers(v,g),this._core.resize(v,g)}open(v){this._core.open(v)}attachCustomKeyEventHandler(v){this._core.attachCustomKeyEventHandler(v)}registerLinkProvider(v){return this._core.registerLinkProvider(v)}registerCharacterJoiner(v){return this._checkProposedApi(),this._core.registerCharacterJoiner(v)}deregisterCharacterJoiner(v){this._checkProposedApi(),this._core.deregisterCharacterJoiner(v)}registerMarker(v=0){return this._verifyIntegers(v),this._core.registerMarker(v)}registerDecoration(v){var g,_,x;return this._checkProposedApi(),this._verifyPositiveIntegers((g=v.x)!==null&&g!==void 0?g:0,(_=v.width)!==null&&_!==void 0?_:0,(x=v.height)!==null&&x!==void 0?x:0),this._core.registerDecoration(v)}hasSelection(){return this._core.hasSelection()}select(v,g,_){this._verifyIntegers(v,g,_),this._core.select(v,g,_)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(v,g){this._verifyIntegers(v,g),this._core.selectLines(v,g)}dispose(){super.dispose()}scrollLines(v){this._verifyIntegers(v),this._core.scrollLines(v)}scrollPages(v){this._verifyIntegers(v),this._core.scrollPages(v)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(v){this._verifyIntegers(v),this._core.scrollToLine(v)}clear(){this._core.clear()}write(v,g){this._core.write(v,g)}writeln(v,g){this._core.write(v),this._core.write(`\r
`,g)}paste(v){this._core.paste(v)}refresh(v,g){this._verifyIntegers(v,g),this._core.refresh(v,g)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(v){this._addonManager.loadAddon(this,v)}static get strings(){return o}_verifyIntegers(...v){for(let g of v)if(g===1/0||isNaN(g)||g%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...v){for(let g of v)if(g&&(g===1/0||isNaN(g)||g%1!=0||g<0))throw new Error("This API only accepts positive integers")}}n.Terminal=m})(),r})())});var P3=oe((Cv,pS)=>{(function(t,e){typeof Cv=="object"&&typeof pS=="object"?pS.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Cv=="object"?Cv.FitAddon=e():t.FitAddon=e()})(self,()=>(()=>{"use strict";var t={};return(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{activate(i){this._terminal=i}dispose(){}fit(){let i=this.proposeDimensions();if(!i||!this._terminal||isNaN(i.cols)||isNaN(i.rows))return;let r=this._terminal._core;this._terminal.rows===i.rows&&this._terminal.cols===i.cols||(r._renderService.clear(),this._terminal.resize(i.cols,i.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let i=this._terminal._core,r=i._renderService.dimensions;if(r.css.cell.width===0||r.css.cell.height===0)return;let n=this._terminal.options.scrollback===0?0:i.viewport.scrollBarWidth,o=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(o.getPropertyValue("height")),l=Math.max(0,parseInt(o.getPropertyValue("width"))),h=window.getComputedStyle(this._terminal.element),u=a-(parseInt(h.getPropertyValue("padding-top"))+parseInt(h.getPropertyValue("padding-bottom"))),c=l-(parseInt(h.getPropertyValue("padding-right"))+parseInt(h.getPropertyValue("padding-left")))-n;return{cols:Math.max(2,Math.floor(c/r.css.cell.width)),rows:Math.max(1,Math.floor(u/r.css.cell.height))}}}})(),t})())});var R3=oe((Ev,mS)=>{(function(t,e){typeof Ev=="object"&&typeof mS=="object"?mS.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Ev=="object"?Ev.WebLinksAddon=e():t.WebLinksAddon=e()})(self,()=>(()=>{"use strict";var t={6:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkComputer=o.WebLinkProvider=void 0,o.WebLinkProvider=class{constructor(l,h,u,c={}){this._terminal=l,this._regex=h,this._handler=u,this._options=c}provideLinks(l,h){let u=a.computeLink(l,this._regex,this._terminal,this._handler);h(this._addCallbacks(u))}_addCallbacks(l){return l.map(h=>(h.leave=this._options.leave,h.hover=(u,c)=>{if(this._options.hover){let{range:f}=h;this._options.hover(u,c,f)}},h))}};class a{static computeLink(h,u,c,f){let d=new RegExp(u.source,(u.flags||"")+"g"),[m,p]=a._getWindowedLineStrings(h-1,c),v=m.join(""),g,_=[];for(;g=d.exec(v);){let x=g[0];try{let C=new URL(x),E=decodeURI(C.toString());if(x!==E&&x+"/"!==E)continue}catch(C){continue}let[b,y]=a._mapStrIdx(c,p,0,g.index),[S,w]=a._mapStrIdx(c,b,y,x.length);if(b===-1||y===-1||S===-1||w===-1)continue;let M={start:{x:y+1,y:b+1},end:{x:w,y:S+1}};_.push({range:M,text:x,activate:f})}return _}static _getWindowedLineStrings(h,u){let c,f=h,d=h,m=0,p="",v=[];if(c=u.buffer.active.getLine(h)){let g=c.translateToString(!0);if(c.isWrapped&&g[0]!==" "){for(m=0;(c=u.buffer.active.getLine(--f))&&m<2048&&(p=c.translateToString(!0),m+=p.length,v.push(p),c.isWrapped&&p.indexOf(" ")===-1););v.reverse()}for(v.push(g),m=0;(c=u.buffer.active.getLine(++d))&&c.isWrapped&&m<2048&&(p=c.translateToString(!0),m+=p.length,v.push(p),p.indexOf(" ")===-1););}return[v,f]}static _mapStrIdx(h,u,c,f){let d=h.buffer.active,m=d.getNullCell(),p=c;for(;f;){let v=d.getLine(u);if(!v)return[-1,-1];for(let g=p;g<v.length;++g){v.getCell(g,m);let _=m.getChars();if(m.getWidth()&&(f-=_.length||1,g===v.length-1&&_==="")){let x=d.getLine(u+1);x&&x.isWrapped&&(x.getCell(0,m),m.getWidth()===2&&(f+=1))}if(f<0)return[u,g]}u++,p=0}return[u,p]}}o.LinkComputer=a}},e={};function i(n){var o=e[n];if(o!==void 0)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,i),a.exports}var r={};return(()=>{var n=r;Object.defineProperty(n,"__esModule",{value:!0}),n.WebLinksAddon=void 0;let o=i(6),a=/https?:[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function l(h,u){let c=window.open();if(c){try{c.opener=null}catch(f){}c.location.href=u}else console.warn("Opening link blocked as opener could not be cleared")}n.WebLinksAddon=class{constructor(h=l,u={}){this._handler=h,this._options=u}activate(h){this._terminal=h;let u=this._options,c=u.urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new o.WebLinkProvider(this._terminal,c,this._handler,u))}dispose(){var h;(h=this._linkProvider)===null||h===void 0||h.dispose()}}})(),r})())});var V3=oe((G2e,W3)=>{"use strict";var H3=Object.getOwnPropertySymbols,oZ=Object.prototype.hasOwnProperty,aZ=Object.prototype.propertyIsEnumerable;function lZ(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function hZ(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;var r=Object.getOwnPropertyNames(e).map(function(o){return e[o]});if(r.join("")!=="0123456789")return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(o){n[o]=o}),Object.keys(Object.assign({},n)).join("")==="abcdefghijklmnopqrst"}catch(o){return!1}}W3.exports=hZ()?Object.assign:function(t,e){for(var i,r=lZ(t),n,o=1;o<arguments.length;o++){i=Object(arguments[o]);for(var a in i)oZ.call(i,a)&&(r[a]=i[a]);if(H3){n=H3(i);for(var l=0;l<n.length;l++)aZ.call(i,n[l])&&(r[n[l]]=i[n[l]])}}return r}});var aN=oe((q2e,bS)=>{"use strict";var gZ=Object.prototype.hasOwnProperty,Hr="~";function Pf(){}Object.create&&(Pf.prototype=Object.create(null),new Pf().__proto__||(Hr=!1));function vZ(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function oN(t,e,i,r,n){if(typeof i!="function")throw new TypeError("The listener must be a function");var o=new vZ(i,r||t,n),a=Hr?Hr+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function Pv(t,e){--t._eventsCount===0?t._events=new Pf:delete t._events[e]}function Sr(){this._events=new Pf,this._eventsCount=0}Sr.prototype.eventNames=function(){var e=[],i,r;if(this._eventsCount===0)return e;for(r in i=this._events)gZ.call(i,r)&&e.push(Hr?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(i)):e};Sr.prototype.listeners=function(e){var i=Hr?Hr+e:e,r=this._events[i];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a};Sr.prototype.listenerCount=function(e){var i=Hr?Hr+e:e,r=this._events[i];return r?r.fn?1:r.length:0};Sr.prototype.emit=function(e,i,r,n,o,a){var l=Hr?Hr+e:e;if(!this._events[l])return!1;var h=this._events[l],u=arguments.length,c,f;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,i),!0;case 3:return h.fn.call(h.context,i,r),!0;case 4:return h.fn.call(h.context,i,r,n),!0;case 5:return h.fn.call(h.context,i,r,n,o),!0;case 6:return h.fn.call(h.context,i,r,n,o,a),!0}for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];h.fn.apply(h.context,c)}else{var d=h.length,m;for(f=0;f<d;f++)switch(h[f].once&&this.removeListener(e,h[f].fn,void 0,!0),u){case 1:h[f].fn.call(h[f].context);break;case 2:h[f].fn.call(h[f].context,i);break;case 3:h[f].fn.call(h[f].context,i,r);break;case 4:h[f].fn.call(h[f].context,i,r,n);break;default:if(!c)for(m=1,c=new Array(u-1);m<u;m++)c[m-1]=arguments[m];h[f].fn.apply(h[f].context,c)}}return!0};Sr.prototype.on=function(e,i,r){return oN(this,e,i,r,!1)};Sr.prototype.once=function(e,i,r){return oN(this,e,i,r,!0)};Sr.prototype.removeListener=function(e,i,r,n){var o=Hr?Hr+e:e;if(!this._events[o])return this;if(!i)return Pv(this,o),this;var a=this._events[o];if(a.fn)a.fn===i&&(!n||a.once)&&(!r||a.context===r)&&Pv(this,o);else{for(var l=0,h=[],u=a.length;l<u;l++)(a[l].fn!==i||n&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[o]=h.length===1?h[0]:h:Pv(this,o)}return this};Sr.prototype.removeAllListeners=function(e){var i;return e?(i=Hr?Hr+e:e,this._events[i]&&Pv(this,i)):(this._events=new Pf,this._eventsCount=0),this};Sr.prototype.off=Sr.prototype.removeListener;Sr.prototype.addListener=Sr.prototype.on;Sr.prefixed=Hr;Sr.EventEmitter=Sr;typeof bS!="undefined"&&(bS.exports=Sr)});var fN=oe((X2e,ES)=>{"use strict";ES.exports=Ov;ES.exports.default=Ov;function Ov(t,e,i){i=i||2;var r=e&&e.length,n=r?e[0]*i:t.length,o=hN(t,0,n,i,!0),a=[];if(!o||o.next===o.prev)return a;var l,h,u,c,f,d,m;if(r&&(o=wZ(t,e,o,i)),t.length>80*i){l=u=t[0],h=c=t[1];for(var p=i;p<n;p+=i)f=t[p],d=t[p+1],f<l&&(l=f),d<h&&(h=d),f>u&&(u=f),d>c&&(c=d);m=Math.max(u-l,c-h),m=m!==0?32767/m:0}return Rf(o,a,i,l,h,m,0),a}function hN(t,e,i,r,n){var o,a;if(n===CS(t,e,i,r)>0)for(o=e;o<i;o+=r)a=lN(o,t[o],t[o+1],a);else for(o=i-r;o>=e;o-=r)a=lN(o,t[o],t[o+1],a);return a&&Dv(a,a.next)&&(Of(a),a=a.next),a}function gl(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(Dv(i,i.next)||_i(i.prev,i,i.next)===0)){if(Of(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Rf(t,e,i,r,n,o,a){if(t){!a&&o&&TZ(t,r,n,o);for(var l=t,h,u;t.prev!==t.next;){if(h=t.prev,u=t.next,o?yZ(t,r,n,o):_Z(t)){e.push(h.i/i|0),e.push(t.i/i|0),e.push(u.i/i|0),Of(t),t=u.next,l=u.next;continue}if(t=u,t===l){a?a===1?(t=xZ(gl(t),e,i),Rf(t,e,i,r,n,o,2)):a===2&&bZ(t,e,i,r,n,o):Rf(gl(t),e,i,r,n,o,1);break}}}}function _Z(t){var e=t.prev,i=t,r=t.next;if(_i(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,a=r.x,l=e.y,h=i.y,u=r.y,c=n<o?n<a?n:a:o<a?o:a,f=l<h?l<u?l:u:h<u?h:u,d=n>o?n>a?n:a:o>a?o:a,m=l>h?l>u?l:u:h>u?h:u,p=r.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=f&&p.y<=m&&Qh(n,l,o,h,a,u,p.x,p.y)&&_i(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function yZ(t,e,i,r){var n=t.prev,o=t,a=t.next;if(_i(n,o,a)>=0)return!1;for(var l=n.x,h=o.x,u=a.x,c=n.y,f=o.y,d=a.y,m=l<h?l<u?l:u:h<u?h:u,p=c<f?c<d?c:d:f<d?f:d,v=l>h?l>u?l:u:h>u?h:u,g=c>f?c>d?c:d:f>d?f:d,_=wS(m,p,e,i,r),x=wS(v,g,e,i,r),b=t.prevZ,y=t.nextZ;b&&b.z>=_&&y&&y.z<=x;){if(b.x>=m&&b.x<=v&&b.y>=p&&b.y<=g&&b!==n&&b!==a&&Qh(l,c,h,f,u,d,b.x,b.y)&&_i(b.prev,b,b.next)>=0||(b=b.prevZ,y.x>=m&&y.x<=v&&y.y>=p&&y.y<=g&&y!==n&&y!==a&&Qh(l,c,h,f,u,d,y.x,y.y)&&_i(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;b&&b.z>=_;){if(b.x>=m&&b.x<=v&&b.y>=p&&b.y<=g&&b!==n&&b!==a&&Qh(l,c,h,f,u,d,b.x,b.y)&&_i(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;y&&y.z<=x;){if(y.x>=m&&y.x<=v&&y.y>=p&&y.y<=g&&y!==n&&y!==a&&Qh(l,c,h,f,u,d,y.x,y.y)&&_i(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function xZ(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Dv(n,o)&&uN(n,r,r.next,o)&&Lf(n,o)&&Lf(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),Of(r),Of(r.next),r=t=o),r=r.next}while(r!==t);return gl(r)}function bZ(t,e,i,r,n,o){var a=t;do{for(var l=a.next.next;l!==a.prev;){if(a.i!==l.i&&RZ(a,l)){var h=cN(a,l);a=gl(a,a.next),h=gl(h,h.next),Rf(a,e,i,r,n,o,0),Rf(h,e,i,r,n,o,0);return}l=l.next}a=a.next}while(a!==t)}function wZ(t,e,i,r){var n=[],o,a,l,h,u;for(o=0,a=e.length;o<a;o++)l=e[o]*r,h=o<a-1?e[o+1]*r:t.length,u=hN(t,l,h,r,!1),u===u.next&&(u.steiner=!0),n.push(PZ(u));for(n.sort(SZ),o=0;o<n.length;o++)i=CZ(n[o],i);return i}function SZ(t,e){return t.x-e.x}function CZ(t,e){var i=EZ(t,e);if(!i)return e;var r=cN(i,t);return gl(r,r.next),gl(i,i.next)}function EZ(t,e){var i=e,r=t.x,n=t.y,o=-1/0,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var l=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(l<=r&&l>o&&(o=l,a=i.x<i.next.x?i:i.next,l===r))return a}i=i.next}while(i!==e);if(!a)return null;var h=a,u=a.x,c=a.y,f=1/0,d;i=a;do r>=i.x&&i.x>=u&&r!==i.x&&Qh(n<c?r:o,n,u,c,n<c?o:r,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(r-i.x),Lf(i,t)&&(d<f||d===f&&(i.x>a.x||i.x===a.x&&MZ(a,i)))&&(a=i,f=d)),i=i.next;while(i!==h);return a}function MZ(t,e){return _i(t.prev,t,e.prev)<0&&_i(e.next,t,t.next)<0}function TZ(t,e,i,r){var n=t;do n.z===0&&(n.z=wS(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,AZ(n)}function AZ(t){var e,i,r,n,o,a,l,h,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,r=i,l=0,e=0;e<u&&(l++,r=r.nextZ,!!r);e++);for(h=u;l>0||h>0&&r;)l!==0&&(h===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,l--):(n=r,r=r.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1);return t}function wS(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function PZ(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Qh(t,e,i,r,n,o,a,l){return(n-a)*(e-l)>=(t-a)*(o-l)&&(t-a)*(r-l)>=(i-a)*(e-l)&&(i-a)*(o-l)>=(n-a)*(r-l)}function RZ(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!LZ(t,e)&&(Lf(t,e)&&Lf(e,t)&&OZ(t,e)&&(_i(t.prev,t,e.prev)||_i(t,e.prev,e))||Dv(t,e)&&_i(t.prev,t,t.next)>0&&_i(e.prev,e,e.next)>0)}function _i(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Dv(t,e){return t.x===e.x&&t.y===e.y}function uN(t,e,i,r){var n=Lv(_i(t,e,i)),o=Lv(_i(t,e,r)),a=Lv(_i(i,r,t)),l=Lv(_i(i,r,e));return!!(n!==o&&a!==l||n===0&&Rv(t,i,e)||o===0&&Rv(t,r,e)||a===0&&Rv(i,t,r)||l===0&&Rv(i,e,r))}function Rv(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Lv(t){return t>0?1:t<0?-1:0}function LZ(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&uN(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Lf(t,e){return _i(t.prev,t,t.next)<0?_i(t,e,t.next)>=0&&_i(t,t.prev,e)>=0:_i(t,e,t.prev)<0||_i(t,t.next,e)<0}function OZ(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function cN(t,e){var i=new SS(t.i,t.x,t.y),r=new SS(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function lN(t,e,i,r){var n=new SS(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Of(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function SS(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ov.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,a=Math.abs(CS(t,0,o,i));if(n)for(var l=0,h=e.length;l<h;l++){var u=e[l]*i,c=l<h-1?e[l+1]*i:t.length;a-=Math.abs(CS(t,u,c,i))}var f=0;for(l=0;l<r.length;l+=3){var d=r[l]*i,m=r[l+1]*i,p=r[l+2]*i;f+=Math.abs((t[d]-t[p])*(t[m+1]-t[d+1])-(t[d]-t[m])*(t[p+1]-t[d+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function CS(t,e,i,r){for(var n=0,o=e,a=i-r;o<i;o+=r)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}Ov.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[n][o][a]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}});var dN=oe((Jh,$h)=>{(function(t){var e=typeof Jh=="object"&&Jh&&!Jh.nodeType&&Jh,i=typeof $h=="object"&&$h&&!$h.nodeType&&$h,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(t=r);var n,o=2147483647,a=36,l=1,h=26,u=38,c=700,f=72,d=128,m="-",p=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=a-l,b=Math.floor,y=String.fromCharCode,S;function w(D){throw RangeError(_[D])}function M(D,F){for(var B=D.length,U=[];B--;)U[B]=F(D[B]);return U}function C(D,F){var B=D.split("@"),U="";B.length>1&&(U=B[0]+"@",D=B[1]),D=D.replace(g,".");var G=D.split("."),Y=M(G,F).join(".");return U+Y}function E(D){for(var F=[],B=0,U=D.length,G,Y;B<U;)G=D.charCodeAt(B++),G>=55296&&G<=56319&&B<U?(Y=D.charCodeAt(B++),(Y&64512)==56320?F.push(((G&1023)<<10)+(Y&1023)+65536):(F.push(G),B--)):F.push(G);return F}function P(D){return M(D,function(F){var B="";return F>65535&&(F-=65536,B+=y(F>>>10&1023|55296),F=56320|F&1023),B+=y(F),B}).join("")}function A(D){return D-48<10?D-22:D-65<26?D-65:D-97<26?D-97:a}function R(D,F){return D+22+75*(D<26)-((F!=0)<<5)}function k(D,F,B){var U=0;for(D=B?b(D/c):D>>1,D+=b(D/F);D>x*h>>1;U+=a)D=b(D/x);return b(U+(x+1)*D/(D+u))}function I(D){var F=[],B=D.length,U,G=0,Y=d,re=f,N,z,ie,Z,ne,K,ae,ue,_e;for(N=D.lastIndexOf(m),N<0&&(N=0),z=0;z<N;++z)D.charCodeAt(z)>=128&&w("not-basic"),F.push(D.charCodeAt(z));for(ie=N>0?N+1:0;ie<B;){for(Z=G,ne=1,K=a;ie>=B&&w("invalid-input"),ae=A(D.charCodeAt(ie++)),(ae>=a||ae>b((o-G)/ne))&&w("overflow"),G+=ae*ne,ue=K<=re?l:K>=re+h?h:K-re,!(ae<ue);K+=a)_e=a-ue,ne>b(o/_e)&&w("overflow"),ne*=_e;U=F.length+1,re=k(G-Z,U,Z==0),b(G/U)>o-Y&&w("overflow"),Y+=b(G/U),G%=U,F.splice(G++,0,Y)}return P(F)}function L(D){var F,B,U,G,Y,re,N,z,ie,Z,ne,K=[],ae,ue,_e,Re;for(D=E(D),ae=D.length,F=d,B=0,Y=f,re=0;re<ae;++re)ne=D[re],ne<128&&K.push(y(ne));for(U=G=K.length,G&&K.push(m);U<ae;){for(N=o,re=0;re<ae;++re)ne=D[re],ne>=F&&ne<N&&(N=ne);for(ue=U+1,N-F>b((o-B)/ue)&&w("overflow"),B+=(N-F)*ue,F=N,re=0;re<ae;++re)if(ne=D[re],ne<F&&++B>o&&w("overflow"),ne==F){for(z=B,ie=a;Z=ie<=Y?l:ie>=Y+h?h:ie-Y,!(z<Z);ie+=a)Re=z-Z,_e=a-Z,K.push(y(R(Z+Re%_e,0))),z=b(Re/_e);K.push(y(R(z,0))),Y=k(B,ue,U==G),B=0,++U}++B,++F}return K.join("")}function T(D){return C(D,function(F){return p.test(F)?I(F.slice(4).toLowerCase()):F})}function O(D){return C(D,function(F){return v.test(F)?"xn--"+L(F):F})}if(n={version:"1.3.2",ucs2:{decode:E,encode:P},decode:I,encode:L,toASCII:O,toUnicode:T},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return n});else if(e&&i)if($h.exports==e)i.exports=n;else for(S in n)n.hasOwnProperty(S)&&(e[S]=n[S]);else t.punycode=n})(Jh)});var mN=oe((Y2e,pN)=>{"use strict";pN.exports={isString:function(t){return typeof t=="string"},isObject:function(t){return typeof t=="object"&&t!==null},isNull:function(t){return t===null},isNullOrUndefined:function(t){return t==null}}});var vN=oe((Z2e,gN)=>{"use strict";function DZ(t,e){return Object.prototype.hasOwnProperty.call(t,e)}gN.exports=function(t,e,i,r){e=e||"&",i=i||"=";var n={};if(typeof t!="string"||t.length===0)return n;var o=/\+/g;t=t.split(e);var a=1e3;r&&typeof r.maxKeys=="number"&&(a=r.maxKeys);var l=t.length;a>0&&l>a&&(l=a);for(var h=0;h<l;++h){var u=t[h].replace(o,"%20"),c=u.indexOf(i),f,d,m,p;c>=0?(f=u.substr(0,c),d=u.substr(c+1)):(f=u,d=""),m=decodeURIComponent(f),p=decodeURIComponent(d),DZ(n,m)?Array.isArray(n[m])?n[m].push(p):n[m]=[n[m],p]:n[m]=p}return n}});var yN=oe((K2e,_N)=>{"use strict";var Df=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};_N.exports=function(t,e,i,r){return e=e||"&",i=i||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(n){var o=encodeURIComponent(Df(n))+i;return Array.isArray(t[n])?t[n].map(function(a){return o+encodeURIComponent(Df(a))}).join(e):o+encodeURIComponent(Df(t[n]))}).join(e):r?encodeURIComponent(Df(r))+i+encodeURIComponent(Df(t)):""}});var xN=oe(If=>{"use strict";If.decode=If.parse=vN();If.encode=If.stringify=yN()});var CN=oe(tu=>{"use strict";var IZ=dN(),js=mN();tu.parse=kf;tu.resolve=VZ;tu.resolveObject=jZ;tu.format=WZ;tu.Url=Wn;function Wn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var kZ=/^([a-z0-9.+-]+:)/i,FZ=/:[0-9]*$/,BZ=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,NZ=["<",">",'"',"`"," ","\r",`
`,"	"],UZ=["{","}","|","\\","^","`"].concat(NZ),MS=["'"].concat(UZ),bN=["%","/","?",";","#"].concat(MS),wN=["/","?","#"],zZ=255,SN=/^[+a-z0-9A-Z_-]{0,63}$/,GZ=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,HZ={javascript:!0,"javascript:":!0},TS={javascript:!0,"javascript:":!0},eu={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},AS=xN();function kf(t,e,i){if(t&&js.isObject(t)&&t instanceof Wn)return t;var r=new Wn;return r.parse(t,e,i),r}Wn.prototype.parse=function(t,e,i){if(!js.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),n=r!==-1&&r<t.indexOf("#")?"?":"#",o=t.split(n),a=/\\/g;o[0]=o[0].replace(a,"/"),t=o.join(n);var l=t;if(l=l.trim(),!i&&t.split("#").length===1){var h=BZ.exec(l);if(h)return this.path=l,this.href=l,this.pathname=h[1],h[2]?(this.search=h[2],e?this.query=AS.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=kZ.exec(l);if(u){u=u[0];var c=u.toLowerCase();this.protocol=c,l=l.substr(u.length)}if(i||u||l.match(/^\/\/[^@\/]+@[^@\/]+/)){var f=l.substr(0,2)==="//";f&&!(u&&TS[u])&&(l=l.substr(2),this.slashes=!0)}if(!TS[u]&&(f||u&&!eu[u])){for(var d=-1,m=0;m<wN.length;m++){var p=l.indexOf(wN[m]);p!==-1&&(d===-1||p<d)&&(d=p)}var v,g;d===-1?g=l.lastIndexOf("@"):g=l.lastIndexOf("@",d),g!==-1&&(v=l.slice(0,g),l=l.slice(g+1),this.auth=decodeURIComponent(v)),d=-1;for(var m=0;m<bN.length;m++){var p=l.indexOf(bN[m]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=l.length),this.host=l.slice(0,d),l=l.slice(d),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var x=this.hostname.split(/\./),m=0,b=x.length;m<b;m++){var y=x[m];if(y&&!y.match(SN)){for(var S="",w=0,M=y.length;w<M;w++)y.charCodeAt(w)>127?S+="x":S+=y[w];if(!S.match(SN)){var C=x.slice(0,m),E=x.slice(m+1),P=y.match(GZ);P&&(C.push(P[1]),E.unshift(P[2])),E.length&&(l="/"+E.join(".")+l),this.hostname=C.join(".");break}}}this.hostname.length>zZ?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=IZ.toASCII(this.hostname));var A=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+A,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),l[0]!=="/"&&(l="/"+l))}if(!HZ[c])for(var m=0,b=MS.length;m<b;m++){var k=MS[m];if(l.indexOf(k)!==-1){var I=encodeURIComponent(k);I===k&&(I=escape(k)),l=l.split(k).join(I)}}var L=l.indexOf("#");L!==-1&&(this.hash=l.substr(L),l=l.slice(0,L));var T=l.indexOf("?");if(T!==-1?(this.search=l.substr(T),this.query=l.substr(T+1),e&&(this.query=AS.parse(this.query)),l=l.slice(0,T)):e&&(this.search="",this.query={}),l&&(this.pathname=l),eu[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var A=this.pathname||"",O=this.search||"";this.path=A+O}return this.href=this.format(),this};function WZ(t){return js.isString(t)&&(t=kf(t)),t instanceof Wn?t.format():Wn.prototype.format.call(t)}Wn.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&js.isObject(this.query)&&Object.keys(this.query).length&&(o=AS.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||eu[e])&&n!==!1?(n="//"+(n||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),i=i.replace(/[?#]/g,function(l){return encodeURIComponent(l)}),a=a.replace("#","%23"),e+n+i+a+r};function VZ(t,e){return kf(t,!1,!0).resolve(e)}Wn.prototype.resolve=function(t){return this.resolveObject(kf(t,!1,!0)).format()};function jZ(t,e){return t?kf(t,!1,!0).resolveObject(e):e}Wn.prototype.resolveObject=function(t){if(js.isString(t)){var e=new Wn;e.parse(t,!1,!0),t=e}for(var i=new Wn,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];i[o]=this[o]}if(i.hash=t.hash,t.href==="")return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var h=a[l];h!=="protocol"&&(i[h]=t[h])}return eu[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!eu[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var f=u[c];i[f]=t[f]}return i.href=i.format(),i}if(i.protocol=t.protocol,!t.host&&!TS[t.protocol]){for(var b=(t.pathname||"").split("/");b.length&&!(t.host=b.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),i.pathname=b.join("/")}else i.pathname=t.pathname;if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var d=i.pathname||"",m=i.search||"";i.path=d+m}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var p=i.pathname&&i.pathname.charAt(0)==="/",v=t.host||t.pathname&&t.pathname.charAt(0)==="/",g=v||p||i.host&&t.pathname,_=g,x=i.pathname&&i.pathname.split("/")||[],b=t.pathname&&t.pathname.split("/")||[],y=i.protocol&&!eu[i.protocol];if(y&&(i.hostname="",i.port=null,i.host&&(x[0]===""?x[0]=i.host:x.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(b[0]===""?b[0]=t.host:b.unshift(t.host)),t.host=null),g=g&&(b[0]===""||x[0]==="")),v)i.host=t.host||t.host===""?t.host:i.host,i.hostname=t.hostname||t.hostname===""?t.hostname:i.hostname,i.search=t.search,i.query=t.query,x=b;else if(b.length)x||(x=[]),x.pop(),x=x.concat(b),i.search=t.search,i.query=t.query;else if(!js.isNullOrUndefined(t.search)){if(y){i.hostname=i.host=x.shift();var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())}return i.search=t.search,i.query=t.query,(!js.isNull(i.pathname)||!js.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!x.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var w=x.slice(-1)[0],M=(i.host||t.host||x.length>1)&&(w==="."||w==="..")||w==="",C=0,E=x.length;E>=0;E--)w=x[E],w==="."?x.splice(E,1):w===".."?(x.splice(E,1),C++):C&&(x.splice(E,1),C--);if(!g&&!_)for(;C--;C)x.unshift("..");g&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")&&x.unshift(""),M&&x.join("/").substr(-1)!=="/"&&x.push("");var P=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(y){i.hostname=i.host=P?"":x.length?x.shift():"";var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())}return g=g||i.host&&x.length,g&&!P&&x.unshift(""),x.length?i.pathname=x.join("/"):(i.pathname=null,i.path=null),(!js.isNull(i.pathname)||!js.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i};Wn.prototype.parseHost=function(){var t=this.host,e=FZ.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}});var Me=oe((td,YC)=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.default=Pie;function b_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?b_=function(i){return typeof i}:b_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},b_(t)}function Pie(t){var e=typeof t=="string"||t instanceof String;if(!e){var i=b_(t);throw t===null?i="null":i==="object"&&(i=t.constructor.name),new TypeError("Expected a string but received a ".concat(i))}}YC.exports=td.default;YC.exports.default=td.default});var w_=oe((id,ZC)=>{"use strict";Object.defineProperty(id,"__esModule",{value:!0});id.default=Oie;var Rie=Lie(Me());function Lie(t){return t&&t.__esModule?t:{default:t}}function Oie(t){return(0,Rie.default)(t),t=Date.parse(t),isNaN(t)?null:new Date(t)}ZC.exports=id.default;ZC.exports.default=id.default});var vu=oe(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.commaDecimal=or.dotDecimal=or.farsiLocales=or.arabicLocales=or.englishLocales=or.decimal=or.alphanumeric=or.alpha=void 0;var Mn={"en-US":/^[A-Z]+$/i,"az-AZ":/^[A-VXYZ]+$/i,"bg-BG":/^[-]+$/i,"cs-CZ":/^[A-Z]+$/i,"da-DK":/^[A-Z]+$/i,"de-DE":/^[A-Z]+$/i,"el-GR":/^[-]+$/i,"es-ES":/^[A-Z]+$/i,"fa-IR":/^[]+$/i,"fi-FI":/^[A-Z]+$/i,"fr-FR":/^[A-Z]+$/i,"it-IT":/^[A-Z]+$/i,"nb-NO":/^[A-Z]+$/i,"nl-NL":/^[A-Z]+$/i,"nn-NO":/^[A-Z]+$/i,"hu-HU":/^[A-Z]+$/i,"pl-PL":/^[A-Z]+$/i,"pt-PT":/^[A-Z]+$/i,"ru-RU":/^[-]+$/i,"sl-SI":/^[A-Z]+$/i,"sk-SK":/^[A-Z]+$/i,"sr-RS@latin":/^[A-Z]+$/i,"sr-RS":/^[-]+$/i,"sv-SE":/^[A-Z]+$/i,"th-TH":/^[-\s]+$/i,"tr-TR":/^[A-Z]+$/i,"uk-UA":/^[-I]+$/i,"vi-VN":/^[A-Z]+$/i,"ku-IQ":/^[]+$/i,ar:/^[]+$/,he:/^[-]+$/,fa:/^['']+$/i,"hi-IN":/^[\u0900-\u0961]+[\u0972-\u097F]*$/i};or.alpha=Mn;var Tn={"en-US":/^[0-9A-Z]+$/i,"az-AZ":/^[0-9A-VXYZ]+$/i,"bg-BG":/^[0-9-]+$/i,"cs-CZ":/^[0-9A-Z]+$/i,"da-DK":/^[0-9A-Z]+$/i,"de-DE":/^[0-9A-Z]+$/i,"el-GR":/^[0-9-]+$/i,"es-ES":/^[0-9A-Z]+$/i,"fi-FI":/^[0-9A-Z]+$/i,"fr-FR":/^[0-9A-Z]+$/i,"it-IT":/^[0-9A-Z]+$/i,"hu-HU":/^[0-9A-Z]+$/i,"nb-NO":/^[0-9A-Z]+$/i,"nl-NL":/^[0-9A-Z]+$/i,"nn-NO":/^[0-9A-Z]+$/i,"pl-PL":/^[0-9A-Z]+$/i,"pt-PT":/^[0-9A-Z]+$/i,"ru-RU":/^[0-9-]+$/i,"sl-SI":/^[0-9A-Z]+$/i,"sk-SK":/^[0-9A-Z]+$/i,"sr-RS@latin":/^[0-9A-Z]+$/i,"sr-RS":/^[0-9-]+$/i,"sv-SE":/^[0-9A-Z]+$/i,"th-TH":/^[-\s]+$/i,"tr-TR":/^[0-9A-Z]+$/i,"uk-UA":/^[0-9-I]+$/i,"ku-IQ":/^[0-9]+$/i,"vi-VN":/^[0-9A-Z]+$/i,ar:/^[0-9]+$/,he:/^[0-9-]+$/,fa:/^['0-9']+$/i,"hi-IN":/^[\u0900-\u0963]+[\u0966-\u097F]*$/i};or.alphanumeric=Tn;var on={"en-US":".",ar:"\u066B"};or.decimal=on;var KC=["AU","GB","HK","IN","NZ","ZA","ZM"];or.englishLocales=KC;for(S_=0;S_<KC.length;S_++)rd="en-".concat(KC[S_]),Mn[rd]=Mn["en-US"],Tn[rd]=Tn["en-US"],on[rd]=on["en-US"];var rd,S_,QC=["AE","BH","DZ","EG","IQ","JO","KW","LB","LY","MA","QM","QA","SA","SD","SY","TN","YE"];or.arabicLocales=QC;for(C_=0;C_<QC.length;C_++)nd="ar-".concat(QC[C_]),Mn[nd]=Mn.ar,Tn[nd]=Tn.ar,on[nd]=on.ar;var nd,C_,JC=["IR","AF"];or.farsiLocales=JC;for(M_=0;M_<JC.length;M_++)E_="fa-".concat(JC[M_]),Tn[E_]=Tn.fa,on[E_]=on.ar;var E_,M_,$C=["ar-EG","ar-LB","ar-LY"];or.dotDecimal=$C;var eE=["bg-BG","cs-CZ","da-DK","de-DE","el-GR","en-ZM","es-ES","fr-CA","fr-FR","id-ID","it-IT","ku-IQ","hi-IN","hu-HU","nb-NO","nn-NO","nl-NL","pl-PL","pt-PT","ru-RU","sl-SI","sr-RS@latin","sr-RS","sv-SE","tr-TR","uk-UA","vi-VN"];or.commaDecimal=eE;for(T_=0;T_<$C.length;T_++)on[$C[T_]]=on["en-US"];var T_;for(A_=0;A_<eE.length;A_++)on[eE[A_]]=",";var A_;Mn["fr-CA"]=Mn["fr-FR"];Tn["fr-CA"]=Tn["fr-FR"];Mn["pt-BR"]=Mn["pt-PT"];Tn["pt-BR"]=Tn["pt-PT"];on["pt-BR"]=on["pt-PT"];Mn["pl-Pl"]=Mn["pl-PL"];Tn["pl-Pl"]=Tn["pl-PL"];on["pl-Pl"]=on["pl-PL"];Mn["fa-AF"]=Mn.fa});var tE=oe(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.default=kie;sd.locales=void 0;var Die=Iie(Me()),w4=vu();function Iie(t){return t&&t.__esModule?t:{default:t}}function kie(t,e){(0,Die.default)(t),e=e||{};var i=new RegExp("^(?:[-+])?(?:[0-9]+)?(?:\\".concat(e.locale?w4.decimal[e.locale]:".","[0-9]*)?(?:[eE][\\+\\-]?(?:[0-9]+))?$"));if(t===""||t==="."||t==="-"||t==="+")return!1;var r=parseFloat(t.replace(",","."));return i.test(t)&&(!e.hasOwnProperty("min")||r>=e.min)&&(!e.hasOwnProperty("max")||r<=e.max)&&(!e.hasOwnProperty("lt")||r<e.lt)&&(!e.hasOwnProperty("gt")||r>e.gt)}var Fie=Object.keys(w4.decimal);sd.locales=Fie});var rE=oe((od,iE)=>{"use strict";Object.defineProperty(od,"__esModule",{value:!0});od.default=Uie;var Bie=Nie(tE());function Nie(t){return t&&t.__esModule?t:{default:t}}function Uie(t){return(0,Bie.default)(t)?parseFloat(t):NaN}iE.exports=od.default;iE.exports.default=od.default});var S4=oe((ad,nE)=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});ad.default=Hie;var zie=Gie(Me());function Gie(t){return t&&t.__esModule?t:{default:t}}function Hie(t,e){return(0,zie.default)(t),parseInt(t,e||10)}nE.exports=ad.default;nE.exports.default=ad.default});var C4=oe((ld,sE)=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});ld.default=jie;var Wie=Vie(Me());function Vie(t){return t&&t.__esModule?t:{default:t}}function jie(t,e){return(0,Wie.default)(t),e?t==="1"||/^true$/i.test(t):t!=="0"&&!/^false$/i.test(t)&&t!==""}sE.exports=ld.default;sE.exports.default=ld.default});var E4=oe((hd,oE)=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.default=Yie;var qie=Xie(Me());function Xie(t){return t&&t.__esModule?t:{default:t}}function Yie(t,e){return(0,qie.default)(t),t===e}oE.exports=hd.default;oE.exports.default=hd.default});var lE=oe((ud,aE)=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});ud.default=Zie;function P_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?P_=function(i){return typeof i}:P_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},P_(t)}function Zie(t){return P_(t)==="object"&&t!==null?typeof t.toString=="function"?t=t.toString():t="[object Object]":(t===null||typeof t=="undefined"||isNaN(t)&&!t.length)&&(t=""),String(t)}aE.exports=ud.default;aE.exports.default=ud.default});var an=oe((cd,hE)=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});cd.default=Kie;function Kie(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;for(var i in e)typeof t[i]=="undefined"&&(t[i]=e[i]);return t}hE.exports=cd.default;hE.exports.default=cd.default});var T4=oe((fd,cE)=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.default=ere;var Qie=uE(Me()),M4=uE(lE()),Jie=uE(an());function uE(t){return t&&t.__esModule?t:{default:t}}var $ie={ignoreCase:!1,minOccurrences:1};function ere(t,e,i){return(0,Qie.default)(t),i=(0,Jie.default)(i,$ie),i.ignoreCase?t.toLowerCase().split((0,M4.default)(e).toLowerCase()).length>i.minOccurrences:t.split((0,M4.default)(e)).length>i.minOccurrences}cE.exports=fd.default;cE.exports.default=fd.default});var A4=oe((dd,fE)=>{"use strict";Object.defineProperty(dd,"__esModule",{value:!0});dd.default=rre;var tre=ire(Me());function ire(t){return t&&t.__esModule?t:{default:t}}function rre(t,e,i){return(0,tre.default)(t),Object.prototype.toString.call(e)!=="[object RegExp]"&&(e=new RegExp(e,i)),e.test(t)}fE.exports=dd.default;fE.exports.default=dd.default});var pE=oe((pd,dE)=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});pd.default=ore;var nre=sre(Me());function sre(t){return t&&t.__esModule?t:{default:t}}function R_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?R_=function(i){return typeof i}:R_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},R_(t)}function ore(t,e){(0,nre.default)(t);var i,r;R_(e)==="object"?(i=e.min||0,r=e.max):(i=arguments[1],r=arguments[2]);var n=encodeURI(t).split(/%..|./).length-1;return n>=i&&(typeof r=="undefined"||n<=r)}dE.exports=pd.default;dE.exports.default=pd.default});var L_=oe((md,mE)=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.default=ure;var are=P4(Me()),lre=P4(an());function P4(t){return t&&t.__esModule?t:{default:t}}var hre={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1};function ure(t,e){(0,are.default)(t),e=(0,lre.default)(e,hre),e.allow_trailing_dot&&t[t.length-1]==="."&&(t=t.substring(0,t.length-1)),e.allow_wildcard===!0&&t.indexOf("*.")===0&&(t=t.substring(2));var i=t.split("."),r=i[i.length-1];return e.require_tld&&(i.length<2||!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(r)||/\s/.test(r))||!e.allow_numeric_tld&&/^\d+$/.test(r)?!1:i.every(function(n){return!(n.length>63||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(n)||/[\uff01-\uff5e]/.test(n)||/^-|-$/.test(n)||!e.allow_underscores&&/_/.test(n))})}mE.exports=md.default;mE.exports.default=md.default});var vd=oe((gd,vE)=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.default=gE;var cre=fre(Me());function fre(t){return t&&t.__esModule?t:{default:t}}var R4="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",Ra="(".concat(R4,"[.]){3}").concat(R4),dre=new RegExp("^".concat(Ra,"$")),Hi="(?:[0-9a-fA-F]{1,4})",pre=new RegExp("^("+"(?:".concat(Hi,":){7}(?:").concat(Hi,"|:)|")+"(?:".concat(Hi,":){6}(?:").concat(Ra,"|:").concat(Hi,"|:)|")+"(?:".concat(Hi,":){5}(?::").concat(Ra,"|(:").concat(Hi,"){1,2}|:)|")+"(?:".concat(Hi,":){4}(?:(:").concat(Hi,"){0,1}:").concat(Ra,"|(:").concat(Hi,"){1,3}|:)|")+"(?:".concat(Hi,":){3}(?:(:").concat(Hi,"){0,2}:").concat(Ra,"|(:").concat(Hi,"){1,4}|:)|")+"(?:".concat(Hi,":){2}(?:(:").concat(Hi,"){0,3}:").concat(Ra,"|(:").concat(Hi,"){1,5}|:)|")+"(?:".concat(Hi,":){1}(?:(:").concat(Hi,"){0,4}:").concat(Ra,"|(:").concat(Hi,"){1,6}|:)|")+"(?::((?::".concat(Hi,"){0,5}:").concat(Ra,"|(?::").concat(Hi,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");function gE(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,cre.default)(t),e=String(e),!e)return gE(t,4)||gE(t,6);if(e==="4"){if(!dre.test(t))return!1;var i=t.split(".").sort(function(r,n){return r-n});return i[3]<=255}return e==="6"?!!pre.test(t):!1}vE.exports=gd.default;vE.exports.default=gd.default});var O4=oe((yd,yE)=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});yd.default=Tre;var mre=_d(Me()),gre=_d(an()),_E=_d(pE()),vre=_d(L_()),L4=_d(vd());function _d(t){return t&&t.__esModule?t:{default:t}}var _re={allow_display_name:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[]},yre=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,xre=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,bre=/^[a-z\d]+$/,wre=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,Sre=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,Cre=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,Ere=254;function Mre(t){var e=t.replace(/^"(.+)"$/,"$1");if(!e.trim())return!1;var i=/[\.";<>]/.test(e);if(i){if(e===t)return!1;var r=e.split('"').length===e.split('\\"').length;if(!r)return!1}return!0}function Tre(t,e){if((0,mre.default)(t),e=(0,gre.default)(e,_re),e.require_display_name||e.allow_display_name){var i=t.match(yre);if(i){var r=i[1];if(t=t.replace(r,"").replace(/(^<|>$)/g,""),r.endsWith(" ")&&(r=r.substr(0,r.length-1)),!Mre(r))return!1}else if(e.require_display_name)return!1}if(!e.ignore_max_length&&t.length>Ere)return!1;var n=t.split("@"),o=n.pop(),a=o.toLowerCase();if(e.host_blacklist.includes(a))return!1;var l=n.join("@");if(e.domain_specific_validation&&(a==="gmail.com"||a==="googlemail.com")){l=l.toLowerCase();var h=l.split("+")[0];if(!(0,_E.default)(h.replace(/\./g,""),{min:6,max:30}))return!1;for(var u=h.split("."),c=0;c<u.length;c++)if(!bre.test(u[c]))return!1}if(e.ignore_max_length===!1&&(!(0,_E.default)(l,{max:64})||!(0,_E.default)(o,{max:254})))return!1;if(!(0,vre.default)(o,{require_tld:e.require_tld})){if(!e.allow_ip_domain)return!1;if(!(0,L4.default)(o)){if(!o.startsWith("[")||!o.endsWith("]"))return!1;var f=o.substr(1,o.length-2);if(f.length===0||!(0,L4.default)(f))return!1}}if(l[0]==='"')return l=l.slice(1,l.length-1),e.allow_utf8_local_part?Cre.test(l):wre.test(l);for(var d=e.allow_utf8_local_part?Sre:xre,m=l.split("."),p=0;p<m.length;p++)if(!d.test(m[p]))return!1;return!(e.blacklisted_chars&&l.search(new RegExp("[".concat(e.blacklisted_chars,"]+"),"g"))!==-1)}yE.exports=yd.default;yE.exports.default=yd.default});var F4=oe((xd,xE)=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});xd.default=Ure;var Are=O_(Me()),Pre=O_(L_()),D4=O_(vd()),Rre=O_(an());function O_(t){return t&&t.__esModule?t:{default:t}}function Lre(t,e){return kre(t)||Ire(t,e)||Dre(t,e)||Ore()}function Ore(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dre(t,e){if(t){if(typeof t=="string")return I4(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return I4(t,e)}}function I4(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Ire(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var i=[],r=!0,n=!1,o=void 0;try{for(var a=t[Symbol.iterator](),l;!(r=(l=a.next()).done)&&(i.push(l.value),!(e&&i.length===e));r=!0);}catch(h){n=!0,o=h}finally{try{!r&&a.return!=null&&a.return()}finally{if(n)throw o}}return i}}function kre(t){if(Array.isArray(t))return t}var Fre={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},Bre=/^\[([^\]]+)\](?::([0-9]+))?$/;function Nre(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function k4(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(t===r||Nre(r)&&r.test(t))return!0}return!1}function Ure(t,e){if((0,Are.default)(t),!t||/[\s<>]/.test(t)||t.indexOf("mailto:")===0||(e=(0,Rre.default)(e,Fre),e.validate_length&&t.length>=2083)||!e.allow_fragments&&t.includes("#")||!e.allow_query_components&&(t.includes("?")||t.includes("&")))return!1;var i,r,n,o,a,l,h,u;if(h=t.split("#"),t=h.shift(),h=t.split("?"),t=h.shift(),h=t.split("://"),h.length>1){if(i=h.shift().toLowerCase(),e.require_valid_protocol&&e.protocols.indexOf(i)===-1)return!1}else{if(e.require_protocol)return!1;if(t.substr(0,2)==="//"){if(!e.allow_protocol_relative_urls)return!1;h[0]=t.substr(2)}}if(t=h.join("://"),t==="")return!1;if(h=t.split("/"),t=h.shift(),t===""&&!e.require_host)return!0;if(h=t.split("@"),h.length>1){if(e.disallow_auth||h[0]===""||(r=h.shift(),r.indexOf(":")>=0&&r.split(":").length>2))return!1;var c=r.split(":"),f=Lre(c,2),d=f[0],m=f[1];if(d===""&&m==="")return!1}o=h.join("@"),l=null,u=null;var p=o.match(Bre);if(p?(n="",u=p[1],l=p[2]||null):(h=o.split(":"),n=h.shift(),h.length&&(l=h.join(":"))),l!==null&&l.length>0){if(a=parseInt(l,10),!/^[0-9]+$/.test(l)||a<=0||a>65535)return!1}else if(e.require_port)return!1;return e.host_whitelist?k4(n,e.host_whitelist):!(!(0,D4.default)(n)&&!(0,Pre.default)(n,e)&&(!u||!(0,D4.default)(u,6))||(n=n||u,e.host_blacklist&&k4(n,e.host_blacklist)))}xE.exports=xd.default;xE.exports.default=xd.default});var B4=oe((bd,bE)=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});bd.default=jre;var zre=Gre(Me());function Gre(t){return t&&t.__esModule?t:{default:t}}var Hre=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){4}([0-9a-fA-F]{2})$/,Wre=/^([0-9a-fA-F]){12}$/,Vre=/^([0-9a-fA-F]{4}\.){2}([0-9a-fA-F]{4})$/;function jre(t,e){return(0,zre.default)(t),e&&(e.no_colons||e.no_separators)?Wre.test(t):Hre.test(t)||Vre.test(t)}bE.exports=bd.default;bE.exports.default=bd.default});var H4=oe((wd,wE)=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});wd.default=Yre;var qre=G4(Me()),N4=G4(vd());function G4(t){return t&&t.__esModule?t:{default:t}}var Xre=/^\d{1,3}$/,U4=32,z4=128;function Yre(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";(0,qre.default)(t);var i=t.split("/");if(i.length!==2||!Xre.test(i[1])||i[1].length>1&&i[1].startsWith("0"))return!1;var r=(0,N4.default)(i[0],e);if(!r)return!1;var n=null;switch(String(e)){case"4":n=U4;break;case"6":n=z4;break;default:n=(0,N4.default)(i[0],"6")?z4:U4}return i[1]<=n&&i[1]>=0}wE.exports=wd.default;wE.exports.default=wd.default});var CE=oe((Sd,SE)=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});Sd.default=rne;var W4=Zre(an());function Zre(t){return t&&t.__esModule?t:{default:t}}function Kre(t,e){return $re(t)||Jre(t,e)||q4(t,e)||Qre()}function Qre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jre(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var i=[],r=!0,n=!1,o=void 0;try{for(var a=t[Symbol.iterator](),l;!(r=(l=a.next()).done)&&(i.push(l.value),!(e&&i.length===e));r=!0);}catch(h){n=!0,o=h}finally{try{!r&&a.return!=null&&a.return()}finally{if(n)throw o}}return i}}function $re(t){if(Array.isArray(t))return t}function ene(t,e){var i;if(typeof Symbol=="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(i=q4(t))||e&&t&&typeof t.length=="number"){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){i=t[Symbol.iterator]()},n:function(){var u=i.next();return o=u.done,u},e:function(u){a=!0,l=u},f:function(){try{!o&&i.return!=null&&i.return()}finally{if(a)throw l}}}}function q4(t,e){if(t){if(typeof t=="string")return V4(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return V4(t,e)}}function V4(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var j4={format:"YYYY/MM/DD",delimiters:["/","-"],strictMode:!1};function tne(t){return/(^(y{4}|y{2})[.\/-](m{1,2})[.\/-](d{1,2})$)|(^(m{1,2})[.\/-](d{1,2})[.\/-]((y{4}|y{2})$))|(^(d{1,2})[.\/-](m{1,2})[.\/-]((y{4}|y{2})$))/gi.test(t)}function ine(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i.push([t[n],e[n]]);return i}function rne(t,e){if(typeof e=="string"?e=(0,W4.default)({format:e},j4):e=(0,W4.default)(e,j4),typeof t=="string"&&tne(e.format)){var i=e.delimiters.find(function(f){return e.format.indexOf(f)!==-1}),r=e.strictMode?i:e.delimiters.find(function(f){return t.indexOf(f)!==-1}),n=ine(t.split(r),e.format.toLowerCase().split(i)),o={},a=ene(n),l;try{for(a.s();!(l=a.n()).done;){var h=Kre(l.value,2),u=h[0],c=h[1];if(u.length!==c.length)return!1;o[c.charAt(0)]=u}}catch(f){a.e(f)}finally{a.f()}return new Date("".concat(o.m,"/").concat(o.d,"/").concat(o.y)).getDate()===+o.d}return e.strictMode?!1:Object.prototype.toString.call(t)==="[object Date]"&&isFinite(t)}SE.exports=Sd.default;SE.exports.default=Sd.default});var Y4=oe((Cd,EE)=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});Cd.default=lne;var nne=sne(Me());function sne(t){return t&&t.__esModule?t:{default:t}}var one={loose:!1},X4=["true","false","1","0"],ane=[].concat(X4,["yes","no"]);function lne(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:one;return(0,nne.default)(t),e.loose?ane.includes(t.toLowerCase()):X4.includes(t)}EE.exports=Cd.default;EE.exports.default=Cd.default});var Z4=oe((Ed,ME)=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.default=fne;var hne=une(Me());function une(t){return t&&t.__esModule?t:{default:t}}var cne=/^[A-Za-z]{2,4}([_-]([A-Za-z]{4}|[\d]{3}))?([_-]([A-Za-z]{2}|[\d]{3}))?$/;function fne(t){return(0,hne.default)(t),t==="en_US_POSIX"||t==="ca_ES_VALENCIA"?!0:cne.test(t)}ME.exports=Ed.default;ME.exports.default=Ed.default});var K4=oe(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});Md.default=mne;Md.locales=void 0;var dne=pne(Me()),TE=vu();function pne(t){return t&&t.__esModule?t:{default:t}}function mne(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,dne.default)(t);var r=t,n=i.ignore;if(n)if(n instanceof RegExp)r=r.replace(n,"");else if(typeof n=="string")r=r.replace(new RegExp("[".concat(n.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in TE.alpha)return TE.alpha[e].test(r);throw new Error("Invalid locale '".concat(e,"'"))}var gne=Object.keys(TE.alpha);Md.locales=gne});var Q4=oe(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.default=yne;Td.locales=void 0;var vne=_ne(Me()),AE=vu();function _ne(t){return t&&t.__esModule?t:{default:t}}function yne(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,vne.default)(t);var r=t,n=i.ignore;if(n)if(n instanceof RegExp)r=r.replace(n,"");else if(typeof n=="string")r=r.replace(new RegExp("[".concat(n.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in AE.alphanumeric)return AE.alphanumeric[e].test(r);throw new Error("Invalid locale '".concat(e,"'"))}var xne=Object.keys(AE.alphanumeric);Td.locales=xne});var J4=oe((Ad,PE)=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.default=Ene;var bne=Sne(Me()),wne=vu();function Sne(t){return t&&t.__esModule?t:{default:t}}var Cne=/^[0-9]+$/;function Ene(t,e){return(0,bne.default)(t),e&&e.no_symbols?Cne.test(t):new RegExp("^[+-]?([0-9]*[".concat((e||{}).locale?wne.decimal[e.locale]:".","])?[0-9]+$")).test(t)}PE.exports=Ad.default;PE.exports.default=Ad.default});var e5=oe((Pd,RE)=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.default=Ane;var Mne=Tne(Me());function Tne(t){return t&&t.__esModule?t:{default:t}}var $4={AM:/^[A-Z]{2}\d{7}$/,AR:/^[A-Z]{3}\d{6}$/,AT:/^[A-Z]\d{7}$/,AU:/^[A-Z]\d{7}$/,BE:/^[A-Z]{2}\d{6}$/,BG:/^\d{9}$/,BR:/^[A-Z]{2}\d{6}$/,BY:/^[A-Z]{2}\d{7}$/,CA:/^[A-Z]{2}\d{6}$/,CH:/^[A-Z]\d{7}$/,CN:/^G\d{8}$|^E(?![IO])[A-Z0-9]\d{7}$/,CY:/^[A-Z](\d{6}|\d{8})$/,CZ:/^\d{8}$/,DE:/^[CFGHJKLMNPRTVWXYZ0-9]{9}$/,DK:/^\d{9}$/,DZ:/^\d{9}$/,EE:/^([A-Z]\d{7}|[A-Z]{2}\d{7})$/,ES:/^[A-Z0-9]{2}([A-Z0-9]?)\d{6}$/,FI:/^[A-Z]{2}\d{7}$/,FR:/^\d{2}[A-Z]{2}\d{5}$/,GB:/^\d{9}$/,GR:/^[A-Z]{2}\d{7}$/,HR:/^\d{9}$/,HU:/^[A-Z]{2}(\d{6}|\d{7})$/,IE:/^[A-Z0-9]{2}\d{7}$/,IN:/^[A-Z]{1}-?\d{7}$/,ID:/^[A-C]\d{7}$/,IR:/^[A-Z]\d{8}$/,IS:/^(A)\d{7}$/,IT:/^[A-Z0-9]{2}\d{7}$/,JP:/^[A-Z]{2}\d{7}$/,KR:/^[MS]\d{8}$/,LT:/^[A-Z0-9]{8}$/,LU:/^[A-Z0-9]{8}$/,LV:/^[A-Z0-9]{2}\d{7}$/,LY:/^[A-Z0-9]{8}$/,MT:/^\d{7}$/,MZ:/^([A-Z]{2}\d{7})|(\d{2}[A-Z]{2}\d{5})$/,MY:/^[AHK]\d{8}$/,NL:/^[A-Z]{2}[A-Z0-9]{6}\d$/,PL:/^[A-Z]{2}\d{7}$/,PT:/^[A-Z]\d{6}$/,RO:/^\d{8,9}$/,RU:/^\d{9}$/,SE:/^\d{8}$/,SL:/^(P)[A-Z]\d{7}$/,SK:/^[0-9A-Z]\d{7}$/,TR:/^[A-Z]\d{8}$/,UA:/^[A-Z]{2}\d{6}$/,US:/^\d{9}$/};function Ane(t,e){(0,Mne.default)(t);var i=t.replace(/\s/g,"").toUpperCase();return e.toUpperCase()in $4&&$4[e].test(i)}RE.exports=Pd.default;RE.exports.default=Pd.default});var D_=oe((Rd,LE)=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.default=Dne;var Pne=Rne(Me());function Rne(t){return t&&t.__esModule?t:{default:t}}var Lne=/^(?:[-+]?(?:0|[1-9][0-9]*))$/,One=/^[-+]?[0-9]+$/;function Dne(t,e){(0,Pne.default)(t),e=e||{};var i=e.hasOwnProperty("allow_leading_zeroes")&&!e.allow_leading_zeroes?Lne:One,r=!e.hasOwnProperty("min")||t>=e.min,n=!e.hasOwnProperty("max")||t<=e.max,o=!e.hasOwnProperty("lt")||t<e.lt,a=!e.hasOwnProperty("gt")||t>e.gt;return i.test(t)&&r&&n&&o&&a}LE.exports=Rd.default;LE.exports.default=Rd.default});var t5=oe((Ld,OE)=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.default=Fne;var Ine=kne(D_());function kne(t){return t&&t.__esModule?t:{default:t}}function Fne(t){return(0,Ine.default)(t,{min:0,max:65535})}OE.exports=Ld.default;OE.exports.default=Ld.default});var i5=oe((Od,DE)=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});Od.default=Une;var Bne=Nne(Me());function Nne(t){return t&&t.__esModule?t:{default:t}}function Une(t){return(0,Bne.default)(t),t===t.toLowerCase()}DE.exports=Od.default;DE.exports.default=Od.default});var r5=oe((Dd,IE)=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.default=Hne;var zne=Gne(Me());function Gne(t){return t&&t.__esModule?t:{default:t}}function Hne(t){return(0,zne.default)(t),t===t.toUpperCase()}IE.exports=Dd.default;IE.exports.default=Dd.default});var n5=oe((Id,kE)=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});Id.default=Xne;var Wne=Vne(Me());function Vne(t){return t&&t.__esModule?t:{default:t}}var jne=/^[0-9]{15}$/,qne=/^\d{2}-\d{6}-\d{6}-\d{1}$/;function Xne(t,e){(0,Wne.default)(t),e=e||{};var i=jne;if(e.allow_hyphens&&(i=qne),!i.test(t))return!1;t=t.replace(/-/g,"");for(var r=0,n=2,o=14,a=0;a<o;a++){var l=t.substring(o-a-1,o-a),h=parseInt(l,10)*n;h>=10?r+=h%10+1:r+=h,n===1?n+=1:n-=1}var u=(10-r%10)%10;return u===parseInt(t.substring(14,15),10)}kE.exports=Id.default;kE.exports.default=Id.default});var s5=oe((kd,FE)=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});kd.default=Qne;var Yne=Zne(Me());function Zne(t){return t&&t.__esModule?t:{default:t}}var Kne=/^[\x00-\x7F]+$/;function Qne(t){return(0,Yne.default)(t),Kne.test(t)}FE.exports=kd.default;FE.exports.default=kd.default});var BE=oe(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});Fd.default=ese;Fd.fullWidth=void 0;var Jne=$ne(Me());function $ne(t){return t&&t.__esModule?t:{default:t}}var o5=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;Fd.fullWidth=o5;function ese(t){return(0,Jne.default)(t),o5.test(t)}});var NE=oe(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});Bd.default=rse;Bd.halfWidth=void 0;var tse=ise(Me());function ise(t){return t&&t.__esModule?t:{default:t}}var a5=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;Bd.halfWidth=a5;function rse(t){return(0,tse.default)(t),a5.test(t)}});var l5=oe((Nd,UE)=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});Nd.default=lse;var nse=ase(Me()),sse=BE(),ose=NE();function ase(t){return t&&t.__esModule?t:{default:t}}function lse(t){return(0,nse.default)(t),sse.fullWidth.test(t)&&ose.halfWidth.test(t)}UE.exports=Nd.default;UE.exports.default=Nd.default});var h5=oe((Ud,zE)=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.default=fse;var hse=use(Me());function use(t){return t&&t.__esModule?t:{default:t}}var cse=/[^\x00-\x7F]/;function fse(t){return(0,hse.default)(t),cse.test(t)}zE.exports=Ud.default;zE.exports.default=Ud.default});var u5=oe((zd,GE)=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.default=dse;function dse(t,e){var i=t.join("");return new RegExp(i,e)}GE.exports=zd.default;GE.exports.default=zd.default});var f5=oe((Gd,HE)=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});Gd.default=vse;var pse=c5(Me()),mse=c5(u5());function c5(t){return t&&t.__esModule?t:{default:t}}var gse=(0,mse.default)(["^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)","(?:-((?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*))","?(?:\\+([0-9a-z-]+(?:\\.[0-9a-z-]+)*))?$"],"i");function vse(t){return(0,pse.default)(t),gse.test(t)}HE.exports=Gd.default;HE.exports.default=Gd.default});var d5=oe((Hd,WE)=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.default=bse;var _se=yse(Me());function yse(t){return t&&t.__esModule?t:{default:t}}var xse=/[\uD800-\uDBFF][\uDC00-\uDFFF]/;function bse(t){return(0,_se.default)(t),xse.test(t)}WE.exports=Hd.default;WE.exports.default=Hd.default});var p5=oe((_u,VE)=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.default=void 0;var wse=function(e,i){return e.some(function(r){return i===r})},Sse=wse;_u.default=Sse;VE.exports=_u.default;VE.exports.default=_u.default});var g5=oe((Wd,qE)=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.default=Rse;var Cse=jE(an()),Ese=jE(Me()),Mse=jE(p5()),m5=vu();function jE(t){return t&&t.__esModule?t:{default:t}}function Tse(t){var e=new RegExp("^[-+]?([0-9]+)?(\\".concat(m5.decimal[t.locale],"[0-9]{").concat(t.decimal_digits,"})").concat(t.force_decimal?"":"?","$"));return e}var Ase={force_decimal:!1,decimal_digits:"1,",locale:"en-US"},Pse=["","-","+"];function Rse(t,e){if((0,Ese.default)(t),e=(0,Cse.default)(e,Ase),e.locale in m5.decimal)return!(0,Mse.default)(Pse,t.replace(/ /g,""))&&Tse(e).test(t);throw new Error("Invalid locale '".concat(e.locale,"'"))}qE.exports=Wd.default;qE.exports.default=Wd.default});var YE=oe((Vd,XE)=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.default=Ise;var Lse=Ose(Me());function Ose(t){return t&&t.__esModule?t:{default:t}}var Dse=/^(0x|0h)?[0-9A-F]+$/i;function Ise(t){return(0,Lse.default)(t),Dse.test(t)}XE.exports=Vd.default;XE.exports.default=Vd.default});var v5=oe((jd,ZE)=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.default=Nse;var kse=Fse(Me());function Fse(t){return t&&t.__esModule?t:{default:t}}var Bse=/^(0o)?[0-7]+$/i;function Nse(t){return(0,kse.default)(t),Bse.test(t)}ZE.exports=jd.default;ZE.exports.default=jd.default});var y5=oe((qd,KE)=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.default=Gse;var Use=_5(Me()),zse=_5(rE());function _5(t){return t&&t.__esModule?t:{default:t}}function Gse(t,e){return(0,Use.default)(t),(0,zse.default)(t)%parseInt(e,10)===0}KE.exports=qd.default;KE.exports.default=qd.default});var x5=oe((Xd,QE)=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});Xd.default=jse;var Hse=Wse(Me());function Wse(t){return t&&t.__esModule?t:{default:t}}var Vse=/^#?([0-9A-F]{3}|[0-9A-F]{4}|[0-9A-F]{6}|[0-9A-F]{8})$/i;function jse(t){return(0,Hse.default)(t),Vse.test(t)}QE.exports=Xd.default;QE.exports.default=Xd.default});var S5=oe((Yd,JE)=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});Yd.default=Kse;var qse=Xse(Me());function Xse(t){return t&&t.__esModule?t:{default:t}}var b5=/^rgb\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){2}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\)$/,w5=/^rgba\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)$/,Yse=/^rgb\((([0-9]%|[1-9][0-9]%|100%),){2}([0-9]%|[1-9][0-9]%|100%)\)/,Zse=/^rgba\((([0-9]%|[1-9][0-9]%|100%),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)/;function Kse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(0,qse.default)(t),e?b5.test(t)||w5.test(t)||Yse.test(t)||Zse.test(t):b5.test(t)||w5.test(t)}JE.exports=Yd.default;JE.exports.default=Yd.default});var C5=oe((Zd,$E)=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});Zd.default=toe;var Qse=Jse(Me());function Jse(t){return t&&t.__esModule?t:{default:t}}var $se=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(,(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}(,((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?))?\)$/i,eoe=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(\s(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}\s?(\/\s((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?)\s?)?\)$/i;function toe(t){(0,Qse.default)(t);var e=t.replace(/\s+/g," ").replace(/\s?(hsla?\(|\)|,)\s?/ig,"$1");return e.indexOf(",")!==-1?$se.test(e):eoe.test(e)}$E.exports=Zd.default;$E.exports.default=Zd.default});var E5=oe((Kd,eM)=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});Kd.default=soe;var ioe=roe(Me());function roe(t){return t&&t.__esModule?t:{default:t}}var noe=/^[A-Z]{2}[0-9A-Z]{3}\d{2}\d{5}$/;function soe(t){return(0,ioe.default)(t),noe.test(t)}eM.exports=Kd.default;eM.exports.default=Kd.default});var M5=oe(Qd=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});Qd.default=uoe;Qd.locales=void 0;var ooe=aoe(Me());function aoe(t){return t&&t.__esModule?t:{default:t}}var tM={AD:/^(AD[0-9]{2})\d{8}[A-Z0-9]{12}$/,AE:/^(AE[0-9]{2})\d{3}\d{16}$/,AL:/^(AL[0-9]{2})\d{8}[A-Z0-9]{16}$/,AT:/^(AT[0-9]{2})\d{16}$/,AZ:/^(AZ[0-9]{2})[A-Z0-9]{4}\d{20}$/,BA:/^(BA[0-9]{2})\d{16}$/,BE:/^(BE[0-9]{2})\d{12}$/,BG:/^(BG[0-9]{2})[A-Z]{4}\d{6}[A-Z0-9]{8}$/,BH:/^(BH[0-9]{2})[A-Z]{4}[A-Z0-9]{14}$/,BR:/^(BR[0-9]{2})\d{23}[A-Z]{1}[A-Z0-9]{1}$/,BY:/^(BY[0-9]{2})[A-Z0-9]{4}\d{20}$/,CH:/^(CH[0-9]{2})\d{5}[A-Z0-9]{12}$/,CR:/^(CR[0-9]{2})\d{18}$/,CY:/^(CY[0-9]{2})\d{8}[A-Z0-9]{16}$/,CZ:/^(CZ[0-9]{2})\d{20}$/,DE:/^(DE[0-9]{2})\d{18}$/,DK:/^(DK[0-9]{2})\d{14}$/,DO:/^(DO[0-9]{2})[A-Z]{4}\d{20}$/,EE:/^(EE[0-9]{2})\d{16}$/,EG:/^(EG[0-9]{2})\d{25}$/,ES:/^(ES[0-9]{2})\d{20}$/,FI:/^(FI[0-9]{2})\d{14}$/,FO:/^(FO[0-9]{2})\d{14}$/,FR:/^(FR[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,GB:/^(GB[0-9]{2})[A-Z]{4}\d{14}$/,GE:/^(GE[0-9]{2})[A-Z0-9]{2}\d{16}$/,GI:/^(GI[0-9]{2})[A-Z]{4}[A-Z0-9]{15}$/,GL:/^(GL[0-9]{2})\d{14}$/,GR:/^(GR[0-9]{2})\d{7}[A-Z0-9]{16}$/,GT:/^(GT[0-9]{2})[A-Z0-9]{4}[A-Z0-9]{20}$/,HR:/^(HR[0-9]{2})\d{17}$/,HU:/^(HU[0-9]{2})\d{24}$/,IE:/^(IE[0-9]{2})[A-Z0-9]{4}\d{14}$/,IL:/^(IL[0-9]{2})\d{19}$/,IQ:/^(IQ[0-9]{2})[A-Z]{4}\d{15}$/,IR:/^(IR[0-9]{2})0\d{2}0\d{18}$/,IS:/^(IS[0-9]{2})\d{22}$/,IT:/^(IT[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,JO:/^(JO[0-9]{2})[A-Z]{4}\d{22}$/,KW:/^(KW[0-9]{2})[A-Z]{4}[A-Z0-9]{22}$/,KZ:/^(KZ[0-9]{2})\d{3}[A-Z0-9]{13}$/,LB:/^(LB[0-9]{2})\d{4}[A-Z0-9]{20}$/,LC:/^(LC[0-9]{2})[A-Z]{4}[A-Z0-9]{24}$/,LI:/^(LI[0-9]{2})\d{5}[A-Z0-9]{12}$/,LT:/^(LT[0-9]{2})\d{16}$/,LU:/^(LU[0-9]{2})\d{3}[A-Z0-9]{13}$/,LV:/^(LV[0-9]{2})[A-Z]{4}[A-Z0-9]{13}$/,MC:/^(MC[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,MD:/^(MD[0-9]{2})[A-Z0-9]{20}$/,ME:/^(ME[0-9]{2})\d{18}$/,MK:/^(MK[0-9]{2})\d{3}[A-Z0-9]{10}\d{2}$/,MR:/^(MR[0-9]{2})\d{23}$/,MT:/^(MT[0-9]{2})[A-Z]{4}\d{5}[A-Z0-9]{18}$/,MU:/^(MU[0-9]{2})[A-Z]{4}\d{19}[A-Z]{3}$/,MZ:/^(MZ[0-9]{2})\d{21}$/,NL:/^(NL[0-9]{2})[A-Z]{4}\d{10}$/,NO:/^(NO[0-9]{2})\d{11}$/,PK:/^(PK[0-9]{2})[A-Z0-9]{4}\d{16}$/,PL:/^(PL[0-9]{2})\d{24}$/,PS:/^(PS[0-9]{2})[A-Z0-9]{4}\d{21}$/,PT:/^(PT[0-9]{2})\d{21}$/,QA:/^(QA[0-9]{2})[A-Z]{4}[A-Z0-9]{21}$/,RO:/^(RO[0-9]{2})[A-Z]{4}[A-Z0-9]{16}$/,RS:/^(RS[0-9]{2})\d{18}$/,SA:/^(SA[0-9]{2})\d{2}[A-Z0-9]{18}$/,SC:/^(SC[0-9]{2})[A-Z]{4}\d{20}[A-Z]{3}$/,SE:/^(SE[0-9]{2})\d{20}$/,SI:/^(SI[0-9]{2})\d{15}$/,SK:/^(SK[0-9]{2})\d{20}$/,SM:/^(SM[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,SV:/^(SV[0-9]{2})[A-Z0-9]{4}\d{20}$/,TL:/^(TL[0-9]{2})\d{19}$/,TN:/^(TN[0-9]{2})\d{20}$/,TR:/^(TR[0-9]{2})\d{5}[A-Z0-9]{17}$/,UA:/^(UA[0-9]{2})\d{6}[A-Z0-9]{19}$/,VA:/^(VA[0-9]{2})\d{18}$/,VG:/^(VG[0-9]{2})[A-Z0-9]{4}\d{16}$/,XK:/^(XK[0-9]{2})\d{16}$/};function loe(t){var e=t.replace(/[\s\-]+/gi,"").toUpperCase(),i=e.slice(0,2).toUpperCase();return i in tM&&tM[i].test(e)}function hoe(t){var e=t.replace(/[^A-Z0-9]+/gi,"").toUpperCase(),i=e.slice(4)+e.slice(0,4),r=i.replace(/[A-Z]/g,function(o){return o.charCodeAt(0)-55}),n=r.match(/\d{1,7}/g).reduce(function(o,a){return Number(o+a)%97},"");return n===1}function uoe(t){return(0,ooe.default)(t),loe(t)&&hoe(t)}var coe=Object.keys(tM);Qd.locales=coe});var iM=oe(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.default=poe;Jd.CountryCodes=void 0;var foe=doe(Me());function doe(t){return t&&t.__esModule?t:{default:t}}var T5=new Set(["AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UM","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]);function poe(t){return(0,foe.default)(t),T5.has(t.toUpperCase())}var moe=T5;Jd.CountryCodes=moe});var A5=oe(($d,rM)=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.default=xoe;var goe=_oe(Me()),voe=iM();function _oe(t){return t&&t.__esModule?t:{default:t}}var yoe=/^[A-Za-z]{6}[A-Za-z0-9]{2}([A-Za-z0-9]{3})?$/;function xoe(t){return(0,goe.default)(t),voe.CountryCodes.has(t.slice(4,6).toUpperCase())?yoe.test(t):!1}rM.exports=$d.default;rM.exports.default=$d.default});var P5=oe((ep,nM)=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});ep.default=Coe;var boe=woe(Me());function woe(t){return t&&t.__esModule?t:{default:t}}var Soe=/^[a-f0-9]{32}$/;function Coe(t){return(0,boe.default)(t),Soe.test(t)}nM.exports=ep.default;nM.exports.default=ep.default});var R5=oe((tp,sM)=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.default=Aoe;var Eoe=Moe(Me());function Moe(t){return t&&t.__esModule?t:{default:t}}var Toe={md5:32,md4:32,sha1:40,sha256:64,sha384:96,sha512:128,ripemd128:32,ripemd160:40,tiger128:32,tiger160:40,tiger192:48,crc32:8,crc32b:8};function Aoe(t,e){(0,Eoe.default)(t);var i=new RegExp("^[a-fA-F0-9]{".concat(Toe[e],"}$"));return i.test(t)}sM.exports=tp.default;sM.exports.default=tp.default});var aM=oe((ip,oM)=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.default=Ioe;var Poe=L5(Me()),Roe=L5(an());function L5(t){return t&&t.__esModule?t:{default:t}}var Loe=/[^A-Z0-9+\/=]/i,Ooe=/^[A-Z0-9_\-]*$/i,Doe={urlSafe:!1};function Ioe(t,e){(0,Poe.default)(t),e=(0,Roe.default)(e,Doe);var i=t.length;if(e.urlSafe)return Ooe.test(t);if(i%4!==0||Loe.test(t))return!1;var r=t.indexOf("=");return r===-1||r===i-1||r===i-2&&t[i-1]==="="}oM.exports=ip.default;oM.exports.default=ip.default});var D5=oe((rp,lM)=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.default=Boe;var koe=O5(Me()),Foe=O5(aM());function O5(t){return t&&t.__esModule?t:{default:t}}function Boe(t){(0,koe.default)(t);var e=t.split("."),i=e.length;return i>3||i<2?!1:e.reduce(function(r,n){return r&&(0,Foe.default)(n,{urlSafe:!0})},!0)}lM.exports=rp.default;lM.exports.default=rp.default});var k5=oe((np,hM)=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});np.default=Goe;var Noe=I5(Me()),Uoe=I5(an());function I5(t){return t&&t.__esModule?t:{default:t}}function I_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?I_=function(i){return typeof i}:I_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},I_(t)}var zoe={allow_primitives:!1};function Goe(t,e){(0,Noe.default)(t);try{e=(0,Uoe.default)(e,zoe);var i=[];e.allow_primitives&&(i=[null,!1,!0]);var r=JSON.parse(t);return i.includes(r)||!!r&&I_(r)==="object"}catch(n){}return!1}hM.exports=np.default;hM.exports.default=np.default});var B5=oe((sp,uM)=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});sp.default=joe;var Hoe=F5(Me()),Woe=F5(an());function F5(t){return t&&t.__esModule?t:{default:t}}var Voe={ignore_whitespace:!1};function joe(t,e){return(0,Hoe.default)(t),e=(0,Woe.default)(e,Voe),(e.ignore_whitespace?t.trim().length:t.length)===0}uM.exports=sp.default;uM.exports.default=sp.default});var N5=oe((op,cM)=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.default=Yoe;var qoe=Xoe(Me());function Xoe(t){return t&&t.__esModule?t:{default:t}}function k_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?k_=function(i){return typeof i}:k_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},k_(t)}function Yoe(t,e){(0,qoe.default)(t);var i,r;k_(e)==="object"?(i=e.min||0,r=e.max):(i=arguments[1]||0,r=arguments[2]);var n=t.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],o=t.length-n.length;return o>=i&&(typeof r=="undefined"||o<=r)}cM.exports=op.default;cM.exports.default=op.default});var U5=oe((ap,fM)=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});ap.default=Joe;var Zoe=Koe(Me());function Koe(t){return t&&t.__esModule?t:{default:t}}var Qoe={1:/^[0-9A-F]{8}-[0-9A-F]{4}-1[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,2:/^[0-9A-F]{8}-[0-9A-F]{4}-2[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function Joe(t,e){(0,Zoe.default)(t);var i=Qoe[[void 0,null].includes(e)?"all":e];return!!i&&i.test(t)}fM.exports=ap.default;fM.exports.default=ap.default});var G5=oe((lp,dM)=>{"use strict";Object.defineProperty(lp,"__esModule",{value:!0});lp.default=tae;var $oe=z5(Me()),eae=z5(YE());function z5(t){return t&&t.__esModule?t:{default:t}}function tae(t){return(0,$oe.default)(t),(0,eae.default)(t)&&t.length===24}dM.exports=lp.default;dM.exports.default=lp.default});var V5=oe((hp,pM)=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.default=rae;var iae=W5(Me()),H5=W5(w_());function W5(t){return t&&t.__esModule?t:{default:t}}function rae(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:String(new Date);(0,iae.default)(t);var i=(0,H5.default)(e),r=(0,H5.default)(t);return!!(r&&i&&r>i)}pM.exports=hp.default;pM.exports.default=hp.default});var X5=oe((up,mM)=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.default=sae;var nae=q5(Me()),j5=q5(w_());function q5(t){return t&&t.__esModule?t:{default:t}}function sae(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:String(new Date);(0,nae.default)(t);var i=(0,j5.default)(e),r=(0,j5.default)(t);return!!(r&&i&&r<i)}mM.exports=up.default;mM.exports.default=up.default});var Z5=oe((cp,gM)=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.default=lae;var oae=Y5(Me()),aae=Y5(lE());function Y5(t){return t&&t.__esModule?t:{default:t}}function F_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?F_=function(i){return typeof i}:F_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},F_(t)}function lae(t,e){(0,oae.default)(t);var i;if(Object.prototype.toString.call(e)==="[object Array]"){var r=[];for(i in e)({}).hasOwnProperty.call(e,i)&&(r[i]=(0,aae.default)(e[i]));return r.indexOf(t)>=0}else{if(F_(e)==="object")return e.hasOwnProperty(t);if(e&&typeof e.indexOf=="function")return e.indexOf(t)>=0}return!1}gM.exports=cp.default;gM.exports.default=cp.default});var K5=oe((fp,vM)=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.default=fae;var hae=uae(Me());function uae(t){return t&&t.__esModule?t:{default:t}}var cae=/^(?:4[0-9]{12}(?:[0-9]{3,6})?|5[1-5][0-9]{14}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|6(?:011|5[0-9][0-9])[0-9]{12,15}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11}|6[27][0-9]{14}|^(81[0-9]{14,17}))$/;function fae(t){(0,hae.default)(t);var e=t.replace(/[- ]+/g,"");if(!cae.test(e))return!1;for(var i=0,r,n,o,a=e.length-1;a>=0;a--)r=e.substring(a,a+1),n=parseInt(r,10),o?(n*=2,n>=10?i+=n%10+1:i+=n):i+=n,o=!o;return!!(i%10===0&&e)}vM.exports=fp.default;vM.exports.default=fp.default});var J5=oe((pp,_M)=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.default=pae;var B_=Q5(Me()),dae=Q5(D_());function Q5(t){return t&&t.__esModule?t:{default:t}}var dp={PL:function(e){(0,B_.default)(e);var i={1:1,2:3,3:7,4:9,5:1,6:3,7:7,8:9,9:1,10:3,11:0};if(e!=null&&e.length===11&&(0,dae.default)(e,{allow_leading_zeroes:!0})){var r=e.split("").slice(0,-1),n=r.reduce(function(l,h,u){return l+Number(h)*i[u+1]},0),o=n%10,a=Number(e.charAt(e.length-1));if(o===0&&a===0||a===10-o)return!0}return!1},ES:function(e){(0,B_.default)(e);var i=/^[0-9X-Z][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$/,r={X:0,Y:1,Z:2},n=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"],o=e.trim().toUpperCase();if(!i.test(o))return!1;var a=o.slice(0,-1).replace(/[X,Y,Z]/g,function(l){return r[l]});return o.endsWith(n[a%23])},FI:function(e){if((0,B_.default)(e),e.length!==11||!e.match(/^\d{6}[\-A\+]\d{3}[0-9ABCDEFHJKLMNPRSTUVWXY]{1}$/))return!1;var i="0123456789ABCDEFHJKLMNPRSTUVWXY",r=parseInt(e.slice(0,6),10)*1e3+parseInt(e.slice(7,10),10),n=r%31,o=i[n];return o===e.slice(10,11)},IN:function(e){var i=/^[1-9]\d{3}\s?\d{4}\s?\d{4}$/,r=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],n=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],o=e.trim();if(!i.test(o))return!1;var a=0,l=o.replace(/\s/g,"").split("").map(Number).reverse();return l.forEach(function(h,u){a=r[a][n[u%8][h]]}),a===0},IR:function(e){if(!e.match(/^\d{10}$/)||(e="0000".concat(e).substr(e.length-6),parseInt(e.substr(3,6),10)===0))return!1;for(var i=parseInt(e.substr(9,1),10),r=0,n=0;n<9;n++)r+=parseInt(e.substr(n,1),10)*(10-n);return r%=11,r<2&&i===r||r>=2&&i===11-r},IT:function(e){return e.length!==9||e==="CA00000AA"?!1:e.search(/C[A-Z][0-9]{5}[A-Z]{2}/i)>-1},NO:function(e){var i=e.trim();if(isNaN(Number(i))||i.length!==11||i==="00000000000")return!1;var r=i.split("").map(Number),n=(11-(3*r[0]+7*r[1]+6*r[2]+1*r[3]+8*r[4]+9*r[5]+4*r[6]+5*r[7]+2*r[8])%11)%11,o=(11-(5*r[0]+4*r[1]+3*r[2]+2*r[3]+7*r[4]+6*r[5]+5*r[6]+4*r[7]+3*r[8]+2*n)%11)%11;return!(n!==r[9]||o!==r[10])},TH:function(e){if(!e.match(/^[1-8]\d{12}$/))return!1;for(var i=0,r=0;r<12;r++)i+=parseInt(e[r],10)*(13-r);return e[12]===((11-i%11)%10).toString()},LK:function(e){var i=/^[1-9]\d{8}[vx]$/i,r=/^[1-9]\d{11}$/i;return e.length===10&&i.test(e)?!0:!!(e.length===12&&r.test(e))},"he-IL":function(e){var i=/^\d{9}$/,r=e.trim();if(!i.test(r))return!1;for(var n=r,o=0,a,l=0;l<n.length;l++)a=Number(n[l])*(l%2+1),o+=a>9?a-9:a;return o%10===0},"ar-LY":function(e){var i=/^(1|2)\d{11}$/,r=e.trim();return!!i.test(r)},"ar-TN":function(e){var i=/^\d{8}$/,r=e.trim();return!!i.test(r)},"zh-CN":function(e){var i=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","71","81","82","91"],r=["7","9","10","5","8","4","2","1","6","3","7","9","10","5","8","4","2"],n=["1","0","X","9","8","7","6","5","4","3","2"],o=function(m){return i.includes(m)},a=function(m){var p=parseInt(m.substring(0,4),10),v=parseInt(m.substring(4,6),10),g=parseInt(m.substring(6),10),_=new Date(p,v-1,g);return _>new Date?!1:_.getFullYear()===p&&_.getMonth()===v-1&&_.getDate()===g},l=function(m){for(var p=m.substring(0,17),v=0,g=0;g<17;g++)v+=parseInt(p.charAt(g),10)*parseInt(r[g],10);var _=v%11;return n[_]},h=function(m){return l(m)===m.charAt(17).toUpperCase()},u=function(m){var p=/^[1-9]\d{7}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}$/.test(m);if(!p)return!1;var v=m.substring(0,2);if(p=o(v),!p)return!1;var g="19".concat(m.substring(6,12));return p=a(g),!!p},c=function(m){var p=/^[1-9]\d{5}[1-9]\d{3}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}(\d|x|X)$/.test(m);if(!p)return!1;var v=m.substring(0,2);if(p=o(v),!p)return!1;var g=m.substring(6,14);return p=a(g),p?h(m):!1},f=function(m){var p=/^\d{15}|(\d{17}(\d|x|X))$/.test(m);return p?m.length===15?u(m):c(m):!1};return f(e)},"zh-TW":function(e){var i={A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:34,J:18,K:19,L:20,M:21,N:22,O:35,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,W:32,X:30,Y:31,Z:33},r=e.trim().toUpperCase();return/^[A-Z][0-9]{9}$/.test(r)?Array.from(r).reduce(function(n,o,a){if(a===0){var l=i[o];return l%10*9+Math.floor(l/10)}return a===9?(10-n%10-Number(o))%10===0:n+Number(o)*(9-a)},0):!1}};function pae(t,e){if((0,B_.default)(t),e in dp)return dp[e](t);if(e==="any"){for(var i in dp)if(dp.hasOwnProperty(i)){var r=dp[i];if(r(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}_M.exports=pp.default;_M.exports.default=pp.default});var $5=oe((mp,yM)=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.default=wae;var mae=gae(Me());function gae(t){return t&&t.__esModule?t:{default:t}}var vae=8,_ae=14,yae=/^(\d{8}|\d{13}|\d{14})$/;function xae(t,e){return t===vae||t===_ae?e%2===0?3:1:e%2===0?1:3}function bae(t){var e=t.slice(0,-1).split("").map(function(r,n){return Number(r)*xae(t.length,n)}).reduce(function(r,n){return r+n},0),i=10-e%10;return i<10?i:0}function wae(t){(0,mae.default)(t);var e=Number(t.slice(-1));return yae.test(t)&&e===bae(t)}yM.exports=mp.default;yM.exports.default=mp.default});var ez=oe((gp,xM)=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.default=Mae;var Sae=Cae(Me());function Cae(t){return t&&t.__esModule?t:{default:t}}var Eae=/^[A-Z]{2}[0-9A-Z]{9}[0-9]$/;function Mae(t){if((0,Sae.default)(t),!Eae.test(t))return!1;for(var e=!0,i=0,r=t.length-2;r>=0;r--)if(t[r]>="A"&&t[r]<="Z")for(var n=t[r].charCodeAt(0)-55,o=n%10,a=Math.trunc(n/10),l=0,h=[o,a];l<h.length;l++){var u=h[l];e?u>=5?i+=1+(u-5)*2:i+=u*2:i+=u,e=!e}else{var c=t[r].charCodeAt(0)-48;e?c>=5?i+=1+(c-5)*2:i+=c*2:i+=c,e=!e}var f=Math.trunc((i+9)/10)*10-i;return+t[t.length-1]===f}xM.exports=gp.default;xM.exports.default=gp.default});var tz=oe((vp,wM)=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});vp.default=bM;var Tae=Aae(Me());function Aae(t){return t&&t.__esModule?t:{default:t}}var Pae=/^(?:[0-9]{9}X|[0-9]{10})$/,Rae=/^(?:[0-9]{13})$/,Lae=[1,3];function bM(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Tae.default)(t),e=String(e),!e)return bM(t,10)||bM(t,13);var i=t.replace(/[\s-]+/g,""),r=0,n;if(e==="10"){if(!Pae.test(i))return!1;for(n=0;n<9;n++)r+=(n+1)*i.charAt(n);if(i.charAt(9)==="X"?r+=10*10:r+=10*i.charAt(9),r%11===0)return!!i}else if(e==="13"){if(!Rae.test(i))return!1;for(n=0;n<12;n++)r+=Lae[n%2]*i.charAt(n);if(i.charAt(12)-(10-r%10)%10===0)return!!i}return!1}wM.exports=vp.default;wM.exports.default=vp.default});var iz=oe((_p,SM)=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.default=kae;var Oae=Dae(Me());function Dae(t){return t&&t.__esModule?t:{default:t}}var Iae="^\\d{4}-?\\d{3}[\\dX]$";function kae(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Oae.default)(t);var i=Iae;if(i=e.require_hyphen?i.replace("?",""):i,i=e.case_sensitive?new RegExp(i):new RegExp(i,"i"),!i.test(t))return!1;for(var r=t.replace("-","").toUpperCase(),n=0,o=0;o<r.length;o++){var a=r[o];n+=(a==="X"?10:+a)*(8-o)}return n%11===0}SM.exports=_p.default;SM.exports.default=_p.default});var rz=oe(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});yu.iso7064Check=Fae;yu.luhnCheck=Bae;yu.reverseMultiplyAndSum=Nae;yu.verhoeffCheck=Uae;function Fae(t){for(var e=10,i=0;i<t.length-1;i++)e=(parseInt(t[i],10)+e)%10===0?10*2%11:(parseInt(t[i],10)+e)%10*2%11;return e=e===1?0:11-e,e===parseInt(t[10],10)}function Bae(t){for(var e=0,i=!1,r=t.length-1;r>=0;r--){if(i){var n=parseInt(t[r],10)*2;n>9?e+=n.toString().split("").map(function(o){return parseInt(o,10)}).reduce(function(o,a){return o+a},0):e+=n}else e+=parseInt(t[r],10);i=!i}return e%10===0}function Nae(t,e){for(var i=0,r=0;r<t.length;r++)i+=t[r]*(e-r);return i}function Uae(t){for(var e=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],i=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],r=t.split("").reverse().join(""),n=0,o=0;o<r.length;o++)n=e[n][i[o%8][parseInt(r[o],10)]];return n===0}});var lz=oe((yp,MM)=>{"use strict";function N_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?N_=function(i){return typeof i}:N_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},N_(t)}Object.defineProperty(yp,"__esModule",{value:!0});yp.default=wle;var zae=az(Me()),Ys=Gae(rz()),Vr=az(CE());function oz(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return oz=function(){return t},t}function Gae(t){if(t&&t.__esModule)return t;if(t===null||N_(t)!=="object"&&typeof t!="function")return{default:t};var e=oz();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function az(t){return t&&t.__esModule?t:{default:t}}function Hae(t){return qae(t)||jae(t)||Vae(t)||Wae()}function Wae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vae(t,e){if(t){if(typeof t=="string")return EM(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return EM(t,e)}}function jae(t){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function qae(t){if(Array.isArray(t))return EM(t)}function EM(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Xae(t){var e=t.slice(0,2),i=parseInt(t.slice(2,4),10);i>40?(i-=40,e="20".concat(e)):i>20?(i-=20,e="18".concat(e)):e="19".concat(e),i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(h){return parseInt(h,10)}),o=[2,4,8,5,10,9,7,3,6],a=0,l=0;l<o.length;l++)a+=n[l]*o[l];return a=a%11===10?0:a%11,a===n[9]}function Yae(t){t=t.replace(/\W/,"");var e=parseInt(t.slice(0,2),10);if(t.length===10)e<54?e="20".concat(e):e="19".concat(e);else{if(t.slice(6)==="000")return!1;if(e<54)e="19".concat(e);else return!1}e.length===3&&(e=[e.slice(0,2),"0",e.slice(2)].join(""));var i=parseInt(t.slice(2,4),10);if(i>50&&(i-=50),i>20){if(parseInt(e,10)<2004)return!1;i-=20}i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1;if(t.length===10&&parseInt(t,10)%11!==0){var n=parseInt(t.slice(0,9),10)%11;if(parseInt(e,10)<1986&&n===10){if(parseInt(t.slice(9),10)!==0)return!1}else return!1}return!0}function Zae(t){return Ys.luhnCheck(t)}function Kae(t){for(var e=t.split("").map(function(h){return parseInt(h,10)}),i=[],r=0;r<e.length-1;r++){i.push("");for(var n=0;n<e.length-1;n++)e[r]===e[n]&&(i[r]+=n)}if(i=i.filter(function(h){return h.length>1}),i.length!==2&&i.length!==3)return!1;if(i[0].length===3){for(var o=i[0].split("").map(function(h){return parseInt(h,10)}),a=0,l=0;l<o.length-1;l++)o[l]+1===o[l+1]&&(a+=1);if(a===2)return!1}return Ys.iso7064Check(t)}function Qae(t){t=t.replace(/\W/,"");var e=parseInt(t.slice(4,6),10),i=t.slice(6,7);switch(i){case"0":case"1":case"2":case"3":e="19".concat(e);break;case"4":case"9":e<37?e="20".concat(e):e="19".concat(e);break;default:if(e<37)e="20".concat(e);else if(e>58)e="18".concat(e);else return!1;break}e.length===3&&(e=[e.slice(0,2),"0",e.slice(2)].join(""));var r="".concat(e,"/").concat(t.slice(2,4),"/").concat(t.slice(0,2));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(h){return parseInt(h,10)}),o=0,a=4,l=0;l<9;l++)o+=n[l]*a,a-=1,a===1&&(a=7);return o%=11,o===1?!1:o===0?n[9]===0:n[9]===11-o}function Jae(t){for(var e=t.slice(0,8).split("").map(function(o){return parseInt(o,10)}),i=0,r=1;r<e.length;r+=2)i+=e[r];for(var n=0;n<e.length;n+=2)e[n]<2?i+=1-e[n]:(i+=2*(e[n]-2)+5,e[n]>4&&(i+=2));return String.fromCharCode(i%26+65)===t.charAt(8)}function $ae(t){for(var e=t.split("").map(function(n){return parseInt(n,10)}),i=0,r=0;r<8;r++)i+=e[r]*Math.pow(2,8-r);return i%11%10===e[8]}function ele(t){var e=Ys.reverseMultiplyAndSum(t.split("").slice(0,7).map(function(i){return parseInt(i,10)}),8);return t.length===9&&t[8]!=="W"&&(e+=(t[8].charCodeAt(0)-64)*9),e%=23,e===0?t[7].toUpperCase()==="W":t[7].toUpperCase()===String.fromCharCode(64+e)}var CM={andover:["10","12"],atlanta:["60","67"],austin:["50","53"],brookhaven:["01","02","03","04","05","06","11","13","14","16","21","22","23","25","34","51","52","54","55","56","57","58","59","65"],cincinnati:["30","32","35","36","37","38","61"],fresno:["15","24"],internet:["20","26","27","45","46","47"],kansas:["40","44"],memphis:["94","95"],ogden:["80","90"],philadelphia:["33","39","41","42","43","46","48","62","63","64","66","68","71","72","73","74","75","76","77","81","82","83","84","85","86","87","88","91","92","93","98","99"],sba:["31"]};function tle(){var t=[];for(var e in CM)CM.hasOwnProperty(e)&&t.push.apply(t,Hae(CM[e]));return t}function ile(t){return tle().indexOf(t.substr(0,2))!==-1}function rle(t){var e=t.toUpperCase().split("");if(isNaN(parseInt(e[0],10))&&e.length>1){var i=0;switch(e[0]){case"Y":i=1;break;case"Z":i=2;break;default:}e.splice(0,1,i)}else for(;e.length<9;)e.unshift(0);var r=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"];e=e.join("");var n=parseInt(e.slice(0,8),10)%23;return e[8]===r[n]}function nle(t){var e=t.slice(1,3),i=t.slice(0,1);switch(i){case"1":case"2":e="18".concat(e);break;case"3":case"4":e="19".concat(e);break;default:e="20".concat(e);break}var r="".concat(e,"/").concat(t.slice(3,5),"/").concat(t.slice(5,7));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(u){return parseInt(u,10)}),o=0,a=1,l=0;l<10;l++)o+=n[l]*a,a+=1,a===10&&(a=1);if(o%11===10){o=0,a=3;for(var h=0;h<10;h++)o+=n[h]*a,a+=1,a===10&&(a=1);if(o%11===10)return n[10]===0}return o%11===n[10]}function sle(t){var e=t.slice(4,6),i=t.slice(6,7);switch(i){case"+":e="18".concat(e);break;case"-":e="19".concat(e);break;default:e="20".concat(e);break}var r="".concat(e,"/").concat(t.slice(2,4),"/").concat(t.slice(0,2));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1;var n=parseInt(t.slice(0,6)+t.slice(7,10),10)%31;if(n<10)return n===parseInt(t.slice(10),10);n-=10;var o=["A","B","C","D","E","F","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y"];return o[n]===t.slice(10)}function ole(t){if(t.slice(2,4)!=="00"||t.slice(4,6)!=="00"){var e="".concat(t.slice(0,2),"/").concat(t.slice(2,4),"/").concat(t.slice(4,6));if(!(0,Vr.default)(e,"YY/MM/DD"))return!1}var i=97-parseInt(t.slice(0,9),10)%97,r=parseInt(t.slice(9,11),10);return!(i!==r&&(i=97-parseInt("2".concat(t.slice(0,9)),10)%97,i!==r))}function ale(t){t=t.replace(/\s/g,"");var e=parseInt(t.slice(0,10),10)%511,i=parseInt(t.slice(10,13),10);return e===i}function lle(t){var e="".concat(t.slice(0,4),"/").concat(t.slice(4,6),"/").concat(t.slice(6,8));return!(0,Vr.default)(e,"YYYY/MM/DD")||!Ys.luhnCheck(t.slice(0,12))?!1:Ys.verhoeffCheck("".concat(t.slice(0,11)).concat(t[12]))}function hle(t){return Ys.iso7064Check(t)}function ule(t){for(var e=t.split("").map(function(n){return parseInt(n,10)}),i=8,r=1;r<9;r++)i+=e[r]*(r+1);return i%11===e[9]}function nz(t){for(var e=!1,i=!1,r=0;r<3;r++)if(!e&&/[AEIOU]/.test(t[r]))e=!0;else if(!i&&e&&t[r]==="X")i=!0;else if(r>0&&(e&&!i&&!/[AEIOU]/.test(t[r])||i&&!/X/.test(t[r])))return!1;return!0}function cle(t){var e=t.toUpperCase().split("");if(!nz(e.slice(0,3))||!nz(e.slice(3,6)))return!1;for(var i=[6,7,9,10,12,13,14],r={L:"0",M:"1",N:"2",P:"3",Q:"4",R:"5",S:"6",T:"7",U:"8",V:"9"},n=0,o=i;n<o.length;n++){var a=o[n];e[a]in r&&e.splice(a,1,r[e[a]])}var l={A:"01",B:"02",C:"03",D:"04",E:"05",H:"06",L:"07",M:"08",P:"09",R:"10",S:"11",T:"12"},h=l[e[8]],u=parseInt(e[9]+e[10],10);u>40&&(u-=40),u<10&&(u="0".concat(u));var c="".concat(e[6]).concat(e[7],"/").concat(h,"/").concat(u);if(!(0,Vr.default)(c,"YY/MM/DD"))return!1;for(var f=0,d=1;d<e.length-1;d+=2){var m=parseInt(e[d],10);isNaN(m)&&(m=e[d].charCodeAt(0)-65),f+=m}for(var p={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23,0:1,1:0},v=0;v<e.length-1;v+=2){var g=0;if(e[v]in p)g=p[e[v]];else{var _=parseInt(e[v],10);g=2*_+1,_>4&&(g+=2)}f+=g}return String.fromCharCode(65+f%26)===e[15]}function fle(t){t=t.replace(/\W/,"");var e=t.slice(0,2);if(e!=="32"){var i=t.slice(2,4);if(i!=="00"){var r=t.slice(4,6);switch(t[6]){case"0":r="18".concat(r);break;case"1":r="19".concat(r);break;default:r="20".concat(r);break}var n="".concat(r,"/").concat(t.slice(2,4),"/").concat(e);if(!(0,Vr.default)(n,"YYYY/MM/DD"))return!1}for(var o=1101,a=[1,6,3,7,9,10,5,8,4,2],l=0;l<t.length-1;l++)o-=parseInt(t[l],10)*a[l];return parseInt(t[10],10)===o%11}return!0}function dle(t){if(t.length!==9){for(var e=t.toUpperCase().split("");e.length<8;)e.unshift(0);switch(t[7]){case"A":case"P":if(parseInt(e[6],10)===0)return!1;break;default:{var i=parseInt(e.join("").slice(0,5),10);if(i>32e3)return!1;var r=parseInt(e.join("").slice(5,7),10);if(i===r)return!1}}}return!0}function ple(t){return Ys.reverseMultiplyAndSum(t.split("").slice(0,8).map(function(e){return parseInt(e,10)}),9)%11===parseInt(t[8],10)}function mle(t){if(t.length===10){for(var e=[6,5,7,2,3,4,5,6,7],i=0,r=0;r<e.length;r++)i+=parseInt(t[r],10)*e[r];return i%=11,i===10?!1:i===parseInt(t[9],10)}var n=t.slice(0,2),o=parseInt(t.slice(2,4),10);o>80?(n="18".concat(n),o-=80):o>60?(n="22".concat(n),o-=60):o>40?(n="21".concat(n),o-=40):o>20?(n="20".concat(n),o-=20):n="19".concat(n),o<10&&(o="0".concat(o));var a="".concat(n,"/").concat(o,"/").concat(t.slice(4,6));if(!(0,Vr.default)(a,"YYYY/MM/DD"))return!1;for(var l=0,h=1,u=0;u<t.length-1;u++)l+=parseInt(t[u],10)*h%10,h+=2,h>10?h=1:h===5&&(h+=2);return l=10-l%10,l===parseInt(t[10],10)}function gle(t){if(t.length===11){var e,i;if(e=0,t==="11111111111"||t==="22222222222"||t==="33333333333"||t==="44444444444"||t==="55555555555"||t==="66666666666"||t==="77777777777"||t==="88888888888"||t==="99999999999"||t==="00000000000")return!1;for(var r=1;r<=9;r++)e+=parseInt(t.substring(r-1,r),10)*(11-r);if(i=e*10%11,i===10&&(i=0),i!==parseInt(t.substring(9,10),10))return!1;e=0;for(var n=1;n<=10;n++)e+=parseInt(t.substring(n-1,n),10)*(12-n);return i=e*10%11,i===10&&(i=0),i===parseInt(t.substring(10,11),10)}if(t==="00000000000000"||t==="11111111111111"||t==="22222222222222"||t==="33333333333333"||t==="44444444444444"||t==="55555555555555"||t==="66666666666666"||t==="77777777777777"||t==="88888888888888"||t==="99999999999999")return!1;for(var o=t.length-2,a=t.substring(0,o),l=t.substring(o),h=0,u=o-7,c=o;c>=1;c--)h+=a.charAt(o-c)*u,u-=1,u<2&&(u=9);var f=h%11<2?0:11-h%11;if(f!==parseInt(l.charAt(0),10))return!1;o+=1,a=t.substring(0,o),h=0,u=o-7;for(var d=o;d>=1;d--)h+=a.charAt(o-d)*u,u-=1,u<2&&(u=9);return f=h%11<2?0:11-h%11,f===parseInt(l.charAt(1),10)}function vle(t){var e=11-Ys.reverseMultiplyAndSum(t.split("").slice(0,8).map(function(i){return parseInt(i,10)}),9)%11;return e>9?parseInt(t[8],10)===0:e===parseInt(t[8],10)}function _le(t){if(t.slice(0,4)!=="9000"){var e=t.slice(1,3);switch(t[0]){case"1":case"2":e="19".concat(e);break;case"3":case"4":e="18".concat(e);break;case"5":case"6":e="20".concat(e);break;default:}var i="".concat(e,"/").concat(t.slice(3,5),"/").concat(t.slice(5,7));if(i.length===8){if(!(0,Vr.default)(i,"YY/MM/DD"))return!1}else if(!(0,Vr.default)(i,"YYYY/MM/DD"))return!1;for(var r=t.split("").map(function(l){return parseInt(l,10)}),n=[2,7,9,1,4,6,3,5,8,2,7,9],o=0,a=0;a<n.length;a++)o+=r[a]*n[a];return o%11===10?r[12]===1:r[12]===o%11}return!0}function yle(t){if(t.length===9){if(t=t.replace(/\W/,""),t.slice(6)==="000")return!1;var e=parseInt(t.slice(0,2),10);if(e>53)return!1;e<10?e="190".concat(e):e="19".concat(e);var i=parseInt(t.slice(2,4),10);i>50&&(i-=50),i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,Vr.default)(r,"YYYY/MM/DD"))return!1}return!0}function xle(t){var e=11-Ys.reverseMultiplyAndSum(t.split("").slice(0,7).map(function(i){return parseInt(i,10)}),8)%11;return e===10?parseInt(t[7],10)===0:e===parseInt(t[7],10)}function ble(t){var e=t.slice(0);t.length>11&&(e=e.slice(2));var i="",r=e.slice(2,4),n=parseInt(e.slice(4,6),10);if(t.length>11)i=t.slice(0,4);else if(i=t.slice(0,2),t.length===11&&n<60){var o=new Date().getFullYear().toString(),a=parseInt(o.slice(0,2),10);if(o=parseInt(o,10),t[6]==="-")parseInt("".concat(a).concat(i),10)>o?i="".concat(a-1).concat(i):i="".concat(a).concat(i);else if(i="".concat(a-1).concat(i),o-parseInt(i,10)<100)return!1}n>60&&(n-=60),n<10&&(n="0".concat(n));var l="".concat(i,"/").concat(r,"/").concat(n);if(l.length===8){if(!(0,Vr.default)(l,"YY/MM/DD"))return!1}else if(!(0,Vr.default)(l,"YYYY/MM/DD"))return!1;return Ys.luhnCheck(t.replace(/\W/,""))}var La={"bg-BG":/^\d{10}$/,"cs-CZ":/^\d{6}\/{0,1}\d{3,4}$/,"de-AT":/^\d{9}$/,"de-DE":/^[1-9]\d{10}$/,"dk-DK":/^\d{6}-{0,1}\d{4}$/,"el-CY":/^[09]\d{7}[A-Z]$/,"el-GR":/^([0-4]|[7-9])\d{8}$/,"en-GB":/^\d{10}$|^(?!GB|NK|TN|ZZ)(?![DFIQUV])[A-Z](?![DFIQUVO])[A-Z]\d{6}[ABCD ]$/i,"en-IE":/^\d{7}[A-W][A-IW]{0,1}$/i,"en-US":/^\d{2}[- ]{0,1}\d{7}$/,"es-ES":/^(\d{0,8}|[XYZKLM]\d{7})[A-HJ-NP-TV-Z]$/i,"et-EE":/^[1-6]\d{6}(00[1-9]|0[1-9][0-9]|[1-6][0-9]{2}|70[0-9]|710)\d$/,"fi-FI":/^\d{6}[-+A]\d{3}[0-9A-FHJ-NPR-Y]$/i,"fr-BE":/^\d{11}$/,"fr-FR":/^[0-3]\d{12}$|^[0-3]\d\s\d{2}(\s\d{3}){3}$/,"fr-LU":/^\d{13}$/,"hr-HR":/^\d{11}$/,"hu-HU":/^8\d{9}$/,"it-IT":/^[A-Z]{6}[L-NP-V0-9]{2}[A-EHLMPRST][L-NP-V0-9]{2}[A-ILMZ][L-NP-V0-9]{3}[A-Z]$/i,"lv-LV":/^\d{6}-{0,1}\d{5}$/,"mt-MT":/^\d{3,7}[APMGLHBZ]$|^([1-8])\1\d{7}$/i,"nl-NL":/^\d{9}$/,"pl-PL":/^\d{10,11}$/,"pt-BR":/(?:^\d{11}$)|(?:^\d{14}$)/,"pt-PT":/^\d{9}$/,"ro-RO":/^\d{13}$/,"sk-SK":/^\d{6}\/{0,1}\d{3,4}$/,"sl-SI":/^[1-9]\d{7}$/,"sv-SE":/^(\d{6}[-+]{0,1}\d{4}|(18|19|20)\d{6}[-+]{0,1}\d{4})$/};La["lb-LU"]=La["fr-LU"];La["lt-LT"]=La["et-EE"];La["nl-BE"]=La["fr-BE"];var Oa={"bg-BG":Xae,"cs-CZ":Yae,"de-AT":Zae,"de-DE":Kae,"dk-DK":Qae,"el-CY":Jae,"el-GR":$ae,"en-IE":ele,"en-US":ile,"es-ES":rle,"et-EE":nle,"fi-FI":sle,"fr-BE":ole,"fr-FR":ale,"fr-LU":lle,"hr-HR":hle,"hu-HU":ule,"it-IT":cle,"lv-LV":fle,"mt-MT":dle,"nl-NL":ple,"pl-PL":mle,"pt-BR":gle,"pt-PT":vle,"ro-RO":_le,"sk-SK":yle,"sl-SI":xle,"sv-SE":ble};Oa["lb-LU"]=Oa["fr-LU"];Oa["lt-LT"]=Oa["et-EE"];Oa["nl-BE"]=Oa["fr-BE"];var sz=/[-\\\/!@#$%\^&\*\(\)\+\=\[\]]+/g,U_={"de-AT":sz,"de-DE":/[\/\\]/g,"fr-BE":sz};U_["nl-BE"]=U_["fr-BE"];function wle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US";(0,zae.default)(t);var i=t.slice(0);if(e in La)return e in U_&&(i=i.replace(U_[e],"")),La[e].test(i)?e in Oa?Oa[e](i):!0:!1;throw new Error("Invalid locale '".concat(e,"'"))}MM.exports=yp.default;MM.exports.default=yp.default});var hz=oe(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});xp.default=Ele;xp.locales=void 0;var Sle=Cle(Me());function Cle(t){return t&&t.__esModule?t:{default:t}}var mi={"am-AM":/^(\+?374|0)((10|[9|7][0-9])\d{6}$|[2-4]\d{7}$)/,"ar-AE":/^((\+?971)|0)?5[024568]\d{7}$/,"ar-BH":/^(\+?973)?(3|6)\d{7}$/,"ar-DZ":/^(\+?213|0)(5|6|7)\d{8}$/,"ar-LB":/^(\+?961)?((3|81)\d{6}|7\d{7})$/,"ar-EG":/^((\+?20)|0)?1[0125]\d{8}$/,"ar-IQ":/^(\+?964|0)?7[0-9]\d{8}$/,"ar-JO":/^(\+?962|0)?7[789]\d{7}$/,"ar-KW":/^(\+?965)[569]\d{7}$/,"ar-LY":/^((\+?218)|0)?(9[1-6]\d{7}|[1-8]\d{7,9})$/,"ar-MA":/^(?:(?:\+|00)212|0)[5-7]\d{8}$/,"ar-OM":/^((\+|00)968)?(9[1-9])\d{6}$/,"ar-PS":/^(\+?970|0)5[6|9](\d{7})$/,"ar-SA":/^(!?(\+?966)|0)?5\d{8}$/,"ar-SY":/^(!?(\+?963)|0)?9\d{8}$/,"ar-TN":/^(\+?216)?[2459]\d{7}$/,"az-AZ":/^(\+994|0)(5[015]|7[07]|99)\d{7}$/,"bs-BA":/^((((\+|00)3876)|06))((([0-3]|[5-6])\d{6})|(4\d{7}))$/,"be-BY":/^(\+?375)?(24|25|29|33|44)\d{7}$/,"bg-BG":/^(\+?359|0)?8[789]\d{7}$/,"bn-BD":/^(\+?880|0)1[13456789][0-9]{8}$/,"ca-AD":/^(\+376)?[346]\d{5}$/,"cs-CZ":/^(\+?420)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"da-DK":/^(\+?45)?\s?\d{2}\s?\d{2}\s?\d{2}\s?\d{2}$/,"de-DE":/^((\+49|0)[1|3])([0|5][0-45-9]\d|6([23]|0\d?)|7([0-57-9]|6\d))\d{7,9}$/,"de-AT":/^(\+43|0)\d{1,4}\d{3,12}$/,"de-CH":/^(\+41|0)([1-9])\d{1,9}$/,"de-LU":/^(\+352)?((6\d1)\d{6})$/,"dv-MV":/^(\+?960)?(7[2-9]|91|9[3-9])\d{7}$/,"el-GR":/^(\+?30|0)?(69\d{8})$/,"en-AU":/^(\+?61|0)4\d{8}$/,"en-BM":/^(\+?1)?441(((3|7)\d{6}$)|(5[0-3][0-9]\d{4}$)|(59\d{5}))/,"en-GB":/^(\+?44|0)7\d{9}$/,"en-GG":/^(\+?44|0)1481\d{6}$/,"en-GH":/^(\+233|0)(20|50|24|54|27|57|26|56|23|28|55|59)\d{7}$/,"en-GY":/^(\+592|0)6\d{6}$/,"en-HK":/^(\+?852[-\s]?)?[456789]\d{3}[-\s]?\d{4}$/,"en-MO":/^(\+?853[-\s]?)?[6]\d{3}[-\s]?\d{4}$/,"en-IE":/^(\+?353|0)8[356789]\d{7}$/,"en-IN":/^(\+?91|0)?[6789]\d{9}$/,"en-KE":/^(\+?254|0)(7|1)\d{8}$/,"en-KI":/^((\+686|686)?)?( )?((6|7)(2|3|8)[0-9]{6})$/,"en-MT":/^(\+?356|0)?(99|79|77|21|27|22|25)[0-9]{6}$/,"en-MU":/^(\+?230|0)?\d{8}$/,"en-NA":/^(\+?264|0)(6|8)\d{7}$/,"en-NG":/^(\+?234|0)?[789]\d{9}$/,"en-NZ":/^(\+?64|0)[28]\d{7,9}$/,"en-PK":/^((00|\+)?92|0)3[0-6]\d{8}$/,"en-PH":/^(09|\+639)\d{9}$/,"en-RW":/^(\+?250|0)?[7]\d{8}$/,"en-SG":/^(\+65)?[3689]\d{7}$/,"en-SL":/^(\+?232|0)\d{8}$/,"en-TZ":/^(\+?255|0)?[67]\d{8}$/,"en-UG":/^(\+?256|0)?[7]\d{8}$/,"en-US":/^((\+1|1)?( |-)?)?(\([2-9][0-9]{2}\)|[2-9][0-9]{2})( |-)?([2-9][0-9]{2}( |-)?[0-9]{4})$/,"en-ZA":/^(\+?27|0)\d{9}$/,"en-ZM":/^(\+?26)?09[567]\d{7}$/,"en-ZW":/^(\+263)[0-9]{9}$/,"en-BW":/^(\+?267)?(7[1-8]{1})\d{6}$/,"es-AR":/^\+?549(11|[2368]\d)\d{8}$/,"es-BO":/^(\+?591)?(6|7)\d{7}$/,"es-CO":/^(\+?57)?3(0(0|1|2|4|5)|1\d|2[0-4]|5(0|1))\d{7}$/,"es-CL":/^(\+?56|0)[2-9]\d{1}\d{7}$/,"es-CR":/^(\+506)?[2-8]\d{7}$/,"es-CU":/^(\+53|0053)?5\d{7}/,"es-DO":/^(\+?1)?8[024]9\d{7}$/,"es-HN":/^(\+?504)?[9|8]\d{7}$/,"es-EC":/^(\+?593|0)([2-7]|9[2-9])\d{7}$/,"es-ES":/^(\+?34)?[6|7]\d{8}$/,"es-PE":/^(\+?51)?9\d{8}$/,"es-MX":/^(\+?52)?(1|01)?\d{10,11}$/,"es-PA":/^(\+?507)\d{7,8}$/,"es-PY":/^(\+?595|0)9[9876]\d{7}$/,"es-SV":/^(\+?503)?[67]\d{7}$/,"es-UY":/^(\+598|0)9[1-9][\d]{6}$/,"es-VE":/^(\+?58)?(2|4)\d{9}$/,"et-EE":/^(\+?372)?\s?(5|8[1-4])\s?([0-9]\s?){6,7}$/,"fa-IR":/^(\+?98[\-\s]?|0)9[0-39]\d[\-\s]?\d{3}[\-\s]?\d{4}$/,"fi-FI":/^(\+?358|0)\s?(4(0|1|2|4|5|6)?|50)\s?(\d\s?){4,8}\d$/,"fj-FJ":/^(\+?679)?\s?\d{3}\s?\d{4}$/,"fo-FO":/^(\+?298)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"fr-BF":/^(\+226|0)[67]\d{7}$/,"fr-CM":/^(\+?237)6[0-9]{8}$/,"fr-FR":/^(\+?33|0)[67]\d{8}$/,"fr-GF":/^(\+?594|0|00594)[67]\d{8}$/,"fr-GP":/^(\+?590|0|00590)[67]\d{8}$/,"fr-MQ":/^(\+?596|0|00596)[67]\d{8}$/,"fr-PF":/^(\+?689)?8[789]\d{6}$/,"fr-RE":/^(\+?262|0|00262)[67]\d{8}$/,"he-IL":/^(\+972|0)([23489]|5[012345689]|77)[1-9]\d{6}$/,"hu-HU":/^(\+?36|06)(20|30|31|50|70)\d{7}$/,"id-ID":/^(\+?62|0)8(1[123456789]|2[1238]|3[1238]|5[12356789]|7[78]|9[56789]|8[123456789])([\s?|\d]{5,11})$/,"it-IT":/^(\+?39)?\s?3\d{2} ?\d{6,7}$/,"it-SM":/^((\+378)|(0549)|(\+390549)|(\+3780549))?6\d{5,9}$/,"ja-JP":/^(\+81[ \-]?(\(0\))?|0)[6789]0[ \-]?\d{4}[ \-]?\d{4}$/,"ka-GE":/^(\+?995)?(5|79)\d{7}$/,"kk-KZ":/^(\+?7|8)?7\d{9}$/,"kl-GL":/^(\+?299)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"ko-KR":/^((\+?82)[ \-]?)?0?1([0|1|6|7|8|9]{1})[ \-]?\d{3,4}[ \-]?\d{4}$/,"lt-LT":/^(\+370|8)\d{8}$/,"lv-LV":/^(\+?371)2\d{7}$/,"ms-MY":/^(\+?6?01){1}(([0145]{1}(\-|\s)?\d{7,8})|([236789]{1}(\s|\-)?\d{7}))$/,"mz-MZ":/^(\+?258)?8[234567]\d{7}$/,"nb-NO":/^(\+?47)?[49]\d{7}$/,"ne-NP":/^(\+?977)?9[78]\d{8}$/,"nl-BE":/^(\+?32|0)4\d{8}$/,"nl-NL":/^(((\+|00)?31\(0\))|((\+|00)?31)|0)6{1}\d{8}$/,"nn-NO":/^(\+?47)?[49]\d{7}$/,"pl-PL":/^(\+?48)? ?[5-8]\d ?\d{3} ?\d{2} ?\d{2}$/,"pt-BR":/^((\+?55\ ?[1-9]{2}\ ?)|(\+?55\ ?\([1-9]{2}\)\ ?)|(0[1-9]{2}\ ?)|(\([1-9]{2}\)\ ?)|([1-9]{2}\ ?))((\d{4}\-?\d{4})|(9[2-9]{1}\d{3}\-?\d{4}))$/,"pt-PT":/^(\+?351)?9[1236]\d{7}$/,"pt-AO":/^(\+244)\d{9}$/,"ro-RO":/^(\+?4?0)\s?7\d{2}(\/|\s|\.|\-)?\d{3}(\s|\.|\-)?\d{3}$/,"ru-RU":/^(\+?7|8)?9\d{9}$/,"si-LK":/^(?:0|94|\+94)?(7(0|1|2|4|5|6|7|8)( |-)?)\d{7}$/,"sl-SI":/^(\+386\s?|0)(\d{1}\s?\d{3}\s?\d{2}\s?\d{2}|\d{2}\s?\d{3}\s?\d{3})$/,"sk-SK":/^(\+?421)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"sq-AL":/^(\+355|0)6[789]\d{6}$/,"sr-RS":/^(\+3816|06)[- \d]{5,9}$/,"sv-SE":/^(\+?46|0)[\s\-]?7[\s\-]?[02369]([\s\-]?\d){7}$/,"tg-TJ":/^(\+?992)?[5][5]\d{7}$/,"th-TH":/^(\+66|66|0)\d{9}$/,"tr-TR":/^(\+?90|0)?5\d{9}$/,"tk-TM":/^(\+993|993|8)\d{8}$/,"uk-UA":/^(\+?38|8)?0\d{9}$/,"uz-UZ":/^(\+?998)?(6[125-79]|7[1-69]|88|9\d)\d{7}$/,"vi-VN":/^((\+?84)|0)((3([2-9]))|(5([25689]))|(7([0|6-9]))|(8([1-9]))|(9([0-9])))([0-9]{7})$/,"zh-CN":/^((\+|00)86)?(1[3-9]|9[28])\d{9}$/,"zh-TW":/^(\+?886\-?|0)?9\d{8}$/,"dz-BT":/^(\+?975|0)?(17|16|77|02)\d{6}$/};mi["en-CA"]=mi["en-US"];mi["fr-CA"]=mi["en-CA"];mi["fr-BE"]=mi["nl-BE"];mi["zh-HK"]=mi["en-HK"];mi["zh-MO"]=mi["en-MO"];mi["ga-IE"]=mi["en-IE"];mi["fr-CH"]=mi["de-CH"];mi["it-CH"]=mi["fr-CH"];function Ele(t,e,i){if((0,Sle.default)(t),i&&i.strictMode&&!t.startsWith("+"))return!1;if(Array.isArray(e))return e.some(function(o){if(mi.hasOwnProperty(o)){var a=mi[o];if(a.test(t))return!0}return!1});if(e in mi)return mi[e].test(t);if(!e||e==="any"){for(var r in mi)if(mi.hasOwnProperty(r)){var n=mi[r];if(n.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}var Mle=Object.keys(mi);xp.locales=Mle});var uz=oe((bp,TM)=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0});bp.default=Rle;var Tle=Ale(Me());function Ale(t){return t&&t.__esModule?t:{default:t}}var Ple=/^(0x)[0-9a-f]{40}$/i;function Rle(t){return(0,Tle.default)(t),Ple.test(t)}TM.exports=bp.default;TM.exports.default=bp.default});var fz=oe((wp,AM)=>{"use strict";Object.defineProperty(wp,"__esModule",{value:!0});wp.default=kle;var Lle=cz(an()),Ole=cz(Me());function cz(t){return t&&t.__esModule?t:{default:t}}function Dle(t){var e="\\d{".concat(t.digits_after_decimal[0],"}");t.digits_after_decimal.forEach(function(c,f){f!==0&&(e="".concat(e,"|\\d{").concat(c,"}"))});var i="(".concat(t.symbol.replace(/\W/,function(c){return"\\".concat(c)}),")").concat(t.require_symbol?"":"?"),r="-?",n="[1-9]\\d*",o="[1-9]\\d{0,2}(\\".concat(t.thousands_separator,"\\d{3})*"),a=["0",n,o],l="(".concat(a.join("|"),")?"),h="(\\".concat(t.decimal_separator,"(").concat(e,"))").concat(t.require_decimal?"":"?"),u=l+(t.allow_decimal||t.require_decimal?h:"");return t.allow_negatives&&!t.parens_for_negatives&&(t.negative_sign_after_digits?u+=r:t.negative_sign_before_digits&&(u=r+u)),t.allow_negative_sign_placeholder?u="( (?!\\-))?".concat(u):t.allow_space_after_symbol?u=" ?".concat(u):t.allow_space_after_digits&&(u+="( (?!$))?"),t.symbol_after_digits?u+=i:u=i+u,t.allow_negatives&&(t.parens_for_negatives?u="(\\(".concat(u,"\\)|").concat(u,")"):t.negative_sign_before_digits||t.negative_sign_after_digits||(u=r+u)),new RegExp("^(?!-? )(?=.*\\d)".concat(u,"$"))}var Ile={symbol:"$",require_symbol:!1,allow_space_after_symbol:!1,symbol_after_digits:!1,allow_negatives:!0,parens_for_negatives:!1,negative_sign_before_digits:!1,negative_sign_after_digits:!1,allow_negative_sign_placeholder:!1,thousands_separator:",",decimal_separator:".",allow_decimal:!0,require_decimal:!1,digits_after_decimal:[2],allow_space_after_digits:!1};function kle(t,e){return(0,Ole.default)(t),e=(0,Lle.default)(e,Ile),Dle(e).test(t)}AM.exports=wp.default;AM.exports.default=wp.default});var dz=oe((Sp,PM)=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.default=zle;var Fle=Ble(Me());function Ble(t){return t&&t.__esModule?t:{default:t}}var Nle=/^(bc1)[a-z0-9]{25,39}$/,Ule=/^(1|3)[A-HJ-NP-Za-km-z1-9]{25,39}$/;function zle(t){return(0,Fle.default)(t),t.startsWith("bc1")?Nle.test(t):Ule.test(t)}PM.exports=Sp.default;PM.exports.default=Sp.default});var pz=oe((Cp,RM)=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.default=qle;var Gle=Hle(Me());function Hle(t){return t&&t.__esModule?t:{default:t}}var Wle=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Vle=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,jle=function(e){var i=e.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(i){var r=Number(i[1]),n=Number(i[2]);return r%4===0&&r%100!==0||r%400===0?n<=366:n<=365}var o=e.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),a=o[1],l=o[2],h=o[3],u=l&&"0".concat(l).slice(-2),c=h&&"0".concat(h).slice(-2),f=new Date("".concat(a,"-").concat(u||"01","-").concat(c||"01"));return l&&h?f.getUTCFullYear()===a&&f.getUTCMonth()+1===l&&f.getUTCDate()===h:!0};function qle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Gle.default)(t);var i=e.strictSeparator?Vle.test(t):Wle.test(t);return i&&e.strict?jle(t):i}RM.exports=Cp.default;RM.exports.default=Cp.default});var vz=oe((Ep,LM)=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});Ep.default=ohe;var Xle=Yle(Me());function Yle(t){return t&&t.__esModule?t:{default:t}}var Zle=/[0-9]{4}/,Kle=/(0[1-9]|1[0-2])/,Qle=/([12]\d|0[1-9]|3[01])/,mz=/([01][0-9]|2[0-3])/,gz=/[0-5][0-9]/,Jle=/([0-5][0-9]|60)/,$le=/(\.[0-9]+)?/,ehe=new RegExp("[-+]".concat(mz.source,":").concat(gz.source)),the=new RegExp("([zZ]|".concat(ehe.source,")")),ihe=new RegExp("".concat(mz.source,":").concat(gz.source,":").concat(Jle.source).concat($le.source)),rhe=new RegExp("".concat(Zle.source,"-").concat(Kle.source,"-").concat(Qle.source)),nhe=new RegExp("".concat(ihe.source).concat(the.source)),she=new RegExp("^".concat(rhe.source,"[ tT]").concat(nhe.source,"$"));function ohe(t){return(0,Xle.default)(t),she.test(t)}LM.exports=Ep.default;LM.exports.default=Ep.default});var _z=oe((Mp,OM)=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.default=uhe;var ahe=lhe(Me());function lhe(t){return t&&t.__esModule?t:{default:t}}var hhe=new Set(["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","KHM","CMR","CAN","CPV","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MKD","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWZ","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]);function uhe(t){return(0,ahe.default)(t),hhe.has(t.toUpperCase())}OM.exports=Mp.default;OM.exports.default=Mp.default});var xz=oe(Tp=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});Tp.default=dhe;Tp.CurrencyCodes=void 0;var che=fhe(Me());function fhe(t){return t&&t.__esModule?t:{default:t}}var yz=new Set(["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BOV","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHE","CHF","CHW","CLF","CLP","CNY","COP","COU","CRC","CUC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","USN","UYI","UYU","UYW","UZS","VES","VND","VUV","WST","XAF","XAG","XAU","XBA","XBB","XBC","XBD","XCD","XDR","XOF","XPD","XPF","XPT","XSU","XTS","XUA","XXX","YER","ZAR","ZMW","ZWL"]);function dhe(t){return(0,che.default)(t),yz.has(t.toUpperCase())}var phe=yz;Tp.CurrencyCodes=phe});var bz=oe((Ap,DM)=>{"use strict";Object.defineProperty(Ap,"__esModule",{value:!0});Ap.default=_he;var mhe=ghe(Me());function ghe(t){return t&&t.__esModule?t:{default:t}}var vhe=/^[A-Z2-7]+=*$/;function _he(t){(0,mhe.default)(t);var e=t.length;return!!(e%8===0&&vhe.test(t))}DM.exports=Ap.default;DM.exports.default=Ap.default});var wz=oe((Pp,IM)=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});Pp.default=whe;var yhe=xhe(Me());function xhe(t){return t&&t.__esModule?t:{default:t}}var bhe=/^[A-HJ-NP-Za-km-z1-9]*$/;function whe(t){return(0,yhe.default)(t),!!bhe.test(t)}IM.exports=Pp.default;IM.exports.default=Pp.default});var Sz=oe((Rp,kM)=>{"use strict";Object.defineProperty(Rp,"__esModule",{value:!0});Rp.default=Ahe;var She=Che(Me());function Che(t){return t&&t.__esModule?t:{default:t}}var Ehe=/^[a-z]+\/[a-z0-9\-\+]+$/i,Mhe=/^[a-z\-]+=[a-z0-9\-]+$/i,The=/^[a-z0-9!\$&'\(\)\*\+,;=\-\._~:@\/\?%\s]*$/i;function Ahe(t){(0,She.default)(t);var e=t.split(",");if(e.length<2)return!1;var i=e.shift().trim().split(";"),r=i.shift();if(r.substr(0,5)!=="data:")return!1;var n=r.substr(5);if(n!==""&&!Ehe.test(n))return!1;for(var o=0;o<i.length;o++)if(!(o===i.length-1&&i[o].toLowerCase()==="base64")&&!Mhe.test(i[o]))return!1;for(var a=0;a<e.length;a++)if(!The.test(e[a]))return!1;return!0}kM.exports=Rp.default;kM.exports.default=Rp.default});var Cz=oe((Lp,FM)=>{"use strict";Object.defineProperty(Lp,"__esModule",{value:!0});Lp.default=Ohe;var Phe=Rhe(Me());function Rhe(t){return t&&t.__esModule?t:{default:t}}var Lhe=/^magnet:\?xt(?:\.1)?=urn:(?:aich|bitprint|btih|ed2k|ed2khash|kzhash|md5|sha1|tree:tiger):[a-z0-9]{32}(?:[a-z0-9]{8})?($|&)/i;function Ohe(t){return(0,Phe.default)(t),Lhe.test(t.trim())}FM.exports=Lp.default;FM.exports.default=Lp.default});var Ez=oe((Op,BM)=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.default=Nhe;var Dhe=Ihe(Me());function Ihe(t){return t&&t.__esModule?t:{default:t}}var khe=/^(application|audio|font|image|message|model|multipart|text|video)\/[a-zA-Z0-9\.\-\+]{1,100}$/i,Fhe=/^text\/[a-zA-Z0-9\.\-\+]{1,100};\s?charset=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?$/i,Bhe=/^multipart\/[a-zA-Z0-9\.\-\+]{1,100}(;\s?(boundary|charset)=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?){0,2}$/i;function Nhe(t){return(0,Dhe.default)(t),khe.test(t)||Fhe.test(t)||Bhe.test(t)}BM.exports=Op.default;BM.exports.default=Op.default});var Tz=oe((Dp,NM)=>{"use strict";Object.defineProperty(Dp,"__esModule",{value:!0});Dp.default=qhe;var Uhe=Mz(Me()),zhe=Mz(an());function Mz(t){return t&&t.__esModule?t:{default:t}}var Ghe=/^\(?[+-]?(90(\.0+)?|[1-8]?\d(\.\d+)?)$/,Hhe=/^\s?[+-]?(180(\.0+)?|1[0-7]\d(\.\d+)?|\d{1,2}(\.\d+)?)\)?$/,Whe=/^(([1-8]?\d)\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|90\D+0\D+0)\D+[NSns]?$/i,Vhe=/^\s*([1-7]?\d{1,2}\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|180\D+0\D+0)\D+[EWew]?$/i,jhe={checkDMS:!1};function qhe(t,e){if((0,Uhe.default)(t),e=(0,zhe.default)(e,jhe),!t.includes(","))return!1;var i=t.split(",");return i[0].startsWith("(")&&!i[1].endsWith(")")||i[1].endsWith(")")&&!i[0].startsWith("(")?!1:e.checkDMS?Whe.test(i[0])&&Vhe.test(i[1]):Ghe.test(i[0])&&Hhe.test(i[1])}NM.exports=Dp.default;NM.exports.default=Dp.default});var Az=oe(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.default=Qhe;Ip.locales=void 0;var Xhe=Yhe(Me());function Yhe(t){return t&&t.__esModule?t:{default:t}}var Zhe=/^\d{3}$/,An=/^\d{4}$/,jr=/^\d{5}$/,UM=/^\d{6}$/,xu={AD:/^AD\d{3}$/,AT:An,AU:An,AZ:/^AZ\d{4}$/,BE:An,BG:An,BR:/^\d{5}-\d{3}$/,BY:/2[1-4]{1}\d{4}$/,CA:/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][\s\-]?\d[ABCEGHJ-NPRSTV-Z]\d$/i,CH:An,CN:/^(0[1-7]|1[012356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[1-5]|8[1345]|9[09])\d{4}$/,CZ:/^\d{3}\s?\d{2}$/,DE:jr,DK:An,DO:jr,DZ:jr,EE:jr,ES:/^(5[0-2]{1}|[0-4]{1}\d{1})\d{3}$/,FI:jr,FR:/^\d{2}\s?\d{3}$/,GB:/^(gir\s?0aa|[a-z]{1,2}\d[\da-z]?\s?(\d[a-z]{2})?)$/i,GR:/^\d{3}\s?\d{2}$/,HR:/^([1-5]\d{4}$)/,HT:/^HT\d{4}$/,HU:An,ID:jr,IE:/^(?!.*(?:o))[A-Za-z]\d[\dw]\s\w{4}$/i,IL:/^(\d{5}|\d{7})$/,IN:/^((?!10|29|35|54|55|65|66|86|87|88|89)[1-9][0-9]{5})$/,IR:/\b(?!(\d)\1{3})[13-9]{4}[1346-9][013-9]{5}\b/,IS:Zhe,IT:jr,JP:/^\d{3}\-\d{4}$/,KE:jr,KR:/^(\d{5}|\d{6})$/,LI:/^(948[5-9]|949[0-7])$/,LT:/^LT\-\d{5}$/,LU:An,LV:/^LV\-\d{4}$/,LK:jr,MX:jr,MT:/^[A-Za-z]{3}\s{0,1}\d{4}$/,MY:jr,NL:/^\d{4}\s?[a-z]{2}$/i,NO:An,NP:/^(10|21|22|32|33|34|44|45|56|57)\d{3}$|^(977)$/i,NZ:An,PL:/^\d{2}\-\d{3}$/,PR:/^00[679]\d{2}([ -]\d{4})?$/,PT:/^\d{4}\-\d{3}?$/,RO:UM,RU:UM,SA:jr,SE:/^[1-9]\d{2}\s?\d{2}$/,SG:UM,SI:An,SK:/^\d{3}\s?\d{2}$/,TH:jr,TN:An,TW:/^\d{3}(\d{2})?$/,UA:jr,US:/^\d{5}(-\d{4})?$/,ZA:An,ZM:jr},Khe=Object.keys(xu);Ip.locales=Khe;function Qhe(t,e){if((0,Xhe.default)(t),e in xu)return xu[e].test(t);if(e==="any"){for(var i in xu)if(xu.hasOwnProperty(i)){var r=xu[i];if(r.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}});var GM=oe((kp,zM)=>{"use strict";Object.defineProperty(kp,"__esModule",{value:!0});kp.default=eue;var Jhe=$he(Me());function $he(t){return t&&t.__esModule?t:{default:t}}function eue(t,e){(0,Jhe.default)(t);var i=e?new RegExp("^[".concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+"),"g"):/^\s+/g;return t.replace(i,"")}zM.exports=kp.default;zM.exports.default=kp.default});var WM=oe((Fp,HM)=>{"use strict";Object.defineProperty(Fp,"__esModule",{value:!0});Fp.default=rue;var tue=iue(Me());function iue(t){return t&&t.__esModule?t:{default:t}}function rue(t,e){if((0,tue.default)(t),e){var i=new RegExp("[".concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+$"),"g");return t.replace(i,"")}for(var r=t.length-1;/\s/.test(t.charAt(r));)r-=1;return t.slice(0,r+1)}HM.exports=Fp.default;HM.exports.default=Fp.default});var Rz=oe((Bp,VM)=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});Bp.default=oue;var nue=Pz(WM()),sue=Pz(GM());function Pz(t){return t&&t.__esModule?t:{default:t}}function oue(t,e){return(0,nue.default)((0,sue.default)(t,e),e)}VM.exports=Bp.default;VM.exports.default=Bp.default});var Lz=oe((Np,jM)=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.default=hue;var aue=lue(Me());function lue(t){return t&&t.__esModule?t:{default:t}}function hue(t){return(0,aue.default)(t),t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")}jM.exports=Np.default;jM.exports.default=Np.default});var Oz=oe((Up,qM)=>{"use strict";Object.defineProperty(Up,"__esModule",{value:!0});Up.default=fue;var uue=cue(Me());function cue(t){return t&&t.__esModule?t:{default:t}}function fue(t){return(0,uue.default)(t),t.replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`").replace(/&amp;/g,"&")}qM.exports=Up.default;qM.exports.default=Up.default});var YM=oe((zp,XM)=>{"use strict";Object.defineProperty(zp,"__esModule",{value:!0});zp.default=mue;var due=pue(Me());function pue(t){return t&&t.__esModule?t:{default:t}}function mue(t,e){return(0,due.default)(t),t.replace(new RegExp("[".concat(e,"]+"),"g"),"")}XM.exports=zp.default;XM.exports.default=zp.default});var Iz=oe((Gp,ZM)=>{"use strict";Object.defineProperty(Gp,"__esModule",{value:!0});Gp.default=_ue;var gue=Dz(Me()),vue=Dz(YM());function Dz(t){return t&&t.__esModule?t:{default:t}}function _ue(t,e){(0,gue.default)(t);var i=e?"\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F":"\\x00-\\x1F\\x7F";return(0,vue.default)(t,i)}ZM.exports=Gp.default;ZM.exports.default=Gp.default});var kz=oe((Hp,KM)=>{"use strict";Object.defineProperty(Hp,"__esModule",{value:!0});Hp.default=bue;var yue=xue(Me());function xue(t){return t&&t.__esModule?t:{default:t}}function bue(t,e){return(0,yue.default)(t),t.replace(new RegExp("[^".concat(e,"]+"),"g"),"")}KM.exports=Hp.default;KM.exports.default=Hp.default});var Fz=oe((Wp,QM)=>{"use strict";Object.defineProperty(Wp,"__esModule",{value:!0});Wp.default=Cue;var wue=Sue(Me());function Sue(t){return t&&t.__esModule?t:{default:t}}function Cue(t,e){(0,wue.default)(t);for(var i=t.length-1;i>=0;i--)if(e.indexOf(t[i])===-1)return!1;return!0}QM.exports=Wp.default;QM.exports.default=Wp.default});var Bz=oe((Vp,JM)=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});Vp.default=Due;var Eue=Mue(an());function Mue(t){return t&&t.__esModule?t:{default:t}}var Tue={all_lowercase:!0,gmail_lowercase:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0,gmail_convert_googlemaildotcom:!0,outlookdotcom_lowercase:!0,outlookdotcom_remove_subaddress:!0,yahoo_lowercase:!0,yahoo_remove_subaddress:!0,yandex_lowercase:!0,icloud_lowercase:!0,icloud_remove_subaddress:!0},Aue=["icloud.com","me.com"],Pue=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"],Rue=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"],Lue=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function Oue(t){return t.length>1?t:""}function Due(t,e){e=(0,Eue.default)(e,Tue);var i=t.split("@"),r=i.pop(),n=i.join("@"),o=[n,r];if(o[1]=o[1].toLowerCase(),o[1]==="gmail.com"||o[1]==="googlemail.com"){if(e.gmail_remove_subaddress&&(o[0]=o[0].split("+")[0]),e.gmail_remove_dots&&(o[0]=o[0].replace(/\.+/g,Oue)),!o[0].length)return!1;(e.all_lowercase||e.gmail_lowercase)&&(o[0]=o[0].toLowerCase()),o[1]=e.gmail_convert_googlemaildotcom?"gmail.com":o[1]}else if(Aue.indexOf(o[1])>=0){if(e.icloud_remove_subaddress&&(o[0]=o[0].split("+")[0]),!o[0].length)return!1;(e.all_lowercase||e.icloud_lowercase)&&(o[0]=o[0].toLowerCase())}else if(Pue.indexOf(o[1])>=0){if(e.outlookdotcom_remove_subaddress&&(o[0]=o[0].split("+")[0]),!o[0].length)return!1;(e.all_lowercase||e.outlookdotcom_lowercase)&&(o[0]=o[0].toLowerCase())}else if(Rue.indexOf(o[1])>=0){if(e.yahoo_remove_subaddress){var a=o[0].split("-");o[0]=a.length>1?a.slice(0,-1).join("-"):a[0]}if(!o[0].length)return!1;(e.all_lowercase||e.yahoo_lowercase)&&(o[0]=o[0].toLowerCase())}else Lue.indexOf(o[1])>=0?((e.all_lowercase||e.yandex_lowercase)&&(o[0]=o[0].toLowerCase()),o[1]="yandex.ru"):e.all_lowercase&&(o[0]=o[0].toLowerCase());return o.join("@")}JM.exports=Vp.default;JM.exports.default=Vp.default});var Nz=oe((jp,$M)=>{"use strict";Object.defineProperty(jp,"__esModule",{value:!0});jp.default=Bue;var Iue=kue(Me());function kue(t){return t&&t.__esModule?t:{default:t}}var Fue=/^[^\s-_](?!.*?[-_]{2,})[a-z0-9-\\][^\s]*[^-_\s]$/;function Bue(t){return(0,Iue.default)(t),Fue.test(t)}$M.exports=jp.default;$M.exports.default=jp.default});var Uz=oe((qp,eT)=>{"use strict";Object.defineProperty(qp,"__esModule",{value:!0});qp.default=zue;var Nue=Uue(Me());function Uue(t){return t&&t.__esModule?t:{default:t}}var z_={"cs-CZ":function(e){return/^(([ABCDEFHKIJKLMNPRSTUVXYZ]|[0-9])-?){5,8}$/.test(e)},"de-DE":function(e){return/^((AW|UL|AK|GA|A|LF|AZ|AM|AS|ZE|AN|AB|A|KG|KH|BA|EW|BZ|HY|KM|BT|HP|B|BC|BI|BO|FN|TT|B|BN|AH|BS|FR|HB|ZZ|BB|BK|B|OC|OK|CW|CE|C|CO|LH|CB|KW|LC|LN|DA|DI|DE|DH|SY|N|DO|DD|DU|DN|D|EI|EA|EE|FI|EM|EL|EN|PF|ED|EF|ER|AU|ZP|E|ES|NT|EU|FL|FO|FT|FF|F|FS|FD|F|GE|G|GI|GF|GS|ZR|GG|GP|GR|NY|ZI|G|GZ|GT|HA|HH|HM|HU|WL|HZ|WR|RN|HK|HD|HN|HS|GK|HE|HF|RZ|HI|HG|HO|HX|IK|IL|IN|J|JL|KL|KA|KS|KF|KE|KI|KT|KO|KN|KR|KC|KU|K|LD|LL|LA|L|OP|LM|LI|LB|LU|L|HL|LG|MD|GN|MZ|MA|ML|MR|MY|AT|DM|MC|NZ|RM|RG|MM|ME|MB|MI|FG|DL|HC|MW|RL|MK|MG|M|WS|MH|M|MS|NU|NB|ND|NM|NK|NW|NR|NI|NF|DZ|EB|OZ|TG|TO|N|OA|GM|OB|CA|EH|FW|OF|OL|OE|OG|BH|LR|OS|AA|GD|OH|KY|NP|WK|PB|PA|PE|PI|PS|P|PM|PR|RA|RV|RE|R|H|SB|WN|RS|RD|RT|BM|NE|GV|RP|SU|GL|RO|G|RH|EG|RW|PN|SK|MQ|RU|SZ|RI|SL|SM|SC|HR|FZ|VS|SW|SN|CR|SE|SI|SO|LP|SG|NH|SP|IZ|ST|BF|TE|HV|OD|SR|S|AC|DW|ZW|TF|TS|TR|T|UM|PZ|TP|UE|UN|UH|MN|KK|VB|V|AE|PL|RC|VG|GW|PW|VR|VK|KB|WA|WT|BE|WM|WE|AP|MO|WW|FB|WZ|WI|WB|JE|WF|WO|W|W|BL|Z|GC)[- ]?[A-Z]{1,2}[- ]?\d{1,4}|(AIC|FDB|ABG|SLN|SAW|KLZ|BUL|ESB|NAB|SUL|WST|ABI|AZE|BTF|KT|DKB|FEU|ROT|ALZ|SM|WER|AUR|NOR|DW|BRK|HAB|TL|WOR|BAD|BAR|BER|BIW|EBS|KEM|MB|PEG|BGL|BGD|REI|WIL|BKS|BIR|WAT|BOR|BOH|BOT|BRB|BLK|HHM|NEB|NMB|WSF|LEO|HDL|WMS|WZL|BS|CHA|KZ|ROD|WM|CLP|NEC|COC|ZEL|COE|CUX|DAH|LDS|DEG|DEL|RSL|DLG|DGF|LAN|HEI|MED|DON|KIB|ROK|JL|MON|SLE|EBE|EIC|HIG|WBS|BIT|PR|LIB|EMD|WIT|ERH|HS|ERZ|ANA|ASZ|MAB|MEK|STL|SZB|FDS|HCH|HOR|WOL|FRG|GRA|WOS|FRI|FFB|GAP|GER|BRL|CLZ|GTH|NOH|HGW|GRZ|LB|NOL|WSW|DUD|HM|OHA|KRU|HAL|HAM|HBS|QLB|HVL|NAU|HAS|EBN|GEO|HOH|HDH|ERK|HER|WAN|HEF|ROF|HBN|ALF|HSK|USI|NAI|REH|SAN|KN|HR|HOL|WAR|ARN|BRG|GNT|HOG|WOH|KEH|MAI|PAR|RID|ROL|KLE|GEL|KUS|KYF|ART|SDH|LDK|DIL|MAL|VIB|LER|BNA|GHA|GRM|MTL|WUR|LEV|LIF|STE|WEL|LIP|VAI|LUP|HGN|LBZ|LWL|PCH|STB|DAN|MKK|SL|MSP|TBB|MGH|MTK|BIN|MSH|EIL|HET|SGH|BID|MYK|MSE|MST|MR|WRN|MEI|GRH|RIE|MZG|MIL|OBB|BED|FL|MOL|FRW|SEE|SRB|AIB|MOS|BCH|ILL|SOB|NMS|NEA|SEF|UFF|NEW|VOH|NDH|TDO|NWM|GDB|GVM|WIS|NOM|EIN|GAN|LAU|HEB|OHV|OSL|SFB|ERB|LOS|BSK|KEL|BSB|MEL|WTL|OAL|FS|MOD|OHZ|OPR|BR|PAF|PL|CAS|GLA|REG|VIT|ECK|SIM|GOA|EMS|DIZ|GOH|RD|SWA|NES|KN|MET|LRO|BZ|DBR|ROS|TET|HRO|ROW|BRV|HIP|PAN|GRI|SHK|EIS|SRO|SOK|LBS|SCZ|MER|QFT|SLF|SLS|HOM|SLK|ASL|BBG|SBK|SFT|SHG|MGN|MEG|ZIG|SAD|NEN|OVI|SHA|BLB|SIG|SON|SPN|FOR|GUB|SPB|IGB|WND|STD|STA|SDL|OBG|HST|BOG|SHL|PIR|FTL|SEB|SM|SW|TIR|SAB|TUT|ANG|SDT|LN|LSZ|MHL|VEC|VER|VIE|OVL|ANK|OVP|SBG|UEM|UER|WLG|GMN|NVP|RDG|RG|DAU|FKB|WAF|WAK|SLZ|WEN|SOG|APD|WUG|GUN|ESW|WIZ|WES|DIN|BRA|BD|WHV|HWI|GHC|WTM|WOB|WUN|MAK|SEL|OCH|HOT|WDA)[- ]?(([A-Z][- ]?\d{1,4})|([A-Z]{2}[- ]?\d{1,3})))[- ]?(E|H)?$/.test(e)},"de-LI":function(e){return/^FL[- ]?\d{1,5}[UZ]?$/.test(e)},"fi-FI":function(e){return/^(?=.{4,7})(([A-Z]{1,3}|[0-9]{1,3})[\s-]?([A-Z]{1,3}|[0-9]{1,5}))$/.test(e)},"pt-PT":function(e){return/^([A-Z]{2}|[0-9]{2})[ -]?([A-Z]{2}|[0-9]{2})[ -]?([A-Z]{2}|[0-9]{2})$/.test(e)},"sq-AL":function(e){return/^[A-Z]{2}[- ]?((\d{3}[- ]?(([A-Z]{2})|T))|(R[- ]?\d{3}))$/.test(e)},"pt-BR":function(e){return/^[A-Z]{3}[ -]?[0-9][A-Z][0-9]{2}|[A-Z]{3}[ -]?[0-9]{4}$/.test(e)}};function zue(t,e){if((0,Nue.default)(t),e in z_)return z_[e](t);if(e==="any"){for(var i in z_){var r=z_[i];if(r(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}eT.exports=qp.default;eT.exports.default=qp.default});var Gz=oe((Xp,tT)=>{"use strict";Object.defineProperty(Xp,"__esModule",{value:!0});Xp.default=Que;var Gue=zz(an()),Hue=zz(Me());function zz(t){return t&&t.__esModule?t:{default:t}}var Wue=/^[A-Z]$/,Vue=/^[a-z]$/,jue=/^[0-9]$/,que=/^[-#!$@%^&*()_+|~=`{}\[\]:";'<>?,.\/ ]$/,Xue={minLength:8,minLowercase:1,minUppercase:1,minNumbers:1,minSymbols:1,returnScore:!1,pointsPerUnique:1,pointsPerRepeat:.5,pointsForContainingLower:10,pointsForContainingUpper:10,pointsForContainingNumber:10,pointsForContainingSymbol:10};function Yue(t){var e={};return Array.from(t).forEach(function(i){var r=e[i];r?e[i]+=1:e[i]=1}),e}function Zue(t){var e=Yue(t),i={length:t.length,uniqueChars:Object.keys(e).length,uppercaseCount:0,lowercaseCount:0,numberCount:0,symbolCount:0};return Object.keys(e).forEach(function(r){Wue.test(r)?i.uppercaseCount+=e[r]:Vue.test(r)?i.lowercaseCount+=e[r]:jue.test(r)?i.numberCount+=e[r]:que.test(r)&&(i.symbolCount+=e[r])}),i}function Kue(t,e){var i=0;return i+=t.uniqueChars*e.pointsPerUnique,i+=(t.length-t.uniqueChars)*e.pointsPerRepeat,t.lowercaseCount>0&&(i+=e.pointsForContainingLower),t.uppercaseCount>0&&(i+=e.pointsForContainingUpper),t.numberCount>0&&(i+=e.pointsForContainingNumber),t.symbolCount>0&&(i+=e.pointsForContainingSymbol),i}function Que(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;(0,Hue.default)(t);var i=Zue(t);return e=(0,Gue.default)(e||{},Xue),e.returnScore?Kue(i,e):i.length>=e.minLength&&i.lowercaseCount>=e.minLowercase&&i.uppercaseCount>=e.minUppercase&&i.numberCount>=e.minNumbers&&i.symbolCount>=e.minSymbols}tT.exports=Xp.default;tT.exports.default=Xp.default});var Wz=oe(Yp=>{"use strict";Object.defineProperty(Yp,"__esModule",{value:!0});Yp.default=$ue;Yp.vatMatchers=void 0;var Hz=Jue(Me());function Jue(t){return t&&t.__esModule?t:{default:t}}var iT={GB:/^GB((\d{3} \d{4} ([0-8][0-9]|9[0-6]))|(\d{9} \d{3})|(((GD[0-4])|(HA[5-9]))[0-9]{2}))$/,IT:/^(IT)?[0-9]{11}$/,NL:/^(NL)?[0-9]{9}B[0-9]{2}$/};Yp.vatMatchers=iT;function $ue(t,e){if((0,Hz.default)(t),(0,Hz.default)(e),e in iT)return iT[e].test(t);throw new Error("Invalid country code: '".concat(e,"'"))}});var Qz=oe((wu,rT)=>{"use strict";function G_(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?G_=function(i){return typeof i}:G_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},G_(t)}Object.defineProperty(wu,"__esModule",{value:!0});wu.default=void 0;var ece=Te(w_()),tce=Te(rE()),ice=Te(S4()),rce=Te(C4()),nce=Te(E4()),sce=Te(T4()),oce=Te(A4()),ace=Te(O4()),lce=Te(F4()),hce=Te(B4()),uce=Te(vd()),cce=Te(H4()),fce=Te(L_()),dce=Te(CE()),pce=Te(Y4()),mce=Te(Z4()),Vz=bu(K4()),jz=bu(Q4()),gce=Te(J4()),vce=Te(e5()),_ce=Te(t5()),yce=Te(i5()),xce=Te(r5()),bce=Te(n5()),wce=Te(s5()),Sce=Te(BE()),Cce=Te(NE()),Ece=Te(l5()),Mce=Te(h5()),Tce=Te(f5()),Ace=Te(d5()),Pce=Te(D_()),qz=bu(tE()),Rce=Te(g5()),Lce=Te(YE()),Oce=Te(v5()),Dce=Te(y5()),Ice=Te(x5()),kce=Te(S5()),Fce=Te(C5()),Bce=Te(E5()),Xz=bu(M5()),Nce=Te(A5()),Uce=Te(P5()),zce=Te(R5()),Gce=Te(D5()),Hce=Te(k5()),Wce=Te(B5()),Vce=Te(N5()),jce=Te(pE()),qce=Te(U5()),Xce=Te(G5()),Yce=Te(V5()),Zce=Te(X5()),Kce=Te(Z5()),Qce=Te(K5()),Jce=Te(J5()),$ce=Te($5()),efe=Te(ez()),tfe=Te(tz()),ife=Te(iz()),rfe=Te(lz()),Yz=bu(hz()),nfe=Te(uz()),sfe=Te(fz()),ofe=Te(dz()),afe=Te(pz()),lfe=Te(vz()),hfe=Te(iM()),ufe=Te(_z()),cfe=Te(xz()),ffe=Te(bz()),dfe=Te(wz()),pfe=Te(aM()),mfe=Te(Sz()),gfe=Te(Cz()),vfe=Te(Ez()),_fe=Te(Tz()),Zz=bu(Az()),yfe=Te(GM()),xfe=Te(WM()),bfe=Te(Rz()),wfe=Te(Lz()),Sfe=Te(Oz()),Cfe=Te(Iz()),Efe=Te(kz()),Mfe=Te(YM()),Tfe=Te(Fz()),Afe=Te(Bz()),Pfe=Te(Nz()),Rfe=Te(Uz()),Lfe=Te(Gz()),Ofe=Te(Wz());function Kz(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return Kz=function(){return t},t}function bu(t){if(t&&t.__esModule)return t;if(t===null||G_(t)!=="object"&&typeof t!="function")return{default:t};var e=Kz();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function Te(t){return t&&t.__esModule?t:{default:t}}var Dfe="13.7.0",Ife={version:Dfe,toDate:ece.default,toFloat:tce.default,toInt:ice.default,toBoolean:rce.default,equals:nce.default,contains:sce.default,matches:oce.default,isEmail:ace.default,isURL:lce.default,isMACAddress:hce.default,isIP:uce.default,isIPRange:cce.default,isFQDN:fce.default,isBoolean:pce.default,isIBAN:Xz.default,isBIC:Nce.default,isAlpha:Vz.default,isAlphaLocales:Vz.locales,isAlphanumeric:jz.default,isAlphanumericLocales:jz.locales,isNumeric:gce.default,isPassportNumber:vce.default,isPort:_ce.default,isLowercase:yce.default,isUppercase:xce.default,isAscii:wce.default,isFullWidth:Sce.default,isHalfWidth:Cce.default,isVariableWidth:Ece.default,isMultibyte:Mce.default,isSemVer:Tce.default,isSurrogatePair:Ace.default,isInt:Pce.default,isIMEI:bce.default,isFloat:qz.default,isFloatLocales:qz.locales,isDecimal:Rce.default,isHexadecimal:Lce.default,isOctal:Oce.default,isDivisibleBy:Dce.default,isHexColor:Ice.default,isRgbColor:kce.default,isHSL:Fce.default,isISRC:Bce.default,isMD5:Uce.default,isHash:zce.default,isJWT:Gce.default,isJSON:Hce.default,isEmpty:Wce.default,isLength:Vce.default,isLocale:mce.default,isByteLength:jce.default,isUUID:qce.default,isMongoId:Xce.default,isAfter:Yce.default,isBefore:Zce.default,isIn:Kce.default,isCreditCard:Qce.default,isIdentityCard:Jce.default,isEAN:$ce.default,isISIN:efe.default,isISBN:tfe.default,isISSN:ife.default,isMobilePhone:Yz.default,isMobilePhoneLocales:Yz.locales,isPostalCode:Zz.default,isPostalCodeLocales:Zz.locales,isEthereumAddress:nfe.default,isCurrency:sfe.default,isBtcAddress:ofe.default,isISO8601:afe.default,isRFC3339:lfe.default,isISO31661Alpha2:hfe.default,isISO31661Alpha3:ufe.default,isISO4217:cfe.default,isBase32:ffe.default,isBase58:dfe.default,isBase64:pfe.default,isDataURI:mfe.default,isMagnetURI:gfe.default,isMimeType:vfe.default,isLatLong:_fe.default,ltrim:yfe.default,rtrim:xfe.default,trim:bfe.default,escape:wfe.default,unescape:Sfe.default,stripLow:Cfe.default,whitelist:Efe.default,blacklist:Mfe.default,isWhitelisted:Tfe.default,normalizeEmail:Afe.default,toString,isSlug:Pfe.default,isStrongPassword:Lfe.default,isTaxID:rfe.default,isDate:dce.default,isLicensePlate:Rfe.default,isVAT:Ofe.default,ibanLocales:Xz.locales},kfe=Ife;wu.default=kfe;rT.exports=wu.default;rT.exports.default=wu.default});var bT=oe((JIe,RG)=>{"use strict";function hG(t,e){return function(){return t.apply(e,arguments)}}var{toString:Ffe}=Object.prototype,{getPrototypeOf:gT}=Object,j_=(t=>e=>{let i=Ffe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Ks=t=>(t=t.toLowerCase(),e=>j_(e)===t),q_=t=>e=>typeof e===t,{isArray:Mu}=Array,Kp=q_("undefined");function Bfe(t){return t!==null&&!Kp(t)&&t.constructor!==null&&!Kp(t.constructor)&&Zn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}var uG=Ks("ArrayBuffer");function Nfe(t){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&uG(t.buffer),e}var Ufe=q_("string"),Zn=q_("function"),cG=q_("number"),X_=t=>t!==null&&typeof t=="object",zfe=t=>t===!0||t===!1,H_=t=>{if(j_(t)!=="object")return!1;let e=gT(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Gfe=Ks("Date"),Hfe=Ks("File"),Wfe=Ks("Blob"),Vfe=Ks("FileList"),jfe=t=>X_(t)&&Zn(t.pipe),qfe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Zn(t.append)&&((e=j_(t))==="formdata"||e==="object"&&Zn(t.toString)&&t.toString()==="[object FormData]"))},Xfe=Ks("URLSearchParams"),Yfe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qp(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t=="undefined")return;let r,n;if(typeof t!="object"&&(t=[t]),Mu(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{let o=i?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length,l;for(r=0;r<a;r++)l=o[r],e.call(null,t[l],l,t)}}function fG(t,e){e=e.toLowerCase();let i=Object.keys(t),r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}var dG=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,pG=t=>!Kp(t)&&t!==dG;function hT(){let{caseless:t}=pG(this)&&this||{},e={},i=(r,n)=>{let o=t&&fG(e,n)||n;H_(e[o])&&H_(r)?e[o]=hT(e[o],r):H_(r)?e[o]=hT({},r):Mu(r)?e[o]=r.slice():e[o]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&Qp(arguments[r],i);return e}var Zfe=(t,e,i,{allOwnKeys:r}={})=>(Qp(e,(n,o)=>{i&&Zn(n)?t[o]=hG(n,i):t[o]=n},{allOwnKeys:r}),t),Kfe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Qfe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Jfe=(t,e,i,r)=>{let n,o,a,l={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),o=n.length;o-- >0;)a=n[o],(!r||r(a,t,e))&&!l[a]&&(e[a]=t[a],l[a]=!0);t=i!==!1&&gT(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},$fe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;let r=t.indexOf(e,i);return r!==-1&&r===i},ede=t=>{if(!t)return null;if(Mu(t))return t;let e=t.length;if(!cG(e))return null;let i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},tde=(t=>e=>t&&e instanceof t)(typeof Uint8Array!="undefined"&&gT(Uint8Array)),ide=(t,e)=>{let r=(t&&t[Symbol.iterator]).call(t),n;for(;(n=r.next())&&!n.done;){let o=n.value;e.call(t,o[0],o[1])}},rde=(t,e)=>{let i,r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},nde=Ks("HTMLFormElement"),sde=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),Jz=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),ode=Ks("RegExp"),mG=(t,e)=>{let i=Object.getOwnPropertyDescriptors(t),r={};Qp(i,(n,o)=>{let a;(a=e(n,o,t))!==!1&&(r[o]=a||n)}),Object.defineProperties(t,r)},ade=t=>{mG(t,(e,i)=>{if(Zn(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let r=t[i];if(Zn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},lde=(t,e)=>{let i={},r=n=>{n.forEach(o=>{i[o]=!0})};return Mu(t)?r(t):r(String(t).split(e)),i},hde=()=>{},ude=(t,e)=>(t=+t,Number.isFinite(t)?t:e),sT="abcdefghijklmnopqrstuvwxyz",$z="0123456789",gG={DIGIT:$z,ALPHA:sT,ALPHA_DIGIT:sT+sT.toUpperCase()+$z},cde=(t=16,e=gG.ALPHA_DIGIT)=>{let i="",{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function fde(t){return!!(t&&Zn(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}var dde=t=>{let e=new Array(10),i=(r,n)=>{if(X_(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;let o=Mu(r)?[]:{};return Qp(r,(a,l)=>{let h=i(a,n+1);!Kp(h)&&(o[l]=h)}),e[n]=void 0,o}}return r};return i(t,0)},pde=Ks("AsyncFunction"),mde=t=>t&&(X_(t)||Zn(t))&&Zn(t.then)&&Zn(t.catch),ve={isArray:Mu,isArrayBuffer:uG,isBuffer:Bfe,isFormData:qfe,isArrayBufferView:Nfe,isString:Ufe,isNumber:cG,isBoolean:zfe,isObject:X_,isPlainObject:H_,isUndefined:Kp,isDate:Gfe,isFile:Hfe,isBlob:Wfe,isRegExp:ode,isFunction:Zn,isStream:jfe,isURLSearchParams:Xfe,isTypedArray:tde,isFileList:Vfe,forEach:Qp,merge:hT,extend:Zfe,trim:Yfe,stripBOM:Kfe,inherits:Qfe,toFlatObject:Jfe,kindOf:j_,kindOfTest:Ks,endsWith:$fe,toArray:ede,forEachEntry:ide,matchAll:rde,isHTMLForm:nde,hasOwnProperty:Jz,hasOwnProp:Jz,reduceDescriptors:mG,freezeMethods:ade,toObjectSet:lde,toCamelCase:sde,noop:hde,toFiniteNumber:ude,findKey:fG,global:dG,isContextDefined:pG,ALPHABET:gG,generateString:cde,isSpecCompliantForm:fde,toJSONObject:dde,isAsyncFn:pde,isThenable:mde};function Ht(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}ve.inherits(Ht,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ve.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var vG=Ht.prototype,_G={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{_G[t]={value:t}});Object.defineProperties(Ht,_G);Object.defineProperty(vG,"isAxiosError",{value:!0});Ht.from=(t,e,i,r,n,o)=>{let a=Object.create(vG);return ve.toFlatObject(t,a,function(h){return h!==Error.prototype},l=>l!=="isAxiosError"),Ht.call(a,t.message,e,i,r,n),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};var gde=null;function uT(t){return ve.isPlainObject(t)||ve.isArray(t)}function yG(t){return ve.endsWith(t,"[]")?t.slice(0,-2):t}function eG(t,e,i){return t?t.concat(e).map(function(n,o){return n=yG(n),!i&&o?"["+n+"]":n}).join(i?".":""):e}function vde(t){return ve.isArray(t)&&!t.some(uT)}var _de=ve.toFlatObject(ve,{},null,function(e){return/^is[A-Z]/.test(e)});function Y_(t,e,i){if(!ve.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=ve.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,g){return!ve.isUndefined(g[v])});let r=i.metaTokens,n=i.visitor||c,o=i.dots,a=i.indexes,h=(i.Blob||typeof Blob!="undefined"&&Blob)&&ve.isSpecCompliantForm(e);if(!ve.isFunction(n))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if(ve.isDate(p))return p.toISOString();if(!h&&ve.isBlob(p))throw new Ht("Blob is not supported. Use a Buffer instead.");return ve.isArrayBuffer(p)||ve.isTypedArray(p)?h&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,v,g){let _=p;if(p&&!g&&typeof p=="object"){if(ve.endsWith(v,"{}"))v=r?v:v.slice(0,-2),p=JSON.stringify(p);else if(ve.isArray(p)&&vde(p)||(ve.isFileList(p)||ve.endsWith(v,"[]"))&&(_=ve.toArray(p)))return v=yG(v),_.forEach(function(b,y){!(ve.isUndefined(b)||b===null)&&e.append(a===!0?eG([v],y,o):a===null?v:v+"[]",u(b))}),!1}return uT(p)?!0:(e.append(eG(g,v,o),u(p)),!1)}let f=[],d=Object.assign(_de,{defaultVisitor:c,convertValue:u,isVisitable:uT});function m(p,v){if(!ve.isUndefined(p)){if(f.indexOf(p)!==-1)throw Error("Circular reference detected in "+v.join("."));f.push(p),ve.forEach(p,function(_,x){(!(ve.isUndefined(_)||_===null)&&n.call(e,_,ve.isString(x)?x.trim():x,v,d))===!0&&m(_,v?v.concat(x):[x])}),f.pop()}}if(!ve.isObject(t))throw new TypeError("data must be an object");return m(t),e}function tG(t){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function vT(t,e){this._pairs=[],t&&Y_(t,this,e)}var xG=vT.prototype;xG.append=function(e,i){this._pairs.push([e,i])};xG.toString=function(e){let i=e?function(r){return e.call(this,r,tG)}:tG;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function yde(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bG(t,e,i){if(!e)return t;let r=i&&i.encode||yde,n=i&&i.serialize,o;if(n?o=n(e,i):o=ve.isURLSearchParams(e)?e.toString():new vT(e,i).toString(r),o){let a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}var cT=class{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ve.forEach(this.handlers,function(r){r!==null&&e(r)})}},iG=cT,wG={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xde=typeof URLSearchParams!="undefined"?URLSearchParams:vT,bde=typeof FormData!="undefined"?FormData:null,wde=typeof Blob!="undefined"?Blob:null,Sde={isBrowser:!0,classes:{URLSearchParams:xde,FormData:bde,Blob:wde},protocols:["http","https","file","blob","url","data"]},SG=typeof window!="undefined"&&typeof document!="undefined",Cde=(t=>SG&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator!="undefined"&&navigator.product),Ede=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Mde=Object.freeze({__proto__:null,hasBrowserEnv:SG,hasStandardBrowserWebWorkerEnv:Ede,hasStandardBrowserEnv:Cde}),Zs=Mt(Mt({},Mde),Sde);function Tde(t,e){return Y_(t,new Zs.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,o){return Zs.isNode&&ve.isBuffer(i)?(this.append(r,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Ade(t){return ve.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Pde(t){let e={},i=Object.keys(t),r,n=i.length,o;for(r=0;r<n;r++)o=i[r],e[o]=t[o];return e}function CG(t){function e(i,r,n,o){let a=i[o++];if(a==="__proto__")return!0;let l=Number.isFinite(+a),h=o>=i.length;return a=!a&&ve.isArray(n)?n.length:a,h?(ve.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!l):((!n[a]||!ve.isObject(n[a]))&&(n[a]=[]),e(i,r,n[a],o)&&ve.isArray(n[a])&&(n[a]=Pde(n[a])),!l)}if(ve.isFormData(t)&&ve.isFunction(t.entries)){let i={};return ve.forEachEntry(t,(r,n)=>{e(Ade(r),n,i,0)}),i}return null}function Rde(t,e,i){if(ve.isString(t))try{return(e||JSON.parse)(t),ve.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}var _T={transitional:wG,adapter:["xhr","http"],transformRequest:[function(e,i){let r=i.getContentType()||"",n=r.indexOf("application/json")>-1,o=ve.isObject(e);if(o&&ve.isHTMLForm(e)&&(e=new FormData(e)),ve.isFormData(e))return n?JSON.stringify(CG(e)):e;if(ve.isArrayBuffer(e)||ve.isBuffer(e)||ve.isStream(e)||ve.isFile(e)||ve.isBlob(e))return e;if(ve.isArrayBufferView(e))return e.buffer;if(ve.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Tde(e,this.formSerializer).toString();if((l=ve.isFileList(e))||r.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return Y_(l?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||n?(i.setContentType("application/json",!1),Rde(e)):e}],transformResponse:[function(e){let i=this.transitional||_T.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(e&&ve.isString(e)&&(r&&!this.responseType||n)){let a=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(l){if(a)throw l.name==="SyntaxError"?Ht.from(l,Ht.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zs.classes.FormData,Blob:Zs.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ve.forEach(["delete","get","head","post","put","patch"],t=>{_T.headers[t]={}});var yT=_T,Lde=ve.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ode=t=>{let e={},i,r,n;return t&&t.split(`
`).forEach(function(a){n=a.indexOf(":"),i=a.substring(0,n).trim().toLowerCase(),r=a.substring(n+1).trim(),!(!i||e[i]&&Lde[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},rG=Symbol("internals");function Zp(t){return t&&String(t).trim().toLowerCase()}function W_(t){return t===!1||t==null?t:ve.isArray(t)?t.map(W_):String(t)}function Dde(t){let e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}var Ide=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function oT(t,e,i,r,n){if(ve.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!ve.isString(e)){if(ve.isString(r))return e.indexOf(r)!==-1;if(ve.isRegExp(r))return r.test(e)}}function kde(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function Fde(t,e){let i=ve.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,o,a){return this[r].call(this,e,n,o,a)},configurable:!0})})}var Su=class{constructor(e){e&&this.set(e)}set(e,i,r){let n=this;function o(l,h,u){let c=Zp(h);if(!c)throw new Error("header name must be a non-empty string");let f=ve.findKey(n,c);(!f||n[f]===void 0||u===!0||u===void 0&&n[f]!==!1)&&(n[f||h]=W_(l))}let a=(l,h)=>ve.forEach(l,(u,c)=>o(u,c,h));return ve.isPlainObject(e)||e instanceof this.constructor?a(e,i):ve.isString(e)&&(e=e.trim())&&!Ide(e)?a(Ode(e),i):e!=null&&o(i,e,r),this}get(e,i){if(e=Zp(e),e){let r=ve.findKey(this,e);if(r){let n=this[r];if(!i)return n;if(i===!0)return Dde(n);if(ve.isFunction(i))return i.call(this,n,r);if(ve.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=Zp(e),e){let r=ve.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||oT(this,this[r],r,i)))}return!1}delete(e,i){let r=this,n=!1;function o(a){if(a=Zp(a),a){let l=ve.findKey(r,a);l&&(!i||oT(r,r[l],l,i))&&(delete r[l],n=!0)}}return ve.isArray(e)?e.forEach(o):o(e),n}clear(e){let i=Object.keys(this),r=i.length,n=!1;for(;r--;){let o=i[r];(!e||oT(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){let i=this,r={};return ve.forEach(this,(n,o)=>{let a=ve.findKey(r,o);if(a){i[a]=W_(n),delete i[o];return}let l=e?kde(o):String(o).trim();l!==o&&delete i[o],i[l]=W_(n),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let i=Object.create(null);return ve.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&ve.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){let r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){let r=(this[rG]=this[rG]={accessors:{}}).accessors,n=this.prototype;function o(a){let l=Zp(a);r[l]||(Fde(n,a),r[l]=!0)}return ve.isArray(e)?e.forEach(o):o(e),this}};Su.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ve.reduceDescriptors(Su.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});ve.freezeMethods(Su);var Io=Su;function aT(t,e){let i=this||yT,r=e||i,n=Io.from(r.headers),o=r.data;return ve.forEach(t,function(l){o=l.call(i,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function EG(t){return!!(t&&t.__CANCEL__)}function Jp(t,e,i){Ht.call(this,t==null?"canceled":t,Ht.ERR_CANCELED,e,i),this.name="CanceledError"}ve.inherits(Jp,Ht,{__CANCEL__:!0});function Bde(t,e,i){let r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Ht("Request failed with status code "+i.status,[Ht.ERR_BAD_REQUEST,Ht.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}var Nde=Zs.hasStandardBrowserEnv?{write(t,e,i,r,n,o){let a=[t+"="+encodeURIComponent(e)];ve.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),ve.isString(r)&&a.push("path="+r),ve.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){let e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ude(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function zde(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function MG(t,e){return t&&!Ude(e)?zde(t,e):e}var Gde=Zs.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a"),r;function n(o){let a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(a){let l=ve.isString(a)?n(a):a;return l.protocol===r.protocol&&l.host===r.host}}():function(){return function(){return!0}}();function Hde(t){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Wde(t,e){t=t||10;let i=new Array(t),r=new Array(t),n=0,o=0,a;return e=e!==void 0?e:1e3,function(h){let u=Date.now(),c=r[o];a||(a=u),i[n]=h,r[n]=u;let f=o,d=0;for(;f!==n;)d+=i[f++],f=f%t;if(n=(n+1)%t,n===o&&(o=(o+1)%t),u-a<e)return;let m=c&&u-c;return m?Math.round(d*1e3/m):void 0}}function nG(t,e){let i=0,r=Wde(50,250);return n=>{let o=n.loaded,a=n.lengthComputable?n.total:void 0,l=o-i,h=r(l),u=o<=a;i=o;let c={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:h||void 0,estimated:h&&a&&u?(a-o)/h:void 0,event:n};c[e?"download":"upload"]=!0,t(c)}}var Vde=typeof XMLHttpRequest!="undefined",jde=Vde&&function(t){return new Promise(function(i,r){let n=t.data,o=Io.from(t.headers).normalize(),{responseType:a,withXSRFToken:l}=t,h;function u(){t.cancelToken&&t.cancelToken.unsubscribe(h),t.signal&&t.signal.removeEventListener("abort",h)}let c;if(ve.isFormData(n)){if(Zs.hasStandardBrowserEnv||Zs.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((c=o.getContentType())!==!1){let[v,...g]=c?c.split(";").map(_=>_.trim()).filter(Boolean):[];o.setContentType([v||"multipart/form-data",...g].join("; "))}}let f=new XMLHttpRequest;if(t.auth){let v=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";o.set("Authorization","Basic "+btoa(v+":"+g))}let d=MG(t.baseURL,t.url);f.open(t.method.toUpperCase(),bG(d,t.params,t.paramsSerializer),!0),f.timeout=t.timeout;function m(){if(!f)return;let v=Io.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),_={data:!a||a==="text"||a==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:v,config:t,request:f};Bde(function(b){i(b),u()},function(b){r(b),u()},_),f=null}if("onloadend"in f?f.onloadend=m:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(m)},f.onabort=function(){f&&(r(new Ht("Request aborted",Ht.ECONNABORTED,t,f)),f=null)},f.onerror=function(){r(new Ht("Network Error",Ht.ERR_NETWORK,t,f)),f=null},f.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",_=t.transitional||wG;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),r(new Ht(g,_.clarifyTimeoutError?Ht.ETIMEDOUT:Ht.ECONNABORTED,t,f)),f=null},Zs.hasStandardBrowserEnv&&(l&&ve.isFunction(l)&&(l=l(t)),l||l!==!1&&Gde(d))){let v=t.xsrfHeaderName&&t.xsrfCookieName&&Nde.read(t.xsrfCookieName);v&&o.set(t.xsrfHeaderName,v)}n===void 0&&o.setContentType(null),"setRequestHeader"in f&&ve.forEach(o.toJSON(),function(g,_){f.setRequestHeader(_,g)}),ve.isUndefined(t.withCredentials)||(f.withCredentials=!!t.withCredentials),a&&a!=="json"&&(f.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&f.addEventListener("progress",nG(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&f.upload&&f.upload.addEventListener("progress",nG(t.onUploadProgress)),(t.cancelToken||t.signal)&&(h=v=>{f&&(r(!v||v.type?new Jp(null,t,f):v),f.abort(),f=null)},t.cancelToken&&t.cancelToken.subscribe(h),t.signal&&(t.signal.aborted?h():t.signal.addEventListener("abort",h)));let p=Hde(d);if(p&&Zs.protocols.indexOf(p)===-1){r(new Ht("Unsupported protocol "+p+":",Ht.ERR_BAD_REQUEST,t));return}f.send(n||null)})},fT={http:gde,xhr:jde};ve.forEach(fT,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(i){}Object.defineProperty(t,"adapterName",{value:e})}});var sG=t=>`- ${t}`,qde=t=>ve.isFunction(t)||t===null||t===!1,TG={getAdapter:t=>{t=ve.isArray(t)?t:[t];let{length:e}=t,i,r,n={};for(let o=0;o<e;o++){i=t[o];let a;if(r=i,!qde(i)&&(r=fT[(a=String(i)).toLowerCase()],r===void 0))throw new Ht(`Unknown adapter '${a}'`);if(r)break;n[a||"#"+o]=r}if(!r){let o=Object.entries(n).map(([l,h])=>`adapter ${l} `+(h===!1?"is not supported by the environment":"is not available in the build")),a=e?o.length>1?`since :
`+o.map(sG).join(`
`):" "+sG(o[0]):"as no adapter specified";throw new Ht("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:fT};function lT(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Jp(null,t)}function oG(t){return lT(t),t.headers=Io.from(t.headers),t.data=aT.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),TG.getAdapter(t.adapter||yT.adapter)(t).then(function(r){return lT(t),r.data=aT.call(t,t.transformResponse,r),r.headers=Io.from(r.headers),r},function(r){return EG(r)||(lT(t),r&&r.response&&(r.response.data=aT.call(t,t.transformResponse,r.response),r.response.headers=Io.from(r.response.headers))),Promise.reject(r)})}var aG=t=>t instanceof Io?Mt({},t):t;function Cu(t,e){e=e||{};let i={};function r(u,c,f){return ve.isPlainObject(u)&&ve.isPlainObject(c)?ve.merge.call({caseless:f},u,c):ve.isPlainObject(c)?ve.merge({},c):ve.isArray(c)?c.slice():c}function n(u,c,f){if(ve.isUndefined(c)){if(!ve.isUndefined(u))return r(void 0,u,f)}else return r(u,c,f)}function o(u,c){if(!ve.isUndefined(c))return r(void 0,c)}function a(u,c){if(ve.isUndefined(c)){if(!ve.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function l(u,c,f){if(f in e)return r(u,c);if(f in t)return r(void 0,u)}let h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(u,c)=>n(aG(u),aG(c),!0)};return ve.forEach(Object.keys(Object.assign({},t,e)),function(c){let f=h[c]||n,d=f(t[c],e[c],c);ve.isUndefined(d)&&f!==l||(i[c]=d)}),i}var AG="1.6.8",xT={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{xT[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});var lG={};xT.transitional=function(e,i,r){function n(o,a){return"[Axios v"+AG+"] Transitional option '"+o+"'"+a+(r?". "+r:"")}return(o,a,l)=>{if(e===!1)throw new Ht(n(a," has been removed"+(i?" in "+i:"")),Ht.ERR_DEPRECATED);return i&&!lG[a]&&(lG[a]=!0,console.warn(n(a," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,a,l):!0}};function Xde(t,e,i){if(typeof t!="object")throw new Ht("options must be an object",Ht.ERR_BAD_OPTION_VALUE);let r=Object.keys(t),n=r.length;for(;n-- >0;){let o=r[n],a=e[o];if(a){let l=t[o],h=l===void 0||a(l,o,t);if(h!==!0)throw new Ht("option "+o+" must be "+h,Ht.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Ht("Unknown option "+o,Ht.ERR_BAD_OPTION)}}var dT={assertOptions:Xde,validators:xT},Da=dT.validators,Eu=class{constructor(e){this.defaults=e,this.interceptors={request:new iG,response:new iG}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;let o=n.stack?n.stack.replace(/^.+\n/,""):"";r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Cu(this.defaults,i);let{transitional:r,paramsSerializer:n,headers:o}=i;r!==void 0&&dT.assertOptions(r,{silentJSONParsing:Da.transitional(Da.boolean),forcedJSONParsing:Da.transitional(Da.boolean),clarifyTimeoutError:Da.transitional(Da.boolean)},!1),n!=null&&(ve.isFunction(n)?i.paramsSerializer={serialize:n}:dT.assertOptions(n,{encode:Da.function,serialize:Da.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let a=o&&ve.merge(o.common,o[i.method]);o&&ve.forEach(["delete","get","head","post","put","patch","common"],p=>{delete o[p]}),i.headers=Io.concat(a,o);let l=[],h=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(i)===!1||(h=h&&v.synchronous,l.unshift(v.fulfilled,v.rejected))});let u=[];this.interceptors.response.forEach(function(v){u.push(v.fulfilled,v.rejected)});let c,f=0,d;if(!h){let p=[oG.bind(this),void 0];for(p.unshift.apply(p,l),p.push.apply(p,u),d=p.length,c=Promise.resolve(i);f<d;)c=c.then(p[f++],p[f++]);return c}d=l.length;let m=i;for(f=0;f<d;){let p=l[f++],v=l[f++];try{m=p(m)}catch(g){v.call(this,g);break}}try{c=oG.call(this,m)}catch(p){return Promise.reject(p)}for(f=0,d=u.length;f<d;)c=c.then(u[f++],u[f++]);return c}getUri(e){e=Cu(this.defaults,e);let i=MG(e.baseURL,e.url);return bG(i,e.params,e.paramsSerializer)}};ve.forEach(["delete","get","head","options"],function(e){Eu.prototype[e]=function(i,r){return this.request(Cu(r||{},{method:e,url:i,data:(r||{}).data}))}});ve.forEach(["post","put","patch"],function(e){function i(r){return function(o,a,l){return this.request(Cu(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Eu.prototype[e]=i(),Eu.prototype[e+"Form"]=i(!0)});var V_=Eu,pT=class t{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});let r=this;this.promise.then(n=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](n);r._listeners=null}),this.promise.then=n=>{let o,a=new Promise(l=>{r.subscribe(l),o=l}).then(n);return a.cancel=function(){r.unsubscribe(o)},a},e(function(o,a,l){r.reason||(r.reason=new Jp(o,a,l),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new t(function(n){e=n}),cancel:e}}},Yde=pT;function Zde(t){return function(i){return t.apply(null,i)}}function Kde(t){return ve.isObject(t)&&t.isAxiosError===!0}var mT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mT).forEach(([t,e])=>{mT[e]=t});var Qde=mT;function PG(t){let e=new V_(t),i=hG(V_.prototype.request,e);return ve.extend(i,V_.prototype,e,{allOwnKeys:!0}),ve.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return PG(Cu(t,n))},i}var Wi=PG(yT);Wi.Axios=V_;Wi.CanceledError=Jp;Wi.CancelToken=Yde;Wi.isCancel=EG;Wi.VERSION=AG;Wi.toFormData=Y_;Wi.AxiosError=Ht;Wi.Cancel=Wi.CanceledError;Wi.all=function(e){return Promise.all(e)};Wi.spread=Zde;Wi.isAxiosError=Kde;Wi.mergeConfig=Cu;Wi.AxiosHeaders=Io;Wi.formToJSON=t=>CG(ve.isHTMLForm(t)?new FormData(t):t);Wi.getAdapter=TG.getAdapter;Wi.HttpStatusCode=Qde;Wi.default=Wi;RG.exports=Wi});var Lu="139",Js={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},$s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TT=0,$_=1,AT=2;var rm=1,nm=2,ka=3,xi=0,Li=1,qt=2,PT=1;var Pn=0,eo=1,ey=2,ty=3,iy=4,RT=5,ko=100,LT=101,OT=102,ry=103,ny=104,DT=200,IT=201,kT=202,FT=203,sm=204,om=205,BT=206,NT=207,UT=208,zT=209,GT=210,HT=0,Ss=1,WT=2,Ou=3,VT=4,jT=5,qT=6,XT=7,Fo=0,YT=1,ZT=2,qr=0,KT=1,QT=2,JT=3,$T=4,eA=5,sy=300,Qn=301,Cs=302,Du=303,Iu=304,Bo=306,ku=1e3,Cr=1001,Fu=1002,Vi=1003,oy=1004;var ay=1005;var ji=1006,tA=1007;var No=1008,iA=1008,Rn=1009,rA=1010,nA=1011,to=1012,sA=1013,Ol=1014,Jn=1015,Es=1016,oA=1017,aA=1018,Ms=1020,lA=1021,hA=1022,er=1023,uA=1024,cA=1025,$n=1026,Ts=1027,fA=1028,dA=1029,pA=1030,mA=1031,gA=1033,am=33776,lm=33777,hm=33778,um=33779,ly=35840,hy=35841,uy=35842,cy=35843,vA=36196,fy=37492,dy=37496,py=37808,my=37809,gy=37810,vy=37811,_y=37812,yy=37813,xy=37814,by=37815,wy=37816,Sy=37817,Cy=37818,Ey=37819,My=37820,Ty=37821,Ay=36492;var Er=3e3,Qt=3001,_A=3200,yA=3201,Dl=0,xA=1;var es="srgb",io="srgb-linear";var cm=7680;var bA=519,Py=35044;var Ry="300 es",Bu=1035;var dr=class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});let r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;let r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;let n=this._listeners[e];if(n!==void 0){let o=n.indexOf(i);o!==-1&&n.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let r=this._listeners[e.type];if(r!==void 0){e.target=this;let n=r.slice(0);for(let o=0,a=n.length;o<a;o++)n[o].call(this,e);e.target=null}}};var lr=[];for(let t=0;t<256;t++)lr[t]=(t<16?"0":"")+t.toString(16);var fm=Math.PI/180,Ly=180/Math.PI;function As(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(lr[t&255]+lr[t>>8&255]+lr[t>>16&255]+lr[t>>24&255]+"-"+lr[e&255]+lr[e>>8&255]+"-"+lr[e>>16&15|64]+lr[e>>24&255]+"-"+lr[i&63|128]+lr[i>>8&255]+"-"+lr[i>>16&255]+lr[i>>24&255]+lr[r&255]+lr[r>>8&255]+lr[r>>16&255]+lr[r>>24&255]).toLowerCase()}function qi(t,e,i){return Math.max(e,Math.min(i,t))}function wA(t,e){return(t%e+e)%e}function dm(t,e,i){return(1-i)*t+i*e}function Oy(t){return(t&t-1)===0&&t!==0}function Nu(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var $e=class{constructor(e=0,i=0){this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let i=this.x,r=this.y,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){let r=Math.cos(i),n=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*r-a*n+e.x,this.y=o*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};$e.prototype.isVector2=!0;var Oi=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,i,r,n,o,a,l,h,u){let c=this.elements;return c[0]=e,c[1]=n,c[2]=l,c[3]=i,c[4]=o,c[5]=h,c[6]=r,c[7]=a,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,n=i.elements,o=this.elements,a=r[0],l=r[3],h=r[6],u=r[1],c=r[4],f=r[7],d=r[2],m=r[5],p=r[8],v=n[0],g=n[3],_=n[6],x=n[1],b=n[4],y=n[7],S=n[2],w=n[5],M=n[8];return o[0]=a*v+l*x+h*S,o[3]=a*g+l*b+h*w,o[6]=a*_+l*y+h*M,o[1]=u*v+c*x+f*S,o[4]=u*g+c*b+f*w,o[7]=u*_+c*y+f*M,o[2]=d*v+m*x+p*S,o[5]=d*g+m*b+p*w,o[8]=d*_+m*y+p*M,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8];return i*a*c-i*l*u-r*o*c+r*l*h+n*o*u-n*a*h}invert(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],f=c*a-l*u,d=l*h-c*o,m=u*o-a*h,p=i*f+r*d+n*m;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let v=1/p;return e[0]=f*v,e[1]=(n*u-c*r)*v,e[2]=(l*r-n*a)*v,e[3]=d*v,e[4]=(c*i-n*h)*v,e[5]=(n*o-l*i)*v,e[6]=m*v,e[7]=(r*h-u*i)*v,e[8]=(a*i-r*o)*v,this}transpose(){let e,i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,n,o,a,l){let h=Math.cos(o),u=Math.sin(o);return this.set(r*h,r*u,-r*(h*a+u*l)+a+e,-n*u,n*h,-n*(-u*a+h*l)+l+i,0,0,1),this}scale(e,i){let r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=i,r[4]*=i,r[7]*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),n=this.elements,o=n[0],a=n[3],l=n[6],h=n[1],u=n[4],c=n[7];return n[0]=i*o+r*h,n[3]=i*a+r*u,n[6]=i*l+r*c,n[1]=-r*o+i*h,n[4]=-r*a+i*u,n[7]=-r*l+i*c,this}translate(e,i){let r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=i*r[2],r[4]+=i*r[5],r[7]+=i*r[8],this}equals(e){let i=this.elements,r=e.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}};Oi.prototype.isMatrix3=!0;function pm(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function Uu(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function ro(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function zu(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var Dy={[es]:{[io]:ro},[io]:{[es]:zu}},Ln={legacyMode:!0,get workingColorSpace(){return io},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(Dy[e]&&Dy[e][i]!==void 0){let r=Dy[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};var SA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xi={r:0,g:0,b:0},ts={h:0,s:0,l:0},mm={h:0,s:0,l:0};function Iy(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function gm(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var Ye=class{constructor(e,i,r){return i===void 0&&r===void 0?this.set(e):this.setRGB(e,i,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=es){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ln.toWorkingColorSpace(this,i),this}setRGB(e,i,r,n=io){return this.r=e,this.g=i,this.b=r,Ln.toWorkingColorSpace(this,n),this}setHSL(e,i,r,n=io){if(e=wA(e,1),i=qi(i,0,1),r=qi(r,0,1),i===0)this.r=this.g=this.b=r;else{let o=r<=.5?r*(1+i):r+i-r*i,a=2*r-o;this.r=Iy(a,o,e+1/3),this.g=Iy(a,o,e),this.b=Iy(a,o,e-1/3)}return Ln.toWorkingColorSpace(this,n),this}setStyle(e,i=es){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o,a=n[1],l=n[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Ln.toWorkingColorSpace(this,i),r(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Ln.toWorkingColorSpace(this,i),r(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){let h=parseFloat(o[1])/360,u=parseInt(o[2],10)/100,c=parseInt(o[3],10)/100;return r(o[4]),this.setHSL(h,u,c,i)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let o=n[1],a=o.length;if(a===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Ln.toWorkingColorSpace(this,i),this;if(a===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Ln.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=es){let r=SA[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ro(e.r),this.g=ro(e.g),this.b=ro(e.b),this}copyLinearToSRGB(e){return this.r=zu(e.r),this.g=zu(e.g),this.b=zu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=es){return Ln.fromWorkingColorSpace(gm(this,Xi),e),qi(Xi.r*255,0,255)<<16^qi(Xi.g*255,0,255)<<8^qi(Xi.b*255,0,255)<<0}getHexString(e=es){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=io){Ln.fromWorkingColorSpace(gm(this,Xi),i);let r=Xi.r,n=Xi.g,o=Xi.b,a=Math.max(r,n,o),l=Math.min(r,n,o),h,u,c=(l+a)/2;if(l===a)h=0,u=0;else{let f=a-l;switch(u=c<=.5?f/(a+l):f/(2-a-l),a){case r:h=(n-o)/f+(n<o?6:0);break;case n:h=(o-r)/f+2;break;case o:h=(r-n)/f+4;break}h/=6}return e.h=h,e.s=u,e.l=c,e}getRGB(e,i=io){return Ln.fromWorkingColorSpace(gm(this,Xi),i),e.r=Xi.r,e.g=Xi.g,e.b=Xi.b,e}getStyle(e=es){return Ln.fromWorkingColorSpace(gm(this,Xi),e),e!==es?`color(${e} ${Xi.r} ${Xi.g} ${Xi.b})`:`rgb(${Xi.r*255|0},${Xi.g*255|0},${Xi.b*255|0})`}offsetHSL(e,i,r){return this.getHSL(ts),ts.h+=e,ts.s+=i,ts.l+=r,this.setHSL(ts.h,ts.s,ts.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(ts),e.getHSL(mm);let r=dm(ts.h,mm.h,i),n=dm(ts.s,mm.s,i),o=dm(ts.l,mm.l,i);return this.setHSL(r,n,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};Ye.NAMES=SA;Ye.prototype.isColor=!0;Ye.prototype.r=1;Ye.prototype.g=1;Ye.prototype.b=1;var Il,kl=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Il===void 0&&(Il=Uu("canvas")),Il.width=e.width,Il.height=e.height;let r=Il.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Il}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){let i=Uu("canvas");i.width=e.width,i.height=e.height;let r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let n=r.getImageData(0,0,e.width,e.height),o=n.data;for(let a=0;a<o.length;a++)o[a]=ro(o[a]/255)*255;return r.putImageData(n,0,0),i}else if(e.data){let i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(ro(i[r]/255)*255):i[r]=ro(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}};var Gu=class{constructor(e=null){this.uuid=As(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let o;if(Array.isArray(n)){o=[];for(let a=0,l=n.length;a<l;a++)n[a].isDataTexture?o.push(ky(n[a].image)):o.push(ky(n[a]))}else o=ky(n);r.url=o}return i||(e.images[this.uuid]=r),r}};function ky(t){return typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap?kl.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Gu.prototype.isSource=!0;var WG=0,Di=class t extends dr{constructor(e=t.DEFAULT_IMAGE,i=t.DEFAULT_MAPPING,r=Cr,n=Cr,o=ji,a=No,l=er,h=Rn,u=1,c=Er){super(),Object.defineProperty(this,"id",{value:WG++}),this.uuid=As(),this.name="",this.source=new Gu(e),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=n,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=h,this.offset=new $e(0,0),this.repeat=new $e(1,1),this.center=new $e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Oi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ku:e.x=e.x-Math.floor(e.x);break;case Cr:e.x=e.x<0?0:1;break;case Fu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ku:e.y=e.y-Math.floor(e.y);break;case Cr:e.y=e.y<0?0:1;break;case Fu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Di.DEFAULT_IMAGE=null;Di.DEFAULT_MAPPING=sy;Di.prototype.isTexture=!0;var Vt=class{constructor(e=0,i=0,r=0,n=1){this.x=e,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,n){return this.x=e,this.y=i,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,r=this.y,n=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*o,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*o,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*o,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,n,o,h=e.elements,u=h[0],c=h[4],f=h[8],d=h[1],m=h[5],p=h[9],v=h[2],g=h[6],_=h[10];if(Math.abs(c-d)<.01&&Math.abs(f-v)<.01&&Math.abs(p-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(f+v)<.1&&Math.abs(p+g)<.1&&Math.abs(u+m+_-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;let b=(u+1)/2,y=(m+1)/2,S=(_+1)/2,w=(c+d)/4,M=(f+v)/4,C=(p+g)/4;return b>y&&b>S?b<.01?(r=0,n=.707106781,o=.707106781):(r=Math.sqrt(b),n=w/r,o=M/r):y>S?y<.01?(r=.707106781,n=0,o=.707106781):(n=Math.sqrt(y),r=w/n,o=C/n):S<.01?(r=.707106781,n=.707106781,o=0):(o=Math.sqrt(S),r=M/o,n=C/o),this.set(r,n,o,i),this}let x=Math.sqrt((g-p)*(g-p)+(f-v)*(f-v)+(d-c)*(d-c));return Math.abs(x)<.001&&(x=1),this.x=(g-p)/x,this.y=(f-v)/x,this.z=(d-c)/x,this.w=Math.acos((u+m+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};Vt.prototype.isVector4=!0;var pr=class extends dr{constructor(e,i,r={}){super(),this.width=e,this.height=i,this.depth=1,this.scissor=new Vt(0,0,e,i),this.scissorTest=!1,this.viewport=new Vt(0,0,e,i);let n={width:e,height:i,depth:1};this.texture=new Di(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:ji,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,i,r=1){(this.width!==e||this.height!==i||this.depth!==r)&&(this.width=e,this.height=i,this.depth=r,this.texture.image.width=e,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};pr.prototype.isWebGLRenderTarget=!0;var Fa=class extends Di{constructor(e=null,i=1,r=1,n=1){super(null),this.image={data:e,width:i,height:r,depth:n},this.magFilter=Vi,this.minFilter=Vi,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Fa.prototype.isDataArrayTexture=!0;var Hu=class extends Di{constructor(e=null,i=1,r=1,n=1){super(null),this.image={data:e,width:i,height:r,depth:n},this.magFilter=Vi,this.minFilter=Vi,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Hu.prototype.isData3DTexture=!0;var mr=class{constructor(e=0,i=0,r=0,n=1){this._x=e,this._y=i,this._z=r,this._w=n}static slerp(e,i,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,i,n)}static slerpFlat(e,i,r,n,o,a,l){let h=r[n+0],u=r[n+1],c=r[n+2],f=r[n+3],d=o[a+0],m=o[a+1],p=o[a+2],v=o[a+3];if(l===0){e[i+0]=h,e[i+1]=u,e[i+2]=c,e[i+3]=f;return}if(l===1){e[i+0]=d,e[i+1]=m,e[i+2]=p,e[i+3]=v;return}if(f!==v||h!==d||u!==m||c!==p){let g=1-l,_=h*d+u*m+c*p+f*v,x=_>=0?1:-1,b=1-_*_;if(b>Number.EPSILON){let S=Math.sqrt(b),w=Math.atan2(S,_*x);g=Math.sin(g*w)/S,l=Math.sin(l*w)/S}let y=l*x;if(h=h*g+d*y,u=u*g+m*y,c=c*g+p*y,f=f*g+v*y,g===1-l){let S=1/Math.sqrt(h*h+u*u+c*c+f*f);h*=S,u*=S,c*=S,f*=S}}e[i]=h,e[i+1]=u,e[i+2]=c,e[i+3]=f}static multiplyQuaternionsFlat(e,i,r,n,o,a){let l=r[n],h=r[n+1],u=r[n+2],c=r[n+3],f=o[a],d=o[a+1],m=o[a+2],p=o[a+3];return e[i]=l*p+c*f+h*m-u*d,e[i+1]=h*p+c*d+u*f-l*m,e[i+2]=u*p+c*m+l*d-h*f,e[i+3]=c*p-l*f-h*d-u*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,n){return this._x=e,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let r=e._x,n=e._y,o=e._z,a=e._order,l=Math.cos,h=Math.sin,u=l(r/2),c=l(n/2),f=l(o/2),d=h(r/2),m=h(n/2),p=h(o/2);switch(a){case"XYZ":this._x=d*c*f+u*m*p,this._y=u*m*f-d*c*p,this._z=u*c*p+d*m*f,this._w=u*c*f-d*m*p;break;case"YXZ":this._x=d*c*f+u*m*p,this._y=u*m*f-d*c*p,this._z=u*c*p-d*m*f,this._w=u*c*f+d*m*p;break;case"ZXY":this._x=d*c*f-u*m*p,this._y=u*m*f+d*c*p,this._z=u*c*p+d*m*f,this._w=u*c*f-d*m*p;break;case"ZYX":this._x=d*c*f-u*m*p,this._y=u*m*f+d*c*p,this._z=u*c*p-d*m*f,this._w=u*c*f+d*m*p;break;case"YZX":this._x=d*c*f+u*m*p,this._y=u*m*f+d*c*p,this._z=u*c*p-d*m*f,this._w=u*c*f-d*m*p;break;case"XZY":this._x=d*c*f-u*m*p,this._y=u*m*f-d*c*p,this._z=u*c*p+d*m*f,this._w=u*c*f+d*m*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let r=i/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],l=i[5],h=i[9],u=i[2],c=i[6],f=i[10],d=r+l+f;if(d>0){let m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(c-h)*m,this._y=(o-u)*m,this._z=(a-n)*m}else if(r>l&&r>f){let m=2*Math.sqrt(1+r-l-f);this._w=(c-h)/m,this._x=.25*m,this._y=(n+a)/m,this._z=(o+u)/m}else if(l>f){let m=2*Math.sqrt(1+l-r-f);this._w=(o-u)/m,this._x=(n+a)/m,this._y=.25*m,this._z=(h+c)/m}else{let m=2*Math.sqrt(1+f-r-l);this._w=(a-n)/m,this._x=(o+u)/m,this._y=(h+c)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(qi(this.dot(e),-1,1)))}rotateTowards(e,i){let r=this.angleTo(e);if(r===0)return this;let n=Math.min(1,i/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,i){return i!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,i)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let r=e._x,n=e._y,o=e._z,a=e._w,l=i._x,h=i._y,u=i._z,c=i._w;return this._x=r*c+a*l+n*u-o*h,this._y=n*c+a*h+o*l-r*u,this._z=o*c+a*u+r*h-n*l,this._w=a*c-r*l-n*h-o*u,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);let r=this._x,n=this._y,o=this._z,a=this._w,l=a*e._w+r*e._x+n*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=r,this._y=n,this._z=o,this;let h=1-l*l;if(h<=Number.EPSILON){let m=1-i;return this._w=m*a+i*this._w,this._x=m*r+i*this._x,this._y=m*n+i*this._y,this._z=m*o+i*this._z,this.normalize(),this._onChangeCallback(),this}let u=Math.sqrt(h),c=Math.atan2(u,l),f=Math.sin((1-i)*c)/u,d=Math.sin(i*c)/u;return this._w=a*f+this._w*d,this._x=r*f+this._x*d,this._y=n*f+this._y*d,this._z=o*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){let e=Math.random(),i=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(o),r*Math.cos(o),i*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};mr.prototype.isQuaternion=!0;var j=class{constructor(e=0,i=0,r=0){this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e,i){return i!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,i)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(CA.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(CA.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*i+o[3]*r+o[6]*n,this.y=o[1]*i+o[4]*r+o[7]*n,this.z=o[2]*i+o[5]*r+o[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,r=this.y,n=this.z,o=e.elements,a=1/(o[3]*i+o[7]*r+o[11]*n+o[15]);return this.x=(o[0]*i+o[4]*r+o[8]*n+o[12])*a,this.y=(o[1]*i+o[5]*r+o[9]*n+o[13])*a,this.z=(o[2]*i+o[6]*r+o[10]*n+o[14])*a,this}applyQuaternion(e){let i=this.x,r=this.y,n=this.z,o=e.x,a=e.y,l=e.z,h=e.w,u=h*i+a*n-l*r,c=h*r+l*i-o*n,f=h*n+o*r-a*i,d=-o*i-a*r-l*n;return this.x=u*h+d*-o+c*-l-f*-a,this.y=c*h+d*-a+f*-o-u*-l,this.z=f*h+d*-l+u*-a-c*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*i+o[4]*r+o[8]*n,this.y=o[1]*i+o[5]*r+o[9]*n,this.z=o[2]*i+o[6]*r+o[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e,i){return i!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,i)):this.crossVectors(this,e)}crossVectors(e,i){let r=e.x,n=e.y,o=e.z,a=i.x,l=i.y,h=i.z;return this.x=n*h-o*l,this.y=o*a-r*h,this.z=r*l-n*a,this}projectOnVector(e){let i=e.lengthSq();if(i===0)return this.set(0,0,0);let r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Fy.copy(this).projectOnVector(e),this.sub(Fy)}reflect(e){return this.sub(Fy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(e)/i;return Math.acos(qi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){let n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};j.prototype.isVector3=!0;var Fy=new j,CA=new mr;var Ei=class{constructor(e=new j(1/0,1/0,1/0),i=new j(-1/0,-1/0,-1/0)){this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){let i=1/0,r=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0,u=e.length;h<u;h+=3){let c=e[h],f=e[h+1],d=e[h+2];c<i&&(i=c),f<r&&(r=f),d<n&&(n=d),c>o&&(o=c),f>a&&(a=f),d>l&&(l=d)}return this.min.set(i,r,n),this.max.set(o,a,l),this}setFromBufferAttribute(e){let i=1/0,r=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0,u=e.count;h<u;h++){let c=e.getX(h),f=e.getY(h),d=e.getZ(h);c<i&&(i=c),f<r&&(r=f),d<n&&(n=d),c>o&&(o=c),f>a&&(a=f),d>l&&(l=d)}return this.min.set(i,r,n),this.max.set(o,a,l),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let r=Ba.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){let o=r.attributes.position;for(let a=0,l=o.count;a<l;a++)Ba.fromBufferAttribute(o,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Ba)}else r.boundingBox===null&&r.computeBoundingBox(),By.copy(r.boundingBox),By.applyMatrix4(e.matrixWorld),this.union(By);let n=e.children;for(let o=0,a=n.length;o<a;o++)this.expandByObject(n[o],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ba),Ba.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wu),vm.subVectors(this.max,Wu),Fl.subVectors(e.a,Wu),Bl.subVectors(e.b,Wu),Nl.subVectors(e.c,Wu),Uo.subVectors(Bl,Fl),zo.subVectors(Nl,Bl),Na.subVectors(Fl,Nl);let i=[0,-Uo.z,Uo.y,0,-zo.z,zo.y,0,-Na.z,Na.y,Uo.z,0,-Uo.x,zo.z,0,-zo.x,Na.z,0,-Na.x,-Uo.y,Uo.x,0,-zo.y,zo.x,0,-Na.y,Na.x,0];return!Ny(i,Fl,Bl,Nl,vm)||(i=[1,0,0,0,1,0,0,0,1],!Ny(i,Fl,Bl,Nl,vm))?!1:(_m.crossVectors(Uo,zo),i=[_m.x,_m.y,_m.z],Ny(i,Fl,Bl,Nl,vm))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ba.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ba).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(no[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),no[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),no[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),no[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),no[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),no[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),no[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),no[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(no),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Ei.prototype.isBox3=!0;var no=[new j,new j,new j,new j,new j,new j,new j,new j],Ba=new j,By=new Ei,Fl=new j,Bl=new j,Nl=new j,Uo=new j,zo=new j,Na=new j,Wu=new j,vm=new j,_m=new j,Ua=new j;function Ny(t,e,i,r,n){for(let o=0,a=t.length-3;o<=a;o+=3){Ua.fromArray(t,o);let l=n.x*Math.abs(Ua.x)+n.y*Math.abs(Ua.y)+n.z*Math.abs(Ua.z),h=e.dot(Ua),u=i.dot(Ua),c=r.dot(Ua);if(Math.max(-Math.max(h,u,c),Math.min(h,u,c))>l)return!1}return!0}var VG=new Ei,EA=new j,ym=new j,Uy=new j,Xr=class{constructor(e=new j,i=-1){this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let r=this.center;i!==void 0?r.copy(i):VG.setFromPoints(e).getCenter(r);let n=0;for(let o=0,a=e.length;o<a;o++)n=Math.max(n,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Uy.subVectors(e,this.center);let i=Uy.lengthSq();if(i>this.radius*this.radius){let r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.add(Uy.multiplyScalar(n/r)),this.radius+=n}return this}union(e){return this.center.equals(e.center)===!0?ym.set(0,0,1).multiplyScalar(e.radius):ym.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(EA.copy(e.center).add(ym)),this.expandByPoint(EA.copy(e.center).sub(ym)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};var zy=new j,jG=new j,qG=new Oi,On=class{constructor(e=new j(1,0,0),i=0){this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,n){return this.normal.set(e,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){let n=zy.subVectors(r,i).cross(jG.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,i){let r=e.delta(zy),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;let o=-(e.start.dot(this.normal)+this.constant)/n;return o<0||o>1?null:i.copy(r).multiplyScalar(o).add(e.start)}intersectsLine(e){let i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let r=i||qG.getNormalMatrix(e),n=this.coplanarPoint(zy).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};On.prototype.isPlane=!0;var Ul=new Xr,xm=new j,Go=class{constructor(e=new On,i=new On,r=new On,n=new On,o=new On,a=new On){this.planes=[e,i,r,n,o,a]}set(e,i,r,n,o,a){let l=this.planes;return l[0].copy(e),l[1].copy(i),l[2].copy(r),l[3].copy(n),l[4].copy(o),l[5].copy(a),this}copy(e){let i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){let i=this.planes,r=e.elements,n=r[0],o=r[1],a=r[2],l=r[3],h=r[4],u=r[5],c=r[6],f=r[7],d=r[8],m=r[9],p=r[10],v=r[11],g=r[12],_=r[13],x=r[14],b=r[15];return i[0].setComponents(l-n,f-h,v-d,b-g).normalize(),i[1].setComponents(l+n,f+h,v+d,b+g).normalize(),i[2].setComponents(l+o,f+u,v+m,b+_).normalize(),i[3].setComponents(l-o,f-u,v-m,b-_).normalize(),i[4].setComponents(l-a,f-c,v-p,b-x).normalize(),i[5].setComponents(l+a,f+c,v+p,b+x).normalize(),this}intersectsObject(e){let i=e.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),Ul.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ul)}intersectsSprite(e){return Ul.center.set(0,0,0),Ul.radius=.7071067811865476,Ul.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ul)}intersectsSphere(e){let i=this.planes,r=e.center,n=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){let i=this.planes;for(let r=0;r<6;r++){let n=i[r];if(xm.x=n.normal.x>0?e.max.x:e.min.x,xm.y=n.normal.y>0?e.max.y:e.min.y,xm.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(xm)<0)return!1}return!0}containsPoint(e){let i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};var dt=class t{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g){let _=this.elements;return _[0]=e,_[4]=i,_[8]=r,_[12]=n,_[1]=o,_[5]=a,_[9]=l,_[13]=h,_[2]=u,_[6]=c,_[10]=f,_[14]=d,_[3]=m,_[7]=p,_[11]=v,_[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new t().fromArray(this.elements)}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){let i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,r=e.elements,n=1/zl.setFromMatrixColumn(e,0).length(),o=1/zl.setFromMatrixColumn(e,1).length(),a=1/zl.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let i=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),l=Math.sin(r),h=Math.cos(n),u=Math.sin(n),c=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){let d=a*c,m=a*f,p=l*c,v=l*f;i[0]=h*c,i[4]=-h*f,i[8]=u,i[1]=m+p*u,i[5]=d-v*u,i[9]=-l*h,i[2]=v-d*u,i[6]=p+m*u,i[10]=a*h}else if(e.order==="YXZ"){let d=h*c,m=h*f,p=u*c,v=u*f;i[0]=d+v*l,i[4]=p*l-m,i[8]=a*u,i[1]=a*f,i[5]=a*c,i[9]=-l,i[2]=m*l-p,i[6]=v+d*l,i[10]=a*h}else if(e.order==="ZXY"){let d=h*c,m=h*f,p=u*c,v=u*f;i[0]=d-v*l,i[4]=-a*f,i[8]=p+m*l,i[1]=m+p*l,i[5]=a*c,i[9]=v-d*l,i[2]=-a*u,i[6]=l,i[10]=a*h}else if(e.order==="ZYX"){let d=a*c,m=a*f,p=l*c,v=l*f;i[0]=h*c,i[4]=p*u-m,i[8]=d*u+v,i[1]=h*f,i[5]=v*u+d,i[9]=m*u-p,i[2]=-u,i[6]=l*h,i[10]=a*h}else if(e.order==="YZX"){let d=a*h,m=a*u,p=l*h,v=l*u;i[0]=h*c,i[4]=v-d*f,i[8]=p*f+m,i[1]=f,i[5]=a*c,i[9]=-l*c,i[2]=-u*c,i[6]=m*f+p,i[10]=d-v*f}else if(e.order==="XZY"){let d=a*h,m=a*u,p=l*h,v=l*u;i[0]=h*c,i[4]=-f,i[8]=u*c,i[1]=d*f+v,i[5]=a*c,i[9]=m*f-p,i[2]=p*f-m,i[6]=l*c,i[10]=v*f+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(XG,e,YG)}lookAt(e,i,r){let n=this.elements;return un.subVectors(e,i),un.lengthSq()===0&&(un.z=1),un.normalize(),Ho.crossVectors(r,un),Ho.lengthSq()===0&&(Math.abs(r.z)===1?un.x+=1e-4:un.z+=1e-4,un.normalize(),Ho.crossVectors(r,un)),Ho.normalize(),bm.crossVectors(un,Ho),n[0]=Ho.x,n[4]=bm.x,n[8]=un.x,n[1]=Ho.y,n[5]=bm.y,n[9]=un.y,n[2]=Ho.z,n[6]=bm.z,n[10]=un.z,this}multiply(e,i){return i!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,i)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,n=i.elements,o=this.elements,a=r[0],l=r[4],h=r[8],u=r[12],c=r[1],f=r[5],d=r[9],m=r[13],p=r[2],v=r[6],g=r[10],_=r[14],x=r[3],b=r[7],y=r[11],S=r[15],w=n[0],M=n[4],C=n[8],E=n[12],P=n[1],A=n[5],R=n[9],k=n[13],I=n[2],L=n[6],T=n[10],O=n[14],D=n[3],F=n[7],B=n[11],U=n[15];return o[0]=a*w+l*P+h*I+u*D,o[4]=a*M+l*A+h*L+u*F,o[8]=a*C+l*R+h*T+u*B,o[12]=a*E+l*k+h*O+u*U,o[1]=c*w+f*P+d*I+m*D,o[5]=c*M+f*A+d*L+m*F,o[9]=c*C+f*R+d*T+m*B,o[13]=c*E+f*k+d*O+m*U,o[2]=p*w+v*P+g*I+_*D,o[6]=p*M+v*A+g*L+_*F,o[10]=p*C+v*R+g*T+_*B,o[14]=p*E+v*k+g*O+_*U,o[3]=x*w+b*P+y*I+S*D,o[7]=x*M+b*A+y*L+S*F,o[11]=x*C+b*R+y*T+S*B,o[15]=x*E+b*k+y*O+S*U,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[4],n=e[8],o=e[12],a=e[1],l=e[5],h=e[9],u=e[13],c=e[2],f=e[6],d=e[10],m=e[14],p=e[3],v=e[7],g=e[11],_=e[15];return p*(+o*h*f-n*u*f-o*l*d+r*u*d+n*l*m-r*h*m)+v*(+i*h*m-i*u*d+o*a*d-n*a*m+n*u*c-o*h*c)+g*(+i*u*f-i*l*m-o*a*f+r*a*m+o*l*c-r*u*c)+_*(-n*l*c-i*h*f+i*l*d+n*a*f-r*a*d+r*h*c)}transpose(){let e=this.elements,i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=i,n[14]=r),this}invert(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],f=e[9],d=e[10],m=e[11],p=e[12],v=e[13],g=e[14],_=e[15],x=f*g*u-v*d*u+v*h*m-l*g*m-f*h*_+l*d*_,b=p*d*u-c*g*u-p*h*m+a*g*m+c*h*_-a*d*_,y=c*v*u-p*f*u+p*l*m-a*v*m-c*l*_+a*f*_,S=p*f*h-c*v*h-p*l*d+a*v*d+c*l*g-a*f*g,w=i*x+r*b+n*y+o*S;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let M=1/w;return e[0]=x*M,e[1]=(v*d*o-f*g*o-v*n*m+r*g*m+f*n*_-r*d*_)*M,e[2]=(l*g*o-v*h*o+v*n*u-r*g*u-l*n*_+r*h*_)*M,e[3]=(f*h*o-l*d*o-f*n*u+r*d*u+l*n*m-r*h*m)*M,e[4]=b*M,e[5]=(c*g*o-p*d*o+p*n*m-i*g*m-c*n*_+i*d*_)*M,e[6]=(p*h*o-a*g*o-p*n*u+i*g*u+a*n*_-i*h*_)*M,e[7]=(a*d*o-c*h*o+c*n*u-i*d*u-a*n*m+i*h*m)*M,e[8]=y*M,e[9]=(p*f*o-c*v*o-p*r*m+i*v*m+c*r*_-i*f*_)*M,e[10]=(a*v*o-p*l*o+p*r*u-i*v*u-a*r*_+i*l*_)*M,e[11]=(c*l*o-a*f*o-c*r*u+i*f*u+a*r*m-i*l*m)*M,e[12]=S*M,e[13]=(c*v*n-p*f*n+p*r*d-i*v*d-c*r*g+i*f*g)*M,e[14]=(p*l*n-a*v*n-p*r*h+i*v*h+a*r*g-i*l*g)*M,e[15]=(a*f*n-c*l*n+c*r*h-i*f*h-a*r*d+i*l*d)*M,this}scale(e){let i=this.elements,r=e.x,n=e.y,o=e.z;return i[0]*=r,i[4]*=n,i[8]*=o,i[1]*=r,i[5]*=n,i[9]*=o,i[2]*=r,i[6]*=n,i[10]*=o,i[3]*=r,i[7]*=n,i[11]*=o,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(e,i,r){return this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let r=Math.cos(i),n=Math.sin(i),o=1-r,a=e.x,l=e.y,h=e.z,u=o*a,c=o*l;return this.set(u*a+r,u*l-n*h,u*h+n*l,0,u*l+n*h,c*l+r,c*h-n*a,0,u*h-n*l,c*h+n*a,o*h*h+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,n,o,a){return this.set(1,r,o,0,e,1,a,0,i,n,1,0,0,0,0,1),this}compose(e,i,r){let n=this.elements,o=i._x,a=i._y,l=i._z,h=i._w,u=o+o,c=a+a,f=l+l,d=o*u,m=o*c,p=o*f,v=a*c,g=a*f,_=l*f,x=h*u,b=h*c,y=h*f,S=r.x,w=r.y,M=r.z;return n[0]=(1-(v+_))*S,n[1]=(m+y)*S,n[2]=(p-b)*S,n[3]=0,n[4]=(m-y)*w,n[5]=(1-(d+_))*w,n[6]=(g+x)*w,n[7]=0,n[8]=(p+b)*M,n[9]=(g-x)*M,n[10]=(1-(d+v))*M,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,i,r){let n=this.elements,o=zl.set(n[0],n[1],n[2]).length(),a=zl.set(n[4],n[5],n[6]).length(),l=zl.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),e.x=n[12],e.y=n[13],e.z=n[14],is.copy(this);let u=1/o,c=1/a,f=1/l;return is.elements[0]*=u,is.elements[1]*=u,is.elements[2]*=u,is.elements[4]*=c,is.elements[5]*=c,is.elements[6]*=c,is.elements[8]*=f,is.elements[9]*=f,is.elements[10]*=f,i.setFromRotationMatrix(is),r.x=o,r.y=a,r.z=l,this}makePerspective(e,i,r,n,o,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let l=this.elements,h=2*o/(i-e),u=2*o/(r-n),c=(i+e)/(i-e),f=(r+n)/(r-n),d=-(a+o)/(a-o),m=-2*a*o/(a-o);return l[0]=h,l[4]=0,l[8]=c,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,i,r,n,o,a){let l=this.elements,h=1/(i-e),u=1/(r-n),c=1/(a-o),f=(i+e)*h,d=(r+n)*u,m=(a+o)*c;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=-2*c,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){let i=this.elements,r=e.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}};dt.prototype.isMatrix4=!0;var zl=new j,is=new dt,XG=new j(0,0,0),YG=new j(1,1,1),Ho=new j,bm=new j,un=new j;function wm(){let t=null,e=!1,i=null,r=null;function n(o,a){i(o,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){t=o}}}function MA(t,e){let i=e.isWebGL2,r=new WeakMap;function n(u,c){let f=u.array,d=u.usage,m=t.createBuffer();t.bindBuffer(c,m),t.bufferData(c,f,d),u.onUploadCallback();let p;if(f instanceof Float32Array)p=t.FLOAT;else if(f instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(i)p=t.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=t.UNSIGNED_SHORT;else if(f instanceof Int16Array)p=t.SHORT;else if(f instanceof Uint32Array)p=t.UNSIGNED_INT;else if(f instanceof Int32Array)p=t.INT;else if(f instanceof Int8Array)p=t.BYTE;else if(f instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:m,type:p,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version}}function o(u,c,f){let d=c.array,m=c.updateRange;t.bindBuffer(f,u),m.count===-1?t.bufferSubData(f,0,d):(i?t.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d,m.offset,m.count):t.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d.subarray(m.offset,m.offset+m.count)),m.count=-1)}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),r.get(u)}function l(u){u.isInterleavedBufferAttribute&&(u=u.data);let c=r.get(u);c&&(t.deleteBuffer(c.buffer),r.delete(u))}function h(u,c){if(u.isGLBufferAttribute){let d=r.get(u);(!d||d.version<u.version)&&r.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let f=r.get(u);f===void 0?r.set(u,n(u,c)):f.version<u.version&&(o(f.buffer,u,c),f.version=u.version)}return{get:a,remove:l,update:h}}var Ii=new j,Sm=new $e,vt=class{constructor(e,i,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r===!0,this.usage=Py,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let n=0,o=this.itemSize;n<o;n++)this.array[e+n]=i.array[r+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new Ye),i[r++]=a.r,i[r++]=a.g,i[r++]=a.b}return this}copyVector2sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new $e),i[r++]=a.x,i[r++]=a.y}return this}copyVector3sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new j),i[r++]=a.x,i[r++]=a.y,i[r++]=a.z}return this}copyVector4sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new Vt),i[r++]=a.x,i[r++]=a.y,i[r++]=a.z,i[r++]=a.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)Sm.fromBufferAttribute(this,i),Sm.applyMatrix3(e),this.setXY(i,Sm.x,Sm.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Ii.fromBufferAttribute(this,i),Ii.applyMatrix3(e),this.setXYZ(i,Ii.x,Ii.y,Ii.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Ii.fromBufferAttribute(this,i),Ii.applyMatrix4(e),this.setXYZ(i,Ii.x,Ii.y,Ii.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Ii.fromBufferAttribute(this,i),Ii.applyNormalMatrix(e),this.setXYZ(i,Ii.x,Ii.y,Ii.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Ii.fromBufferAttribute(this,i),Ii.transformDirection(e),this.setXYZ(i,Ii.x,Ii.y,Ii.z);return this}set(e,i=0){return this.array.set(e,i),this}getX(e){return this.array[e*this.itemSize]}setX(e,i){return this.array[e*this.itemSize]=i,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,i){return this.array[e*this.itemSize+1]=i,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,i){return this.array[e*this.itemSize+2]=i,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,i){return this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,n){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,i,r,n,o){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Py&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};vt.prototype.isBufferAttribute=!0;var Gl=class extends vt{constructor(e,i,r){super(new Uint16Array(e),i,r)}};var Hl=class extends vt{constructor(e,i,r){super(new Uint32Array(e),i,r)}},Gy=class extends vt{constructor(e,i,r){super(new Uint16Array(e),i,r)}};Gy.prototype.isFloat16BufferAttribute=!0;var kt=class extends vt{constructor(e,i,r){super(new Float32Array(e),i,r)}};var TA=new dt,AA=new mr,za=class t{constructor(e=0,i=0,r=0,n=t.DefaultOrder){this._x=e,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,n=this._order){return this._x=e,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){let n=e.elements,o=n[0],a=n[4],l=n[8],h=n[1],u=n[5],c=n[9],f=n[2],d=n[6],m=n[10];switch(i){case"XYZ":this._y=Math.asin(qi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-qi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(qi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(h,o));break;case"ZYX":this._y=Math.asin(-qi(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(qi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-qi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return TA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(TA,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return AA.setFromEuler(this),this.setFromQuaternion(AA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};za.prototype.isEuler=!0;za.DefaultOrder="XYZ";za.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Wo=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}};var ZG=0,PA=new j,Wl=new mr,so=new dt,Cm=new j,Vu=new j,KG=new j,QG=new mr,RA=new j(1,0,0),LA=new j(0,1,0),OA=new j(0,0,1),JG={type:"added"},DA={type:"removed"},ii=class t extends dr{constructor(){super(),Object.defineProperty(this,"id",{value:ZG++}),this.uuid=As(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DefaultUp.clone();let e=new j,i=new za,r=new mr,n=new j(1,1,1);function o(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(o),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new dt},normalMatrix:{value:new Oi}}),this.matrix=new dt,this.matrixWorld=new dt,this.matrixAutoUpdate=t.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Wo,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Wl.setFromAxisAngle(e,i),this.quaternion.multiply(Wl),this}rotateOnWorldAxis(e,i){return Wl.setFromAxisAngle(e,i),this.quaternion.premultiply(Wl),this}rotateX(e){return this.rotateOnAxis(RA,e)}rotateY(e){return this.rotateOnAxis(LA,e)}rotateZ(e){return this.rotateOnAxis(OA,e)}translateOnAxis(e,i){return PA.copy(e).applyQuaternion(this.quaternion),this.position.add(PA.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(RA,e)}translateY(e){return this.translateOnAxis(LA,e)}translateZ(e){return this.translateOnAxis(OA,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(so.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?Cm.copy(e):Cm.set(e,i,r);let n=this.parent;this.updateWorldMatrix(!0,!1),Vu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?so.lookAt(Vu,Cm,this.up):so.lookAt(Cm,Vu,this.up),this.quaternion.setFromRotationMatrix(so),n&&(so.extractRotation(n.matrixWorld),Wl.setFromRotationMatrix(so),this.quaternion.premultiply(Wl.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(JG)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(DA)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let i=this.children[e];i.parent=null,i.dispatchEvent(DA)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),so.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),so.multiply(e.parent.matrixWorld)),e.applyMatrix4(so),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,n=this.children.length;r<n;r++){let a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vu,e,KG),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vu,QG,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(e)}traverseAncestors(e){let i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){let n=this.children;for(let o=0,a=n.length;o<a;o++)n[o].updateWorldMatrix(!1,!0)}}toJSON(e){let i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function o(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=o(e.geometries,this.geometry);let l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){let h=l.shapes;if(Array.isArray(h))for(let u=0,c=h.length;u<c;u++){let f=h[u];o(e.shapes,f)}else o(e.shapes,h)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let l=[];for(let h=0,u=this.material.length;h<u;h++)l.push(o(e.materials,this.material[h]));n.material=l}else n.material=o(e.materials,this.material);if(this.children.length>0){n.children=[];for(let l=0;l<this.children.length;l++)n.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let l=0;l<this.animations.length;l++){let h=this.animations[l];n.animations.push(o(e.animations,h))}}if(i){let l=a(e.geometries),h=a(e.materials),u=a(e.textures),c=a(e.images),f=a(e.shapes),d=a(e.skeletons),m=a(e.animations),p=a(e.nodes);l.length>0&&(r.geometries=l),h.length>0&&(r.materials=h),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),f.length>0&&(r.shapes=f),d.length>0&&(r.skeletons=d),m.length>0&&(r.animations=m),p.length>0&&(r.nodes=p)}return r.object=n,r;function a(l){let h=[];for(let u in l){let c=l[u];delete c.metadata,h.push(c)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){let n=e.children[r];this.add(n.clone())}return this}};ii.DefaultUp=new j(0,1,0);ii.DefaultMatrixAutoUpdate=!0;ii.prototype.isObject3D=!0;var $G=0,Dn=new dt,Hy=new ii,Vl=new j,cn=new Ei,ju=new Ei,tr=new j,pt=class t extends dr{constructor(){super(),Object.defineProperty(this,"id",{value:$G++}),this.uuid=As(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(pm(e)?Hl:Gl)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){let i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);let r=this.attributes.normal;if(r!==void 0){let o=new Oi().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}let n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Dn.makeRotationFromQuaternion(e),this.applyMatrix4(Dn),this}rotateX(e){return Dn.makeRotationX(e),this.applyMatrix4(Dn),this}rotateY(e){return Dn.makeRotationY(e),this.applyMatrix4(Dn),this}rotateZ(e){return Dn.makeRotationZ(e),this.applyMatrix4(Dn),this}translate(e,i,r){return Dn.makeTranslation(e,i,r),this.applyMatrix4(Dn),this}scale(e,i,r){return Dn.makeScale(e,i,r),this.applyMatrix4(Dn),this}lookAt(e){return Hy.lookAt(e),Hy.updateMatrix(),this.applyMatrix4(Hy.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vl).negate(),this.translate(Vl.x,Vl.y,Vl.z),this}setFromPoints(e){let i=[];for(let r=0,n=e.length;r<n;r++){let o=e[r];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new kt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ei);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new j(-1/0,-1/0,-1/0),new j(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,n=i.length;r<n;r++){let o=i[r];cn.setFromBufferAttribute(o),this.morphTargetsRelative?(tr.addVectors(this.boundingBox.min,cn.min),this.boundingBox.expandByPoint(tr),tr.addVectors(this.boundingBox.max,cn.max),this.boundingBox.expandByPoint(tr)):(this.boundingBox.expandByPoint(cn.min),this.boundingBox.expandByPoint(cn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xr);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new j,1/0);return}if(e){let r=this.boundingSphere.center;if(cn.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){let l=i[o];ju.setFromBufferAttribute(l),this.morphTargetsRelative?(tr.addVectors(cn.min,ju.min),cn.expandByPoint(tr),tr.addVectors(cn.max,ju.max),cn.expandByPoint(tr)):(cn.expandByPoint(ju.min),cn.expandByPoint(ju.max))}cn.getCenter(r);let n=0;for(let o=0,a=e.count;o<a;o++)tr.fromBufferAttribute(e,o),n=Math.max(n,r.distanceToSquared(tr));if(i)for(let o=0,a=i.length;o<a;o++){let l=i[o],h=this.morphTargetsRelative;for(let u=0,c=l.count;u<c;u++)tr.fromBufferAttribute(l,u),h&&(Vl.fromBufferAttribute(e,u),tr.add(Vl)),n=Math.max(n,r.distanceToSquared(tr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=e.array,n=i.position.array,o=i.normal.array,a=i.uv.array,l=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new vt(new Float32Array(4*l),4));let h=this.getAttribute("tangent").array,u=[],c=[];for(let P=0;P<l;P++)u[P]=new j,c[P]=new j;let f=new j,d=new j,m=new j,p=new $e,v=new $e,g=new $e,_=new j,x=new j;function b(P,A,R){f.fromArray(n,P*3),d.fromArray(n,A*3),m.fromArray(n,R*3),p.fromArray(a,P*2),v.fromArray(a,A*2),g.fromArray(a,R*2),d.sub(f),m.sub(f),v.sub(p),g.sub(p);let k=1/(v.x*g.y-g.x*v.y);isFinite(k)&&(_.copy(d).multiplyScalar(g.y).addScaledVector(m,-v.y).multiplyScalar(k),x.copy(m).multiplyScalar(v.x).addScaledVector(d,-g.x).multiplyScalar(k),u[P].add(_),u[A].add(_),u[R].add(_),c[P].add(x),c[A].add(x),c[R].add(x))}let y=this.groups;y.length===0&&(y=[{start:0,count:r.length}]);for(let P=0,A=y.length;P<A;++P){let R=y[P],k=R.start,I=R.count;for(let L=k,T=k+I;L<T;L+=3)b(r[L+0],r[L+1],r[L+2])}let S=new j,w=new j,M=new j,C=new j;function E(P){M.fromArray(o,P*3),C.copy(M);let A=u[P];S.copy(A),S.sub(M.multiplyScalar(M.dot(A))).normalize(),w.crossVectors(C,A);let k=w.dot(c[P])<0?-1:1;h[P*4]=S.x,h[P*4+1]=S.y,h[P*4+2]=S.z,h[P*4+3]=k}for(let P=0,A=y.length;P<A;++P){let R=y[P],k=R.start,I=R.count;for(let L=k,T=k+I;L<T;L+=3)E(r[L+0]),E(r[L+1]),E(r[L+2])}}computeVertexNormals(){let e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new vt(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,m=r.count;d<m;d++)r.setXYZ(d,0,0,0);let n=new j,o=new j,a=new j,l=new j,h=new j,u=new j,c=new j,f=new j;if(e)for(let d=0,m=e.count;d<m;d+=3){let p=e.getX(d+0),v=e.getX(d+1),g=e.getX(d+2);n.fromBufferAttribute(i,p),o.fromBufferAttribute(i,v),a.fromBufferAttribute(i,g),c.subVectors(a,o),f.subVectors(n,o),c.cross(f),l.fromBufferAttribute(r,p),h.fromBufferAttribute(r,v),u.fromBufferAttribute(r,g),l.add(c),h.add(c),u.add(c),r.setXYZ(p,l.x,l.y,l.z),r.setXYZ(v,h.x,h.y,h.z),r.setXYZ(g,u.x,u.y,u.z)}else for(let d=0,m=i.count;d<m;d+=3)n.fromBufferAttribute(i,d+0),o.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),c.subVectors(a,o),f.subVectors(n,o),c.cross(f),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,i){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}i===void 0&&(i=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let r=this.attributes;for(let n in r){if(e.attributes[n]===void 0)continue;let a=r[n].array,l=e.attributes[n],h=l.array,u=l.itemSize*i,c=Math.min(h.length,a.length-u);for(let f=0,d=u;f<c;f++,d++)a[d]=h[f]}return this}normalizeNormals(){let e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)tr.fromBufferAttribute(e,i),tr.normalize(),e.setXYZ(i,tr.x,tr.y,tr.z)}toNonIndexed(){function e(l,h){let u=l.array,c=l.itemSize,f=l.normalized,d=new u.constructor(h.length*c),m=0,p=0;for(let v=0,g=h.length;v<g;v++){l.isInterleavedBufferAttribute?m=h[v]*l.data.stride+l.offset:m=h[v]*c;for(let _=0;_<c;_++)d[p++]=u[m++]}return new vt(d,c,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new t,r=this.index.array,n=this.attributes;for(let l in n){let h=n[l],u=e(h,r);i.setAttribute(l,u)}let o=this.morphAttributes;for(let l in o){let h=[],u=o[l];for(let c=0,f=u.length;c<f;c++){let d=u[c],m=e(d,r);h.push(m)}i.morphAttributes[l]=h}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let l=0,h=a.length;l<h;l++){let u=a[l];i.addGroup(u.start,u.count,u.materialIndex)}return i}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let h=this.parameters;for(let u in h)h[u]!==void 0&&(e[u]=h[u]);return e}e.data={attributes:{}};let i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let r=this.attributes;for(let h in r){let u=r[h];e.data.attributes[h]=u.toJSON(e.data)}let n={},o=!1;for(let h in this.morphAttributes){let u=this.morphAttributes[h],c=[];for(let f=0,d=u.length;f<d;f++){let m=u[f];c.push(m.toJSON(e.data))}c.length>0&&(n[h]=c,o=!0)}o&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=e.name;let r=e.index;r!==null&&this.setIndex(r.clone(i));let n=e.attributes;for(let u in n){let c=n[u];this.setAttribute(u,c.clone(i))}let o=e.morphAttributes;for(let u in o){let c=[],f=o[u];for(let d=0,m=f.length;d<m;d++)c.push(f[d].clone(i));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let u=0,c=a.length;u<c;u++){let f=a[u];this.addGroup(f.start,f.count,f.materialIndex)}let l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());let h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};pt.prototype.isBufferGeometry=!0;var rs=class t extends pt{constructor(e=1,i=1,r=1,n=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:a};let l=this;n=Math.floor(n),o=Math.floor(o),a=Math.floor(a);let h=[],u=[],c=[],f=[],d=0,m=0;p("z","y","x",-1,-1,r,i,e,a,o,0),p("z","y","x",1,-1,r,i,-e,a,o,1),p("x","z","y",1,1,e,r,i,n,a,2),p("x","z","y",1,-1,e,r,-i,n,a,3),p("x","y","z",1,-1,e,i,r,n,o,4),p("x","y","z",-1,-1,e,i,-r,n,o,5),this.setIndex(h),this.setAttribute("position",new kt(u,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(f,2));function p(v,g,_,x,b,y,S,w,M,C,E){let P=y/M,A=S/C,R=y/2,k=S/2,I=w/2,L=M+1,T=C+1,O=0,D=0,F=new j;for(let B=0;B<T;B++){let U=B*A-k;for(let G=0;G<L;G++){let Y=G*P-R;F[v]=Y*x,F[g]=U*b,F[_]=I,u.push(F.x,F.y,F.z),F[v]=0,F[g]=0,F[_]=w>0?1:-1,c.push(F.x,F.y,F.z),f.push(G/M),f.push(1-B/C),O+=1}}for(let B=0;B<C;B++)for(let U=0;U<M;U++){let G=d+U+L*B,Y=d+U+L*(B+1),re=d+(U+1)+L*(B+1),N=d+(U+1)+L*B;h.push(G,Y,N),h.push(Y,re,N),D+=6}l.addGroup(m,D,E),m+=D,d+=O}}static fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};var Mr=class t extends pt{constructor(e=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:n};let o=e/2,a=i/2,l=Math.floor(r),h=Math.floor(n),u=l+1,c=h+1,f=e/l,d=i/h,m=[],p=[],v=[],g=[];for(let _=0;_<c;_++){let x=_*d-a;for(let b=0;b<u;b++){let y=b*f-o;p.push(y,-x,0),v.push(0,0,1),g.push(b/l),g.push(1-_/h)}}for(let _=0;_<h;_++)for(let x=0;x<l;x++){let b=x+u*_,y=x+u*(_+1),S=x+1+u*(_+1),w=x+1+u*_;m.push(b,y,w),m.push(y,S,w)}this.setIndex(m),this.setAttribute("position",new kt(p,3)),this.setAttribute("normal",new kt(v,3)),this.setAttribute("uv",new kt(g,2))}static fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}};var eH=0,gr=class extends dr{constructor(){super(),Object.defineProperty(this,"id",{value:eH++}),this.uuid=As(),this.name="",this.type="Material",this.fog=!0,this.blending=eo,this.side=xi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=sm,this.blendDst=om,this.blendEquation=ko,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ou,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=cm,this.stencilZFail=cm,this.stencilZPass=cm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let i in e){let r=e[i];if(r===void 0){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}if(i==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===PT;continue}let n=this[i];if(n===void 0){console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(e){let i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});let r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==eo&&(r.blending=this.blending),this.side!==xi&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function n(o){let a=[];for(let l in o){let h=o[l];delete h.metadata,a.push(h)}return a}if(i){let o=n(e.textures),a=n(e.images);o.length>0&&(r.textures=o),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,r=null;if(i!==null){let n=i.length;r=new Array(n);for(let o=0;o!==n;++o)r[o]=i[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};gr.prototype.isMaterial=!0;gr.fromType=function(){return null};function oo(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function hr(t){let e={};for(let i=0;i<t.length;i++){let r=oo(t[i]);for(let n in r)e[n]=r[n]}return e}var qu={clone:oo,merge:hr};var IA=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`;var kA=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;var Yr=class extends gr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=IA,this.fragmentShader=kA,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=oo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(let n in this.uniforms){let a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}};Yr.prototype.isShaderMaterial=!0;var ao=new j,Wy=new j,Em=new j,Vo=new j,Vy=new j,Mm=new j,jy=new j,jo=class{constructor(e=new j,i=new j(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ao)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=ao.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ao.copy(this.direction).multiplyScalar(i).add(this.origin),ao.distanceToSquared(e))}distanceSqToSegment(e,i,r,n){Wy.copy(e).add(i).multiplyScalar(.5),Em.copy(i).sub(e).normalize(),Vo.copy(this.origin).sub(Wy);let o=e.distanceTo(i)*.5,a=-this.direction.dot(Em),l=Vo.dot(this.direction),h=-Vo.dot(Em),u=Vo.lengthSq(),c=Math.abs(1-a*a),f,d,m,p;if(c>0)if(f=a*h-l,d=a*l-h,p=o*c,f>=0)if(d>=-p)if(d<=p){let v=1/c;f*=v,d*=v,m=f*(f+a*d+2*l)+d*(a*f+d+2*h)+u}else d=o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;else d=-o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;else d<=-p?(f=Math.max(0,-(-a*o+l)),d=f>0?-o:Math.min(Math.max(-o,-h),o),m=-f*f+d*(d+2*h)+u):d<=p?(f=0,d=Math.min(Math.max(-o,-h),o),m=d*(d+2*h)+u):(f=Math.max(0,-(a*o+l)),d=f>0?o:Math.min(Math.max(-o,-h),o),m=-f*f+d*(d+2*h)+u);else d=a>0?-o:o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;return r&&r.copy(this.direction).multiplyScalar(f).add(this.origin),n&&n.copy(Em).multiplyScalar(d).add(Wy),m}intersectSphere(e,i){ao.subVectors(e.center,this.origin);let r=ao.dot(this.direction),n=ao.dot(ao)-r*r,o=e.radius*e.radius;if(n>o)return null;let a=Math.sqrt(o-n),l=r-a,h=r+a;return l<0&&h<0?null:l<0?this.at(h,i):this.at(l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){let r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,n,o,a,l,h,u=1/this.direction.x,c=1/this.direction.y,f=1/this.direction.z,d=this.origin;return u>=0?(r=(e.min.x-d.x)*u,n=(e.max.x-d.x)*u):(r=(e.max.x-d.x)*u,n=(e.min.x-d.x)*u),c>=0?(o=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(o=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),r>a||o>n||((o>r||r!==r)&&(r=o),(a<n||n!==n)&&(n=a),f>=0?(l=(e.min.z-d.z)*f,h=(e.max.z-d.z)*f):(l=(e.max.z-d.z)*f,h=(e.min.z-d.z)*f),r>h||l>n)||((l>r||r!==r)&&(r=l),(h<n||n!==n)&&(n=h),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(e){return this.intersectBox(e,ao)!==null}intersectTriangle(e,i,r,n,o){Vy.subVectors(i,e),Mm.subVectors(r,e),jy.crossVectors(Vy,Mm);let a=this.direction.dot(jy),l;if(a>0){if(n)return null;l=1}else if(a<0)l=-1,a=-a;else return null;Vo.subVectors(this.origin,e);let h=l*this.direction.dot(Mm.crossVectors(Vo,Mm));if(h<0)return null;let u=l*this.direction.dot(Vy.cross(Vo));if(u<0||h+u>a)return null;let c=-l*Vo.dot(jy);return c<0?null:this.at(c/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};var ns=new j,lo=new j,qy=new j,ho=new j,jl=new j,ql=new j,FA=new j,Xy=new j,Yy=new j,Zy=new j,Xl=class t{constructor(e=new j,i=new j,r=new j){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,n){n.subVectors(r,i),ns.subVectors(e,i),n.cross(ns);let o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}static getBarycoord(e,i,r,n,o){ns.subVectors(n,i),lo.subVectors(r,i),qy.subVectors(e,i);let a=ns.dot(ns),l=ns.dot(lo),h=ns.dot(qy),u=lo.dot(lo),c=lo.dot(qy),f=a*u-l*l;if(f===0)return o.set(-2,-1,-1);let d=1/f,m=(u*h-l*c)*d,p=(a*c-l*h)*d;return o.set(1-m-p,p,m)}static containsPoint(e,i,r,n){return this.getBarycoord(e,i,r,n,ho),ho.x>=0&&ho.y>=0&&ho.x+ho.y<=1}static getUV(e,i,r,n,o,a,l,h){return this.getBarycoord(e,i,r,n,ho),h.set(0,0),h.addScaledVector(o,ho.x),h.addScaledVector(a,ho.y),h.addScaledVector(l,ho.z),h}static isFrontFacing(e,i,r,n){return ns.subVectors(r,i),lo.subVectors(e,i),ns.cross(lo).dot(n)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,n){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,i,r,n){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ns.subVectors(this.c,this.b),lo.subVectors(this.a,this.b),ns.cross(lo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return t.getBarycoord(e,this.a,this.b,this.c,i)}getUV(e,i,r,n,o){return t.getUV(e,this.a,this.b,this.c,i,r,n,o)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let r=this.a,n=this.b,o=this.c,a,l;jl.subVectors(n,r),ql.subVectors(o,r),Xy.subVectors(e,r);let h=jl.dot(Xy),u=ql.dot(Xy);if(h<=0&&u<=0)return i.copy(r);Yy.subVectors(e,n);let c=jl.dot(Yy),f=ql.dot(Yy);if(c>=0&&f<=c)return i.copy(n);let d=h*f-c*u;if(d<=0&&h>=0&&c<=0)return a=h/(h-c),i.copy(r).addScaledVector(jl,a);Zy.subVectors(e,o);let m=jl.dot(Zy),p=ql.dot(Zy);if(p>=0&&m<=p)return i.copy(o);let v=m*u-h*p;if(v<=0&&u>=0&&p<=0)return l=u/(u-p),i.copy(r).addScaledVector(ql,l);let g=c*p-m*f;if(g<=0&&f-c>=0&&m-p>=0)return FA.subVectors(o,n),l=(f-c)/(f-c+(m-p)),i.copy(n).addScaledVector(FA,l);let _=1/(g+v+d);return a=v*_,l=d*_,i.copy(r).addScaledVector(jl,a).addScaledVector(ql,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};var ki=class extends gr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};ki.prototype.isMeshBasicMaterial=!0;var BA=new dt,Yl=new jo,Ky=new Xr,qo=new j,Xo=new j,Yo=new j,Qy=new j,Jy=new j,$y=new j,Tm=new j,Am=new j,Pm=new j,Rm=new $e,Lm=new $e,Om=new $e,ex=new j,Dm=new j,_t=class extends ii{constructor(e=new pt,i=new ki){super(),this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let i=e.morphAttributes,r=Object.keys(i);if(r.length>0){let n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=n.length;o<a;o++){let l=n[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=o}}}}else{let i=e.morphTargets;i!==void 0&&i.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,i){let r=this.geometry,n=this.material,o=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),Ky.copy(r.boundingSphere),Ky.applyMatrix4(o),e.ray.intersectsSphere(Ky)===!1)||(BA.copy(o).invert(),Yl.copy(e.ray).applyMatrix4(BA),r.boundingBox!==null&&Yl.intersectsBox(r.boundingBox)===!1))return;let a;if(r.isBufferGeometry){let l=r.index,h=r.attributes.position,u=r.morphAttributes.position,c=r.morphTargetsRelative,f=r.attributes.uv,d=r.attributes.uv2,m=r.groups,p=r.drawRange;if(l!==null)if(Array.isArray(n))for(let v=0,g=m.length;v<g;v++){let _=m[v],x=n[_.materialIndex],b=Math.max(_.start,p.start),y=Math.min(l.count,Math.min(_.start+_.count,p.start+p.count));for(let S=b,w=y;S<w;S+=3){let M=l.getX(S),C=l.getX(S+1),E=l.getX(S+2);a=Im(this,x,e,Yl,h,u,c,f,d,M,C,E),a&&(a.faceIndex=Math.floor(S/3),a.face.materialIndex=_.materialIndex,i.push(a))}}else{let v=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);for(let _=v,x=g;_<x;_+=3){let b=l.getX(_),y=l.getX(_+1),S=l.getX(_+2);a=Im(this,n,e,Yl,h,u,c,f,d,b,y,S),a&&(a.faceIndex=Math.floor(_/3),i.push(a))}}else if(h!==void 0)if(Array.isArray(n))for(let v=0,g=m.length;v<g;v++){let _=m[v],x=n[_.materialIndex],b=Math.max(_.start,p.start),y=Math.min(h.count,Math.min(_.start+_.count,p.start+p.count));for(let S=b,w=y;S<w;S+=3){let M=S,C=S+1,E=S+2;a=Im(this,x,e,Yl,h,u,c,f,d,M,C,E),a&&(a.faceIndex=Math.floor(S/3),a.face.materialIndex=_.materialIndex,i.push(a))}}else{let v=Math.max(0,p.start),g=Math.min(h.count,p.start+p.count);for(let _=v,x=g;_<x;_+=3){let b=_,y=_+1,S=_+2;a=Im(this,n,e,Yl,h,u,c,f,d,b,y,S),a&&(a.faceIndex=Math.floor(_/3),i.push(a))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};_t.prototype.isMesh=!0;function tH(t,e,i,r,n,o,a,l){let h;if(e.side===Li?h=r.intersectTriangle(a,o,n,!0,l):h=r.intersectTriangle(n,o,a,e.side!==qt,l),h===null)return null;Dm.copy(l),Dm.applyMatrix4(t.matrixWorld);let u=i.ray.origin.distanceTo(Dm);return u<i.near||u>i.far?null:{distance:u,point:Dm.clone(),object:t}}function Im(t,e,i,r,n,o,a,l,h,u,c,f){qo.fromBufferAttribute(n,u),Xo.fromBufferAttribute(n,c),Yo.fromBufferAttribute(n,f);let d=t.morphTargetInfluences;if(o&&d){Tm.set(0,0,0),Am.set(0,0,0),Pm.set(0,0,0);for(let p=0,v=o.length;p<v;p++){let g=d[p],_=o[p];g!==0&&(Qy.fromBufferAttribute(_,u),Jy.fromBufferAttribute(_,c),$y.fromBufferAttribute(_,f),a?(Tm.addScaledVector(Qy,g),Am.addScaledVector(Jy,g),Pm.addScaledVector($y,g)):(Tm.addScaledVector(Qy.sub(qo),g),Am.addScaledVector(Jy.sub(Xo),g),Pm.addScaledVector($y.sub(Yo),g)))}qo.add(Tm),Xo.add(Am),Yo.add(Pm)}t.isSkinnedMesh&&(t.boneTransform(u,qo),t.boneTransform(c,Xo),t.boneTransform(f,Yo));let m=tH(t,e,i,r,qo,Xo,Yo,ex);if(m){l&&(Rm.fromBufferAttribute(l,u),Lm.fromBufferAttribute(l,c),Om.fromBufferAttribute(l,f),m.uv=Xl.getUV(ex,qo,Xo,Yo,Rm,Lm,Om,new $e)),h&&(Rm.fromBufferAttribute(h,u),Lm.fromBufferAttribute(h,c),Om.fromBufferAttribute(h,f),m.uv2=Xl.getUV(ex,qo,Xo,Yo,Rm,Lm,Om,new $e));let p={a:u,b:c,c:f,normal:new j,materialIndex:0};Xl.getNormal(qo,Xo,Yo,p.normal),m.face=p}return m}var NA=`
#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, vUv ).g;

#endif
`;var UA=`
#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`;var zA=`
#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

#endif
`;var GA=`
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif
`;var HA=`
#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif

#endif
`;var WA=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif
`;var VA=`
vec3 transformed = vec3( position );
`;var jA=`
vec3 objectNormal = vec3( normal );

#ifdef USE_TANGENT

	vec3 objectTangent = vec3( tangent.xyz );

#endif
`;var qA=`

vec3 BRDF_Lambert( const in vec3 diffuseColor ) {

	return RECIPROCAL_PI * diffuseColor;

} // validated

vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {

	// Original approximation by Christophe Schlick '94
	// float fresnel = pow( 1.0 - dotVH, 5.0 );

	// Optimized variant (presented by Epic at SIGGRAPH '13)
	// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );

	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );

} // validated

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {

	float a2 = pow2( alpha );

	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );

	return 0.5 / max( gv + gl, EPSILON );

}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX( const in float alpha, const in float dotNH ) {

	float a2 = pow2( alpha );

	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1

	return RECIPROCAL_PI * a2 / pow2( denom );

}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {

	float alpha = pow2( roughness ); // UE4's roughness

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( f0, f90, dotVH );

	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );

	float D = D_GGX( alpha, dotNH );

	return F * ( V * D );

}

// Rect Area Light

// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines
// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt
// code: https://github.com/selfshadow/ltc_code/

vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	float dotNV = saturate( dot( N, V ) );

	// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );

	uv = uv * LUT_SCALE + LUT_BIAS;

	return uv;

}

float LTC_ClippedSphereFormFactor( const in vec3 f ) {

	// Real-Time Area Lighting: a Journey from Research to Production (p.102)
	// An approximation of the form factor of a horizon-clipped rectangle.

	float l = length( f );

	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );

}

vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {

	float x = dot( v1, v2 );

	float y = abs( x );

	// rational polynomial approximation to theta / sin( theta ) / 2PI
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;

	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;

	return cross( v1, v2 ) * theta_sintheta;

}

vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {

	// bail if point is on back side of plane of light
	// assumes ccw winding order of light vertices
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );

	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );

	// construct orthonormal basis around N
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system

	// compute transform
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );

	// transform rect
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );

	// project rect onto sphere
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );

	// calculate vector form factor
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );

	// adjust for horizon clipping
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );

/*
	// alternate method of adjusting for horizon clipping (see referece)
	// refactoring required
	float len = length( vectorFormFactor );
	float z = vectorFormFactor.z / len;

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	// tabulated horizon-clipped sphere, apparently...
	vec2 uv = vec2( z * 0.5 + 0.5, len );
	uv = uv * LUT_SCALE + LUT_BIAS;

	float scale = texture2D( ltc_2, uv ).w;

	float result = len * scale;
*/

	return vec3( result );

}

// End Rect Area Light


float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {

	// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)
	return 0.25;

}

float D_BlinnPhong( const in float shininess, const in float dotNH ) {

	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );

}

vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( specularColor, 1.0, dotVH );

	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );

	float D = D_BlinnPhong( shininess, dotNH );

	return F * ( G * D );

} // validated

#if defined( USE_SHEEN )

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float D_Charlie( float roughness, float dotNH ) {

	float alpha = pow2( roughness );

	// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16

	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );

}

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float V_Neubelt( float dotNV, float dotNL ) {

	// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );

}

vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );

	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );

	return sheenColor * ( D * V );

}

#endif
`;var XA=`
#ifdef USE_BUMPMAP

	uniform sampler2D bumpMap;
	uniform float bumpScale;

	// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
	// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

	vec2 dHdxy_fwd() {

		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );

		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;

		return vec2( dBx, dBy );

	}

	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;		// normalized

		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );

		float fDet = dot( vSigmaX, R1 ) * faceDirection;

		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );

	}

#endif
`;var YA=`
#if NUM_CLIPPING_PLANES > 0

	vec4 plane;

	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {

		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;

	}
	#pragma unroll_loop_end

	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES

		bool clipped = true;

		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {

			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;

		}
		#pragma unroll_loop_end

		if ( clipped ) discard;

	#endif

#endif
`;var ZA=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];

#endif
`;var KA=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

#endif
`;var QA=`
#if NUM_CLIPPING_PLANES > 0

	vClipPosition = - mvPosition.xyz;

#endif
`;var JA=`
#if defined( USE_COLOR_ALPHA )

	diffuseColor *= vColor;

#elif defined( USE_COLOR )

	diffuseColor.rgb *= vColor;

#endif
`;var $A=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR )

	varying vec3 vColor;

#endif
`;var eP=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )

	varying vec3 vColor;

#endif
`;var tP=`
#if defined( USE_COLOR_ALPHA )

	vColor = vec4( 1.0 );

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )

	vColor = vec3( 1.0 );

#endif

#ifdef USE_COLOR

	vColor *= color;

#endif

#ifdef USE_INSTANCING_COLOR

	vColor.xyz *= instanceColor.xyz;

#endif
`;var iP=`
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
// <tonemapping_pars_fragment> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {

	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

	return fract( sin( sn ) * c );

}

#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif

struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};

struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};

struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};

vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

}

vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {

	// dir can be either a direction vector or a normal vector
	// upper-left 3x3 of matrix is assumed to be orthogonal

	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );

}

mat3 transposeMat3( const in mat3 m ) {

	mat3 tmp;

	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );

	return tmp;

}

// https://en.wikipedia.org/wiki/Relative_luminance
float linearToRelativeLuminance( const in vec3 color ) {

	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );

	return dot( weights, color.rgb );

}

bool isPerspectiveMatrix( mat4 m ) {

	return m[ 2 ][ 3 ] == - 1.0;

}

vec2 equirectUv( in vec3 dir ) {

	// dir is assumed to be unit length

	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;

	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;

	return vec2( u, v );

}
`;var rP=`
#ifdef ENVMAP_TYPE_CUBE_UV

	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0

	// These shader functions convert between the UV coordinates of a single face of
	// a cubemap, the 0-5 integer index of a cube face, and the direction vector for
	// sampling a textureCube (not generally normalized ).

	float getFace( vec3 direction ) {

		vec3 absDirection = abs( direction );

		float face = - 1.0;

		if ( absDirection.x > absDirection.z ) {

			if ( absDirection.x > absDirection.y )

				face = direction.x > 0.0 ? 0.0 : 3.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		} else {

			if ( absDirection.z > absDirection.y )

				face = direction.z > 0.0 ? 2.0 : 5.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		}

		return face;

	}

	// RH coordinate system; PMREM face-indexing convention
	vec2 getUV( vec3 direction, float face ) {

		vec2 uv;

		if ( face == 0.0 ) {

			uv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x

		} else if ( face == 1.0 ) {

			uv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y

		} else if ( face == 2.0 ) {

			uv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z

		} else if ( face == 3.0 ) {

			uv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x

		} else if ( face == 4.0 ) {

			uv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y

		} else {

			uv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z

		}

		return 0.5 * ( uv + 1.0 );

	}

	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {

		float face = getFace( direction );

		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );

		mipInt = max( mipInt, cubeUV_minMipLevel );

		float faceSize = exp2( mipInt );

		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;

		if ( face > 2.0 ) {

			uv.y += faceSize;

			face -= 3.0;

		}

		uv.x += face * faceSize;

		uv.x += filterInt * 3.0 * cubeUV_minTileSize;

		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );

		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;

		#ifdef texture2DGradEXT

			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering

		#else

			return texture2D( envMap, uv ).rgb;

		#endif

	}

	// These defines must match with PMREMGenerator

	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0

	float roughnessToMip( float roughness ) {

		float mip = 0.0;

		if ( roughness >= r1 ) {

			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;

		} else if ( roughness >= r4 ) {

			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;

		} else if ( roughness >= r5 ) {

			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;

		} else if ( roughness >= r6 ) {

			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;

		} else {

			mip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25
		}

		return mip;

	}

	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {

		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );

		float mipF = fract( mip );

		float mipInt = floor( mip );

		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );

		if ( mipF == 0.0 ) {

			return vec4( color0, 1.0 );

		} else {

			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );

			return vec4( mix( color0, color1, mipF ), 1.0 );

		}

	}

#endif
`;var nP=`
vec3 transformedNormal = objectNormal;

#ifdef USE_INSTANCING

	// this is in lieu of a per-instance normal-matrix
	// shear transforms in the instance matrix are not supported

	mat3 m = mat3( instanceMatrix );

	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );

	transformedNormal = m * transformedNormal;

#endif

transformedNormal = normalMatrix * transformedNormal;

#ifdef FLIP_SIDED

	transformedNormal = - transformedNormal;

#endif

#ifdef USE_TANGENT

	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#ifdef FLIP_SIDED

		transformedTangent = - transformedTangent;

	#endif

#endif
`;var sP=`
#ifdef USE_DISPLACEMENTMAP

	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;

#endif
`;var oP=`
#ifdef USE_DISPLACEMENTMAP

	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );

#endif
`;var aP=`
#ifdef USE_EMISSIVEMAP

	vec4 emissiveColor = texture2D( emissiveMap, vUv );

	totalEmissiveRadiance *= emissiveColor.rgb;

#endif
`;var lP=`
#ifdef USE_EMISSIVEMAP

	uniform sampler2D emissiveMap;

#endif
`;var hP=`
gl_FragColor = linearToOutputTexel( gl_FragColor );
`;var uP=`

vec4 LinearToLinear( in vec4 value ) {
	return value;
}

vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}

`;var cP=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vec3 cameraToFrag;

		if ( isOrthographic ) {

			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToFrag = normalize( vWorldPosition - cameraPosition );

		}

		// Transforming Normal Vectors with the Inverse Transformation
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vec3 reflectVec = reflect( cameraToFrag, worldNormal );

		#else

			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );

		#endif

	#else

		vec3 reflectVec = vReflect;

	#endif

	#ifdef ENVMAP_TYPE_CUBE

		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#elif defined( ENVMAP_TYPE_CUBE_UV )

		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );

	#else

		vec4 envColor = vec4( 0.0 );

	#endif

	#ifdef ENVMAP_BLENDING_MULTIPLY

		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_MIX )

		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_ADD )

		outgoingLight += envColor.xyz * specularStrength * reflectivity;

	#endif

#endif
`;var fP=`
#ifdef USE_ENVMAP

	uniform float envMapIntensity;
	uniform float flipEnvMap;

	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif
`;var dP=`
#ifdef USE_ENVMAP

	uniform float reflectivity;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS

		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif

#endif
`;var pP=`
#ifdef USE_ENVMAP

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;

	#else

		varying vec3 vReflect;
		uniform float refractionRatio;

	#endif

#endif
`;var mP=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vWorldPosition = worldPosition.xyz;

	#else

		vec3 cameraToVertex;

		if ( isOrthographic ) {

			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );

		}

		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vReflect = reflect( cameraToVertex, worldNormal );

		#else

			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );

		#endif

	#endif

#endif
`;var gP=`
#ifdef USE_FOG

	vFogDepth = - mvPosition.z;

#endif
`;var vP=`
#ifdef USE_FOG

	varying float vFogDepth;

#endif
`;var _P=`
#ifdef USE_FOG

	#ifdef FOG_EXP2

		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );

	#else

		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );

	#endif

	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );

#endif
`;var yP=`
#ifdef USE_FOG

	uniform vec3 fogColor;
	varying float vFogDepth;

	#ifdef FOG_EXP2

		uniform float fogDensity;

	#else

		uniform float fogNear;
		uniform float fogFar;

	#endif

#endif
`;var xP=`

#ifdef USE_GRADIENTMAP

	uniform sampler2D gradientMap;

#endif

vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {

	// dotNL will be from -1.0 to 1.0
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );

	#ifdef USE_GRADIENTMAP

		return vec3( texture2D( gradientMap, coord ).r );

	#else

		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );

	#endif

}
`;var bP=`
#ifdef USE_LIGHTMAP

	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;

	reflectedLight.indirectDiffuse += lightMapIrradiance;

#endif
`;var wP=`
#ifdef USE_LIGHTMAP

	uniform sampler2D lightMap;
	uniform float lightMapIntensity;

#endif
`;var SP=`
vec3 diffuse = vec3( 1.0 );

GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );

GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;

vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif

IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;

vIndirectFront += getAmbientLightIrradiance( ambientLightColor );

vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );

#ifdef DOUBLE_SIDED

	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );

	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );

#endif

#if NUM_POINT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		getPointLightInfo( pointLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_SPOT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		getSpotLightInfo( spotLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif
	}
	#pragma unroll_loop_end

#endif

#if NUM_DIR_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_HEMI_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );

		#ifdef DOUBLE_SIDED

			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );

		#endif

	}
	#pragma unroll_loop_end

#endif
`;var CP=`
uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];

// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere
// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

	// normal is assumed to have unit length

	float x = normal.x, y = normal.y, z = normal.z;

	// band 0
	vec3 result = shCoefficients[ 0 ] * 0.886227;

	// band 1
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

	// band 2
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );

	return result;

}

vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {

	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );

	return irradiance;

}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {

	vec3 irradiance = ambientLightColor;

	return irradiance;

}

float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

	#if defined ( PHYSICALLY_CORRECT_LIGHTS )

		// based upon Frostbite 3 Moving to Physically-based Rendering
		// page 32, equation 26: E[window1]
		// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );

		if ( cutoffDistance > 0.0 ) {

			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

		}

		return distanceFalloff;

	#else

		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {

			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );

		}

		return 1.0;

	#endif

}

float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {

	return smoothstep( coneCosine, penumbraCosine, angleCosine );

}

#if NUM_DIR_LIGHTS > 0

	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};

	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];

	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {

		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;

	}

#endif


#if NUM_POINT_LIGHTS > 0

	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};

	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {

		vec3 lVector = pointLight.position - geometry.position;

		light.direction = normalize( lVector );

		float lightDistance = length( lVector );

		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );

	}

#endif


#if NUM_SPOT_LIGHTS > 0

	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};

	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {

		vec3 lVector = spotLight.position - geometry.position;

		light.direction = normalize( lVector );

		float angleCos = dot( light.direction, spotLight.direction );

		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );

		if ( spotAttenuation > 0.0 ) {

			float lightDistance = length( lVector );

			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );

		} else {

			light.color = vec3( 0.0 );
			light.visible = false;

		}

	}

#endif


#if NUM_RECT_AREA_LIGHTS > 0

	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};

	// Pre-computed values of LinearTransformedCosine approximation of BRDF
	// BRDF approximation Texture is 64x64
	uniform sampler2D ltc_1; // RGBA Float
	uniform sampler2D ltc_2; // RGBA Float

	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];

#endif


#if NUM_HEMI_LIGHTS > 0

	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};

	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];

	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {

		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;

		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );

		return irradiance;

	}

#endif
`;var EP=`
#if defined( USE_ENVMAP )

	vec3 getIBLIrradiance( const in vec3 normal ) {

		#if defined( ENVMAP_TYPE_CUBE_UV )

			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );

			return PI * envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {

		#if defined( ENVMAP_TYPE_CUBE_UV )

			vec3 reflectVec = reflect( - viewDir, normal );

			// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );

			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );

			return envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

#endif
`;var MP=`
ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
`;var TP=`
varying vec3 vViewPosition;

struct ToonMaterial {

	vec3 diffuseColor;

};

void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon

#define Material_LightProbeLOD( material )	(0)
`;var AP=`
BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`;var PP=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong

#define Material_LightProbeLOD( material )	(0)
`;var RP=`
PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );

vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );

material.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.
material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );

#ifdef IOR

	#ifdef SPECULAR

		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;

		#ifdef USE_SPECULARINTENSITYMAP

			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;

		#endif

		#ifdef USE_SPECULARCOLORMAP

			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;

		#endif

		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );

	#else

		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;

	#endif

	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );

#else

	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;

#endif

#ifdef USE_CLEARCOAT

	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;

	#ifdef USE_CLEARCOATMAP

		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;

	#endif

	#ifdef USE_CLEARCOAT_ROUGHNESSMAP

		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;

	#endif

	material.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model
	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );

#endif

#ifdef USE_SHEEN

	material.sheenColor = sheenColor;

	#ifdef USE_SHEENCOLORMAP

		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;

	#endif

	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );

	#ifdef USE_SHEENROUGHNESSMAP

		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;

	#endif

#endif
`;var LP=`
struct PhysicalMaterial {

	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;

	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif

	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif

};

// temporary
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );

// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from 
// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found
// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {

	float dotNV = saturate( dot( normal, viewDir ) );

	float r2 = roughness * roughness;

	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;

	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;

	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );

	return saturate( DG * RECIPROCAL_PI );

}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {

	float dotNV = saturate( dot( normal, viewDir ) );

	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );

	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );

	vec4 r = roughness * c0 + c1;

	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;

	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;

	return fab;

}

vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	return specularColor * fab.x + specularF90 * fab.y;

}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;

	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;

	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21
	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );

	singleScatter += FssEss;
	multiScatter += Fms * Ems;

}

#if NUM_RECT_AREA_LIGHTS > 0

	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;

		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction
		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;

		vec2 uv = LTC_Uv( normal, viewDir, roughness );

		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );

		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);

		// LTC Fresnel Approximation by Stephen Hill
		// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );

		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );

		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );

	}

#endif

void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );

	vec3 irradiance = dotNL * directLight.color;

	#ifdef USE_CLEARCOAT

		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );

		vec3 ccIrradiance = dotNLcc * directLight.color;

		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );

	#endif

	#ifdef USE_SHEEN

		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );

	#endif

	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );


	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {

	#ifdef USE_CLEARCOAT

		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );

	#endif

	#ifdef USE_SHEEN

		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );

	#endif

	// Both indirect specular and indirect diffuse light accumulate here

	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;

	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );

	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );

	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;

	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;

}

#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical

// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {

	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );

}
`;var OP=`
/**
 * This is a template that can be used to light a material, it uses pluggable
 * RenderEquations (RE)for specific lighting scenarios.
 *
 * Instructions for use:
 * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined
 * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???
 * - Create a material parameter that is to be passed as the third parameter to your lighting functions.
 *
 * TODO:
 * - Add area light support.
 * - Add sphere light support.
 * - Add diffuse light probe (irradiance cubemap) support.
 */

GeometricContext geometry;

geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

#ifdef USE_CLEARCOAT

	geometry.clearcoatNormal = clearcoatNormal;

#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`;var DP=`
#if defined( RE_IndirectDiffuse )

	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;

		irradiance += lightMapIrradiance;

	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )

		iblIrradiance += getIBLIrradiance( geometry.normal );

	#endif

#endif

#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )

	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );

	#ifdef USE_CLEARCOAT

		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );

	#endif

#endif
`;var IP=`
#if defined( RE_IndirectDiffuse )

	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );

#endif

#if defined( RE_IndirectSpecular )

	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );

#endif
`;var kP=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	// Doing a strict comparison with == 1.0 can cause noise artifacts
	// on some platforms. See issue #17623.
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;

#endif
`;var FP=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;

#endif
`;var BP=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		varying float vFragDepth;
		varying float vIsPerspective;

	#else

		uniform float logDepthBufFC;

	#endif

#endif
`;var NP=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );

	#else

		if ( isPerspectiveMatrix( projectionMatrix ) ) {

			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;

			gl_Position.z *= gl_Position.w;

		}

	#endif

#endif
`;var UP=`
#ifdef USE_MAP

	vec4 sampledDiffuseColor = texture2D( map, vUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)

		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );

	#endif

	diffuseColor *= sampledDiffuseColor;

#endif
`;var zP=`
#ifdef USE_MAP

	uniform sampler2D map;

#endif
`;var GP=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;

#endif

#ifdef USE_MAP

	diffuseColor *= texture2D( map, uv );

#endif

#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, uv ).g;

#endif
`;var HP=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	uniform mat3 uvTransform;

#endif

#ifdef USE_MAP

	uniform sampler2D map;

#endif

#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`;var WP=`
float metalnessFactor = metalness;

#ifdef USE_METALNESSMAP

	vec4 texelMetalness = texture2D( metalnessMap, vUv );

	// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	metalnessFactor *= texelMetalness.b;

#endif
`;var VP=`
#ifdef USE_METALNESSMAP

	uniform sampler2D metalnessMap;

#endif
`;var jP=`
#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	vColor *= morphTargetBaseInfluence;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		#if defined( USE_COLOR_ALPHA )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];

		#elif defined( USE_COLOR )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];

		#endif

	}

#endif
`;var qP=`
#ifdef USE_MORPHNORMALS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	objectNormal *= morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];

		}

	#else

		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];

	#endif

#endif
`;var XP=`
#ifdef USE_MORPHTARGETS

	uniform float morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;

		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {

			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;

			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );

		}

	#else

		#ifndef USE_MORPHNORMALS

			uniform float morphTargetInfluences[ 8 ];

		#else

			uniform float morphTargetInfluences[ 4 ];

		#endif

	#endif

#endif
`;var YP=`
#ifdef USE_MORPHTARGETS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	transformed *= morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];

		}

	#else

		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];

		#ifndef USE_MORPHNORMALS

			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];

		#endif

	#endif

#endif
`;var ZP=`
float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;

#ifdef FLAT_SHADED

	// Workaround for Adreno GPUs not able to do dFdx( vViewPosition )

	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );

#else

	vec3 normal = normalize( vNormal );

	#ifdef DOUBLE_SIDED

		normal = normal * faceDirection;

	#endif

	#ifdef USE_TANGENT

		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );

		#ifdef DOUBLE_SIDED

			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;

		#endif

		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )

			mat3 vTBN = mat3( tangent, bitangent, normal );

		#endif

	#endif

#endif

// non perturbed normal for clearcoat among others

vec3 geometryNormal = normal;

`;var KP=`

#ifdef OBJECTSPACE_NORMALMAP

	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

	#ifdef FLIP_SIDED

		normal = - normal;

	#endif

	#ifdef DOUBLE_SIDED

		normal = normal * faceDirection;

	#endif

	normal = normalize( normalMatrix * normal );

#elif defined( TANGENTSPACE_NORMALMAP )

	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;

	#ifdef USE_TANGENT

		normal = normalize( vTBN * mapN );

	#else

		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );

	#endif

#elif defined( USE_BUMPMAP )

	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );

#endif
`;var QP=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`;var JP=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`;var $P=`
#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

	#ifdef USE_TANGENT

		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );

	#endif

#endif
`;var e2=`
#ifdef USE_NORMALMAP

	uniform sampler2D normalMap;
	uniform vec2 normalScale;

#endif

#ifdef OBJECTSPACE_NORMALMAP

	uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )

	// Normal Mapping Without Precomputed Tangents
	// http://www.thetenthplanet.de/archives/1180

	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );

		vec3 N = surf_norm; // normalized

		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );

		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;

		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );

		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );

	}

#endif
`;var t2=`
#ifdef USE_CLEARCOAT

	vec3 clearcoatNormal = geometryNormal;

#endif
`;var i2=`
#ifdef USE_CLEARCOAT_NORMALMAP

	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;

	#ifdef USE_TANGENT

		clearcoatNormal = normalize( vTBN * clearcoatMapN );

	#else

		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );

	#endif

#endif
`;var r2=`

#ifdef USE_CLEARCOATMAP

	uniform sampler2D clearcoatMap;

#endif

#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform sampler2D clearcoatRoughnessMap;

#endif

#ifdef USE_CLEARCOAT_NORMALMAP

	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;

#endif
`;var n2=`
#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif

gl_FragColor = vec4( outgoingLight, diffuseColor.a );
`;var s2=`
vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}

vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}

const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)

const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

const float ShiftRight8 = 1. / 256.;

vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8; // tidy overflow
	return r * PackUpscale;
}

float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}

vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}

vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}

// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions

float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}

// NOTE: https://twitter.com/gonnavis/status/1377183786949959682

float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`;var o2=`
#ifdef PREMULTIPLIED_ALPHA

	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;

#endif
`;var a2=`
vec4 mvPosition = vec4( transformed, 1.0 );

#ifdef USE_INSTANCING

	mvPosition = instanceMatrix * mvPosition;

#endif

mvPosition = modelViewMatrix * mvPosition;

gl_Position = projectionMatrix * mvPosition;
`;var l2=`
#ifdef DITHERING

	gl_FragColor.rgb = dithering( gl_FragColor.rgb );

#endif
`;var h2=`
#ifdef DITHERING

	// based on https://www.shadertoy.com/view/MslGR8
	vec3 dithering( vec3 color ) {
		//Calculate grid position
		float grid_position = rand( gl_FragCoord.xy );

		//Shift the individual colors differently, thus making it even harder to see the dithering pattern
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );

		//modify shift according to grid position.
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );

		//shift the color by dither_shift
		return color + dither_shift_RGB;
	}

#endif
`;var u2=`
float roughnessFactor = roughness;

#ifdef USE_ROUGHNESSMAP

	vec4 texelRoughness = texture2D( roughnessMap, vUv );

	// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	roughnessFactor *= texelRoughness.g;

#endif
`;var c2=`
#ifdef USE_ROUGHNESSMAP

	uniform sampler2D roughnessMap;

#endif
`;var f2=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): create uniforms for area light shadows

	#endif
	*/

	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

	}

	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

		return unpackRGBATo2Half( texture2D( shadow, uv ) );

	}

	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

		float occlusion = 1.0;

		vec2 distribution = texture2DDistribution( shadow, uv );

		float hard_shadow = step( compare , distribution.x ); // Hard Shadow

		if (hard_shadow != 1.0 ) {

			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

		}
		return occlusion;

	}

	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

		float shadow = 1.0;

		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;

		// if ( something && something ) breaks ATI OpenGL shader compiler
		// if ( all( something, something ) ) using this instead

		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );

		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

		bool frustumTest = all( frustumTestVec );

		if ( frustumTest ) {

		#if defined( SHADOWMAP_TYPE_PCF )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;

			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;

			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );

		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;

			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;

			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );

		#elif defined( SHADOWMAP_TYPE_VSM )

			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

		#else // no percentage-closer filtering:

			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

		#endif

		}

		return shadow;

	}

	// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
	// vector suitable for 2D texture mapping. This code uses the following layout for the
	// 2D texture:
	//
	// xzXZ
	//  y Y
	//
	// Y - Positive y direction
	// y - Negative y direction
	// X - Positive x direction
	// x - Negative x direction
	// Z - Positive z direction
	// z - Negative z direction
	//
	// Source and test bed:
	// https://gist.github.com/tschw/da10c43c467ce8afd0c4

	vec2 cubeToUV( vec3 v, float texelSizeY ) {

		// Number of texels to avoid at the edge of each square

		vec3 absV = abs( v );

		// Intersect unit cube

		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;

		// Apply scale to avoid seams

		// two texels less per square (one texel will do for NEAREST)
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

		// Unwrap

		// space: -1 ... 1 range for each square
		//
		// #X##		dim    := ( 4 , 2 )
		//  # #		center := ( 1 , 1 )

		vec2 planar = v.xy;

		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;

		if ( absV.z >= almostOne ) {

			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;

		} else if ( absV.x >= almostOne ) {

			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;

		} else if ( absV.y >= almostOne ) {

			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;

		}

		// Transform to UV space

		// scale := 0.5 / dim
		// translate := ( center + 0.5 ) / dim
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

	}

	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

		// for point lights, the uniform @vShadowCoord is re-purposed to hold
		// the vector from the light to the world-space position of the fragment.
		vec3 lightToPosition = shadowCoord.xyz;

		// dp = normalized distance from light to fragment position
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
		dp += shadowBias;

		// bd3D = base direction 3D
		vec3 bd3D = normalize( lightToPosition );

		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )

			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;

			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );

		#else // no percentage-closer filtering

			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );

		#endif

	}

#endif
`;var d2=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): uniforms for area light shadows

	#endif
	*/

#endif
`;var p2=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0

		// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;

	#endif

	#if NUM_DIR_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update vAreaShadowCoord with area light info

	#endif
	*/

#endif
`;var m2=`
float getShadowMask() {

	float shadow = 1.0;

	#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

	DirectionalLightShadow directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	SpotLightShadow spotLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	PointLightShadow pointLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update shadow for Area light

	#endif
	*/

	#endif

	return shadow;

}
`;var g2=`
#ifdef USE_SKINNING

	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );

#endif
`;var v2=`
#ifdef USE_SKINNING

	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;

	#ifdef BONE_TEXTURE

		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;

		mat4 getBoneMatrix( const in float i ) {

			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );

			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );

			y = dy * ( y + 0.5 );

			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );

			mat4 bone = mat4( v1, v2, v3, v4 );

			return bone;

		}

	#else

		uniform mat4 boneMatrices[ MAX_BONES ];

		mat4 getBoneMatrix( const in float i ) {

			mat4 bone = boneMatrices[ int(i) ];
			return bone;

		}

	#endif

#endif
`;var _2=`
#ifdef USE_SKINNING

	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );

	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;

	transformed = ( bindMatrixInverse * skinned ).xyz;

#endif
`;var y2=`
#ifdef USE_SKINNING

	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;

	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;

	#ifdef USE_TANGENT

		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#endif

#endif
`;var x2=`
float specularStrength;

#ifdef USE_SPECULARMAP

	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;

#else

	specularStrength = 1.0;

#endif
`;var b2=`
#ifdef USE_SPECULARMAP

	uniform sampler2D specularMap;

#endif
`;var w2=`
#if defined( TONE_MAPPING )

	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );

#endif
`;var S2=`
#ifndef saturate
// <common> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif

uniform float toneMappingExposure;

// exposure only
vec3 LinearToneMapping( vec3 color ) {

	return toneMappingExposure * color;

}

// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf
vec3 ReinhardToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );

}

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 OptimizedCineonToneMapping( vec3 color ) {

	// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );

}

// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs
vec3 RRTAndODTFit( vec3 v ) {

	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;

}

// this implementation of ACES is modified to accommodate a brighter viewing environment.
// the scale factor of 1/0.6 is subjective. see discussion in #19621.

vec3 ACESFilmicToneMapping( vec3 color ) {

	// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);

	// ODT_SAT => XYZ => D60_2_D65 => sRGB
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);

	color *= toneMappingExposure / 0.6;

	color = ACESInputMat * color;

	// Apply RRT and ODT
	color = RRTAndODTFit( color );

	color = ACESOutputMat * color;

	// Clamp to [0, 1]
	return saturate( color );

}

vec3 CustomToneMapping( vec3 color ) { return color; }
`;var C2=`
#ifdef USE_TRANSMISSION

	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;

	#ifdef USE_TRANSMISSIONMAP

		transmissionFactor *= texture2D( transmissionMap, vUv ).r;

	#endif

	#ifdef USE_THICKNESSMAP

		thicknessFactor *= texture2D( thicknessMap, vUv ).g;

	#endif

	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );

	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );

	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif
`;var E2=`
#ifdef USE_TRANSMISSION

	// Transmission code is based on glTF-Sampler-Viewer
	// https://github.com/KhronosGroup/glTF-Sample-Viewer

	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;

	#ifdef USE_TRANSMISSIONMAP

		uniform sampler2D transmissionMap;

	#endif

	#ifdef USE_THICKNESSMAP

		uniform sampler2D thicknessMap;

	#endif

	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;

	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;

	varying vec3 vWorldPosition;

	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {

		// Direction of refracted light.
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );

		// Compute rotation-independant scaling of the model matrix.
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		// The thickness is specified in local space.
		return normalize( refractionVector ) * thickness * modelScale;

	}

	float applyIorToRoughness( const in float roughness, const in float ior ) {

		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );

	}

	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {

		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );

		#ifdef texture2DLodEXT

			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );

		#else

			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );

		#endif

	}

	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {

		if ( attenuationDistance == 0.0 ) {

			// Attenuation distance is +\u221E (which we indicate by zero), i.e. the transmitted color is not attenuated at all.
			return radiance;

		} else {

			// Compute light attenuation using Beer's law.
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
			return transmittance * radiance;

		}

	}

	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {

		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;

		// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;

		// Sample framebuffer to get pixel the refracted ray hits.
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );

		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );

		// Get the specular component.
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );

		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );

	}
#endif
`;var M2=`
#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )

	varying vec2 vUv;

#endif
`;var T2=`
#ifdef USE_UV

	#ifdef UVS_VERTEX_ONLY

		vec2 vUv;

	#else

		varying vec2 vUv;

	#endif

	uniform mat3 uvTransform;

#endif
`;var A2=`
#ifdef USE_UV

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

#endif
`;var P2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	varying vec2 vUv2;

#endif
`;var R2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	attribute vec2 uv2;
	varying vec2 vUv2;

	uniform mat3 uv2Transform;

#endif
`;var L2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;

#endif
`;var O2=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )

	vec4 worldPosition = vec4( transformed, 1.0 );

	#ifdef USE_INSTANCING

		worldPosition = instanceMatrix * worldPosition;

	#endif

	worldPosition = modelMatrix * worldPosition;

#endif
`;var D2=`
varying vec2 vUv;
uniform mat3 uvTransform;

void main() {

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

	gl_Position = vec4( position.xy, 1.0, 1.0 );

}
`,I2=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

	gl_FragColor = texture2D( t2D, vUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)

		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );

	#endif

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var k2=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

	gl_Position.z = gl_Position.w; // set z to camera.far

}
`,F2=`
#include <envmap_common_pars_fragment>
uniform float opacity;

varying vec3 vWorldDirection;

#include <cube_uv_reflection_fragment>

void main() {

	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>

	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var B2=`
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.
// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for
// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.
varying vec2 vHighPrecisionZW;

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vHighPrecisionZW = gl_Position.zw;

}
`,N2=`
#if DEPTH_PACKING == 3200

	uniform float opacity;

#endif

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec2 vHighPrecisionZW;

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#if DEPTH_PACKING == 3200

		diffuseColor.a = opacity;

	#endif

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	#include <logdepthbuf_fragment>

	// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;

	#if DEPTH_PACKING == 3200

		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );

	#elif DEPTH_PACKING == 3201

		gl_FragColor = packDepthToRGBA( fragCoordZ );

	#endif

}
`;var U2=`
#define DISTANCE

varying vec3 vWorldPosition;

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>

	vWorldPosition = worldPosition.xyz;

}
`,z2=`
#define DISTANCE

uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>

void main () {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist ); // clamp to [ 0, 1 ]

	gl_FragColor = packDepthToRGBA( dist );

}
`;var G2=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

}
`,H2=`
uniform sampler2D tEquirect;

varying vec3 vWorldDirection;

#include <common>

void main() {

	vec3 direction = normalize( vWorldDirection );

	vec2 sampleUV = equirectUv( direction );

	gl_FragColor = texture2D( tEquirect, sampleUV );

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var W2=`
uniform float scale;
attribute float lineDistance;

varying float vLineDistance;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	vLineDistance = scale * lineDistance;

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,V2=`
uniform vec3 diffuse;
uniform float opacity;

uniform float dashSize;
uniform float totalSize;

varying float vLineDistance;

#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	if ( mod( vLineDistance, totalSize ) > dashSize ) {

		discard;

	}

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <color_fragment>

	outgoingLight = diffuseColor.rgb; // simple shader

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`;var j2=`
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>

}
`,q2=`
uniform vec3 diffuse;
uniform float opacity;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	// accumulation (baked indirect lighting only)
	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;

	#else

		reflectedLight.indirectDiffuse += vec3( 1.0 );

	#endif

	// modulation
	#include <aomap_fragment>

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

	#include <envmap_fragment>

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var X2=`
#define LAMBERT

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,Y2=`
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif


#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>

	// accumulation

	#ifdef DOUBLE_SIDED

		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

	#else

		reflectedLight.indirectDiffuse += vIndirectFront;

	#endif

	#include <lightmap_fragment>

	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );

	#ifdef DOUBLE_SIDED

		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

	#else

		reflectedLight.directDiffuse = vLightFront;

	#endif

	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();

	// modulation

	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <envmap_fragment>

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`;var Z2=`
#define MATCAP

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

	vViewPosition = - mvPosition.xyz;

}
`,K2=`
#define MATCAP

uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;

varying vec3 vViewPosition;

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks

	#ifdef USE_MATCAP

		vec4 matcapColor = texture2D( matcap, uv );

	#else

		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing

	#endif

	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var Q2=`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	vViewPosition = - mvPosition.xyz;

#endif

}
`,J2=`
#define NORMAL

uniform float opacity;

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );

	#ifdef OPAQUE

		gl_FragColor.a = 1.0;

	#endif

}
`;var $2=`
#define PHONG

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,eR=`
#define PHONG

uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var tR=`
#define STANDARD

varying vec3 vViewPosition;

#ifdef USE_TRANSMISSION

	varying vec3 vWorldPosition;

#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

#ifdef USE_TRANSMISSION

	vWorldPosition = worldPosition.xyz;

#endif
}
`,iR=`
#define STANDARD

#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
	uniform float ior;
#endif

#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;

	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif

	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif

#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif

#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;

	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif

	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

	#include <transmission_fragment>

	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

	#ifdef USE_SHEEN

		// Sheen energy compensation approximation calculation can be found at the end of
		// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;

	#endif

	#ifdef USE_CLEARCOAT

		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );

		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;

	#endif

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var rR=`
#define TOON

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,nR=`
#define TOON

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var sR=`
uniform float size;
uniform float scale;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>

	gl_PointSize = size;

	#ifdef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );

	#endif

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>

}
`,oR=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`;var aR=`
#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>

void main() {

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,lR=`
uniform vec3 color;
uniform float opacity;

#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>

void main() {

	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`;var hR=`
uniform float rotation;
uniform vec2 center;

#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	#ifndef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) scale *= - mvPosition.z;

	#endif

	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,uR=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`;var Rt={alphamap_fragment:NA,alphamap_pars_fragment:UA,alphatest_fragment:zA,alphatest_pars_fragment:GA,aomap_fragment:HA,aomap_pars_fragment:WA,begin_vertex:VA,beginnormal_vertex:jA,bsdfs:qA,bumpmap_pars_fragment:XA,clipping_planes_fragment:YA,clipping_planes_pars_fragment:ZA,clipping_planes_pars_vertex:KA,clipping_planes_vertex:QA,color_fragment:JA,color_pars_fragment:$A,color_pars_vertex:eP,color_vertex:tP,common:iP,cube_uv_reflection_fragment:rP,defaultnormal_vertex:nP,displacementmap_pars_vertex:sP,displacementmap_vertex:oP,emissivemap_fragment:aP,emissivemap_pars_fragment:lP,encodings_fragment:hP,encodings_pars_fragment:uP,envmap_fragment:cP,envmap_common_pars_fragment:fP,envmap_pars_fragment:dP,envmap_pars_vertex:pP,envmap_physical_pars_fragment:EP,envmap_vertex:mP,fog_vertex:gP,fog_pars_vertex:vP,fog_fragment:_P,fog_pars_fragment:yP,gradientmap_pars_fragment:xP,lightmap_fragment:bP,lightmap_pars_fragment:wP,lights_lambert_vertex:SP,lights_pars_begin:CP,lights_toon_fragment:MP,lights_toon_pars_fragment:TP,lights_phong_fragment:AP,lights_phong_pars_fragment:PP,lights_physical_fragment:RP,lights_physical_pars_fragment:LP,lights_fragment_begin:OP,lights_fragment_maps:DP,lights_fragment_end:IP,logdepthbuf_fragment:kP,logdepthbuf_pars_fragment:FP,logdepthbuf_pars_vertex:BP,logdepthbuf_vertex:NP,map_fragment:UP,map_pars_fragment:zP,map_particle_fragment:GP,map_particle_pars_fragment:HP,metalnessmap_fragment:WP,metalnessmap_pars_fragment:VP,morphcolor_vertex:jP,morphnormal_vertex:qP,morphtarget_pars_vertex:XP,morphtarget_vertex:YP,normal_fragment_begin:ZP,normal_fragment_maps:KP,normal_pars_fragment:QP,normal_pars_vertex:JP,normal_vertex:$P,normalmap_pars_fragment:e2,clearcoat_normal_fragment_begin:t2,clearcoat_normal_fragment_maps:i2,clearcoat_pars_fragment:r2,output_fragment:n2,packing:s2,premultiplied_alpha_fragment:o2,project_vertex:a2,dithering_fragment:l2,dithering_pars_fragment:h2,roughnessmap_fragment:u2,roughnessmap_pars_fragment:c2,shadowmap_pars_fragment:f2,shadowmap_pars_vertex:d2,shadowmap_vertex:p2,shadowmask_pars_fragment:m2,skinbase_vertex:g2,skinning_pars_vertex:v2,skinning_vertex:_2,skinnormal_vertex:y2,specularmap_fragment:x2,specularmap_pars_fragment:b2,tonemapping_fragment:w2,tonemapping_pars_fragment:S2,transmission_fragment:C2,transmission_pars_fragment:E2,uv_pars_fragment:M2,uv_pars_vertex:T2,uv_vertex:A2,uv2_pars_fragment:P2,uv2_pars_vertex:R2,uv2_vertex:L2,worldpos_vertex:O2,background_vert:D2,background_frag:I2,cube_vert:k2,cube_frag:F2,depth_vert:B2,depth_frag:N2,distanceRGBA_vert:U2,distanceRGBA_frag:z2,equirect_vert:G2,equirect_frag:H2,linedashed_vert:W2,linedashed_frag:V2,meshbasic_vert:j2,meshbasic_frag:q2,meshlambert_vert:X2,meshlambert_frag:Y2,meshmatcap_vert:Z2,meshmatcap_frag:K2,meshnormal_vert:Q2,meshnormal_frag:J2,meshphong_vert:$2,meshphong_frag:eR,meshphysical_vert:tR,meshphysical_frag:iR,meshtoon_vert:rR,meshtoon_frag:nR,points_vert:sR,points_frag:oR,shadow_vert:aR,shadow_frag:lR,sprite_vert:hR,sprite_frag:uR};var Ne={common:{diffuse:{value:new Ye(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Oi},uv2Transform:{value:new Oi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $e(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ye(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ye(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Oi}},sprite:{diffuse:{value:new Ye(16777215)},opacity:{value:1},center:{value:new $e(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Oi}}};var Tr={basic:{uniforms:hr([Ne.common,Ne.specularmap,Ne.envmap,Ne.aomap,Ne.lightmap,Ne.fog]),vertexShader:Rt.meshbasic_vert,fragmentShader:Rt.meshbasic_frag},lambert:{uniforms:hr([Ne.common,Ne.specularmap,Ne.envmap,Ne.aomap,Ne.lightmap,Ne.emissivemap,Ne.fog,Ne.lights,{emissive:{value:new Ye(0)}}]),vertexShader:Rt.meshlambert_vert,fragmentShader:Rt.meshlambert_frag},phong:{uniforms:hr([Ne.common,Ne.specularmap,Ne.envmap,Ne.aomap,Ne.lightmap,Ne.emissivemap,Ne.bumpmap,Ne.normalmap,Ne.displacementmap,Ne.fog,Ne.lights,{emissive:{value:new Ye(0)},specular:{value:new Ye(1118481)},shininess:{value:30}}]),vertexShader:Rt.meshphong_vert,fragmentShader:Rt.meshphong_frag},standard:{uniforms:hr([Ne.common,Ne.envmap,Ne.aomap,Ne.lightmap,Ne.emissivemap,Ne.bumpmap,Ne.normalmap,Ne.displacementmap,Ne.roughnessmap,Ne.metalnessmap,Ne.fog,Ne.lights,{emissive:{value:new Ye(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag},toon:{uniforms:hr([Ne.common,Ne.aomap,Ne.lightmap,Ne.emissivemap,Ne.bumpmap,Ne.normalmap,Ne.displacementmap,Ne.gradientmap,Ne.fog,Ne.lights,{emissive:{value:new Ye(0)}}]),vertexShader:Rt.meshtoon_vert,fragmentShader:Rt.meshtoon_frag},matcap:{uniforms:hr([Ne.common,Ne.bumpmap,Ne.normalmap,Ne.displacementmap,Ne.fog,{matcap:{value:null}}]),vertexShader:Rt.meshmatcap_vert,fragmentShader:Rt.meshmatcap_frag},points:{uniforms:hr([Ne.points,Ne.fog]),vertexShader:Rt.points_vert,fragmentShader:Rt.points_frag},dashed:{uniforms:hr([Ne.common,Ne.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Rt.linedashed_vert,fragmentShader:Rt.linedashed_frag},depth:{uniforms:hr([Ne.common,Ne.displacementmap]),vertexShader:Rt.depth_vert,fragmentShader:Rt.depth_frag},normal:{uniforms:hr([Ne.common,Ne.bumpmap,Ne.normalmap,Ne.displacementmap,{opacity:{value:1}}]),vertexShader:Rt.meshnormal_vert,fragmentShader:Rt.meshnormal_frag},sprite:{uniforms:hr([Ne.sprite,Ne.fog]),vertexShader:Rt.sprite_vert,fragmentShader:Rt.sprite_frag},background:{uniforms:{uvTransform:{value:new Oi},t2D:{value:null}},vertexShader:Rt.background_vert,fragmentShader:Rt.background_frag},cube:{uniforms:hr([Ne.envmap,{opacity:{value:1}}]),vertexShader:Rt.cube_vert,fragmentShader:Rt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Rt.equirect_vert,fragmentShader:Rt.equirect_frag},distanceRGBA:{uniforms:hr([Ne.common,Ne.displacementmap,{referencePosition:{value:new j},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Rt.distanceRGBA_vert,fragmentShader:Rt.distanceRGBA_frag},shadow:{uniforms:hr([Ne.lights,Ne.fog,{color:{value:new Ye(0)},opacity:{value:1}}]),vertexShader:Rt.shadow_vert,fragmentShader:Rt.shadow_frag}};Tr.physical={uniforms:hr([Tr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $e(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ye(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $e},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ye(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ye(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag};function cR(t,e,i,r,n,o){let a=new Ye(0),l=n===!0?0:1,h,u,c=null,f=0,d=null;function m(v,g){let _=!1,x=g.isScene===!0?g.background:null;x&&x.isTexture&&(x=e.get(x));let b=t.xr,y=b.getSession&&b.getSession();y&&y.environmentBlendMode==="additive"&&(x=null),x===null?p(a,l):x&&x.isColor&&(p(x,1),_=!0),(t.autoClear||_)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Bo)?(u===void 0&&(u=new _t(new rs(1,1,1),new Yr({name:"BackgroundCubeMaterial",uniforms:oo(Tr.cube.uniforms),vertexShader:Tr.cube.vertexShader,fragmentShader:Tr.cube.fragmentShader,side:Li,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,(c!==x||f!==x.version||d!==t.toneMapping)&&(u.material.needsUpdate=!0,c=x,f=x.version,d=t.toneMapping),v.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new _t(new Mr(2,2),new Yr({name:"BackgroundMaterial",uniforms:oo(Tr.background.uniforms),vertexShader:Tr.background.vertexShader,fragmentShader:Tr.background.fragmentShader,side:xi,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||f!==x.version||d!==t.toneMapping)&&(h.material.needsUpdate=!0,c=x,f=x.version,d=t.toneMapping),v.unshift(h,h.geometry,h.material,0,0,null))}function p(v,g){i.buffers.color.setClear(v.r,v.g,v.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(v,g=1){a.set(v),l=g,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,p(a,l)},render:m}}function fR(t,e,i,r){let n=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||o!==null,l={},h=g(null),u=h,c=!1;function f(I,L,T,O,D){let F=!1;if(a){let B=v(O,T,L);u!==B&&(u=B,m(u.object)),F=_(O,D),F&&x(O,D)}else{let B=L.wireframe===!0;(u.geometry!==O.id||u.program!==T.id||u.wireframe!==B)&&(u.geometry=O.id,u.program=T.id,u.wireframe=B,F=!0)}I.isInstancedMesh===!0&&(F=!0),D!==null&&i.update(D,t.ELEMENT_ARRAY_BUFFER),(F||c)&&(c=!1,C(I,L,T,O),D!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(D).buffer))}function d(){return r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()}function m(I){return r.isWebGL2?t.bindVertexArray(I):o.bindVertexArrayOES(I)}function p(I){return r.isWebGL2?t.deleteVertexArray(I):o.deleteVertexArrayOES(I)}function v(I,L,T){let O=T.wireframe===!0,D=l[I.id];D===void 0&&(D={},l[I.id]=D);let F=D[L.id];F===void 0&&(F={},D[L.id]=F);let B=F[O];return B===void 0&&(B=g(d()),F[O]=B),B}function g(I){let L=[],T=[],O=[];for(let D=0;D<n;D++)L[D]=0,T[D]=0,O[D]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:T,attributeDivisors:O,object:I,attributes:{},index:null}}function _(I,L){let T=u.attributes,O=I.attributes,D=0;for(let F in O){let B=T[F],U=O[F];if(B===void 0||B.attribute!==U||B.data!==U.data)return!0;D++}return u.attributesNum!==D||u.index!==L}function x(I,L){let T={},O=I.attributes,D=0;for(let F in O){let B=O[F],U={};U.attribute=B,B.data&&(U.data=B.data),T[F]=U,D++}u.attributes=T,u.attributesNum=D,u.index=L}function b(){let I=u.newAttributes;for(let L=0,T=I.length;L<T;L++)I[L]=0}function y(I){S(I,0)}function S(I,L){let T=u.newAttributes,O=u.enabledAttributes,D=u.attributeDivisors;T[I]=1,O[I]===0&&(t.enableVertexAttribArray(I),O[I]=1),D[I]!==L&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,L),D[I]=L)}function w(){let I=u.newAttributes,L=u.enabledAttributes;for(let T=0,O=L.length;T<O;T++)L[T]!==I[T]&&(t.disableVertexAttribArray(T),L[T]=0)}function M(I,L,T,O,D,F){r.isWebGL2===!0&&(T===t.INT||T===t.UNSIGNED_INT)?t.vertexAttribIPointer(I,L,T,D,F):t.vertexAttribPointer(I,L,T,O,D,F)}function C(I,L,T,O){if(r.isWebGL2===!1&&(I.isInstancedMesh||O.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;b();let D=O.attributes,F=T.getAttributes(),B=L.defaultAttributeValues;for(let U in F){let G=F[U];if(G.location>=0){let Y=D[U];if(Y===void 0&&(U==="instanceMatrix"&&I.instanceMatrix&&(Y=I.instanceMatrix),U==="instanceColor"&&I.instanceColor&&(Y=I.instanceColor)),Y!==void 0){let re=Y.normalized,N=Y.itemSize,z=i.get(Y);if(z===void 0)continue;let ie=z.buffer,Z=z.type,ne=z.bytesPerElement;if(Y.isInterleavedBufferAttribute){let K=Y.data,ae=K.stride,ue=Y.offset;if(K.isInstancedInterleavedBuffer){for(let _e=0;_e<G.locationSize;_e++)S(G.location+_e,K.meshPerAttribute);I.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let _e=0;_e<G.locationSize;_e++)y(G.location+_e);t.bindBuffer(t.ARRAY_BUFFER,ie);for(let _e=0;_e<G.locationSize;_e++)M(G.location+_e,N/G.locationSize,Z,re,ae*ne,(ue+N/G.locationSize*_e)*ne)}else{if(Y.isInstancedBufferAttribute){for(let K=0;K<G.locationSize;K++)S(G.location+K,Y.meshPerAttribute);I.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let K=0;K<G.locationSize;K++)y(G.location+K);t.bindBuffer(t.ARRAY_BUFFER,ie);for(let K=0;K<G.locationSize;K++)M(G.location+K,N/G.locationSize,Z,re,N*ne,N/G.locationSize*K*ne)}}else if(B!==void 0){let re=B[U];if(re!==void 0)switch(re.length){case 2:t.vertexAttrib2fv(G.location,re);break;case 3:t.vertexAttrib3fv(G.location,re);break;case 4:t.vertexAttrib4fv(G.location,re);break;default:t.vertexAttrib1fv(G.location,re)}}}}w()}function E(){R();for(let I in l){let L=l[I];for(let T in L){let O=L[T];for(let D in O)p(O[D].object),delete O[D];delete L[T]}delete l[I]}}function P(I){if(l[I.id]===void 0)return;let L=l[I.id];for(let T in L){let O=L[T];for(let D in O)p(O[D].object),delete O[D];delete L[T]}delete l[I.id]}function A(I){for(let L in l){let T=l[L];if(T[I.id]===void 0)continue;let O=T[I.id];for(let D in O)p(O[D].object),delete O[D];delete T[I.id]}}function R(){k(),c=!0,u!==h&&(u=h,m(u.object))}function k(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:f,reset:R,resetDefaultState:k,dispose:E,releaseStatesOfGeometry:P,releaseStatesOfProgram:A,initAttributes:b,enableAttribute:y,disableUnusedAttributes:w}}function dR(t,e,i,r){let n=r.isWebGL2,o;function a(u){o=u}function l(u,c){t.drawArrays(o,u,c),i.update(c,o,1)}function h(u,c,f){if(f===0)return;let d,m;if(n)d=t,m="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[m](o,u,c,f),i.update(c,o,f)}this.setMode=a,this.render=l,this.renderInstances=h}function pR(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let M=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(M){if(M==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&t instanceof WebGL2ComputeRenderingContext,l=i.precision!==void 0?i.precision:"highp",h=o(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);let u=a||e.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),v=t.getParameter(t.MAX_VERTEX_ATTRIBS),g=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),_=t.getParameter(t.MAX_VARYING_VECTORS),x=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),b=d>0,y=a||e.has("OES_texture_float"),S=b&&y,w=a?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:o,precision:l,logarithmicDepthBuffer:c,maxTextures:f,maxVertexTextures:d,maxTextureSize:m,maxCubemapSize:p,maxAttributes:v,maxVertexUniforms:g,maxVaryings:_,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:y,floatVertexTextures:S,maxSamples:w}}function mR(t){let e=this,i=null,r=0,n=!1,o=!1,a=new On,l=new Oi,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(f,d,m){let p=f.length!==0||d||r!==0||n;return n=d,i=c(f,m,0),r=f.length,p},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,u()},this.setState=function(f,d,m){let p=f.clippingPlanes,v=f.clipIntersection,g=f.clipShadows,_=t.get(f);if(!n||p===null||p.length===0||o&&!g)o?c(null):u();else{let x=o?0:r,b=x*4,y=_.clippingState||null;h.value=y,y=c(p,d,b,m);for(let S=0;S!==b;++S)y[S]=i[S];_.clippingState=y,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=x}};function u(){h.value!==i&&(h.value=i,h.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(f,d,m,p){let v=f!==null?f.length:0,g=null;if(v!==0){if(g=h.value,p!==!0||g===null){let _=m+v*4,x=d.matrixWorldInverse;l.getNormalMatrix(x),(g===null||g.length<_)&&(g=new Float32Array(_));for(let b=0,y=m;b!==v;++b,y+=4)a.copy(f[b]).applyMatrix4(x,l),a.normal.toArray(g,y),g[y+3]=a.constant}h.value=g,h.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}var uo=class extends ii{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new dt,this.projectionMatrix=new dt,this.projectionMatrixInverse=new dt}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};uo.prototype.isCamera=!0;var Fi=class extends uo{constructor(e=50,i=1,r=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let i=.5*this.getFilmHeight()/e;this.fov=Ly*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(fm*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ly*2*Math.atan(Math.tan(fm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,i,r,n,o,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,i=e*Math.tan(fm*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,o=-.5*n,a=this.view;if(this.view!==null&&this.view.enabled){let h=a.fullWidth,u=a.fullHeight;o+=a.offsetX*n/h,i-=a.offsetY*r/u,n*=a.width/h,r*=a.height/u}let l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+n,i,i-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}};Fi.prototype.isPerspectiveCamera=!0;var Zl=90,Kl=1,km=class extends ii{constructor(e,i,r){if(super(),this.type="CubeCamera",r.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;let n=new Fi(Zl,Kl,e,i);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new j(1,0,0)),this.add(n);let o=new Fi(Zl,Kl,e,i);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new j(-1,0,0)),this.add(o);let a=new Fi(Zl,Kl,e,i);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new j(0,1,0)),this.add(a);let l=new Fi(Zl,Kl,e,i);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new j(0,-1,0)),this.add(l);let h=new Fi(Zl,Kl,e,i);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new j(0,0,1)),this.add(h);let u=new Fi(Zl,Kl,e,i);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new j(0,0,-1)),this.add(u)}update(e,i){this.parent===null&&this.updateMatrixWorld();let r=this.renderTarget,[n,o,a,l,h,u]=this.children,c=e.getRenderTarget(),f=e.outputEncoding,d=e.toneMapping,m=e.xr.enabled;e.outputEncoding=Er,e.toneMapping=qr,e.xr.enabled=!1;let p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(i,n),e.setRenderTarget(r,1),e.render(i,o),e.setRenderTarget(r,2),e.render(i,a),e.setRenderTarget(r,3),e.render(i,l),e.setRenderTarget(r,4),e.render(i,h),r.texture.generateMipmaps=p,e.setRenderTarget(r,5),e.render(i,u),e.setRenderTarget(c),e.outputEncoding=f,e.toneMapping=d,e.xr.enabled=m,r.texture.needsPMREMUpdate=!0}};var Ga=class extends Di{constructor(e,i,r,n,o,a,l,h,u,c){e=e!==void 0?e:[],i=i!==void 0?i:Qn,super(e,i,r,n,o,a,l,h,u,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};Ga.prototype.isCubeTexture=!0;var Xu=class extends pr{constructor(e,i={}){super(e,e,i);let r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new Ga(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:ji}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new rs(5,5,5),o=new Yr({name:"CubemapFromEquirect",uniforms:oo(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Li,blending:Pn});o.uniforms.tEquirect.value=i;let a=new _t(n,o),l=i.minFilter;return i.minFilter===No&&(i.minFilter=ji),new km(1,10,this).update(e,a),i.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,n){let o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,n);e.setRenderTarget(o)}};Xu.prototype.isWebGLCubeRenderTarget=!0;function gR(t){let e=new WeakMap;function i(a,l){return l===Du?a.mapping=Qn:l===Iu&&(a.mapping=Cs),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let l=a.mapping;if(l===Du||l===Iu)if(e.has(a)){let h=e.get(a).texture;return i(h,a.mapping)}else{let h=a.image;if(h&&h.height>0){let u=new Xu(h.height/2);return u.fromEquirectangularTexture(t,a),e.set(a,u),a.addEventListener("dispose",n),i(u.texture,a.mapping)}else return null}}return a}function n(a){let l=a.target;l.removeEventListener("dispose",n);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}var co=class extends uo{constructor(e=-1,i=1,r=1,n=-1,o=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=n,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,n,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,o=r-e,a=r+e,l=n+i,h=n-i;if(this.view!==null&&this.view.enabled){let u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=u*this.view.offsetX,a=o+u*this.view.width,l-=c*this.view.offsetY,h=l-c*this.view.height}this.projectionMatrix.makeOrthographic(o,a,l,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}};co.prototype.isOrthographicCamera=!0;var Jl=4,vR=[.125,.215,.35,.446,.526,.582],Wa=20,tx=new co,_R=new Ye,ix=null,Ha=(1+Math.sqrt(5))/2,Ql=1/Ha,yR=[new j(1,1,1),new j(-1,1,1),new j(1,1,-1),new j(-1,1,-1),new j(0,Ha,Ql),new j(0,Ha,-Ql),new j(Ql,0,Ha),new j(-Ql,0,Ha),new j(Ha,Ql,0),new j(-Ha,Ql,0)],Yu=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,n=100){ix=this._renderer.getRenderTarget(),this._setSize(256);let o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,n,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ix),e.scissorTest=!1,Fm(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===Qn||e.mapping===Cs?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ix=this._renderer.getRenderTarget();let r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize-32,r={magFilter:ji,minFilter:ji,generateMipmaps:!1,type:Es,format:er,encoding:Er,depthBuffer:!1},n=xR(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=xR(e,i,r);let{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_H(o)),this._blurMaterial=yH(o,e,i)}return n}_compileMaterial(e){let i=new _t(this._lodPlanes[0],e);this._renderer.compile(i,tx)}_sceneToCubeUV(e,i,r,n){let l=new Fi(90,1,i,r),h=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,f=c.autoClear,d=c.toneMapping;c.getClearColor(_R),c.toneMapping=qr,c.autoClear=!1;let m=new ki({name:"PMREM.Background",side:Li,depthWrite:!1,depthTest:!1}),p=new _t(new rs,m),v=!1,g=e.background;g?g.isColor&&(m.color.copy(g),e.background=null,v=!0):(m.color.copy(_R),v=!0);for(let _=0;_<6;_++){let x=_%3;x===0?(l.up.set(0,h[_],0),l.lookAt(u[_],0,0)):x===1?(l.up.set(0,0,h[_]),l.lookAt(0,u[_],0)):(l.up.set(0,h[_],0),l.lookAt(0,0,u[_]));let b=this._cubeSize;Fm(n,x*b,_>2?b:0,b,b),c.setRenderTarget(n),v&&c.render(p,l),c.render(e,l)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=d,c.autoClear=f,e.background=g}_textureToCubeUV(e,i){let r=this._renderer,n=e.mapping===Qn||e.mapping===Cs;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=wR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=bR());let o=n?this._cubemapMaterial:this._equirectMaterial,a=new _t(this._lodPlanes[0],o),l=o.uniforms;l.envMap.value=e;let h=this._cubeSize;Fm(i,0,0,3*h,2*h),r.setRenderTarget(i),r.render(a,tx)}_applyPMREM(e){let i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let o=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=yR[(n-1)%yR.length];this._blur(e,n-1,n,o,a)}i.autoClear=r}_blur(e,i,r,n,o){let a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,n,"latitudinal",o),this._halfBlur(a,e,r,r,n,"longitudinal",o)}_halfBlur(e,i,r,n,o,a,l){let h=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,f=new _t(this._lodPlanes[n],u),d=u.uniforms,m=this._sizeLods[r]-1,p=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Wa-1),v=o/p,g=isFinite(o)?1+Math.floor(c*v):Wa;g>Wa&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Wa}`);let _=[],x=0;for(let M=0;M<Wa;++M){let C=M/v,E=Math.exp(-C*C/2);_.push(E),M===0?x+=E:M<g&&(x+=2*E)}for(let M=0;M<_.length;M++)_[M]=_[M]/x;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=_,d.latitudinal.value=a==="latitudinal",l&&(d.poleAxis.value=l);let{_lodMax:b}=this;d.dTheta.value=p,d.mipInt.value=b-r;let y=this._sizeLods[n],S=3*y*(n>b-Jl?n-b+Jl:0),w=4*(this._cubeSize-y);Fm(i,S,w,3*y,2*y),h.setRenderTarget(i),h.render(f,tx)}};function _H(t){let e=[],i=[],r=[],n=t,o=t-Jl+1+vR.length;for(let a=0;a<o;a++){let l=Math.pow(2,n);i.push(l);let h=1/l;a>t-Jl?h=vR[a-t+Jl-1]:a===0&&(h=0),r.push(h);let u=1/(l-1),c=-u/2,f=1+u/2,d=[c,c,f,c,f,f,c,c,f,f,c,f],m=6,p=6,v=3,g=2,_=1,x=new Float32Array(v*p*m),b=new Float32Array(g*p*m),y=new Float32Array(_*p*m);for(let w=0;w<m;w++){let M=w%3*2/3-1,C=w>2?0:-1,E=[M,C,0,M+2/3,C,0,M+2/3,C+1,0,M,C,0,M+2/3,C+1,0,M,C+1,0];x.set(E,v*p*w),b.set(d,g*p*w);let P=[w,w,w,w,w,w];y.set(P,_*p*w)}let S=new pt;S.setAttribute("position",new vt(x,v)),S.setAttribute("uv",new vt(b,g)),S.setAttribute("faceIndex",new vt(y,_)),e.push(S),n>Jl&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function xR(t,e,i){let r=new pr(t,e,i);return r.texture.mapping=Bo,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Fm(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function yH(t,e,i){let r=new Float32Array(Wa),n=new j(0,1,0);return new Yr({name:"SphericalGaussianBlur",defines:{n:Wa,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:rx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function bR(){return new Yr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:rx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function wR(){return new Yr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:rx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function rx(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function SR(t){let e=new WeakMap,i=null;function r(l){if(l&&l.isTexture){let h=l.mapping,u=h===Du||h===Iu,c=h===Qn||h===Cs;if(u||c)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let f=e.get(l);return i===null&&(i=new Yu(t)),f=u?i.fromEquirectangular(l,f):i.fromCubemap(l,f),e.set(l,f),f.texture}else{if(e.has(l))return e.get(l).texture;{let f=l.image;if(u&&f&&f.height>0||c&&f&&n(f)){i===null&&(i=new Yu(t));let d=u?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,d),l.addEventListener("dispose",o),d.texture}else return null}}}return l}function n(l){let h=0,u=6;for(let c=0;c<u;c++)l[c]!==void 0&&h++;return h===u}function o(l){let h=l.target;h.removeEventListener("dispose",o);let u=e.get(h);u!==void 0&&(e.delete(h),u.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function CR(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function ER(t,e,i,r){let n={},o=new WeakMap;function a(f){let d=f.target;d.index!==null&&e.remove(d.index);for(let p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];let m=o.get(d);m&&(e.remove(m),o.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function l(f,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function h(f){let d=f.attributes;for(let p in d)e.update(d[p],t.ARRAY_BUFFER);let m=f.morphAttributes;for(let p in m){let v=m[p];for(let g=0,_=v.length;g<_;g++)e.update(v[g],t.ARRAY_BUFFER)}}function u(f){let d=[],m=f.index,p=f.attributes.position,v=0;if(m!==null){let x=m.array;v=m.version;for(let b=0,y=x.length;b<y;b+=3){let S=x[b+0],w=x[b+1],M=x[b+2];d.push(S,w,w,M,M,S)}}else{let x=p.array;v=p.version;for(let b=0,y=x.length/3-1;b<y;b+=3){let S=b+0,w=b+1,M=b+2;d.push(S,w,w,M,M,S)}}let g=new(pm(d)?Hl:Gl)(d,1);g.version=v;let _=o.get(f);_&&e.remove(_),o.set(f,g)}function c(f){let d=o.get(f);if(d){let m=f.index;m!==null&&d.version<m.version&&u(f)}else u(f);return o.get(f)}return{get:l,update:h,getWireframeAttribute:c}}function MR(t,e,i,r){let n=r.isWebGL2,o;function a(d){o=d}let l,h;function u(d){l=d.type,h=d.bytesPerElement}function c(d,m){t.drawElements(o,m,l,d*h),i.update(m,o,1)}function f(d,m,p){if(p===0)return;let v,g;if(n)v=t,g="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](o,m,l,d*h,p),i.update(m,o,p)}this.setMode=a,this.setIndex=u,this.render=c,this.renderInstances=f}function TR(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,a,l){switch(i.calls++,a){case t.TRIANGLES:i.triangles+=l*(o/3);break;case t.LINES:i.lines+=l*(o/2);break;case t.LINE_STRIP:i.lines+=l*(o-1);break;case t.LINE_LOOP:i.lines+=l*o;break;case t.POINTS:i.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function xH(t,e){return t[0]-e[0]}function bH(t,e){return Math.abs(e[1])-Math.abs(t[1])}function nx(t,e){let i=1,r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?i=127:r instanceof Int16Array?i=32767:r instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),t.divideScalar(i)}function AR(t,e,i){let r={},n=new Float32Array(8),o=new WeakMap,a=new Vt,l=[];for(let u=0;u<8;u++)l[u]=[u,0];function h(u,c,f,d){let m=u.morphTargetInfluences;if(e.isWebGL2===!0){let p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,v=p!==void 0?p.length:0,g=o.get(c);if(g===void 0||g.count!==v){let L=function(){k.dispose(),o.delete(c),c.removeEventListener("dispose",L)};g!==void 0&&g.texture.dispose();let b=c.morphAttributes.position!==void 0,y=c.morphAttributes.normal!==void 0,S=c.morphAttributes.color!==void 0,w=c.morphAttributes.position||[],M=c.morphAttributes.normal||[],C=c.morphAttributes.color||[],E=0;b===!0&&(E=1),y===!0&&(E=2),S===!0&&(E=3);let P=c.attributes.position.count*E,A=1;P>e.maxTextureSize&&(A=Math.ceil(P/e.maxTextureSize),P=e.maxTextureSize);let R=new Float32Array(P*A*4*v),k=new Fa(R,P,A,v);k.type=Jn,k.needsUpdate=!0;let I=E*4;for(let T=0;T<v;T++){let O=w[T],D=M[T],F=C[T],B=P*A*4*T;for(let U=0;U<O.count;U++){let G=U*I;b===!0&&(a.fromBufferAttribute(O,U),O.normalized===!0&&nx(a,O),R[B+G+0]=a.x,R[B+G+1]=a.y,R[B+G+2]=a.z,R[B+G+3]=0),y===!0&&(a.fromBufferAttribute(D,U),D.normalized===!0&&nx(a,D),R[B+G+4]=a.x,R[B+G+5]=a.y,R[B+G+6]=a.z,R[B+G+7]=0),S===!0&&(a.fromBufferAttribute(F,U),F.normalized===!0&&nx(a,F),R[B+G+8]=a.x,R[B+G+9]=a.y,R[B+G+10]=a.z,R[B+G+11]=F.itemSize===4?a.w:1)}}g={count:v,texture:k,size:new $e(P,A)},o.set(c,g),c.addEventListener("dispose",L)}let _=0;for(let b=0;b<m.length;b++)_+=m[b];let x=c.morphTargetsRelative?1:1-_;d.getUniforms().setValue(t,"morphTargetBaseInfluence",x),d.getUniforms().setValue(t,"morphTargetInfluences",m),d.getUniforms().setValue(t,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",g.size)}else{let p=m===void 0?0:m.length,v=r[c.id];if(v===void 0||v.length!==p){v=[];for(let y=0;y<p;y++)v[y]=[y,0];r[c.id]=v}for(let y=0;y<p;y++){let S=v[y];S[0]=y,S[1]=m[y]}v.sort(bH);for(let y=0;y<8;y++)y<p&&v[y][1]?(l[y][0]=v[y][0],l[y][1]=v[y][1]):(l[y][0]=Number.MAX_SAFE_INTEGER,l[y][1]=0);l.sort(xH);let g=c.morphAttributes.position,_=c.morphAttributes.normal,x=0;for(let y=0;y<8;y++){let S=l[y],w=S[0],M=S[1];w!==Number.MAX_SAFE_INTEGER&&M?(g&&c.getAttribute("morphTarget"+y)!==g[w]&&c.setAttribute("morphTarget"+y,g[w]),_&&c.getAttribute("morphNormal"+y)!==_[w]&&c.setAttribute("morphNormal"+y,_[w]),n[y]=M,x+=M):(g&&c.hasAttribute("morphTarget"+y)===!0&&c.deleteAttribute("morphTarget"+y),_&&c.hasAttribute("morphNormal"+y)===!0&&c.deleteAttribute("morphNormal"+y),n[y]=0)}let b=c.morphTargetsRelative?1:1-x;d.getUniforms().setValue(t,"morphTargetBaseInfluence",b),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:h}}function PR(t,e,i,r){let n=new WeakMap;function o(h){let u=r.render.frame,c=h.geometry,f=e.get(h,c);return n.get(f)!==u&&(e.update(f),n.set(f,u)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),i.update(h.instanceMatrix,t.ARRAY_BUFFER),h.instanceColor!==null&&i.update(h.instanceColor,t.ARRAY_BUFFER)),f}function a(){n=new WeakMap}function l(h){let u=h.target;u.removeEventListener("dispose",l),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:o,dispose:a}}var FR=new Di,BR=new Fa,NR=new Hu,UR=new Ga,RR=[],LR=[],OR=new Float32Array(16),DR=new Float32Array(9),IR=new Float32Array(4);function $l(t,e,i){let r=t[0];if(r<=0||r>0)return t;let n=e*i,o=RR[n];if(o===void 0&&(o=new Float32Array(n),RR[n]=o),e!==0){r.toArray(o,0);for(let a=1,l=0;a!==e;++a)l+=i,t[a].toArray(o,l)}return o}function Ar(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function vr(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function Bm(t,e){let i=LR[e];i===void 0&&(i=new Int32Array(e),LR[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function wH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function SH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ar(i,e))return;t.uniform2fv(this.addr,e),vr(i,e)}}function CH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Ar(i,e))return;t.uniform3fv(this.addr,e),vr(i,e)}}function EH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ar(i,e))return;t.uniform4fv(this.addr,e),vr(i,e)}}function MH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Ar(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),vr(i,e)}else{if(Ar(i,r))return;IR.set(r),t.uniformMatrix2fv(this.addr,!1,IR),vr(i,r)}}function TH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Ar(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),vr(i,e)}else{if(Ar(i,r))return;DR.set(r),t.uniformMatrix3fv(this.addr,!1,DR),vr(i,r)}}function AH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Ar(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),vr(i,e)}else{if(Ar(i,r))return;OR.set(r),t.uniformMatrix4fv(this.addr,!1,OR),vr(i,r)}}function PH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function RH(t,e){let i=this.cache;Ar(i,e)||(t.uniform2iv(this.addr,e),vr(i,e))}function LH(t,e){let i=this.cache;Ar(i,e)||(t.uniform3iv(this.addr,e),vr(i,e))}function OH(t,e){let i=this.cache;Ar(i,e)||(t.uniform4iv(this.addr,e),vr(i,e))}function DH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function IH(t,e){let i=this.cache;Ar(i,e)||(t.uniform2uiv(this.addr,e),vr(i,e))}function kH(t,e){let i=this.cache;Ar(i,e)||(t.uniform3uiv(this.addr,e),vr(i,e))}function FH(t,e){let i=this.cache;Ar(i,e)||(t.uniform4uiv(this.addr,e),vr(i,e))}function BH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||FR,n)}function NH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||NR,n)}function UH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||UR,n)}function zH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||BR,n)}function GH(t){switch(t){case 5126:return wH;case 35664:return SH;case 35665:return CH;case 35666:return EH;case 35674:return MH;case 35675:return TH;case 35676:return AH;case 5124:case 35670:return PH;case 35667:case 35671:return RH;case 35668:case 35672:return LH;case 35669:case 35673:return OH;case 5125:return DH;case 36294:return IH;case 36295:return kH;case 36296:return FH;case 35678:case 36198:case 36298:case 36306:case 35682:return BH;case 35679:case 36299:case 36307:return NH;case 35680:case 36300:case 36308:case 36293:return UH;case 36289:case 36303:case 36311:case 36292:return zH}}function HH(t,e){t.uniform1fv(this.addr,e)}function WH(t,e){let i=$l(e,this.size,2);t.uniform2fv(this.addr,i)}function VH(t,e){let i=$l(e,this.size,3);t.uniform3fv(this.addr,i)}function jH(t,e){let i=$l(e,this.size,4);t.uniform4fv(this.addr,i)}function qH(t,e){let i=$l(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function XH(t,e){let i=$l(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function YH(t,e){let i=$l(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function ZH(t,e){t.uniform1iv(this.addr,e)}function KH(t,e){t.uniform2iv(this.addr,e)}function QH(t,e){t.uniform3iv(this.addr,e)}function JH(t,e){t.uniform4iv(this.addr,e)}function $H(t,e){t.uniform1uiv(this.addr,e)}function e6(t,e){t.uniform2uiv(this.addr,e)}function t6(t,e){t.uniform3uiv(this.addr,e)}function i6(t,e){t.uniform4uiv(this.addr,e)}function r6(t,e,i){let r=e.length,n=Bm(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture2D(e[o]||FR,n[o])}function n6(t,e,i){let r=e.length,n=Bm(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture3D(e[o]||NR,n[o])}function s6(t,e,i){let r=e.length,n=Bm(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTextureCube(e[o]||UR,n[o])}function o6(t,e,i){let r=e.length,n=Bm(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture2DArray(e[o]||BR,n[o])}function a6(t){switch(t){case 5126:return HH;case 35664:return WH;case 35665:return VH;case 35666:return jH;case 35674:return qH;case 35675:return XH;case 35676:return YH;case 5124:case 35670:return ZH;case 35667:case 35671:return KH;case 35668:case 35672:return QH;case 35669:case 35673:return JH;case 5125:return $H;case 36294:return e6;case 36295:return t6;case 36296:return i6;case 35678:case 36198:case 36298:case 36306:case 35682:return r6;case 35679:case 36299:case 36307:return n6;case 35680:case 36300:case 36308:case 36293:return s6;case 36289:case 36303:case 36311:case 36292:return o6}}function l6(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=GH(e.type)}function zR(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=a6(e.type)}zR.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),vr(e,t)};function GR(t){this.id=t,this.seq=[],this.map={}}GR.prototype.setValue=function(t,e,i){let r=this.seq;for(let n=0,o=r.length;n!==o;++n){let a=r[n];a.setValue(t,e[a.id],i)}};var sx=/(\w+)(\])?(\[|\.)?/g;function kR(t,e){t.seq.push(e),t.map[e.id]=e}function h6(t,e,i){let r=t.name,n=r.length;for(sx.lastIndex=0;;){let o=sx.exec(r),a=sx.lastIndex,l=o[1],h=o[2]==="]",u=o[3];if(h&&(l=l|0),u===void 0||u==="["&&a+2===n){kR(i,u===void 0?new l6(l,t,e):new zR(l,t,e));break}else{let f=i.map[l];f===void 0&&(f=new GR(l),kR(i,f)),i=f}}}function Rs(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){let n=t.getActiveUniform(e,r),o=t.getUniformLocation(e,n.name);h6(n,o,this)}}Rs.prototype.setValue=function(t,e,i,r){let n=this.map[e];n!==void 0&&n.setValue(t,i,r)};Rs.prototype.setOptional=function(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)};Rs.upload=function(t,e,i,r){for(let n=0,o=e.length;n!==o;++n){let a=e[n],l=i[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,r)}};Rs.seqWithValue=function(t,e){let i=[];for(let r=0,n=t.length;r!==n;++r){let o=t[r];o.id in e&&i.push(o)}return i};function ox(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var u6=0;function c6(t,e){let i=t.split(`
`),r=[],n=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let a=n;a<o;a++)r.push(a+1+": "+i[a]);return r.join(`
`)}function f6(t){switch(t){case Er:return["Linear","( value )"];case Qt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function HR(t,e,i){let r=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";let o=parseInt(/ERROR: 0:(\d+)/.exec(n)[1]);return i.toUpperCase()+`

`+n+`

`+c6(t.getShaderSource(e),o)}function d6(t,e){let i=f6(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function p6(t,e){let i;switch(e){case KT:i="Linear";break;case QT:i="Reinhard";break;case JT:i="OptimizedCineon";break;case $T:i="ACESFilmic";break;case eA:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function m6(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Zu).join(`
`)}function g6(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function v6(t,e){let i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){let o=t.getActiveAttrib(e,n),a=o.name,l=1;o.type===t.FLOAT_MAT2&&(l=2),o.type===t.FLOAT_MAT3&&(l=3),o.type===t.FLOAT_MAT4&&(l=4),i[a]={type:o.type,location:t.getAttribLocation(e,a),locationSize:l}}return i}function Zu(t){return t!==""}function WR(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function VR(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var _6=/^[ \t]*#include +<([\w\d./]+)>/gm;function ax(t){return t.replace(_6,y6)}function y6(t,e){let i=Rt[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return ax(i)}var x6=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,b6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jR(t){return t.replace(b6,XR).replace(x6,w6)}function w6(t,e,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),XR(t,e,i,r)}function XR(t,e,i,r){let n="";for(let o=parseInt(e);o<parseInt(i);o++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return n}function qR(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function S6(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===rm?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===nm?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ka&&(e="SHADOWMAP_TYPE_VSM"),e}function C6(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Qn:case Cs:e="ENVMAP_TYPE_CUBE";break;case Bo:e="ENVMAP_TYPE_CUBE_UV";break}return e}function E6(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Cs:e="ENVMAP_MODE_REFRACTION";break}return e}function M6(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Fo:e="ENVMAP_BLENDING_MULTIPLY";break;case YT:e="ENVMAP_BLENDING_MIX";break;case ZT:e="ENVMAP_BLENDING_ADD";break}return e}function T6(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e/32+1)+3,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function YR(t,e,i,r){let n=t.getContext(),o=i.defines,a=i.vertexShader,l=i.fragmentShader,h=S6(i),u=C6(i),c=E6(i),f=M6(i),d=T6(i),m=i.isWebGL2?"":m6(i),p=g6(o),v=n.createProgram(),g,_,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[p].filter(Zu).join(`
`),g.length>0&&(g+=`
`),_=[m,p].filter(Zu).join(`
`),_.length>0&&(_+=`
`)):(g=[qR(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Zu).join(`
`),_=[m,qR(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==qr?"#define TONE_MAPPING":"",i.toneMapping!==qr?Rt.tonemapping_pars_fragment:"",i.toneMapping!==qr?p6("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Rt.encodings_pars_fragment,d6("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Zu).join(`
`)),a=ax(a),a=WR(a,i),a=VR(a,i),l=ax(l),l=WR(l,i),l=VR(l,i),a=jR(a),l=jR(l),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,_=["#define varying in",i.glslVersion===Ry?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Ry?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);let b=x+g+a,y=x+_+l,S=ox(n,n.VERTEX_SHADER,b),w=ox(n,n.FRAGMENT_SHADER,y);if(n.attachShader(v,S),n.attachShader(v,w),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),t.debug.checkShaderErrors){let E=n.getProgramInfoLog(v).trim(),P=n.getShaderInfoLog(S).trim(),A=n.getShaderInfoLog(w).trim(),R=!0,k=!0;if(n.getProgramParameter(v,n.LINK_STATUS)===!1){R=!1;let I=HR(n,S,"vertex"),L=HR(n,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,n.VALIDATE_STATUS)+`

Program Info Log: `+E+`
`+I+`
`+L)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(P===""||A==="")&&(k=!1);k&&(this.diagnostics={runnable:R,programLog:E,vertexShader:{log:P,prefix:g},fragmentShader:{log:A,prefix:_}})}n.deleteShader(S),n.deleteShader(w);let M;this.getUniforms=function(){return M===void 0&&(M=new Rs(n,v)),M};let C;return this.getAttributes=function(){return C===void 0&&(C=v6(n,v)),C},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=u6++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=w,this}var A6=0,Nm=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(i),o=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){let i=this.materialCache.get(e);for(let r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let i=this.materialCache;return i.has(e)===!1&&i.set(e,new Set),i.get(e)}_getShaderStage(e){let i=this.shaderCache;if(i.has(e)===!1){let r=new lx(e);i.set(e,r)}return i.get(e)}},lx=class{constructor(e){this.id=A6++,this.code=e,this.usedTimes=0}};function ZR(t,e,i,r,n,o,a){let l=new Wo,h=new Nm,u=[],c=n.isWebGL2,f=n.logarithmicDepthBuffer,d=n.floatVertexTextures,m=n.maxVertexUniforms,p=n.vertexTextures,v=n.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(A){let k=A.skeleton.bones;if(d)return 1024;{let L=Math.floor((m-20)/4),T=Math.min(L,k.length);return T<k.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+k.length+" bones. This GPU supports "+T+"."),0):T}}function x(A,R,k,I,L){let T=I.fog,O=L.geometry,D=A.isMeshStandardMaterial?I.environment:null,F=(A.isMeshStandardMaterial?i:e).get(A.envMap||D),B=F&&F.mapping===Bo?F.image.height:null,U=g[A.type],G=L.isSkinnedMesh?_(L):0;A.precision!==null&&(v=n.getMaxPrecision(A.precision),v!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",v,"instead."));let Y=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,re=Y!==void 0?Y.length:0,N=0;O.morphAttributes.position!==void 0&&(N=1),O.morphAttributes.normal!==void 0&&(N=2),O.morphAttributes.color!==void 0&&(N=3);let z,ie,Z,ne;if(U){let Re=Tr[U];z=Re.vertexShader,ie=Re.fragmentShader}else z=A.vertexShader,ie=A.fragmentShader,h.update(A),Z=h.getVertexShaderID(A),ne=h.getFragmentShaderID(A);let K=t.getRenderTarget(),ae=A.alphaTest>0,ue=A.clearcoat>0;return{isWebGL2:c,shaderID:U,shaderName:A.type,vertexShader:z,fragmentShader:ie,defines:A.defines,customVertexShaderID:Z,customFragmentShaderID:ne,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:v,instancing:L.isInstancedMesh===!0,instancingColor:L.isInstancedMesh===!0&&L.instanceColor!==null,supportsVertexTextures:p,outputEncoding:K===null?t.outputEncoding:K.isXRRenderTarget===!0?K.texture.encoding:Er,map:!!A.map,matcap:!!A.matcap,envMap:!!F,envMapMode:F&&F.mapping,envMapCubeUVHeight:B,lightMap:!!A.lightMap,aoMap:!!A.aoMap,emissiveMap:!!A.emissiveMap,bumpMap:!!A.bumpMap,normalMap:!!A.normalMap,objectSpaceNormalMap:A.normalMapType===xA,tangentSpaceNormalMap:A.normalMapType===Dl,decodeVideoTexture:!!A.map&&A.map.isVideoTexture===!0&&A.map.encoding===Qt,clearcoat:ue,clearcoatMap:ue&&!!A.clearcoatMap,clearcoatRoughnessMap:ue&&!!A.clearcoatRoughnessMap,clearcoatNormalMap:ue&&!!A.clearcoatNormalMap,displacementMap:!!A.displacementMap,roughnessMap:!!A.roughnessMap,metalnessMap:!!A.metalnessMap,specularMap:!!A.specularMap,specularIntensityMap:!!A.specularIntensityMap,specularColorMap:!!A.specularColorMap,opaque:A.transparent===!1&&A.blending===eo,alphaMap:!!A.alphaMap,alphaTest:ae,gradientMap:!!A.gradientMap,sheen:A.sheen>0,sheenColorMap:!!A.sheenColorMap,sheenRoughnessMap:!!A.sheenRoughnessMap,transmission:A.transmission>0,transmissionMap:!!A.transmissionMap,thicknessMap:!!A.thicknessMap,combine:A.combine,vertexTangents:!!A.normalMap&&!!O.attributes.tangent,vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUvs:!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatMap||!!A.clearcoatRoughnessMap||!!A.clearcoatNormalMap||!!A.displacementMap||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularColorMap||!!A.sheenColorMap||!!A.sheenRoughnessMap,uvsVertexOnly:!(A.map||A.bumpMap||A.normalMap||A.specularMap||A.alphaMap||A.emissiveMap||A.roughnessMap||A.metalnessMap||A.clearcoatNormalMap||A.transmission>0||A.transmissionMap||A.thicknessMap||A.specularIntensityMap||A.specularColorMap||A.sheen>0||A.sheenColorMap||A.sheenRoughnessMap)&&!!A.displacementMap,fog:!!T,useFog:A.fog,fogExp2:T&&T.isFogExp2,flatShading:!!A.flatShading,sizeAttenuation:A.sizeAttenuation,logarithmicDepthBuffer:f,skinning:L.isSkinnedMesh===!0&&G>0,maxBones:G,useVertexTexture:d,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:re,morphTextureStride:N,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:A.dithering,shadowMapEnabled:t.shadowMap.enabled&&k.length>0,shadowMapType:t.shadowMap.type,toneMapping:A.toneMapped?t.toneMapping:qr,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===qt,flipSided:A.side===Li,depthPacking:A.depthPacking!==void 0?A.depthPacking:!1,index0AttributeName:A.index0AttributeName,extensionDerivatives:A.extensions&&A.extensions.derivatives,extensionFragDepth:A.extensions&&A.extensions.fragDepth,extensionDrawBuffers:A.extensions&&A.extensions.drawBuffers,extensionShaderTextureLOD:A.extensions&&A.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:A.customProgramCacheKey()}}function b(A){let R=[];if(A.shaderID?R.push(A.shaderID):(R.push(A.customVertexShaderID),R.push(A.customFragmentShaderID)),A.defines!==void 0)for(let k in A.defines)R.push(k),R.push(A.defines[k]);return A.isRawShaderMaterial===!1&&(y(R,A),S(R,A),R.push(t.outputEncoding)),R.push(A.customProgramCacheKey),R.join()}function y(A,R){A.push(R.precision),A.push(R.outputEncoding),A.push(R.envMapMode),A.push(R.envMapCubeUVHeight),A.push(R.combine),A.push(R.vertexUvs),A.push(R.fogExp2),A.push(R.sizeAttenuation),A.push(R.maxBones),A.push(R.morphTargetsCount),A.push(R.morphAttributeCount),A.push(R.numDirLights),A.push(R.numPointLights),A.push(R.numSpotLights),A.push(R.numHemiLights),A.push(R.numRectAreaLights),A.push(R.numDirLightShadows),A.push(R.numPointLightShadows),A.push(R.numSpotLightShadows),A.push(R.shadowMapType),A.push(R.toneMapping),A.push(R.numClippingPlanes),A.push(R.numClipIntersection)}function S(A,R){l.disableAll(),R.isWebGL2&&l.enable(0),R.supportsVertexTextures&&l.enable(1),R.instancing&&l.enable(2),R.instancingColor&&l.enable(3),R.map&&l.enable(4),R.matcap&&l.enable(5),R.envMap&&l.enable(6),R.lightMap&&l.enable(7),R.aoMap&&l.enable(8),R.emissiveMap&&l.enable(9),R.bumpMap&&l.enable(10),R.normalMap&&l.enable(11),R.objectSpaceNormalMap&&l.enable(12),R.tangentSpaceNormalMap&&l.enable(13),R.clearcoat&&l.enable(14),R.clearcoatMap&&l.enable(15),R.clearcoatRoughnessMap&&l.enable(16),R.clearcoatNormalMap&&l.enable(17),R.displacementMap&&l.enable(18),R.specularMap&&l.enable(19),R.roughnessMap&&l.enable(20),R.metalnessMap&&l.enable(21),R.gradientMap&&l.enable(22),R.alphaMap&&l.enable(23),R.alphaTest&&l.enable(24),R.vertexColors&&l.enable(25),R.vertexAlphas&&l.enable(26),R.vertexUvs&&l.enable(27),R.vertexTangents&&l.enable(28),R.uvsVertexOnly&&l.enable(29),R.fog&&l.enable(30),A.push(l.mask),l.disableAll(),R.useFog&&l.enable(0),R.flatShading&&l.enable(1),R.logarithmicDepthBuffer&&l.enable(2),R.skinning&&l.enable(3),R.useVertexTexture&&l.enable(4),R.morphTargets&&l.enable(5),R.morphNormals&&l.enable(6),R.morphColors&&l.enable(7),R.premultipliedAlpha&&l.enable(8),R.shadowMapEnabled&&l.enable(9),R.physicallyCorrectLights&&l.enable(10),R.doubleSided&&l.enable(11),R.flipSided&&l.enable(12),R.depthPacking&&l.enable(13),R.dithering&&l.enable(14),R.specularIntensityMap&&l.enable(15),R.specularColorMap&&l.enable(16),R.transmission&&l.enable(17),R.transmissionMap&&l.enable(18),R.thicknessMap&&l.enable(19),R.sheen&&l.enable(20),R.sheenColorMap&&l.enable(21),R.sheenRoughnessMap&&l.enable(22),R.decodeVideoTexture&&l.enable(23),R.opaque&&l.enable(24),A.push(l.mask)}function w(A){let R=g[A.type],k;if(R){let I=Tr[R];k=qu.clone(I.uniforms)}else k=A.uniforms;return k}function M(A,R){let k;for(let I=0,L=u.length;I<L;I++){let T=u[I];if(T.cacheKey===R){k=T,++k.usedTimes;break}}return k===void 0&&(k=new YR(t,R,A,o),u.push(k)),k}function C(A){if(--A.usedTimes===0){let R=u.indexOf(A);u[R]=u[u.length-1],u.pop(),A.destroy()}}function E(A){h.remove(A)}function P(){h.dispose()}return{getParameters:x,getProgramCacheKey:b,getUniforms:w,acquireProgram:M,releaseProgram:C,releaseShaderCache:E,programs:u,dispose:P}}function KR(){let t=new WeakMap;function e(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function i(o){t.delete(o)}function r(o,a,l){t.get(o)[a]=l}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function P6(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function QR(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function JR(){let t=[],e=0,i=[],r=[],n=[];function o(){e=0,i.length=0,r.length=0,n.length=0}function a(f,d,m,p,v,g){let _=t[e];return _===void 0?(_={id:f.id,object:f,geometry:d,material:m,groupOrder:p,renderOrder:f.renderOrder,z:v,group:g},t[e]=_):(_.id=f.id,_.object=f,_.geometry=d,_.material=m,_.groupOrder=p,_.renderOrder=f.renderOrder,_.z=v,_.group=g),e++,_}function l(f,d,m,p,v,g){let _=a(f,d,m,p,v,g);m.transmission>0?r.push(_):m.transparent===!0?n.push(_):i.push(_)}function h(f,d,m,p,v,g){let _=a(f,d,m,p,v,g);m.transmission>0?r.unshift(_):m.transparent===!0?n.unshift(_):i.unshift(_)}function u(f,d){i.length>1&&i.sort(f||P6),r.length>1&&r.sort(d||QR),n.length>1&&n.sort(d||QR)}function c(){for(let f=e,d=t.length;f<d;f++){let m=t[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:r,transparent:n,init:o,push:l,unshift:h,finish:c,sort:u}}function $R(){let t=new WeakMap;function e(r,n){let o;return t.has(r)===!1?(o=new JR,t.set(r,[o])):n>=t.get(r).length?(o=new JR,t.get(r).push(o)):o=t.get(r)[n],o}function i(){t=new WeakMap}return{get:e,dispose:i}}function R6(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new j,color:new Ye};break;case"SpotLight":i={position:new j,direction:new j,color:new Ye,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new j,color:new Ye,distance:0,decay:0};break;case"HemisphereLight":i={direction:new j,skyColor:new Ye,groundColor:new Ye};break;case"RectAreaLight":i={color:new Ye,position:new j,halfWidth:new j,halfHeight:new j};break}return t[e.id]=i,i}}}function L6(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var O6=0;function D6(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function eL(t,e){let i=new R6,r=L6(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let c=0;c<9;c++)n.probe.push(new j);let o=new j,a=new dt,l=new dt;function h(c,f){let d=0,m=0,p=0;for(let E=0;E<9;E++)n.probe[E].set(0,0,0);let v=0,g=0,_=0,x=0,b=0,y=0,S=0,w=0;c.sort(D6);let M=f!==!0?Math.PI:1;for(let E=0,P=c.length;E<P;E++){let A=c[E],R=A.color,k=A.intensity,I=A.distance,L=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)d+=R.r*k*M,m+=R.g*k*M,p+=R.b*k*M;else if(A.isLightProbe)for(let T=0;T<9;T++)n.probe[T].addScaledVector(A.sh.coefficients[T],k);else if(A.isDirectionalLight){let T=i.get(A);if(T.color.copy(A.color).multiplyScalar(A.intensity*M),A.castShadow){let O=A.shadow,D=r.get(A);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,n.directionalShadow[v]=D,n.directionalShadowMap[v]=L,n.directionalShadowMatrix[v]=A.shadow.matrix,y++}n.directional[v]=T,v++}else if(A.isSpotLight){let T=i.get(A);if(T.position.setFromMatrixPosition(A.matrixWorld),T.color.copy(R).multiplyScalar(k*M),T.distance=I,T.coneCos=Math.cos(A.angle),T.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),T.decay=A.decay,A.castShadow){let O=A.shadow,D=r.get(A);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,n.spotShadow[_]=D,n.spotShadowMap[_]=L,n.spotShadowMatrix[_]=A.shadow.matrix,w++}n.spot[_]=T,_++}else if(A.isRectAreaLight){let T=i.get(A);T.color.copy(R).multiplyScalar(k),T.halfWidth.set(A.width*.5,0,0),T.halfHeight.set(0,A.height*.5,0),n.rectArea[x]=T,x++}else if(A.isPointLight){let T=i.get(A);if(T.color.copy(A.color).multiplyScalar(A.intensity*M),T.distance=A.distance,T.decay=A.decay,A.castShadow){let O=A.shadow,D=r.get(A);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,D.shadowCameraNear=O.camera.near,D.shadowCameraFar=O.camera.far,n.pointShadow[g]=D,n.pointShadowMap[g]=L,n.pointShadowMatrix[g]=A.shadow.matrix,S++}n.point[g]=T,g++}else if(A.isHemisphereLight){let T=i.get(A);T.skyColor.copy(A.color).multiplyScalar(k*M),T.groundColor.copy(A.groundColor).multiplyScalar(k*M),n.hemi[b]=T,b++}}x>0&&(e.isWebGL2?(n.rectAreaLTC1=Ne.LTC_FLOAT_1,n.rectAreaLTC2=Ne.LTC_FLOAT_2):t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ne.LTC_FLOAT_1,n.rectAreaLTC2=Ne.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Ne.LTC_HALF_1,n.rectAreaLTC2=Ne.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=m,n.ambient[2]=p;let C=n.hash;(C.directionalLength!==v||C.pointLength!==g||C.spotLength!==_||C.rectAreaLength!==x||C.hemiLength!==b||C.numDirectionalShadows!==y||C.numPointShadows!==S||C.numSpotShadows!==w)&&(n.directional.length=v,n.spot.length=_,n.rectArea.length=x,n.point.length=g,n.hemi.length=b,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=S,n.pointShadowMap.length=S,n.spotShadow.length=w,n.spotShadowMap.length=w,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=S,n.spotShadowMatrix.length=w,C.directionalLength=v,C.pointLength=g,C.spotLength=_,C.rectAreaLength=x,C.hemiLength=b,C.numDirectionalShadows=y,C.numPointShadows=S,C.numSpotShadows=w,n.version=O6++)}function u(c,f){let d=0,m=0,p=0,v=0,g=0,_=f.matrixWorldInverse;for(let x=0,b=c.length;x<b;x++){let y=c[x];if(y.isDirectionalLight){let S=n.directional[d];S.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(_),d++}else if(y.isSpotLight){let S=n.spot[p];S.position.setFromMatrixPosition(y.matrixWorld),S.position.applyMatrix4(_),S.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(_),p++}else if(y.isRectAreaLight){let S=n.rectArea[v];S.position.setFromMatrixPosition(y.matrixWorld),S.position.applyMatrix4(_),l.identity(),a.copy(y.matrixWorld),a.premultiply(_),l.extractRotation(a),S.halfWidth.set(y.width*.5,0,0),S.halfHeight.set(0,y.height*.5,0),S.halfWidth.applyMatrix4(l),S.halfHeight.applyMatrix4(l),v++}else if(y.isPointLight){let S=n.point[m];S.position.setFromMatrixPosition(y.matrixWorld),S.position.applyMatrix4(_),m++}else if(y.isHemisphereLight){let S=n.hemi[g];S.direction.setFromMatrixPosition(y.matrixWorld),S.direction.transformDirection(_),S.direction.normalize(),g++}}}return{setup:h,setupView:u,state:n}}function tL(t,e){let i=new eL(t,e),r=[],n=[];function o(){r.length=0,n.length=0}function a(f){r.push(f)}function l(f){n.push(f)}function h(f){i.setup(r,f)}function u(f){i.setupView(r,f)}return{init:o,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:h,setupLightsView:u,pushLight:a,pushShadow:l}}function iL(t,e){let i=new WeakMap;function r(o,a=0){let l;return i.has(o)===!1?(l=new tL(t,e),i.set(o,[l])):a>=i.get(o).length?(l=new tL(t,e),i.get(o).push(l)):l=i.get(o)[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var Ku=class extends gr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=_A,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};Ku.prototype.isMeshDepthMaterial=!0;var Qu=class extends gr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new j,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};Qu.prototype.isMeshDistanceMaterial=!0;var rL=`
void main() {

	gl_Position = vec4( position, 1.0 );

}
`,nL=`
uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;

#include <packing>

void main() {

	const float samples = float( VSM_SAMPLES );

	float mean = 0.0;
	float squared_mean = 0.0;

	// This seems totally useless but it's a crazy work around for a Adreno compiler bug
	// float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );

	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {

		float uvOffset = uvStart + i * uvStride;

		#ifdef HORIZONTAL_PASS

			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;

		#else

			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;

		#endif

	}

	mean = mean / samples;
	squared_mean = squared_mean / samples;

	float std_dev = sqrt( squared_mean - mean * mean );

	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );

}
`;function sL(t,e,i){let r=new Go,n=new $e,o=new $e,a=new Vt,l=new Ku({depthPacking:yA}),h=new Qu,u={},c=i.maxTextureSize,f={0:Li,1:xi,2:qt},d=new Yr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $e},radius:{value:4}},vertexShader:rL,fragmentShader:nL}),m=d.clone();m.defines.HORIZONTAL_PASS=1;let p=new pt;p.setAttribute("position",new vt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new _t(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=rm,this.render=function(y,S,w){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||y.length===0)return;let M=t.getRenderTarget(),C=t.getActiveCubeFace(),E=t.getActiveMipmapLevel(),P=t.state;P.setBlending(Pn),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let A=0,R=y.length;A<R;A++){let k=y[A],I=k.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;n.copy(I.mapSize);let L=I.getFrameExtents();if(n.multiply(L),o.copy(I.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(o.x=Math.floor(c/L.x),n.x=o.x*L.x,I.mapSize.x=o.x),n.y>c&&(o.y=Math.floor(c/L.y),n.y=o.y*L.y,I.mapSize.y=o.y)),I.map===null&&!I.isPointLightShadow&&this.type===ka&&(I.map=new pr(n.x,n.y),I.map.texture.name=k.name+".shadowMap",I.mapPass=new pr(n.x,n.y),I.camera.updateProjectionMatrix()),I.map===null){let O={minFilter:Vi,magFilter:Vi,format:er};I.map=new pr(n.x,n.y,O),I.map.texture.name=k.name+".shadowMap",I.camera.updateProjectionMatrix()}t.setRenderTarget(I.map),t.clear();let T=I.getViewportCount();for(let O=0;O<T;O++){let D=I.getViewport(O);a.set(o.x*D.x,o.y*D.y,o.x*D.z,o.y*D.w),P.viewport(a),I.updateMatrices(k,O),r=I.getFrustum(),b(S,w,I.camera,k,this.type)}!I.isPointLightShadow&&this.type===ka&&_(I,w),I.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(M,C,E)};function _(y,S){let w=e.update(v);d.defines.VSM_SAMPLES!==y.blurSamples&&(d.defines.VSM_SAMPLES=y.blurSamples,m.defines.VSM_SAMPLES=y.blurSamples,d.needsUpdate=!0,m.needsUpdate=!0),d.uniforms.shadow_pass.value=y.map.texture,d.uniforms.resolution.value=y.mapSize,d.uniforms.radius.value=y.radius,t.setRenderTarget(y.mapPass),t.clear(),t.renderBufferDirect(S,null,w,d,v,null),m.uniforms.shadow_pass.value=y.mapPass.texture,m.uniforms.resolution.value=y.mapSize,m.uniforms.radius.value=y.radius,t.setRenderTarget(y.map),t.clear(),t.renderBufferDirect(S,null,w,m,v,null)}function x(y,S,w,M,C,E){let P=null,A=w.isPointLight===!0?y.customDistanceMaterial:y.customDepthMaterial;if(A!==void 0?P=A:P=w.isPointLight===!0?h:l,t.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0){let R=P.uuid,k=S.uuid,I=u[R];I===void 0&&(I={},u[R]=I);let L=I[k];L===void 0&&(L=P.clone(),I[k]=L),P=L}return P.visible=S.visible,P.wireframe=S.wireframe,E===ka?P.side=S.shadowSide!==null?S.shadowSide:S.side:P.side=S.shadowSide!==null?S.shadowSide:f[S.side],P.alphaMap=S.alphaMap,P.alphaTest=S.alphaTest,P.clipShadows=S.clipShadows,P.clippingPlanes=S.clippingPlanes,P.clipIntersection=S.clipIntersection,P.displacementMap=S.displacementMap,P.displacementScale=S.displacementScale,P.displacementBias=S.displacementBias,P.wireframeLinewidth=S.wireframeLinewidth,P.linewidth=S.linewidth,w.isPointLight===!0&&P.isMeshDistanceMaterial===!0&&(P.referencePosition.setFromMatrixPosition(w.matrixWorld),P.nearDistance=M,P.farDistance=C),P}function b(y,S,w,M,C){if(y.visible===!1)return;if(y.layers.test(S.layers)&&(y.isMesh||y.isLine||y.isPoints)&&(y.castShadow||y.receiveShadow&&C===ka)&&(!y.frustumCulled||r.intersectsObject(y))){y.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,y.matrixWorld);let A=e.update(y),R=y.material;if(Array.isArray(R)){let k=A.groups;for(let I=0,L=k.length;I<L;I++){let T=k[I],O=R[T.materialIndex];if(O&&O.visible){let D=x(y,O,M,w.near,w.far,C);t.renderBufferDirect(w,null,A,D,y,T)}}}else if(R.visible){let k=x(y,R,M,w.near,w.far,C);t.renderBufferDirect(w,null,A,k,y,null)}}let P=y.children;for(let A=0,R=P.length;A<R;A++)b(P[A],S,w,M,C)}}function oL(t,e,i){let r=i.isWebGL2;function n(){let H=!1,pe=new Vt,we=null,Ue=new Vt(0,0,0,0);return{setMask:function(Ie){we!==Ie&&!H&&(t.colorMask(Ie,Ie,Ie,Ie),we=Ie)},setLocked:function(Ie){H=Ie},setClear:function(Ie,Ze,Ee,ft,Ot){Ot===!0&&(Ie*=ft,Ze*=ft,Ee*=ft),pe.set(Ie,Ze,Ee,ft),Ue.equals(pe)===!1&&(t.clearColor(Ie,Ze,Ee,ft),Ue.copy(pe))},reset:function(){H=!1,we=null,Ue.set(-1,0,0,0)}}}function o(){let H=!1,pe=null,we=null,Ue=null;return{setTest:function(Ie){Ie?N(t.DEPTH_TEST):z(t.DEPTH_TEST)},setMask:function(Ie){pe!==Ie&&!H&&(t.depthMask(Ie),pe=Ie)},setFunc:function(Ie){if(we!==Ie){if(Ie)switch(Ie){case HT:t.depthFunc(t.NEVER);break;case Ss:t.depthFunc(t.ALWAYS);break;case WT:t.depthFunc(t.LESS);break;case Ou:t.depthFunc(t.LEQUAL);break;case VT:t.depthFunc(t.EQUAL);break;case jT:t.depthFunc(t.GEQUAL);break;case qT:t.depthFunc(t.GREATER);break;case XT:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);we=Ie}},setLocked:function(Ie){H=Ie},setClear:function(Ie){Ue!==Ie&&(t.clearDepth(Ie),Ue=Ie)},reset:function(){H=!1,pe=null,we=null,Ue=null}}}function a(){let H=!1,pe=null,we=null,Ue=null,Ie=null,Ze=null,Ee=null,ft=null,Ot=null;return{setTest:function(Ct){H||(Ct?N(t.STENCIL_TEST):z(t.STENCIL_TEST))},setMask:function(Ct){pe!==Ct&&!H&&(t.stencilMask(Ct),pe=Ct)},setFunc:function(Ct,$i,ln){(we!==Ct||Ue!==$i||Ie!==ln)&&(t.stencilFunc(Ct,$i,ln),we=Ct,Ue=$i,Ie=ln)},setOp:function(Ct,$i,ln){(Ze!==Ct||Ee!==$i||ft!==ln)&&(t.stencilOp(Ct,$i,ln),Ze=Ct,Ee=$i,ft=ln)},setLocked:function(Ct){H=Ct},setClear:function(Ct){Ot!==Ct&&(t.clearStencil(Ct),Ot=Ct)},reset:function(){H=!1,pe=null,we=null,Ue=null,Ie=null,Ze=null,Ee=null,ft=null,Ot=null}}}let l=new n,h=new o,u=new a,c={},f={},d=new WeakMap,m=[],p=null,v=!1,g=null,_=null,x=null,b=null,y=null,S=null,w=null,M=!1,C=null,E=null,P=null,A=null,R=null,k=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),I=!1,L=0,T=t.getParameter(t.VERSION);T.indexOf("WebGL")!==-1?(L=parseFloat(/^WebGL (\d)/.exec(T)[1]),I=L>=1):T.indexOf("OpenGL ES")!==-1&&(L=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),I=L>=2);let O=null,D={},F=t.getParameter(t.SCISSOR_BOX),B=t.getParameter(t.VIEWPORT),U=new Vt().fromArray(F),G=new Vt().fromArray(B);function Y(H,pe,we){let Ue=new Uint8Array(4),Ie=t.createTexture();t.bindTexture(H,Ie),t.texParameteri(H,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(H,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Ze=0;Ze<we;Ze++)t.texImage2D(pe+Ze,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Ue);return Ie}let re={};re[t.TEXTURE_2D]=Y(t.TEXTURE_2D,t.TEXTURE_2D,1),re[t.TEXTURE_CUBE_MAP]=Y(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),l.setClear(0,0,0,1),h.setClear(1),u.setClear(0),N(t.DEPTH_TEST),h.setFunc(Ou),Re(!1),Le($_),N(t.CULL_FACE),ue(Pn);function N(H){c[H]!==!0&&(t.enable(H),c[H]=!0)}function z(H){c[H]!==!1&&(t.disable(H),c[H]=!1)}function ie(H,pe){return f[H]!==pe?(t.bindFramebuffer(H,pe),f[H]=pe,r&&(H===t.DRAW_FRAMEBUFFER&&(f[t.FRAMEBUFFER]=pe),H===t.FRAMEBUFFER&&(f[t.DRAW_FRAMEBUFFER]=pe)),!0):!1}function Z(H,pe){let we=m,Ue=!1;if(H)if(we=d.get(pe),we===void 0&&(we=[],d.set(pe,we)),H.isWebGLMultipleRenderTargets){let Ie=H.texture;if(we.length!==Ie.length||we[0]!==t.COLOR_ATTACHMENT0){for(let Ze=0,Ee=Ie.length;Ze<Ee;Ze++)we[Ze]=t.COLOR_ATTACHMENT0+Ze;we.length=Ie.length,Ue=!0}}else we[0]!==t.COLOR_ATTACHMENT0&&(we[0]=t.COLOR_ATTACHMENT0,Ue=!0);else we[0]!==t.BACK&&(we[0]=t.BACK,Ue=!0);Ue&&(i.isWebGL2?t.drawBuffers(we):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(we))}function ne(H){return p!==H?(t.useProgram(H),p=H,!0):!1}let K={[ko]:t.FUNC_ADD,[LT]:t.FUNC_SUBTRACT,[OT]:t.FUNC_REVERSE_SUBTRACT};if(r)K[ry]=t.MIN,K[ny]=t.MAX;else{let H=e.get("EXT_blend_minmax");H!==null&&(K[ry]=H.MIN_EXT,K[ny]=H.MAX_EXT)}let ae={[DT]:t.ZERO,[IT]:t.ONE,[kT]:t.SRC_COLOR,[sm]:t.SRC_ALPHA,[GT]:t.SRC_ALPHA_SATURATE,[UT]:t.DST_COLOR,[BT]:t.DST_ALPHA,[FT]:t.ONE_MINUS_SRC_COLOR,[om]:t.ONE_MINUS_SRC_ALPHA,[zT]:t.ONE_MINUS_DST_COLOR,[NT]:t.ONE_MINUS_DST_ALPHA};function ue(H,pe,we,Ue,Ie,Ze,Ee,ft){if(H===Pn){v===!0&&(z(t.BLEND),v=!1);return}if(v===!1&&(N(t.BLEND),v=!0),H!==RT){if(H!==g||ft!==M){if((_!==ko||y!==ko)&&(t.blendEquation(t.FUNC_ADD),_=ko,y=ko),ft)switch(H){case eo:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case ey:t.blendFunc(t.ONE,t.ONE);break;case ty:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case iy:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}else switch(H){case eo:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case ey:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case ty:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case iy:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}x=null,b=null,S=null,w=null,g=H,M=ft}return}Ie=Ie||pe,Ze=Ze||we,Ee=Ee||Ue,(pe!==_||Ie!==y)&&(t.blendEquationSeparate(K[pe],K[Ie]),_=pe,y=Ie),(we!==x||Ue!==b||Ze!==S||Ee!==w)&&(t.blendFuncSeparate(ae[we],ae[Ue],ae[Ze],ae[Ee]),x=we,b=Ue,S=Ze,w=Ee),g=H,M=null}function _e(H,pe){H.side===qt?z(t.CULL_FACE):N(t.CULL_FACE);let we=H.side===Li;pe&&(we=!we),Re(we),H.blending===eo&&H.transparent===!1?ue(Pn):ue(H.blending,H.blendEquation,H.blendSrc,H.blendDst,H.blendEquationAlpha,H.blendSrcAlpha,H.blendDstAlpha,H.premultipliedAlpha),h.setFunc(H.depthFunc),h.setTest(H.depthTest),h.setMask(H.depthWrite),l.setMask(H.colorWrite);let Ue=H.stencilWrite;u.setTest(Ue),Ue&&(u.setMask(H.stencilWriteMask),u.setFunc(H.stencilFunc,H.stencilRef,H.stencilFuncMask),u.setOp(H.stencilFail,H.stencilZFail,H.stencilZPass)),it(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),H.alphaToCoverage===!0?N(t.SAMPLE_ALPHA_TO_COVERAGE):z(t.SAMPLE_ALPHA_TO_COVERAGE)}function Re(H){C!==H&&(H?t.frontFace(t.CW):t.frontFace(t.CCW),C=H)}function Le(H){H!==TT?(N(t.CULL_FACE),H!==E&&(H===$_?t.cullFace(t.BACK):H===AT?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):z(t.CULL_FACE),E=H}function Et(H){H!==P&&(I&&t.lineWidth(H),P=H)}function it(H,pe,we){H?(N(t.POLYGON_OFFSET_FILL),(A!==pe||R!==we)&&(t.polygonOffset(pe,we),A=pe,R=we)):z(t.POLYGON_OFFSET_FILL)}function je(H){H?N(t.SCISSOR_TEST):z(t.SCISSOR_TEST)}function ut(H){H===void 0&&(H=t.TEXTURE0+k-1),O!==H&&(t.activeTexture(H),O=H)}function jt(H,pe){O===null&&ut();let we=D[O];we===void 0&&(we={type:void 0,texture:void 0},D[O]=we),(we.type!==H||we.texture!==pe)&&(t.bindTexture(H,pe||re[H]),we.type=H,we.texture=pe)}function Wt(){let H=D[O];H!==void 0&&H.type!==void 0&&(t.bindTexture(H.type,null),H.type=void 0,H.texture=void 0)}function X(){try{t.compressedTexImage2D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function V(){try{t.texSubImage2D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function me(){try{t.texSubImage3D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Ce(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function De(){try{t.texStorage2D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function He(){try{t.texStorage3D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Qe(){try{t.texImage2D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function de(){try{t.texImage3D.apply(t,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Ge(H){U.equals(H)===!1&&(t.scissor(H.x,H.y,H.z,H.w),U.copy(H))}function gt(H){G.equals(H)===!1&&(t.viewport(H.x,H.y,H.z,H.w),G.copy(H))}function We(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),r===!0&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},O=null,D={},f={},d=new WeakMap,m=[],p=null,v=!1,g=null,_=null,x=null,b=null,y=null,S=null,w=null,M=!1,C=null,E=null,P=null,A=null,R=null,U.set(0,0,t.canvas.width,t.canvas.height),G.set(0,0,t.canvas.width,t.canvas.height),l.reset(),h.reset(),u.reset()}return{buffers:{color:l,depth:h,stencil:u},enable:N,disable:z,bindFramebuffer:ie,drawBuffers:Z,useProgram:ne,setBlending:ue,setMaterial:_e,setFlipSided:Re,setCullFace:Le,setLineWidth:Et,setPolygonOffset:it,setScissorTest:je,activeTexture:ut,bindTexture:jt,unbindTexture:Wt,compressedTexImage2D:X,texImage2D:Qe,texImage3D:de,texStorage2D:De,texStorage3D:He,texSubImage2D:V,texSubImage3D:me,compressedTexSubImage2D:Ce,scissor:Ge,viewport:gt,reset:We}}function aL(t,e,i,r,n,o,a){let l=n.isWebGL2,h=n.maxTextures,u=n.maxCubemapSize,c=n.maxTextureSize,f=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,v,g=new WeakMap,_=!1;try{_=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(X){}function x(X,V){return _?new OffscreenCanvas(X,V):Uu("canvas")}function b(X,V,me,Ce){let De=1;if((X.width>Ce||X.height>Ce)&&(De=Ce/Math.max(X.width,X.height)),De<1||V===!0)if(typeof HTMLImageElement!="undefined"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&X instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&X instanceof ImageBitmap){let He=V?Nu:Math.floor,Qe=He(De*X.width),de=He(De*X.height);v===void 0&&(v=x(Qe,de));let Ge=me?x(Qe,de):v;return Ge.width=Qe,Ge.height=de,Ge.getContext("2d").drawImage(X,0,0,Qe,de),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+X.width+"x"+X.height+") to ("+Qe+"x"+de+")."),Ge}else return"data"in X&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+X.width+"x"+X.height+")."),X;return X}function y(X){return Oy(X.width)&&Oy(X.height)}function S(X){return l?!1:X.wrapS!==Cr||X.wrapT!==Cr||X.minFilter!==Vi&&X.minFilter!==ji}function w(X,V){return X.generateMipmaps&&V&&X.minFilter!==Vi&&X.minFilter!==ji}function M(X){t.generateMipmap(X)}function C(X,V,me,Ce,De=!1){if(l===!1)return V;if(X!==null){if(t[X]!==void 0)return t[X];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+X+"'")}let He=V;return V===t.RED&&(me===t.FLOAT&&(He=t.R32F),me===t.HALF_FLOAT&&(He=t.R16F),me===t.UNSIGNED_BYTE&&(He=t.R8)),V===t.RG&&(me===t.FLOAT&&(He=t.RG32F),me===t.HALF_FLOAT&&(He=t.RG16F),me===t.UNSIGNED_BYTE&&(He=t.RG8)),V===t.RGBA&&(me===t.FLOAT&&(He=t.RGBA32F),me===t.HALF_FLOAT&&(He=t.RGBA16F),me===t.UNSIGNED_BYTE&&(He=Ce===Qt&&De===!1?t.SRGB8_ALPHA8:t.RGBA8),me===t.UNSIGNED_SHORT_4_4_4_4&&(He=t.RGBA4),me===t.UNSIGNED_SHORT_5_5_5_1&&(He=t.RGB5_A1)),(He===t.R16F||He===t.R32F||He===t.RG16F||He===t.RG32F||He===t.RGBA16F||He===t.RGBA32F)&&e.get("EXT_color_buffer_float"),He}function E(X,V,me){return w(X,me)===!0||X.isFramebufferTexture&&X.minFilter!==Vi&&X.minFilter!==ji?Math.log2(Math.max(V.width,V.height))+1:X.mipmaps!==void 0&&X.mipmaps.length>0?X.mipmaps.length:X.isCompressedTexture&&Array.isArray(X.image)?V.mipmaps.length:1}function P(X){return X===Vi||X===oy||X===ay?t.NEAREST:t.LINEAR}function A(X){let V=X.target;V.removeEventListener("dispose",A),k(V),V.isVideoTexture&&p.delete(V)}function R(X){let V=X.target;V.removeEventListener("dispose",R),L(V)}function k(X){let V=r.get(X);if(V.__webglInit===void 0)return;let me=X.source,Ce=g.get(me);if(Ce){let De=Ce[V.__cacheKey];De.usedTimes--,De.usedTimes===0&&I(X),Object.keys(Ce).length===0&&g.delete(me)}r.remove(X)}function I(X){let V=r.get(X);t.deleteTexture(V.__webglTexture);let me=X.source,Ce=g.get(me);delete Ce[V.__cacheKey],a.memory.textures--}function L(X){let V=X.texture,me=r.get(X),Ce=r.get(V);if(Ce.__webglTexture!==void 0&&(t.deleteTexture(Ce.__webglTexture),a.memory.textures--),X.depthTexture&&X.depthTexture.dispose(),X.isWebGLCubeRenderTarget)for(let De=0;De<6;De++)t.deleteFramebuffer(me.__webglFramebuffer[De]),me.__webglDepthbuffer&&t.deleteRenderbuffer(me.__webglDepthbuffer[De]);else t.deleteFramebuffer(me.__webglFramebuffer),me.__webglDepthbuffer&&t.deleteRenderbuffer(me.__webglDepthbuffer),me.__webglMultisampledFramebuffer&&t.deleteFramebuffer(me.__webglMultisampledFramebuffer),me.__webglColorRenderbuffer&&t.deleteRenderbuffer(me.__webglColorRenderbuffer),me.__webglDepthRenderbuffer&&t.deleteRenderbuffer(me.__webglDepthRenderbuffer);if(X.isWebGLMultipleRenderTargets)for(let De=0,He=V.length;De<He;De++){let Qe=r.get(V[De]);Qe.__webglTexture&&(t.deleteTexture(Qe.__webglTexture),a.memory.textures--),r.remove(V[De])}r.remove(V),r.remove(X)}let T=0;function O(){T=0}function D(){let X=T;return X>=h&&console.warn("THREE.WebGLTextures: Trying to use "+X+" texture units while this GPU supports only "+h),T+=1,X}function F(X){let V=[];return V.push(X.wrapS),V.push(X.wrapT),V.push(X.magFilter),V.push(X.minFilter),V.push(X.anisotropy),V.push(X.internalFormat),V.push(X.format),V.push(X.type),V.push(X.generateMipmaps),V.push(X.premultiplyAlpha),V.push(X.flipY),V.push(X.unpackAlignment),V.push(X.encoding),V.join()}function B(X,V){let me=r.get(X);if(X.isVideoTexture&&jt(X),X.isRenderTargetTexture===!1&&X.version>0&&me.__version!==X.version){let Ce=X.image;if(Ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Z(me,X,V);return}}i.activeTexture(t.TEXTURE0+V),i.bindTexture(t.TEXTURE_2D,me.__webglTexture)}function U(X,V){let me=r.get(X);if(X.version>0&&me.__version!==X.version){Z(me,X,V);return}i.activeTexture(t.TEXTURE0+V),i.bindTexture(t.TEXTURE_2D_ARRAY,me.__webglTexture)}function G(X,V){let me=r.get(X);if(X.version>0&&me.__version!==X.version){Z(me,X,V);return}i.activeTexture(t.TEXTURE0+V),i.bindTexture(t.TEXTURE_3D,me.__webglTexture)}function Y(X,V){let me=r.get(X);if(X.version>0&&me.__version!==X.version){ne(me,X,V);return}i.activeTexture(t.TEXTURE0+V),i.bindTexture(t.TEXTURE_CUBE_MAP,me.__webglTexture)}let re={[ku]:t.REPEAT,[Cr]:t.CLAMP_TO_EDGE,[Fu]:t.MIRRORED_REPEAT},N={[Vi]:t.NEAREST,[oy]:t.NEAREST_MIPMAP_NEAREST,[ay]:t.NEAREST_MIPMAP_LINEAR,[ji]:t.LINEAR,[tA]:t.LINEAR_MIPMAP_NEAREST,[No]:t.LINEAR_MIPMAP_LINEAR};function z(X,V,me){if(me?(t.texParameteri(X,t.TEXTURE_WRAP_S,re[V.wrapS]),t.texParameteri(X,t.TEXTURE_WRAP_T,re[V.wrapT]),(X===t.TEXTURE_3D||X===t.TEXTURE_2D_ARRAY)&&t.texParameteri(X,t.TEXTURE_WRAP_R,re[V.wrapR]),t.texParameteri(X,t.TEXTURE_MAG_FILTER,N[V.magFilter]),t.texParameteri(X,t.TEXTURE_MIN_FILTER,N[V.minFilter])):(t.texParameteri(X,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(X,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(X===t.TEXTURE_3D||X===t.TEXTURE_2D_ARRAY)&&t.texParameteri(X,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),(V.wrapS!==Cr||V.wrapT!==Cr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(X,t.TEXTURE_MAG_FILTER,P(V.magFilter)),t.texParameteri(X,t.TEXTURE_MIN_FILTER,P(V.minFilter)),V.minFilter!==Vi&&V.minFilter!==ji&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Ce=e.get("EXT_texture_filter_anisotropic");if(V.type===Jn&&e.has("OES_texture_float_linear")===!1||l===!1&&V.type===Es&&e.has("OES_texture_half_float_linear")===!1)return;(V.anisotropy>1||r.get(V).__currentAnisotropy)&&(t.texParameterf(X,Ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,n.getMaxAnisotropy())),r.get(V).__currentAnisotropy=V.anisotropy)}}function ie(X,V){let me=!1;X.__webglInit===void 0&&(X.__webglInit=!0,V.addEventListener("dispose",A));let Ce=V.source,De=g.get(Ce);De===void 0&&(De={},g.set(Ce,De));let He=F(V);if(He!==X.__cacheKey){De[He]===void 0&&(De[He]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,me=!0),De[He].usedTimes++;let Qe=De[X.__cacheKey];Qe!==void 0&&(De[X.__cacheKey].usedTimes--,Qe.usedTimes===0&&I(V)),X.__cacheKey=He,X.__webglTexture=De[He].texture}return me}function Z(X,V,me){let Ce=t.TEXTURE_2D;V.isDataArrayTexture&&(Ce=t.TEXTURE_2D_ARRAY),V.isData3DTexture&&(Ce=t.TEXTURE_3D);let De=ie(X,V),He=V.source;if(i.activeTexture(t.TEXTURE0+me),i.bindTexture(Ce,X.__webglTexture),He.version!==He.__currentVersion||De===!0){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,V.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,V.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);let Qe=S(V)&&y(V.image)===!1,de=b(V.image,Qe,!1,c);de=Wt(V,de);let Ge=y(de)||l,gt=o.convert(V.format,V.encoding),We=o.convert(V.type),H=C(V.internalFormat,gt,We,V.encoding,V.isVideoTexture);z(Ce,V,Ge);let pe,we=V.mipmaps,Ue=l&&V.isVideoTexture!==!0,Ie=X.__version===void 0,Ze=E(V,de,Ge);if(V.isDepthTexture)H=t.DEPTH_COMPONENT,l?V.type===Jn?H=t.DEPTH_COMPONENT32F:V.type===Ol?H=t.DEPTH_COMPONENT24:V.type===Ms?H=t.DEPTH24_STENCIL8:H=t.DEPTH_COMPONENT16:V.type===Jn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===$n&&H===t.DEPTH_COMPONENT&&V.type!==to&&V.type!==Ol&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=to,We=o.convert(V.type)),V.format===Ts&&H===t.DEPTH_COMPONENT&&(H=t.DEPTH_STENCIL,V.type!==Ms&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=Ms,We=o.convert(V.type))),Ue&&Ie?i.texStorage2D(t.TEXTURE_2D,1,H,de.width,de.height):i.texImage2D(t.TEXTURE_2D,0,H,de.width,de.height,0,gt,We,null);else if(V.isDataTexture)if(we.length>0&&Ge){Ue&&Ie&&i.texStorage2D(t.TEXTURE_2D,Ze,H,we[0].width,we[0].height);for(let Ee=0,ft=we.length;Ee<ft;Ee++)pe=we[Ee],Ue?i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,pe.width,pe.height,gt,We,pe.data):i.texImage2D(t.TEXTURE_2D,Ee,H,pe.width,pe.height,0,gt,We,pe.data);V.generateMipmaps=!1}else Ue?(Ie&&i.texStorage2D(t.TEXTURE_2D,Ze,H,de.width,de.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,de.width,de.height,gt,We,de.data)):i.texImage2D(t.TEXTURE_2D,0,H,de.width,de.height,0,gt,We,de.data);else if(V.isCompressedTexture){Ue&&Ie&&i.texStorage2D(t.TEXTURE_2D,Ze,H,we[0].width,we[0].height);for(let Ee=0,ft=we.length;Ee<ft;Ee++)pe=we[Ee],V.format!==er?gt!==null?Ue?i.compressedTexSubImage2D(t.TEXTURE_2D,Ee,0,0,pe.width,pe.height,gt,pe.data):i.compressedTexImage2D(t.TEXTURE_2D,Ee,H,pe.width,pe.height,0,pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ue?i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,pe.width,pe.height,gt,We,pe.data):i.texImage2D(t.TEXTURE_2D,Ee,H,pe.width,pe.height,0,gt,We,pe.data)}else if(V.isDataArrayTexture)Ue?(Ie&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Ze,H,de.width,de.height,de.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,de.width,de.height,de.depth,gt,We,de.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,H,de.width,de.height,de.depth,0,gt,We,de.data);else if(V.isData3DTexture)Ue?(Ie&&i.texStorage3D(t.TEXTURE_3D,Ze,H,de.width,de.height,de.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,de.width,de.height,de.depth,gt,We,de.data)):i.texImage3D(t.TEXTURE_3D,0,H,de.width,de.height,de.depth,0,gt,We,de.data);else if(V.isFramebufferTexture)Ue&&Ie?i.texStorage2D(t.TEXTURE_2D,Ze,H,de.width,de.height):i.texImage2D(t.TEXTURE_2D,0,H,de.width,de.height,0,gt,We,null);else if(we.length>0&&Ge){Ue&&Ie&&i.texStorage2D(t.TEXTURE_2D,Ze,H,we[0].width,we[0].height);for(let Ee=0,ft=we.length;Ee<ft;Ee++)pe=we[Ee],Ue?i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,gt,We,pe):i.texImage2D(t.TEXTURE_2D,Ee,H,gt,We,pe);V.generateMipmaps=!1}else Ue?(Ie&&i.texStorage2D(t.TEXTURE_2D,Ze,H,de.width,de.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,gt,We,de)):i.texImage2D(t.TEXTURE_2D,0,H,gt,We,de);w(V,Ge)&&M(Ce),He.__currentVersion=He.version,V.onUpdate&&V.onUpdate(V)}X.__version=V.version}function ne(X,V,me){if(V.image.length!==6)return;let Ce=ie(X,V),De=V.source;if(i.activeTexture(t.TEXTURE0+me),i.bindTexture(t.TEXTURE_CUBE_MAP,X.__webglTexture),De.version!==De.__currentVersion||Ce===!0){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,V.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,V.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);let He=V.isCompressedTexture||V.image[0].isCompressedTexture,Qe=V.image[0]&&V.image[0].isDataTexture,de=[];for(let Ee=0;Ee<6;Ee++)!He&&!Qe?de[Ee]=b(V.image[Ee],!1,!0,u):de[Ee]=Qe?V.image[Ee].image:V.image[Ee],de[Ee]=Wt(V,de[Ee]);let Ge=de[0],gt=y(Ge)||l,We=o.convert(V.format,V.encoding),H=o.convert(V.type),pe=C(V.internalFormat,We,H,V.encoding),we=l&&V.isVideoTexture!==!0,Ue=X.__version===void 0,Ie=E(V,Ge,gt);z(t.TEXTURE_CUBE_MAP,V,gt);let Ze;if(He){we&&Ue&&i.texStorage2D(t.TEXTURE_CUBE_MAP,Ie,pe,Ge.width,Ge.height);for(let Ee=0;Ee<6;Ee++){Ze=de[Ee].mipmaps;for(let ft=0;ft<Ze.length;ft++){let Ot=Ze[ft];V.format!==er?We!==null?we?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft,0,0,Ot.width,Ot.height,We,Ot.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft,pe,Ot.width,Ot.height,0,Ot.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):we?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft,0,0,Ot.width,Ot.height,We,H,Ot.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft,pe,Ot.width,Ot.height,0,We,H,Ot.data)}}}else{Ze=V.mipmaps,we&&Ue&&(Ze.length>0&&Ie++,i.texStorage2D(t.TEXTURE_CUBE_MAP,Ie,pe,de[0].width,de[0].height));for(let Ee=0;Ee<6;Ee++)if(Qe){we?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,de[Ee].width,de[Ee].height,We,H,de[Ee].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,pe,de[Ee].width,de[Ee].height,0,We,H,de[Ee].data);for(let ft=0;ft<Ze.length;ft++){let Ct=Ze[ft].image[Ee].image;we?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft+1,0,0,Ct.width,Ct.height,We,H,Ct.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft+1,pe,Ct.width,Ct.height,0,We,H,Ct.data)}}else{we?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,We,H,de[Ee]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,pe,We,H,de[Ee]);for(let ft=0;ft<Ze.length;ft++){let Ot=Ze[ft];we?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft+1,0,0,We,H,Ot.image[Ee]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,ft+1,pe,We,H,Ot.image[Ee])}}}w(V,gt)&&M(t.TEXTURE_CUBE_MAP),De.__currentVersion=De.version,V.onUpdate&&V.onUpdate(V)}X.__version=V.version}function K(X,V,me,Ce,De){let He=o.convert(me.format,me.encoding),Qe=o.convert(me.type),de=C(me.internalFormat,He,Qe,me.encoding);r.get(V).__hasExternalTextures||(De===t.TEXTURE_3D||De===t.TEXTURE_2D_ARRAY?i.texImage3D(De,0,de,V.width,V.height,V.depth,0,He,Qe,null):i.texImage2D(De,0,de,V.width,V.height,0,He,Qe,null)),i.bindFramebuffer(t.FRAMEBUFFER,X),ut(V)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Ce,De,r.get(me).__webglTexture,0,je(V)):t.framebufferTexture2D(t.FRAMEBUFFER,Ce,De,r.get(me).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function ae(X,V,me){if(t.bindRenderbuffer(t.RENDERBUFFER,X),V.depthBuffer&&!V.stencilBuffer){let Ce=t.DEPTH_COMPONENT16;if(me||ut(V)){let De=V.depthTexture;De&&De.isDepthTexture&&(De.type===Jn?Ce=t.DEPTH_COMPONENT32F:De.type===Ol&&(Ce=t.DEPTH_COMPONENT24));let He=je(V);ut(V)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,He,Ce,V.width,V.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,He,Ce,V.width,V.height)}else t.renderbufferStorage(t.RENDERBUFFER,Ce,V.width,V.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,X)}else if(V.depthBuffer&&V.stencilBuffer){let Ce=je(V);me&&ut(V)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ce,t.DEPTH24_STENCIL8,V.width,V.height):ut(V)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ce,t.DEPTH24_STENCIL8,V.width,V.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,V.width,V.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,X)}else{let Ce=V.isWebGLMultipleRenderTargets===!0?V.texture[0]:V.texture,De=o.convert(Ce.format,Ce.encoding),He=o.convert(Ce.type),Qe=C(Ce.internalFormat,De,He,Ce.encoding),de=je(V);me&&ut(V)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,de,Qe,V.width,V.height):ut(V)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,de,Qe,V.width,V.height):t.renderbufferStorage(t.RENDERBUFFER,Qe,V.width,V.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function ue(X,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,X),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),B(V.depthTexture,0);let Ce=r.get(V.depthTexture).__webglTexture,De=je(V);if(V.depthTexture.format===$n)ut(V)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ce,0,De):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ce,0);else if(V.depthTexture.format===Ts)ut(V)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ce,0,De):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ce,0);else throw new Error("Unknown depthTexture format")}function _e(X){let V=r.get(X),me=X.isWebGLCubeRenderTarget===!0;if(X.depthTexture&&!V.__autoAllocateDepthBuffer){if(me)throw new Error("target.depthTexture not supported in Cube render targets");ue(V.__webglFramebuffer,X)}else if(me){V.__webglDepthbuffer=[];for(let Ce=0;Ce<6;Ce++)i.bindFramebuffer(t.FRAMEBUFFER,V.__webglFramebuffer[Ce]),V.__webglDepthbuffer[Ce]=t.createRenderbuffer(),ae(V.__webglDepthbuffer[Ce],X,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,V.__webglFramebuffer),V.__webglDepthbuffer=t.createRenderbuffer(),ae(V.__webglDepthbuffer,X,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function Re(X,V,me){let Ce=r.get(X);V!==void 0&&K(Ce.__webglFramebuffer,X,X.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),me!==void 0&&_e(X)}function Le(X){let V=X.texture,me=r.get(X),Ce=r.get(V);X.addEventListener("dispose",R),X.isWebGLMultipleRenderTargets!==!0&&(Ce.__webglTexture===void 0&&(Ce.__webglTexture=t.createTexture()),Ce.__version=V.version,a.memory.textures++);let De=X.isWebGLCubeRenderTarget===!0,He=X.isWebGLMultipleRenderTargets===!0,Qe=y(X)||l;if(De){me.__webglFramebuffer=[];for(let de=0;de<6;de++)me.__webglFramebuffer[de]=t.createFramebuffer()}else if(me.__webglFramebuffer=t.createFramebuffer(),He)if(n.drawBuffers){let de=X.texture;for(let Ge=0,gt=de.length;Ge<gt;Ge++){let We=r.get(de[Ge]);We.__webglTexture===void 0&&(We.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(l&&X.samples>0&&ut(X)===!1){me.__webglMultisampledFramebuffer=t.createFramebuffer(),me.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,me.__webglColorRenderbuffer);let de=o.convert(V.format,V.encoding),Ge=o.convert(V.type),gt=C(V.internalFormat,de,Ge,V.encoding),We=je(X);t.renderbufferStorageMultisample(t.RENDERBUFFER,We,gt,X.width,X.height),i.bindFramebuffer(t.FRAMEBUFFER,me.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,me.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),X.depthBuffer&&(me.__webglDepthRenderbuffer=t.createRenderbuffer(),ae(me.__webglDepthRenderbuffer,X,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}if(De){i.bindTexture(t.TEXTURE_CUBE_MAP,Ce.__webglTexture),z(t.TEXTURE_CUBE_MAP,V,Qe);for(let de=0;de<6;de++)K(me.__webglFramebuffer[de],X,V,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+de);w(V,Qe)&&M(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(He){let de=X.texture;for(let Ge=0,gt=de.length;Ge<gt;Ge++){let We=de[Ge],H=r.get(We);i.bindTexture(t.TEXTURE_2D,H.__webglTexture),z(t.TEXTURE_2D,We,Qe),K(me.__webglFramebuffer,X,We,t.COLOR_ATTACHMENT0+Ge,t.TEXTURE_2D),w(We,Qe)&&M(t.TEXTURE_2D)}i.unbindTexture()}else{let de=t.TEXTURE_2D;(X.isWebGL3DRenderTarget||X.isWebGLArrayRenderTarget)&&(l?de=X.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(de,Ce.__webglTexture),z(de,V,Qe),K(me.__webglFramebuffer,X,V,t.COLOR_ATTACHMENT0,de),w(V,Qe)&&M(de),i.unbindTexture()}X.depthBuffer&&_e(X)}function Et(X){let V=y(X)||l,me=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let Ce=0,De=me.length;Ce<De;Ce++){let He=me[Ce];if(w(He,V)){let Qe=X.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,de=r.get(He).__webglTexture;i.bindTexture(Qe,de),M(Qe),i.unbindTexture()}}}function it(X){if(l&&X.samples>0&&ut(X)===!1){let V=X.width,me=X.height,Ce=t.COLOR_BUFFER_BIT,De=[t.COLOR_ATTACHMENT0],He=X.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;X.depthBuffer&&De.push(He);let Qe=r.get(X),de=Qe.__ignoreDepthValues!==void 0?Qe.__ignoreDepthValues:!1;de===!1&&(X.depthBuffer&&(Ce|=t.DEPTH_BUFFER_BIT),X.stencilBuffer&&(Ce|=t.STENCIL_BUFFER_BIT)),i.bindFramebuffer(t.READ_FRAMEBUFFER,Qe.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,Qe.__webglFramebuffer),de===!0&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[He]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[He])),t.blitFramebuffer(0,0,V,me,0,0,V,me,Ce,t.NEAREST),m&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,De),i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,Qe.__webglMultisampledFramebuffer)}}function je(X){return Math.min(f,X.samples)}function ut(X){let V=r.get(X);return l&&X.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function jt(X){let V=a.render.frame;p.get(X)!==V&&(p.set(X,V),X.update())}function Wt(X,V){let me=X.encoding,Ce=X.format,De=X.type;return X.isCompressedTexture===!0||X.isVideoTexture===!0||X.format===Bu||me!==Er&&(me===Qt?l===!1?e.has("EXT_sRGB")===!0&&Ce===er?(X.format=Bu,X.minFilter=ji,X.generateMipmaps=!1):V=kl.sRGBToLinear(V):(Ce!==er||De!==Rn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",me)),V}this.allocateTextureUnit=D,this.resetTextureUnits=O,this.setTexture2D=B,this.setTexture2DArray=U,this.setTexture3D=G,this.setTextureCube=Y,this.rebindTextures=Re,this.setupRenderTarget=Le,this.updateRenderTargetMipmap=Et,this.updateMultisampleRenderTarget=it,this.setupDepthRenderbuffer=_e,this.setupFrameBufferTexture=K,this.useMultisampledRTT=ut}function lL(t,e,i){let r=i.isWebGL2;function n(o,a=null){let l;if(o===Rn)return t.UNSIGNED_BYTE;if(o===oA)return t.UNSIGNED_SHORT_4_4_4_4;if(o===aA)return t.UNSIGNED_SHORT_5_5_5_1;if(o===rA)return t.BYTE;if(o===nA)return t.SHORT;if(o===to)return t.UNSIGNED_SHORT;if(o===sA)return t.INT;if(o===Ol)return t.UNSIGNED_INT;if(o===Jn)return t.FLOAT;if(o===Es)return r?t.HALF_FLOAT:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(o===lA)return t.ALPHA;if(o===er)return t.RGBA;if(o===uA)return t.LUMINANCE;if(o===cA)return t.LUMINANCE_ALPHA;if(o===$n)return t.DEPTH_COMPONENT;if(o===Ts)return t.DEPTH_STENCIL;if(o===fA)return t.RED;if(o===hA)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),t.RGBA;if(o===Bu)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(o===dA)return t.RED_INTEGER;if(o===pA)return t.RG;if(o===mA)return t.RG_INTEGER;if(o===gA)return t.RGBA_INTEGER;if(o===am||o===lm||o===hm||o===um)if(a===Qt)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(o===am)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===lm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===hm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===um)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(o===am)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===lm)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===hm)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===um)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===ly||o===hy||o===uy||o===cy)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(o===ly)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===hy)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===uy)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===cy)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===vA)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===fy||o===dy)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(o===fy)return a===Qt?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(o===dy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===py||o===my||o===gy||o===vy||o===_y||o===yy||o===xy||o===by||o===wy||o===Sy||o===Cy||o===Ey||o===My||o===Ty)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(o===py)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===my)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===gy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===vy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===_y)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===yy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===xy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===by)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===wy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===Sy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===Cy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===Ey)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===My)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===Ty)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===Ay)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(o===Ay)return a===Qt?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return o===Ms?r?t.UNSIGNED_INT_24_8:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):t[o]!==void 0?t[o]:null}return{convert:n}}var Ju=class extends Fi{constructor(e=[]){super(),this.cameras=e}};Ju.prototype.isArrayCamera=!0;var Pr=class extends ii{constructor(){super(),this.type="Group"}};Pr.prototype.isGroup=!0;var k6={type:"move"},eh=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Pr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Pr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new j,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new j),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Pr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new j,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new j),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let n=null,o=null,a=null,l=this._targetRay,h=this._grip,u=this._hand;if(e&&i.session.visibilityState!=="visible-blurred")if(l!==null&&(n=i.getPose(e.targetRaySpace,r),n!==null&&(l.matrix.fromArray(n.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),n.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(n.linearVelocity)):l.hasLinearVelocity=!1,n.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(n.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(k6))),u&&e.hand){a=!0;for(let v of e.hand.values()){let g=i.getJointPose(v,r);if(u.joints[v.jointName]===void 0){let x=new Pr;x.matrixAutoUpdate=!1,x.visible=!1,u.joints[v.jointName]=x,u.add(x)}let _=u.joints[v.jointName];g!==null&&(_.matrix.fromArray(g.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=g.radius),_.visible=g!==null}let c=u.joints["index-finger-tip"],f=u.joints["thumb-tip"],d=c.position.distanceTo(f.position),m=.02,p=.005;u.inputState.pinching&&d>m+p?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=m-p&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,r),o!==null&&(h.matrix.fromArray(o.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),o.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(o.linearVelocity)):h.hasLinearVelocity=!1,o.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(o.angularVelocity)):h.hasAngularVelocity=!1));return l!==null&&(l.visible=n!==null),h!==null&&(h.visible=o!==null),u!==null&&(u.visible=a!==null),this}};var $u=class extends Di{constructor(e,i,r,n,o,a,l,h,u,c){if(c=c!==void 0?c:$n,c!==$n&&c!==Ts)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===$n&&(r=to),r===void 0&&c===Ts&&(r=Ms),super(null,n,o,a,l,h,c,r,u),this.image={width:e,height:i},this.magFilter=l!==void 0?l:Vi,this.minFilter=h!==void 0?h:Vi,this.flipY=!1,this.generateMipmaps=!1}};$u.prototype.isDepthTexture=!0;var Um=class extends dr{constructor(e,i){super();let r=this,n=null,o=1,a=null,l="local-floor",h=null,u=null,c=null,f=null,d=null,m=i.getContextAttributes(),p=null,v=null,g=[],_=new Map,x=new Fi;x.layers.enable(1),x.viewport=new Vt;let b=new Fi;b.layers.enable(2),b.viewport=new Vt;let y=[x,b],S=new Ju;S.layers.enable(1),S.layers.enable(2);let w=null,M=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let F=g[D];return F===void 0&&(F=new eh,g[D]=F),F.getTargetRaySpace()},this.getControllerGrip=function(D){let F=g[D];return F===void 0&&(F=new eh,g[D]=F),F.getGripSpace()},this.getHand=function(D){let F=g[D];return F===void 0&&(F=new eh,g[D]=F),F.getHandSpace()};function C(D){let F=_.get(D.inputSource);F&&F.dispatchEvent({type:D.type,data:D.inputSource})}function E(){_.forEach(function(D,F){D.disconnect(F)}),_.clear(),w=null,M=null,e.setRenderTarget(p),f=null,c=null,u=null,n=null,v=null,O.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){o=D,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){l=D,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return c!==null?c:f},this.getBinding=function(){return u},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(D){if(n=D,n!==null){if(p=e.getRenderTarget(),n.addEventListener("select",C),n.addEventListener("selectstart",C),n.addEventListener("selectend",C),n.addEventListener("squeeze",C),n.addEventListener("squeezestart",C),n.addEventListener("squeezeend",C),n.addEventListener("end",E),n.addEventListener("inputsourceschange",P),m.xrCompatible!==!0&&await i.makeXRCompatible(),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let F={antialias:n.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(n,i,F),n.updateRenderState({baseLayer:f}),v=new pr(f.framebufferWidth,f.framebufferHeight,{format:er,type:Rn,encoding:e.outputEncoding})}else{let F=null,B=null,U=null;m.depth&&(U=m.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,F=m.stencil?Ts:$n,B=m.stencil?Ms:to);let G={colorFormat:e.outputEncoding===Qt?i.SRGB8_ALPHA8:i.RGBA8,depthFormat:U,scaleFactor:o};u=new XRWebGLBinding(n,i),c=u.createProjectionLayer(G),n.updateRenderState({layers:[c]}),v=new pr(c.textureWidth,c.textureHeight,{format:er,type:Rn,depthTexture:new $u(c.textureWidth,c.textureHeight,B,void 0,void 0,void 0,void 0,void 0,void 0,F),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});let Y=e.properties.get(v);Y.__ignoreDepthValues=c.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),a=await n.requestReferenceSpace(l),O.setContext(n),O.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function P(D){let F=n.inputSources;for(let B=0;B<g.length;B++)_.set(F[B],g[B]);for(let B=0;B<D.removed.length;B++){let U=D.removed[B],G=_.get(U);G&&(G.dispatchEvent({type:"disconnected",data:U}),_.delete(U))}for(let B=0;B<D.added.length;B++){let U=D.added[B],G=_.get(U);G&&G.dispatchEvent({type:"connected",data:U})}}let A=new j,R=new j;function k(D,F,B){A.setFromMatrixPosition(F.matrixWorld),R.setFromMatrixPosition(B.matrixWorld);let U=A.distanceTo(R),G=F.projectionMatrix.elements,Y=B.projectionMatrix.elements,re=G[14]/(G[10]-1),N=G[14]/(G[10]+1),z=(G[9]+1)/G[5],ie=(G[9]-1)/G[5],Z=(G[8]-1)/G[0],ne=(Y[8]+1)/Y[0],K=re*Z,ae=re*ne,ue=U/(-Z+ne),_e=ue*-Z;F.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(_e),D.translateZ(ue),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert();let Re=re+ue,Le=N+ue,Et=K-_e,it=ae+(U-_e),je=z*N/Le*Re,ut=ie*N/Le*Re;D.projectionMatrix.makePerspective(Et,it,je,ut,Re,Le)}function I(D,F){F===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(F.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(n===null)return;S.near=b.near=x.near=D.near,S.far=b.far=x.far=D.far,(w!==S.near||M!==S.far)&&(n.updateRenderState({depthNear:S.near,depthFar:S.far}),w=S.near,M=S.far);let F=D.parent,B=S.cameras;I(S,F);for(let G=0;G<B.length;G++)I(B[G],F);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),D.position.copy(S.position),D.quaternion.copy(S.quaternion),D.scale.copy(S.scale),D.matrix.copy(S.matrix),D.matrixWorld.copy(S.matrixWorld);let U=D.children;for(let G=0,Y=U.length;G<Y;G++)U[G].updateMatrixWorld(!0);B.length===2?k(S,x,b):S.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(c!==null)return c.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(D){c!==null&&(c.fixedFoveation=D),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=D)};let L=null;function T(D,F){if(h=F.getViewerPose(a),d=F,h!==null){let U=h.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let G=!1;U.length!==S.cameras.length&&(S.cameras.length=0,G=!0);for(let Y=0;Y<U.length;Y++){let re=U[Y],N=null;if(f!==null)N=f.getViewport(re);else{let ie=u.getViewSubImage(c,re);N=ie.viewport,Y===0&&(e.setRenderTargetTextures(v,ie.colorTexture,c.ignoreDepthValues?void 0:ie.depthStencilTexture),e.setRenderTarget(v))}let z=y[Y];z.matrix.fromArray(re.transform.matrix),z.projectionMatrix.fromArray(re.projectionMatrix),z.viewport.set(N.x,N.y,N.width,N.height),Y===0&&S.matrix.copy(z.matrix),G===!0&&S.cameras.push(z)}}let B=n.inputSources;for(let U=0;U<g.length;U++){let G=g[U],Y=B[U];G.update(Y,F,a)}L&&L(D,F),d=null}let O=new wm;O.setAnimationLoop(T),this.setAnimationLoop=function(D){L=D},this.dispose=function(){}}};function hL(t,e){function i(v,g){v.fogColor.value.copy(g.color),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,_,x,b){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(v,g):g.isMeshToonMaterial?(n(v,g),c(v,g)):g.isMeshPhongMaterial?(n(v,g),u(v,g)):g.isMeshStandardMaterial?(n(v,g),f(v,g),g.isMeshPhysicalMaterial&&d(v,g,b)):g.isMeshMatcapMaterial?(n(v,g),m(v,g)):g.isMeshDepthMaterial?n(v,g):g.isMeshDistanceMaterial?(n(v,g),p(v,g)):g.isMeshNormalMaterial?n(v,g):g.isLineBasicMaterial?(o(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?l(v,g,_,x):g.isSpriteMaterial?h(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.bumpMap&&(v.bumpMap.value=g.bumpMap,v.bumpScale.value=g.bumpScale,g.side===Li&&(v.bumpScale.value*=-1)),g.displacementMap&&(v.displacementMap.value=g.displacementMap,v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap),g.normalMap&&(v.normalMap.value=g.normalMap,v.normalScale.value.copy(g.normalScale),g.side===Li&&v.normalScale.value.negate()),g.specularMap&&(v.specularMap.value=g.specularMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let _=e.get(g).envMap;if(_&&(v.envMap.value=_,v.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;let y=t.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*y}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity);let x;g.map?x=g.map:g.specularMap?x=g.specularMap:g.displacementMap?x=g.displacementMap:g.normalMap?x=g.normalMap:g.bumpMap?x=g.bumpMap:g.roughnessMap?x=g.roughnessMap:g.metalnessMap?x=g.metalnessMap:g.alphaMap?x=g.alphaMap:g.emissiveMap?x=g.emissiveMap:g.clearcoatMap?x=g.clearcoatMap:g.clearcoatNormalMap?x=g.clearcoatNormalMap:g.clearcoatRoughnessMap?x=g.clearcoatRoughnessMap:g.specularIntensityMap?x=g.specularIntensityMap:g.specularColorMap?x=g.specularColorMap:g.transmissionMap?x=g.transmissionMap:g.thicknessMap?x=g.thicknessMap:g.sheenColorMap?x=g.sheenColorMap:g.sheenRoughnessMap&&(x=g.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uvTransform.value.copy(x.matrix));let b;g.aoMap?b=g.aoMap:g.lightMap&&(b=g.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),v.uv2Transform.value.copy(b.matrix))}function o(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,_,x){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*_,v.scale.value=x*.5,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let b;g.map?b=g.map:g.alphaMap&&(b=g.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),v.uvTransform.value.copy(b.matrix))}function h(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let _;g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uvTransform.value.copy(_.matrix))}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function c(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function f(v,g){v.roughness.value=g.roughness,v.metalness.value=g.metalness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function d(v,g,_){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),v.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Li&&v.clearcoatNormalScale.value.negate())),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=_.texture,v.transmissionSamplerSize.value.set(_.width,_.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap)}function m(v,g){g.matcap&&(v.matcap.value=g.matcap)}function p(v,g){v.referencePosition.value.copy(g.referencePosition),v.nearDistance.value=g.nearDistance,v.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}var Zo=class extends ii{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),i}};Zo.prototype.isScene=!0;var Rr=class extends vt{constructor(e,i,r,n=1){typeof r=="number"&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,i,r),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};Rr.prototype.isInstancedBufferAttribute=!0;var Mi=class extends gr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ye(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}};Mi.prototype.isLineBasicMaterial=!0;var uL=new j,cL=new j,fL=new dt,hx=new jo,zm=new Xr,Ko=class extends ii{constructor(e=new pt,i=new Mi){super(),this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let i=e.attributes.position,r=[0];for(let n=1,o=i.count;n<o;n++)uL.fromBufferAttribute(i,n-1),cL.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=uL.distanceTo(cL);e.setAttribute("lineDistance",new kt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,i){let r=this.geometry,n=this.matrixWorld,o=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),zm.copy(r.boundingSphere),zm.applyMatrix4(n),zm.radius+=o,e.ray.intersectsSphere(zm)===!1)return;fL.copy(n).invert(),hx.copy(e.ray).applyMatrix4(fL);let l=o/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=new j,c=new j,f=new j,d=new j,m=this.isLineSegments?2:1;if(r.isBufferGeometry){let p=r.index,g=r.attributes.position;if(p!==null){let _=Math.max(0,a.start),x=Math.min(p.count,a.start+a.count);for(let b=_,y=x-1;b<y;b+=m){let S=p.getX(b),w=p.getX(b+1);if(u.fromBufferAttribute(g,S),c.fromBufferAttribute(g,w),hx.distanceSqToSegment(u,c,d,f)>h)continue;d.applyMatrix4(this.matrixWorld);let C=e.ray.origin.distanceTo(d);C<e.near||C>e.far||i.push({distance:C,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let _=Math.max(0,a.start),x=Math.min(g.count,a.start+a.count);for(let b=_,y=x-1;b<y;b+=m){if(u.fromBufferAttribute(g,b),c.fromBufferAttribute(g,b+1),hx.distanceSqToSegment(u,c,d,f)>h)continue;d.applyMatrix4(this.matrixWorld);let w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||i.push({distance:w,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let i=e.morphAttributes,r=Object.keys(i);if(r.length>0){let n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=n.length;o<a;o++){let l=n[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=o}}}}else{let i=e.morphTargets;i!==void 0&&i.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Ko.prototype.isLine=!0;var dL=new j,pL=new j,Zr=class extends Ko{constructor(e,i){super(e,i),this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let i=e.attributes.position,r=[];for(let n=0,o=i.count;n<o;n+=2)dL.fromBufferAttribute(i,n),pL.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+dL.distanceTo(pL);e.setAttribute("lineDistance",new kt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};Zr.prototype.isLineSegments=!0;var ec=class t extends pt{constructor(e=1,i=8,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);let o=[],a=[],l=[],h=[],u=new j,c=new $e;a.push(0,0,0),l.push(0,0,1),h.push(.5,.5);for(let f=0,d=3;f<=i;f++,d+=3){let m=r+f/i*n;u.x=e*Math.cos(m),u.y=e*Math.sin(m),a.push(u.x,u.y,u.z),l.push(0,0,1),c.x=(a[d]/e+1)/2,c.y=(a[d+1]/e+1)/2,h.push(c.x,c.y)}for(let f=1;f<=i;f++)o.push(f,f+1,0);this.setIndex(o),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(h,2))}static fromJSON(e){return new t(e.radius,e.segments,e.thetaStart,e.thetaLength)}};var ir=class extends gr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ye(16777215),this.specular=new Ye(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dl,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};ir.prototype.isMeshPhongMaterial=!0;var ux={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};var cx=class{constructor(e,i,r){let n=this,o=!1,a=0,l=0,h,u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(c){l++,o===!1&&n.onStart!==void 0&&n.onStart(c,a,l),o=!0},this.itemEnd=function(c){a++,n.onProgress!==void 0&&n.onProgress(c,a,l),a===l&&(o=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(c){n.onError!==void 0&&n.onError(c)},this.resolveURL=function(c){return h?h(c):c},this.setURLModifier=function(c){return h=c,this},this.addHandler=function(c,f){return u.push(c,f),this},this.removeHandler=function(c){let f=u.indexOf(c);return f!==-1&&u.splice(f,2),this},this.getHandler=function(c){for(let f=0,d=u.length;f<d;f+=2){let m=u[f],p=u[f+1];if(m.global&&(m.lastIndex=0),m.test(c))return p}return null}}},Gm=new cx;var Hm=class{constructor(e){this.manager=e!==void 0?e:Gm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let r=this;return new Promise(function(n,o){r.load(e,n,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};var fo={},Va=class extends Hm{constructor(e){super(e)}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let o=ux.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(fo[e]!==void 0){fo[e].push({onLoad:i,onProgress:r,onError:n});return}fo[e]=[],fo[e].push({onLoad:i,onProgress:r,onError:n});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,h=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||u.body===void 0||u.body.getReader===void 0)return u;let c=fo[e],f=u.body.getReader(),d=u.headers.get("Content-Length"),m=d?parseInt(d):0,p=m!==0,v=0,g=new ReadableStream({start(_){x();function x(){f.read().then(({done:b,value:y})=>{if(b)_.close();else{v+=y.byteLength;let S=new ProgressEvent("progress",{lengthComputable:p,loaded:v,total:m});for(let w=0,M=c.length;w<M;w++){let C=c[w];C.onProgress&&C.onProgress(S)}_.enqueue(y),x()}})}}});return new Response(g)}else throw Error(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`)}).then(u=>{switch(h){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(c=>new DOMParser().parseFromString(c,l));case"json":return u.json();default:if(l===void 0)return u.text();{let f=/charset="?([^;"\s]*)"?/i.exec(l),d=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(d);return u.arrayBuffer().then(p=>m.decode(p))}}}).then(u=>{ux.add(e,u);let c=fo[e];delete fo[e];for(let f=0,d=c.length;f<d;f++){let m=c[f];m.onLoad&&m.onLoad(u)}}).catch(u=>{let c=fo[e];if(c===void 0)throw this.manager.itemError(e),u;delete fo[e];for(let f=0,d=c.length;f<d;f++){let m=c[f];m.onError&&m.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var ja=class extends ii{constructor(e,i=1){super(),this.type="Light",this.color=new Ye(e),this.intensity=i}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}};ja.prototype.isLight=!0;var mL=new dt,gL=new j,vL=new j,Wm=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $e(512,512),this.map=null,this.mapPass=null,this.matrix=new dt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Go,this._frameExtents=new $e(1,1),this._viewportCount=1,this._viewports=[new Vt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,r=this.matrix;gL.setFromMatrixPosition(e.matrixWorld),i.position.copy(gL),vL.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(vL),i.updateMatrixWorld(),mL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mL),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(i.projectionMatrix),r.multiply(i.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}};var tc=class extends Wm{constructor(){super(new co(-5,5,5,-5,.5,500))}};tc.prototype.isDirectionalLightShadow=!0;var th=class extends ja{constructor(e,i){super(e,i),this.type="DirectionalLight",this.position.copy(ii.DefaultUp),this.updateMatrix(),this.target=new ii,this.shadow=new tc}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};th.prototype.isDirectionalLight=!0;var ic=class extends ja{constructor(e,i){super(e,i),this.type="AmbientLight"}};ic.prototype.isAmbientLight=!0;var qa=class extends pt{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};qa.prototype.isInstancedBufferGeometry=!0;var rc=class t{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new t(this.value.clone===void 0?this.value:this.value.clone())}};var Vm=class{constructor(e,i,r=0,n=1/0){this.ray=new jo(e,i),this.near=r,this.far=n,this.camera=null,this.layers=new Wo,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(e,i=!0,r=[]){return fx(e,this,r,i),r.sort(_L),r}intersectObjects(e,i=!0,r=[]){for(let n=0,o=e.length;n<o;n++)fx(e[n],this,r,i);return r.sort(_L),r}};function _L(t,e){return t.distance-e.distance}function fx(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let n=t.children;for(let o=0,a=n.length;o<a;o++)fx(n[o],e,i,!0)}}var nc=class{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(qi(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var yL=new j,jm=new j,xL=new j,sc=class extends ii{constructor(e,i,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,i===void 0&&(i=1);let n=new pt;n.setAttribute("position",new kt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));let o=new Mi({fog:!1,toneMapped:!1});this.lightPlane=new Ko(n,o),this.add(this.lightPlane),n=new pt,n.setAttribute("position",new kt([0,0,0,0,0,1],3)),this.targetLine=new Ko(n,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){yL.setFromMatrixPosition(this.light.matrixWorld),jm.setFromMatrixPosition(this.light.target.matrixWorld),xL.subVectors(jm,yL),this.lightPlane.lookAt(jm),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(jm),this.targetLine.scale.z=xL.length()}};var qm=new j,bi=new uo,oc=class extends Zr{constructor(e){let i=new pt,r=new Mi({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],o=[],a={},l=new Ye(16755200),h=new Ye(16711680),u=new Ye(43775),c=new Ye(16777215),f=new Ye(3355443);d("n1","n2",l),d("n2","n4",l),d("n4","n3",l),d("n3","n1",l),d("f1","f2",l),d("f2","f4",l),d("f4","f3",l),d("f3","f1",l),d("n1","f1",l),d("n2","f2",l),d("n3","f3",l),d("n4","f4",l),d("p","n1",h),d("p","n2",h),d("p","n3",h),d("p","n4",h),d("u1","u2",u),d("u2","u3",u),d("u3","u1",u),d("c","t",c),d("p","c",f),d("cn1","cn2",f),d("cn3","cn4",f),d("cf1","cf2",f),d("cf3","cf4",f);function d(p,v,g){m(p,g),m(v,g)}function m(p,v){n.push(0,0,0),o.push(v.r,v.g,v.b),a[p]===void 0&&(a[p]=[]),a[p].push(n.length/3-1)}i.setAttribute("position",new kt(n,3)),i.setAttribute("color",new kt(o,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){let e=this.geometry,i=this.pointMap,r=1,n=1;bi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ti("c",i,e,bi,0,0,-1),Ti("t",i,e,bi,0,0,1),Ti("n1",i,e,bi,-r,-n,-1),Ti("n2",i,e,bi,r,-n,-1),Ti("n3",i,e,bi,-r,n,-1),Ti("n4",i,e,bi,r,n,-1),Ti("f1",i,e,bi,-r,-n,1),Ti("f2",i,e,bi,r,-n,1),Ti("f3",i,e,bi,-r,n,1),Ti("f4",i,e,bi,r,n,1),Ti("u1",i,e,bi,r*.7,n*1.1,-1),Ti("u2",i,e,bi,-r*.7,n*1.1,-1),Ti("u3",i,e,bi,0,n*2,-1),Ti("cf1",i,e,bi,-r,0,1),Ti("cf2",i,e,bi,r,0,1),Ti("cf3",i,e,bi,0,-n,1),Ti("cf4",i,e,bi,0,n,1),Ti("cn1",i,e,bi,-r,0,-1),Ti("cn2",i,e,bi,r,0,-1),Ti("cn3",i,e,bi,0,-n,-1),Ti("cn4",i,e,bi,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ti(t,e,i,r,n,o,a){qm.set(n,o,a).unproject(r);let l=e[t];if(l!==void 0){let h=i.getAttribute("position");for(let u=0,c=l.length;u<c;u++)h.setXYZ(l[u],qm.x,qm.y,qm.z)}}function dx(t){this.manager=t!==void 0?t:THREE.DefaultLoadingManager}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Lu}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Lu);dx.prototype={constructor:dx,load:function(t,e,i,r){let n=this,o=new Va(n.manager);o.setResponseType("arraybuffer"),o.load(t,function(a){e(n.parse(a))},i,r)},parse:function(t){function e(l){let h,u,c,f;if(f=new DataView(l),u=32/8*3+32/8*3*3+16/8,c=f.getUint32(80,!0),h=80+32/8+c*u,h===f.byteLength)return!0;let d=[115,111,108,105,100];for(let m=0;m<5;m++)if(d[m]!==f.getUint8(m))return!0;return!1}function i(l){let h=new DataView(l),u=h.getUint32(80,!0),c,f,d,m=!1,p,v,g,_,x;for(let C=0;C<70;C++)h.getUint32(C,!1)===1129270351&&h.getUint8(C+4)===82&&h.getUint8(C+5)===61&&(m=!0,p=[],v=h.getUint8(C+6)/255,g=h.getUint8(C+7)/255,_=h.getUint8(C+8)/255,x=h.getUint8(C+9)/255);let b=84,y=12*4+2,S=new pt,w=[],M=[];for(let C=0;C<u;C++){let E=b+C*y,P=h.getFloat32(E,!0),A=h.getFloat32(E+4,!0),R=h.getFloat32(E+8,!0);if(m){let k=h.getUint16(E+48,!0);k&32768?(c=v,f=g,d=_):(c=(k&31)/31,f=(k>>5&31)/31,d=(k>>10&31)/31)}for(let k=1;k<=3;k++){let I=E+k*12;w.push(h.getFloat32(I,!0)),w.push(h.getFloat32(I+4,!0)),w.push(h.getFloat32(I+8,!0)),M.push(P,A,R),m&&p.push(c,f,d)}}return S.setAttribute("position",new vt(new Float32Array(w),3)),S.setAttribute("normal",new vt(new Float32Array(M),3)),m&&(S.setAttribute("color",new vt(new Float32Array(p),3)),S.hasColors=!0,S.alpha=x),S}function r(l){let h=new pt,u=/facet([\s\S]*?)endfacet/g,c=0,f=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,d=new RegExp("vertex"+f+f+f,"g"),m=new RegExp("normal"+f+f+f,"g"),p=[],v=[],g=new j,_;for(;(_=u.exec(l))!==null;){let x=0,b=0,y=_[0];for(;(_=m.exec(y))!==null;)g.x=parseFloat(_[1]),g.y=parseFloat(_[2]),g.z=parseFloat(_[3]),b++;for(;(_=d.exec(y))!==null;)p.push(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])),v.push(g.x,g.y,g.z),x++;b!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+c),x!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+c),c++}return h.setAttribute("position",new kt(p,3)),h.setAttribute("normal",new kt(v,3)),h}function n(l){if(typeof l!="string"){let h=new Uint8Array(l);if(window.TextDecoder!==void 0)return new TextDecoder().decode(h);let u="",c=0,f=l.byteLength;for(;c<f;c++)u+=String.fromCharCode(h[c]);return u}else return l}function o(l){if(typeof l=="string"){let h=new Uint8Array(l.length);for(let u=0;u<l.length;u++)h[u]=l.charCodeAt(u)&255;return h.buffer||h}else return l}let a=o(t);return e(a)?i(a):r(n(t))}};var ih=function(t){this.manager=t!==void 0?t:Gm},bL=1;ih.prototype={constructor:ih,load:function(t,e,i,r){let n=this,o=new Va(n.manager);o.setResponseType("arraybuffer");let a="RMFLoad"+bL;bL++,o.load(t,function(l){e(n.parse(l,a))},i,r)},parse:function(t,e){let i=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295];function r(g){let _;if(g.bitsLeft>=g.bits)return _=(g.bitBuffer>>g.bitsLeft-g.bits&i[g.bits])>>>0,g.bitsLeft-=g.bits,_;let x=g.bits-g.bitsLeft;return _=(g.bitBuffer&i[g.bitsLeft])<<x,g.bitBuffer=g.reader.getUint32(g.pos,!0),g.pos+=4,g.bitsLeft=32-x,_=(_|g.bitBuffer>>g.bitsLeft&i[x])>>>0,_}let n=new DataView(t),o=new pt,a=8,l;if(n.getUint8(0)!==64||n.getUint8(1)!==114||n.getUint8(2)!==109||n.getUint8(3)!==102)return console.error("wrong format ",n.getUint8(0),n.getUint8(1),n.getUint8(2),n.getUint8(3)),null;let h=n.getUint32(4,!0),u,c,f=new TextDecoder("utf-8"),d={},m=[];function p(){let g=l;for(;n.getUint8(l);)l++;let _=l-g;l++;let x=new Uint8Array(_);for(let b=0;b<_;b++)x[b]=n.getUint8(g+b);return f.decode(x)}function v(){c!==void 0&&(o.setIndex(new vt(c,1)),o.setAttribute("position",new vt(u,3)),o.computeVertexNormals(),o.computeBoundingSphere(),m.push({geometry:o,params:d}),d={},o=new pt)}for(;a<n.byteLength;){let g=n.getUint32(a,!0),_=n.getUint32(a+4,!0);switch(a+=8,g){case 2:v(),l=a;let x=n.getUint32(l,!0);l+=4;for(let b=0;b<x;b++){let y=p();d[y]=p()}a+=_;break;case 3:{let b=_/4;u=new Float32Array(b);for(let y=0;y<b;y++)u[y]=n.getFloat32(a+y*4,!0);a+=_}break;case 4:{l=a;let b=n.getUint32(l,!0),y=n.getUint32(l+4,!0);l+=8,y*3<65535?c=new Uint16Array(y*3):c=new Uint32Array(y*3);let S={reader:n,pos:l,bitBuffer:0,bitsLeft:0,bits:b};for(let w=0;w<y*3;w++)c[w]=r(S)}a+=_;break;case 1718448704:h=_,_=8;break;default:a+=_}if(_===0)break}return v(),m}};var Bt={};(function(){let t={type:"change"},e={type:"start"},i={type:"end"};class r extends dr{constructor(a,l){super(),l===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),l===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=a,this.domElement=l,this.domElement.style.touchAction="none",this.requireShiftZoom=!1,this.enabled=!0,this.target=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Js.ROTATE,MIDDLE:Js.DOLLY,RIGHT:Js.PAN},this.touches={ONE:$s.ROTATE,TWO:$s.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.setPhiTheta=function(H,pe){d.phi=H,d.theta=pe;let we=new j,Ue=h.object.position,Ze=new mr().setFromUnitVectors(a.up,new j(0,1,0)).clone().invert();we.copy(Ue).sub(h.target),d.radius*=p,d.radius=Math.max(h.minDistance,Math.min(h.maxDistance,d.radius)),we.setFromSpherical(d),we.applyQuaternion(Ze),Ue.copy(h.target).add(we),h.object.lookAt(h.target),m.set(0,0,0),v.set(0,0,0),p=1},this.fromPhiTheta=function(H){let we=new mr().setFromUnitVectors(a.up,new j(0,1,0)).clone().invert(),Ue=new j,Ie=this.object.position;d.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,d.theta)),d.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d.phi)),d.phi=Math.max(f,Math.min(Math.PI-f,d.phi));let Ze=Ue.length();H&&(Ze=H),Ze=Math.max(this.minDistance,Math.min(this.maxDistance,Ze)),Ue.x=Ze*Math.sin(d.phi)*Math.sin(d.theta),Ue.y=Ze*Math.cos(d.phi),Ue.z=Ze*Math.sin(d.phi)*Math.cos(d.theta),Ue.applyQuaternion(we),Ie.copy(this.target).add(Ue),this.object.lookAt(this.target),p=1,v.set(0,0,0),h.object.updateProjectionMatrix()},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(H){H.addEventListener("keydown",Ce),this._domElementKeyEvents=H},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(t),h.update(),c=u.NONE},this.update=function(){let H=new j,pe=new mr().setFromUnitVectors(a.up,new j(0,1,0)),we=pe.clone().invert(),Ue=new j,Ie=new mr,Ze=2*Math.PI;return function(){let ft=h.object.position;H.copy(ft).sub(h.target),H.applyQuaternion(pe),d.setFromVector3(H),h.autoRotate&&c===u.NONE&&I(R()),h.enableDamping?(d.theta+=m.theta*h.dampingFactor,d.phi+=m.phi*h.dampingFactor):(d.theta+=m.theta,d.phi+=m.phi);let Ot=h.minAzimuthAngle,Ct=h.maxAzimuthAngle;return isFinite(Ot)&&isFinite(Ct)&&(Ot<-Math.PI?Ot+=Ze:Ot>Math.PI&&(Ot-=Ze),Ct<-Math.PI?Ct+=Ze:Ct>Math.PI&&(Ct-=Ze),Ot<=Ct?d.theta=Math.max(Ot,Math.min(Ct,d.theta)):d.theta=d.theta>(Ot+Ct)/2?Math.max(Ot,d.theta):Math.min(Ct,d.theta)),d.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=p,d.radius=Math.max(h.minDistance,Math.min(h.maxDistance,d.radius)),h.enableDamping===!0?h.target.addScaledVector(v,h.dampingFactor):h.target.add(v),H.setFromSpherical(d),H.applyQuaternion(we),ft.copy(h.target).add(H),h.object.lookAt(h.target),h.enableDamping===!0?(m.theta*=1-h.dampingFactor,m.phi*=1-h.dampingFactor,v.multiplyScalar(1-h.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),p=1,g||Ue.distanceToSquared(h.object.position)>f||8*(1-Ie.dot(h.object.quaternion))>f?(h.dispatchEvent(t),Ue.copy(h.object.position),Ie.copy(h.object.quaternion),g=!1,!0):!1}}(),this.dispose=function(){h.domElement.removeEventListener("contextmenu",Qe),h.domElement.removeEventListener("pointerdown",ut),h.domElement.removeEventListener("pointercancel",X),h.domElement.removeEventListener("wheel",this.onMouseWheel),h.domElement.removeEventListener("pointermove",jt),h.domElement.removeEventListener("pointerup",Wt),h._domElementKeyEvents!==null&&h._domElementKeyEvents.removeEventListener("keydown",Ce)};let h=this,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=u.NONE,f=1e-6,d=new nc,m=new nc,p=1,v=new j,g=!1,_=new $e,x=new $e,b=new $e,y=new $e,S=new $e,w=new $e,M=new $e,C=new $e,E=new $e,P=[],A={};function R(){return 2*Math.PI/60/60*h.autoRotateSpeed}function k(){return Math.pow(.95,h.zoomSpeed)}function I(H){m.theta-=H}this.rotateLeft=H=>{I(H)};function L(H){m.phi-=H}let T=function(){let H=new j;return function(we,Ue){H.setFromMatrixColumn(Ue,0),H.multiplyScalar(-we),v.add(H)}}(),O=function(){let H=new j;return function(we,Ue){h.screenSpacePanning===!0?H.setFromMatrixColumn(Ue,1):(H.setFromMatrixColumn(Ue,0),H.crossVectors(h.object.up,H)),H.multiplyScalar(we),v.add(H)}}(),D=function(){let H=new j;return function(we,Ue){let Ie=h.domElement;if(h.object.isPerspectiveCamera){let Ze=h.object.position;H.copy(Ze).sub(h.target);let Ee=H.length();Ee*=Math.tan(h.object.fov/2*Math.PI/180),T(2*we*Ee/Ie.clientHeight,h.object.matrix),O(2*Ue*Ee/Ie.clientHeight,h.object.matrix)}else h.object.isOrthographicCamera?(T(we*(h.object.right-h.object.left)/h.object.zoom/Ie.clientWidth,h.object.matrix),O(Ue*(h.object.top-h.object.bottom)/h.object.zoom/Ie.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)}}();function F(H){h.object.isPerspectiveCamera?p/=H:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*H)),h.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function B(H){h.object.isPerspectiveCamera?p*=H:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/H)),h.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function U(H){_.set(H.clientX,H.clientY)}function G(H){M.set(H.clientX,H.clientY)}function Y(H){y.set(H.clientX,H.clientY)}function re(H){x.set(H.clientX,H.clientY),b.subVectors(x,_).multiplyScalar(h.rotateSpeed);let pe=h.domElement;I(2*Math.PI*b.x/pe.clientHeight),L(2*Math.PI*b.y/pe.clientHeight),_.copy(x),h.update()}function N(H){C.set(H.clientX,H.clientY),E.subVectors(C,M),E.y>0?F(k()):E.y<0&&B(k()),M.copy(C),h.update()}function z(H){S.set(H.clientX,H.clientY),w.subVectors(S,y).multiplyScalar(h.panSpeed),D(w.x,w.y),y.copy(S),h.update()}function ie(H){H.deltaY<0?B(k()):H.deltaY>0&&F(k()),h.update()}function Z(H){let pe=!1;switch(H.code){case h.keys.UP:D(0,h.keyPanSpeed),pe=!0;break;case h.keys.BOTTOM:D(0,-h.keyPanSpeed),pe=!0;break;case h.keys.LEFT:D(h.keyPanSpeed,0),pe=!0;break;case h.keys.RIGHT:D(-h.keyPanSpeed,0),pe=!0;break}pe&&(H.preventDefault(),h.update())}function ne(){if(P.length===1)_.set(P[0].pageX,P[0].pageY);else{let H=.5*(P[0].pageX+P[1].pageX),pe=.5*(P[0].pageY+P[1].pageY);_.set(H,pe)}}function K(){if(P.length===1)y.set(P[0].pageX,P[0].pageY);else{let H=.5*(P[0].pageX+P[1].pageX),pe=.5*(P[0].pageY+P[1].pageY);y.set(H,pe)}}function ae(){let H=P[0].pageX-P[1].pageX,pe=P[0].pageY-P[1].pageY,we=Math.sqrt(H*H+pe*pe);M.set(0,we)}function ue(){h.enableZoom&&ae(),h.enablePan&&K()}function _e(){h.enableZoom&&ae(),h.enableRotate&&ne()}function Re(H){if(P.length===1)x.set(H.pageX,H.pageY);else{let we=We(H),Ue=.5*(H.pageX+we.x),Ie=.5*(H.pageY+we.y);x.set(Ue,Ie)}b.subVectors(x,_).multiplyScalar(h.rotateSpeed);let pe=h.domElement;I(2*Math.PI*b.x/pe.clientHeight),L(2*Math.PI*b.y/pe.clientHeight),_.copy(x)}function Le(H){if(P.length===1)S.set(H.pageX,H.pageY);else{let pe=We(H),we=.5*(H.pageX+pe.x),Ue=.5*(H.pageY+pe.y);S.set(we,Ue)}w.subVectors(S,y).multiplyScalar(h.panSpeed),D(w.x,w.y),y.copy(S)}function Et(H){let pe=We(H),we=H.pageX-pe.x,Ue=H.pageY-pe.y,Ie=Math.sqrt(we*we+Ue*Ue);C.set(0,Ie),E.set(0,Math.pow(C.y/M.y,h.zoomSpeed)),F(E.y),M.copy(C)}function it(H){h.enableZoom&&Et(H),h.enablePan&&Le(H)}function je(H){h.enableZoom&&Et(H),h.enableRotate&&Re(H)}function ut(H){h.enabled!==!1&&(P.length===0&&(h.domElement.setPointerCapture(H.pointerId),h.domElement.addEventListener("pointermove",jt),h.domElement.addEventListener("pointerup",Wt)),de(H),H.pointerType==="touch"?De(H):V(H))}function jt(H){h.enabled!==!1&&(H.pointerType==="touch"?He(H):me(H))}function Wt(H){Ge(H),P.length===0&&(h.domElement.releasePointerCapture(H.pointerId),h.domElement.removeEventListener("pointermove",jt),h.domElement.removeEventListener("pointerup",Wt)),h.dispatchEvent(i),c=u.NONE}function X(H){Ge(H)}function V(H){let pe;switch(H.button){case 0:pe=h.mouseButtons.LEFT;break;case 1:pe=h.mouseButtons.MIDDLE;break;case 2:pe=h.mouseButtons.RIGHT;break;default:pe=-1}switch(pe){case Js.DOLLY:if(h.enableZoom===!1)return;G(H),c=u.DOLLY;break;case Js.ROTATE:if(H.ctrlKey||H.metaKey||H.shiftKey){if(h.enablePan===!1)return;Y(H),c=u.PAN}else{if(h.enableRotate===!1)return;U(H),c=u.ROTATE}break;case Js.PAN:if(H.ctrlKey||H.metaKey||H.shiftKey){if(h.enableRotate===!1)return;U(H),c=u.ROTATE}else{if(h.enablePan===!1)return;Y(H),c=u.PAN}break;default:c=u.NONE}c!==u.NONE&&h.dispatchEvent(e)}function me(H){if(h.enabled!==!1)switch(c){case u.ROTATE:if(h.enableRotate===!1)return;re(H);break;case u.DOLLY:if(h.enableZoom===!1)return;N(H);break;case u.PAN:if(h.enablePan===!1)return;z(H);break}}this.onMouseWheel=H=>{h.enabled===!1||h.enableZoom===!1||c!==u.NONE||!H.shiftKey&&this.requireShiftZoom||(H.preventDefault(),h.dispatchEvent(e),ie(H),h.dispatchEvent(i))};function Ce(H){h.enabled===!1||h.enablePan===!1||Z(H)}function De(H){switch(gt(H),P.length){case 1:switch(h.touches.ONE){case $s.ROTATE:if(h.enableRotate===!1)return;ne(),c=u.TOUCH_ROTATE;break;case $s.PAN:if(h.enablePan===!1)return;K(),c=u.TOUCH_PAN;break;default:c=u.NONE}break;case 2:switch(h.touches.TWO){case $s.DOLLY_PAN:if(h.enableZoom===!1&&h.enablePan===!1)return;ue(),c=u.TOUCH_DOLLY_PAN;break;case $s.DOLLY_ROTATE:if(h.enableZoom===!1&&h.enableRotate===!1)return;_e(),c=u.TOUCH_DOLLY_ROTATE;break;default:c=u.NONE}break;default:c=u.NONE}c!==u.NONE&&h.dispatchEvent(e)}function He(H){switch(gt(H),c){case u.TOUCH_ROTATE:if(h.enableRotate===!1)return;Re(H),h.update();break;case u.TOUCH_PAN:if(h.enablePan===!1)return;Le(H),h.update();break;case u.TOUCH_DOLLY_PAN:if(h.enableZoom===!1&&h.enablePan===!1)return;it(H),h.update();break;case u.TOUCH_DOLLY_ROTATE:if(h.enableZoom===!1&&h.enableRotate===!1)return;je(H),h.update();break;default:c=u.NONE}}function Qe(H){h.enabled!==!1&&H.preventDefault()}function de(H){P.push(H)}function Ge(H){delete A[H.pointerId];for(let pe=0;pe<P.length;pe++)if(P[pe].pointerId==H.pointerId){P.splice(pe,1);return}}function gt(H){let pe=A[H.pointerId];pe===void 0&&(pe=new $e,A[H.pointerId]=pe),pe.set(H.pageX,H.pageY)}function We(H){let pe=H.pointerId===P[0].pointerId?P[1]:P[0];return A[pe.pointerId]}h.domElement.addEventListener("contextmenu",Qe),h.domElement.addEventListener("pointerdown",ut),h.domElement.addEventListener("pointercancel",X),h.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.update()}}class n extends r{constructor(a,l){super(a,l),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Js.PAN,this.mouseButtons.RIGHT=Js.ROTATE,this.touches.ONE=$s.PAN,this.touches.TWO=$s.DOLLY_ROTATE}}Bt.MapControls=n,Bt.OrbitControls=r})();window.RSUtils={};RSUtils.createAlphaID=function(t){let e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<t;r++)e+=i.charAt(Math.floor(Math.random()*i.length));return e};Array.prototype.sortOn=function(t){this.sort(function(e,i){return e[t]<i[t]?-1:e[t]>i[t]?1:0})};String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e});function B6(){let t=!1;if("maxTouchPoints"in navigator)t=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)t=navigator.msMaxTouchPoints>0;else{let e=window.matchMedia&&matchMedia("(pointer:coarse)");if(e&&e.media==="(pointer:coarse)")t=!!e.matches;else if("orientation"in window)t=!0;else{let i=navigator.userAgent;t=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(i)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(i)}}return t}var Ls=B6();window.RSBase=angular.module("RSBase",["ui.router","ngSanitize"]).provider("RSRegistry",[function(){let t=[],e=[];return{registerGlobalSettingsDialog:function(i,r,n,o,a){t.push({name:i,state:r,icon:n,feature:o,uiFeature:a!=null?a:"configure"})},$get:function(){return{globalSettingsDialogs:t,userSettingsDialogs:e}}}}]).config(["$stateProvider","$qProvider","$httpProvider",function(t,e,i){e.errorOnUnhandledRejections(!1),i.defaults.xsrfCookieName="Csrf-Token",i.defaults.xsrfHeaderName="X-Csrf-Token",i.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var r=function(n){var o="",a,l,h,u,c,f,d;for(a in n)if(l=n[a],l instanceof Array)for(d=0;d<l.length;++d)c=l[d],h=a+"["+d+"]",f={},f[h]=c,o+=r(f)+"&";else if(l instanceof Object)for(u in l)c=l[u],h=a+"["+u+"]",f={},f[h]=c,o+=r(f)+"&";else l!=null&&(o+=encodeURIComponent(a)+"="+encodeURIComponent(l)+"&");return o.length?o.substr(0,o.length-1):o};i.defaults.transformRequest=[function(n){return angular.isObject(n)&&String(n)!=="[object File]"?r(n):n}]}]);function wL(){$(".equalheight").each(function(){let t=0;$(this).children().each(function(){$(this).height()>t&&(t=$(this).height())}),$(this).children().height(t)})}$(window).on("load",wL);$(window).on("resize",wL);var px=null;function SL(t,e){return px||(px=e.get("/manual/index.html")),new Promise((i,r)=>{px.then(n=>{i(n.data.substring(n.data.indexOf("<!-- MARKSTART:"+t+" -->")+("<!-- MARKSTART:"+t+" -->").length,n.data.indexOf("<!-- MARKEND:"+t+" -->")))},n=>{r(n)})})}function N6(t){return t.replace(/[\-\[\]\/{}()*+?.^$|]/g,"\\$&")}function ac(t,e,i){return i.replace(new RegExp(N6(t),"g"),e)}var U6=/^-?\d+$/;RSBase.factory("Fullscreen",["$rootScope",function(t){let e={};t.isFullscreen=!1,e.supportsFullscreen=function(){let r=window.document.body;return!!(r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullscreen||r.msRequestFullscreen)},t.supportsFullscreen=e.supportsFullscreen(),e.launchFullscreen=function(r){r.requestFullscreen?(r.requestFullscreen(),t.isFullscreen=!0):r.mozRequestFullScreen?(r.mozRequestFullScreen(),t.isFullscreen=!0):r.webkitRequestFullscreen?(r.webkitRequestFullscreen(),t.isFullscreen=!0):r.msRequestFullscreen&&(r.msRequestFullscreen(),t.isFullscreen=!0)},e.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),t.isFullscreen=!1},e.toggleFullscreen=function(r){t.isFullscreen?e.exitFullscreen():e.launchFullscreen(r)};let i=function(){t.isFullscreen=!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement),t.$broadcast("fullscreenChanged"),t.$digest()};return document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),e}]);RSBase.directive("onFileChange",function(){return{restrict:"A",link:function(t,e,i){let r=t.$eval(i.onFileChange);e.on("change",r),e.on("$destroy",function(){e.off()})}}});RSBase.directive("switch",["$timeout",function(t){return{restrict:"E",scope:{changed:"&"},template:'<input type="checkbox" data-size="small">',replace:!0,require:"ngModel",link:function(e,i,r,n){n.$parsers=[],n.$formatters=[];let o=r.on||"<?php _('On') ?>",a=r.off||"<?php _('Off') ?>";n.$formatters.push(function(l){return typeof l!="undefined"&&t(function(){i.bootstrapSwitch("state",!!l)}),l}),e.$on("$destroy",function(){i.bootstrapSwitch("destroy")}),i.on("switchChange.bootstrapSwitch",function(l,h){h=h?1:0,e.$apply(function(){n.$setViewValue(h)}),e.changed&&e.changed({value:h})}),t(function(){i.bootstrapSwitch("state",!!n.$modelValue)}),i.bootstrapSwitch({onText:o,offText:a}),n.$validators.color=function(){return!0}}}}]).directive("ngTouchstart",function(){return{controller:["$scope","$element",function(t,e){e.bind("touchstart",i);function i(r){let n=e.attr("ng-touchstart");t.$event=r,t.$apply(n)}}]}}).directive("boolswitch",["$timeout",function(t){return{restrict:"E",scope:{changed:"&"},template:'<input type="checkbox" data-size="small">',replace:!0,require:"ngModel",link:function(e,i,r,n){let o=r.on||"<?php _('On') ?>",a=r.off||"<?php _('Off') ?>",l=!1;n.$formatters.push(function(h){typeof h!="undefined"&&t(function(){h==="false"&&(h=!1),h==="true"&&(h=!0),i.bootstrapSwitch("state",h||!1,!0)})}),i.on("switchChange.bootstrapSwitch",function(h,u){e.$apply(function(){n.$setViewValue(u)}),!l&&e.changed&&e.changed({value:u})}),t(function(){l=!0,i.bootstrapSwitch("state",n.$modelValue||!1),l=!1}),i.bootstrapSwitch({onText:o,offText:a}),e.$on("$destroy",function(){i.bootstrapSwitch("destroy")})}}}]).directive("tempChart",[function(){return{restrict:"E",template:'<div class="flot-chart"><div class="flot-chart-content"></div></div>',replace:!0,scope:{history:"=",showTempSet:"=",unit:"="},link:function(t,e,i){let r=[],n=[],o=[],a=e.children(0),l=[{data:r,label:"<?php _('Output') ?>",yaxis:2,color:"#3E714A",lines:{fill:!0,fillColor:"rgba(108,240,139,0.2)",lineWidth:1}},{data:n,label:"<?php _('Temperature') ?>",color:"#2D7495",lines:{lineWidth:5}}];t.showTempSet!==!1&&l.push({data:o,label:"<?php _('Target Temperature') ?>",color:"#A541B4",lines:{lineWidth:1}});let h={xaxes:[{mode:"time",timeFormat:"%M:%S",timezone:"browser"}],yaxes:[{min:0,max:250,alignTicksWithAxis:1,position:"left",tickFormatter:c,family:"sans-serif",size:8},{alignTicksWithAxis:null,position:"right",min:0,max:100,tickFormatter:f}],legend:{position:"sw"},grid:{backgroundColor:document.documentElement.getAttribute("data-theme")==="dark"?"#222222":"#ffffff",hoverable:!0},tooltip:!0,tooltipOpts:{content:"%s for %x was %y",xDateFormat:"%H:%M:%S",onHover:function(g,_){}}};h.legend.show=!1,typeof i.compact!="undefined"&&(h.legend.show=!1,h.tooltip=!1);function u(g){h.grid.backgroundColor=g==="dark"?"#222222":"#ffffff",d=$.plot(a,l,h),d.draw()}function c(g){var _;return g.toFixed(0)+((_=t.unit)!=null?_:"\xB0C")}function f(g){return g.toFixed(0)+"%"}t.$on("themeChanged",(g,_)=>{u(_)});let d=null,m=!1;d=$.plot(a,l,h),t.$watchCollection("history",function(g){if(typeof g!="undefined"){r.length=0,n.length=0,o.length=0;let _=1e3,x=-1e3;angular.forEach(g,function(b){let y=b.t;b.T>x&&(x=b.T),b.S>x&&(x=b.S),b.T<_&&(_=b.T),b.S<_&&(_=b.S),r.push([y,b.O]),n.push([y,b.T]),o.push([y,b.S])}),_-=5,x+=5,_<0&&(_=0),d.getOptions().yaxes[0].min=_,d.getOptions().yaxes[0].max=x,d.setData(l),d.setupGrid(),d.draw()}}),t.$on("windowResized",function(){a.width()>0&&(d=$.plot(a,l,h))});let p=-1,v=function(){a.width()!==p&&a.width()>0&&(p=a.width(),d=$.plot(a,l,h)),m||setTimeout(v,200)};t.$on("$destroy",function(){m=!0}),v()}}}]).directive("knob",function(){return{restrict:"E",scope:{value:"=",changed:"&",digits:"="},replace:!0,template:'<div><input type="text" class="dial "></div>',link:function(t,e,i){let r=i.max;$(".dial",e).knob({min:parseFloat(i.min),max:parseFloat(i.max),readOnly:i.readonly==="true",angleOffset:-125,angleArc:250,width:100,height:100,step:t.digits?1/Math.pow(10,t.digits):1,inputColor:"#005B6E",fgColor:"#005B6E",lineCap:"butt",release:function(n){if(isFinite(n)){if(Math.abs(t.value-n)<.01)return;t.value=n,r!==i.max&&(r=Math.max(n,i.max),$(".dial",e).trigger("configure",{max:r})),t.changed&&t.changed({value:n})}},change:function(n){}}),e.addClass("knob"),e[0].style.position="relative",t.$watch("value",function(n){typeof n!="undefined"&&$(".dial",e).val()!==n&&isFinite(Number(n))&&(n>i.max&&(r=n,$(".dial",e).trigger("configure",{max:n})),$(".dial",e).val(n).trigger("change"))}),t.$watch("digits",function(n){if(typeof n=="undefined")return;let o=n?1/Math.pow(10,n):1;isFinite(Number(o))&&n>i.max&&(r=n,$(".dial",e).trigger("configure",{step:o}))}),i.$observe("min",function(n){$(".dial",e).trigger("setMin",parseFloat(n))}),i.$observe("max",function(n){$(".dial",e).trigger("setMax",parseFloat(n))})}}}).directive("colorpicker",function(){return{restrict:"EA",replace:!0,require:"ngModel",scope:{fallbackValue:"=",disabled:"=?",onChange:"&?"},link:function(t,e,i,r){let n=$(e);n.addClass("input-small"),t.$on("$destroy",function(){n.spectrum("destroy")});function o(u){angular.isFunction(t.onChange)&&t.onChange({color:u})}r.$render=function(){n.spectrum("set",r.$viewValue||""),o(r.$viewValue)};let a={color:r.$viewValue},l={showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",chooseText:"<?php _('Choose') ?>",cancelText:"<?php _('Cancel') ?>",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]},h=angular.extend({},a,l);n.spectrum(h),t.$watch("disabled",function(u){typeof u!="undefined"&&n.spectrum(u?"disable":"enable")})}}}).directive("inputerror",function(){return{restrict:"E",scope:{error:"=error"},template:'<div class="error" ng-show="error">{{error}}</div>',replace:!0,link:function(t,e,i){}}}).directive("fileUpload",function(){return{restrict:"E",scope:{done:"&",url:"@",title:"@",response:"&",formData:"@"},replace:!0,template:'<div><form enctype="multipart/form-data" method="post"><span class="btn  fileinput-button"><i class="icon-upload"></i> {{infoText}}<input type="file" name="file" ng-disabled="disabled"></span><div ng-show="uploading"><p class="size">File size:{{fileSize | formatFileSize}}</p><div class="progress progress-success progress-striped active"><div class="bar" style="width:{{percent}}%}"><span style="position:absolute;text-align:center;left:0;right:0;color:#000000">{{percent}}%</span></div></div></div></form><div ng-show="fail" class="alert alert-error"><h4>Upload failed</h4>{{fail}}</div></div>',link:function(t,e,i){t.title?t.infoText=t.title:t.infoText="Upload";let r={dataType:"json",add:function(n,o){t.$apply(function(){t.uploading=!0,t.percent=0,t.fail=!1}),o.submit()},fail:function(n,o){t.$apply(function(){t.uploading=!1,t.percent=0,t.fail="Upload failed";let a=angular.fromJson(o.response().jqXHR.responseText);a.error.message&&(t.fail=a.error.message)})},url:t.url,formData:t.formData};t.percent=0,t.uploading=!1,t.file=$("input[type=file]",$(e)),r.done=function(n,o){t.$apply(function(){t.uploading=!1,t.response&&t.response({data:angular.fromJson(o.response().jqXHR.responseText)}),t.done&&t.done({e:n,data:o})})},r.progress=function(n,o){t.$apply(function(){t.fileSize=o.total,t.percent=parseInt(o.loaded/o.total*100,10)})},t.file.fileupload(r),i.$observe("url",function(n){t.file.fileupload("option","url",n)}),i.$observe("title",function(n){t.infoText=n})}}}).directive("autoset",function(){return{restrict:"E",scope:{name:"@"},template:'<i class="fa margin-left" ng-class="result" ng-show="tested" title="{{comp}}"></i>',replace:!0,require:"ngModel",controller:["$scope",function(t){t.$on("firmwareConfigRead",function(e,i){i&&i.hasOwnProperty(t.name)?(t.tested=!0,t.comp=i[t.name]*t.nfactor,t.result=t.comp==t.value?"fa-dot-circle-o fg-success":"fa-circle-o fg-danger"):t.tested=!1})}],link:function(t,e,i,r){t.nfactor=i.nfactor?parseFloat(i.nfactor):1,t.tested=!1,r.$formatters.push(function(n){t.value=n,n!==void 0&&(t.result=t.comp===n?"fa-dot-circle-o fg-success":"fa-circle-o fg-danger")})}}}).directive("dragme",function(){return{restrict:"A",link:function(t,e){$(e).dragScroll({})}}}).directive("integer",function(){return{require:"ngModel",link:function(t,e,i,r){r.$parsers.unshift(function(n){if(U6.test(n))return r.$setValidity("integer",!0),n;r.$setValidity("integer",!1)})}}}).directive("aDisabled",function(){return{compile:function(){return function(t,e,i){t.$watch(i.aDisabled,function(r){typeof r!="undefined"&&e.toggleClass("disabled",r)}),e.on("click",function(r){t.$eval(i.aDisabled)&&r.preventDefault()})}}}}).directive("rsEnter",function(){return function(t,e,i){e.bind("keydown keypress",function(r){r.which===13&&(t.$apply(function(){t.$eval(i.rsEnter)}),r.preventDefault())})}}).directive("rsInPlaceNumber",["$timeout",function(t){return{restrict:"E",scope:{value:"=",precision:"@",changed:"&",readonly:"<?"},template:'<span ng-click="edit()" ng-bind="value | number:precision"></span><input ng-model="valueInt" class="nospin" rs-enter="close()" type="number">',link:function(e,i){let r=angular.element(i.children()[1]);i.addClass("edit-in-place"),i.addClass("edit-in-place-number"),e.editing=!1,e.edit=function(){e.hasOwnProperty("readonly")&&e.readonly||(e.valueInt=e.value,e.editing=!0,i.addClass("active"),r[0].focus(),e.orig=e.value)},e.close=function(){r.blur()},r.on("blur",function(){e.editing&&e.orig!==e.valueInt&&(e.valueInt==null?e.value=e.orig:e.value=e.valueInt,t(()=>{e.changed({newValue:e.value,oldValue:e.orig})})),e.editing=!1,i.removeClass("active")})}}}]).directive("rsInPlaceString",function(){return{restrict:"E",scope:{value:"=",changed:"&",readonly:"<?"},template:'<span ng-click="edit()" ng-bind="value"></span><input ng-model="value" rs-enter="close()" type="text">',link:function(t,e){let i=angular.element(e.children()[1]);e.addClass("edit-in-place"),e.addClass("edit-in-place-string"),t.editing=!1,t.edit=function(){t.hasOwnProperty("readonly")&&t.readonly||(t.editing=!0,e.addClass("active"),i[0].focus(),t.orig=t.value)},t.close=function(){i.blur()},i.on("blur",function(){t.editing&&t.orig!==t.value&&(t.value==null&&(t.value=t.orig),t.changed({newValue:t.value,oldValue:t.orig})),t.editing=!1,e.removeClass("active")})}}}).directive("preventEnterSubmit",function(){return function(t,e){e.bind("keydown",function(i){i.which===13&&(i.preventDefault(),window.stop(),document.execCommand("Stop"))})}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(t,e,i,r){r.$parsers.push(function(n){return n!=null?parseInt(n,10):null}),r.$formatters.push(function(n){return n!=null?""+n:null})}}}).component("rsDialog",{controller:["$element","$interval","$rootScope","RSCom","$document","$sce",function(t,e,i,r,n,o){let a=0,l=0;this.inputEntrys={},this.inputErrors={};let h=angular.element(t[0].childNodes[0]);this.x=.5*(window.innerWidth-h.outerWidth()),this.y=150,this.extraClass="",this.buttonClass="btn-primary",this.iconClass="fa-arrows",setTimeout(()=>{this.x=.5*(window.innerWidth-h.outerWidth()),this.y=.3*(window.innerHeight-h.outerHeight()),this.extraClass=this.dialog.dialogType===1?"info":this.dialog.dialogType===2?"warning":this.dialog.dialogType===3?"error":"",this.buttonClass=this.dialog.dialogType===1?"btn-info":this.dialog.dialogType===2?"btn-warning":this.dialog.dialogType===3?"btn-danger":"btn-primary",this.iconClass=this.dialog.dialogType===1?"fa fa-info-circle":this.dialog.dialogType===2?"fa fa-exclamation-triangle":this.dialog.dialogType===3?"fa fa-exclamation":"rs rs-printer",this.dialog.input.forEach(f=>{this.inputEntrys[f.name]=this.getDefaultVal(f),this.updateError(f)}),this.message=o.trustAsHtml(this.dialog.message)},0),this.getTypeSteps=f=>f.dataType==="Int"?"1":"any",this.getDefaultVal=f=>f.dataType==="Double"?parseFloat(f.defaultValue):f.dataType==="Int"?parseInt(f.defaultValue):f.defaultValue;let u=f=>{f.originalEvent.touches&&(f.screenX=f.originalEvent.touches.item(0).screenX,f.screenY=f.originalEvent.touches.item(0).screenY),this.y=f.screenY-l,this.x=f.screenX-a,this.x=Math.max(0,this.x),this.y=Math.max(0,this.y),this.x=Math.min(this.x,window.innerWidth-h.outerWidth()),this.y=Math.min(this.y,window.innerHeight-h.outerHeight()),t.css({top:this.x,left:this.y})},c=()=>{n.unbind("mousemove",u),n.unbind("mouseup",c),n.unbind("touchmove",u),n.unbind("touchend",c)};this.shouldBeVisible=()=>i.user.printPermission||this.dialog.dialogType!==0&&this.dialog.dialogType!==4,this.startDrag=f=>{f.preventDefault(),f.originalEvent.touches&&(f.screenX=f.originalEvent.touches.item(0).screenX,f.screenY=f.originalEvent.touches.item(0).screenY),a=f.screenX-this.x,l=f.screenY-this.y,n.on("mousemove",u),n.on("mouseup",c),n.on("touchmove",u),n.on("touchend",c)},this.selectClose=f=>{let d={},m=!1;Object.keys(this.inputErrors).forEach(p=>{this.inputErrors[p].visible=this.inputErrors[p].error!==!1,m=m||this.inputErrors[p].error!==!1}),Object.keys(this.inputEntrys).forEach(p=>{this.inputEntrys[p]===void 0?d[p]="":d[p]=this.inputEntrys[p].toString()}),r.send("closeDialog",{id:this.dialog.id,selection:f,inputData:d},this.dialog.printer).then(p=>{p.ok||console.log("error: not allowed to close the dialog")})},this.updateError=f=>{let d=!1,m=this.inputEntrys[f.name];if(m!==void 0&&f.inputType===0){let p=Math.round(parseFloat(f.minValue)*1e3)/1e3,v=Math.round(parseFloat(f.maxValue)*1e3)/1e3;f.dataType==="String"&&(f.dataType==="String"&&p>m.length?d="<?php _('Minimum text length is: $1') ?>".replace("$1",p.toString()):f.dataType==="String"&&v<m.length&&(d="<?php _('Maximum text length is: $1') ?>".replace("$1",v.toString()))),(f.dataType==="Int"||f.dataType==="Double")&&(isNaN(m)?d='<?php _("Entered text is not a number") ?>':p>m?d='<?php _("Minimum value is: $1") ?>'.replace("$1",p.toString()):v<m&&(d='<?php _("Maximum value is: $1") ?>'.replace("$1",v.toString()))),this.inputErrors[f.name]={error:d,visible:!1}}},this.roundFloat=f=>Math.round(parseFloat(f)*1e3)/1e3,this.getLabelStyles=(f,d,m)=>{let p="normal",v="normal",g="inherit";return(f&32)===32&&(v="bold",g="xx-large"),(f&16)===16&&(v="bold",g="x-large"),(f&8)===8&&(p="italic"),(f&4)===4&&(v="bold"),(f&2)===2&&(g="inherit"),(f&1)===1&&(g="small"),{"font-style":p,"font-weight":v,"font-size":g}}}],controllerAs:"ctrl",bindings:{dialog:"<"},template:`<div ng-show="ctrl.shouldBeVisible()" class="rs-dialog {{ctrl.extraClass}}" ng-touchstart="ctrl.startDrag($event);" ng-mousedown="ctrl.startDrag($event);" style="max-height:100%; overflow: auto; width:100%; top: {{ctrl.y || 0}}px; left: {{ctrl.x || 0}}px">
  <div class="modal-header">
    <h3 class="modal-title" ">
      <rs-menu-icon ng-if="ctrl.dialog.icon !== ''" icon-img="ctrl.dialog.icon"></rs-menu-icon>
      <i ng-if="ctrl.dialog.icon === ''" class="{{ctrl.iconClass}}"></i>
      &nbsp;{{ctrl.dialog.title}}
    </h3>
  </div>
  <div class="modal-body">
    <form name="formDialog" class="customDialog">
      <div ng-bind-html="ctrl.message"></div>
      <small ng-if="ctrl.dialog.dialogType==0"> <?php _('Note: When printer is blocking and communication buffers are full answers might not be executed!') ?></small>
      <div ng-repeat="c in ctrl.dialog.input track by $index" ng-style="{'margin-top':'{{c.marginTop}}', 'margin-bottom':'{{c.marginBottom}}'}">
        <div ng-if="c.inputType===0" class="margin-top">
          <strong>{{c.caption}}</strong>
            <input name="{{c.name}}" class="form-control ng-pristine ng-untouched ng-valid ng-empty"
                   style="width:100%;"
                   ng-if="c.dataType === 'String'"
                   maxlength="{{c.maxValue}}"
                   minlength="{{c.minValue}}"
                   ng-required="c.dataType === 'String' && c.minValue !== 0"
                   type="text"
                   ng-model="ctrl.inputEntrys[c.name]"
                   ng-mousedown="$event.stopPropagation()"
                   ng-touchstart="$event.stopPropagation()"
                   ng-change="ctrl.updateError(c)"
                   ng-disabled="c.readonly"
                   ng-model-options="{ allowInvalid: true }"
                   >
            <input name="{{c.name}}" class="form-control ng-pristine ng-untouched ng-valid ng-empty"
                   style="width:100%;"
                   ng-if="c.dataType !== 'String'"
                   step="{{ctrl.getTypeSteps(c)}}"
                   min="{{ctrl.roundFloat(c.minValue)}}"
                   max="{{ctrl.roundFloat(c.maxValue)}}"
                   type="number"
                   ng-model="ctrl.inputEntrys[c.name]"
                   ng-mousedown="$event.stopPropagation()"
                   ng-touchstart="$event.stopPropagation()"
                   ng-change="ctrl.updateError(c)"
                   ng-disabled="c.readonly"
                   ng-model-options="{ allowInvalid: true }"
                   >
        </div>
        <strong ng-show="ctrl.inputErrors[c.name].visible" style="color: red; font-weight: normal" >{{ctrl.inputErrors[c.name].error}}</strong>

        <div ng-if="c.inputType===1" class="margin-top">
          <strong>{{c.caption}}</strong>
          <select class="form-control ng-pristine ng-untouched ng-valid ng-not-empty"
                  style=" width:100%;"
                  ng-model="ctrl.inputEntrys[c.name]"
                  ng-mousedown="$event.stopPropagation()"
                  ng-touchstart="$event.stopPropagation()"
                  ng-options="option.value as option.name for option in c.dropdownData"
                  ng-disabled="c.readonly">
          </select>
        </div>
        <div ng-if="c.inputType===2" class="margin-top"">
          <div style="display: flex">
            <label style="font-weight: 400;margin: 5px 0 5px 20px" class="checkbox">
              <input
                  type="checkbox"
                  ng-model="ctrl.inputEntrys[c.name]"
                  ng-true-value="'1'"
                  ng-false-value="'0'"
                  ng-disabled="c.readonly"
                  ng-touchstart="$event.stopPropagation()"
                  ng-mousedown="$event.stopPropagation()">
              {{c.caption}}
            </label>
          </div>
        </div>
        <label ng-if="c.inputType===3" class="margin-top" ng-style="{{ctrl.getLabelStyles(c.labelStyles)}}">{{c.caption}}</label>
      </div>
    </form>
  </div>
  <div class="modal-footer" style="text-align: center" ng-if="ctrl.dialog.choices.length>0">


    <div style="display: flex;flex-wrap: wrap;justify-content: space-between;margin-top:-10px">
      <button
        ng-repeat="c in ctrl.dialog.choices track by $index"
        class="btn {{ctrl.buttonClass}}"
        style="margin-top:10px;margin-left:8px;margin-right:8px"
        type="button"
        ng-touchstart="$event.stopPropagation()"
        ng-click="ctrl.selectClose($index)">
         {{c}}
      </button>
    </div>
  </div>
</div>`}).component("rsWebcam",{template:'<div style="{{ctrl.style}}"><img ng-src="{{ctrl.imgurl}}" alt="webcam image" style="max-width:100%"></div>',controller:["$element","$interval","$rootScope","User",function(t,e,i,r){let n=this,o=0,a=0,l="none",h=0;n.imgurl="";let u,c=0,f=!0,d=0,m=null,p=!1;n.fullstyle=n.style;let v=function(){if(p)return;let g=$("img",t);if(f&&(g.on("load",onload),g.on("error",onerror),f=!1),g.length===0)return;let _=g.parent(),x=g.width(),b=g.height();if(c++,n.mjpg===!1&&c>=2&&(c=0,o=-1),d===0&&o===x&&a===b&&h===n.rotation&&l===n.url)return;if(n.url!==l){let A="rand="+RSUtils.createAlphaID(10);n.mjpg?n.imgurl="/printer/previewcammjpg?url="+encodeURIComponent(n.url)+"&rot="+n.rotation:n.imgurl="/printer/previewcamjpg?url="+encodeURIComponent(n.url)+"&rot="+n.rotation,d>0&&d--,n.imgurl.indexOf("?")>0?n.imgurl+="&"+A:n.imgurl+="?"+A}let y=0,S=_.width(),w=1,M,C;switch(n.rotation){case 0:case 180:M=x,C=b;break;case 90:case 270:y=(x-b)/2,M=b,C=x;break}S<M&&(w=S/M);let E=$(window).height()-80;E<C&&(w=Math.min(E/C,w)),n.maxHeight&&n.maxHeight<C&&(w=Math.min(w,n.maxHeight/C));let P="scale("+w+") rotate("+n.rotation+"deg)";g.css("-webkit-transform",P),g.css("-ms-transform",P),g.css("transform",P),g.css("margin-top",((C*w-b)/2).toFixed(0)+"px"),g.css("margin-left",-((x-M*w)/2)+"px"),_.css("height",C*w+"px"),o=x,a=b,h=n.rotation,l=n.url};this.$onChanges=function(){v()},this.$onInit=function(){u=e(v,500),m=i.$on("refreshWebcam",function(){d=2})},this.$onDestroy=function(){e.cancel(u),m();let g=$("img",$(t));f||(g.off("load",onload),g.off("error",onerror)),n.imgurl="/img/empty.png",g[0].src="/img/empty.png",g[0].parentNode.textContent=""}}],controllerAs:"ctrl",bindings:{url:"<",mjpg:"<",maxHeight:"<",rotation:"<",style:"@"}}).component("rsPrinterWebcam",{template:'<div style="{{ctrl.style}};position:relative;z-index:1;overflow:hidden;transition-duration: 300ms;transition-property: transform;{{ctrl.zoomStyle}}"><websocket-camera ng-mouseenter="ctrl.setZoom(true)" alt="zoom" ng-mouseleave="ctrl.setZoom(false)" img-url="{{ctrl.imgurl}}" rotate="ctrl.rotation" max-refresh="ctrl.maxRefresh" max-height="ctrl.maxHeight" style="position:relative;z-index:1;"></div>',controller:["$element","$interval","$rootScope",function(t,e,i){let r=this;r.rotation=0,r.imgurl="/img/nowebcam.png",this.zoom=!1;let n,o=1e3,a=0,l=null;r.fullstyle=r.style,r.zoomStyle="";let h="",u=()=>{if(r.zoom)return;let c=i.printerConfig[r.slug];c&&(c=c.webcams[a],r.rotation=c.orientation,(c.method&2)===2?(!r.url||!r.url.startsWith("/printer/cammjpg/"))&&(r.url="/printer/cammjpg/"+r.slug,h=RSUtils.createAlphaID(10),r.imgurl=r.url+"?wcid="+h+"&cam=0"):(c.method&1)===1?(o++,o>=2*c.reloadInterval&&(r.url="/printer/camjpg/"+r.slug,h=RSUtils.createAlphaID(10),r.imgurl=r.url+"?wcid="+h+"&cam=0",o=0)):(r.rotation=0,r.imgurl=r.url="/img/nowebcam.png"))};this.setZoom=function(c){r.zoom=c,c?r.zoomStyle="transform: scale(1.6) translate(0,25px);display:inline-block":r.zoomStyle="display:inline-block"},this.$onChanges=function(){u()},this.$onInit=function(){u(),n=e(u,500),l=i.$on("refreshWebcam",function(){r.url="/img/empty.png",u()})},this.$onDestroy=()=>{e.cancel(n),l(),r.imgurl="/img/empty.png"}}],controllerAs:"ctrl",bindings:{slug:"<",maxHeight:"<",idx:"@",style:"@",maxRefresh:"<"}}).directive("a",function(){return{restrict:"E",link:function(t,e,i){(i.ngClick||i.href===""||i.href==="#")&&e.on("click",function(r){r.preventDefault(),r.stopPropagation()})}}}).component("rsMenuIcon",{template:'<i ng-if="!ctrl.iconImg" ng-class="[ctrl.icon, ctrl.colorClass]" style="{{ctrl.style}}"></i><span ng-if="ctrl.iconImg" class="menuicon" style="display: inline-block;" ng-bind-html="ctrl.html"></span>',controllerAs:"ctrl",bindings:{iconImg:"<",icon:"@",style:"@",colorClass:"@"},controller:["$sce",function(t){let e=this;this.html="";let i=()=>{if(!e.iconImg){this.html="";return}e.iconImg.substring(0,4)==="<svg"?e.html=t.trustAsHtml(e.iconImg):e.iconImg.substring(0,4)==="http"||e.iconImg.substr(0,4)==="data"||e.iconImg[0]==="/"?e.iconImg.endsWith(".svg")?e.html=t.trustAsHtml('<img style="" onload="SVGInject(this)" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml('<img style="" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml(`<i class="${e.iconImg}"></i>`)};this.$onChanges=function(r){r.iconImg&&i()}}]}).component("rsIcon",{template:'<i ng-if="!ctrl.iconImg" ng-class="[ctrl.icon, ctrl.colorClass]" style="{{ctrl.style}}"></i><span ng-if="ctrl.iconImg" class="rs-icon" style="" ng-bind-html="ctrl.html"></span>',controllerAs:"ctrl",bindings:{iconImg:"<",icon:"@",style:"@",colorClass:"@"},controller:["$sce",function(t){let e=this;this.html="";let i=()=>{if(!e.iconImg){this.html="";return}e.iconImg.substring(0,4)==="<svg"?e.html=t.trustAsHtml(e.iconImg):e.iconImg.substring(0,4)==="http"||e.iconImg.substr(0,4)==="data"||e.iconImg[0]==="/"?e.iconImg.endsWith(".svg")?e.html=t.trustAsHtml('<img style="" onload="SVGInject(this)" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml('<img style="" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml(`<i class="${e.iconImg}"></i>`)};this.$onChanges=function(r){r.iconImg&&i()}}]}).component("rsPrintStatus",{controllerAs:"ctrl",controller:["$rootScope","User","RSPrinter","RSCom","Confirm",function(t,e,i,r,n){this.RSPrinter=i,this.canPrint=e.canPrint(),this.canFullStop=e.canFullStop()||this.canPrint,this.stopPrint=function(){n("<?php _('Confirmation required') ?>","<?php _('Really stop current print?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){t.active.status.jobid&&r.send("stopJob",{id:t.active.status.jobid})})}}],template:`<div class="margin-top panel" ng-class="{'panel-default':!$root.active.status.paused,'panel-danger':$root.active.status.paused}" ng-show="$root.active.state.isJobActive">
  <div class="panel-heading" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; display: flex">
    <i class="flex-pull-vertical-center rs rs-print" ng-if="!$root.active.status.paused"></i>
    <i class="flex-pull-vertical-center fa fa-pause" ng-if="$root.active.status.paused"></i>
    <div class="flex-pull-left margin-left-important flex-pull-vertical-center ">{{$root.active.status.job}}</div>

    <!--ng-show="!$root.active.status.queueCount" ng-bind="printerWithJobs.length" -->
    <span ng-show="$root.active.status.repeat>1" class="flex-pull-right badge" style="">{{("<?php _('@ remaining') ?>").replace('@',$root.active.status.repeat-1)}}</span>

  </div>
  <div class="panel-body" style="height: 130px;">
    <table style="width:100%">
      <tr>
        <td ng-if="$root.hasFeature1" class="hidden-sm-600">
          <img ng-src="{{$root.RSPrinter.printingImage('m')}}" alt="" style="height: 130px;margin: -15px 10px -15px -15px">
        </td>
        <td style="width:100%">
          <table style="width: 100%;white-space: nowrap;margin:-5px 0">
            <tr ng-show="$root.active.status.analysed">
              <td style="white-space: nowrap;"><strong><?php _('ETA:') ?></strong>&nbsp;
              </td>
              <td style="padding-right: 10px;">{{($root.stateTime + 1000*($root.active.status.printTime-$root.active.status.printedTimeComp))
                | date:'short'}}
              </td>
              <td>
                <strong class="hidden-xs"><?php _('Start') ?>:</strong>
              </td>
              <td style="width: 100%">
                        <span class="hidden-xs">
                          {{1000*$root.active.status.printStart| date:'short'}}
                        </span>
              </td>
            </tr>
            <tr ng-show="$root.active.status.analysed">
              <td style="white-space: nowrap;"><strong><?php _('ETE:') ?></strong>&nbsp;
              </td>
              <td style="padding-right: 10px;">
                {{$root.active.status.printTime - $root.active.status.printedTimeComp | dhms}}
              </td>
              <td>
                <strong class="hidden-xs"><?php _('Printing Time:') ?></strong>&nbsp;
              </td>
              <td>
                <span class="hidden-xs">
                  {{$root.active.status.serverTime - $root.active.status.printStart | hms}}
                </span>
              </td>
            </tr>
            <tr ng-hide="$root.active.status.analysed">
              <td style="white-space: nowrap;">
                <strong><?php _('Printing Time:') ?></strong>&nbsp;
              </td>
              <td colspan="3">{{$root.stateTime/1000 - $root.active.status.printStart | hms}}
              </td>
            </tr>
            <tr>
              <td colspan="4" style="width: 100%;padding-top:10px">
                <div style="position: relative">
                  <div class="progress active" style="margin-bottom: 0">
                    <div class="metertext">{{$root.active.status.done | number:2}}% &nbsp;
                      | &nbsp; <i class="fa fa-bars"></i> {{$root.active.state.layer}} /
                      {{$root.active.status.ofLayer}}
                      <span class="hidden-inline-sm-400">&nbsp; | &nbsp; Z: {{$root.active.state.z | number:2}} mm</span>
                    </div>
                    <div class="progress-bar progress-bar-success" role="progressbar"
                         style="width:{{$root.active.status.done}}%"></div>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="4" style="padding-top: 10px" class="text-right">
                <button ng-show="ctrl.canFullStop" ng-click="ctrl.stopPrint()" class="btn btn-danger btn-sm" style="width:100px">
                  <i
                      class="fa fa-stop"></i> <?php _('Stop') ?>
                </button>
                <button ng-show="ctrl.canFullStop && !$root.active.status.paused" ng-click="$root.RSPrinter.pausePrint()" style="width:100px" class="btn btn-primary btn-sm">
                  <i
                      class="fa fa-pause"></i>
                    <?php _('Pause') ?>
                </button>
                <button ng-show="ctrl.canPrint && $root.active.status.paused" ng-click="$root.RSPrinter.unpausePrint()" ng-disabled="$root.active.status.pauseState===3" style="width:100px" class="btn btn-primary btn-sm">
                  <i class="fa fa-play"></i>
                  {{$root.RSPrinter.pauseNames[$root.active.status.pauseState]}}
                </button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
</div>`}).controller("RsDropdownController",["$scope","$element","$attrs","$parse","uibDropdownConfig","uibDropdownService","$animate","$uibPosition","$document","$compile","$templateRequest",function(t,e,i,r,n,o,a,l,h,u,c){let f=this,d=t.$new(),m,p=n.appendToOpenClass,v=n.openClass,g,_=angular.noop,x=i.onToggle?r(i.onToggle):angular.noop,b=!1;f.selectedOption=null,d.isOpen=!1,e.addClass("dropdown"),this.init=()=>{i.isOpen&&(g=r(i.isOpen),_=g.assign,t.$watch(g,function(S){d.isOpen=!!S})),b=angular.isDefined(i.keyboardNav)},this.toggle=function(S){return d.isOpen=arguments.length?!!S:!d.isOpen,angular.isFunction(_)&&_(d,d.isOpen),d.isOpen},this.isOpen=()=>d.isOpen,d.getToggleElement=function(){return f.toggleElement},d.getAutoClose=function(){return i.autoClose||"always"},d.getElement=function(){return e},d.isKeynavEnabled=function(){return b},d.focusDropdownEntry=function(S){let w=f.dropdownMenu?angular.element(f.dropdownMenu).find("a"):e.find("ul").eq(0).find("a");switch(S){case 40:{angular.isNumber(f.selectedOption)?f.selectedOption=f.selectedOption===w.length-1?f.selectedOption:f.selectedOption+1:f.selectedOption=0;break}case 38:{angular.isNumber(f.selectedOption)?f.selectedOption=f.selectedOption===0?0:f.selectedOption-1:f.selectedOption=w.length-1;break}}w[f.selectedOption].focus()},d.getDropdownElement=function(){return f.dropdownMenu},d.focusToggleElement=function(){f.toggleElement&&f.toggleElement[0].focus()};function y(){e.append(f.dropdownMenu)}d.$watch("isOpen",function(S,w){let M=null,C=!0;if(angular.isDefined(i.dropdownAppendTo)){let k=r(i.dropdownAppendTo)(d);k&&(M=angular.element(k),C=!1)}if(angular.isDefined(i.dropdownAppendToBody)&&r(i.dropdownAppendToBody)(d)!==!1&&(C=!0),C&&!M&&(M=$("#menucontainer")),M&&f.dropdownMenu&&(S?(M.append(f.dropdownMenu),e.on("$destroy",y)):(e.off("$destroy",y),y())),M&&f.dropdownMenu){let k=l.positionElements(e,f.dropdownMenu,"bottom-left",!0),I,L,T,O=0;I={top:k.top+"px",display:S?"block":"none"};let D=l.offset(M);I.top=k.top-D.top+"px";let F=f.dropdownMenu.width();T=l.scrollbarPadding(M),T.heightOverflow&&T.scrollbarWidth&&(O=T.scrollbarWidth+2);let B=window.innerWidth-O;L=k.left>window.innerWidth/2;let U=0,G=0;{let Y=k.left+F;if(L)G=window.innerWidth-O-(k.left+e.prop("offsetWidth")),U=window.innerWidth-G-F,U>=0?(I.left="auto",I.right=G+"px"):(I.left="0px",B>F?(G=O,I.right=O+"px",I.overflowX="auto"):I.right="auto");else if(I.left=k.left+"px",I.right="auto",Y>B){let re=k.left+B-Y;re<0?(I.left="0px",I.right=O+"px",I.overflowX="auto"):I.left=re+"px"}}if(!C){let Y=l.offset(M);I.top=k.top-Y.top+"px",L?I.right!=="auto"&&(I.right=G-Y.left+"px"):I.left=k.left-Y.left+"px"}f.dropdownMenu.css(I)}let E=M||e,P=M?p:v,A=E.hasClass(P),R=o.isOnlyOpen(t,M);if(A===!S){let k;M?k=R?"removeClass":"addClass":k=S?"addClass":"removeClass",a[k](E,P).then(function(){angular.isDefined(S)&&S!==w&&x(t,{open:!!S})})}if(S)f.dropdownMenuTemplateUrl?c(f.dropdownMenuTemplateUrl).then(function(k){m=d.$new(),u(k.trim())(m,function(I){let L=I;f.dropdownMenu.replaceWith(L),f.dropdownMenu=L,h.on("keydown",o.keybindFilter)})}):h.on("keydown",o.keybindFilter),d.focusToggleElement(),o.open(d,e,M);else{if(o.close(d,e,M),f.dropdownMenuTemplateUrl){m&&m.$destroy();let k=angular.element('<ul class="dropdown-menu"></ul>');f.dropdownMenu.replaceWith(k),f.dropdownMenu=k}f.selectedOption=null}angular.isFunction(_)&&_(t,S)})}]).directive("rsDropdown",function(){return{controller:"RsDropdownController",link:function(t,e,i,r){r.init()}}}).directive("rsDropdownMenu",function(){return{restrict:"A",require:"?^rsDropdown",link:function(t,e,i,r){if(!r||angular.isDefined(i.dropdownNested))return;e.addClass("dropdown-menu");let n=i.templateUrl;n&&(r.dropdownMenuTemplateUrl=n),r.dropdownMenu||(r.dropdownMenu=e)}}}).directive("rsDropdownToggle",function(){return{require:"?^rsDropdown",link:function(t,e,i,r){if(!r)return;e.addClass("dropdown-toggle"),r.toggleElement=e;let n=function(o){o.preventDefault(),!e.hasClass("disabled")&&!i.disabled&&t.$apply(function(){r.toggle()})};e.on("click",n),e.attr({"aria-haspopup":!0,"aria-expanded":!1}),t.$watch(r.isOpen,function(o){e.attr("aria-expanded",!!o)}),t.$on("$destroy",function(){e.off("click",n)})}}}).component("rsManual",{bindings:{sections:"="},controller:["$element","$scope","$http",function(t,e,i){e.htmlManualText={},this.$onInit=function(){e.getManualText(this.sections)},e.getManualText=function(r){for(let[n,o]of Object.entries(r))SL(n,i).then(a=>{let l={};l.caption=o,l.htmlText=a,e.htmlManualText[n]=l})},e.setManualText=function(r,n){r.setSelectedManualSection(n),$(".manualHelp",t)[0].scrollTop=0}}],controllerAs:"ctrl",template:`<div class="col-lg-3 col-md-4 col-sm-12 col-xs-12" style="height: 100%;
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;">
            <select class="form-control ng-pristine ng-untouched ng-valid ng-not-empty"
                    style="width:100%"
                    ng-model="$parent.selectedManualSection"
                    ng-change="setManualText($parent, $parent.selectedManualSection)">
              <option ng-repeat="(key, value) in htmlManualText" value="{{key}}" title="{{ value.caption }}">{{ value.caption }}</option>
            </select>
            <div style="overflow-y: scroll; height: 100%; margin-bottom: 0;" class="manualHelp panel panel-default margin-top panel-body select-text">
              <div style="margin-top: 10px; font-size: 80%" ng-bind-html="htmlManualText[$parent.selectedManualSection].htmlText" ></div>
            </div>
          </div>`});var zt=class t{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,i,r){[e,i]=lh(this,e,i);let n=[];return this.decompose(0,e,n,2),r.length&&r.decompose(0,r.length,n,3),this.decompose(i,this.length,n,1),nh.from(n,this.length-(i-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,i=this.length){[e,i]=lh(this,e,i);let r=[];return this.decompose(e,i,r,0),nh.from(r,i-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let i=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),n=new Za(this),o=new Za(e);for(let a=i,l=i;;){if(n.next(a),o.next(a),a=0,n.lineBreak!=o.lineBreak||n.done!=o.done||n.value!=o.value)return!1;if(l+=n.value.length,n.done||l>=r)return!0}}iter(e=1){return new Za(this,e)}iterRange(e,i=this.length){return new Km(this,e,i)}iterLines(e,i){let r;if(e==null)r=this.iter();else{i==null&&(i=this.lines+1);let n=this.line(e).from;r=this.iterRange(n,Math.max(n,i==this.lines+1?this.length:i<=1?0:this.line(i-1).to))}return new Qm(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?t.empty:e.length<=32?new fn(e):nh.from(fn.split(e,[]))}},fn=class t extends zt{constructor(e,i=z6(e)){super(),this.text=e,this.length=i}get lines(){return this.text.length}get children(){return null}lineInner(e,i,r,n){for(let o=0;;o++){let a=this.text[o],l=n+a.length;if((i?r:l)>=e)return new gx(n,l,r,a);n=l+1,r++}}decompose(e,i,r,n){let o=e<=0&&i>=this.length?this:new t(CL(this.text,e,i),Math.min(i,this.length)-Math.max(0,e));if(n&1){let a=r.pop(),l=Zm(o.text,a.text.slice(),0,o.length);if(l.length<=32)r.push(new t(l,a.length+o.length));else{let h=l.length>>1;r.push(new t(l.slice(0,h)),new t(l.slice(h)))}}else r.push(o)}replace(e,i,r){if(!(r instanceof t))return super.replace(e,i,r);[e,i]=lh(this,e,i);let n=Zm(this.text,Zm(r.text,CL(this.text,0,e)),i),o=this.length+r.length-(i-e);return n.length<=32?new t(n,o):nh.from(t.split(n,[]),o)}sliceString(e,i=this.length,r=`
`){[e,i]=lh(this,e,i);let n="";for(let o=0,a=0;o<=i&&a<this.text.length;a++){let l=this.text[a],h=o+l.length;o>e&&a&&(n+=r),e<h&&i>o&&(n+=l.slice(Math.max(0,e-o),i-o)),o=h+1}return n}flatten(e){for(let i of this.text)e.push(i)}scanIdentical(){return 0}static split(e,i){let r=[],n=-1;for(let o of e)r.push(o),n+=o.length+1,r.length==32&&(i.push(new t(r,n)),r=[],n=-1);return n>-1&&i.push(new t(r,n)),i}},nh=class t extends zt{constructor(e,i){super(),this.children=e,this.length=i,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,i,r,n){for(let o=0;;o++){let a=this.children[o],l=n+a.length,h=r+a.lines-1;if((i?h:l)>=e)return a.lineInner(e,i,r,n);n=l+1,r=h+1}}decompose(e,i,r,n){for(let o=0,a=0;a<=i&&o<this.children.length;o++){let l=this.children[o],h=a+l.length;if(e<=h&&i>=a){let u=n&((a<=e?1:0)|(h>=i?2:0));a>=e&&h<=i&&!u?r.push(l):l.decompose(e-a,i-a,r,u)}a=h+1}}replace(e,i,r){if([e,i]=lh(this,e,i),r.lines<this.lines)for(let n=0,o=0;n<this.children.length;n++){let a=this.children[n],l=o+a.length;if(e>=o&&i<=l){let h=a.replace(e-o,i-o,r),u=this.lines-a.lines+h.lines;if(h.lines<u>>4&&h.lines>u>>6){let c=this.children.slice();return c[n]=h,new t(c,this.length-(i-e)+r.length)}return super.replace(o,l,h)}o=l+1}return super.replace(e,i,r)}sliceString(e,i=this.length,r=`
`){[e,i]=lh(this,e,i);let n="";for(let o=0,a=0;o<this.children.length&&a<=i;o++){let l=this.children[o],h=a+l.length;a>e&&o&&(n+=r),e<h&&i>a&&(n+=l.sliceString(e-a,i-a,r)),a=h+1}return n}flatten(e){for(let i of this.children)i.flatten(e)}scanIdentical(e,i){if(!(e instanceof t))return 0;let r=0,[n,o,a,l]=i>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=i,o+=i){if(n==a||o==l)return r;let h=this.children[n],u=e.children[o];if(h!=u)return r+h.scanIdentical(u,i);r+=h.length+1}}static from(e,i=e.reduce((r,n)=>r+n.length+1,-1)){let r=0;for(let m of e)r+=m.lines;if(r<32){let m=[];for(let p of e)p.flatten(m);return new fn(m,i)}let n=Math.max(32,r>>5),o=n<<1,a=n>>1,l=[],h=0,u=-1,c=[];function f(m){let p;if(m.lines>o&&m instanceof t)for(let v of m.children)f(v);else m.lines>a&&(h>a||!h)?(d(),l.push(m)):m instanceof fn&&h&&(p=c[c.length-1])instanceof fn&&m.lines+p.lines<=32?(h+=m.lines,u+=m.length+1,c[c.length-1]=new fn(p.text.concat(m.text),p.length+1+m.length)):(h+m.lines>n&&d(),h+=m.lines,u+=m.length+1,c.push(m))}function d(){h!=0&&(l.push(c.length==1?c[0]:t.from(c,u)),u=-1,h=c.length=0)}for(let m of e)f(m);return d(),l.length==1?l[0]:new t(l,i)}};zt.empty=new fn([""],0);function z6(t){let e=-1;for(let i of t)e+=i.length+1;return e}function Zm(t,e,i=0,r=1e9){for(let n=0,o=0,a=!0;o<t.length&&n<=r;o++){let l=t[o],h=n+l.length;h>=i&&(h>r&&(l=l.slice(0,r-n)),n<i&&(l=l.slice(i-n)),a?(e[e.length-1]+=l,a=!1):e.push(l)),n=h+1}return e}function CL(t,e,i){return Zm(t,[""],e,i)}var Za=class{constructor(e,i=1){this.dir=i,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[i>0?1:(e instanceof fn?e.text.length:e.children.length)<<1]}nextInner(e,i){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,n=this.nodes[r],o=this.offsets[r],a=o>>1,l=n instanceof fn?n.text.length:n.children.length;if(a==(i>0?l:0)){if(r==0)return this.done=!0,this.value="",this;i>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(i>0?0:1)){if(this.offsets[r]+=i,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof fn){let h=n.text[a+(i<0?-1:0)];if(this.offsets[r]+=i,h.length>Math.max(0,e))return this.value=e==0?h:i>0?h.slice(e):h.slice(0,h.length-e),this;e-=h.length}else{let h=n.children[a+(i<0?-1:0)];e>h.length?(e-=h.length,this.offsets[r]+=i):(i<0&&this.offsets[r]--,this.nodes.push(h),this.offsets.push(i>0?1:(h instanceof fn?h.text.length:h.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},Km=class{constructor(e,i,r){this.value="",this.done=!1,this.cursor=new Za(e,i>r?-1:1),this.pos=i>r?e.length:0,this.from=Math.min(i,r),this.to=Math.max(i,r)}nextInner(e,i){if(i<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,i<0?this.pos-this.to:this.from-this.pos);let r=i<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*i,this.value=n.length<=r?n:i<0?n.slice(n.length-r):n.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},Qm=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:i,lineBreak:r,value:n}=this.inner.next(e);return i&&this.afterBreak?(this.value="",this.afterBreak=!1):i?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol!="undefined"&&(zt.prototype[Symbol.iterator]=function(){return this.iter()},Za.prototype[Symbol.iterator]=Km.prototype[Symbol.iterator]=Qm.prototype[Symbol.iterator]=function(){return this});var gx=class{constructor(e,i,r,n){this.from=e,this.to=i,this.number=r,this.text=n}get length(){return this.to-this.from}};function lh(t,e,i){return e=Math.max(0,Math.min(t.length,e)),[e,Math.max(e,Math.min(t.length,i))]}var sh="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=1;t<sh.length;t++)sh[t]+=sh[t-1];function G6(t){for(let e=1;e<sh.length;e+=2)if(sh[e]>t)return sh[e-1]<=t;return!1}function EL(t){return t>=127462&&t<=127487}var ML=8205;function Ni(t,e,i=!0,r=!0){return(i?OL:H6)(t,e,r)}function OL(t,e,i){if(e==t.length)return e;e&&DL(t.charCodeAt(e))&&IL(t.charCodeAt(e-1))&&e--;let r=Bi(t,e);for(e+=Lr(r);e<t.length;){let n=Bi(t,e);if(r==ML||n==ML||i&&G6(n))e+=Lr(n),r=n;else if(EL(n)){let o=0,a=e-2;for(;a>=0&&EL(Bi(t,a));)o++,a-=2;if(o%2==0)break;e+=2}else break}return e}function H6(t,e,i){for(;e>0;){let r=OL(t,e-2,i);if(r<e)return r;e--}return 0}function DL(t){return t>=56320&&t<57344}function IL(t){return t>=55296&&t<56320}function Bi(t,e){let i=t.charCodeAt(e);if(!IL(i)||e+1==t.length)return i;let r=t.charCodeAt(e+1);return DL(r)?(i-55296<<10)+(r-56320)+65536:i}function dc(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function Lr(t){return t<65536?1:2}var vx=/\r\n?|\n/,yr=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(yr||(yr={})),po=class t{constructor(e){this.sections=e}get length(){let e=0;for(let i=0;i<this.sections.length;i+=2)e+=this.sections[i];return e}get newLength(){let e=0;for(let i=0;i<this.sections.length;i+=2){let r=this.sections[i+1];e+=r<0?this.sections[i]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let i=0,r=0,n=0;i<this.sections.length;){let o=this.sections[i++],a=this.sections[i++];a<0?(e(r,n,o),n+=o):n+=a,r+=o}}iterChangedRanges(e,i=!1){_x(this,e,i)}get invertedDesc(){let e=[];for(let i=0;i<this.sections.length;){let r=this.sections[i++],n=this.sections[i++];n<0?e.push(r,n):e.push(n,r)}return new t(e)}composeDesc(e){return this.empty?e:e.empty?this:kL(this,e)}mapDesc(e,i=!1){return e.empty?this:yx(this,e,i)}mapPos(e,i=-1,r=yr.Simple){let n=0,o=0;for(let a=0;a<this.sections.length;){let l=this.sections[a++],h=this.sections[a++],u=n+l;if(h<0){if(u>e)return o+(e-n);o+=l}else{if(r!=yr.Simple&&u>=e&&(r==yr.TrackDel&&n<e&&u>e||r==yr.TrackBefore&&n<e||r==yr.TrackAfter&&u>e))return null;if(u>e||u==e&&i<0&&!l)return e==n||i<0?o:o+h;o+=h}n=u}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return o}touchesRange(e,i=e){for(let r=0,n=0;r<this.sections.length&&n<=i;){let o=this.sections[r++],a=this.sections[r++],l=n+o;if(a>=0&&n<=i&&l>=e)return n<e&&l>i?"cover":!0;n=l}return!1}toString(){let e="";for(let i=0;i<this.sections.length;){let r=this.sections[i++],n=this.sections[i++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(i=>typeof i!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new t(e)}static create(e){return new t(e)}},Or=class t extends po{constructor(e,i){super(e),this.inserted=i}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return _x(this,(i,r,n,o,a)=>e=e.replace(n,n+(r-i),a),!1),e}mapDesc(e,i=!1){return yx(this,e,i,!0)}invert(e){let i=this.sections.slice(),r=[];for(let n=0,o=0;n<i.length;n+=2){let a=i[n],l=i[n+1];if(l>=0){i[n]=l,i[n+1]=a;let h=n>>1;for(;r.length<h;)r.push(zt.empty);r.push(a?e.slice(o,o+a):zt.empty)}o+=a}return new t(i,r)}compose(e){return this.empty?e:e.empty?this:kL(this,e,!0)}map(e,i=!1){return e.empty?this:yx(this,e,i,!0)}iterChanges(e,i=!1){_x(this,e,i)}get desc(){return po.create(this.sections)}filter(e){let i=[],r=[],n=[],o=new Ka(this);e:for(let a=0,l=0;;){let h=a==e.length?1e9:e[a++];for(;l<h||l==h&&o.len==0;){if(o.done)break e;let c=Math.min(o.len,h-l);_r(n,c,-1);let f=o.ins==-1?-1:o.off==0?o.ins:0;_r(i,c,f),f>0&&Qo(r,i,o.text),o.forward(c),l+=c}let u=e[a++];for(;l<u;){if(o.done)break e;let c=Math.min(o.len,u-l);_r(i,c,-1),_r(n,c,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(c),l+=c}}return{changes:new t(i,r),filtered:po.create(n)}}toJSON(){let e=[];for(let i=0;i<this.sections.length;i+=2){let r=this.sections[i],n=this.sections[i+1];n<0?e.push(r):n==0?e.push([r]):e.push([r].concat(this.inserted[i>>1].toJSON()))}return e}static of(e,i,r){let n=[],o=[],a=0,l=null;function h(c=!1){if(!c&&!n.length)return;a<i&&_r(n,i-a,-1);let f=new t(n,o);l=l?l.compose(f.map(l)):f,n=[],o=[],a=0}function u(c){if(Array.isArray(c))for(let f of c)u(f);else if(c instanceof t){if(c.length!=i)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${i})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:d=f,insert:m}=c;if(f>d||f<0||d>i)throw new RangeError(`Invalid change range ${f} to ${d} (in doc of length ${i})`);let p=m?typeof m=="string"?zt.of(m.split(r||vx)):m:zt.empty,v=p.length;if(f==d&&v==0)return;f<a&&h(),f>a&&_r(n,f-a,-1),_r(n,d-f,v),Qo(o,n,p),a=d}}return u(e),h(!l),l}static empty(e){return new t(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let i=[],r=[];for(let n=0;n<e.length;n++){let o=e[n];if(typeof o=="number")i.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((a,l)=>l&&typeof a!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)i.push(o[0],0);else{for(;r.length<n;)r.push(zt.empty);r[n]=zt.of(o.slice(1)),i.push(o[0],r[n].length)}}}return new t(i,r)}static createSet(e,i){return new t(e,i)}};function _r(t,e,i,r=!1){if(e==0&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:e==0&&t[n]==0?t[n+1]+=i:r?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function Qo(t,e,i){if(i.length==0)return;let r=e.length-2>>1;if(r<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<r;)t.push(zt.empty);t.push(i)}}function _x(t,e,i){let r=t.inserted;for(let n=0,o=0,a=0;a<t.sections.length;){let l=t.sections[a++],h=t.sections[a++];if(h<0)n+=l,o+=l;else{let u=n,c=o,f=zt.empty;for(;u+=l,c+=h,h&&r&&(f=f.append(r[a-2>>1])),!(i||a==t.sections.length||t.sections[a+1]<0);)l=t.sections[a++],h=t.sections[a++];e(n,u,o,c,f),n=u,o=c}}}function yx(t,e,i,r=!1){let n=[],o=r?[]:null,a=new Ka(t),l=new Ka(e);for(let h=-1;;)if(a.ins==-1&&l.ins==-1){let u=Math.min(a.len,l.len);_r(n,u,-1),a.forward(u),l.forward(u)}else if(l.ins>=0&&(a.ins<0||h==a.i||a.off==0&&(l.len<a.len||l.len==a.len&&!i))){let u=l.len;for(_r(n,l.ins,-1);u;){let c=Math.min(a.len,u);a.ins>=0&&h<a.i&&a.len<=c&&(_r(n,0,a.ins),o&&Qo(o,n,a.text),h=a.i),a.forward(c),u-=c}l.next()}else if(a.ins>=0){let u=0,c=a.len;for(;c;)if(l.ins==-1){let f=Math.min(c,l.len);u+=f,c-=f,l.forward(f)}else if(l.ins==0&&l.len<c)c-=l.len,l.next();else break;_r(n,u,h<a.i?a.ins:0),o&&h<a.i&&Qo(o,n,a.text),h=a.i,a.forward(a.len-c)}else{if(a.done&&l.done)return o?Or.createSet(n,o):po.create(n);throw new Error("Mismatched change set lengths")}}function kL(t,e,i=!1){let r=[],n=i?[]:null,o=new Ka(t),a=new Ka(e);for(let l=!1;;){if(o.done&&a.done)return n?Or.createSet(r,n):po.create(r);if(o.ins==0)_r(r,o.len,0,l),o.next();else if(a.len==0&&!a.done)_r(r,0,a.ins,l),n&&Qo(n,r,a.text),a.next();else{if(o.done||a.done)throw new Error("Mismatched change set lengths");{let h=Math.min(o.len2,a.len),u=r.length;if(o.ins==-1){let c=a.ins==-1?-1:a.off?0:a.ins;_r(r,h,c,l),n&&c&&Qo(n,r,a.text)}else a.ins==-1?(_r(r,o.off?0:o.len,h,l),n&&Qo(n,r,o.textBit(h))):(_r(r,o.off?0:o.len,a.off?0:a.ins,l),n&&!a.off&&Qo(n,r,a.text));l=(o.ins>h||a.ins>=0&&a.len>h)&&(l||r.length>u),o.forward2(h),a.forward(h)}}}}var Ka=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length?zt.empty:e[i]}textBit(e){let{inserted:i}=this.set,r=this.i-2>>1;return r>=i.length&&!e?zt.empty:i[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},rh=class t{constructor(e,i,r){this.from=e,this.to=i,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,i=-1){let r,n;return this.empty?r=n=e.mapPos(this.from,i):(r=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),r==this.from&&n==this.to?this:new t(r,n,this.flags)}extend(e,i=e){if(e<=this.anchor&&i>=this.anchor)return ge.range(e,i);let r=Math.abs(e-this.anchor)>Math.abs(i-this.anchor)?e:i;return ge.range(this.anchor,r)}eq(e,i=!1){return this.anchor==e.anchor&&this.head==e.head&&(!i||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ge.range(e.anchor,e.head)}static create(e,i,r){return new t(e,i,r)}},ge=class t{constructor(e,i){this.ranges=e,this.mainIndex=i}map(e,i=-1){return e.empty?this:t.create(this.ranges.map(r=>r.map(e,i)),this.mainIndex)}eq(e,i=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],i))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new t([this.main],0)}addRange(e,i=!0){return t.create([e].concat(this.ranges),i?0:this.mainIndex+1)}replaceRange(e,i=this.mainIndex){let r=this.ranges.slice();return r[i]=e,t.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new t(e.ranges.map(i=>rh.fromJSON(i)),e.main)}static single(e,i=e){return new t([t.range(e,i)],0)}static create(e,i=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,n=0;n<e.length;n++){let o=e[n];if(o.empty?o.from<=r:o.from<r)return t.normalized(e.slice(),i);r=o.to}return new t(e,i)}static cursor(e,i=0,r,n){return rh.create(e,e,(i==0?0:i<0?8:16)|(r==null?7:Math.min(6,r))|(n!=null?n:16777215)<<6)}static range(e,i,r,n){let o=(r!=null?r:16777215)<<6|(n==null?7:Math.min(6,n));return i<e?rh.create(i,e,48|o):rh.create(e,i,(i>e?8:0)|o)}static normalized(e,i=0){let r=e[i];e.sort((n,o)=>n.from-o.from),i=e.indexOf(r);for(let n=1;n<e.length;n++){let o=e[n],a=e[n-1];if(o.empty?o.from<=a.to:o.from<a.to){let l=a.from,h=Math.max(o.to,a.to);n<=i&&i--,e.splice(--n,2,o.anchor>o.head?t.range(h,l):t.range(l,h))}}return new t(e,i)}};function FL(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}var Px=0,Ve=class t{constructor(e,i,r,n,o){this.combine=e,this.compareInput=i,this.compare=r,this.isStatic=n,this.id=Px++,this.default=e([]),this.extensions=typeof o=="function"?o(this):o}get reader(){return this}static define(e={}){return new t(e.combine||(i=>i),e.compareInput||((i,r)=>i===r),e.compare||(e.combine?(i,r)=>i===r:Rx),!!e.static,e.enables)}of(e){return new oh([],this,0,e)}compute(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new oh(e,this,1,i)}computeN(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new oh(e,this,2,i)}from(e,i){return i||(i=r=>r),this.compute([e],r=>i(r.field(e)))}};function Rx(t,e){return t==e||t.length==e.length&&t.every((i,r)=>i===e[r])}var oh=class{constructor(e,i,r,n){this.dependencies=e,this.facet=i,this.type=r,this.value=n,this.id=Px++}dynamicSlot(e){var i;let r=this.value,n=this.facet.compareInput,o=this.id,a=e[o]>>1,l=this.type==2,h=!1,u=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?u=!0:((i=e[f.id])!==null&&i!==void 0?i:1)&1||c.push(e[f.id]);return{create(f){return f.values[a]=r(f),1},update(f,d){if(h&&d.docChanged||u&&(d.docChanged||d.selection)||xx(f,c)){let m=r(f);if(l?!TL(m,f.values[a],n):!n(m,f.values[a]))return f.values[a]=m,1}return 0},reconfigure:(f,d)=>{let m,p=d.config.address[o];if(p!=null){let v=eg(d,p);if(this.dependencies.every(g=>g instanceof Ve?d.facet(g)===f.facet(g):g instanceof Zi?d.field(g,!1)==f.field(g,!1):!0)||(l?TL(m=r(f),v,n):n(m=r(f),v)))return f.values[a]=v,0}else m=r(f);return f.values[a]=m,1}}}};function TL(t,e,i){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1;return!0}function xx(t,e){let i=!1;for(let r of e)hc(t,r)&1&&(i=!0);return i}function W6(t,e,i){let r=i.map(h=>t[h.id]),n=i.map(h=>h.type),o=r.filter(h=>!(h&1)),a=t[e.id]>>1;function l(h){let u=[];for(let c=0;c<r.length;c++){let f=eg(h,r[c]);if(n[c]==2)for(let d of f)u.push(d);else u.push(f)}return e.combine(u)}return{create(h){for(let u of r)hc(h,u);return h.values[a]=l(h),1},update(h,u){if(!xx(h,o))return 0;let c=l(h);return e.compare(c,h.values[a])?0:(h.values[a]=c,1)},reconfigure(h,u){let c=xx(h,r),f=u.config.facets[e.id],d=u.facet(e);if(f&&!c&&Rx(i,f))return h.values[a]=d,0;let m=l(h);return e.compare(m,d)?(h.values[a]=d,0):(h.values[a]=m,1)}}}var AL=Ve.define({static:!0}),Zi=class t{constructor(e,i,r,n,o){this.id=e,this.createF=i,this.updateF=r,this.compareF=n,this.spec=o,this.provides=void 0}static define(e){let i=new t(Px++,e.create,e.update,e.compare||((r,n)=>r===n),e);return e.provide&&(i.provides=e.provide(i)),i}create(e){let i=e.facet(AL).find(r=>r.field==this);return((i==null?void 0:i.create)||this.createF)(e)}slot(e){let i=e[this.id]>>1;return{create:r=>(r.values[i]=this.create(r),1),update:(r,n)=>{let o=r.values[i],a=this.updateF(o,n);return this.compareF(o,a)?0:(r.values[i]=a,1)},reconfigure:(r,n)=>n.config.address[this.id]!=null?(r.values[i]=n.field(this),0):(r.values[i]=this.create(r),1)}}init(e){return[this,AL.of({field:this,create:e})]}get extension(){return this}},Xa={lowest:4,low:3,default:2,high:1,highest:0};function lc(t){return e=>new Jm(e,t)}var Os={highest:lc(Xa.highest),high:lc(Xa.high),default:lc(Xa.default),low:lc(Xa.low),lowest:lc(Xa.lowest)},Jm=class{constructor(e,i){this.inner=e,this.prec=i}},hh=class t{of(e){return new uc(this,e)}reconfigure(e){return t.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}},uc=class{constructor(e,i){this.compartment=e,this.inner=i}},$m=class t{constructor(e,i,r,n,o,a){for(this.base=e,this.compartments=i,this.dynamicSlots=r,this.address=n,this.staticValues=o,this.facets=a,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let i=this.address[e.id];return i==null?e.default:this.staticValues[i>>1]}static resolve(e,i,r){let n=[],o=Object.create(null),a=new Map;for(let d of V6(e,i,a))d instanceof Zi?n.push(d):(o[d.facet.id]||(o[d.facet.id]=[])).push(d);let l=Object.create(null),h=[],u=[];for(let d of n)l[d.id]=u.length<<1,u.push(m=>d.slot(m));let c=r==null?void 0:r.config.facets;for(let d in o){let m=o[d],p=m[0].facet,v=c&&c[d]||[];if(m.every(g=>g.type==0))if(l[p.id]=h.length<<1|1,Rx(v,m))h.push(r.facet(p));else{let g=p.combine(m.map(_=>_.value));h.push(r&&p.compare(g,r.facet(p))?r.facet(p):g)}else{for(let g of m)g.type==0?(l[g.id]=h.length<<1|1,h.push(g.value)):(l[g.id]=u.length<<1,u.push(_=>g.dynamicSlot(_)));l[p.id]=u.length<<1,u.push(g=>W6(g,p,m))}}let f=u.map(d=>d(l));return new t(e,a,f,l,h,o)}};function V6(t,e,i){let r=[[],[],[],[],[]],n=new Map;function o(a,l){let h=n.get(a);if(h!=null){if(h<=l)return;let u=r[h].indexOf(a);u>-1&&r[h].splice(u,1),a instanceof uc&&i.delete(a.compartment)}if(n.set(a,l),Array.isArray(a))for(let u of a)o(u,l);else if(a instanceof uc){if(i.has(a.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(a.compartment)||a.inner;i.set(a.compartment,u),o(u,l)}else if(a instanceof Jm)o(a.inner,a.prec);else if(a instanceof Zi)r[l].push(a),a.provides&&o(a.provides,l);else if(a instanceof oh)r[l].push(a),a.facet.extensions&&o(a.facet.extensions,Xa.default);else{let u=a.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${a}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(u,l)}}return o(t,Xa.default),r.reduce((a,l)=>a.concat(l))}function hc(t,e){if(e&1)return 2;let i=e>>1,r=t.status[i];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function eg(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}var BL=Ve.define(),bx=Ve.define({combine:t=>t.some(e=>e),static:!0}),NL=Ve.define({combine:t=>t.length?t[0]:void 0,static:!0}),UL=Ve.define(),zL=Ve.define(),GL=Ve.define(),HL=Ve.define({combine:t=>t.length?t[0]:!1}),Kr=class{constructor(e,i){this.type=e,this.value=i}static define(){return new wx}},wx=class{of(e){return new Kr(this,e)}},Sx=class{constructor(e){this.map=e}of(e){return new Dt(this,e)}},Dt=class t{constructor(e,i){this.type=e,this.value=i}map(e){let i=this.type.map(this.value,e);return i===void 0?void 0:i==this.value?this:new t(this.type,i)}is(e){return this.type==e}static define(e={}){return new Sx(e.map||(i=>i))}static mapEffects(e,i){if(!e.length)return e;let r=[];for(let n of e){let o=n.map(i);o&&r.push(o)}return r}};Dt.reconfigure=Dt.define();Dt.appendConfig=Dt.define();var Yi=class t{constructor(e,i,r,n,o,a){this.startState=e,this.changes=i,this.selection=r,this.effects=n,this.annotations=o,this.scrollIntoView=a,this._doc=null,this._state=null,r&&FL(r,i.newLength),o.some(l=>l.type==t.time)||(this.annotations=o.concat(t.time.of(Date.now())))}static create(e,i,r,n,o,a){return new t(e,i,r,n,o,a)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let i of this.annotations)if(i.type==e)return i.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let i=this.annotation(t.userEvent);return!!(i&&(i==e||i.length>e.length&&i.slice(0,e.length)==e&&i[e.length]=="."))}};Yi.time=Kr.define();Yi.userEvent=Kr.define();Yi.addToHistory=Kr.define();Yi.remote=Kr.define();function j6(t,e){let i=[];for(let r=0,n=0;;){let o,a;if(r<t.length&&(n==e.length||e[n]>=t[r]))o=t[r++],a=t[r++];else if(n<e.length)o=e[n++],a=e[n++];else return i;!i.length||i[i.length-1]<o?i.push(o,a):i[i.length-1]<a&&(i[i.length-1]=a)}}function WL(t,e,i){var r;let n,o,a;return i?(n=e.changes,o=Or.empty(e.changes.length),a=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),o=t.changes.mapDesc(e.changes,!0),a=t.changes.compose(n)),{changes:a,selection:e.selection?e.selection.map(o):(r=t.selection)===null||r===void 0?void 0:r.map(n),effects:Dt.mapEffects(t.effects,n).concat(Dt.mapEffects(e.effects,o)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Cx(t,e,i){let r=e.selection,n=ah(e.annotations);return e.userEvent&&(n=n.concat(Yi.userEvent.of(e.userEvent))),{changes:e.changes instanceof Or?e.changes:Or.of(e.changes||[],i,t.facet(NL)),selection:r&&(r instanceof ge?r:ge.single(r.anchor,r.head)),effects:ah(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function VL(t,e,i){let r=Cx(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(i=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(i=!1);let a=!!e[o].sequential;r=WL(r,Cx(t,e[o],a?r.changes.newLength:t.doc.length),a)}let n=Yi.create(t,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return X6(i?q6(n):n)}function q6(t){let e=t.startState,i=!0;for(let n of e.facet(UL)){let o=n(t);if(o===!1){i=!1;break}Array.isArray(o)&&(i=i===!0?o:j6(i,o))}if(i!==!0){let n,o;if(i===!1)o=t.changes.invertedDesc,n=Or.empty(e.doc.length);else{let a=t.changes.filter(i);n=a.changes,o=a.filtered.mapDesc(a.changes).invertedDesc}t=Yi.create(e,n,t.selection&&t.selection.map(o),Dt.mapEffects(t.effects,o),t.annotations,t.scrollIntoView)}let r=e.facet(zL);for(let n=r.length-1;n>=0;n--){let o=r[n](t);o instanceof Yi?t=o:Array.isArray(o)&&o.length==1&&o[0]instanceof Yi?t=o[0]:t=VL(e,ah(o),!1)}return t}function X6(t){let e=t.startState,i=e.facet(GL),r=t;for(let n=i.length-1;n>=0;n--){let o=i[n](t);o&&Object.keys(o).length&&(r=WL(r,Cx(e,o,t.changes.newLength),!0))}return r==t?t:Yi.create(e,t.changes,t.selection,r.effects,r.annotations,r.scrollIntoView)}var Y6=[];function ah(t){return t==null?Y6:Array.isArray(t)?t:[t]}var Jt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Jt||(Jt={})),Z6=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Ex;try{Ex=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function K6(t){if(Ex)return Ex.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>"\x80"&&(i.toUpperCase()!=i.toLowerCase()||Z6.test(i)))return!0}return!1}function Q6(t){return e=>{if(!/\S/.test(e))return Jt.Space;if(K6(e))return Jt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return Jt.Word;return Jt.Other}}var Nt=class t{constructor(e,i,r,n,o,a){this.config=e,this.doc=i,this.selection=r,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=o,a&&(a._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)hc(this,l<<1);this.computeSlot=null}field(e,i=!0){let r=this.config.address[e.id];if(r==null){if(i)throw new RangeError("Field is not present in this state");return}return hc(this,r),eg(this,r)}update(...e){return VL(this,e,!0)}applyTransaction(e){let i=this.config,{base:r,compartments:n}=i;for(let l of e.effects)l.is(hh.reconfigure)?(i&&(n=new Map,i.compartments.forEach((h,u)=>n.set(u,h)),i=null),n.set(l.value.compartment,l.value.extension)):l.is(Dt.reconfigure)?(i=null,r=l.value):l.is(Dt.appendConfig)&&(i=null,r=ah(r).concat(l.value));let o;i?o=e.startState.values.slice():(i=$m.resolve(r,n,this),o=new t(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(h,u)=>u.reconfigure(h,this),null).values);let a=e.startState.facet(bx)?e.newSelection:e.newSelection.asSingle();new t(i,e.newDoc,a,o,(l,h)=>h.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:e},range:ge.cursor(i.from+e.length)}))}changeByRange(e){let i=this.selection,r=e(i.ranges[0]),n=this.changes(r.changes),o=[r.range],a=ah(r.effects);for(let l=1;l<i.ranges.length;l++){let h=e(i.ranges[l]),u=this.changes(h.changes),c=u.map(n);for(let d=0;d<l;d++)o[d]=o[d].map(c);let f=n.mapDesc(u,!0);o.push(h.range.map(f)),n=n.compose(c),a=Dt.mapEffects(a,c).concat(Dt.mapEffects(ah(h.effects),f))}return{changes:n,selection:ge.create(o,i.mainIndex),effects:a}}changes(e=[]){return e instanceof Or?e:Or.of(e,this.doc.length,this.facet(t.lineSeparator))}toText(e){return zt.of(e.split(this.facet(t.lineSeparator)||vx))}sliceDoc(e=0,i=this.doc.length){return this.doc.sliceString(e,i,this.lineBreak)}facet(e){let i=this.config.address[e.id];return i==null?e.default:(hc(this,i),eg(this,i))}toJSON(e){let i={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let n=e[r];n instanceof Zi&&this.config.address[n.id]!=null&&(i[r]=n.spec.toJSON(this.field(e[r]),this))}return i}static fromJSON(e,i={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(r){for(let o in r)if(Object.prototype.hasOwnProperty.call(e,o)){let a=r[o],l=e[o];n.push(a.init(h=>a.spec.fromJSON(l,h)))}}return t.create({doc:e.doc,selection:ge.fromJSON(e.selection),extensions:i.extensions?n.concat([i.extensions]):n})}static create(e={}){let i=$m.resolve(e.extensions||[],new Map),r=e.doc instanceof zt?e.doc:zt.of((e.doc||"").split(i.staticFacet(t.lineSeparator)||vx)),n=e.selection?e.selection instanceof ge?e.selection:ge.single(e.selection.anchor,e.selection.head):ge.single(0);return FL(n,r.length),i.staticFacet(bx)||(n=n.asSingle()),new t(i,r,n,i.dynamicSlots.map(()=>null),(o,a)=>a.create(o),null)}get tabSize(){return this.facet(t.tabSize)}get lineBreak(){return this.facet(t.lineSeparator)||`
`}get readOnly(){return this.facet(HL)}phrase(e,...i){for(let r of this.facet(t.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return i.length&&(e=e.replace(/\$(\$|\d*)/g,(r,n)=>{if(n=="$")return"$";let o=+(n||1);return!o||o>i.length?r:i[o-1]})),e}languageDataAt(e,i,r=-1){let n=[];for(let o of this.facet(BL))for(let a of o(this,i,r))Object.prototype.hasOwnProperty.call(a,e)&&n.push(a[e]);return n}charCategorizer(e){return Q6(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:i,from:r,length:n}=this.doc.lineAt(e),o=this.charCategorizer(e),a=e-r,l=e-r;for(;a>0;){let h=Ni(i,a,!1);if(o(i.slice(h,a))!=Jt.Word)break;a=h}for(;l<n;){let h=Ni(i,l);if(o(i.slice(l,h))!=Jt.Word)break;l=h}return a==l?null:ge.range(a+r,l+r)}};Nt.allowMultipleSelections=bx;Nt.tabSize=Ve.define({combine:t=>t.length?t[0]:4});Nt.lineSeparator=NL;Nt.readOnly=HL;Nt.phrases=Ve.define({compare(t,e){let i=Object.keys(t),r=Object.keys(e);return i.length==r.length&&i.every(n=>t[n]==e[n])}});Nt.languageData=BL;Nt.changeFilter=UL;Nt.transactionFilter=zL;Nt.transactionExtender=GL;hh.reconfigure=Dt.define();function Qr(t,e,i={}){let r={};for(let n of t)for(let o of Object.keys(n)){let a=n[o],l=r[o];if(l===void 0)r[o]=a;else if(!(l===a||a===void 0))if(Object.hasOwnProperty.call(i,o))r[o]=i[o](l,a);else throw new Error("Config merge conflict for field "+o)}for(let n in e)r[n]===void 0&&(r[n]=e[n]);return r}var ss=class{eq(e){return this==e}range(e,i=e){return cc.create(e,i,this)}};ss.prototype.startSide=ss.prototype.endSide=0;ss.prototype.point=!1;ss.prototype.mapMode=yr.TrackDel;var cc=class t{constructor(e,i,r){this.from=e,this.to=i,this.value=r}static create(e,i,r){return new t(e,i,r)}};function Mx(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}var Tx=class t{constructor(e,i,r,n){this.from=e,this.to=i,this.value=r,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,i,r,n=0){let o=r?this.to:this.from;for(let a=n,l=o.length;;){if(a==l)return a;let h=a+l>>1,u=o[h]-e||(r?this.value[h].endSide:this.value[h].startSide)-i;if(h==a)return u>=0?a:l;u>=0?l=h:a=h+1}}between(e,i,r,n){for(let o=this.findIndex(i,-1e9,!0),a=this.findIndex(r,1e9,!1,o);o<a;o++)if(n(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,i){let r=[],n=[],o=[],a=-1,l=-1;for(let h=0;h<this.value.length;h++){let u=this.value[h],c=this.from[h]+e,f=this.to[h]+e,d,m;if(c==f){let p=i.mapPos(c,u.startSide,u.mapMode);if(p==null||(d=m=p,u.startSide!=u.endSide&&(m=i.mapPos(c,u.endSide),m<d)))continue}else if(d=i.mapPos(c,u.startSide),m=i.mapPos(f,u.endSide),d>m||d==m&&u.startSide>0&&u.endSide<=0)continue;(m-d||u.endSide-u.startSide)<0||(a<0&&(a=d),u.point&&(l=Math.max(l,m-d)),r.push(u),n.push(d-a),o.push(m-a))}return{mapped:r.length?new t(n,o,r,l):null,pos:a}}},Xt=class t{constructor(e,i,r,n){this.chunkPos=e,this.chunk=i,this.nextLayer=r,this.maxPoint=n}static create(e,i,r,n){return new t(e,i,r,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let i of this.chunk)e+=i.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:i=[],sort:r=!1,filterFrom:n=0,filterTo:o=this.length}=e,a=e.filter;if(i.length==0&&!a)return this;if(r&&(i=i.slice().sort(Mx)),this.isEmpty)return i.length?t.of(i):this;let l=new tg(this,null,-1).goto(0),h=0,u=[],c=new os;for(;l.value||h<i.length;)if(h<i.length&&(l.from-i[h].from||l.startSide-i[h].value.startSide)>=0){let f=i[h++];c.addInner(f.from,f.to,f.value)||u.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==i.length||this.chunkEnd(l.chunkIndex)<i[h].from)&&(!a||n>this.chunkEnd(l.chunkIndex)||o<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!a||n>l.to||o<l.from||a(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||u.push(cc.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!u.length?t.empty:this.nextLayer.update({add:u,filter:a,filterFrom:n,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let i=[],r=[],n=-1;for(let a=0;a<this.chunk.length;a++){let l=this.chunkPos[a],h=this.chunk[a],u=e.touchesRange(l,l+h.length);if(u===!1)n=Math.max(n,h.maxPoint),i.push(h),r.push(e.mapPos(l));else if(u===!0){let{mapped:c,pos:f}=h.map(l,e);c&&(n=Math.max(n,c.maxPoint),i.push(c),r.push(f))}}let o=this.nextLayer.map(e);return i.length==0?o:new t(r,i,o||t.empty,n)}between(e,i,r){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let o=this.chunkPos[n],a=this.chunk[n];if(i>=o&&e<=o+a.length&&a.between(o,e-o,i-o,r)===!1)return}this.nextLayer.between(e,i,r)}}iter(e=0){return fc.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,i=0){return fc.from(e).goto(i)}static compare(e,i,r,n,o=-1){let a=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=o),l=i.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=o),h=PL(a,l,r),u=new Ya(a,h,o),c=new Ya(l,h,o);r.iterGaps((f,d,m)=>RL(u,f,c,d,m,n)),r.empty&&r.length==0&&RL(u,0,c,0,0,n)}static eq(e,i,r=0,n){n==null&&(n=999999999);let o=e.filter(c=>!c.isEmpty&&i.indexOf(c)<0),a=i.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(o.length!=a.length)return!1;if(!o.length)return!0;let l=PL(o,a),h=new Ya(o,l,0).goto(r),u=new Ya(a,l,0).goto(r);for(;;){if(h.to!=u.to||!Ax(h.active,u.active)||h.point&&(!u.point||!h.point.eq(u.point)))return!1;if(h.to>n)return!0;h.next(),u.next()}}static spans(e,i,r,n,o=-1){let a=new Ya(e,null,o).goto(i),l=i,h=a.openStart;for(;;){let u=Math.min(a.to,r);if(a.point){let c=a.activeForPoint(a.to),f=a.pointFrom<i?c.length+1:Math.min(c.length,h);n.point(l,u,a.point,c,f,a.pointRank),h=Math.min(a.openEnd(u),c.length)}else u>l&&(n.span(l,u,a.active,h),h=a.openEnd(u));if(a.to>r)return h+(a.point&&a.to>r?1:0);l=a.to,a.next()}}static of(e,i=!1){let r=new os;for(let n of e instanceof cc?[e]:i?J6(e):e)r.add(n.from,n.to,n.value);return r.finish()}static join(e){if(!e.length)return t.empty;let i=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let n=e[r];n!=t.empty;n=n.nextLayer)i=new t(n.chunkPos,n.chunk,i,Math.max(n.maxPoint,i.maxPoint));return i}};Xt.empty=new Xt([],[],null,-1);function J6(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let r=t[i];if(Mx(e,r)>0)return t.slice().sort(Mx);e=r}return t}Xt.empty.nextLayer=Xt.empty;var os=class t{finishChunk(e){this.chunks.push(new Tx(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,i,r){this.addInner(e,i,r)||(this.nextLayer||(this.nextLayer=new t)).add(e,i,r)}addInner(e,i,r){let n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(i-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=i,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,i-e)),!0)}addChunk(e,i){if((e-this.lastTo||i.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,i.maxPoint),this.chunks.push(i),this.chunkPos.push(e);let r=i.value.length-1;return this.last=i.value[r],this.lastFrom=i.from[r]+e,this.lastTo=i.to[r]+e,!0}finish(){return this.finishInner(Xt.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let i=Xt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,i}};function PL(t,e,i){let r=new Map;for(let o of t)for(let a=0;a<o.chunk.length;a++)o.chunk[a].maxPoint<=0&&r.set(o.chunk[a],o.chunkPos[a]);let n=new Set;for(let o of e)for(let a=0;a<o.chunk.length;a++){let l=r.get(o.chunk[a]);l!=null&&(i?i.mapPos(l):l)==o.chunkPos[a]&&!(i!=null&&i.touchesRange(l,l+o.chunk[a].length))&&n.add(o.chunk[a])}return n}var tg=class{constructor(e,i,r,n=0){this.layer=e,this.skip=i,this.minPoint=r,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,i=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,i,!1),this}gotoInner(e,i,r){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],i,!0);(!r||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,i){(this.to-e||this.endSide-i)<0&&this.gotoInner(e,i,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],i=this.layer.chunk[this.chunkIndex],r=e+i.from[this.rangeIndex];if(this.from=r,this.to=e+i.to[this.rangeIndex],this.value=i.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},fc=class t{constructor(e){this.heap=e}static from(e,i=null,r=-1){let n=[];for(let o=0;o<e.length;o++)for(let a=e[o];!a.isEmpty;a=a.nextLayer)a.maxPoint>=r&&n.push(new tg(a,i,r,o));return n.length==1?n[0]:new t(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,i=-1e9){for(let r of this.heap)r.goto(e,i);for(let r=this.heap.length>>1;r>=0;r--)mx(this.heap,r);return this.next(),this}forward(e,i){for(let r of this.heap)r.forward(e,i);for(let r=this.heap.length>>1;r>=0;r--)mx(this.heap,r);(this.to-e||this.value.endSide-i)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),mx(this.heap,0)}}};function mx(t,e){for(let i=t[e];;){let r=(e<<1)+1;if(r>=t.length)break;let n=t[r];if(r+1<t.length&&n.compare(t[r+1])>=0&&(n=t[r+1],r++),i.compare(n)<0)break;t[r]=i,t[e]=n,e=r}}var Ya=class{constructor(e,i,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=fc.from(e,i,r)}goto(e,i=-1e9){return this.cursor.goto(e,i),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=i,this.openStart=-1,this.next(),this}forward(e,i){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-i)<0;)this.removeActive(this.minActive);this.cursor.forward(e,i)}removeActive(e){Xm(this.active,e),Xm(this.activeTo,e),Xm(this.activeRank,e),this.minActive=LL(this.active,this.activeTo)}addActive(e){let i=0,{value:r,to:n,rank:o}=this.cursor;for(;i<this.activeRank.length&&(o-this.activeRank[i]||n-this.activeTo[i])>0;)i++;Ym(this.active,i,r),Ym(this.activeTo,i,n),Ym(this.activeRank,i,o),e&&Ym(e,i,this.cursor.from),this.minActive=LL(this.active,this.activeTo)}next(){let e=this.to,i=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),r&&Xm(r,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(r),this.cursor.next();else if(i&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let n=r.length-1;n>=0&&r[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let i=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&i.push(this.active[r]);return i.reverse()}openEnd(e){let i=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)i++;return i}};function RL(t,e,i,r,n,o){t.goto(e),i.goto(r);let a=r+n,l=r,h=r-e;for(;;){let u=t.to+h-i.to||t.endSide-i.endSide,c=u<0?t.to+h:i.to,f=Math.min(c,a);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&Ax(t.activeForPoint(t.to),i.activeForPoint(i.to))||o.comparePoint(l,f,t.point,i.point):f>l&&!Ax(t.active,i.active)&&o.compareRange(l,f,t.active,i.active),c>a)break;l=c,u<=0&&t.next(),u>=0&&i.next()}}function Ax(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function Xm(t,e){for(let i=e,r=t.length-1;i<r;i++)t[i]=t[i+1];t.pop()}function Ym(t,e,i){for(let r=t.length-1;r>=e;r--)t[r+1]=t[r];t[e]=i}function LL(t,e){let i=-1,r=1e9;for(let n=0;n<e.length;n++)(e[n]-r||t[n].endSide-t[i].endSide)<0&&(i=n,r=e[n]);return i}function mo(t,e,i=t.length){let r=0;for(let n=0;n<i;)t.charCodeAt(n)==9?(r+=e-r%e,n++):(r++,n=Ni(t,n));return r}function ig(t,e,i,r){for(let n=0,o=0;;){if(o>=e)return n;if(n==t.length)break;o+=t.charCodeAt(n)==9?i-o%i:1,n=Ni(t,n)}return r===!0?-1:t.length}var Lx="\u037C",jL=typeof Symbol=="undefined"?"__"+Lx:Symbol.for(Lx),Ox=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),qL=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{},go=class{constructor(e,i){this.rules=[];let{finish:r}=i||{};function n(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function o(a,l,h,u){let c=[],f=/^@(\w+)\b/.exec(a[0]),d=f&&f[1]=="keyframes";if(f&&l==null)return h.push(a[0]+";");for(let m in l){let p=l[m];if(/&/.test(m))o(m.split(/,\s*/).map(v=>a.map(g=>v.replace(/&/,g))).reduce((v,g)=>v.concat(g)),p,h);else if(p&&typeof p=="object"){if(!f)throw new RangeError("The value of a property ("+m+") should be a primitive value.");o(n(m),p,c,d)}else p!=null&&c.push(m.replace(/_.*/,"").replace(/[A-Z]/g,v=>"-"+v.toLowerCase())+": "+p+";")}(c.length||d)&&h.push((r&&!f&&!u?a.map(r):a).join(", ")+" {"+c.join(" ")+"}")}for(let a in e)o(n(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=qL[jL]||1;return qL[jL]=e+1,Lx+e.toString(36)}static mount(e,i,r){let n=e[Ox],o=r&&r.nonce;n?o&&n.setNonce(o):n=new Dx(e,o),n.mount(Array.isArray(i)?i:[i])}},XL=new Map,Dx=class{constructor(e,i){let r=e.ownerDocument||e,n=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let o=XL.get(r);if(o)return e.adoptedStyleSheets=[o.sheet,...e.adoptedStyleSheets],e[Ox]=o;this.sheet=new n.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],XL.set(r,this)}else{this.styleTag=r.createElement("style"),i&&this.styleTag.setAttribute("nonce",i);let o=e.head||e;o.insertBefore(this.styleTag,o.firstChild)}this.modules=[],e[Ox]=this}mount(e){let i=this.sheet,r=0,n=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,a),i)for(let h=0;h<a.rules.length;h++)i.insertRule(a.rules[h],r++)}else{for(;n<l;)r+=this.modules[n++].rules.length;r+=a.rules.length,n++}}if(!i){let o="";for(let a=0;a<this.modules.length;a++)o+=this.modules[a].getRules()+`
`;this.styleTag.textContent=o}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}};var vo={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},uh={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},YL=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),iSe=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),$6=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),e8=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),t8=$6||YL&&+YL[1]<57;for(Ui=0;Ui<10;Ui++)vo[48+Ui]=vo[96+Ui]=String(Ui);var Ui;for(Ui=1;Ui<=24;Ui++)vo[Ui+111]="F"+Ui;var Ui;for(Ui=65;Ui<=90;Ui++)vo[Ui]=String.fromCharCode(Ui+32),uh[Ui]=String.fromCharCode(Ui);var Ui;for(rg in vo)uh.hasOwnProperty(rg)||(uh[rg]=vo[rg]);var rg;function ZL(t){var e=t8&&(t.ctrlKey||t.altKey||t.metaKey)||e8&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",i=!e&&t.key||(t.shiftKey?uh:vo)[t.keyCode]||t.key||"Unidentified";return i=="Esc"&&(i="Escape"),i=="Del"&&(i="Delete"),i=="Left"&&(i="ArrowLeft"),i=="Up"&&(i="ArrowUp"),i=="Right"&&(i="ArrowRight"),i=="Down"&&(i="ArrowDown"),i}function _g(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function Gx(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function i8(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function fg(t,e){if(!e.anchorNode)return!1;try{return Gx(t,e.anchorNode)}catch(i){return!1}}function Mc(t){return t.nodeType==3?Qa(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function yc(t,e,i,r){return i?KL(t,e,i,r,-1)||KL(t,e,i,r,1):!1}function Tc(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function KL(t,e,i,r,n){for(;;){if(t==i&&e==r)return!0;if(e==(n<0?0:_o(t))){if(t.nodeName=="DIV")return!1;let o=t.parentNode;if(!o||o.nodeType!=1)return!1;e=Tc(t)+(n<0?0:1),t=o}else if(t.nodeType==1){if(t=t.childNodes[e+(n<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=n<0?_o(t):0}else return!1}}function _o(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ab(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function r8(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function FO(t,e){let i=e.width/t.offsetWidth,r=e.height/t.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.width-t.offsetWidth)<1)&&(i=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-t.offsetHeight)<1)&&(r=1),{scaleX:i,scaleY:r}}function n8(t,e,i,r,n,o,a,l){let h=t.ownerDocument,u=h.defaultView||window;for(let c=t,f=!1;c&&!f;)if(c.nodeType==1){let d,m=c==h.body,p=1,v=1;if(m)d=r8(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(f=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let x=c.getBoundingClientRect();({scaleX:p,scaleY:v}=FO(c,x)),d={left:x.left,right:x.left+c.clientWidth*p,top:x.top,bottom:x.top+c.clientHeight*v}}let g=0,_=0;if(n=="nearest")e.top<d.top?(_=-(d.top-e.top+a),i>0&&e.bottom>d.bottom+_&&(_=e.bottom-d.bottom+_+a)):e.bottom>d.bottom&&(_=e.bottom-d.bottom+a,i<0&&e.top-_<d.top&&(_=-(d.top+_-e.top+a)));else{let x=e.bottom-e.top,b=d.bottom-d.top;_=(n=="center"&&x<=b?e.top+x/2-b/2:n=="start"||n=="center"&&i<0?e.top-a:e.bottom-b+a)-d.top}if(r=="nearest"?e.left<d.left?(g=-(d.left-e.left+o),i>0&&e.right>d.right+g&&(g=e.right-d.right+g+o)):e.right>d.right&&(g=e.right-d.right+o,i<0&&e.left<d.left+g&&(g=-(d.left+g-e.left+o))):g=(r=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:r=="start"==l?e.left-o:e.right-(d.right-d.left)+o)-d.left,g||_)if(m)u.scrollBy(g,_);else{let x=0,b=0;if(_){let y=c.scrollTop;c.scrollTop+=_/v,b=(c.scrollTop-y)*v}if(g){let y=c.scrollLeft;c.scrollLeft+=g/p,x=(c.scrollLeft-y)*p}e={left:e.left-x,top:e.top-b,right:e.right-x,bottom:e.bottom-b},x&&Math.abs(x-g)<1&&(r="nearest"),b&&Math.abs(b-_)<1&&(n="nearest")}if(m)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function s8(t){let e=t.ownerDocument;for(let i=t.parentNode;i&&i!=e.body;)if(i.nodeType==1){if(i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth)return i;i=i.assignedSlot||i.parentNode}else if(i.nodeType==11)i=i.host;else break;return null}var Hx=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:i,focusNode:r}=e;this.set(i,Math.min(e.anchorOffset,i?_o(i):0),r,Math.min(e.focusOffset,r?_o(r):0))}set(e,i,r,n){this.anchorNode=e,this.anchorOffset=i,this.focusNode=r,this.focusOffset=n}},ch=null;function BO(t){if(t.setActive)return t.setActive();if(ch)return t.focus(ch);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(ch==null?{get preventScroll(){return ch={preventScroll:!0},!0}}:void 0),!ch){ch=!1;for(let i=0;i<e.length;){let r=e[i++],n=e[i++],o=e[i++];r.scrollTop!=n&&(r.scrollTop=n),r.scrollLeft!=o&&(r.scrollLeft=o)}}}var QL;function Qa(t,e,i=e){let r=QL||(QL=document.createRange());return r.setEnd(t,i),r.setStart(t,e),r}function mh(t,e,i){let r={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",r);n.synthetic=!0,t.dispatchEvent(n);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,t.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function o8(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function NO(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function a8(t,e){let i=e.focusNode,r=e.focusOffset;if(!i||e.anchorNode!=i||e.anchorOffset!=r)return!1;for(r=Math.min(r,_o(i));;)if(r){if(i.nodeType!=1)return!1;let n=i.childNodes[r-1];n.contentEditable=="false"?r--:(i=n,r=_o(i))}else{if(i==t)return!0;r=Tc(i),i=i.parentNode}}function UO(t){return t.scrollTop>Math.max(1,t.scrollHeight-t.clientHeight-4)}var Dr=class t{constructor(e,i,r=!0){this.node=e,this.offset=i,this.precise=r}static before(e,i){return new t(e.parentNode,Tc(e),i)}static after(e,i){return new t(e.parentNode,Tc(e)+1,i)}},Pb=[],hi=class t{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let i=this.posAtStart;for(let r of this.children){if(r==e)return i;i+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,i){if(this.flags&2){let r=this.dom,n=null,o;for(let a of this.children){if(a.flags&7){if(!a.dom&&(o=n?n.nextSibling:r.firstChild)){let l=t.get(o);(!l||!l.parent&&l.canReuseDOM(a))&&a.reuseDOM(o)}a.sync(e,i),a.flags&=-8}if(o=n?n.nextSibling:r.firstChild,i&&!i.written&&i.node==r&&o!=a.dom&&(i.written=!0),a.dom.parentNode==r)for(;o&&o!=a.dom;)o=JL(o);else r.insertBefore(a.dom,o);n=a.dom}for(o=n?n.nextSibling:r.firstChild,o&&i&&i.node==r&&(i.written=!0);o;)o=JL(o)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,i),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,i){let r;if(e==this.dom)r=this.dom.childNodes[i];else{let n=_o(e)==0?0:i==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;n==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?n=-1:n=1),e=o}n<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!t.get(r);)r=r.nextSibling;if(!r)return this.length;for(let n=0,o=0;;n++){let a=this.children[n];if(a.dom==r)return o;o+=a.length+a.breakAfter}}domBoundsAround(e,i,r=0){let n=-1,o=-1,a=-1,l=-1;for(let h=0,u=r,c=r;h<this.children.length;h++){let f=this.children[h],d=u+f.length;if(u<e&&d>i)return f.domBoundsAround(e,i,u);if(d>=e&&n==-1&&(n=h,o=u),u>i&&f.dom.parentNode==this.dom){a=h,l=c;break}c=d,u=d+f.breakAfter}return{from:o,to:l<0?r+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&a>=0?this.children[a].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let i=this.parent;i;i=i.parent){if(e&&(i.flags|=2),i.flags&1)return;i.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let i=e.parent;if(!i)return e;e=i}}replaceChildren(e,i,r=Pb){this.markDirty();for(let n=e;n<i;n++){let o=this.children[n];o.parent==this&&r.indexOf(o)<0&&o.destroy()}this.children.splice(e,i-e,...r);for(let n=0;n<r.length;n++)r[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new yg(this.children,e,this.children.length)}childPos(e,i=1){return this.childCursor().findPos(e,i)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,i,r,n,o,a){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}};hi.prototype.breakAfter=0;function JL(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}var yg=class{constructor(e,i,r){this.children=e,this.pos=i,this.i=r,this.off=0}findPos(e,i=1){for(;;){if(e>this.pos||e==this.pos&&(i>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}};function zO(t,e,i,r,n,o,a,l,h){let{children:u}=t,c=u.length?u[e]:null,f=o.length?o[o.length-1]:null,d=f?f.breakAfter:a;if(!(e==r&&c&&!a&&!d&&o.length<2&&c.merge(i,n,o.length?f:null,i==0,l,h))){if(r<u.length){let m=u[r];m&&(n<m.length||m.breakAfter&&(f!=null&&f.breakAfter))?(e==r&&(m=m.split(n),n=0),!d&&f&&m.merge(0,n,f,!0,0,h)?o[o.length-1]=m:((n||m.children.length&&!m.children[0].length)&&m.merge(0,n,null,!1,0,h),o.push(m))):m!=null&&m.breakAfter&&(f?f.breakAfter=1:a=1),r++}for(c&&(c.breakAfter=a,i>0&&(!a&&o.length&&c.merge(i,c.length,o[0],!1,l,0)?c.breakAfter=o.shift().breakAfter:(i<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(i,c.length,null,!1,l,0),e++));e<r&&o.length;)if(u[r-1].become(o[o.length-1]))r--,o.pop(),h=o.length?0:l;else if(u[e].become(o[0]))e++,o.shift(),l=o.length?0:h;else break;!o.length&&e&&r<u.length&&!u[e-1].breakAfter&&u[r].merge(0,0,u[e-1],!1,l,h)&&e--,(e<r||o.length)&&t.replaceChildren(e,r,o)}}function GO(t,e,i,r,n,o){let a=t.childCursor(),{i:l,off:h}=a.findPos(i,1),{i:u,off:c}=a.findPos(e,-1),f=e-i;for(let d of r)f+=d.length;t.length+=f,zO(t,u,c,l,h,r,0,n,o)}var dn=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},Wx=typeof document!="undefined"?document:{documentElement:{style:{}}},Vx=/Edge\/(\d+)/.exec(dn.userAgent),HO=/MSIE \d/.test(dn.userAgent),jx=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(dn.userAgent),Lg=!!(HO||jx||Vx),$L=!Lg&&/gecko\/(\d+)/i.test(dn.userAgent),Ix=!Lg&&/Chrome\/(\d+)/.exec(dn.userAgent),eO="webkitFontSmoothing"in Wx.documentElement.style,WO=!Lg&&/Apple Computer/.test(dn.vendor),tO=WO&&(/Mobile\/\w+/.test(dn.userAgent)||dn.maxTouchPoints>2),qe={mac:tO||/Mac/.test(dn.platform),windows:/Win/.test(dn.platform),linux:/Linux|X11/.test(dn.platform),ie:Lg,ie_version:HO?Wx.documentMode||6:jx?+jx[1]:Vx?+Vx[1]:0,gecko:$L,gecko_version:$L?+(/Firefox\/(\d+)/.exec(dn.userAgent)||[0,0])[1]:0,chrome:!!Ix,chrome_version:Ix?+Ix[1]:0,ios:tO,android:/Android\b/.test(dn.userAgent),webkit:eO,safari:WO,webkit_version:eO?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Wx.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"},l8=256,ea=class t extends hi{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,i){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(i&&i.node==this.dom&&(i.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,i,r){return this.flags&8||r&&(!(r instanceof t)||this.length-(i-e)+r.length>l8||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(i),this.markDirty(),!0)}split(e){let i=new t(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),i.flags|=this.flags&8,i}localPosFromDOM(e,i){return e==this.dom?i:i?this.text.length:0}domAtPos(e){return new Dr(this.dom,e)}domBoundsAround(e,i,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,i){return h8(this.dom,e,i)}},ta=class t extends hi{constructor(e,i=[],r=0){super(),this.mark=e,this.children=i,this.length=r;for(let n of i)n.setParent(this)}setAttrs(e){if(NO(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let i in this.mark.attrs)e.setAttribute(i,this.mark.attrs[i]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,i){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,i)}merge(e,i,r,n,o,a){return r&&(!(r instanceof t&&r.mark.eq(this.mark))||e&&o<=0||i<this.length&&a<=0)?!1:(GO(this,e,i,r?r.children.slice():[],o-1,a-1),this.markDirty(),!0)}split(e){let i=[],r=0,n=-1,o=0;for(let l of this.children){let h=r+l.length;h>e&&i.push(r<e?l.split(e-r):l),n<0&&r>=e&&(n=o),r=h,o++}let a=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new t(this.mark,i,a)}domAtPos(e){return VO(this,e)}coordsAt(e,i){return qO(this,e,i)}};function h8(t,e,i){let r=t.nodeValue.length;e>r&&(e=r);let n=e,o=e,a=0;e==0&&i<0||e==r&&i>=0?qe.chrome||qe.gecko||(e?(n--,a=1):o<r&&(o++,a=-1)):i<0?n--:o<r&&o++;let l=Qa(t,n,o).getClientRects();if(!l.length)return null;let h=l[(a?a<0:i>=0)?0:l.length-1];return qe.safari&&!a&&h.width==0&&(h=Array.prototype.find.call(l,u=>u.width)||h),a?Ab(h,a<0):h||null}var xg=class t extends hi{static create(e,i,r){return new t(e,i,r)}constructor(e,i,r){super(),this.widget=e,this.length=i,this.side=r,this.prevWidget=null}split(e){let i=t.create(this.widget,this.length-e,this.side);return this.length-=e,i}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,i,r,n,o,a){return r&&(!(r instanceof t)||!this.widget.compare(r.widget)||e>0&&o<=0||i<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-i),!0)}become(e){return e instanceof t&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return zt.empty;let e=this;for(;e.parent;)e=e.parent;let{view:i}=e,r=i&&i.state.doc,n=this.posAtStart;return r?r.slice(n,n+this.length):zt.empty}domAtPos(e){return(this.length?e==0:this.side>0)?Dr.before(this.dom):Dr.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,i){let r=this.widget.coordsAt(this.dom,e,i);if(r)return r;let n=this.dom.getClientRects(),o=null;if(!n.length)return null;let a=this.side?this.side<0:e>0;for(let l=a?n.length-1:0;o=n[l],!(e>0?l==0:l==n.length-1||o.top<o.bottom);l+=a?-1:1);return Ab(o,!a)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Ac=class t extends hi{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof t&&e.side==this.side}split(){return new t(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?Dr.before(this.dom):Dr.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return zt.empty}get isHidden(){return!0}};ea.prototype.children=xg.prototype.children=Ac.prototype.children=Pb;function VO(t,e){let i=t.dom,{children:r}=t,n=0;for(let o=0;n<r.length;n++){let a=r[n],l=o+a.length;if(!(l==o&&a.getSide()<=0)){if(e>o&&e<l&&a.dom.parentNode==i)return a.domAtPos(e-o);if(e<=o)break;o=l}}for(let o=n;o>0;o--){let a=r[o-1];if(a.dom.parentNode==i)return a.domAtPos(a.length)}for(let o=n;o<r.length;o++){let a=r[o];if(a.dom.parentNode==i)return a.domAtPos(0)}return new Dr(i,0)}function jO(t,e,i){let r,{children:n}=t;i>0&&e instanceof ta&&n.length&&(r=n[n.length-1])instanceof ta&&r.mark.eq(e.mark)?jO(r,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function qO(t,e,i){let r=null,n=-1,o=null,a=-1;function l(u,c){for(let f=0,d=0;f<u.children.length&&d<=c;f++){let m=u.children[f],p=d+m.length;p>=c&&(m.children.length?l(m,c-d):(!o||o.isHidden&&i>0)&&(p>c||d==p&&m.getSide()>0)?(o=m,a=c-d):(d<c||d==p&&m.getSide()<0&&!m.isHidden)&&(r=m,n=c-d)),d=p}}l(t,e);let h=(i<0?r:o)||r||o;return h?h.coordsAt(Math.max(0,h==r?n:a),i):u8(t)}function u8(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let i=Mc(e);return i[i.length-1]||null}function qx(t,e){for(let i in t)i=="class"&&e.class?e.class+=" "+t.class:i=="style"&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}var iO=Object.create(null);function Rb(t,e,i){if(t==e)return!0;t||(t=iO),e||(e=iO);let r=Object.keys(t),n=Object.keys(e);if(r.length-(i&&r.indexOf(i)>-1?1:0)!=n.length-(i&&n.indexOf(i)>-1?1:0))return!1;for(let o of r)if(o!=i&&(n.indexOf(o)==-1||t[o]!==e[o]))return!1;return!0}function Xx(t,e,i){let r=!1;if(e)for(let n in e)i&&n in i||(r=!0,n=="style"?t.style.cssText="":t.removeAttribute(n));if(i)for(let n in i)e&&e[n]==i[n]||(r=!0,n=="style"?t.style.cssText=i[n]:t.setAttribute(n,i[n]));return r}function c8(t){let e=Object.create(null);for(let i=0;i<t.attributes.length;i++){let r=t.attributes[i];e[r.name]=r.value}return e}var ur=class t extends hi{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,i,r,n,o,a){if(r){if(!(r instanceof t))return!1;this.dom||r.transferDOM(this)}return n&&this.setDeco(r?r.attrs:null),GO(this,e,i,r?r.children.slice():[],o,a),!0}split(e){let i=new t;if(i.breakAfter=this.breakAfter,this.length==0)return i;let{i:r,off:n}=this.childPos(e);n&&(i.append(this.children[r].split(n),0),this.children[r].merge(n,this.children[r].length,null,!1,0,0),r++);for(let o=r;o<this.children.length;o++)i.append(this.children[o],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,i}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Rb(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,i){jO(this,e,i)}addLineDeco(e){let i=e.spec.attributes,r=e.spec.class;i&&(this.attrs=qx(i,this.attrs||{})),r&&(this.attrs=qx({class:r},this.attrs||{}))}domAtPos(e){return VO(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,i){var r;this.dom?this.flags&4&&(NO(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Xx(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,i);let n=this.dom.lastChild;for(;n&&hi.get(n)instanceof ta;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((r=hi.get(n))===null||r===void 0?void 0:r.isEditable)==!1&&(!qe.ios||!this.children.some(o=>o instanceof ea))){let o=document.createElement("BR");o.cmIgnore=!0,this.dom.appendChild(o)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,i;for(let r of this.children){if(!(r instanceof ea)||/[^ -~]/.test(r.text))return null;let n=Mc(r.dom);if(n.length!=1)return null;e+=n[0].width,i=n[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:i}:null}coordsAt(e,i){let r=qO(this,e,i);if(!this.children.length&&r&&this.parent){let{heightOracle:n}=this.parent.view.viewState,o=r.bottom-r.top;if(Math.abs(o-n.lineHeight)<2&&n.textHeight<o){let a=(o-n.textHeight)/2;return{top:r.top+a,bottom:r.bottom-a,left:r.left,right:r.left}}}return r}become(e){return!1}covers(){return!0}static find(e,i){for(let r=0,n=0;r<e.children.length;r++){let o=e.children[r],a=n+o.length;if(a>=i){if(o instanceof t)return o;if(a>i)break}n=a+o.breakAfter}return null}},gh=class t extends hi{constructor(e,i,r){super(),this.widget=e,this.length=i,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,i,r,n,o,a){return r&&(!(r instanceof t)||!this.widget.compare(r.widget)||e>0&&o<=0||i<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-i),!0)}domAtPos(e){return e==0?Dr.before(this.dom):Dr.after(this.dom,e==this.length)}split(e){let i=this.length-e;this.length=e;let r=new t(this.widget,i,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return Pb}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):zt.empty}domBoundsAround(){return null}become(e){return e instanceof t&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,i){return this.widget.coordsAt(this.dom,e,i)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:i,endSide:r}=this.deco;return i==r?!1:e<0?i<0:r>0}},as=class{eq(e){return!1}updateDOM(e,i){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,i,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}},Ir=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Ir||(Ir={})),yt=class extends ss{constructor(e,i,r,n){super(),this.startSide=e,this.endSide=i,this.widget=r,this.spec=n}get heightRelevant(){return!1}static mark(e){return new Pc(e)}static widget(e){let i=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return i+=r&&!e.inlineOrder?i>0?3e8:-4e8:i>0?1e8:-1e8,new ia(e,i,i,r,e.widget||null,!1)}static replace(e){let i=!!e.block,r,n;if(e.isBlockGap)r=-5e8,n=4e8;else{let{start:o,end:a}=XO(e,i);r=(o?i?-3e8:-1:5e8)-1,n=(a?i?2e8:1:-6e8)+1}return new ia(e,r,n,i,e.widget||null,!0)}static line(e){return new Rc(e)}static set(e,i=!1){return Xt.of(e,i)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};yt.none=Xt.empty;var Pc=class t extends yt{constructor(e){let{start:i,end:r}=XO(e);super(i?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var i,r;return this==e||e instanceof t&&this.tagName==e.tagName&&(this.class||((i=this.attrs)===null||i===void 0?void 0:i.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&Rb(this.attrs,e.attrs,"class")}range(e,i=e){if(e>=i)throw new RangeError("Mark decorations may not be empty");return super.range(e,i)}};Pc.prototype.point=!1;var Rc=class t extends yt{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof t&&this.spec.class==e.spec.class&&Rb(this.spec.attributes,e.spec.attributes)}range(e,i=e){if(i!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,i)}};Rc.prototype.mapMode=yr.TrackBefore;Rc.prototype.point=!0;var ia=class t extends yt{constructor(e,i,r,n,o,a){super(i,r,o,e),this.block=n,this.isReplace=a,this.mapMode=n?i<=0?yr.TrackBefore:yr.TrackAfter:yr.TrackDel}get type(){return this.startSide!=this.endSide?Ir.WidgetRange:this.startSide<=0?Ir.WidgetBefore:Ir.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof t&&f8(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,i=e){if(this.isReplace&&(e>i||e==i&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&i!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,i)}};ia.prototype.point=!0;function XO(t,e=!1){let{inclusiveStart:i,inclusiveEnd:r}=t;return i==null&&(i=t.inclusive),r==null&&(r=t.inclusive),{start:i!=null?i:e,end:r!=null?r:e}}function f8(t,e){return t==e||!!(t&&e&&t.compare(e))}function Yx(t,e,i,r=0){let n=i.length-1;n>=0&&i[n]+r>=t?i[n]=Math.max(i[n],e):i.push(t,e)}var xc=class t{constructor(e,i,r,n){this.doc=e,this.pos=i,this.end=r,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=i}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof gh&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new ur),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(ng(new Ac(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof gh)&&this.getLine()}buildText(e,i,r){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:a,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(i.slice(i.length-r)),this.getLine().append(ng(new ea(this.text.slice(this.textOff,this.textOff+n)),i),r),this.atCursorPos=!0,this.textOff+=n,e-=n,r=0}}span(e,i,r,n){this.buildText(i-e,r,n),this.pos=i,this.openStart<0&&(this.openStart=n)}point(e,i,r,n,o,a){if(this.disallowBlockEffectsFor[a]&&r instanceof ia){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(i>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=i-e;if(r instanceof ia)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new gh(r.widget||new bg("div"),l,r));else{let h=xg.create(r.widget||new bg("span"),l,l?0:r.startSide),u=this.atCursorPos&&!h.isEditable&&o<=n.length&&(e<i||r.startSide>0),c=!h.isEditable&&(e<i||o>n.length||r.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!u&&!h.isEditable&&(this.pendingBuffer=0),this.flushBuffer(n),u&&(f.append(ng(new Ac(1),n),o),o=n.length+Math.max(0,o-n.length)),f.append(ng(h,n),o),this.atCursorPos=c,this.pendingBuffer=c?e<i||o>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=i),this.openStart<0&&(this.openStart=o)}static build(e,i,r,n,o){let a=new t(e,i,r,o);return a.openEnd=Xt.spans(n,i,r,a),a.openStart<0&&(a.openStart=a.openEnd),a.finish(a.openEnd),a}};function ng(t,e){for(let i of e)t=new ta(i,[t],t.length);return t}var bg=class extends as{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}},ti=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(ti||(ti={})),Ja=ti.LTR,Lb=ti.RTL;function YO(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}var d8=YO("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),p8=YO("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Zx=Object.create(null),Ds=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);Zx[e]=i,Zx[i]=-e}function ZO(t){return t<=247?d8[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?p8[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8204?256:64336<=t&&t<=65023?4:1}var m8=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/,ks=class{get dir(){return this.level%2?Lb:Ja}constructor(e,i,r){this.from=e,this.to=i,this.level=r}side(e,i){return this.dir==i==e?this.to:this.from}forward(e,i){return e==(this.dir==i)}static find(e,i,r,n){let o=-1;for(let a=0;a<e.length;a++){let l=e[a];if(l.from<=i&&l.to>=i){if(l.level==r)return a;(o<0||(n!=0?n<0?l.from<i:l.to>i:e[o].level>l.level))&&(o=a)}}if(o<0)throw new RangeError("Index out of range");return o}};function KO(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let r=t[i],n=e[i];if(r.from!=n.from||r.to!=n.to||r.direction!=n.direction||!KO(r.inner,n.inner))return!1}return!0}var ei=[];function g8(t,e,i,r,n){for(let o=0;o<=r.length;o++){let a=o?r[o-1].to:e,l=o<r.length?r[o].from:i,h=o?256:n;for(let u=a,c=h,f=h;u<l;u++){let d=ZO(t.charCodeAt(u));d==512?d=c:d==8&&f==4&&(d=16),ei[u]=d==4?2:d,d&7&&(f=d),c=d}for(let u=a,c=h,f=h;u<l;u++){let d=ei[u];if(d==128)u<l-1&&c==ei[u+1]&&c&24?d=ei[u]=c:ei[u]=256;else if(d==64){let m=u+1;for(;m<l&&ei[m]==64;)m++;let p=u&&c==8||m<i&&ei[m]==8?f==1?1:8:256;for(let v=u;v<m;v++)ei[v]=p;u=m-1}else d==8&&f==1&&(ei[u]=1);c=d,d&7&&(f=d)}}}function v8(t,e,i,r,n){let o=n==1?2:1;for(let a=0,l=0,h=0;a<=r.length;a++){let u=a?r[a-1].to:e,c=a<r.length?r[a].from:i;for(let f=u,d,m,p;f<c;f++)if(m=Zx[d=t.charCodeAt(f)])if(m<0){for(let v=l-3;v>=0;v-=3)if(Ds[v+1]==-m){let g=Ds[v+2],_=g&2?n:g&4?g&1?o:n:0;_&&(ei[f]=ei[Ds[v]]=_),l=v;break}}else{if(Ds.length==189)break;Ds[l++]=f,Ds[l++]=d,Ds[l++]=h}else if((p=ei[f])==2||p==1){let v=p==n;h=v?0:1;for(let g=l-3;g>=0;g-=3){let _=Ds[g+2];if(_&2)break;if(v)Ds[g+2]|=2;else{if(_&4)break;Ds[g+2]|=4}}}}}function _8(t,e,i,r){for(let n=0,o=r;n<=i.length;n++){let a=n?i[n-1].to:t,l=n<i.length?i[n].from:e;for(let h=a;h<l;){let u=ei[h];if(u==256){let c=h+1;for(;;)if(c==l){if(n==i.length)break;c=i[n++].to,l=n<i.length?i[n].from:e}else if(ei[c]==256)c++;else break;let f=o==1,d=(c<e?ei[c]:r)==1,m=f==d?f?1:2:r;for(let p=c,v=n,g=v?i[v-1].to:t;p>h;)p==g&&(p=i[--v].from,g=v?i[v-1].to:t),ei[--p]=m;h=c}else o=u,h++}}}function Kx(t,e,i,r,n,o,a){let l=r%2?2:1;if(r%2==n%2)for(let h=e,u=0;h<i;){let c=!0,f=!1;if(u==o.length||h<o[u].from){let v=ei[h];v!=l&&(c=!1,f=v==16)}let d=!c&&l==1?[]:null,m=c?r:r+1,p=h;e:for(;;)if(u<o.length&&p==o[u].from){if(f)break e;let v=o[u];if(!c)for(let g=v.to,_=u+1;;){if(g==i)break e;if(_<o.length&&o[_].from==g)g=o[_++].to;else{if(ei[g]==l)break e;break}}if(u++,d)d.push(v);else{v.from>h&&a.push(new ks(h,v.from,m));let g=v.direction==Ja!=!(m%2);Qx(t,g?r+1:r,n,v.inner,v.from,v.to,a),h=v.to}p=v.to}else{if(p==i||(c?ei[p]!=l:ei[p]==l))break;p++}d?Kx(t,h,p,r+1,n,d,a):h<p&&a.push(new ks(h,p,m)),h=p}else for(let h=i,u=o.length;h>e;){let c=!0,f=!1;if(!u||h>o[u-1].to){let v=ei[h-1];v!=l&&(c=!1,f=v==16)}let d=!c&&l==1?[]:null,m=c?r:r+1,p=h;e:for(;;)if(u&&p==o[u-1].to){if(f)break e;let v=o[--u];if(!c)for(let g=v.from,_=u;;){if(g==e)break e;if(_&&o[_-1].to==g)g=o[--_].from;else{if(ei[g-1]==l)break e;break}}if(d)d.push(v);else{v.to<h&&a.push(new ks(v.to,h,m));let g=v.direction==Ja!=!(m%2);Qx(t,g?r+1:r,n,v.inner,v.from,v.to,a),h=v.from}p=v.from}else{if(p==e||(c?ei[p-1]!=l:ei[p-1]==l))break;p--}d?Kx(t,p,h,r+1,n,d,a):p<h&&a.push(new ks(p,h,m)),h=p}}function Qx(t,e,i,r,n,o,a){let l=e%2?2:1;g8(t,n,o,r,l),v8(t,n,o,r,l),_8(n,o,r,l),Kx(t,n,o,e,i,r,a)}function y8(t,e,i){if(!t)return[new ks(0,0,e==Lb?1:0)];if(e==Ja&&!i.length&&!m8.test(t))return QO(t.length);if(i.length)for(;t.length>ei.length;)ei[ei.length]=256;let r=[],n=e==Ja?0:1;return Qx(t,n,n,i,0,t.length,r),r}function QO(t){return[new ks(0,t,0)]}var JO="";function x8(t,e,i,r,n){var o;let a=r.head-t.from,l=ks.find(e,a,(o=r.bidiLevel)!==null&&o!==void 0?o:-1,r.assoc),h=e[l],u=h.side(n,i);if(a==u){let d=l+=n?1:-1;if(d<0||d>=e.length)return null;h=e[l=d],a=h.side(!n,i),u=h.side(n,i)}let c=Ni(t.text,a,h.forward(n,i));(c<h.from||c>h.to)&&(c=u),JO=t.text.slice(Math.min(a,c),Math.max(a,c));let f=l==(n?e.length-1:0)?null:e[l+(n?1:-1)];return f&&c==u&&f.level+(n?0:1)<h.level?ge.cursor(f.side(!n,i)+t.from,f.forward(n,i)?1:-1,f.level):ge.cursor(c+t.from,h.forward(n,i)?-1:1,h.level)}function b8(t,e,i){for(let r=e;r<i;r++){let n=ZO(t.charCodeAt(r));if(n==1)return Ja;if(n==2||n==4)return Lb}return Ja}var $O=Ve.define(),eD=Ve.define(),tD=Ve.define(),iD=Ve.define(),Jx=Ve.define(),rD=Ve.define(),nD=Ve.define(),sD=Ve.define({combine:t=>t.some(e=>e)}),oD=Ve.define({combine:t=>t.some(e=>e)}),bc=class t{constructor(e,i="nearest",r="nearest",n=5,o=5,a=!1){this.range=e,this.y=i,this.x=r,this.yMargin=n,this.xMargin=o,this.isSnapshot=a}map(e){return e.empty?this:new t(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new t(ge.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}},sg=Dt.define({map:(t,e)=>t.map(e)});function pn(t,e,i){let r=t.facet(iD);r.length?r[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}var Og=Ve.define({combine:t=>t.length?t[0]:!0}),w8=0,mc=Ve.define(),Ki=class t{constructor(e,i,r,n,o){this.id=e,this.create=i,this.domEventHandlers=r,this.domEventObservers=n,this.extension=o(this)}static define(e,i){let{eventHandlers:r,eventObservers:n,provide:o,decorations:a}=i||{};return new t(w8++,e,r,n,l=>{let h=[mc.of(l)];return a&&h.push(Lc.of(u=>{let c=u.plugin(l);return c?a(c):yt.none})),o&&h.push(o(l)),h})}static fromClass(e,i){return t.define(r=>new e(r),i)}},wc=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let i=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(i)}catch(r){if(pn(i.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(n){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(i){pn(e.state,i,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var i;if(!((i=this.value)===null||i===void 0)&&i.destroy)try{this.value.destroy()}catch(r){pn(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}},aD=Ve.define(),Ob=Ve.define(),Lc=Ve.define(),lD=Ve.define(),Db=Ve.define(),hD=Ve.define();function rO(t,e){let i=t.state.facet(hD);if(!i.length)return i;let r=i.map(o=>o instanceof Function?o(t):o),n=[];return Xt.spans(r,e.from,e.to,{point(){},span(o,a,l,h){let u=o-e.from,c=a-e.from,f=n;for(let d=l.length-1;d>=0;d--,h--){let m=l[d].spec.bidiIsolate,p;if(m==null&&(m=b8(e.text,u,c)),h>0&&f.length&&(p=f[f.length-1]).to==u&&p.direction==m)p.to=c,f=p.inner;else{let v={from:u,to:c,direction:m,inner:[]};f.push(v),f=v.inner}}}}),n}var uD=Ve.define();function cD(t){let e=0,i=0,r=0,n=0;for(let o of t.state.facet(uD)){let a=o(t);a&&(a.left!=null&&(e=Math.max(e,a.left)),a.right!=null&&(i=Math.max(i,a.right)),a.top!=null&&(r=Math.max(r,a.top)),a.bottom!=null&&(n=Math.max(n,a.bottom)))}return{left:e,right:i,top:r,bottom:n}}var gc=Ve.define(),Fs=class t{constructor(e,i,r,n){this.fromA=e,this.toA=i,this.fromB=r,this.toB=n}join(e){return new t(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let i=e.length,r=this;for(;i>0;i--){let n=e[i-1];if(!(n.fromA>r.toA)){if(n.toA<r.fromA)break;r=r.join(n),e.splice(i-1,1)}}return e.splice(i,0,r),e}static extendWithRanges(e,i){if(i.length==0)return e;let r=[];for(let n=0,o=0,a=0,l=0;;n++){let h=n==e.length?null:e[n],u=a-l,c=h?h.fromB:1e9;for(;o<i.length&&i[o]<c;){let f=i[o],d=i[o+1],m=Math.max(l,f),p=Math.min(c,d);if(m<=p&&new t(m+u,p+u,m,p).addToSet(r),d>c)break;o+=2}if(!h)return r;new t(h.fromA,h.toA,h.fromB,h.toB).addToSet(r),a=h.toA,l=h.toB}}},wg=class t{constructor(e,i,r){this.view=e,this.state=i,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=Or.empty(this.startState.doc.length);for(let o of r)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,a,l,h)=>n.push(new Fs(o,a,l,h))),this.changedRanges=n}static create(e,i,r){return new t(e,i,r)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}},Sg=class extends hi{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new ur],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Fs(0,0,0,e.state.doc.length)],0,null)}update(e){var i;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:u,toA:c})=>c<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let n=-1;this.view.inputState.composing>=0&&(!((i=this.domChanged)===null||i===void 0)&&i.newSel?n=this.domChanged.newSel.head:!P8(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let o=n>-1?C8(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:u,to:c}=this.hasComposition;r=new Fs(u,c,e.changes.mapPos(u,-1),e.changes.mapPos(c,1)).addToSet(r.slice())}this.hasComposition=o?{from:o.range.fromB,to:o.range.toB}:null,(qe.ie||qe.chrome)&&!o&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let a=this.decorations,l=this.updateDeco(),h=T8(a,l,e.changes);return r=Fs.extendWithRanges(r,h),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,o),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,i,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,i,r);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let a=qe.chrome||qe.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,a),this.flags&=-8,a&&(a.written||n.selectionRange.focusNode!=a.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(a=>a.flags&=-9);let o=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let a of this.children)a instanceof gh&&a.widget instanceof Cg&&o.push(a.dom);n.updateGaps(o)}updateChildren(e,i,r){let n=r?r.range.addToSet(e.slice()):e,o=this.childCursor(i);for(let a=n.length-1;;a--){let l=a>=0?n[a]:null;if(!l)break;let{fromA:h,toA:u,fromB:c,toB:f}=l,d,m,p,v;if(r&&r.range.fromB<f&&r.range.toB>c){let y=xc.build(this.view.state.doc,c,r.range.fromB,this.decorations,this.dynamicDecorationMap),S=xc.build(this.view.state.doc,r.range.toB,f,this.decorations,this.dynamicDecorationMap);m=y.breakAtStart,p=y.openStart,v=S.openEnd;let w=this.compositionView(r);S.breakAtStart?w.breakAfter=1:S.content.length&&w.merge(w.length,w.length,S.content[0],!1,S.openStart,0)&&(w.breakAfter=S.content[0].breakAfter,S.content.shift()),y.content.length&&w.merge(0,0,y.content[y.content.length-1],!0,0,y.openEnd)&&y.content.pop(),d=y.content.concat(w).concat(S.content)}else({content:d,breakAtStart:m,openStart:p,openEnd:v}=xc.build(this.view.state.doc,c,f,this.decorations,this.dynamicDecorationMap));let{i:g,off:_}=o.findPos(u,1),{i:x,off:b}=o.findPos(h,-1);zO(this,x,b,g,_,d,m,p,v)}r&&this.fixCompositionDOM(r)}compositionView(e){let i=new ea(e.text.nodeValue);i.flags|=8;for(let{deco:n}of e.marks)i=new ta(n,[i],i.length);let r=new ur;return r.append(i,0),r}fixCompositionDOM(e){let i=(o,a)=>{a.flags|=8|(a.children.some(h=>h.flags&7)?1:0),this.markedForComposition.add(a);let l=hi.get(o);l&&l!=a&&(l.dom=null),a.setDOM(o)},r=this.childPos(e.range.fromB,1),n=this.children[r.i];i(e.line,n);for(let o=e.marks.length-1;o>=-1;o--)r=n.childPos(r.off,1),n=n.children[r.i],i(o>=0?e.marks[o].node:e.text,n)}updateSelection(e=!1,i=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,n=r==this.dom,o=!n&&fg(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(n||i||o))return;let a=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,h=this.moveToLine(this.domAtPos(l.anchor)),u=l.empty?h:this.moveToLine(this.domAtPos(l.head));if(qe.gecko&&l.empty&&!this.hasComposition&&S8(h)){let f=document.createTextNode("");this.view.observer.ignore(()=>h.node.insertBefore(f,h.node.childNodes[h.offset]||null)),h=u=new Dr(f,0),a=!0}let c=this.view.observer.selectionRange;(a||!c.focusNode||(!yc(h.node,h.offset,c.anchorNode,c.anchorOffset)||!yc(u.node,u.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,l))&&(this.view.observer.ignore(()=>{qe.android&&qe.chrome&&this.dom.contains(c.focusNode)&&A8(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let f=_g(this.view.root);if(f)if(l.empty){if(qe.gecko){let d=E8(h.node,h.offset);if(d&&d!=3){let m=dD(h.node,h.offset,d==1?1:-1);m&&(h=new Dr(m.node,m.offset))}}f.collapse(h.node,h.offset),l.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=l.bidiLevel)}else if(f.extend){f.collapse(h.node,h.offset);try{f.extend(u.node,u.offset)}catch(d){}}else{let d=document.createRange();l.anchor>l.head&&([h,u]=[u,h]),d.setEnd(u.node,u.offset),d.setStart(h.node,h.offset),f.removeAllRanges(),f.addRange(d)}o&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(h,u)),this.impreciseAnchor=h.precise?null:new Dr(c.anchorNode,c.anchorOffset),this.impreciseHead=u.precise?null:new Dr(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,i){return this.hasComposition&&i.empty&&yc(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==i.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,i=e.state.selection.main,r=_g(e.root),{anchorNode:n,anchorOffset:o}=e.observer.selectionRange;if(!r||!i.empty||!i.assoc||!r.modify)return;let a=ur.find(this,i.head);if(!a)return;let l=a.posAtStart;if(i.head==l||i.head==l+a.length)return;let h=this.coordsAt(i.head,-1),u=this.coordsAt(i.head,1);if(!h||!u||h.bottom>u.top)return;let c=this.domAtPos(i.head+i.assoc);r.collapse(c.node,c.offset),r.modify("move",i.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let f=e.observer.selectionRange;e.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=i.from&&r.collapse(n,o)}moveToLine(e){let i=this.dom,r;if(e.node!=i)return e;for(let n=e.offset;!r&&n<i.childNodes.length;n++){let o=hi.get(i.childNodes[n]);o instanceof ur&&(r=o.domAtPos(0))}for(let n=e.offset-1;!r&&n>=0;n--){let o=hi.get(i.childNodes[n]);o instanceof ur&&(r=o.domAtPos(o.length))}return r?new Dr(r.node,r.offset,!0):e}nearest(e){for(let i=e;i;){let r=hi.get(i);if(r&&r.rootView==this)return r;i=i.parentNode}return null}posFromDOM(e,i){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,i)+r.posAtStart}domAtPos(e){let{i,off:r}=this.childCursor().findPos(e,-1);for(;i<this.children.length-1;){let n=this.children[i];if(r<n.length||n instanceof ur)break;i++,r=0}return this.children[i].domAtPos(r)}coordsAt(e,i){let r=null,n=0;for(let o=this.length,a=this.children.length-1;a>=0;a--){let l=this.children[a],h=o-l.breakAfter,u=h-l.length;if(h<e)break;u<=e&&(u<e||l.covers(-1))&&(h>e||l.covers(1))&&(!r||l instanceof ur&&!(r instanceof ur&&i>=0))&&(r=l,n=u),o=u}return r?r.coordsAt(e-n,i):null}coordsForChar(e){let{i,off:r}=this.childPos(e,1),n=this.children[i];if(!(n instanceof ur))return null;for(;n.children.length;){let{i:l,off:h}=n.childPos(r,1);for(;;l++){if(l==n.children.length)return null;if((n=n.children[l]).length)break}r=h}if(!(n instanceof ea))return null;let o=Ni(n.text,r);if(o==r)return null;let a=Qa(n.dom,r,o).getClientRects();for(let l=0;l<a.length;l++){let h=a[l];if(l==a.length-1||h.top<h.bottom&&h.left<h.right)return h}return null}measureVisibleLineHeights(e){let i=[],{from:r,to:n}=e,o=this.view.contentDOM.clientWidth,a=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==ti.LTR;for(let u=0,c=0;c<this.children.length;c++){let f=this.children[c],d=u+f.length;if(d>n)break;if(u>=r){let m=f.dom.getBoundingClientRect();if(i.push(m.height),a){let p=f.dom.lastChild,v=p?Mc(p):[];if(v.length){let g=v[v.length-1],_=h?g.right-m.left:m.right-g.left;_>l&&(l=_,this.minWidth=o,this.minWidthFrom=u,this.minWidthTo=d)}}}u=d+f.breakAfter}return i}textDirectionAt(e){let{i}=this.childPos(e,1);return getComputedStyle(this.children[i].dom).direction=="rtl"?ti.RTL:ti.LTR}measureTextSize(){for(let o of this.children)if(o instanceof ur){let a=o.measureTextSize();if(a)return a}let e=document.createElement("div"),i,r,n;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let o=Mc(e.firstChild)[0];i=e.getBoundingClientRect().height,r=o?o.width/27:7,n=o?o.height:i,e.remove()}),{lineHeight:i,charWidth:r,textHeight:n}}childCursor(e=this.length){let i=this.children.length;return i&&(e-=this.children[--i].length),new yg(this.children,e,i)}computeBlockGapDeco(){let e=[],i=this.view.viewState;for(let r=0,n=0;;n++){let o=n==i.viewports.length?null:i.viewports[n],a=o?o.from-1:this.length;if(a>r){let l=(i.lineBlockAt(a).bottom-i.lineBlockAt(r).top)/this.view.scaleY;e.push(yt.replace({widget:new Cg(l),block:!0,inclusive:!0,isBlockGap:!0}).range(r,a))}if(!o)break;r=o.to+1}return yt.set(e)}updateDeco(){let e=this.view.state.facet(Lc).map((n,o)=>(this.dynamicDecorationMap[o]=typeof n=="function")?n(this.view):n),i=!1,r=this.view.state.facet(lD).map((n,o)=>{let a=typeof n=="function";return a&&(i=!0),a?n(this.view):n});r.length&&(this.dynamicDecorationMap[e.length]=i,e.push(Xt.join(r)));for(let n=e.length;n<e.length+3;n++)this.dynamicDecorationMap[n]=!1;return this.decorations=[...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){if(e.isSnapshot){let u=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=u.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}let{range:i}=e,r=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1),n;if(!r)return;!i.empty&&(n=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)});let o=cD(this.view),a={left:r.left-o.left,top:r.top-o.top,right:r.right+o.right,bottom:r.bottom+o.bottom},{offsetWidth:l,offsetHeight:h}=this.view.scrollDOM;n8(this.view.scrollDOM,a,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,h),-h),this.view.textDirection==ti.LTR)}};function S8(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}var Cg=class extends as{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}};function fD(t,e){let i=t.observer.selectionRange,r=i.focusNode&&dD(i.focusNode,i.focusOffset,0);if(!r)return null;let n=e-r.offset;return{from:n,to:n+r.node.nodeValue.length,node:r.node}}function C8(t,e,i){let r=fD(t,i);if(!r)return null;let{node:n,from:o,to:a}=r,l=n.nodeValue;if(/[\n\r]/.test(l)||t.state.doc.sliceString(r.from,r.to)!=l)return null;let h=e.invertedDesc,u=new Fs(h.mapPos(o),h.mapPos(a),o,a),c=[];for(let f=n.parentNode;;f=f.parentNode){let d=hi.get(f);if(d instanceof ta)c.push({node:f,deco:d.mark});else{if(d instanceof ur||f.nodeName=="DIV"&&f.parentNode==t.contentDOM)return{range:u,text:n,marks:c,line:f};if(f!=t.contentDOM)c.push({node:f,deco:new Pc({inclusive:!0,attributes:c8(f),tagName:f.tagName.toLowerCase()})});else return null}}}function dD(t,e,i){if(i<=0)for(let r=t,n=e;;){if(r.nodeType==3)return{node:r,offset:n};if(r.nodeType==1&&n>0)r=r.childNodes[n-1],n=_o(r);else break}if(i>=0)for(let r=t,n=e;;){if(r.nodeType==3)return{node:r,offset:n};if(r.nodeType==1&&n<r.childNodes.length&&i>=0)r=r.childNodes[n],n=0;else break}return null}function E8(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}var M8=class{constructor(){this.changes=[]}compareRange(e,i){Yx(e,i,this.changes)}comparePoint(e,i){Yx(e,i,this.changes)}};function T8(t,e,i){let r=new M8;return Xt.compare(t,e,i,r),r.changes}function A8(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(i.nodeType==1&&i.contentEditable=="false")return!0;return!1}function P8(t,e){let i=!1;return e&&t.iterChangedRanges((r,n)=>{r<e.to&&n>e.from&&(i=!0)}),i}function R8(t,e,i=1){let r=t.charCategorizer(e),n=t.doc.lineAt(e),o=e-n.from;if(n.length==0)return ge.cursor(e);o==0?i=1:o==n.length&&(i=-1);let a=o,l=o;i<0?a=Ni(n.text,o,!1):l=Ni(n.text,o);let h=r(n.text.slice(a,l));for(;a>0;){let u=Ni(n.text,a,!1);if(r(n.text.slice(u,a))!=h)break;a=u}for(;l<n.length;){let u=Ni(n.text,l);if(r(n.text.slice(l,u))!=h)break;l=u}return ge.range(a+n.from,l+n.from)}function L8(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function O8(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function kx(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function nO(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function sO(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function $x(t,e,i){let r,n,o,a,l=!1,h,u,c,f;for(let p=t.firstChild;p;p=p.nextSibling){let v=Mc(p);for(let g=0;g<v.length;g++){let _=v[g];n&&kx(n,_)&&(_=nO(sO(_,n.bottom),n.top));let x=L8(e,_),b=O8(i,_);if(x==0&&b==0)return p.nodeType==3?oO(p,e,i):$x(p,e,i);if(!r||a>b||a==b&&o>x){r=p,n=_,o=x,a=b;let y=b?i<_.top?-1:1:x?e<_.left?-1:1:0;l=!y||(y>0?g<v.length-1:g>0)}x==0?i>_.bottom&&(!c||c.bottom<_.bottom)?(h=p,c=_):i<_.top&&(!f||f.top>_.top)&&(u=p,f=_):c&&kx(c,_)?c=sO(c,_.bottom):f&&kx(f,_)&&(f=nO(f,_.top))}}if(c&&c.bottom>=i?(r=h,n=c):f&&f.top<=i&&(r=u,n=f),!r)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));if(r.nodeType==3)return oO(r,d,i);if(l&&r.contentEditable!="false")return $x(r,d,i);let m=Array.prototype.indexOf.call(t.childNodes,r)+(e>=(n.left+n.right)/2?1:0);return{node:t,offset:m}}function oO(t,e,i){let r=t.nodeValue.length,n=-1,o=1e9,a=0;for(let l=0;l<r;l++){let h=Qa(t,l,l+1).getClientRects();for(let u=0;u<h.length;u++){let c=h[u];if(c.top==c.bottom)continue;a||(a=e-c.left);let f=(c.top>i?c.top-i:i-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&f<o){let d=e>=(c.left+c.right)/2,m=d;if((qe.chrome||qe.gecko)&&Qa(t,l).getBoundingClientRect().left==c.right&&(m=!d),f<=0)return{node:t,offset:l+(m?1:0)};n=l+(m?1:0),o=f}}}return{node:t,offset:n>-1?n:a>0?t.nodeValue.length:0}}function pD(t,e,i,r=-1){var n,o;let a=t.contentDOM.getBoundingClientRect(),l=a.top+t.viewState.paddingTop,h,{docHeight:u}=t.viewState,{x:c,y:f}=e,d=f-l;if(d<0)return 0;if(d>u)return t.state.doc.length;for(let y=t.viewState.heightOracle.textHeight/2,S=!1;h=t.elementAtHeight(d),h.type!=Ir.Text;)for(;d=r>0?h.bottom+y:h.top-y,!(d>=0&&d<=u);){if(S)return i?null:0;S=!0,r=-r}f=l+d;let m=h.from;if(m<t.viewport.from)return t.viewport.from==0?0:i?null:aO(t,a,h,c,f);if(m>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:i?null:aO(t,a,h,c,f);let p=t.dom.ownerDocument,v=t.root.elementFromPoint?t.root:p,g=v.elementFromPoint(c,f);g&&!t.contentDOM.contains(g)&&(g=null),g||(c=Math.max(a.left+1,Math.min(a.right-1,c)),g=v.elementFromPoint(c,f),g&&!t.contentDOM.contains(g)&&(g=null));let _,x=-1;if(g&&((n=t.docView.nearest(g))===null||n===void 0?void 0:n.isEditable)!=!1){if(p.caretPositionFromPoint){let y=p.caretPositionFromPoint(c,f);y&&({offsetNode:_,offset:x}=y)}else if(p.caretRangeFromPoint){let y=p.caretRangeFromPoint(c,f);y&&({startContainer:_,startOffset:x}=y,(!t.contentDOM.contains(_)||qe.safari&&D8(_,x,c)||qe.chrome&&I8(_,x,c))&&(_=void 0))}}if(!_||!t.docView.dom.contains(_)){let y=ur.find(t.docView,m);if(!y)return d>h.top+h.height/2?h.to:h.from;({node:_,offset:x}=$x(y.dom,c,f))}let b=t.docView.nearest(_);if(!b)return null;if(b.isWidget&&((o=b.dom)===null||o===void 0?void 0:o.nodeType)==1){let y=b.dom.getBoundingClientRect();return e.y<y.top||e.y<=y.bottom&&e.x<=(y.left+y.right)/2?b.posAtStart:b.posAtEnd}else return b.localPosFromDOM(_,x)+b.posAtStart}function aO(t,e,i,r,n){let o=Math.round((r-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>t.defaultLineHeight*1.5){let l=t.viewState.heightOracle.textHeight,h=Math.floor((n-i.top-(t.defaultLineHeight-l)*.5)/l);o+=h*t.viewState.heightOracle.lineLength}let a=t.state.sliceDoc(i.from,i.to);return i.from+ig(a,o,t.state.tabSize)}function D8(t,e,i){let r;if(t.nodeType!=3||e!=(r=t.nodeValue.length))return!1;for(let n=t.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return Qa(t,r-1,r).getBoundingClientRect().left>i}function I8(t,e,i){if(e!=0)return!1;for(let n=t;;){let o=n.parentNode;if(!o||o.nodeType!=1||o.firstChild!=n)return!1;if(o.classList.contains("cm-line"))break;n=o}let r=t.nodeType==1?t.getBoundingClientRect():Qa(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return i-r.left>5}function eb(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type)){for(let r of i.type)if(r.to>e||r.to==e&&(r.to==i.to||r.type==Ir.Text))return r}return i}function k8(t,e,i,r){let n=eb(t,e.head),o=!r||n.type!=Ir.Text||!(t.lineWrapping||n.widgetLineBreaks)?null:t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(o){let a=t.dom.getBoundingClientRect(),l=t.textDirectionAt(n.from),h=t.posAtCoords({x:i==(l==ti.LTR)?a.right-1:a.left+1,y:(o.top+o.bottom)/2});if(h!=null)return ge.cursor(h,i?-1:1)}return ge.cursor(i?n.to:n.from,i?-1:1)}function lO(t,e,i,r){let n=t.state.doc.lineAt(e.head),o=t.bidiSpans(n),a=t.textDirectionAt(n.from);for(let l=e,h=null;;){let u=x8(n,o,a,l,i),c=JO;if(!u){if(n.number==(i?t.state.doc.lines:1))return l;c=`
`,n=t.state.doc.line(n.number+(i?1:-1)),o=t.bidiSpans(n),u=t.visualLineSide(n,!i)}if(h){if(!h(c))return l}else{if(!r)return u;h=r(c)}l=u}}function F8(t,e,i){let r=t.state.charCategorizer(e),n=r(i);return o=>{let a=r(o);return n==Jt.Space&&(n=a),n==a}}function B8(t,e,i,r){let n=e.head,o=i?1:-1;if(n==(i?t.state.doc.length:0))return ge.cursor(n,e.assoc);let a=e.goalColumn,l,h=t.contentDOM.getBoundingClientRect(),u=t.coordsAtPos(n,e.assoc||-1),c=t.documentTop;if(u)a==null&&(a=u.left-h.left),l=o<0?u.top:u.bottom;else{let m=t.viewState.lineBlockAt(n);a==null&&(a=Math.min(h.right-h.left,t.defaultCharacterWidth*(n-m.from))),l=(o<0?m.top:m.bottom)+c}let f=h.left+a,d=r!=null?r:t.viewState.heightOracle.textHeight>>1;for(let m=0;;m+=10){let p=l+(d+m)*o,v=pD(t,{x:f,y:p},!1,o);if(p<h.top||p>h.bottom||(o<0?v<n:v>n)){let g=t.docView.coordsForChar(v),_=!g||p<g.top?-1:1;return ge.cursor(v,_,void 0,a)}}}function dg(t,e,i){for(;;){let r=0;for(let n of t)n.between(e-1,e+1,(o,a,l)=>{if(e>o&&e<a){let h=r||i||(e-o<a-e?-1:1);e=h<0?o:a,r=h}});if(!r)return e}}function Fx(t,e,i){let r=dg(t.state.facet(Db).map(n=>n(t)),i.from,e.head>i.from?-1:1);return r==i.from?i:ge.cursor(r,r<i.from?1:-1)}var tb=class{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,qe.safari&&e.contentDOM.addEventListener("input",()=>null),qe.gecko&&J8(e.contentDOM.ownerDocument)}handleEvent(e){!V8(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,i){let r=this.handlers[e];if(r){for(let n of r.observers)n(this.view,i);for(let n of r.handlers){if(i.defaultPrevented)break;if(n(this.view,i)){i.preventDefault();break}}}}ensureHandlers(e){let i=N8(e),r=this.handlers,n=this.view.contentDOM;for(let o in i)if(o!="scroll"){let a=!i[o].handlers.length,l=r[o];l&&a!=!l.handlers.length&&(n.removeEventListener(o,this.handleEvent),l=null),l||n.addEventListener(o,this.handleEvent,{passive:a})}for(let o in r)o!="scroll"&&!i[o]&&n.removeEventListener(o,this.handleEvent);this.handlers=i}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(e.keyCode!=27&&gD.indexOf(e.keyCode)<0&&(this.view.inputState.lastEscPress=0),qe.android&&qe.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return qe.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((i=mD.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||U8.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=i||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,mh(this.view.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:qe.safari&&!qe.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};function hO(t,e){return(i,r)=>{try{return e.call(t,r,i)}catch(n){pn(i.state,n)}}}function N8(t){let e=Object.create(null);function i(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of t){let n=r.spec;if(n&&n.domEventHandlers)for(let o in n.domEventHandlers){let a=n.domEventHandlers[o];a&&i(o).handlers.push(hO(r.value,a))}if(n&&n.domEventObservers)for(let o in n.domEventObservers){let a=n.domEventObservers[o];a&&i(o).observers.push(hO(r.value,a))}}for(let r in ls)i(r).handlers.push(ls[r]);for(let r in hs)i(r).observers.push(hs[r]);return e}var mD=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],U8="dthko",gD=[16,17,18,20,91,92,224,225],og=6;function ag(t){return Math.max(0,t)*.7+8}function z8(t,e){return Math.max(Math.abs(t.clientX-e.clientX),Math.abs(t.clientY-e.clientY))}var ib=class{constructor(e,i,r,n){this.view=e,this.startEvent=i,this.style=r,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=i,this.scrollParent=s8(e.contentDOM),this.atoms=e.state.facet(Db).map(a=>a(e));let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=i.shiftKey,this.multiple=e.state.facet(Nt.allowMultipleSelections)&&G8(e,i),this.dragging=W8(e,i)&&xD(i)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){var i;if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&z8(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let r=0,n=0,o=((i=this.scrollParent)===null||i===void 0?void 0:i.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},a=cD(this.view);e.clientX-a.left<=o.left+og?r=-ag(o.left-e.clientX):e.clientX+a.right>=o.right-og&&(r=ag(e.clientX-o.right)),e.clientY-a.top<=o.top+og?n=-ag(o.top-e.clientY):e.clientY+a.bottom>=o.bottom-og&&(n=ag(e.clientY-o.bottom)),this.setScrollSpeed(r,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,i){this.scrollSpeed={x:e,y:i},e||i?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let i=null;for(let r=0;r<e.ranges.length;r++){let n=e.ranges[r],o=null;if(n.empty){let a=dg(this.atoms,n.from,0);a!=n.from&&(o=ge.cursor(a,-1))}else{let a=dg(this.atoms,n.from,-1),l=dg(this.atoms,n.to,1);(a!=n.from||l!=n.to)&&(o=ge.range(n.from==n.anchor?a:l,n.from==n.head?a:l))}o&&(i||(i=e.ranges.slice()),i[r]=o)}return i?ge.create(i,e.mainIndex):e}select(e){let{view:i}=this,r=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(i.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};function G8(t,e){let i=t.state.facet($O);return i.length?i[0](e):qe.mac?e.metaKey:e.ctrlKey}function H8(t,e){let i=t.state.facet(eD);return i.length?i[0](e):qe.mac?!e.altKey:!e.ctrlKey}function W8(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let r=_g(t.root);if(!r||r.rangeCount==0)return!0;let n=r.getRangeAt(0).getClientRects();for(let o=0;o<n.length;o++){let a=n[o];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return!0}return!1}function V8(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i=e.target,r;i!=t.contentDOM;i=i.parentNode)if(!i||i.nodeType==11||(r=hi.get(i))&&r.ignoreEvent(e))return!1;return!0}var ls=Object.create(null),hs=Object.create(null),vD=qe.ie&&qe.ie_version<15||qe.ios&&qe.webkit_version<604;function j8(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{t.focus(),i.remove(),_D(t,i.value)},50)}function _D(t,e){let{state:i}=t,r,n=1,o=i.toText(e),a=o.lines==i.selection.ranges.length;if(rb!=null&&i.selection.ranges.every(h=>h.empty)&&rb==o.toString()){let h=-1;r=i.changeByRange(u=>{let c=i.doc.lineAt(u.from);if(c.from==h)return{range:u};h=c.from;let f=i.toText((a?o.line(n++).text:e)+i.lineBreak);return{changes:{from:c.from,insert:f},range:ge.cursor(u.from+f.length)}})}else a?r=i.changeByRange(h=>{let u=o.line(n++);return{changes:{from:h.from,to:h.to,insert:u.text},range:ge.cursor(h.from+u.length)}}):r=i.replaceSelection(o);t.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}hs.scroll=t=>{t.inputState.lastScrollTop=t.scrollDOM.scrollTop,t.inputState.lastScrollLeft=t.scrollDOM.scrollLeft};ls.keydown=(t,e)=>(t.inputState.setSelectionOrigin("select"),e.keyCode==27&&(t.inputState.lastEscPress=Date.now()),!1);hs.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};hs.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};ls.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let r of t.state.facet(tD))if(i=r(t,e),i)break;if(!i&&e.button==0&&(i=Y8(t,e)),i){let r=!t.hasFocus;t.inputState.startMouseSelection(new ib(t,e,i,r)),r&&t.observer.ignore(()=>BO(t.contentDOM));let n=t.inputState.mouseSelection;if(n)return n.start(e),n.dragging===!1}return!1};function uO(t,e,i,r){if(r==1)return ge.cursor(e,i);if(r==2)return R8(t.state,e,i);{let n=ur.find(t.docView,e),o=t.state.doc.lineAt(n?n.posAtEnd:e),a=n?n.posAtStart:o.from,l=n?n.posAtEnd:o.to;return l<t.state.doc.length&&l==o.to&&l++,ge.range(a,l)}}var yD=(t,e)=>t>=e.top&&t<=e.bottom,cO=(t,e,i)=>yD(e,i)&&t>=i.left&&t<=i.right;function q8(t,e,i,r){let n=ur.find(t.docView,e);if(!n)return 1;let o=e-n.posAtStart;if(o==0)return 1;if(o==n.length)return-1;let a=n.coordsAt(o,-1);if(a&&cO(i,r,a))return-1;let l=n.coordsAt(o,1);return l&&cO(i,r,l)?1:a&&yD(r,a)?-1:1}function fO(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:q8(t,i,e.clientX,e.clientY)}}var X8=qe.ie&&qe.ie_version<=11,dO=null,pO=0,mO=0;function xD(t){if(!X8)return t.detail;let e=dO,i=mO;return dO=t,mO=Date.now(),pO=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(pO+1)%3:1}function Y8(t,e){let i=fO(t,e),r=xD(e),n=t.state.selection;return{update(o){o.docChanged&&(i.pos=o.changes.mapPos(i.pos),n=n.map(o.changes))},get(o,a,l){let h=fO(t,o),u,c=uO(t,h.pos,h.bias,r);if(i.pos!=h.pos&&!a){let f=uO(t,i.pos,i.bias,r),d=Math.min(f.from,c.from),m=Math.max(f.to,c.to);c=d<c.from?ge.range(d,m):ge.range(m,d)}return a?n.replaceRange(n.main.extend(c.from,c.to)):l&&r==1&&n.ranges.length>1&&(u=Z8(n,h.pos))?u:l?n.addRange(c):ge.create([c])}}}function Z8(t,e){for(let i=0;i<t.ranges.length;i++){let{from:r,to:n}=t.ranges[i];if(r<=e&&n>=e)return ge.create(t.ranges.slice(0,i).concat(t.ranges.slice(i+1)),t.mainIndex==i?0:t.mainIndex-(t.mainIndex>i?1:0))}return null}ls.dragstart=(t,e)=>{let{selection:{main:i}}=t.state;if(e.target.draggable){let n=t.docView.nearest(e.target);if(n&&n.isWidget){let o=n.posAtStart,a=o+n.length;(o>=i.to||a<=i.from)&&(i=ge.range(o,a))}}let{inputState:r}=t;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=i,e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove"),!1};ls.dragend=t=>(t.inputState.draggedContent=null,!1);function gO(t,e,i,r){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:o}=t.inputState,a=r&&o&&H8(t,e)?{from:o.from,to:o.to}:null,l={from:n,insert:i},h=t.state.changes(a?[a,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:a?"move.drop":"input.drop"}),t.inputState.draggedContent=null}ls.drop=(t,e)=>{if(!e.dataTransfer)return!1;if(t.state.readOnly)return!0;let i=e.dataTransfer.files;if(i&&i.length){let r=Array(i.length),n=0,o=()=>{++n==i.length&&gO(t,e,r.filter(a=>a!=null).join(t.state.lineBreak),!1)};for(let a=0;a<i.length;a++){let l=new FileReader;l.onerror=o,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(r[a]=l.result),o()},l.readAsText(i[a])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return gO(t,e,r,!0),!0}return!1};ls.paste=(t,e)=>{if(t.state.readOnly)return!0;t.observer.flush();let i=vD?null:e.clipboardData;return i?(_D(t,i.getData("text/plain")||i.getData("text/uri-text")),!0):(j8(t),!1)};function K8(t,e){let i=t.dom.parentNode;if(!i)return;let r=i.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),t.focus()},50)}function Q8(t){let e=[],i=[],r=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let n=-1;for(let{from:o}of t.selection.ranges){let a=t.doc.lineAt(o);a.number>n&&(e.push(a.text),i.push({from:a.from,to:Math.min(t.doc.length,a.to+1)})),n=a.number}r=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:r}}var rb=null;ls.copy=ls.cut=(t,e)=>{let{text:i,ranges:r,linewise:n}=Q8(t.state);if(!i&&!n)return!1;rb=n?i:null,e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let o=vD?null:e.clipboardData;return o?(o.clearData(),o.setData("text/plain",i),!0):(K8(t,i),!1)};var bD=Kr.define();function wD(t,e){let i=[];for(let r of t.facet(nD)){let n=r(t,e);n&&i.push(n)}return i?t.update({effects:i,annotations:bD.of(!0)}):null}function SD(t){setTimeout(()=>{let e=t.hasFocus;if(e!=t.inputState.notifiedFocused){let i=wD(t.state,e);i?t.dispatch(i):t.update([])}},10)}hs.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),SD(t)};hs.blur=t=>{t.observer.clearSelectionRange(),SD(t)};hs.compositionstart=hs.compositionupdate=t=>{t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0)};hs.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=t.observer.pendingRecords().length>0,t.inputState.compositionFirstChange=null,qe.chrome&&qe.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.hasComposition&&t.update([])},50)};hs.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};ls.beforeinput=(t,e)=>{var i;let r;if(qe.chrome&&qe.android&&(r=mD.find(n=>n.inputType==e.inputType))&&(t.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let n=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}return!1};var vO=new Set;function J8(t){vO.has(t)||(vO.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{}))}var _O=["pre-wrap","normal","pre-line","break-spaces"],nb=class{constructor(e){this.lineWrapping=e,this.doc=zt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,i){let r=this.doc.lineAt(i).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((i-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return _O.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let i=!1;for(let r=0;r<e.length;r++){let n=e[r];n<0?r++:this.heightSamples[Math.floor(n*10)]||(i=!0,this.heightSamples[Math.floor(n*10)]=!0)}return i}refresh(e,i,r,n,o,a){let l=_O.indexOf(e)>-1,h=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=i,this.charWidth=r,this.textHeight=n,this.lineLength=o,h){this.heightSamples={};for(let u=0;u<a.length;u++){let c=a[u];c<0?u++:this.heightSamples[Math.floor(c*10)]=!0}}return h}},sb=class{constructor(e,i){this.from=e,this.heights=i,this.index=0}get more(){return this.index<this.heights.length}},Is=class t{constructor(e,i,r,n,o){this.from=e,this.length=i,this.top=r,this.height=n,this._content=o}get type(){return typeof this._content=="number"?Ir.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof ia?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let i=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new t(this.from,this.length+e.length,this.top,this.height+e.height,i)}},ai=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(ai||(ai={})),pg=.001,mn=class t{constructor(e,i,r=2){this.length=e,this.height=i,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,i){this.height!=i&&(Math.abs(this.height-i)>pg&&(e.heightChanged=!0),this.height=i)}replace(e,i,r){return t.of(r)}decomposeLeft(e,i){i.push(this)}decomposeRight(e,i){i.push(this)}applyChanges(e,i,r,n){let o=this,a=r.doc;for(let l=n.length-1;l>=0;l--){let{fromA:h,toA:u,fromB:c,toB:f}=n[l],d=o.lineAt(h,ai.ByPosNoHeight,r.setDoc(i),0,0),m=d.to>=u?d:o.lineAt(u,ai.ByPosNoHeight,r,0,0);for(f+=m.to-u,u=m.to;l>0&&d.from<=n[l-1].toA;)h=n[l-1].fromA,c=n[l-1].fromB,l--,h<d.from&&(d=o.lineAt(h,ai.ByPosNoHeight,r,0,0));c+=d.from-h,h=d.from;let p=ab.build(r.setDoc(a),e,c,f);o=o.replace(h,u,p)}return o.updateHeight(r,0)}static empty(){return new In(0,0)}static of(e){if(e.length==1)return e[0];let i=0,r=e.length,n=0,o=0;for(;;)if(i==r)if(n>o*2){let l=e[i-1];l.break?e.splice(--i,1,l.left,null,l.right):e.splice(--i,1,l.left,l.right),r+=1+l.break,n-=l.size}else if(o>n*2){let l=e[r];l.break?e.splice(r,1,l.left,null,l.right):e.splice(r,1,l.left,l.right),r+=2+l.break,o-=l.size}else break;else if(n<o){let l=e[i++];l&&(n+=l.size)}else{let l=e[--r];l&&(o+=l.size)}let a=0;return e[i-1]==null?(a=1,i--):e[i]==null&&(a=1,r++),new ob(t.of(e.slice(0,i)),a,t.of(e.slice(r)))}};mn.prototype.size=1;var Eg=class extends mn{constructor(e,i,r){super(e,i),this.deco=r}blockAt(e,i,r,n){return new Is(n,this.length,r,this.height,this.deco||0)}lineAt(e,i,r,n,o){return this.blockAt(0,r,n,o)}forEachLine(e,i,r,n,o,a){e<=o+this.length&&i>=o&&a(this.blockAt(0,r,n,o))}updateHeight(e,i=0,r=!1,n){return n&&n.from<=i&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},In=class t extends Eg{constructor(e,i){super(e,i,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,i,r,n){return new Is(n,this.length,r,this.height,this.breaks)}replace(e,i,r){let n=r[0];return r.length==1&&(n instanceof t||n instanceof $o&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof $o?n=new t(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):mn.of(r)}updateHeight(e,i=0,r=!1,n){return n&&n.from<=i&&n.more?this.setHeight(e,n.heights[n.index++]):(r||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},$o=class t extends mn{constructor(e){super(e,0)}heightMetrics(e,i){let r=e.doc.lineAt(i).number,n=e.doc.lineAt(i+this.length).number,o=n-r+1,a,l=0;if(e.lineWrapping){let h=Math.min(this.height,e.lineHeight*o);a=h/o,this.length>o+1&&(l=(this.height-h)/(this.length-o-1))}else a=this.height/o;return{firstLine:r,lastLine:n,perLine:a,perChar:l}}blockAt(e,i,r,n){let{firstLine:o,lastLine:a,perLine:l,perChar:h}=this.heightMetrics(i,n);if(i.lineWrapping){let u=n+Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length),c=i.doc.lineAt(u),f=l+c.length*h,d=Math.max(r,e-f/2);return new Is(c.from,c.length,d,f,0)}else{let u=Math.max(0,Math.min(a-o,Math.floor((e-r)/l))),{from:c,length:f}=i.doc.line(o+u);return new Is(c,f,r+l*u,l,0)}}lineAt(e,i,r,n,o){if(i==ai.ByHeight)return this.blockAt(e,r,n,o);if(i==ai.ByPosNoHeight){let{from:m,to:p}=r.doc.lineAt(e);return new Is(m,p-m,0,0,0)}let{firstLine:a,perLine:l,perChar:h}=this.heightMetrics(r,o),u=r.doc.lineAt(e),c=l+u.length*h,f=u.number-a,d=n+l*f+h*(u.from-o-f);return new Is(u.from,u.length,Math.max(n,Math.min(d,n+this.height-c)),c,0)}forEachLine(e,i,r,n,o,a){e=Math.max(e,o),i=Math.min(i,o+this.length);let{firstLine:l,perLine:h,perChar:u}=this.heightMetrics(r,o);for(let c=e,f=n;c<=i;){let d=r.doc.lineAt(c);if(c==e){let p=d.number-l;f+=h*p+u*(e-o-p)}let m=h+u*d.length;a(new Is(d.from,d.length,f,m,0)),f+=m,c=d.to+1}}replace(e,i,r){let n=this.length-i;if(n>0){let o=r[r.length-1];o instanceof t?r[r.length-1]=new t(o.length+n):r.push(null,new t(n-1))}if(e>0){let o=r[0];o instanceof t?r[0]=new t(e+o.length):r.unshift(new t(e-1),null)}return mn.of(r)}decomposeLeft(e,i){i.push(new t(e-1),null)}decomposeRight(e,i){i.push(null,new t(this.length-e-1))}updateHeight(e,i=0,r=!1,n){let o=i+this.length;if(n&&n.from<=i+this.length&&n.more){let a=[],l=Math.max(i,n.from),h=-1;for(n.from>i&&a.push(new t(n.from-i-1).updateHeight(e,i));l<=o&&n.more;){let c=e.doc.lineAt(l).length;a.length&&a.push(null);let f=n.heights[n.index++];h==-1?h=f:Math.abs(f-h)>=pg&&(h=-2);let d=new In(c,f);d.outdated=!1,a.push(d),l+=c+1}l<=o&&a.push(null,new t(o-l).updateHeight(e,l));let u=mn.of(a);return(h<0||Math.abs(u.height-this.height)>=pg||Math.abs(h-this.heightMetrics(e,i).perLine)>=pg)&&(e.heightChanged=!0),u}else(r||this.outdated)&&(this.setHeight(e,e.heightForGap(i,i+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},ob=class extends mn{constructor(e,i,r){super(e.length+i+r.length,e.height+r.height,i|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,i,r,n){let o=r+this.left.height;return e<o?this.left.blockAt(e,i,r,n):this.right.blockAt(e,i,o,n+this.left.length+this.break)}lineAt(e,i,r,n,o){let a=n+this.left.height,l=o+this.left.length+this.break,h=i==ai.ByHeight?e<a:e<l,u=h?this.left.lineAt(e,i,r,n,o):this.right.lineAt(e,i,r,a,l);if(this.break||(h?u.to<l:u.from>l))return u;let c=i==ai.ByPosNoHeight?ai.ByPosNoHeight:ai.ByPos;return h?u.join(this.right.lineAt(l,c,r,a,l)):this.left.lineAt(l,c,r,n,o).join(u)}forEachLine(e,i,r,n,o,a){let l=n+this.left.height,h=o+this.left.length+this.break;if(this.break)e<h&&this.left.forEachLine(e,i,r,n,o,a),i>=h&&this.right.forEachLine(e,i,r,l,h,a);else{let u=this.lineAt(h,ai.ByPos,r,n,o);e<u.from&&this.left.forEachLine(e,u.from-1,r,n,o,a),u.to>=e&&u.from<=i&&a(u),i>u.to&&this.right.forEachLine(u.to+1,i,r,l,h,a)}}replace(e,i,r){let n=this.left.length+this.break;if(i<n)return this.balanced(this.left.replace(e,i,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,i-n,r));let o=[];e>0&&this.decomposeLeft(e,o);let a=o.length;for(let l of r)o.push(l);if(e>0&&yO(o,a-1),i<this.length){let l=o.length;this.decomposeRight(i,o),yO(o,l)}return mn.of(o)}decomposeLeft(e,i){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,i);i.push(this.left),this.break&&(r++,e>=r&&i.push(null)),e>r&&this.right.decomposeLeft(e-r,i)}decomposeRight(e,i){let r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,i);e<r&&this.left.decomposeRight(e,i),this.break&&e<n&&i.push(null),i.push(this.right)}balanced(e,i){return e.size>2*i.size||i.size>2*e.size?mn.of(this.break?[e,null,i]:[e,i]):(this.left=e,this.right=i,this.height=e.height+i.height,this.outdated=e.outdated||i.outdated,this.size=e.size+i.size,this.length=e.length+this.break+i.length,this)}updateHeight(e,i=0,r=!1,n){let{left:o,right:a}=this,l=i+o.length+this.break,h=null;return n&&n.from<=i+o.length&&n.more?h=o=o.updateHeight(e,i,r,n):o.updateHeight(e,i,r),n&&n.from<=l+a.length&&n.more?h=a=a.updateHeight(e,l,r,n):a.updateHeight(e,l,r),h?this.balanced(o,a):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function yO(t,e){let i,r;t[e]==null&&(i=t[e-1])instanceof $o&&(r=t[e+1])instanceof $o&&t.splice(e-1,3,new $o(i.length+1+r.length))}var $8=5,ab=class t{constructor(e,i){this.pos=e,this.oracle=i,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,i){if(this.lineStart>-1){let r=Math.min(i,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof In?n.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new In(r-this.pos,-1)),this.writtenTo=r,i>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=i}point(e,i,r){if(e<i||r.heightRelevant){let n=r.widget?r.widget.estimatedHeight:0,o=r.widget?r.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let a=i-e;r.block?this.addBlock(new Eg(a,n,r)):(a||o||n>=$8)&&this.addLineDeco(n,o,a)}else i>e&&this.span(e,i);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:i}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=i,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new In(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,i){let r=new $o(i-e);return this.oracle.doc.lineAt(e).to==i&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof In)return e;let i=new In(0,-1);return this.nodes.push(i),i}addBlock(e){this.enterLine();let i=e.deco;i&&i.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,i&&i.endSide>0&&(this.covering=e)}addLineDeco(e,i,r){let n=this.ensureLine();n.length+=r,n.collapsed+=r,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=i,this.writtenTo=this.pos=this.pos+r}finish(e){let i=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(i instanceof In)&&!this.isCovered?this.nodes.push(new In(0,-1)):(this.writtenTo<this.pos||i==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let n of this.nodes)n instanceof In&&n.updateHeight(this.oracle,r),r+=n?n.length:1;return this.nodes}static build(e,i,r,n){let o=new t(r,e);return Xt.spans(i,r,n,o,0),o.finish(r)}};function eW(t,e,i){let r=new lb;return Xt.compare(t,e,i,r,0),r.changes}var lb=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,i,r,n){(e<i||r&&r.heightRelevant||n&&n.heightRelevant)&&Yx(e,i,this.changes,5)}};function tW(t,e){let i=t.getBoundingClientRect(),r=t.ownerDocument,n=r.defaultView||window,o=Math.max(0,i.left),a=Math.min(n.innerWidth,i.right),l=Math.max(0,i.top),h=Math.min(n.innerHeight,i.bottom);for(let u=t.parentNode;u&&u!=r.body;)if(u.nodeType==1){let c=u,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let d=c.getBoundingClientRect();o=Math.max(o,d.left),a=Math.min(a,d.right),l=Math.max(l,d.top),h=u==t.parentNode?d.bottom:Math.min(h,d.bottom)}u=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:o-i.left,right:Math.max(o,a)-i.left,top:l-(i.top+e),bottom:Math.max(l,h)-(i.top+e)}}function iW(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}var Sc=class{constructor(e,i,r){this.from=e,this.to=i,this.size=r}static same(e,i){if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],o=i[r];if(n.from!=o.from||n.to!=o.to||n.size!=o.size)return!1}return!0}draw(e,i){return yt.replace({widget:new hb(this.size*(i?e.scaleY:e.scaleX),i)}).range(this.from,this.to)}},hb=class extends as{constructor(e,i){super(),this.size=e,this.vertical=i}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},Mg=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=xO,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ti.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let i=e.facet(Ob).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new nb(i),this.stateDeco=e.facet(Lc).filter(r=>typeof r!="function"),this.heightMap=mn.empty().applyChanges(this.stateDeco,zt.empty,this.heightOracle.setDoc(e.doc),[new Fs(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=yt.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:i}=this.state.selection;for(let r=0;r<=1;r++){let n=r?i.head:i.anchor;if(!e.some(({from:o,to:a})=>n>=o&&n<=a)){let{from:o,to:a}=this.lineBlockAt(n);e.push(new fh(o,a))}}this.viewports=e.sort((r,n)=>r.from-n.from),this.scaler=this.heightMap.height<=7e6?xO:new ub(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:vc(e,this.scaler))})}update(e,i=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(Lc).filter(c=>typeof c!="function");let n=e.changedRanges,o=Fs.extendWithRanges(n,eW(r,this.stateDeco,e?e.changes:Or.empty(this.state.doc.length))),a=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=a&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let h=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(i&&(i.range.head<h.from||i.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,i));let u=!e.changes.empty||e.flags&2||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),u&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),i&&(this.scrollTarget=i),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(oD)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let i=e.contentDOM,r=window.getComputedStyle(i),n=this.heightOracle,o=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?ti.RTL:ti.LTR;let a=this.heightOracle.mustRefreshForWrapping(o),l=i.getBoundingClientRect(),h=a||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let u=0,c=0;if(l.width&&l.height){let{scaleX:y,scaleY:S}=FO(i,l);(this.scaleX!=y||this.scaleY!=S)&&(this.scaleX=y,this.scaleY=S,u|=8,a=h=!0)}let f=(parseInt(r.paddingTop)||0)*this.scaleY,d=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=f||this.paddingBottom!=d)&&(this.paddingTop=f,this.paddingBottom=d,u|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(h=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=8);let m=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=m&&(this.scrollAnchorHeight=-1,this.scrollTop=m),this.scrolledToBottom=UO(e.scrollDOM);let p=(this.printing?iW:tW)(i,this.paddingTop),v=p.top-this.pixelViewport.top,g=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let _=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(_!=this.inView&&(this.inView=_,_&&(h=!0)),!this.inView&&!this.scrollTarget)return 0;let x=l.width;if((this.contentDOMWidth!=x||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,u|=8),h){let y=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(y)&&(a=!0),a||n.lineWrapping&&Math.abs(x-this.contentDOMWidth)>n.charWidth){let{lineHeight:S,charWidth:w,textHeight:M}=e.docView.measureTextSize();a=S>0&&n.refresh(o,S,w,M,x/w,y),a&&(e.docView.minWidth=0,u|=8)}v>0&&g>0?c=Math.max(v,g):v<0&&g<0&&(c=Math.min(v,g)),n.heightChanged=!1;for(let S of this.viewports){let w=S.from==this.viewport.from?y:e.docView.measureVisibleLineHeights(S);this.heightMap=(a?mn.empty().applyChanges(this.stateDeco,zt.empty,this.heightOracle,[new Fs(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,a,new sb(S.from,w))}n.heightChanged&&(u|=2)}let b=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return b&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(u&2||b)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps,e)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,i){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,o=this.heightOracle,{visibleTop:a,visibleBottom:l}=this,h=new fh(n.lineAt(a-r*1e3,ai.ByHeight,o,0,0).from,n.lineAt(l+(1-r)*1e3,ai.ByHeight,o,0,0).to);if(i){let{head:u}=i.range;if(u<h.from||u>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(u,ai.ByPos,o,0,0),d;i.y=="center"?d=(f.top+f.bottom)/2-c/2:i.y=="start"||i.y=="nearest"&&u<h.from?d=f.top:d=f.bottom-c,h=new fh(n.lineAt(d-1e3/2,ai.ByHeight,o,0,0).from,n.lineAt(d+c+1e3/2,ai.ByHeight,o,0,0).to)}}return h}mapViewport(e,i){let r=i.mapPos(e.from,-1),n=i.mapPos(e.to,1);return new fh(this.heightMap.lineAt(r,ai.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,ai.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:i},r=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,ai.ByPos,this.heightOracle,0,0),{bottom:o}=this.heightMap.lineAt(i,ai.ByPos,this.heightOracle,0,0),{visibleTop:a,visibleBottom:l}=this;return(e==0||n<=a-Math.max(10,Math.min(-r,250)))&&(i==this.state.doc.length||o>=l+Math.max(10,Math.min(r,250)))&&n>a-2*1e3&&o<l+2*1e3}mapLineGaps(e,i){if(!e.length||i.empty)return e;let r=[];for(let n of e)i.touchesRange(n.from,n.to)||r.push(new Sc(i.mapPos(n.from),i.mapPos(n.to),n.size));return r}ensureLineGaps(e,i){let r=this.heightOracle.lineWrapping,n=r?1e4:2e3,o=n>>1,a=n<<1;if(this.defaultTextDirection!=ti.LTR&&!r)return[];let l=[],h=(u,c,f,d)=>{if(c-u<o)return;let m=this.state.selection.main,p=[m.from];m.empty||p.push(m.to);for(let g of p)if(g>u&&g<c){h(u,g-10,f,d),h(g+10,c,f,d);return}let v=nW(e,g=>g.from>=f.from&&g.to<=f.to&&Math.abs(g.from-u)<o&&Math.abs(g.to-c)<o&&!p.some(_=>g.from<_&&g.to>_));if(!v){if(c<f.to&&i&&r&&i.visibleRanges.some(g=>g.from<=c&&g.to>=c)){let g=i.moveToLineBoundary(ge.cursor(c),!1,!0).head;g>u&&(c=g)}v=new Sc(u,c,this.gapSize(f,u,c,d))}l.push(v)};for(let u of this.viewportLines){if(u.length<a)continue;let c=rW(u.from,u.to,this.stateDeco);if(c.total<a)continue;let f=this.scrollTarget?this.scrollTarget.range.head:null,d,m;if(r){let p=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,v,g;if(f!=null){let _=hg(c,f),x=((this.visibleBottom-this.visibleTop)/2+p)/u.height;v=_-x,g=_+x}else v=(this.visibleTop-u.top-p)/u.height,g=(this.visibleBottom-u.top+p)/u.height;d=lg(c,v),m=lg(c,g)}else{let p=c.total*this.heightOracle.charWidth,v=n*this.heightOracle.charWidth,g,_;if(f!=null){let x=hg(c,f),b=((this.pixelViewport.right-this.pixelViewport.left)/2+v)/p;g=x-b,_=x+b}else g=(this.pixelViewport.left-v)/p,_=(this.pixelViewport.right+v)/p;d=lg(c,g),m=lg(c,_)}d>u.from&&h(u.from,d,u,c),m<u.to&&h(m,u.to,u,c)}return l}gapSize(e,i,r,n){let o=hg(n,r)-hg(n,i);return this.heightOracle.lineWrapping?e.height*o:n.total*this.heightOracle.charWidth*o}updateLineGaps(e){Sc.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=yt.set(e.map(i=>i.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let i=[];Xt.spans(e,this.viewport.from,this.viewport.to,{span(n,o){i.push({from:n,to:o})},point(){}},20);let r=i.length!=this.visibleRanges.length||this.visibleRanges.some((n,o)=>n.from!=i[o].from||n.to!=i[o].to);return this.visibleRanges=i,r?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(i=>i.from<=e&&i.to>=e)||vc(this.heightMap.lineAt(e,ai.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return vc(this.heightMap.lineAt(this.scaler.fromDOM(e),ai.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let i=this.lineBlockAtHeight(e+8);return i.from>=this.viewport.from||this.viewportLines[0].top-e>200?i:this.viewportLines[0]}elementAtHeight(e){return vc(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},fh=class{constructor(e,i){this.from=e,this.to=i}};function rW(t,e,i){let r=[],n=t,o=0;return Xt.spans(i,t,e,{span(){},point(a,l){a>n&&(r.push({from:n,to:a}),o+=a-n),n=l}},20),n<e&&(r.push({from:n,to:e}),o+=e-n),{total:o,ranges:r}}function lg({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let r=Math.floor(t*i);for(let n=0;;n++){let{from:o,to:a}=e[n],l=a-o;if(r<=l)return o+r;r-=l}}function hg(t,e){let i=0;for(let{from:r,to:n}of t.ranges){if(e<=n){i+=e-r;break}i+=n-r}return i/t.total}function nW(t,e){for(let i of t)if(e(i))return i}var xO={toDOM(t){return t},fromDOM(t){return t},scale:1},ub=class{constructor(e,i,r){let n=0,o=0,a=0;this.viewports=r.map(({from:l,to:h})=>{let u=i.lineAt(l,ai.ByPos,e,0,0).top,c=i.lineAt(h,ai.ByPos,e,0,0).bottom;return n+=c-u,{from:l,to:h,top:u,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(i.height-n);for(let l of this.viewports)l.domTop=a+(l.top-o)*this.scale,a=l.domBottom=l.domTop+(l.bottom-l.top),o=l.bottom}toDOM(e){for(let i=0,r=0,n=0;;i++){let o=i<this.viewports.length?this.viewports[i]:null;if(!o||e<o.top)return n+(e-r)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);r=o.bottom,n=o.domBottom}}fromDOM(e){for(let i=0,r=0,n=0;;i++){let o=i<this.viewports.length?this.viewports[i]:null;if(!o||e<o.domTop)return r+(e-n)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);r=o.bottom,n=o.domBottom}}};function vc(t,e){if(e.scale==1)return t;let i=e.toDOM(t.top),r=e.toDOM(t.bottom);return new Is(t.from,t.length,i,r-i,Array.isArray(t._content)?t._content.map(n=>vc(n,e)):t._content)}var ug=Ve.define({combine:t=>t.join(" ")}),cb=Ve.define({combine:t=>t.indexOf(!0)>-1}),fb=go.newName(),CD=go.newName(),ED=go.newName(),MD={"&light":"."+CD,"&dark":"."+ED};function db(t,e,i){return new go(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,n=>{if(n=="&")return t;if(!i||!i[n])throw new RangeError(`Unsupported selector: ${n}`);return i[n]}):t+" "+r}})}var sW=db("."+fb,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},MD),_c="\uFFFF",pb=class{constructor(e,i){this.points=e,this.text="",this.lineSeparator=i.facet(Nt.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=_c}readRange(e,i){if(!e)return this;let r=e.parentNode;for(let n=e;;){this.findPointBefore(r,n);let o=this.text.length;this.readNode(n);let a=n.nextSibling;if(a==i)break;let l=hi.get(n),h=hi.get(a);(l&&h?l.breakAfter:(l?l.breakAfter:bO(n))||bO(a)&&(n.nodeName!="BR"||n.cmIgnore)&&this.text.length>o)&&this.lineBreak(),n=a}return this.findPointBefore(r,i),this}readTextNode(e){let i=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,i.length));for(let r=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,a=1,l;if(this.lineSeparator?(o=i.indexOf(this.lineSeparator,r),a=this.lineSeparator.length):(l=n.exec(i))&&(o=l.index,a=l[0].length),this.append(i.slice(r,o<0?i.length:o)),o<0)break;if(this.lineBreak(),a>1)for(let h of this.points)h.node==e&&h.pos>this.text.length&&(h.pos-=a-1);r=o+a}}readNode(e){if(e.cmIgnore)return;let i=hi.get(e),r=i&&i.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let n=r.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,i){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==i&&(r.pos=this.text.length)}findPointInside(e,i){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(oW(e,r.node,r.offset)?i:0))}};function oW(t,e,i){for(;;){if(!e||i<_o(e))return!1;if(e==t)return!0;i=Tc(e)+1,e=e.parentNode}}function bO(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}var Tg=class{constructor(e,i){this.node=e,this.offset=i,this.pos=-1}},mb=class{constructor(e,i,r,n){this.typeOver=n,this.bounds=null,this.text="";let{impreciseHead:o,impreciseAnchor:a}=e.docView;if(e.state.readOnly&&i>-1)this.newSel=null;else if(i>-1&&(this.bounds=e.docView.domBoundsAround(i,r,0))){let l=o||a?[]:hW(e),h=new pb(l,e.state);h.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=h.text,this.newSel=uW(l,this.bounds.from)}else{let l=e.observer.selectionRange,h=o&&o.node==l.focusNode&&o.offset==l.focusOffset||!Gx(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),u=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!Gx(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset),c=e.viewport;if((qe.ios||qe.chrome)&&e.state.selection.main.empty&&h!=u&&(c.from>0||c.to<e.state.doc.length)){let f=Math.min(h,u),d=Math.max(h,u),m=c.from-f,p=c.to-d;(m==0||m==1||f==0)&&(p==0||p==-1||d==e.state.doc.length)&&(h=0,u=e.state.doc.length)}this.newSel=ge.single(u,h)}}};function TD(t,e){let i,{newSel:r}=e,n=t.state.selection.main,o=t.inputState.lastKeyTime>Date.now()-100?t.inputState.lastKeyCode:-1;if(e.bounds){let{from:a,to:l}=e.bounds,h=n.from,u=null;(o===8||qe.android&&e.text.length<l-a)&&(h=n.to,u="end");let c=lW(t.state.doc.sliceString(a,l,_c),e.text,h-a,u);c&&(qe.chrome&&o==13&&c.toB==c.from+2&&e.text.slice(c.from,c.toB)==_c+_c&&c.toB--,i={from:a+c.from,to:a+c.toA,insert:zt.of(e.text.slice(c.from,c.toB).split(_c))})}else r&&(!t.hasFocus&&t.state.facet(Og)||r.main.eq(n))&&(r=null);if(!i&&!r)return!1;if(!i&&e.typeOver&&!n.empty&&r&&r.main.empty?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,n.to)}:i&&i.from>=n.from&&i.to<=n.to&&(i.from!=n.from||i.to!=n.to)&&n.to-n.from-(i.to-i.from)<=4?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,n.to))}:(qe.mac||qe.android)&&i&&i.from==i.to&&i.from==n.head-1&&/^\. ?$/.test(i.insert.toString())&&t.contentDOM.getAttribute("autocorrect")=="off"?(r&&i.insert.length==2&&(r=ge.single(r.main.anchor-1,r.main.head-1)),i={from:n.from,to:n.to,insert:zt.of([" "])}):qe.chrome&&i&&i.from==i.to&&i.from==n.head&&i.insert.toString()==`
 `&&t.lineWrapping&&(r&&(r=ge.single(r.main.anchor-1,r.main.head-1)),i={from:n.from,to:n.to,insert:zt.of([" "])}),i){if(qe.ios&&t.inputState.flushIOSKey()||qe.android&&(i.from==n.from&&i.to==n.to&&i.insert.length==1&&i.insert.lines==2&&mh(t.contentDOM,"Enter",13)||(i.from==n.from-1&&i.to==n.to&&i.insert.length==0||o==8&&i.insert.length<i.to-i.from&&i.to>n.head)&&mh(t.contentDOM,"Backspace",8)||i.from==n.from&&i.to==n.to+1&&i.insert.length==0&&mh(t.contentDOM,"Delete",46)))return!0;let a=i.insert.toString();t.inputState.composing>=0&&t.inputState.composing++;let l,h=()=>l||(l=aW(t,i,r));return t.state.facet(rD).some(u=>u(t,i.from,i.to,a,h))||t.dispatch(h()),!0}else if(r&&!r.main.eq(n)){let a=!1,l="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(a=!0),l=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:a,userEvent:l}),!0}else return!1}function aW(t,e,i){let r,n=t.state,o=n.selection.main;if(e.from>=o.from&&e.to<=o.to&&e.to-e.from>=(o.to-o.from)/3&&(!i||i.main.empty&&i.main.from==e.from+e.insert.length)&&t.inputState.composing<0){let l=o.from<e.from?n.sliceDoc(o.from,e.from):"",h=o.to>e.to?n.sliceDoc(e.to,o.to):"";r=n.replaceSelection(t.state.toText(l+e.insert.sliceString(0,void 0,t.state.lineBreak)+h))}else{let l=n.changes(e),h=i&&i.main.to<=l.newLength?i.main:void 0;if(n.selection.ranges.length>1&&t.inputState.composing>=0&&e.to<=o.to&&e.to>=o.to-10){let u=t.state.sliceDoc(e.from,e.to),c,f=i&&fD(t,i.main.head);if(f){let p=e.insert.length-(e.to-e.from);c={from:f.from,to:f.to-p}}else c=t.state.doc.lineAt(o.head);let d=o.to-e.to,m=o.to-o.from;r=n.changeByRange(p=>{if(p.from==o.from&&p.to==o.to)return{changes:l,range:h||p.map(l)};let v=p.to-d,g=v-u.length;if(p.to-p.from!=m||t.state.sliceDoc(g,v)!=u||p.to>=c.from&&p.from<=c.to)return{range:p};let _=n.changes({from:g,to:v,insert:e.insert}),x=p.to-o.to;return{changes:_,range:h?ge.range(Math.max(0,h.anchor+x),Math.max(0,h.head+x)):p.map(_)}})}else r={changes:l,selection:h&&n.selection.replaceRange(h)}}let a="input.type";return(t.composing||t.inputState.compositionPendingChange&&t.inputState.compositionEndedAt>Date.now()-50)&&(t.inputState.compositionPendingChange=!1,a+=".compose",t.inputState.compositionFirstChange&&(a+=".start",t.inputState.compositionFirstChange=!1)),n.update(r,{userEvent:a,scrollIntoView:!0})}function lW(t,e,i,r){let n=Math.min(t.length,e.length),o=0;for(;o<n&&t.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==n&&t.length==e.length)return null;let a=t.length,l=e.length;for(;a>0&&l>0&&t.charCodeAt(a-1)==e.charCodeAt(l-1);)a--,l--;if(r=="end"){let h=Math.max(0,o-Math.min(a,l));i-=a+h-o}if(a<o&&t.length<e.length){let h=i<=o&&i>=a?o-i:0;o-=h,l=o+(l-a),a=o}else if(l<o){let h=i<=o&&i>=l?o-i:0;o-=h,a=o+(a-l),l=o}return{from:o,toA:a,toB:l}}function hW(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:r,focusNode:n,focusOffset:o}=t.observer.selectionRange;return i&&(e.push(new Tg(i,r)),(n!=i||o!=r)&&e.push(new Tg(n,o))),e}function uW(t,e){if(t.length==0)return null;let i=t[0].pos,r=t.length==2?t[1].pos:i;return i>-1&&r>-1?ge.single(i+e,r+e):null}var cW={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Bx=qe.ie&&qe.ie_version<=11,gb=class{constructor(e){this.view=e,this.active=!1,this.selectionRange=new Hx,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(i=>{for(let r of i)this.queue.push(r);(qe.ie&&qe.ie_version<=11||qe.ios&&e.composing)&&i.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),Bx&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var i;((i=this.view.docView)===null||i===void 0?void 0:i.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(i=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),i.length>0&&i[i.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(i=>{i.length>0&&i[i.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((i,r)=>i!=e[r]))){this.gapIntersection.disconnect();for(let i of e)this.gapIntersection.observe(i);this.gaps=e}}onSelectionChange(e){let i=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(Og)?r.root.activeElement!=this.dom:!fg(r.dom,n))return;let o=n.anchorNode&&r.docView.nearest(n.anchorNode);if(o&&o.ignoreEvent(e)){i||(this.selectionChanged=!1);return}(qe.ie&&qe.ie_version<=11||qe.android&&qe.chrome)&&!r.state.selection.main.empty&&n.focusNode&&yc(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,i=qe.safari&&e.root.nodeType==11&&i8(this.dom.ownerDocument)==this.dom&&fW(this.view)||_g(e.root);if(!i||this.selectionRange.eq(i))return!1;let r=fg(this.dom,i);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&a8(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,i){this.selectionRange.set(e.node,e.offset,i.node,i.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,i=null;for(let r=this.dom;r;)if(r.nodeType==1)!i&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:i||(i=this.scrollTargets.slice(0,e)),i&&i.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!i&&(i=this.scrollTargets.slice(0,e)),i){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=i)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,cW),Bx&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Bx&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,i){var r;if(!this.delayedAndroidKey){let n=()=>{let o=this.delayedAndroidKey;o&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=o.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&o.force&&mh(this.dom,o.key,o.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:i,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let i=-1,r=-1,n=!1;for(let o of e){let a=this.readMutation(o);a&&(a.typeOver&&(n=!0),i==-1?{from:i,to:r}=a:(i=Math.min(a.from,i),r=Math.max(a.to,r)))}return{from:i,to:r,typeOver:n}}readChange(){let{from:e,to:i,typeOver:r}=this.processRecords(),n=this.selectionChanged&&fg(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let o=new mb(this.view,e,i,r);return this.view.docView.domChanged={newSel:o.newSel?o.newSel.main:null},o}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let i=this.readChange();if(!i)return this.view.requestMeasure(),!1;let r=this.view.state,n=TD(this.view,i);return this.view.state==r&&this.view.update([]),n}readMutation(e){let i=this.view.docView.nearest(e.target);if(!i||i.ignoreMutation(e))return null;if(i.markDirty(e.type=="attributes"),e.type=="attributes"&&(i.flags|=4),e.type=="childList"){let r=wO(i,e.previousSibling||e.target.previousSibling,-1),n=wO(i,e.nextSibling||e.target.nextSibling,1);return{from:r?i.posAfter(r):i.posAtStart,to:n?i.posBefore(n):i.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:i.posAtStart,to:i.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,i,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(i=this.gapIntersection)===null||i===void 0||i.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}};function wO(t,e,i){for(;e;){let r=hi.get(e);if(r&&r.parent==t)return r;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function fW(t){let e=null;function i(h){h.preventDefault(),h.stopImmediatePropagation(),e=h.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let r=e.startContainer,n=e.startOffset,o=e.endContainer,a=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);return yc(l.node,l.offset,o,a)&&([r,n,o,a]=[o,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:o,focusOffset:a}}var ze=class t{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(r=>r.forEach(n=>i(n,this)))||(r=>this.update(r)),this.dispatch=this.dispatch.bind(this),this._root=e.root||o8(e.parent)||document,this.viewState=new Mg(e.state||Nt.create(e)),e.scrollTo&&e.scrollTo.is(sg)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(mc).map(r=>new wc(r));for(let r of this.plugins)r.update(this);this.observer=new gb(this),this.inputState=new tb(this),this.inputState.ensureHandlers(this.plugins),this.docView=new Sg(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure()}dispatch(...e){let i=e.length==1&&e[0]instanceof Yi?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(i,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let i=!1,r=!1,n,o=this.state;for(let d of e){if(d.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=d.state}if(this.destroyed){this.viewState.state=o;return}let a=this.hasFocus,l=0,h=null;e.some(d=>d.annotation(bD))?(this.inputState.notifiedFocused=a,l=1):a!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=a,h=wD(o,a),h||(l=1));let u=this.observer.delayedAndroidKey,c=null;if(u?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(o.doc)||!this.state.selection.eq(o.selection))&&(c=null)):this.observer.clear(),o.facet(Nt.phrases)!=this.state.facet(Nt.phrases))return this.setState(o);n=wg.create(this,o,e),n.flags|=l;let f=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(f&&(f=f.map(d.changes)),d.scrollIntoView){let{main:m}=d.state.selection;f=new bc(m.empty?m:ge.cursor(m.head,m.head>m.anchor?-1:1))}for(let m of d.effects)m.is(sg)&&(f=m.value.clip(this.state))}this.viewState.update(n,f),this.bidiCache=Ag.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),i=this.docView.update(n),this.state.facet(gc)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(ug)!=n.state.facet(ug)&&(this.viewState.mustMeasureContent=!0),(i||r||f||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let d of this.state.facet(Jx))try{d(n)}catch(m){pn(this.state,m,"update listener")}(h||c)&&Promise.resolve().then(()=>{h&&this.state==h.startState&&this.dispatch(h),c&&!TD(this,c)&&u.force&&mh(this.contentDOM,u.key,u.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let i=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new Mg(e),this.plugins=e.facet(mc).map(r=>new wc(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new Sg(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}i&&this.focus(),this.requestMeasure()}updatePlugins(e){let i=e.startState.facet(mc),r=e.state.facet(mc);if(i!=r){let n=[];for(let o of r){let a=i.indexOf(o);if(a<0)n.push(new wc(o));else{let l=this.plugins[a];l.mustUpdate=e,n.push(l)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);i!=r&&this.inputState.ensureHandlers(this.plugins)}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let i=null,r=this.scrollDOM,n=r.scrollTop*this.scaleY,{scrollAnchorPos:o,scrollAnchorHeight:a}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(a=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(a<0)if(UO(r))o=-1,a=this.viewState.heightMap.height;else{let m=this.viewState.scrollAnchorAt(n);o=m.from,a=m.top}this.updateState=1;let h=this.viewState.measure(this);if(!h&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];h&4||([this.measureRequests,u]=[u,this.measureRequests]);let c=u.map(m=>{try{return m.read(this)}catch(p){return pn(this.state,p),SO}}),f=wg.create(this,this.state,[]),d=!1;f.flags|=h,i?i.flags|=h:i=f,this.updateState=2,f.empty||(this.updatePlugins(f),this.inputState.update(f),this.updateAttrs(),d=this.docView.update(f));for(let m=0;m<u.length;m++)if(c[m]!=SO)try{let p=u[m];p.write&&p.write(c[m],this)}catch(p){pn(this.state,p)}if(d&&this.docView.updateSelection(!0),!f.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,a=-1;continue}else{let p=(o<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(o).top)-a;if(p>1||p<-1){n=n+p,r.scrollTop=n/this.scaleY,a=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(i&&!i.empty)for(let l of this.state.facet(Jx))l(i)}get themeClasses(){return fb+" "+(this.state.facet(cb)?ED:CD)+" "+this.state.facet(ug)}updateAttrs(){let e=CO(this,aD,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),i={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Og)?"true":"false",class:"cm-content",style:`${qe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(i["aria-readonly"]="true"),CO(this,Ob,i);let r=this.observer.ignore(()=>{let n=Xx(this.contentDOM,this.contentAttrs,i),o=Xx(this.dom,this.editorAttrs,e);return n||o});return this.editorAttrs=e,this.contentAttrs=i,r}showAnnouncements(e){let i=!0;for(let r of e)for(let n of r.effects)if(n.is(t.announce)){i&&(this.announceDOM.textContent=""),i=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(gc);let e=this.state.facet(t.cspNonce);go.mount(this.root,this.styleModules.concat(sW).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===e.key){this.measureRequests[i]=e;return}}this.measureRequests.push(e)}}plugin(e){let i=this.pluginMap.get(e);return(i===void 0||i&&i.spec!=e)&&this.pluginMap.set(e,i=this.plugins.find(r=>r.spec==e)||null),i&&i.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,i,r){return Fx(this,e,lO(this,e,i,r))}moveByGroup(e,i){return Fx(this,e,lO(this,e,i,r=>F8(this,e.head,r)))}visualLineSide(e,i){let r=this.bidiSpans(e),n=this.textDirectionAt(e.from),o=r[i?r.length-1:0];return ge.cursor(o.side(i,n)+e.from,o.forward(!i,n)?1:-1)}moveToLineBoundary(e,i,r=!0){return k8(this,e,i,r)}moveVertically(e,i,r){return Fx(this,e,B8(this,e,i,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,i=0){return this.docView.posFromDOM(e,i)}posAtCoords(e,i=!0){return this.readMeasured(),pD(this,e,i)}coordsAtPos(e,i=1){this.readMeasured();let r=this.docView.coordsAt(e,i);if(!r||r.left==r.right)return r;let n=this.state.doc.lineAt(e),o=this.bidiSpans(n),a=o[ks.find(o,e-n.from,-1,i)];return Ab(r,a.dir==ti.LTR==i>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(sD)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>dW)return QO(e.length);let i=this.textDirectionAt(e.from),r;for(let o of this.bidiCache)if(o.from==e.from&&o.dir==i&&(o.fresh||KO(o.isolates,r=rO(this,e))))return o.order;r||(r=rO(this,e));let n=y8(e.text,i,r);return this.bidiCache.push(new Ag(e.from,e.to,i,r,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||qe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{BO(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,i={}){return sg.of(new bc(typeof e=="number"?ge.cursor(e):e,i.y,i.x,i.yMargin,i.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:i}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return sg.of(new bc(ge.cursor(r.from),"start","start",r.top-e,i,!0))}static domEventHandlers(e){return Ki.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Ki.define(()=>({}),{eventObservers:e})}static theme(e,i){let r=go.newName(),n=[ug.of(r),gc.of(db(`.${r}`,e))];return i&&i.dark&&n.push(cb.of(!0)),n}static baseTheme(e){return Os.lowest(gc.of(db("."+fb,e,MD)))}static findFromDOM(e){var i;let r=e.querySelector(".cm-content"),n=r&&hi.get(r)||hi.get(e);return((i=n==null?void 0:n.rootView)===null||i===void 0?void 0:i.view)||null}};ze.styleModule=gc;ze.inputHandler=rD;ze.focusChangeEffect=nD;ze.perLineTextDirection=sD;ze.exceptionSink=iD;ze.updateListener=Jx;ze.editable=Og;ze.mouseSelectionStyle=tD;ze.dragMovesSelection=eD;ze.clickAddsSelectionRange=$O;ze.decorations=Lc;ze.outerDecorations=lD;ze.atomicRanges=Db;ze.bidiIsolatedRanges=hD;ze.scrollMargins=uD;ze.darkTheme=cb;ze.cspNonce=Ve.define({combine:t=>t.length?t[0]:""});ze.contentAttributes=Ob;ze.editorAttributes=aD;ze.lineWrapping=ze.contentAttributes.of({class:"cm-lineWrapping"});ze.announce=Dt.define();var dW=4096,SO={},Ag=class t{constructor(e,i,r,n,o,a){this.from=e,this.to=i,this.dir=r,this.isolates=n,this.fresh=o,this.order=a}static update(e,i){if(i.empty&&!e.some(o=>o.fresh))return e;let r=[],n=e.length?e[e.length-1].dir:ti.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let a=e[o];a.dir==n&&!i.touchesRange(a.from,a.to)&&r.push(new t(i.mapPos(a.from,1),i.mapPos(a.to,-1),a.dir,a.isolates,!1,a.order))}return r}};function CO(t,e,i){for(let r=t.state.facet(e),n=r.length-1;n>=0;n--){let o=r[n],a=typeof o=="function"?o(t):o;a&&qx(a,i)}return i}var pW=qe.mac?"mac":qe.windows?"win":qe.linux?"linux":"key";function mW(t,e){let i=t.split(/-(?!$)/),r=i[i.length-1];r=="Space"&&(r=" ");let n,o,a,l;for(let h=0;h<i.length-1;++h){let u=i[h];if(/^(cmd|meta|m)$/i.test(u))l=!0;else if(/^a(lt)?$/i.test(u))n=!0;else if(/^(c|ctrl|control)$/i.test(u))o=!0;else if(/^s(hift)?$/i.test(u))a=!0;else if(/^mod$/i.test(u))e=="mac"?l=!0:o=!0;else throw new Error("Unrecognized modifier name: "+u)}return n&&(r="Alt-"+r),o&&(r="Ctrl-"+r),l&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function cg(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),i!==!1&&e.shiftKey&&(t="Shift-"+t),t}var gW=Os.default(ze.domEventHandlers({keydown(t,e){return RD(AD(e.state),t,e,"editor")}})),$a=Ve.define({enables:gW}),EO=new WeakMap;function AD(t){let e=t.facet($a),i=EO.get(e);return i||EO.set(e,i=_W(e.reduce((r,n)=>r.concat(n),[]))),i}function PD(t,e,i){return RD(AD(t.state),e,t,i)}var Jo=null,vW=4e3;function _W(t,e=pW){let i=Object.create(null),r=Object.create(null),n=(a,l)=>{let h=r[a];if(h==null)r[a]=l;else if(h!=l)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},o=(a,l,h,u,c)=>{var f,d;let m=i[a]||(i[a]=Object.create(null)),p=l.split(/ (?!$)/).map(_=>mW(_,e));for(let _=1;_<p.length;_++){let x=p.slice(0,_).join(" ");n(x,!0),m[x]||(m[x]={preventDefault:!0,stopPropagation:!1,run:[b=>{let y=Jo={view:b,prefix:x,scope:a};return setTimeout(()=>{Jo==y&&(Jo=null)},vW),!0}]})}let v=p.join(" ");n(v,!1);let g=m[v]||(m[v]={preventDefault:!1,stopPropagation:!1,run:((d=(f=m._any)===null||f===void 0?void 0:f.run)===null||d===void 0?void 0:d.slice())||[]});h&&g.run.push(h),u&&(g.preventDefault=!0),c&&(g.stopPropagation=!0)};for(let a of t){let l=a.scope?a.scope.split(" "):["editor"];if(a.any)for(let u of l){let c=i[u]||(i[u]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});for(let f in c)c[f].run.push(a.any)}let h=a[e]||a.key;if(h)for(let u of l)o(u,h,a.run,a.preventDefault,a.stopPropagation),a.shift&&o(u,"Shift-"+h,a.shift,a.preventDefault,a.stopPropagation)}return i}function RD(t,e,i,r){let n=ZL(e),o=Bi(n,0),a=Lr(o)==n.length&&n!=" ",l="",h=!1,u=!1,c=!1;Jo&&Jo.view==i&&Jo.scope==r&&(l=Jo.prefix+" ",gD.indexOf(e.keyCode)<0&&(u=!0,Jo=null));let f=new Set,d=g=>{if(g){for(let _ of g.run)if(!f.has(_)&&(f.add(_),_(i,e)))return g.stopPropagation&&(c=!0),!0;g.preventDefault&&(g.stopPropagation&&(c=!0),u=!0)}return!1},m=t[r],p,v;return m&&(d(m[l+cg(n,e,!a)])?h=!0:a&&(e.altKey||e.metaKey||e.ctrlKey)&&!(qe.windows&&e.ctrlKey&&e.altKey)&&(p=vo[e.keyCode])&&p!=n?(d(m[l+cg(p,e,!0)])||e.shiftKey&&(v=uh[e.keyCode])!=n&&v!=p&&d(m[l+cg(v,e,!1)]))&&(h=!0):a&&e.shiftKey&&d(m[l+cg(n,e,!0)])&&(h=!0),!h&&d(m._any)&&(h=!0)),u&&(h=!0),h&&c&&e.stopPropagation(),h}var Oc=class t{constructor(e,i,r,n,o){this.className=e,this.left=i,this.top=r,this.width=n,this.height=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,i){return i.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,i,r){if(r.empty){let n=e.coordsAtPos(r.head,r.assoc||1);if(!n)return[];let o=LD(e);return[new t(i,n.left-o.left,n.top-o.top,null,n.bottom-n.top)]}else return yW(e,i,r)}};function LD(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==ti.LTR?e.left:e.right-t.scrollDOM.clientWidth*t.scaleX)-t.scrollDOM.scrollLeft*t.scaleX,top:e.top-t.scrollDOM.scrollTop*t.scaleY}}function MO(t,e,i){let r=ge.cursor(e);return{from:Math.max(i.from,t.moveToLineBoundary(r,!1,!0).from),to:Math.min(i.to,t.moveToLineBoundary(r,!0,!0).from),type:Ir.Text}}function yW(t,e,i){if(i.to<=t.viewport.from||i.from>=t.viewport.to)return[];let r=Math.max(i.from,t.viewport.from),n=Math.min(i.to,t.viewport.to),o=t.textDirection==ti.LTR,a=t.contentDOM,l=a.getBoundingClientRect(),h=LD(t),u=a.querySelector(".cm-line"),c=u&&window.getComputedStyle(u),f=l.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=l.right-(c?parseInt(c.paddingRight):0),m=eb(t,r),p=eb(t,n),v=m.type==Ir.Text?m:null,g=p.type==Ir.Text?p:null;if(v&&(t.lineWrapping||m.widgetLineBreaks)&&(v=MO(t,r,v)),g&&(t.lineWrapping||p.widgetLineBreaks)&&(g=MO(t,n,g)),v&&g&&v.from==g.from)return x(b(i.from,i.to,v));{let S=v?b(i.from,null,v):y(m,!1),w=g?b(null,i.to,g):y(p,!0),M=[];return(v||m).to<(g||p).from-(v&&g?1:0)||m.widgetLineBreaks>1&&S.bottom+t.defaultLineHeight/2<w.top?M.push(_(f,S.bottom,d,w.top)):S.bottom<w.top&&t.elementAtHeight((S.bottom+w.top)/2).type==Ir.Text&&(S.bottom=w.top=(S.bottom+w.top)/2),x(S).concat(M).concat(x(w))}function _(S,w,M,C){return new Oc(e,S-h.left,w-h.top-.01,M-S,C-w+.01)}function x({top:S,bottom:w,horizontal:M}){let C=[];for(let E=0;E<M.length;E+=2)C.push(_(M[E],S,M[E+1],w));return C}function b(S,w,M){let C=1e9,E=-1e9,P=[];function A(I,L,T,O,D){let F=t.coordsAtPos(I,I==M.to?-2:2),B=t.coordsAtPos(T,T==M.from?2:-2);!F||!B||(C=Math.min(F.top,B.top,C),E=Math.max(F.bottom,B.bottom,E),D==ti.LTR?P.push(o&&L?f:F.left,o&&O?d:B.right):P.push(!o&&O?f:B.left,!o&&L?d:F.right))}let R=S!=null?S:M.from,k=w!=null?w:M.to;for(let I of t.visibleRanges)if(I.to>R&&I.from<k)for(let L=Math.max(I.from,R),T=Math.min(I.to,k);;){let O=t.state.doc.lineAt(L);for(let D of t.bidiSpans(O)){let F=D.from+O.from,B=D.to+O.from;if(F>=T)break;B>L&&A(Math.max(F,L),S==null&&F<=R,Math.min(B,T),w==null&&B>=k,D.dir)}if(L=O.to+1,L>=T)break}return P.length==0&&A(R,S==null,k,w==null,t.textDirection),{top:C,bottom:E,horizontal:P}}function y(S,w){let M=l.top+(w?S.top:S.bottom);return{top:M,bottom:M,horizontal:[]}}}function xW(t,e){return t.constructor==e.constructor&&t.eq(e)}var vb=class{constructor(e,i){this.view=e,this.layer=i,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),i.above&&this.dom.classList.add("cm-layer-above"),i.class&&this.dom.classList.add(i.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),i.mount&&i.mount(this.dom,e)}update(e){e.startState.facet(mg)!=e.state.facet(mg)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}setOrder(e){let i=0,r=e.facet(mg);for(;i<r.length&&r[i]!=this.layer;)i++;this.dom.style.zIndex=String((this.layer.above?150:-1)-i)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:i}=this.view;(e!=this.scaleX||i!=this.scaleY)&&(this.scaleX=e,this.scaleY=i,this.dom.style.transform=`scale(${1/e}, ${1/i})`)}draw(e){if(e.length!=this.drawn.length||e.some((i,r)=>!xW(i,this.drawn[r]))){let i=this.dom.firstChild,r=0;for(let n of e)n.update&&i&&n.constructor&&this.drawn[r].constructor&&n.update(i,this.drawn[r])?(i=i.nextSibling,r++):this.dom.insertBefore(n.draw(),i);for(;i;){let n=i.nextSibling;i.remove(),i=n}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}},mg=Ve.define();function OD(t){return[Ki.define(e=>new vb(e,t)),mg.of(t)]}var DD=!qe.ios,Dc=Ve.define({combine(t){return Qr(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,i)=>Math.min(e,i),drawRangeCursor:(e,i)=>e||i})}});function Dg(t={}){return[Dc.of(t),bW,wW,SW,oD.of(!0)]}function ID(t){return t.startState.facet(Dc)!=t.state.facet(Dc)}var bW=OD({above:!0,markers(t){let{state:e}=t,i=e.facet(Dc),r=[];for(let n of e.selection.ranges){let o=n==e.selection.main;if(n.empty?!o||DD:i.drawRangeCursor){let a=o?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=n.empty?n:ge.cursor(n.head,n.head>n.anchor?-1:1);for(let h of Oc.forRange(t,a,l))r.push(h)}}return r},update(t,e){t.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let i=ID(t);return i&&TO(t.state,e),t.docChanged||t.selectionSet||i},mount(t,e){TO(e.state,t)},class:"cm-cursorLayer"});function TO(t,e){e.style.animationDuration=t.facet(Dc).cursorBlinkRate+"ms"}var wW=OD({above:!1,markers(t){return t.state.selection.ranges.map(e=>e.empty?[]:Oc.forRange(t,"cm-selectionBackground",e)).reduce((e,i)=>e.concat(i))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||ID(t)},class:"cm-selectionLayer"}),_b={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};DD&&(_b[".cm-line"].caretColor="transparent !important",_b[".cm-content"]={caretColor:"transparent !important"});var SW=Os.highest(ze.theme(_b));function AO(t,e,i,r,n){e.lastIndex=0;for(let o=t.iterRange(i,r),a=i,l;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;l=e.exec(o.value);)n(a+l.index,l)}function CW(t,e){let i=t.visibleRanges;if(i.length==1&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let r=[];for(let{from:n,to:o}of i)n=Math.max(t.state.doc.lineAt(n).from,n-e),o=Math.min(t.state.doc.lineAt(o).to,o+e),r.length&&r[r.length-1].to>=n?r[r.length-1].to=o:r.push({from:n,to:o});return r}var yb=class{constructor(e){let{regexp:i,decoration:r,decorate:n,boundary:o,maxLength:a=1e3}=e;if(!i.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=i,n)this.addMatch=(l,h,u,c)=>n(c,u,u+l[0].length,l,h);else if(typeof r=="function")this.addMatch=(l,h,u,c)=>{let f=r(l,h,u);f&&c(u,u+l[0].length,f)};else if(r)this.addMatch=(l,h,u,c)=>c(u,u+l[0].length,r);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=o,this.maxLength=a}createDeco(e){let i=new os,r=i.add.bind(i);for(let{from:n,to:o}of CW(e,this.maxLength))AO(e.state.doc,this.regexp,n,o,(a,l)=>this.addMatch(l,e,a,r));return i.finish()}updateDeco(e,i){let r=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((o,a,l,h)=>{h>e.view.viewport.from&&l<e.view.viewport.to&&(r=Math.min(l,r),n=Math.max(h,n))}),e.viewportChanged||n-r>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,i.map(e.changes),r,n):i}updateRange(e,i,r,n){for(let o of e.visibleRanges){let a=Math.max(o.from,r),l=Math.min(o.to,n);if(l>a){let h=e.state.doc.lineAt(a),u=h.to<l?e.state.doc.lineAt(l):h,c=Math.max(o.from,h.from),f=Math.min(o.to,u.to);if(this.boundary){for(;a>h.from;a--)if(this.boundary.test(h.text[a-1-h.from])){c=a;break}for(;l<u.to;l++)if(this.boundary.test(u.text[l-u.from])){f=l;break}}let d=[],m,p=(v,g,_)=>d.push(_.range(v,g));if(h==u)for(this.regexp.lastIndex=c-h.from;(m=this.regexp.exec(h.text))&&m.index<f-h.from;)this.addMatch(m,e,m.index+h.from,p);else AO(e.state.doc,this.regexp,c,f,(v,g)=>this.addMatch(g,e,v,p));i=i.update({filterFrom:c,filterTo:f,filter:(v,g)=>v<c||g>f,add:d})}}return i}},xb=/x/.unicode!=null?"gu":"g",EW=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,xb),MW={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"},Nx=null;function TW(){var t;if(Nx==null&&typeof document!="undefined"&&document.body){let e=document.body.style;Nx=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return Nx||!1}var gg=Ve.define({combine(t){let e=Qr(t,{render:null,specialChars:EW,addSpecialChars:null});return(e.replaceTabs=!TW())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,xb)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,xb)),e}});function Ig(t={}){return[gg.of(t),AW()]}var PO=null;function AW(){return PO||(PO=Ki.fromClass(class{constructor(t){this.view=t,this.decorations=yt.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(gg)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new yb({regexp:t.specialChars,decoration:(e,i,r)=>{let{doc:n}=i.state,o=Bi(e[0],0);if(o==9){let a=n.lineAt(r),l=i.state.tabSize,h=mo(a.text,l,r-a.from);return yt.replace({widget:new wb((l-h%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[o]||(this.decorationCache[o]=yt.replace({widget:new bb(t,o)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(gg);t.startState.facet(gg)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))}var PW="\u2022";function RW(t){return t>=32?PW:t==10?"\u2424":String.fromCharCode(9216+t)}var bb=class extends as{constructor(e,i){super(),this.options=e,this.code=i}eq(e){return e.code==this.code}toDOM(e){let i=RW(this.code),r=e.state.phrase("Control character")+" "+(MW[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,r,i);if(n)return n;let o=document.createElement("span");return o.textContent=i,o.title=r,o.setAttribute("aria-label",r),o.className="cm-specialChar",o}ignoreEvent(){return!1}},wb=class extends as{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}};function kg(){return OW}var LW=yt.line({class:"cm-activeLine"}),OW=Ki.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let r of t.state.selection.ranges){let n=t.lineBlockAt(r.head);n.from>e&&(i.push(LW.range(n.from)),e=n.from)}return yt.set(i)}},{decorations:t=>t.decorations});var Sb=2e3;function DW(t,e,i){let r=Math.min(e.line,i.line),n=Math.max(e.line,i.line),o=[];if(e.off>Sb||i.off>Sb||e.col<0||i.col<0){let a=Math.min(e.off,i.off),l=Math.max(e.off,i.off);for(let h=r;h<=n;h++){let u=t.doc.line(h);u.length<=l&&o.push(ge.range(u.from+a,u.to+l))}}else{let a=Math.min(e.col,i.col),l=Math.max(e.col,i.col);for(let h=r;h<=n;h++){let u=t.doc.line(h),c=ig(u.text,a,t.tabSize,!0);if(c<0)o.push(ge.cursor(u.to));else{let f=ig(u.text,l,t.tabSize);o.push(ge.range(u.from+c,u.from+f))}}}return o}function IW(t,e){let i=t.coordsAtPos(t.viewport.from);return i?Math.round(Math.abs((i.left-e)/t.defaultCharacterWidth)):-1}function RO(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),r=t.state.doc.lineAt(i),n=i-r.from,o=n>Sb?-1:n==r.length?IW(t,e.clientX):mo(r.text,t.state.tabSize,i-r.from);return{line:r.number,col:o,off:n}}function kW(t,e){let i=RO(t,e),r=t.state.selection;return i?{update(n){if(n.docChanged){let o=n.changes.mapPos(n.startState.doc.line(i.line).from),a=n.state.doc.lineAt(o);i={line:a.number,col:i.col,off:Math.min(i.off,a.length)},r=r.map(n.changes)}},get(n,o,a){let l=RO(t,n);if(!l)return r;let h=DW(t.state,i,l);return h.length?a?ge.create(h.concat(r.ranges)):ge.create(h):r}}:null}function Fg(t){let e=(t==null?void 0:t.eventFilter)||(i=>i.altKey&&i.button==0);return ze.mouseSelectionStyle.of((i,r)=>e(r)?kW(i,r):null)}var pc="-10000px",Cb=class{constructor(e,i,r,n){this.facet=i,this.createTooltipView=r,this.removeTooltipView=n,this.input=e.state.facet(i),this.tooltips=this.input.filter(a=>a);let o=null;this.tooltipViews=this.tooltips.map(a=>o=r(a,o))}update(e,i){var r;let n=e.state.facet(this.facet),o=n.filter(h=>h);if(n===this.input){for(let h of this.tooltipViews)h.update&&h.update(e);return!1}let a=[],l=i?[]:null;for(let h=0;h<o.length;h++){let u=o[h],c=-1;if(u){for(let f=0;f<this.tooltips.length;f++){let d=this.tooltips[f];d&&d.create==u.create&&(c=f)}if(c<0)a[h]=this.createTooltipView(u,h?a[h-1]:null),l&&(l[h]=!!u.above);else{let f=a[h]=this.tooltipViews[c];l&&(l[h]=i[c]),f.update&&f.update(e)}}}for(let h of this.tooltipViews)a.indexOf(h)<0&&(this.removeTooltipView(h),(r=h.destroy)===null||r===void 0||r.call(h));return i&&(l.forEach((h,u)=>i[u]=h),i.length=l.length),this.input=n,this.tooltips=o,this.tooltipViews=a,!0}};function FW(t){let{win:e}=t;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}var Ux=Ve.define({combine:t=>{var e,i,r;return{position:qe.ios?"absolute":((e=t.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((i=t.find(n=>n.parent))===null||i===void 0?void 0:i.parent)||null,tooltipSpace:((r=t.find(n=>n.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||FW}}}),LO=new WeakMap,kD=Ki.fromClass(class{constructor(t){this.view=t,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(Ux);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new Cb(t,Ib,(i,r)=>this.createTooltip(i,r),i=>{this.resizeObserver&&this.resizeObserver.unobserve(i.dom),i.dom.remove()}),this.above=this.manager.tooltips.map(i=>!!i.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t,this.above);e&&this.observeIntersection();let i=e||t.geometryChanged,r=t.state.facet(Ux);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;i=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t,e){let i=t.create(this.view),r=e?e.dom:null;if(i.dom.classList.add("cm-tooltip"),t.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",i.dom.insertBefore(n,r)}return i.dom.style.position=this.position,i.dom.style.top=pc,i.dom.style.left="0px",this.container.insertBefore(i.dom,r),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var t,e,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(t=r.destroy)===null||t===void 0||t.call(r);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(i=this.intersectionObserver)===null||i===void 0||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect(),e=1,i=1,r=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:n}=this.manager.tooltipViews[0];if(qe.gecko)r=n.offsetParent!=this.container.ownerDocument.body;else if(n.style.top==pc&&n.style.left=="0px"){let o=n.getBoundingClientRect();r=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}}if(r||this.position=="absolute")if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(e=n.width/this.parent.offsetWidth,i=n.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:i}=this.view.viewState);return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((n,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(n.pos):this.view.coordsAtPos(n.pos)}),size:this.manager.tooltipViews.map(({dom:n})=>n.getBoundingClientRect()),space:this.view.state.facet(Ux).tooltipSpace(this.view),scaleX:e,scaleY:i,makeAbsolute:r}}writeMeasure(t){var e;if(t.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:i,space:r,scaleX:n,scaleY:o}=t,a=[];for(let l=0;l<this.manager.tooltips.length;l++){let h=this.manager.tooltips[l],u=this.manager.tooltipViews[l],{dom:c}=u,f=t.pos[l],d=t.size[l];if(!f||f.bottom<=Math.max(i.top,r.top)||f.top>=Math.min(i.bottom,r.bottom)||f.right<Math.max(i.left,r.left)-.1||f.left>Math.min(i.right,r.right)+.1){c.style.top=pc;continue}let m=h.arrow?u.dom.querySelector(".cm-tooltip-arrow"):null,p=m?7:0,v=d.right-d.left,g=(e=LO.get(u))!==null&&e!==void 0?e:d.bottom-d.top,_=u.offset||NW,x=this.view.textDirection==ti.LTR,b=d.width>r.right-r.left?x?r.left:r.right-d.width:x?Math.min(f.left-(m?14:0)+_.x,r.right-v):Math.max(r.left,f.left-v+(m?14:0)-_.x),y=this.above[l];!h.strictSide&&(y?f.top-(d.bottom-d.top)-_.y<r.top:f.bottom+(d.bottom-d.top)+_.y>r.bottom)&&y==r.bottom-f.bottom>f.top-r.top&&(y=this.above[l]=!y);let S=(y?f.top-r.top:r.bottom-f.bottom)-p;if(S<g&&u.resize!==!1){if(S<this.view.defaultLineHeight){c.style.top=pc;continue}LO.set(u,g),c.style.height=(g=S)/o+"px"}else c.style.height&&(c.style.height="");let w=y?f.top-g-p-_.y:f.bottom+p+_.y,M=b+v;if(u.overlap!==!0)for(let C of a)C.left<M&&C.right>b&&C.top<w+g&&C.bottom>w&&(w=y?C.top-g-2-p:C.bottom+p+2);if(this.position=="absolute"?(c.style.top=(w-t.parent.top)/o+"px",c.style.left=(b-t.parent.left)/n+"px"):(c.style.top=w/o+"px",c.style.left=b/n+"px"),m){let C=f.left+(x?_.x:-_.x)-(b+14-7);m.style.left=C/n+"px"}u.overlap!==!0&&a.push({left:b,top:w,right:M,bottom:w+g}),c.classList.toggle("cm-tooltip-above",y),c.classList.toggle("cm-tooltip-below",!y),u.positioned&&u.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=pc}},{eventObservers:{scroll(){this.maybeMeasure()}}}),BW=ze.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),NW={x:0,y:0},Ib=Ve.define({enables:[kD,BW]});function kb(t,e){let i=t.plugin(kD);if(!i)return null;let r=i.manager.tooltips.indexOf(e);return r<0?null:i.manager.tooltipViews[r]}var OO=Ve.define({combine(t){let e,i;for(let r of t)e=e||r.topContainer,i=i||r.bottomContainer;return{topContainer:e,bottomContainer:i}}});function kc(t,e){let i=t.plugin(FD),r=i?i.specs.indexOf(e):-1;return r>-1?i.panels[r]:null}var FD=Ki.fromClass(class{constructor(t){this.input=t.state.facet(Ic),this.specs=this.input.filter(i=>i),this.panels=this.specs.map(i=>i(t));let e=t.state.facet(OO);this.top=new dh(t,!0,e.topContainer),this.bottom=new dh(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(i=>i.top)),this.bottom.sync(this.panels.filter(i=>!i.top));for(let i of this.panels)i.dom.classList.add("cm-panel"),i.mount&&i.mount()}update(t){let e=t.state.facet(OO);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new dh(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new dh(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(Ic);if(i!=this.input){let r=i.filter(h=>h),n=[],o=[],a=[],l=[];for(let h of r){let u=this.specs.indexOf(h),c;u<0?(c=h(t.view),l.push(c)):(c=this.panels[u],c.update&&c.update(t)),n.push(c),(c.top?o:a).push(c)}this.specs=r,this.panels=n,this.top.sync(o),this.bottom.sync(a);for(let h of l)h.dom.classList.add("cm-panel"),h.mount&&h.mount()}else for(let r of this.panels)r.update&&r.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>ze.scrollMargins.of(e=>{let i=e.plugin(t);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}})}),dh=class{constructor(e,i,r){this.view=e,this.top=i,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let i of this.panels)i.destroy&&e.indexOf(i)<0&&i.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let i=this.container||this.view.dom;i.insertBefore(this.dom,this.top?i.firstChild:null)}let e=this.dom.firstChild;for(let i of this.panels)if(i.dom.parentNode==this.dom){for(;e!=i.dom;)e=DO(e);e=e.nextSibling}else this.dom.insertBefore(i.dom,e);for(;e;)e=DO(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}};function DO(t){let e=t.nextSibling;return t.remove(),e}var Ic=Ve.define({enables:FD}),xr=class extends ss{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};xr.prototype.elementClass="";xr.prototype.toDOM=void 0;xr.prototype.mapMode=yr.TrackBefore;xr.prototype.startSide=xr.prototype.endSide=-1;xr.prototype.point=!0;var vg=Ve.define(),UW={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Xt.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Cc=Ve.define();function vh(t){return[BD(),Cc.of(Object.assign(Object.assign({},UW),t))]}var Eb=Ve.define({combine:t=>t.some(e=>e)});function BD(t){let e=[zW];return t&&t.fixed===!1&&e.push(Eb.of(!0)),e}var zW=Ki.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=t.state.facet(Cc).map(e=>new Pg(t,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!t.state.facet(Eb),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,r=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(r<(i.to-i.from)*.8)}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Eb)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=Xt.iter(this.view.state.facet(vg),this.view.viewport.from),r=[],n=this.gutters.map(o=>new Tb(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(o.type)){let a=!0;for(let l of o.type)if(l.type==Ir.Text&&a){Mb(i,r,l.from);for(let h of n)h.line(this.view,l,r);a=!1}else if(l.widget)for(let h of n)h.widget(this.view,l)}else if(o.type==Ir.Text){Mb(i,r,o.from);for(let a of n)a.line(this.view,o,r)}else if(o.widget)for(let a of n)a.widget(this.view,o);for(let o of n)o.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Cc),i=t.state.facet(Cc),r=t.docChanged||t.heightChanged||t.viewportChanged||!Xt.eq(t.startState.facet(vg),t.state.facet(vg),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let n of this.gutters)n.update(t)&&(r=!0);else{r=!0;let n=[];for(let o of i){let a=e.indexOf(o);a<0?n.push(new Pg(this.view,o)):(this.gutters[a].update(t),n.push(this.gutters[a]))}for(let o of this.gutters)o.dom.remove(),n.indexOf(o)<0&&o.destroy();for(let o of n)this.dom.appendChild(o.dom);this.gutters=n}return r}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>ze.scrollMargins.of(e=>{let i=e.plugin(t);return!i||i.gutters.length==0||!i.fixed?null:e.textDirection==ti.LTR?{left:i.dom.offsetWidth*e.scaleX}:{right:i.dom.offsetWidth*e.scaleX}})});function IO(t){return Array.isArray(t)?t:[t]}function Mb(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}var Tb=class{constructor(e,i,r){this.gutter=e,this.height=r,this.i=0,this.cursor=Xt.iter(e.markers,i.from)}addElement(e,i,r){let{gutter:n}=this,o=(i.top-this.height)/e.scaleY,a=i.height/e.scaleY;if(this.i==n.elements.length){let l=new Rg(e,a,o,r);n.elements.push(l),n.dom.appendChild(l.dom)}else n.elements[this.i].update(e,a,o,r);this.height=i.bottom,this.i++}line(e,i,r){let n=[];Mb(this.cursor,n,i.from),r.length&&(n=n.concat(r));let o=this.gutter.config.lineMarker(e,i,n);o&&n.unshift(o);let a=this.gutter;n.length==0&&!a.config.renderEmptyElements||this.addElement(e,i,n)}widget(e,i){let r=this.gutter.config.widgetMarker(e,i.widget,i);r&&this.addElement(e,i,[r])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let i=e.elements.pop();e.dom.removeChild(i.dom),i.destroy()}}},Pg=class{constructor(e,i){this.view=e,this.config=i,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in i.domEventHandlers)this.dom.addEventListener(r,n=>{let o=n.target,a;if(o!=this.dom&&this.dom.contains(o)){for(;o.parentNode!=this.dom;)o=o.parentNode;let h=o.getBoundingClientRect();a=(h.top+h.bottom)/2}else a=n.clientY;let l=e.lineBlockAtHeight(a-e.documentTop);i.domEventHandlers[r](e,l,n)&&n.preventDefault()});this.markers=IO(i.markers(e)),i.initialSpacer&&(this.spacer=new Rg(e,0,0,[i.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let i=this.markers;if(this.markers=IO(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let r=e.view.viewport;return!Xt.eq(this.markers,i,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}},Rg=class{constructor(e,i,r,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,i,r,n)}update(e,i,r,n){this.height!=i&&(this.height=i,this.dom.style.height=i+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),GW(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,i){let r="cm-gutterElement",n=this.dom.firstChild;for(let o=0,a=0;;){let l=a,h=o<i.length?i[o++]:null,u=!1;if(h){let c=h.elementClass;c&&(r+=" "+c);for(let f=a;f<this.markers.length;f++)if(this.markers[f].compare(h)){l=f,u=!0;break}}else l=this.markers.length;for(;a<l;){let c=this.markers[a++];if(c.toDOM){c.destroy(n);let f=n.nextSibling;n.remove(),n=f}}if(!h)break;h.toDOM&&(u?n=n.nextSibling:this.dom.insertBefore(h.toDOM(e),n)),u&&a++}this.dom.className=r,this.markers=i}destroy(){this.setMarkers(null,[])}};function GW(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}var HW=Ve.define(),ph=Ve.define({combine(t){return Qr(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,i){let r=Object.assign({},e);for(let n in i){let o=r[n],a=i[n];r[n]=o?(l,h,u)=>o(l,h,u)||a(l,h,u):a}return r}})}}),Ec=class extends xr{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}};function zx(t,e){return t.state.facet(ph).formatNumber(e,t.state)}var WW=Cc.compute([ph],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(HW)},lineMarker(e,i,r){return r.some(n=>n.toDOM)?null:new Ec(zx(e,e.state.doc.lineAt(i.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(ph)!=e.state.facet(ph),initialSpacer(e){return new Ec(zx(e,kO(e.state.doc.lines)))},updateSpacer(e,i){let r=zx(i.view,kO(i.view.state.doc.lines));return r==e.number?e:new Ec(r)},domEventHandlers:t.facet(ph).domEventHandlers}));function Bg(t={}){return[ph.of(t),BD(),WW]}function kO(t){let e=9;for(;e<t;)e=e*10+9;return e}var VW=new class extends xr{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},jW=vg.compute(["selection"],t=>{let e=[],i=-1;for(let r of t.selection.ranges){let n=t.doc.lineAt(r.head).from;n>i&&(i=n,e.push(VW.range(n)))}return Xt.of(e)});function Ng(){return jW}Gc();Gc();var KW=0,Gs=class t{constructor(e,i,r){this.set=e,this.base=i,this.modified=r,this.id=KW++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let i=new t([],null,[]);if(i.set.push(i),e)for(let r of e.set)i.set.push(r);return i}static defineModifier(){let e=new jg;return i=>i.modified.indexOf(e)>-1?i:jg.get(i.base||i,i.modified.concat(e).sort((r,n)=>r.id-n.id))}},QW=0,jg=class t{constructor(){this.instances=[],this.id=QW++}static get(e,i){if(!i.length)return e;let r=i[0].instances.find(l=>l.base==e&&JW(i,l.modified));if(r)return r;let n=[],o=new Gs(n,e,i);for(let l of i)l.instances.push(o);let a=$W(i);for(let l of e.set)if(!l.modified.length)for(let h of a)n.push(t.get(l,h));return o}};function JW(t,e){return t.length==e.length&&t.every((i,r)=>i==e[r])}function $W(t){let e=[[]];for(let i=0;i<t.length;i++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(t[i]));return e.sort((i,r)=>r.length-i.length)}function xh(t){let e=Object.create(null);for(let i in t){let r=t[i];Array.isArray(r)||(r=[r]);for(let n of i.split(" "))if(n){let o=[],a=2,l=n;for(let f=0;;){if(l=="..."&&f>0&&f+3==n.length){a=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!d)throw new RangeError("Invalid path: "+n);if(o.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),f+=d[0].length,f==n.length)break;let m=n[f++];if(f==n.length&&m=="!"){a=0;break}if(m!="/")throw new RangeError("Invalid path: "+n);l=n.slice(f)}let h=o.length-1,u=o[h];if(!u)throw new RangeError("Invalid path: "+n);let c=new yh(r,a,h>0?o.slice(0,h):null);e[u]=c.sort(e[u])}}return jD.add(e)}var jD=new Tt,yh=class{constructor(e,i,r,n){this.tags=e,this.mode=i,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};yh.empty=new yh([],2,null);function qb(t,e){let i=Object.create(null);for(let o of t)if(!Array.isArray(o.tag))i[o.tag.id]=o.class;else for(let a of o.tag)i[a.id]=o.class;let{scope:r,all:n=null}=e||{};return{style:o=>{let a=n;for(let l of o)for(let h of l.set){let u=i[h.id];if(u){a=a?a+" "+u:u;break}}return a},scope:r}}function e9(t,e){let i=null;for(let r of t){let n=r.style(e);n&&(i=i?i+" "+n:n)}return i}function qD(t,e,i,r=0,n=t.length){let o=new Vb(r,Array.isArray(e)?e:[e],i);o.highlightRange(t.cursor(),r,n,"",o.highlighters),o.flush(n)}var Vb=class{constructor(e,i,r){this.at=e,this.highlighters=i,this.span=r,this.class=""}startSpan(e,i){i!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=i)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,i,r,n,o){let{type:a,from:l,to:h}=e;if(l>=r||h<=i)return;a.isTop&&(o=this.highlighters.filter(m=>!m.scope||m.scope(a)));let u=n,c=t9(e)||yh.empty,f=e9(o,c.tags);if(f&&(u&&(u+=" "),u+=f,c.mode==1&&(n+=(n?" ":"")+f)),this.startSpan(Math.max(i,l),u),c.opaque)return;let d=e.tree&&e.tree.prop(Tt.mounted);if(d&&d.overlay){let m=e.node.enter(d.overlay[0].from+l,1),p=this.highlighters.filter(g=>!g.scope||g.scope(d.tree.type)),v=e.firstChild();for(let g=0,_=l;;g++){let x=g<d.overlay.length?d.overlay[g]:null,b=x?x.from+l:h,y=Math.max(i,_),S=Math.min(r,b);if(y<S&&v)for(;e.from<S&&(this.highlightRange(e,y,S,n,o),this.startSpan(Math.min(S,e.to),u),!(e.to>=b||!e.nextSibling())););if(!x||b>r)break;_=x.to+l,_>i&&(this.highlightRange(m.cursor(),Math.max(i,x.from+l),Math.min(r,_),"",p),this.startSpan(Math.min(r,_),u))}v&&e.parent()}else if(e.firstChild()){d&&(n="");do if(!(e.to<=i)){if(e.from>=r)break;this.highlightRange(e,i,r,n,o),this.startSpan(Math.min(r,e.to),u)}while(e.nextSibling());e.parent()}}};function t9(t){let e=t.type.prop(jD);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}var Be=Gs.define,Hg=Be(),na=Be(),WD=Be(na),VD=Be(na),sa=Be(),Wg=Be(sa),Wb=Be(sa),zs=Be(),tl=Be(zs),Ns=Be(),Us=Be(),jb=Be(),Hc=Be(jb),Vg=Be(),J={comment:Hg,lineComment:Be(Hg),blockComment:Be(Hg),docComment:Be(Hg),name:na,variableName:Be(na),typeName:WD,tagName:Be(WD),propertyName:VD,attributeName:Be(VD),className:Be(na),labelName:Be(na),namespace:Be(na),macroName:Be(na),literal:sa,string:Wg,docString:Be(Wg),character:Be(Wg),attributeValue:Be(Wg),number:Wb,integer:Be(Wb),float:Be(Wb),bool:Be(sa),regexp:Be(sa),escape:Be(sa),color:Be(sa),url:Be(sa),keyword:Ns,self:Be(Ns),null:Be(Ns),atom:Be(Ns),unit:Be(Ns),modifier:Be(Ns),operatorKeyword:Be(Ns),controlKeyword:Be(Ns),definitionKeyword:Be(Ns),moduleKeyword:Be(Ns),operator:Us,derefOperator:Be(Us),arithmeticOperator:Be(Us),logicOperator:Be(Us),bitwiseOperator:Be(Us),compareOperator:Be(Us),updateOperator:Be(Us),definitionOperator:Be(Us),typeOperator:Be(Us),controlOperator:Be(Us),punctuation:jb,separator:Be(jb),bracket:Hc,angleBracket:Be(Hc),squareBracket:Be(Hc),paren:Be(Hc),brace:Be(Hc),content:zs,heading:tl,heading1:Be(tl),heading2:Be(tl),heading3:Be(tl),heading4:Be(tl),heading5:Be(tl),heading6:Be(tl),contentSeparator:Be(zs),list:Be(zs),quote:Be(zs),emphasis:Be(zs),strong:Be(zs),link:Be(zs),monospace:Be(zs),strikethrough:Be(zs),inserted:Be(),deleted:Be(),changed:Be(),invalid:Be(),meta:Vg,documentMeta:Be(Vg),annotation:Be(Vg),processingInstruction:Be(Vg),definition:Gs.defineModifier(),constant:Gs.defineModifier(),function:Gs.defineModifier(),standard:Gs.defineModifier(),local:Gs.defineModifier(),special:Gs.defineModifier()},_Se=qb([{tag:J.link,class:"tok-link"},{tag:J.heading,class:"tok-heading"},{tag:J.emphasis,class:"tok-emphasis"},{tag:J.strong,class:"tok-strong"},{tag:J.keyword,class:"tok-keyword"},{tag:J.atom,class:"tok-atom"},{tag:J.bool,class:"tok-bool"},{tag:J.url,class:"tok-url"},{tag:J.labelName,class:"tok-labelName"},{tag:J.inserted,class:"tok-inserted"},{tag:J.deleted,class:"tok-deleted"},{tag:J.literal,class:"tok-literal"},{tag:J.string,class:"tok-string"},{tag:J.number,class:"tok-number"},{tag:[J.regexp,J.escape,J.special(J.string)],class:"tok-string2"},{tag:J.variableName,class:"tok-variableName"},{tag:J.local(J.variableName),class:"tok-variableName tok-local"},{tag:J.definition(J.variableName),class:"tok-variableName tok-definition"},{tag:J.special(J.variableName),class:"tok-variableName2"},{tag:J.definition(J.propertyName),class:"tok-propertyName tok-definition"},{tag:J.typeName,class:"tok-typeName"},{tag:J.namespace,class:"tok-namespace"},{tag:J.className,class:"tok-className"},{tag:J.macroName,class:"tok-macroName"},{tag:J.propertyName,class:"tok-propertyName"},{tag:J.operator,class:"tok-operator"},{tag:J.comment,class:"tok-comment"},{tag:J.meta,class:"tok-meta"},{tag:J.invalid,class:"tok-invalid"},{tag:J.punctuation,class:"tok-punctuation"}]);var Xb="\u037C",XD=typeof Symbol=="undefined"?"__"+Xb:Symbol.for(Xb),Yb=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),YD=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{},Wc=class{constructor(e,i){this.rules=[];let{finish:r}=i||{};function n(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function o(a,l,h,u){let c=[],f=/^@(\w+)\b/.exec(a[0]),d=f&&f[1]=="keyframes";if(f&&l==null)return h.push(a[0]+";");for(let m in l){let p=l[m];if(/&/.test(m))o(m.split(/,\s*/).map(v=>a.map(g=>v.replace(/&/,g))).reduce((v,g)=>v.concat(g)),p,h);else if(p&&typeof p=="object"){if(!f)throw new RangeError("The value of a property ("+m+") should be a primitive value.");o(n(m),p,c,d)}else p!=null&&c.push(m.replace(/_.*/,"").replace(/[A-Z]/g,v=>"-"+v.toLowerCase())+": "+p+";")}(c.length||d)&&h.push((r&&!f&&!u?a.map(r):a).join(", ")+" {"+c.join(" ")+"}")}for(let a in e)o(n(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=YD[XD]||1;return YD[XD]=e+1,Xb+e.toString(36)}static mount(e,i){(e[Yb]||new Zb(e)).mount(Array.isArray(i)?i:[i])}},qg=null,Zb=class{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(qg)return e.adoptedStyleSheets=[qg.sheet].concat(e.adoptedStyleSheets),e[Yb]=qg;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),qg=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let i=e.head||e;i.insertBefore(this.styleTag,i.firstChild)}this.modules=[],e[Yb]=this}mount(e){let i=this.sheet,r=0,n=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,a),i)for(let h=0;h<a.rules.length;h++)i.insertRule(a.rules[h],r++)}else{for(;n<l;)r+=this.modules[n++].rules.length;r+=a.rules.length,n++}}if(!i){let o="";for(let a=0;a<this.modules.length;a++)o+=this.modules[a].getRules()+`
`;this.styleTag.textContent=o}}};var Kb,bh=new Tt;function r9(t){return Ve.define({combine:t?e=>e.concat(t):void 0})}var n9=new Tt,gn=class{constructor(e,i,r=[],n=""){this.data=e,this.name=n,Nt.prototype.hasOwnProperty("tree")||Object.defineProperty(Nt.prototype,"tree",{get(){return rr(this)}}),this.parser=i,this.extension=[oa.of(this),Nt.languageData.of((o,a,l)=>{let h=ZD(o,a,l),u=h.type.prop(bh);if(!u)return[];let c=o.facet(u),f=h.type.prop(n9);if(f){let d=h.resolve(a-h.from,l);for(let m of f)if(m.test(d,o)){let p=o.facet(m.facet);return m.type=="replace"?p:p.concat(c)}}return c})].concat(r)}isActiveAt(e,i,r=-1){return ZD(e,i,r).type.prop(bh)==this.data}findRegions(e){let i=e.facet(oa);if((i==null?void 0:i.data)==this.data)return[{from:0,to:e.doc.length}];if(!i||!i.allowsNesting)return[];let r=[],n=(o,a)=>{if(o.prop(bh)==this.data){r.push({from:a,to:a+o.length});return}let l=o.prop(Tt.mounted);if(l){if(l.tree.prop(bh)==this.data){if(l.overlay)for(let h of l.overlay)r.push({from:h.from+a,to:h.to+a});else r.push({from:a,to:a+o.length});return}else if(l.overlay){let h=r.length;if(n(l.tree,l.overlay[0].from+a),r.length>h)return}}for(let h=0;h<o.children.length;h++){let u=o.children[h];u instanceof cr&&n(u,o.positions[h]+a)}};return n(rr(e),0),r}get allowsNesting(){return!0}};gn.setState=Dt.define();function ZD(t,e,i){let r=t.facet(oa),n=rr(t).topNode;if(!r||r.allowsNesting)for(let o=n;o;o=o.enter(e,i,Qi.ExcludeBuffers))o.type.isTop&&(n=o);return n}var wh=class t extends gn{constructor(e,i,r){super(e,i,[],r),this.parser=i}static define(e){let i=r9(e.languageData);return new t(i,e.parser.configure({props:[bh.add(r=>r.isTop?i:void 0)]}),e.name)}configure(e,i){return new t(this.data,this.parser.configure(e),i||this.name)}get allowsNesting(){return this.parser.hasWrappers()}};function rr(t){let e=t.field(gn.state,!1);return e?e.tree:cr.empty}var ew=class{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,i){let r=this.cursorPos-this.string.length;return e<r||i>=this.cursorPos?this.doc.sliceString(e,i):this.string.slice(e-r,i-r)}},Vc=null,tw=class t{constructor(e,i,r=[],n,o,a,l,h){this.parser=e,this.state=i,this.fragments=r,this.tree=n,this.treeLen=o,this.viewport=a,this.skipped=l,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}static create(e,i,r){return new t(e,i,[],cr.empty,0,r,[],null)}startParse(){return this.parser.startParse(new ew(this.state.doc),this.fragments)}work(e,i){return i!=null&&i>=this.state.doc.length&&(i=void 0),this.tree!=cr.empty&&this.isDone(i!=null?i:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),i!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(el.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(i!=null?i:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,i;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(i=this.parse.advance()););}),this.treeLen=e,this.tree=i,this.fragments=this.withoutTempSkipped(el.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let i=Vc;Vc=this;try{return e()}finally{Vc=i}}withoutTempSkipped(e){for(let i;i=this.tempSkipped.pop();)e=KD(e,i.from,i.to);return e}changes(e,i){let{fragments:r,tree:n,treeLen:o,viewport:a,skipped:l}=this;if(this.takeTree(),!e.empty){let h=[];if(e.iterChangedRanges((u,c,f,d)=>h.push({fromA:u,toA:c,fromB:f,toB:d})),r=el.applyChanges(r,h),n=cr.empty,o=0,a={from:e.mapPos(a.from,-1),to:e.mapPos(a.to,1)},this.skipped.length){l=[];for(let u of this.skipped){let c=e.mapPos(u.from,1),f=e.mapPos(u.to,-1);c<f&&l.push({from:c,to:f})}}}return new t(this.parser,i,r,n,o,a,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let i=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:o}=this.skipped[r];n<e.to&&o>e.from&&(this.fragments=KD(this.fragments,n,o),this.skipped.splice(r--,1))}return this.skipped.length>=i?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,i){this.skipped.push({from:e,to:i})}static getSkippingParser(e){return new class extends zc{createParse(i,r,n){let o=n[0].from,a=n[n.length-1].to;return{parsedPos:o,advance(){let h=Vc;if(h){for(let u of n)h.tempSkipped.push(u);e&&(h.scheduleOn=h.scheduleOn?Promise.all([h.scheduleOn,e]):e)}return this.parsedPos=a,new cr(Jr.none,[],[],a-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let i=this.fragments;return this.treeLen>=e&&i.length&&i[0].from==0&&i[0].to>=e}static get(){return Vc}};function KD(t,e,i){return el.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}var qc=class t{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let i=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),i.viewport.to);return i.work(20,r)||i.takeTree(),new t(i)}static init(e){let i=Math.min(3e3,e.doc.length),r=tw.create(e.facet(oa).parser,e,{from:0,to:i});return r.work(20,i)||r.takeTree(),new t(r)}};gn.state=Zi.define({create:qc.init,update(t,e){for(let i of e.effects)if(i.is(gn.setState))return i.value;return e.startState.facet(oa)!=e.state.facet(oa)?qc.init(e.state):t.apply(e)}});var tI=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(tI=t=>{let e=-1,i=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});var Qb=typeof navigator!="undefined"&&(!((Kb=navigator.scheduling)===null||Kb===void 0)&&Kb.isInputPending)?()=>navigator.scheduling.isInputPending():null,s9=Ki.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let i=this.view.state.field(gn.state).context;(i.updateViewport(e.view.viewport)||this.view.viewport.to>i.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(i)}scheduleWork(){if(this.working)return;let{state:e}=this.view,i=e.field(gn.state);(i.tree!=i.context.tree||!i.context.isDone(e.doc.length))&&(this.working=tI(this.work))}work(e){this.working=null;let i=Date.now();if(this.chunkEnd<i&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=i+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,o=r.field(gn.state);if(o.tree==o.context.tree&&o.context.isDone(n+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,e&&!Qb?Math.max(25,e.timeRemaining()-5):1e9),l=o.context.treeLen<n&&r.doc.length>n+1e3,h=o.context.work(()=>Qb&&Qb()||Date.now()>a,n+(l?0:1e5));this.chunkBudget-=Date.now()-i,(h||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:gn.setState.of(new qc(o.context))})),this.chunkBudget>0&&!(h&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(i=>pn(this.view.state,i)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),oa=Ve.define({combine(t){return t.length?t[0]:null},enables:t=>[gn.state,s9,ze.contentAttributes.compute([t],e=>{let i=e.facet(t);return i&&i.name?{"data-language":i.name}:{}})]}),Sh=class{constructor(e,i=[]){this.language=e,this.support=i,this.extension=[e,i]}};var o9=Ve.define(),Xc=Ve.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(i=>i!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function Yc(t){let e=t.facet(Xc);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function Ch(t,e){let i="",r=t.tabSize,n=t.facet(Xc)[0];if(n=="	"){for(;e>=r;)i+="	",e-=r;n=" "}for(let o=0;o<e;o++)i+=n;return i}function Zg(t,e){t instanceof Nt&&(t=new il(t));for(let r of t.state.facet(o9)){let n=r(t,e);if(n!==void 0)return n}let i=rr(t.state);return i.length>=e?a9(t,i,e):null}var il=class{constructor(e,i={}){this.state=e,this.options=i,this.unit=Yc(e)}lineAt(e,i=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:o}=this.options;return n!=null&&n>=r.from&&n<=r.to?o&&n==e?{text:"",from:e}:(i<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,i=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,i);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,i=1){let{text:r,from:n}=this.lineAt(e,i),o=this.countColumn(r,e-n),a=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return a>-1&&(o+=a-this.countColumn(r,r.search(/\S|$/))),o}countColumn(e,i=e.length){return mo(e,this.state.tabSize,i)}lineIndent(e,i=1){let{text:r,from:n}=this.lineAt(e,i),o=this.options.overrideIndentation;if(o){let a=o(n);if(a>-1)return a}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},lw=new Tt;function a9(t,e,i){let r=e.resolveStack(i),n=r.node.enterUnfinishedNodesBefore(i);if(n!=r.node){let o=[];for(let a=n;a!=r.node;a=a.parent)o.push(a);for(let a=o.length-1;a>=0;a--)r={node:o[a],next:r}}return iI(r,t,i)}function iI(t,e,i){for(let r=t;r;r=r.next){let n=h9(r.node);if(n)return n(iw.create(e,i,r))}return 0}function l9(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function h9(t){let e=t.type.prop(lw);if(e)return e;let i=t.firstChild,r;if(i&&(r=i.type.prop(Tt.closedBy))){let n=t.lastChild,o=n&&r.indexOf(n.name)>-1;return a=>d9(a,!0,1,void 0,o&&!l9(a)?n.from:void 0)}return t.parent==null?u9:null}function u9(){return 0}var iw=class t extends il{constructor(e,i,r){super(e.state,e.options),this.base=e,this.pos=i,this.context=r}get node(){return this.context.node}static create(e,i,r){return new t(e,i,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let i=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(i.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(c9(r,e))break;i=this.state.doc.lineAt(r.from)}return this.lineIndent(i.from)}continue(){return iI(this.context.next,this.base,this.pos)}};function c9(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function f9(t){let e=t.node,i=e.childAfter(e.from),r=e.lastChild;if(!i)return null;let n=t.options.simulateBreak,o=t.state.doc.lineAt(i.from),a=n==null||n<=o.from?o.to:Math.min(o.to,n);for(let l=i.to;;){let h=e.childAfter(l);if(!h||h==r)return null;if(!h.type.isSkipped)return h.from<a?i:null;l=h.to}}function d9(t,e,i,r,n){let o=t.textAfter,a=o.match(/^\s*/)[0].length,l=r&&o.slice(a,a+r.length)==r||n==t.pos+a,h=e?f9(t):null;return h?l?t.column(h.from):t.column(h.to):t.baseIndent+(l?0:t.unit*i)}var p9=200;function Kg(){return Nt.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:r}=t.newSelection.main,n=i.lineAt(r);if(r>n.from+p9)return t;let o=i.sliceString(n.from,r);if(!e.some(u=>u.test(o)))return t;let{state:a}=t,l=-1,h=[];for(let{head:u}of a.selection.ranges){let c=a.doc.lineAt(u);if(c.from==l)continue;l=c.from;let f=Zg(a,c.from);if(f==null)continue;let d=/^\s*/.exec(c.text)[0],m=Ch(a,f);d!=m&&h.push({from:c.from,to:c.from+d.length,insert:m})}return h.length?[t,{changes:h,sequential:!0}]:t})}var m9=Ve.define(),hw=new Tt;function rI(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null}function g9(t,e,i){let r=rr(t);if(r.length<i)return null;let n=r.resolveStack(i,1),o=null;for(let a=n;a;a=a.next){let l=a.node;if(l.to<=i||l.from>i)continue;if(o&&l.from<e)break;let h=l.type.prop(hw);if(h&&(l.to<r.length-50||r.length==t.doc.length||!v9(l))){let u=h(l,t);u&&u.from<=i&&u.from>=e&&u.to>i&&(o=u)}}return o}function v9(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function Xg(t,e,i){for(let r of t.facet(m9)){let n=r(t,e,i);if(n)return n}return g9(t,e,i)}function nI(t,e){let i=e.mapPos(t.from,1),r=e.mapPos(t.to,-1);return i>=r?void 0:{from:i,to:r}}var Qg=Dt.define({map:nI}),Zc=Dt.define({map:nI});function sI(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some(r=>r.from<=i&&r.to>=i)||e.push(t.lineBlockAt(i));return e}var rl=Zi.define({create(){return yt.none},update(t,e){t=t.map(e.changes);for(let i of e.effects)if(i.is(Qg)&&!_9(t,i.value.from,i.value.to)){let{preparePlaceholder:r}=e.state.facet(uw),n=r?yt.replace({widget:new rw(r(e.state,i.value))}):QD;t=t.update({add:[n.range(i.value.from,i.value.to)]})}else i.is(Zc)&&(t=t.update({filter:(r,n)=>i.value.from!=r||i.value.to!=n,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:r}=e.selection.main;t.between(r,r,(n,o)=>{n<r&&o>r&&(i=!0)}),i&&(t=t.update({filterFrom:r,filterTo:r,filter:(n,o)=>o<=r||n>=r}))}return t},provide:t=>ze.decorations.from(t),toJSON(t,e){let i=[];return t.between(0,e.doc.length,(r,n)=>{i.push(r,n)}),i},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let i=0;i<t.length;){let r=t[i++],n=t[i++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(QD.range(r,n))}return yt.set(e,!0)}});function Yg(t,e,i){var r;let n=null;return(r=t.field(rl,!1))===null||r===void 0||r.between(e,i,(o,a)=>{(!n||n.from>o)&&(n={from:o,to:a})}),n}function _9(t,e,i){let r=!1;return t.between(e,e,(n,o)=>{n==e&&o==i&&(r=!0)}),r}function oI(t,e){return t.field(rl,!1)?e:e.concat(Dt.appendConfig.of(lI()))}var y9=t=>{for(let e of sI(t)){let i=Xg(t.state,e.from,e.to);if(i)return t.dispatch({effects:oI(t.state,[Qg.of(i),aI(t,i)])}),!0}return!1},x9=t=>{if(!t.state.field(rl,!1))return!1;let e=[];for(let i of sI(t)){let r=Yg(t.state,i.from,i.to);r&&e.push(Zc.of(r),aI(t,r,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function aI(t,e,i=!0){let r=t.state.doc.lineAt(e.from).number,n=t.state.doc.lineAt(e.to).number;return ze.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${r} ${t.state.phrase("to")} ${n}.`)}var b9=t=>{let{state:e}=t,i=[];for(let r=0;r<e.doc.length;){let n=t.lineBlockAt(r),o=Xg(e,n.from,n.to);o&&i.push(Qg.of(o)),r=(o?t.lineBlockAt(o.to):n).to+1}return i.length&&t.dispatch({effects:oI(t.state,i)}),!!i.length},w9=t=>{let e=t.state.field(rl,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,(r,n)=>{i.push(Zc.of({from:r,to:n}))}),t.dispatch({effects:i}),!0};var Jg=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:y9},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:x9},{key:"Ctrl-Alt-[",run:b9},{key:"Ctrl-Alt-]",run:w9}],S9={placeholderDOM:null,preparePlaceholder:null,placeholderText:"\u2026"},uw=Ve.define({combine(t){return Qr(t,S9)}});function lI(t){let e=[rl,E9];return t&&e.push(uw.of(t)),e}function hI(t,e){let{state:i}=t,r=i.facet(uw),n=a=>{let l=t.lineBlockAt(t.posAtDOM(a.target)),h=Yg(t.state,l.from,l.to);h&&t.dispatch({effects:Zc.of(h)}),a.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(t,n,e);let o=document.createElement("span");return o.textContent=r.placeholderText,o.setAttribute("aria-label",i.phrase("folded code")),o.title=i.phrase("unfold"),o.className="cm-foldPlaceholder",o.onclick=n,o}var QD=yt.replace({widget:new class extends as{toDOM(t){return hI(t,null)}}}),rw=class extends as{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return hI(e,this.value)}},C9={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1},jc=class extends xr{constructor(e,i){super(),this.config=e,this.open=i}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let i=document.createElement("span");return i.textContent=this.open?this.config.openText:this.config.closedText,i.title=e.state.phrase(this.open?"Fold line":"Unfold line"),i}};function $g(t={}){let e=Object.assign(Object.assign({},C9),t),i=new jc(e,!0),r=new jc(e,!1),n=Ki.fromClass(class{constructor(a){this.from=a.viewport.from,this.markers=this.buildMarkers(a)}update(a){(a.docChanged||a.viewportChanged||a.startState.facet(oa)!=a.state.facet(oa)||a.startState.field(rl,!1)!=a.state.field(rl,!1)||rr(a.startState)!=rr(a.state)||e.foldingChanged(a))&&(this.markers=this.buildMarkers(a.view))}buildMarkers(a){let l=new os;for(let h of a.viewportLineBlocks){let u=Yg(a.state,h.from,h.to)?r:Xg(a.state,h.from,h.to)?i:null;u&&l.add(h.from,h.from,u)}return l.finish()}}),{domEventHandlers:o}=e;return[n,vh({class:"cm-foldGutter",markers(a){var l;return((l=a.plugin(n))===null||l===void 0?void 0:l.markers)||Xt.empty},initialSpacer(){return new jc(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(a,l,h)=>{if(o.click&&o.click(a,l,h))return!0;let u=Yg(a.state,l.from,l.to);if(u)return a.dispatch({effects:Zc.of(u)}),!0;let c=Xg(a.state,l.from,l.to);return c?(a.dispatch({effects:Qg.of(c)}),!0):!1}})}),lI()]}var E9=ze.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),aa=class t{constructor(e,i){this.specs=e;let r;function n(l){let h=Wc.newName();return(r||(r=Object.create(null)))["."+h]=l,h}let o=typeof i.all=="string"?i.all:i.all?n(i.all):void 0,a=i.scope;this.scope=a instanceof gn?l=>l.prop(bh)==a.data:a?l=>l==a:void 0,this.style=qb(e.map(l=>({tag:l.tag,class:l.class||n(Object.assign({},l,{tag:null}))})),{all:o}).style,this.module=r?new Wc(r):null,this.themeType=i.themeType}static define(e,i){return new t(e,i||{})}},nw=Ve.define(),uI=Ve.define({combine(t){return t.length?[t[0]]:null}});function Jb(t){let e=t.facet(nw);return e.length?e:t.facet(uI)}function e0(t,e){let i=[M9],r;return t instanceof aa&&(t.module&&i.push(ze.styleModule.of(t.module)),r=t.themeType),e!=null&&e.fallback?i.push(uI.of(t)):r?i.push(nw.computeN([ze.darkTheme],n=>n.facet(ze.darkTheme)==(r=="dark")?[t]:[])):i.push(nw.of(t)),i}var sw=class{constructor(e){this.markCache=Object.create(null),this.tree=rr(e.state),this.decorations=this.buildDeco(e,Jb(e.state)),this.decoratedTo=e.viewport.to}update(e){let i=rr(e.state),r=Jb(e.state),n=r!=Jb(e.startState),{viewport:o}=e.view,a=e.changes.mapPos(this.decoratedTo,1);i.length<o.to&&!n&&i.type==this.tree.type&&a>=o.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=a):(i!=this.tree||e.viewportChanged||n)&&(this.tree=i,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=o.to)}buildDeco(e,i){if(!i||!this.tree.length)return yt.none;let r=new os;for(let{from:n,to:o}of e.visibleRanges)qD(this.tree,i,(a,l,h)=>{r.add(a,l,this.markCache[h]||(this.markCache[h]=yt.mark({class:h})))},n,o);return r.finish()}},M9=Os.high(Ki.fromClass(sw,{decorations:t=>t.decorations})),cI=aa.define([{tag:J.meta,color:"#404740"},{tag:J.link,textDecoration:"underline"},{tag:J.heading,textDecoration:"underline",fontWeight:"bold"},{tag:J.emphasis,fontStyle:"italic"},{tag:J.strong,fontWeight:"bold"},{tag:J.strikethrough,textDecoration:"line-through"},{tag:J.keyword,color:"#708"},{tag:[J.atom,J.bool,J.url,J.contentSeparator,J.labelName],color:"#219"},{tag:[J.literal,J.inserted],color:"#164"},{tag:[J.string,J.deleted],color:"#a11"},{tag:[J.regexp,J.escape,J.special(J.string)],color:"#e40"},{tag:J.definition(J.variableName),color:"#00f"},{tag:J.local(J.variableName),color:"#30a"},{tag:[J.typeName,J.namespace],color:"#085"},{tag:J.className,color:"#167"},{tag:[J.special(J.variableName),J.macroName],color:"#256"},{tag:J.definition(J.propertyName),color:"#00c"},{tag:J.comment,color:"#940"},{tag:J.invalid,color:"#f00"}]),T9=ze.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),fI=1e4,dI="()[]{}",pI=Ve.define({combine(t){return Qr(t,{afterCursor:!0,brackets:dI,maxScanDistance:fI,renderMatch:R9})}}),A9=yt.mark({class:"cm-matchingBracket"}),P9=yt.mark({class:"cm-nonmatchingBracket"});function R9(t){let e=[],i=t.matched?A9:P9;return e.push(i.range(t.start.from,t.start.to)),t.end&&e.push(i.range(t.end.from,t.end.to)),e}var L9=Zi.define({create(){return yt.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],r=e.state.facet(pI);for(let n of e.state.selection.ranges){if(!n.empty)continue;let o=us(e.state,n.head,-1,r)||n.head>0&&us(e.state,n.head-1,1,r)||r.afterCursor&&(us(e.state,n.head,1,r)||n.head<e.state.doc.length&&us(e.state,n.head+1,-1,r));o&&(i=i.concat(r.renderMatch(o,e.state)))}return yt.set(i,!0)},provide:t=>ze.decorations.from(t)}),O9=[L9,T9];function t0(t={}){return[pI.of(t),O9]}var D9=new Tt;function ow(t,e,i){let r=t.prop(e<0?Tt.openedBy:Tt.closedBy);if(r)return r;if(t.name.length==1){let n=i.indexOf(t.name);if(n>-1&&n%2==(e<0?1:0))return[i[n+e]]}return null}function aw(t){let e=t.type.prop(D9);return e?e(t.node):t}function us(t,e,i,r={}){let n=r.maxScanDistance||fI,o=r.brackets||dI,a=rr(t),l=a.resolveInner(e,i);for(let h=l;h;h=h.parent){let u=ow(h.type,i,o);if(u&&h.from<h.to){let c=aw(h);if(c&&(i>0?e>=c.from&&e<c.to:e>c.from&&e<=c.to))return I9(t,e,i,h,c,u,o)}}return k9(t,e,i,a,l.type,n,o)}function I9(t,e,i,r,n,o,a){let l=r.parent,h={from:n.from,to:n.to},u=0,c=l==null?void 0:l.cursor();if(c&&(i<0?c.childBefore(r.from):c.childAfter(r.to)))do if(i<0?c.to<=r.from:c.from>=r.to){if(u==0&&o.indexOf(c.type.name)>-1&&c.from<c.to){let f=aw(c);return{start:h,end:f?{from:f.from,to:f.to}:void 0,matched:!0}}else if(ow(c.type,i,a))u++;else if(ow(c.type,-i,a)){if(u==0){let f=aw(c);return{start:h,end:f&&f.from<f.to?{from:f.from,to:f.to}:void 0,matched:!1}}u--}}while(i<0?c.prevSibling():c.nextSibling());return{start:h,matched:!1}}function k9(t,e,i,r,n,o,a){let l=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),h=a.indexOf(l);if(h<0||h%2==0!=i>0)return null;let u={from:i<0?e-1:e,to:i>0?e+1:e},c=t.doc.iterRange(e,i>0?t.doc.length:0),f=0;for(let d=0;!c.next().done&&d<=o;){let m=c.value;i<0&&(d+=m.length);let p=e+d*i;for(let v=i>0?0:m.length-1,g=i>0?m.length:-1;v!=g;v+=i){let _=a.indexOf(m[v]);if(!(_<0||r.resolveInner(p+v,1).type!=n))if(_%2==0==i>0)f++;else{if(f==1)return{start:u,end:{from:p+v,to:p+v+1},matched:_>>1==h>>1};f--}}i>0&&(d+=m.length)}return c.done?{start:u,matched:!1}:null}var F9=Object.create(null),JD=[Jr.none];var $D=[],eI=Object.create(null),B9=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])B9[t]=N9(F9,e);function $b(t,e){$D.indexOf(t)>-1||($D.push(t),console.warn(e))}function N9(t,e){let i=[];for(let l of e.split(" ")){let h=[];for(let u of l.split(".")){let c=t[u]||J[u];c?typeof c=="function"?h.length?h=h.map(c):$b(u,`Modifier ${u} used at start of tag`):h.length?$b(u,`Tag ${u} used as modifier`):h=Array.isArray(c)?c:[c]:$b(u,`Unknown highlighting tag ${u}`)}for(let u of h)i.push(u)}if(!i.length)return 0;let r=e.replace(/ /g,"_"),n=r+" "+i.map(l=>l.id),o=eI[n];if(o)return o.id;let a=eI[n]=Jr.define({id:JD.length,name:r,props:[xh({[r]:i})]});return JD.push(a),a.id}var TSe={rtl:yt.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"rtl"},bidiIsolate:ti.RTL}),ltr:yt.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"ltr"},bidiIsolate:ti.LTR}),auto:yt.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"auto"},bidiIsolate:null})};Gc();var U9=t=>{let{state:e}=t,i=e.doc.lineAt(e.selection.main.from),r=vw(t.state,i.from);return r.line?z9(t):r.block?H9(t):!1};function gw(t,e){return({state:i,dispatch:r})=>{if(i.readOnly)return!1;let n=t(e,i);return n?(r(i.update(n)),!0):!1}}var z9=gw(j9,0);var G9=gw(wI,0);var H9=gw((t,e)=>wI(t,e,V9(e)),0);function vw(t,e){let i=t.languageDataAt("commentTokens",e);return i.length?i[0]:{}}var Kc=50;function W9(t,{open:e,close:i},r,n){let o=t.sliceDoc(r-Kc,r),a=t.sliceDoc(n,n+Kc),l=/\s*$/.exec(o)[0].length,h=/^\s*/.exec(a)[0].length,u=o.length-l;if(o.slice(u-e.length,u)==e&&a.slice(h,h+i.length)==i)return{open:{pos:r-l,margin:l&&1},close:{pos:n+h,margin:h&&1}};let c,f;n-r<=2*Kc?c=f=t.sliceDoc(r,n):(c=t.sliceDoc(r,r+Kc),f=t.sliceDoc(n-Kc,n));let d=/^\s*/.exec(c)[0].length,m=/\s*$/.exec(f)[0].length,p=f.length-m-i.length;return c.slice(d,d+e.length)==e&&f.slice(p,p+i.length)==i?{open:{pos:r+d+e.length,margin:/\s/.test(c.charAt(d+e.length))?1:0},close:{pos:n-m-i.length,margin:/\s/.test(f.charAt(p-1))?1:0}}:null}function V9(t){let e=[];for(let i of t.selection.ranges){let r=t.doc.lineAt(i.from),n=i.to<=r.to?r:t.doc.lineAt(i.to),o=e.length-1;o>=0&&e[o].to>r.from?e[o].to=n.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:n.to})}return e}function wI(t,e,i=e.selection.ranges){let r=i.map(o=>vw(e,o.from).block);if(!r.every(o=>o))return null;let n=i.map((o,a)=>W9(e,r[a],o.from,o.to));if(t!=2&&!n.every(o=>o))return{changes:e.changes(i.map((o,a)=>n[a]?[]:[{from:o.from,insert:r[a].open+" "},{from:o.to,insert:" "+r[a].close}]))};if(t!=1&&n.some(o=>o)){let o=[];for(let a=0,l;a<n.length;a++)if(l=n[a]){let h=r[a],{open:u,close:c}=l;o.push({from:u.pos-h.open.length,to:u.pos+u.margin},{from:c.pos-c.margin,to:c.pos+h.close.length})}return{changes:o}}return null}function j9(t,e,i=e.selection.ranges){let r=[],n=-1;for(let{from:o,to:a}of i){let l=r.length,h=1e9,u=vw(e,o).line;if(u){for(let c=o;c<=a;){let f=e.doc.lineAt(c);if(f.from>n&&(o==a||a>f.from)){n=f.from;let d=/^\s*/.exec(f.text)[0].length,m=d==f.length,p=f.text.slice(d,d+u.length)==u?d:-1;d<f.text.length&&d<h&&(h=d),r.push({line:f,comment:p,token:u,indent:d,empty:m,single:!1})}c=f.to+1}if(h<1e9)for(let c=l;c<r.length;c++)r[c].indent<r[c].line.text.length&&(r[c].indent=h);r.length==l+1&&(r[l].single=!0)}}if(t!=2&&r.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:l,token:h,indent:u,empty:c,single:f}of r)(f||!c)&&o.push({from:l.from+u,insert:h+" "});let a=e.changes(o);return{changes:a,selection:e.selection.map(a,1)}}else if(t!=1&&r.some(o=>o.comment>=0)){let o=[];for(let{line:a,comment:l,token:h}of r)if(l>=0){let u=a.from+l,c=u+h.length;a.text[c-a.from]==" "&&c++,o.push({from:u,to:c})}return{changes:o}}return null}var fw=Kr.define(),q9=Kr.define(),X9=Ve.define(),SI=Ve.define({combine(t){return Qr(t,{minDepth:100,newGroupDelay:500,joinToEvent:(e,i)=>i},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,i)=>(r,n)=>e(r,n)||i(r,n)})}}),CI=Zi.define({create(){return nl.empty},update(t,e){let i=e.state.facet(SI),r=e.annotation(fw);if(r){let h=cs.fromTransaction(e,r.selection),u=r.side,c=u==0?t.undone:t.done;return h?c=r0(c,c.length,i.minDepth,h):c=TI(c,e.startState.selection),new nl(u==0?r.rest:c,u==0?c:r.rest)}let n=e.annotation(q9);if((n=="full"||n=="before")&&(t=t.isolate()),e.annotation(Yi.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let o=cs.fromTransaction(e),a=e.annotation(Yi.time),l=e.annotation(Yi.userEvent);return o?t=t.addChanges(o,a,l,i,e):e.selection&&(t=t.addSelection(e.startState.selection,a,l,i.newGroupDelay)),(n=="full"||n=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new nl(t.done.map(cs.fromJSON),t.undone.map(cs.fromJSON))}});function n0(t={}){return[CI,SI.of(t),ze.domEventHandlers({beforeinput(e,i){let r=e.inputType=="historyUndo"?EI:e.inputType=="historyRedo"?dw:null;return r?(e.preventDefault(),r(i)):!1}})]}function s0(t,e){return function({state:i,dispatch:r}){if(!e&&i.readOnly)return!1;let n=i.field(CI,!1);if(!n)return!1;let o=n.pop(t,i,e);return o?(r(o),!0):!1}}var EI=s0(0,!1),dw=s0(1,!1),Y9=s0(0,!0),Z9=s0(1,!0);var cs=class t{constructor(e,i,r,n,o){this.changes=e,this.effects=i,this.mapped=r,this.startSelection=n,this.selectionsAfter=o}setSelAfter(e){return new t(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,i,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(i=this.mapped)===null||i===void 0?void 0:i.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new t(e.changes&&Or.fromJSON(e.changes),[],e.mapped&&po.fromJSON(e.mapped),e.startSelection&&ge.fromJSON(e.startSelection),e.selectionsAfter.map(ge.fromJSON))}static fromTransaction(e,i){let r=kn;for(let n of e.startState.facet(X9)){let o=n(e);o.length&&(r=r.concat(o))}return!r.length&&e.changes.empty?null:new t(e.changes.invert(e.startState.doc),r,void 0,i||e.startState.selection,kn)}static selection(e){return new t(void 0,kn,void 0,void 0,e)}};function r0(t,e,i,r){let n=e+1>i+20?e-i-1:0,o=t.slice(n,e);return o.push(r),o}function K9(t,e){let i=[],r=!1;return t.iterChangedRanges((n,o)=>i.push(n,o)),e.iterChangedRanges((n,o,a,l)=>{for(let h=0;h<i.length;){let u=i[h++],c=i[h++];l>=u&&a<=c&&(r=!0)}}),r}function Q9(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((i,r)=>i.empty!=e.ranges[r].empty).length===0}function MI(t,e){return t.length?e.length?t.concat(e):t:e}var kn=[],J9=200;function TI(t,e){if(t.length){let i=t[t.length-1],r=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-J9));return r.length&&r[r.length-1].eq(e)?t:(r.push(e),r0(t,t.length-1,1e9,i.setSelAfter(r)))}else return[cs.selection([e])]}function $9(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function cw(t,e){if(!t.length)return t;let i=t.length,r=kn;for(;i;){let n=eV(t[i-1],e,r);if(n.changes&&!n.changes.empty||n.effects.length){let o=t.slice(0,i);return o[i-1]=n,o}else e=n.mapped,i--,r=n.selectionsAfter}return r.length?[cs.selection(r)]:kn}function eV(t,e,i){let r=MI(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):kn,i);if(!t.changes)return cs.selection(r);let n=t.changes.map(e),o=e.mapDesc(t.changes,!0),a=t.mapped?t.mapped.composeDesc(o):o;return new cs(n,Dt.mapEffects(t.effects,e),a,t.startSelection.map(o),r)}var tV=/^(input\.type|delete)($|\.)/,nl=class t{constructor(e,i,r=0,n=void 0){this.done=e,this.undone=i,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new t(this.done,this.undone):this}addChanges(e,i,r,n,o){let a=this.done,l=a[a.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!r||tV.test(r))&&(!l.selectionsAfter.length&&i-this.prevTime<n.newGroupDelay&&n.joinToEvent(o,K9(l.changes,e.changes))||r=="input.type.compose")?a=r0(a,a.length-1,n.minDepth,new cs(e.changes.compose(l.changes),MI(e.effects,l.effects),l.mapped,l.startSelection,kn)):a=r0(a,a.length,n.minDepth,e),new t(a,kn,i,r)}addSelection(e,i,r,n){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:kn;return o.length>0&&i-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&Q9(o[o.length-1],e)?this:new t(TI(this.done,e),this.undone,i,r)}addMapping(e){return new t(cw(this.done,e),cw(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,i,r){let n=e==0?this.done:this.undone;if(n.length==0)return null;let o=n[n.length-1],a=o.selectionsAfter[0]||i.selection;if(r&&o.selectionsAfter.length)return i.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:fw.of({side:e,rest:$9(n),selection:a}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let l=n.length==1?kn:n.slice(0,n.length-1);return o.mapped&&(l=cw(l,o.mapped)),i.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:fw.of({side:e,rest:l,selection:a}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};nl.empty=new nl(kn,kn);var o0=[{key:"Mod-z",run:EI,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:dw,preventDefault:!0},{linux:"Ctrl-Shift-z",run:dw,preventDefault:!0},{key:"Mod-u",run:Y9,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Z9,preventDefault:!0}];function Eh(t,e){return ge.create(t.ranges.map(e),t.mainIndex)}function Hs(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function fs({state:t,dispatch:e},i){let r=Eh(t.selection,i);return r.eq(t.selection,!0)?!1:(e(Hs(t,r)),!0)}function a0(t,e){return ge.cursor(e?t.to:t.from)}function AI(t,e){return fs(t,i=>i.empty?t.moveByChar(i,e):a0(i,e))}function br(t){return t.textDirectionAt(t.state.selection.main.head)==ti.LTR}var PI=t=>AI(t,!br(t)),RI=t=>AI(t,br(t));function LI(t,e){return fs(t,i=>i.empty?t.moveByGroup(i,e):a0(i,e))}var iV=t=>LI(t,!br(t)),rV=t=>LI(t,br(t));var FSe=typeof Intl!="undefined"&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null;function nV(t,e,i){if(e.type.prop(i))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function l0(t,e,i){let r=rr(t).resolveInner(e.head),n=i?Tt.closedBy:Tt.openedBy;for(let h=e.head;;){let u=i?r.childAfter(h):r.childBefore(h);if(!u)break;nV(t,u,n)?r=u:h=i?u.to:u.from}let o=r.type.prop(n),a,l;return o&&(a=i?us(t,r.from,1):us(t,r.to,-1))&&a.matched?l=i?a.end.to:a.end.from:l=i?r.to:r.from,ge.cursor(l,i?-1:1)}var sV=t=>fs(t,e=>l0(t.state,e,!br(t))),oV=t=>fs(t,e=>l0(t.state,e,br(t)));function OI(t,e){return fs(t,i=>{if(!i.empty)return a0(i,e);let r=t.moveVertically(i,e);return r.head!=i.head?r:t.moveToLineBoundary(i,e)})}var DI=t=>OI(t,!1),II=t=>OI(t,!0);function kI(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,i=0,r=0,n;if(e){for(let o of t.state.facet(ze.scrollMargins)){let a=o(t);a!=null&&a.top&&(i=Math.max(a==null?void 0:a.top,i)),a!=null&&a.bottom&&(r=Math.max(a==null?void 0:a.bottom,r))}n=t.scrollDOM.clientHeight-i-r}else n=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:i,marginBottom:r,selfScroll:e,height:Math.max(t.defaultLineHeight,n-5)}}function FI(t,e){let i=kI(t),{state:r}=t,n=Eh(r.selection,a=>a.empty?t.moveVertically(a,e,i.height):a0(a,e));if(n.eq(r.selection))return!1;let o;if(i.selfScroll){let a=t.coordsAtPos(r.selection.main.head),l=t.scrollDOM.getBoundingClientRect(),h=l.top+i.marginTop,u=l.bottom-i.marginBottom;a&&a.top>h&&a.bottom<u&&(o=ze.scrollIntoView(n.main.head,{y:"start",yMargin:a.top-h}))}return t.dispatch(Hs(r,n),{effects:o}),!0}var mI=t=>FI(t,!1),pw=t=>FI(t,!0);function la(t,e,i){let r=t.lineBlockAt(e.head),n=t.moveToLineBoundary(e,i);if(n.head==e.head&&n.head!=(i?r.to:r.from)&&(n=t.moveToLineBoundary(e,i,!1)),!i&&n.head==r.from&&r.length){let o=/^\s*/.exec(t.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;o&&e.head!=r.from+o&&(n=ge.cursor(r.from+o))}return n}var aV=t=>fs(t,e=>la(t,e,!0)),lV=t=>fs(t,e=>la(t,e,!1)),hV=t=>fs(t,e=>la(t,e,!br(t))),uV=t=>fs(t,e=>la(t,e,br(t))),cV=t=>fs(t,e=>ge.cursor(t.lineBlockAt(e.head).from,1)),fV=t=>fs(t,e=>ge.cursor(t.lineBlockAt(e.head).to,-1));function dV(t,e,i){let r=!1,n=Eh(t.selection,o=>{let a=us(t,o.head,-1)||us(t,o.head,1)||o.head>0&&us(t,o.head-1,1)||o.head<t.doc.length&&us(t,o.head+1,-1);if(!a||!a.end)return o;r=!0;let l=a.start.from==o.head?a.end.to:a.end.from;return i?ge.range(o.anchor,l):ge.cursor(l)});return r?(e(Hs(t,n)),!0):!1}var pV=({state:t,dispatch:e})=>dV(t,e,!1);function Fn(t,e){let i=Eh(t.state.selection,r=>{let n=e(r);return ge.range(r.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return i.eq(t.state.selection)?!1:(t.dispatch(Hs(t.state,i)),!0)}function BI(t,e){return Fn(t,i=>t.moveByChar(i,e))}var NI=t=>BI(t,!br(t)),UI=t=>BI(t,br(t));function zI(t,e){return Fn(t,i=>t.moveByGroup(i,e))}var mV=t=>zI(t,!br(t)),gV=t=>zI(t,br(t));var vV=t=>Fn(t,e=>l0(t.state,e,!br(t))),_V=t=>Fn(t,e=>l0(t.state,e,br(t)));function GI(t,e){return Fn(t,i=>t.moveVertically(i,e))}var HI=t=>GI(t,!1),WI=t=>GI(t,!0);function VI(t,e){return Fn(t,i=>t.moveVertically(i,e,kI(t).height))}var gI=t=>VI(t,!1),vI=t=>VI(t,!0),yV=t=>Fn(t,e=>la(t,e,!0)),xV=t=>Fn(t,e=>la(t,e,!1)),bV=t=>Fn(t,e=>la(t,e,!br(t))),wV=t=>Fn(t,e=>la(t,e,br(t))),SV=t=>Fn(t,e=>ge.cursor(t.lineBlockAt(e.head).from)),CV=t=>Fn(t,e=>ge.cursor(t.lineBlockAt(e.head).to)),_I=({state:t,dispatch:e})=>(e(Hs(t,{anchor:0})),!0),yI=({state:t,dispatch:e})=>(e(Hs(t,{anchor:t.doc.length})),!0),xI=({state:t,dispatch:e})=>(e(Hs(t,{anchor:t.selection.main.anchor,head:0})),!0),bI=({state:t,dispatch:e})=>(e(Hs(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),EV=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),MV=({state:t,dispatch:e})=>{let i=h0(t).map(({from:r,to:n})=>ge.range(r,Math.min(n+1,t.doc.length)));return e(t.update({selection:ge.create(i),userEvent:"select"})),!0},TV=({state:t,dispatch:e})=>{let i=Eh(t.selection,r=>{var n;let o=rr(t).resolveStack(r.from,1);for(let a=o;a;a=a.next){let{node:l}=a;if((l.from<r.from&&l.to>=r.to||l.to>r.to&&l.from<=r.from)&&(!((n=l.parent)===null||n===void 0)&&n.parent))return ge.range(l.to,l.from)}return r});return e(Hs(t,i)),!0},AV=({state:t,dispatch:e})=>{let i=t.selection,r=null;return i.ranges.length>1?r=ge.create([i.main]):i.main.empty||(r=ge.create([ge.cursor(i.main.head)])),r?(e(Hs(t,r)),!0):!1};function Qc(t,e){if(t.state.readOnly)return!1;let i="delete.selection",{state:r}=t,n=r.changeByRange(o=>{let{from:a,to:l}=o;if(a==l){let h=e(o);h<a?(i="delete.backward",h=i0(t,h,!1)):h>a&&(i="delete.forward",h=i0(t,h,!0)),a=Math.min(a,h),l=Math.max(l,h)}else a=i0(t,a,!1),l=i0(t,l,!0);return a==l?{range:o}:{changes:{from:a,to:l},range:ge.cursor(a,a<o.head?-1:1)}});return n.changes.empty?!1:(t.dispatch(r.update(n,{scrollIntoView:!0,userEvent:i,effects:i=="delete.selection"?ze.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function i0(t,e,i){if(t instanceof ze)for(let r of t.state.facet(ze.atomicRanges).map(n=>n(t)))r.between(e,e,(n,o)=>{n<e&&o>e&&(e=i?o:n)});return e}var jI=(t,e)=>Qc(t,i=>{let r=i.from,{state:n}=t,o=n.doc.lineAt(r),a,l;if(!e&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,r-o.from))){if(a[a.length-1]=="	")return r-1;let h=mo(a,n.tabSize),u=h%Yc(n)||Yc(n);for(let c=0;c<u&&a[a.length-1-c]==" ";c++)r--;l=r}else l=Ni(o.text,r-o.from,e,e)+o.from,l==r&&o.number!=(e?n.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,r-o.from))&&(l=Ni(o.text,l-o.from,!1,!1)+o.from);return l}),mw=t=>jI(t,!1),qI=t=>jI(t,!0),XI=(t,e)=>Qc(t,i=>{let r=i.head,{state:n}=t,o=n.doc.lineAt(r),a=n.charCategorizer(r);for(let l=null;;){if(r==(e?o.to:o.from)){r==i.head&&o.number!=(e?n.doc.lines:1)&&(r+=e?1:-1);break}let h=Ni(o.text,r-o.from,e)+o.from,u=o.text.slice(Math.min(r,h)-o.from,Math.max(r,h)-o.from),c=a(u);if(l!=null&&c!=l)break;(u!=" "||r!=i.head)&&(l=c),r=h}return r}),YI=t=>XI(t,!1),PV=t=>XI(t,!0),RV=t=>Qc(t,e=>{let i=t.lineBlockAt(e.head).to;return e.head<i?i:Math.min(t.state.doc.length,e.head+1)});var LV=t=>Qc(t,e=>{let i=t.moveToLineBoundary(e,!1).head;return e.head>i?i:Math.max(0,e.head-1)}),OV=t=>Qc(t,e=>{let i=t.moveToLineBoundary(e,!0).head;return e.head<i?i:Math.min(t.state.doc.length,e.head+1)});var DV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:zt.of(["",""])},range:ge.cursor(r.from)}));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0},IV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(r=>{if(!r.empty||r.from==0||r.from==t.doc.length)return{range:r};let n=r.from,o=t.doc.lineAt(n),a=n==o.from?n-1:Ni(o.text,n-o.from,!1)+o.from,l=n==o.to?n+1:Ni(o.text,n-o.from,!0)+o.from;return{changes:{from:a,to:l,insert:t.doc.slice(n,l).append(t.doc.slice(a,n))},range:ge.cursor(l)}});return i.changes.empty?!1:(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function h0(t){let e=[],i=-1;for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),o=t.doc.lineAt(r.to);if(!r.empty&&r.to==o.from&&(o=t.doc.lineAt(r.to-1)),i>=n.number){let a=e[e.length-1];a.to=o.to,a.ranges.push(r)}else e.push({from:n.from,to:o.to,ranges:[r]});i=o.number+1}return e}function ZI(t,e,i){if(t.readOnly)return!1;let r=[],n=[];for(let o of h0(t)){if(i?o.to==t.doc.length:o.from==0)continue;let a=t.doc.lineAt(i?o.to+1:o.from-1),l=a.length+1;if(i){r.push({from:o.to,to:a.to},{from:o.from,insert:a.text+t.lineBreak});for(let h of o.ranges)n.push(ge.range(Math.min(t.doc.length,h.anchor+l),Math.min(t.doc.length,h.head+l)))}else{r.push({from:a.from,to:o.from},{from:o.to,insert:t.lineBreak+a.text});for(let h of o.ranges)n.push(ge.range(h.anchor-l,h.head-l))}}return r.length?(e(t.update({changes:r,scrollIntoView:!0,selection:ge.create(n,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}var kV=({state:t,dispatch:e})=>ZI(t,e,!1),FV=({state:t,dispatch:e})=>ZI(t,e,!0);function KI(t,e,i){if(t.readOnly)return!1;let r=[];for(let n of h0(t))i?r.push({from:n.from,insert:t.doc.slice(n.from,n.to)+t.lineBreak}):r.push({from:n.to,insert:t.lineBreak+t.doc.slice(n.from,n.to)});return e(t.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var BV=({state:t,dispatch:e})=>KI(t,e,!1),NV=({state:t,dispatch:e})=>KI(t,e,!0),UV=t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(h0(e).map(({from:n,to:o})=>(n>0?n--:o<e.doc.length&&o++,{from:n,to:o}))),r=Eh(e.selection,n=>t.moveVertically(n,!0)).map(i);return t.dispatch({changes:i,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function zV(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i=rr(t).resolveInner(e),r=i.childBefore(e),n=i.childAfter(e),o;return r&&n&&r.to<=e&&n.from>=e&&(o=r.type.prop(Tt.closedBy))&&o.indexOf(n.name)>-1&&t.doc.lineAt(r.to).from==t.doc.lineAt(n.from).from&&!/\S/.test(t.sliceDoc(r.to,n.from))?{from:r.to,to:n.from}:null}var GV=QI(!1),HV=QI(!0);function QI(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{let{from:o,to:a}=n,l=e.doc.lineAt(o),h=!t&&o==a&&zV(e,o);t&&(o=a=(a<=l.to?l:e.doc.lineAt(a)).to);let u=new il(e,{simulateBreak:o,simulateDoubleBreak:!!h}),c=Zg(u,o);for(c==null&&(c=mo(/^\s*/.exec(e.doc.lineAt(o).text)[0],e.tabSize));a<l.to&&/\s/.test(l.text[a-l.from]);)a++;h?{from:o,to:a}=h:o>l.from&&o<l.from+100&&!/\S/.test(l.text.slice(0,o))&&(o=l.from);let f=["",Ch(e,c)];return h&&f.push(Ch(e,u.lineIndent(l.from,-1))),{changes:{from:o,to:a,insert:zt.of(f)},range:ge.cursor(o+1+f[1].length)}});return i(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function _w(t,e){let i=-1;return t.changeByRange(r=>{let n=[];for(let a=r.from;a<=r.to;){let l=t.doc.lineAt(a);l.number>i&&(r.empty||r.to>l.from)&&(e(l,n,r),i=l.number),a=l.to+1}let o=t.changes(n);return{changes:n,range:ge.range(o.mapPos(r.anchor,1),o.mapPos(r.head,1))}})}var WV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),r=new il(t,{overrideIndentation:o=>{let a=i[o];return a==null?-1:a}}),n=_w(t,(o,a,l)=>{let h=Zg(r,o.from);if(h==null)return;/\S/.test(o.text)||(h=0);let u=/^\s*/.exec(o.text)[0],c=Ch(t,h);(u!=c||l.from<o.from+u.length)&&(i[o.from]=h,a.push({from:o.from,to:o.from+u.length,insert:c}))});return n.changes.empty||e(t.update(n,{userEvent:"indent"})),!0},JI=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(_w(t,(i,r)=>{r.push({from:i.from,insert:t.facet(Xc)})}),{userEvent:"input.indent"})),!0),$I=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(_w(t,(i,r)=>{let n=/^\s*/.exec(i.text)[0];if(!n)return;let o=mo(n,t.tabSize),a=0,l=Ch(t,Math.max(0,o-Yc(t)));for(;a<n.length&&a<l.length&&n.charCodeAt(a)==l.charCodeAt(a);)a++;r.push({from:i.from+a,to:i.from+n.length,insert:l.slice(a)})}),{userEvent:"delete.dedent"})),!0);var VV=[{key:"Ctrl-b",run:PI,shift:NI,preventDefault:!0},{key:"Ctrl-f",run:RI,shift:UI},{key:"Ctrl-p",run:DI,shift:HI},{key:"Ctrl-n",run:II,shift:WI},{key:"Ctrl-a",run:cV,shift:SV},{key:"Ctrl-e",run:fV,shift:CV},{key:"Ctrl-d",run:qI},{key:"Ctrl-h",run:mw},{key:"Ctrl-k",run:RV},{key:"Ctrl-Alt-h",run:YI},{key:"Ctrl-o",run:DV},{key:"Ctrl-t",run:IV},{key:"Ctrl-v",run:pw}],jV=[{key:"ArrowLeft",run:PI,shift:NI,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:iV,shift:mV,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:hV,shift:bV,preventDefault:!0},{key:"ArrowRight",run:RI,shift:UI,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:rV,shift:gV,preventDefault:!0},{mac:"Cmd-ArrowRight",run:uV,shift:wV,preventDefault:!0},{key:"ArrowUp",run:DI,shift:HI,preventDefault:!0},{mac:"Cmd-ArrowUp",run:_I,shift:xI},{mac:"Ctrl-ArrowUp",run:mI,shift:gI},{key:"ArrowDown",run:II,shift:WI,preventDefault:!0},{mac:"Cmd-ArrowDown",run:yI,shift:bI},{mac:"Ctrl-ArrowDown",run:pw,shift:vI},{key:"PageUp",run:mI,shift:gI},{key:"PageDown",run:pw,shift:vI},{key:"Home",run:lV,shift:xV,preventDefault:!0},{key:"Mod-Home",run:_I,shift:xI},{key:"End",run:aV,shift:yV,preventDefault:!0},{key:"Mod-End",run:yI,shift:bI},{key:"Enter",run:GV},{key:"Mod-a",run:EV},{key:"Backspace",run:mw,shift:mw},{key:"Delete",run:qI},{key:"Mod-Backspace",mac:"Alt-Backspace",run:YI},{key:"Mod-Delete",mac:"Alt-Delete",run:PV},{mac:"Mod-Backspace",run:LV},{mac:"Mod-Delete",run:OV}].concat(VV.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),u0=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:sV,shift:vV},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:oV,shift:_V},{key:"Alt-ArrowUp",run:kV},{key:"Shift-Alt-ArrowUp",run:BV},{key:"Alt-ArrowDown",run:FV},{key:"Shift-Alt-ArrowDown",run:NV},{key:"Escape",run:AV},{key:"Mod-Enter",run:HV},{key:"Alt-l",mac:"Ctrl-l",run:MV},{key:"Mod-i",run:TV,preventDefault:!0},{key:"Mod-[",run:$I},{key:"Mod-]",run:JI},{key:"Mod-Alt-\\",run:WV},{key:"Shift-Mod-k",run:UV},{key:"Shift-Mod-\\",run:pV},{key:"Mod-/",run:U9},{key:"Alt-A",run:G9}].concat(jV),c0={key:"Tab",run:JI,shift:$I};var Vk=hn(Ak());var S0=class{constructor(e,i,r){this.state=e,this.pos=i,this.explicit=r,this.abortListeners=[]}tokenBefore(e){let i=rr(this.state).resolveInner(this.pos,-1);for(;i&&e.indexOf(i.name)<0;)i=i.parent;return i?{from:i.from,to:this.pos,text:this.state.sliceDoc(i.from,this.pos),type:i.type}:null}matchBefore(e){let i=this.state.doc.lineAt(this.pos),r=Math.max(i.from,this.pos-250),n=i.text.slice(r-i.from,this.pos-i.from),o=n.search(Fk(e,!1));return o<0?null:{from:r+o,to:this.pos,text:n.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,i){e=="abort"&&this.abortListeners&&this.abortListeners.push(i)}};function Pk(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function S7(t){let e=Object.create(null),i=Object.create(null);for(let{label:n}of t){e[n[0]]=!0;for(let o=1;o<n.length;o++)i[n[o]]=!0}let r=Pk(e)+Pk(i)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function nf(t){let e=t.map(n=>typeof n=="string"?{label:n}:n),[i,r]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:S7(e);return n=>{let o=n.matchBefore(r);return o||n.explicit?{from:o?o.from:n.pos,options:e,validFor:i}:null}}var C0=class{constructor(e,i,r,n){this.completion=e,this.source=i,this.match=r,this.score=n}};function ca(t){return t.selection.main.from}function Fk(t,e){var i;let{source:r}=t,n=e&&r[0]!="^",o=r[r.length-1]!="$";return!n&&!o?t:new RegExp(`${n?"^":""}(?:${r})${o?"$":""}`,(i=t.flags)!==null&&i!==void 0?i:t.ignoreCase?"i":"")}var C7=Kr.define();function E7(t,e,i,r){let{main:n}=t.selection,o=i-n.from,a=r-n.from;return Object.assign(Object.assign({},t.changeByRange(l=>l!=n&&i!=r&&t.sliceDoc(l.from+o,l.from+a)!=t.sliceDoc(i,r)?{range:l}:{changes:{from:l.from+o,to:r==n.from?l.to:l.from+a,insert:e},range:ge.cursor(l.from+o+e.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}var Rk=new WeakMap;function M7(t){if(!Array.isArray(t))return t;let e=Rk.get(t);return e||Rk.set(t,e=nf(t)),e}var E0=Dt.define(),tf=Dt.define(),Kw=class{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let i=0;i<e.length;){let r=Bi(e,i),n=Lr(r);this.chars.push(r);let o=e.slice(i,i+n),a=o.toUpperCase();this.folded.push(Bi(a==o?o.toLowerCase():a,0)),i+=n}this.astral=e.length!=this.chars.length}ret(e,i){return this.score=e,this.matched=i,!0}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return!1;let{chars:i,folded:r,any:n,precise:o,byWord:a}=this;if(i.length==1){let x=Bi(e,0),b=Lr(x),y=b==e.length?0:-100;if(x!=i[0])if(x==r[0])y+=-200;else return!1;return this.ret(y,[0,b])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let h=i.length,u=0;if(l<0){for(let x=0,b=Math.min(e.length,200);x<b&&u<h;){let y=Bi(e,x);(y==i[u]||y==r[u])&&(n[u++]=x),x+=Lr(y)}if(u<h)return!1}let c=0,f=0,d=!1,m=0,p=-1,v=-1,g=/[a-z]/.test(e),_=!0;for(let x=0,b=Math.min(e.length,200),y=0;x<b&&f<h;){let S=Bi(e,x);l<0&&(c<h&&S==i[c]&&(o[c++]=x),m<h&&(S==i[m]||S==r[m]?(m==0&&(p=x),v=x+1,m++):m=0));let w,M=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(w=dc(S))!=w.toLowerCase()?1:w!=w.toUpperCase()?2:0;(!x||M==1&&g||y==0&&M!=0)&&(i[f]==S||r[f]==S&&(d=!0)?a[f++]=x:a.length&&(_=!1)),y=M,x+=Lr(S)}return f==h&&a[0]==0&&_?this.result(-100+(d?-200:0),a,e):m==h&&p==0?this.ret(-200-e.length+(v==e.length?0:-100),[0,v]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):m==h?this.ret(-900-e.length,[p,v]):f==h?this.result(-100+(d?-200:0)+-700+(_?0:-1100),a,e):i.length==2?!1:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,i,r){let n=[],o=0;for(let a of i){let l=a+(this.astral?Lr(Bi(r,a)):1);o&&n[o-1]==a?n[o-1]=l:(n[o++]=a,n[o++]=l)}return this.ret(e-r.length,n)}},fr=Ve.define({combine(t){return Qr(t,{activateOnTyping:!0,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:T7,compareCompletions:(e,i)=>e.label.localeCompare(i.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,i)=>e&&i,closeOnBlur:(e,i)=>e&&i,icons:(e,i)=>e&&i,tooltipClass:(e,i)=>r=>Lk(e(r),i(r)),optionClass:(e,i)=>r=>Lk(e(r),i(r)),addToOptions:(e,i)=>e.concat(i)})}});function Lk(t,e){return t?e?t+" "+e:t:e}function T7(t,e,i,r,n,o){let a=t.textDirection==ti.RTL,l=a,h=!1,u="top",c,f,d=e.left-n.left,m=n.right-e.right,p=r.right-r.left,v=r.bottom-r.top;if(l&&d<Math.min(p,m)?l=!1:!l&&m<Math.min(p,d)&&(l=!0),p<=(l?d:m))c=Math.max(n.top,Math.min(i.top,n.bottom-v))-e.top,f=Math.min(400,l?d:m);else{h=!0,f=Math.min(400,(a?e.right:n.right-e.left)-30);let x=n.bottom-e.bottom;x>=v||x>e.top?c=i.bottom-e.top:(u="bottom",c=e.bottom-i.top)}let g=(e.bottom-e.top)/o.offsetHeight,_=(e.right-e.left)/o.offsetWidth;return{style:`${u}: ${c/g}px; max-width: ${f/_}px`,class:"cm-completionInfo-"+(h?a?"left-narrow":"right-narrow":l?"left":"right")}}function A7(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(i){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),i.type&&r.classList.add(...i.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(i,r,n,o){let a=document.createElement("span");a.className="cm-completionLabel";let l=i.displayLabel||i.label,h=0;for(let u=0;u<o.length;){let c=o[u++],f=o[u++];c>h&&a.appendChild(document.createTextNode(l.slice(h,c)));let d=a.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(l.slice(c,f))),d.className="cm-completionMatchedText",h=f}return h<l.length&&a.appendChild(document.createTextNode(l.slice(h))),a},position:50},{render(i){if(!i.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=i.detail,r},position:80}),e.sort((i,r)=>i.position-r.position).map(i=>i.render)}function Yw(t,e,i){if(t<=i)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let n=Math.floor(e/i);return{from:n*i,to:(n+1)*i}}let r=Math.floor((t-e)/i);return{from:t-(r+1)*i,to:t-r*i}}var Qw=class{constructor(e,i,r){this.view=e,this.stateField=i,this.applyCompletion=r,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:h=>this.placeInfo(h),key:this},this.space=null,this.currentClass="";let n=e.state.field(i),{options:o,selected:a}=n.open,l=e.state.facet(fr);this.optionContent=A7(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=Yw(o.length,a,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",h=>{let{options:u}=e.state.field(i).open;for(let c=h.target,f;c&&c!=this.dom;c=c.parentNode)if(c.nodeName=="LI"&&(f=/-(\d+)$/.exec(c.id))&&+f[1]<u.length){this.applyCompletion(e,u[+f[1]]),h.preventDefault();return}}),this.dom.addEventListener("focusout",h=>{let u=e.state.field(this.stateField,!1);u&&u.tooltip&&e.state.facet(fr).closeOnBlur&&h.relatedTarget!=e.contentDOM&&e.dispatch({effects:tf.of(null)})}),this.showOptions(o,n.id)}mount(){this.updateSel()}showOptions(e,i){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,i,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var i;let r=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),r!=n){let{options:o,selected:a,disabled:l}=r.open;(!n.open||n.open.options!=o)&&(this.range=Yw(o.length,a,e.state.facet(fr).maxRenderedOptions),this.showOptions(o,r.id)),this.updateSel(),l!=((i=n.open)===null||i===void 0?void 0:i.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let i=this.tooltipClass(e);if(i!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of i.split(" "))r&&this.dom.classList.add(r);this.currentClass=i}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),i=e.open;if((i.selected>-1&&i.selected<this.range.from||i.selected>=this.range.to)&&(this.range=Yw(i.options.length,i.selected,this.view.state.facet(fr).maxRenderedOptions),this.showOptions(i.options,e.id)),this.updateSelectedOption(i.selected)){this.destroyInfo();let{completion:r}=i.options[i.selected],{info:n}=r;if(!n)return;let o=typeof n=="string"?document.createTextNode(n):n(r);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(a,r)}).catch(a=>pn(this.view.state,a,"completion info")):this.addInfoPane(o,r)}}addInfoPane(e,i){this.destroyInfo();let r=this.info=document.createElement("div");if(r.className="cm-tooltip cm-completionInfo",e.nodeType!=null)r.appendChild(e),this.infoDestroy=null;else{let{dom:n,destroy:o}=e;r.appendChild(n),this.infoDestroy=o||null}this.dom.appendChild(r),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let i=null;for(let r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++)r.nodeName!="LI"||!r.id?n--:n==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),i=r):r.hasAttribute("aria-selected")&&r.removeAttribute("aria-selected");return i&&R7(this.list,i),i}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let i=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),o=this.space;if(!o){let a=this.dom.ownerDocument.defaultView||window;o={left:0,top:0,right:a.innerWidth,bottom:a.innerHeight}}return n.top>Math.min(o.bottom,i.bottom)-10||n.bottom<Math.max(o.top,i.top)+10?null:this.view.state.facet(fr).positionInfo(this.view,i,n,r,o,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,i,r){let n=document.createElement("ul");n.id=i,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));let o=null;for(let a=r.from;a<r.to;a++){let{completion:l,match:h}=e[a],{section:u}=l;if(u){let d=typeof u=="string"?u:u.name;if(d!=o&&(a>r.from||r.from==0))if(o=d,typeof u!="string"&&u.header)n.appendChild(u.header(u));else{let m=n.appendChild(document.createElement("completion-section"));m.textContent=d}}let c=n.appendChild(document.createElement("li"));c.id=i+"-"+a,c.setAttribute("role","option");let f=this.optionClass(l);f&&(c.className=f);for(let d of this.optionContent){let m=d(l,this.view.state,this.view,h);m&&c.appendChild(m)}}return r.from&&n.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}};function P7(t,e){return i=>new Qw(i,t,e)}function R7(t,e){let i=t.getBoundingClientRect(),r=e.getBoundingClientRect(),n=i.height/t.offsetHeight;r.top<i.top?t.scrollTop-=(i.top-r.top)/n:r.bottom>i.bottom&&(t.scrollTop+=(r.bottom-i.bottom)/n)}function Ok(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function L7(t,e){let i=[],r=null,n=h=>{i.push(h);let{section:u}=h.completion;if(u){r||(r=[]);let c=typeof u=="string"?u:u.name;r.some(f=>f.name==c)||r.push(typeof u=="string"?{name:c}:u)}};for(let h of t)if(h.hasResult()){let u=h.result.getMatch;if(h.result.filter===!1)for(let c of h.result.options)n(new C0(c,h.source,u?u(c):[],1e9-i.length));else{let c=new Kw(e.sliceDoc(h.from,h.to));for(let f of h.result.options)if(c.match(f.label)){let d=f.displayLabel?u?u(f,c.matched):[]:c.matched;n(new C0(f,h.source,d,c.score+(f.boost||0)))}}}if(r){let h=Object.create(null),u=0,c=(f,d)=>{var m,p;return((m=f.rank)!==null&&m!==void 0?m:1e9)-((p=d.rank)!==null&&p!==void 0?p:1e9)||(f.name<d.name?-1:1)};for(let f of r.sort(c))u-=1e5,h[f.name]=u;for(let f of i){let{section:d}=f.completion;d&&(f.score+=h[typeof d=="string"?d:d.name])}}let o=[],a=null,l=e.facet(fr).compareCompletions;for(let h of i.sort((u,c)=>c.score-u.score||l(u.completion,c.completion))){let u=h.completion;!a||a.label!=u.label||a.detail!=u.detail||a.type!=null&&u.type!=null&&a.type!=u.type||a.apply!=u.apply||a.boost!=u.boost?o.push(h):Ok(h.completion)>Ok(a)&&(o[o.length-1]=h),a=h.completion}return o}var Jw=class t{constructor(e,i,r,n,o,a){this.options=e,this.attrs=i,this.tooltip=r,this.timestamp=n,this.selected=o,this.disabled=a}setSelected(e,i){return e==this.selected||e>=this.options.length?this:new t(this.options,Dk(i,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,i,r,n,o){let a=L7(e,i);if(!a.length)return n&&e.some(h=>h.state==1)?new t(n.options,n.attrs,n.tooltip,n.timestamp,n.selected,!0):null;let l=i.facet(fr).selectOnOpen?0:-1;if(n&&n.selected!=l&&n.selected!=-1){let h=n.options[n.selected].completion;for(let u=0;u<a.length;u++)if(a[u].completion==h){l=u;break}}return new t(a,Dk(r,l),{pos:e.reduce((h,u)=>u.hasResult()?Math.min(h,u.from):h,1e8),create:F7,above:o.aboveCursor},n?n.timestamp:Date.now(),l,!1)}map(e){return new t(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}},$w=class t{constructor(e,i,r){this.active=e,this.id=i,this.open=r}static start(){return new t(I7,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:i}=e,r=i.facet(fr),o=(r.override||i.languageDataAt("autocomplete",ca(i)).map(M7)).map(l=>(this.active.find(u=>u.source==l)||new bo(l,this.active.some(u=>u.state!=0)?1:0)).update(e,r));o.length==this.active.length&&o.every((l,h)=>l==this.active[h])&&(o=this.active);let a=this.open;a&&e.docChanged&&(a=a.map(e.changes)),e.selection||o.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!O7(o,this.active)?a=Jw.build(o,i,this.id,a,r):a&&a.disabled&&!o.some(l=>l.state==1)&&(a=null),!a&&o.every(l=>l.state!=1)&&o.some(l=>l.hasResult())&&(o=o.map(l=>l.hasResult()?new bo(l.source,0):l));for(let l of e.effects)l.is(Nk)&&(a=a&&a.setSelected(l.value,this.id));return o==this.active&&a==this.open?this:new t(o,this.id,a)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:D7}};function O7(t,e){if(t==e)return!0;for(let i=0,r=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;r<e.length&&!e[r].hasResult;)r++;let n=i==t.length,o=r==e.length;if(n||o)return n==o;if(t[i++].result!=e[r++].result)return!1}}var D7={"aria-autocomplete":"list"};function Dk(t,e){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(i["aria-activedescendant"]=t+"-"+e),i}var I7=[];function e1(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}var bo=class t{constructor(e,i,r=-1){this.source=e,this.state=i,this.explicitPos=r}hasResult(){return!1}update(e,i){let r=e1(e),n=this;r?n=n.handleUserEvent(e,r,i):e.docChanged?n=n.handleChange(e):e.selection&&n.state!=0&&(n=new t(n.source,0));for(let o of e.effects)if(o.is(E0))n=new t(n.source,1,o.value?ca(e.state):-1);else if(o.is(tf))n=new t(n.source,0);else if(o.is(Bk))for(let a of o.value)a.source==n.source&&(n=a);return n}handleUserEvent(e,i,r){return i=="delete"||!r.activateOnTyping?this.map(e.changes):new t(this.source,1)}handleChange(e){return e.changes.touchesRange(ca(e.startState))?new t(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new t(this.source,this.state,e.mapPos(this.explicitPos))}},M0=class t extends bo{constructor(e,i,r,n,o){super(e,2,i),this.result=r,this.from=n,this.to=o}hasResult(){return!0}handleUserEvent(e,i,r){var n;let o=e.changes.mapPos(this.from),a=e.changes.mapPos(this.to,1),l=ca(e.state);if((this.explicitPos<0?l<=o:l<this.from)||l>a||i=="delete"&&ca(e.startState)==this.from)return new bo(this.source,i=="input"&&r.activateOnTyping?1:0);let h=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),u;return k7(this.result.validFor,e.state,o,a)?new t(this.source,h,this.result,o,a):this.result.update&&(u=this.result.update(this.result,o,a,new S0(e.state,l,h>=0)))?new t(this.source,h,u,u.from,(n=u.to)!==null&&n!==void 0?n:ca(e.state)):new bo(this.source,1,h)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new bo(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new t(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}};function k7(t,e,i,r){if(!t)return!1;let n=e.sliceDoc(i,r);return typeof t=="function"?t(n,i,r,e):Fk(t,!0).test(n)}var Bk=Dt.define({map(t,e){return t.map(i=>i.map(e))}}),Nk=Dt.define(),yn=Zi.define({create(){return $w.start()},update(t,e){return t.update(e)},provide:t=>[Ib.from(t,e=>e.tooltip),ze.contentAttributes.from(t,e=>e.attrs)]});function Uk(t,e){let i=e.completion.apply||e.completion.label,r=t.state.field(yn).active.find(n=>n.source==e.source);return r instanceof M0?(typeof i=="string"?t.dispatch(Object.assign(Object.assign({},E7(t.state,i,r.from,r.to)),{annotations:C7.of(e.completion)})):i(t,e.completion,r.from,r.to),!0):!1}var F7=P7(yn,Uk);function w0(t,e="option"){return i=>{let r=i.state.field(yn,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<i.state.facet(fr).interactionDelay)return!1;let n=1,o;e=="page"&&(o=kb(i,r.open.tooltip))&&(n=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let{length:a}=r.open.options,l=r.open.selected>-1?r.open.selected+n*(t?1:-1):t?0:a-1;return l<0?l=e=="page"?0:a-1:l>=a&&(l=e=="page"?a-1:0),i.dispatch({effects:Nk.of(l)}),!0}}var B7=t=>{let e=t.state.field(yn,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(fr).interactionDelay?!1:Uk(t,e.open.options[e.open.selected])},N7=t=>t.state.field(yn,!1)?(t.dispatch({effects:E0.of(!0)}),!0):!1,U7=t=>{let e=t.state.field(yn,!1);return!e||!e.active.some(i=>i.state!=0)?!1:(t.dispatch({effects:tf.of(null)}),!0)},t1=class{constructor(e,i){this.active=e,this.context=i,this.time=Date.now(),this.updates=[],this.done=void 0}},z7=50,G7=1e3,H7=Ki.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of t.state.field(yn).active)e.state==1&&this.startQuery(e)}update(t){let e=t.state.field(yn);if(!t.selectionSet&&!t.docChanged&&t.startState.field(yn)==e)return;let i=t.transactions.some(n=>(n.selection||n.docChanged)&&!e1(n));for(let n=0;n<this.running.length;n++){let o=this.running[n];if(i||o.updates.length+t.transactions.length>z7&&Date.now()-o.time>G7){for(let a of o.context.abortListeners)try{a()}catch(l){pn(this.view.state,l)}o.context.abortListeners=null,this.running.splice(n--,1)}else o.updates.push(...t.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),t.transactions.some(n=>n.effects.some(o=>o.is(E0)))&&(this.pendingStart=!0);let r=this.pendingStart?50:t.state.facet(fr).activateOnTypingDelay;if(this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(o=>o.active.source==n.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let n of t.transactions)e1(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:t}=this.view,e=t.field(yn);for(let i of e.active)i.state==1&&!this.running.some(r=>r.active.source==i.source)&&this.startQuery(i)}startQuery(t){let{state:e}=this.view,i=ca(e),r=new S0(e,i,t.explicitPos==i),n=new t1(t,r);this.running.push(n),Promise.resolve(t.source(r)).then(o=>{n.context.aborted||(n.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:tf.of(null)}),pn(this.view.state,o)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(fr).updateSyncTime))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(fr);for(let r=0;r<this.running.length;r++){let n=this.running[r];if(n.done===void 0)continue;if(this.running.splice(r--,1),n.done){let a=new M0(n.active.source,n.active.explicitPos,n.done,n.done.from,(t=n.done.to)!==null&&t!==void 0?t:ca(n.updates.length?n.updates[0].startState:this.view.state));for(let l of n.updates)a=a.update(l,i);if(a.hasResult()){e.push(a);continue}}let o=this.view.state.field(yn).active.find(a=>a.source==n.active.source);if(o&&o.state==1)if(n.done==null){let a=new bo(n.active.source,0);for(let l of n.updates)a=a.update(l,i);a.state!=1&&e.push(a)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:Bk.of(e)})}},{eventHandlers:{blur(t){let e=this.view.state.field(yn,!1);if(e&&e.tooltip&&this.view.state.facet(fr).closeOnBlur){let i=e.open&&kb(this.view,e.open.tooltip);(!i||!i.dom.contains(t.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:tf.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:E0.of(!1)}),20),this.composing=0}}}),W7=ze.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var rf={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},hl=Dt.define({map(t,e){let i=e.mapPos(t,-1,yr.TrackAfter);return i==null?void 0:i}}),i1=new class extends ss{};i1.startSide=1;i1.endSide=-1;var zk=Zi.define({create(){return Xt.empty},update(t,e){if(t=t.map(e.changes),e.selection){let i=e.state.doc.lineAt(e.selection.main.head);t=t.update({filter:r=>r>=i.from&&r<=i.to})}for(let i of e.effects)i.is(hl)&&(t=t.update({add:[i1.range(i.value,i.value+1)]}));return t}});function T0(){return[j7,zk]}var Zw="()[]{}<>";function Gk(t){for(let e=0;e<Zw.length;e+=2)if(Zw.charCodeAt(e)==t)return Zw.charAt(e+1);return dc(t<128?t:t+1)}function Hk(t,e){return t.languageDataAt("closeBrackets",e)[0]||rf}var V7=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),j7=ze.inputHandler.of((t,e,i,r)=>{if((V7?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let n=t.state.selection.main;if(r.length>2||r.length==2&&Lr(Bi(r,0))==1||e!=n.from||i!=n.to)return!1;let o=X7(t.state,r);return o?(t.dispatch(o),!0):!1}),q7=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Hk(t,t.selection.main.head).brackets||rf.brackets,n=null,o=t.changeByRange(a=>{if(a.empty){let l=Y7(t.doc,a.head);for(let h of r)if(h==l&&P0(t.doc,a.head)==Gk(Bi(h,0)))return{changes:{from:a.head-h.length,to:a.head+h.length},range:ge.cursor(a.head-h.length)}}return{range:n=a}});return n||e(t.update(o,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},A0=[{key:"Backspace",run:q7}];function X7(t,e){let i=Hk(t,t.selection.main.head),r=i.brackets||rf.brackets;for(let n of r){let o=Gk(Bi(n,0));if(e==n)return o==n?Q7(t,n,r.indexOf(n+n+n)>-1,i):Z7(t,n,o,i.before||rf.before);if(e==o&&Wk(t,t.selection.main.from))return K7(t,n,o)}return null}function Wk(t,e){let i=!1;return t.field(zk).between(0,t.doc.length,r=>{r==e&&(i=!0)}),i}function P0(t,e){let i=t.sliceString(e,e+2);return i.slice(0,Lr(Bi(i,0)))}function Y7(t,e){let i=t.sliceString(e-2,e);return Lr(Bi(i,0))==i.length?i:i.slice(1)}function Z7(t,e,i,r){let n=null,o=t.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:i,from:a.to}],effects:hl.of(a.to+e.length),range:ge.range(a.anchor+e.length,a.head+e.length)};let l=P0(t.doc,a.head);return!l||/\s/.test(l)||r.indexOf(l)>-1?{changes:{insert:e+i,from:a.head},effects:hl.of(a.head+e.length),range:ge.cursor(a.head+e.length)}:{range:n=a}});return n?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function K7(t,e,i){let r=null,n=t.changeByRange(o=>o.empty&&P0(t.doc,o.head)==i?{changes:{from:o.head,to:o.head+i.length,insert:i},range:ge.cursor(o.head+i.length)}:r={range:o});return r?null:t.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function Q7(t,e,i,r){let n=r.stringPrefixes||rf.stringPrefixes,o=null,a=t.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:hl.of(l.to+e.length),range:ge.range(l.anchor+e.length,l.head+e.length)};let h=l.head,u=P0(t.doc,h),c;if(u==e){if(Ik(t,h))return{changes:{insert:e+e,from:h},effects:hl.of(h+e.length),range:ge.cursor(h+e.length)};if(Wk(t,h)){let d=i&&t.sliceDoc(h,h+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:h,to:h+d.length,insert:d},range:ge.cursor(h+d.length)}}}else{if(i&&t.sliceDoc(h-2*e.length,h)==e+e&&(c=kk(t,h-2*e.length,n))>-1&&Ik(t,c))return{changes:{insert:e+e+e+e,from:h},effects:hl.of(h+e.length),range:ge.cursor(h+e.length)};if(t.charCategorizer(h)(u)!=Jt.Word&&kk(t,h,n)>-1&&!J7(t,h,e,n))return{changes:{insert:e+e,from:h},effects:hl.of(h+e.length),range:ge.cursor(h+e.length)}}return{range:o=l}});return o?null:t.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function Ik(t,e){let i=rr(t).resolveInner(e+1);return i.parent&&i.from==e}function J7(t,e,i,r){let n=rr(t).resolveInner(e,-1),o=r.reduce((a,l)=>Math.max(a,l.length),0);for(let a=0;a<5;a++){let l=t.sliceDoc(n.from,Math.min(n.to,n.from+i.length+o)),h=l.indexOf(i);if(!h||h>-1&&r.indexOf(l.slice(0,h))>-1){let c=n.firstChild;for(;c&&c.from==n.from&&c.to-c.from>i.length+h;){if(t.sliceDoc(c.to-i.length,c.to)==i)return!1;c=c.firstChild}return!0}let u=n.to==e&&n.parent;if(!u)break;n=u}return!1}function kk(t,e,i){let r=t.charCategorizer(e);if(r(t.sliceDoc(e-1,e))!=Jt.Word)return e;for(let n of i){let o=e-n.length;if(t.sliceDoc(o,e)==n&&r(t.sliceDoc(o-1,o))!=Jt.Word)return o}return-1}function R0(t={}){return[yn,fr.of(t),H7,$7,W7]}var sf=[{key:"Ctrl-Space",run:N7},{key:"Escape",run:U7},{key:"ArrowDown",run:w0(!0)},{key:"ArrowUp",run:w0(!1)},{key:"PageDown",run:w0(!0,"page")},{key:"PageUp",run:w0(!1,"page")},{key:"Enter",run:B7}],$7=Os.highest($a.computeN([fr],t=>t.facet(fr).defaultKeymap?[sf]:[]));function L0(t){let e=t.firstChild,i=t.lastChild,r=e;for(;e.type.name!=="EndLine"&&e.nextSibling;)r=e,e=e.nextSibling;return r&&i&&r.to<i.from?{from:r.to,to:i&&i.type.isError?t.to:i.from}:null}function O0(t,e){let i=t.lineIndent(e.from),r=t.lineAt(t.pos,-1),n=r.from+r.text.length;return!/\S/.test(r.text)&&t.node.to<n+100&&!/\S/.test(t.state.sliceDoc(n,t.node.to))&&t.lineIndent(t.pos,-1)<=i?null:i+t.unit}var jk=wh.define({parser:Vk.parser.configure({props:[lw.add({If:t=>{var e;return(e=O0(t,t.node))!=null?e:t.continue()},While:t=>{var e;return(e=O0(t,t.node))!=null?e:t.continue()},Function:t=>{var e;return(e=O0(t,t.node))!=null?e:t.continue()},Dialog:t=>{var e;return(e=O0(t,t.node))!=null?e:t.continue()}}),hw.add({If:L0,While:L0,Function:L0,Dialog:L0,computedExpressionBlock:rI}),xh({Varname:J.variableName,Function:J.modifier,Scope:J.self,GCodeCode:J.processingInstruction,GCodeCodeLetter:J.processingInstruction,NonGCodeFunction:J.processingInstruction,GCodeIdentifier:J.variableName,GCodeChar:J.variableName,Operator:J.variableName,SimpleOperator:J.variableName,String:J.string,ServerParamTextNoDQuote:J.string,ServerParamTextNoSQuote:J.string,ServerParamTextNoSpace:J.attributeName,DQuote:J.string,SQuote:J.string,LineComment:J.lineComment,LineError:J.annotation,GeneralServerCommand:J.keyword,StartWhile:J.keyword,EndWhile:J.keyword,StartIf:J.keyword,EndIf:J.keyword,StartFunction:J.keyword,EndFunction:J.keyword,StartDialog:J.keyword,EndDialog:J.keyword,SCSet:J.keyword,SCUnset:J.keyword,SCCall:J.keyword,SCDialogInput:J.keyword,SCReportVariables:J.keyword,SCDialogInputCheckbox:J.keyword,SCDialogInputDropdown:J.keyword,SCCallAndSave:J.keyword,SCMonitorCall:J.keyword,SCTimedCall:J.keyword,SCNoParam:J.keyword,SC1Param:J.keyword,SC2Params:J.keyword,SCCall1:J.keyword,Number:J.number,NumberParam:J.number,OneToOne:J.blockComment,CExpressionStart:J.brace,CExpressionEnd:J.brace,ParenOpen:J.paren,ParenClose:J.paren,"( )":J.paren,"{ }":J.brace,"[ ]":J.squareBracket})]}),languageData:{commentTokens:{line:";"}}});function bt(t,e,i,r){let n=i+e.label.length+1;t.dispatch(t.state.update({changes:{from:i,to:r,insert:e.label+"()"},selection:ge.create([ge.range(n,n)],0)}))}var ej=jk.data.of({autocomplete:nf([{label:"local",type:"scope"},{label:"deeplocal",type:"scope"},{label:"global",type:"scope"},{label:"sglobal",type:"scope"},{label:"perm",type:"scope"},{label:"gperm",type:"scope"},{label:"form",type:"scope"},{label:"job",type:"scope"},{label:"config",type:"scope"},{label:"transfer",type:"scope"},{label:"state",type:"scope"},{label:"const",type:"scope"},{label:"ext_0",type:"scope"},{label:"ext_1",type:"scope"},{label:"ext_2",type:"scope"},{label:"ext_3",type:"scope"},{label:"ext_4",type:"scope"},{label:"ext_5",type:"scope"},{label:"bed_0",type:"scope"},{label:"chamber_0",type:"scope"},{label:"duet_global",type:"scope"},{label:"@echo",type:"keyword",detail:"message..."},{label:"@pause",type:"keyword"},{label:"@pauseNoCooldown",type:"keyword"},{label:"@pauseExtruderCooldown",type:"keyword"},{label:"@pauseFullCooldown",type:"keyword"},{label:"@outOfFilament",type:"keyword"},{label:"@continue",type:"keyword"},{label:"@continueReheat",type:"keyword"},{label:"@stopPrint",type:"keyword"},{label:"@powerloss",type:"keyword"},{label:"@message",type:"keyword",detail:"text"},{label:"@pushmessage",type:"keyword",detail:"text"},{label:"@execute",type:"keyword",detail:"function [params..]"},{label:"@quickCommand",type:"keyword",detail:"command"},{label:"@wizardCommand",type:"keyword",detail:"command"},{label:"@runButtonCommand",type:"keyword",detail:"command"},{label:"@isathome",type:"keyword"},{label:"@kill",type:"keyword"},{label:"@waitForAllTemperatures",type:"keyword",detail:"maxDiff"},{label:"@cancelWaitForTemperatures",type:"keyword"},{label:"@event",type:"keyword"},{label:"@makeSnapshot",type:"keyword",detail:"webcamId"},{label:"@getip",type:"keyword"},{label:"@skip",type:"keyword",detail:"count"},{label:"@adderror",type:"keyword"},{label:"@autostartNextJob",type:"keyword"},{label:"@startNextPrintInQueue",type:"keyword"},{label:"@stopNextAutostart",type:"keyword"},{label:"@debugCon",type:"keyword"},{label:"@serverInfo",type:"keyword"},{label:"@printLastPrint",type:"keyword",detail:"[position]"},{label:"@queueLastPrint",type:"keyword",detail:"[position]"},{label:"@explainCom",type:"keyword"},{label:"@syncMotion",type:"keyword"},{label:"@webAction",type:"keyword",detail:"action [params..]"},{label:"@nosize",type:"keyword"},{label:"@size",type:"keyword"},{label:"@extruderColor",type:"keyword",detail:'extruderId "#RRGGBB"'},{label:"@info",type:"keyword",detail:"text"},{label:"@warning",type:"keyword",detail:"text"},{label:"@error",type:"keyword",detail:"text"},{label:"@dialogStart",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@dialogStart "" ""
${a}@dialogShow
`},selection:ge.create([ge.range(i+14,i+14)],0)}))}},{label:"@dialogIcon",type:"keyword",detail:"svgCode"},{label:"@dialogNoButtons",type:"keyword"},{label:"@dialogBlocking",type:"keyword"},{label:"@dialogBlockingJob",type:"keyword"},{label:"@dialogInputInt",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputDouble",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputString",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputDropdown",type:"keyword",detail:'"Caption" [scope.]var list [options...]'},{label:"@dialogInputCheckbox",type:"keyword",detail:'"Caption" "text" [scope.]var [options...]'},{label:"@dialogLabel",type:"keyword",detail:'"Text" [options...]'},{label:"@dialogButton",type:"keyword",detail:"text [codeWhenHit]"},{label:"@dialogButtonNC",type:"keyword",detail:"text [codeWhenHit]"},{label:"@dialogShow",type:"keyword",detail:"[scope.var]"},{label:"@dialogHide",type:"keyword",detail:"id"},{label:"@dialogHideAll",type:"keyword"},{label:"@reportTimer",type:"keyword",detail:"[message]"},{label:"@setTimer",type:"keyword",detail:"value"},{label:"@waitForTimer",type:"keyword",detail:"value"},{label:"@reloadLua",type:"keyword"},{label:"@set",type:"keyword",detail:"scope.name value"},{label:"@unset",type:"keyword",detail:"scope.name"},{label:"@triggerRescue",type:"keyword"},{label:"@if",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@if {{condition}}
${a}@endif
`},selection:ge.create([ge.range(i+6,i+15)],0)}))},detail:"condition"},{label:"@else",type:"keyword"},{label:"@endif",type:"keyword"},{label:"@ifTimerBelow",type:"keyword",detail:"value"},{label:"@ifPaused",type:"keyword"},{label:"@resetStack",type:"keyword"},{label:"@reportStack",type:"keyword"},{label:"@reportVariables",type:"keyword",detail:"[scope]"},{label:"@func",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);console.log("create",e,i,r),t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@func name
${a}@endfunc
`},selection:ge.create([ge.range(i+6,i+10)],0)}))},detail:"name [params ...]"},{label:"@endfunc",type:"keyword"},{label:"@return",type:"keyword",detail:"[value]"},{label:"@call",type:"keyword",detail:"function [params ...]"},{label:"@callAndSave",type:"keyword",detail:"function scope.var [params ...]"},{label:"@monitorCall",type:"keyword",detail:'name "expression" timeoutMS hitFunction missFunction'},{label:"@deleteMonitorCall",type:"keyword",detail:"name"},{label:"@callOnEvent",type:"keyword",detail:"event function"},{label:"@removeCallOnEvent",type:"keyword",detail:"event function"},{label:"@reportCallOnEvents",type:"keyword"},{label:"@moveRel",type:"keyword",detail:"[X] [Y] [Z] [E] [F]"},{label:"@moveAbs",type:"keyword",detail:"[X] [Y] [Z] [E] [F]"},{label:"@listMonitorCalls",type:"keyword"},{label:"@timedCall",type:"keyword"},{label:"@printModelById",type:"keyword",detail:"ID"},{label:"@printModelByName",type:"keyword",detail:"name"},{label:"@deleteTimedCall",type:"keyword"},{label:"@addDefaultWizard",type:"keyword",detail:"name [override]"},{label:"@listDefaultWizards",type:"keyword"},{label:"@screenshot",type:"keyword",detail:"webcamId"},{label:"@screenshotForced",type:"keyword",detail:"webcamId"},{label:"@meatpackStatus",type:"keyword"},{label:"@meatpackResetUsage",type:"keyword"},{label:"@while",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@while {{condition}}
${a}@endwhile
`},selection:ge.create([ge.range(i+9,i+18)],0)}))},detail:"condition"},{label:"@endwhile",type:"keyword"},{label:"fixed",type:"function",apply:bt,detail:"(value, digits):string"},{label:"ifelse",type:"function",apply:bt,detail:"(condition, trueValue, falseValue):number"},{label:"min",type:"function",apply:bt,detail:"(val1, val2, ...):number"},{label:"max",type:"function",apply:bt,detail:"(val1, val2, ...):number"},{label:"int",type:"function",apply:bt,detail:"(value):int"},{label:"float",type:"function",apply:bt,detail:"(value):number"},{label:"string",type:"function",apply:bt,detail:"(value):string"},{label:"mod",type:"function",apply:bt,detail:"(value, modulus):int"},{label:"floor",type:"function",apply:bt,detail:"(value):number"},{label:"ceil",type:"function",apply:bt,detail:"(value):number"},{label:"round",type:"function",apply:bt,detail:"(value):number"},{label:"not",type:"function",apply:bt,detail:"(value):bool"},{label:"get",type:"function",apply:bt,detail:"('scope','name'[, default]):any"},{label:"defined",type:"function",apply:bt,detail:"('scope','name'):bool"},{label:"undefined",type:"function",apply:bt,detail:"undefined('scope','name'):bool"},{label:"random",type:"function",apply:bt,detail:"(maxValue):number"},{label:"time",type:"function",apply:bt,detail:"():number"},{label:"sqrt",type:"function",apply:bt,detail:"(value):number"},{label:"pow",type:"function",apply:bt,detail:"(value, power):number"},{label:"exp",type:"function",apply:bt,detail:"(value):number"},{label:"log",type:"function",apply:bt,detail:"(value):number"},{label:"log10",type:"function",apply:bt,detail:"(value):number"},{label:"to_deg",type:"function",apply:bt,detail:"(rad):number"},{label:"to_rad",type:"function",apply:bt,detail:"(degree):number"},{label:"sin",type:"function",apply:bt,detail:"(rad):number"},{label:"cos",type:"function",apply:bt,detail:"(rad):number"},{label:"tan",type:"function",apply:bt,detail:"(rad):number"},{label:"asin",type:"function",apply:bt,detail:"(value):number"},{label:"acos",type:"function",apply:bt,detail:"(value):number"},{label:"atan",type:"function",apply:bt,detail:"(value):number"},{label:"atan2",type:"function",apply:bt,detail:"(value):number"},{label:"escape",type:"function",apply:bt,detail:"(text):string"},{label:"length",type:"function",apply:bt,detail:"(text):int"},{label:"substr",type:"function",apply:bt,detail:"(text, start, len):string"},{label:"duet_get_model",type:"function",apply:bt,detail:"(pointer_string [,default_value]):json"},{label:"get_json",type:"function",apply:bt,detail:"(json_string, pointer_string [,default_value]):json"},{label:"get_json_array_size",type:"function",apply:bt,detail:"(json_string, pointer_string):int"},{label:"set_json_string",type:"function",apply:bt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_int",type:"function",apply:bt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_double",type:"function",apply:bt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_bool",type:"function",apply:bt,detail:"(json_string, pointer_string,value]):json"},{label:"http_get",type:"function",apply:bt,detail:"(url):json"},{label:"http_post",type:"function",apply:bt,detail:"(url, json_object_data):json"},{label:"http_post_json",type:"function",apply:bt,detail:"(url, json_object_data):json"},{label:"url_escape",type:"function",apply:bt,deatil:"(text):string"}])});function qk(){return new Sh(jk,[ej])}var $k=hn(Jk());var eF=wh.define({parser:$k.parser.configure({props:[xh({ConfigOption:J.modifier,Comment:J.lineComment,Section:J.keyword,Special:J.brace,GCodeLine:J.string})]}),languageData:{commentTokens:{line:"#"}}});function ht(t,e,i,r){let n=i+e.label.length+1;t.state.sliceDoc(r,r+1)==="]"&&r++,t.dispatch(t.state.update({changes:{from:i,to:r,insert:e.label+`
`},selection:ge.create([ge.range(n,n)],0)}))}function Lt(t,e,i,r){let n=e.label.substr(0,e.label.length-1)+` name]
`,o=i+n.length-6;t.state.sliceDoc(r,r+1)==="]"&&r++,t.dispatch(t.state.update({changes:{from:i,to:r,insert:n},selection:ge.create([ge.range(o,o+4)],0)}))}var uj=eF.data.of({autocomplete:nf([{label:"[mcu]",type:"section",apply:ht},{label:"[printer]",type:"section",apply:ht},{label:"[stepper_x]",type:"section",apply:ht},{label:"[stepper_y]",type:"section",apply:ht},{label:"[stepper_z]",type:"section",apply:ht},{label:"[extruder]",type:"section",apply:ht},{label:"[stepper_a]",type:"section",apply:ht},{label:"[stepper_b]",type:"section",apply:ht},{label:"[stepper_c]",type:"section",apply:ht},{label:"[delta_calibrate]",type:"section",apply:ht},{label:"[heater_bed]",type:"section",apply:ht},{label:"[bed_mesh]",type:"section",apply:ht},{label:"[bed_tilt]",type:"section",apply:ht},{label:"[bed_screws]",type:"section",apply:ht},{label:"[screws_tilt_adjust]",type:"section",apply:ht},{label:"[z_tilt]",type:"section",apply:ht},{label:"[quad_gantry_level]",type:"section",apply:ht},{label:"[skew_correction]",type:"section",apply:ht},{label:"[safe_z_home]",type:"section",apply:ht},{label:"[homing_override]",type:"section",apply:ht},{label:"[endstop_phase]",type:"section",apply:Lt},{label:"[gcode_macro]",type:"section",apply:Lt},{label:"[delayed_gcode]",type:"section",apply:Lt},{label:"[save_variables]",type:"section",apply:ht},{label:"[idle_timeout]",type:"section",apply:ht},{label:"[virtual_sdcard]",type:"section",apply:ht},{label:"[sdcard_loop]",type:"section",apply:ht},{label:"[force_move]",type:"section",apply:ht},{label:"[pause_resume]",type:"section",apply:ht},{label:"[firmware_retraction]",type:"section",apply:ht},{label:"[gcode_arcs]",type:"section",apply:ht},{label:"[respond]",type:"section",apply:ht},{label:"[input_shaper]",type:"section",apply:ht},{label:"[adxl345]",type:"section",apply:ht},{label:"[resonance_tester]",type:"section",apply:ht},{label:"[board_pins]",type:"section",apply:Lt},{label:"[include]",type:"section",apply:Lt},{label:"[duplicate_pin_override]",type:"section",apply:ht},{label:"[probe]",type:"section",apply:ht},{label:"[bltouch]",type:"section",apply:ht},{label:"[stepper_z1]",type:"section",apply:ht},{label:"[stepper_z2]",type:"section",apply:ht},{label:"[stepper_z3]",type:"section",apply:ht},{label:"[extruder1]",type:"section",apply:ht},{label:"[extruder2]",type:"section",apply:ht},{label:"[extruder3]",type:"section",apply:ht},{label:"[extruder4]",type:"section",apply:ht},{label:"[dual_carriage]",type:"section",apply:ht},{label:"[extruder_stepper]",type:"section",apply:Lt},{label:"[manual_stepper]",type:"section",apply:Lt},{label:"[verify_heater]",type:"section",apply:Lt},{label:"[homing_heaters]",type:"section",apply:ht},{label:"[thermistor]",type:"section",apply:Lt},{label:"[adc_temperature]",type:"section",apply:Lt},{label:"[heater_generic]",type:"section",apply:Lt},{label:"[temperature_sensor]",type:"section",apply:Lt},{label:"[fan]",type:"section",apply:ht},{label:"[heater_fan]",type:"section",apply:Lt},{label:"[controller_fan]",type:"section",apply:Lt},{label:"[temperature_fan]",type:"section",apply:Lt},{label:"[fan_generic]",type:"section",apply:Lt},{label:"[servo]",type:"section",apply:Lt},{label:"[neopixel]",type:"section",apply:Lt},{label:"[dotstar]",type:"section",apply:Lt},{label:"[PCA9533]",type:"section",apply:Lt},{label:"[gcode_button]",type:"section",apply:Lt},{label:"[output_pin]",type:"section",apply:Lt},{label:"[static_digital_output]",type:"section",apply:Lt},{label:"[multi_pin]",type:"section",apply:Lt},{label:"[tmc2130]",type:"section",apply:Lt},{label:"[tmc2208]",type:"section",apply:Lt},{label:"[tmc2209]",type:"section",apply:Lt},{label:"[tmc2660]",type:"section",apply:Lt},{label:"[tmc5160]",type:"section",apply:Lt},{label:"[ad5206]",type:"section",apply:Lt},{label:"[mcp4451]",type:"section",apply:Lt},{label:"[mcp4728]",type:"section",apply:Lt},{label:"[mcp4018]",type:"section",apply:Lt},{label:"[display]",type:"section",apply:ht},{label:"[display_data]",type:"section",apply:ht},{label:"[display_template]",type:"section",apply:ht},{label:"[display_glyph]",type:"section",apply:ht},{label:"[menu]",type:"section",apply:Lt},{label:"[filament_switch_sensor]",type:"section",apply:Lt},{label:"[filament_motion_sensor]",type:"section",apply:Lt},{label:"[tsl1401cl_filament_width_sensor]",type:"section",apply:ht},{label:"[hall_filament_width_sensor]",type:"section",apply:ht},{label:"[sx1509]",type:"section",apply:Lt},{label:"[samd_sercom]",type:"section",apply:Lt},{label:"[adc_scaled]",type:"section",apply:Lt},{label:"[replicape]",type:"section",apply:ht},{label:"[palette2]",type:"section",apply:ht},{label:"cartesian",type:"value"},{label:"delta",type:"value"},{label:"corexy",type:"value"},{label:"corexz",type:"value"},{label:"hybrid_corexy",type:"value"},{label:"hybrid_corexz",type:"value"},{label:"polar",type:"value"},{label:"rotary_delta",type:"value"},{label:"winch",type:"value"},{label:"none",type:"value"},{label:"lagrange",type:"value"},{label:"bicubic",type:"value"},{label:"False",type:"value"},{label:"True",type:"value"},{label:"average",type:"value"},{label:"median",type:"value"},{label:"a0_pin: ",type:"option"},{label:"accel_chip: ",type:"option"},{label:"accel_chip_x: ",type:"option"},{label:"accel_chip_y: ",type:"option"},{label:"accel_per_hz: ",type:"option"},{label:"activate_gcode: ",type:"option"},{label:"adc1: ",type:"option"},{label:"adc2: ",type:"option"},{label:"adc_voltage: ",type:"option"},{label:"algorithm: ",type:"option"},{label:"aliases: ",type:"option"},{label:"aliases_",type:"option"},{label:"analog_pullup_resistor: ",type:"option"},{label:"analog_range: ",type:"option"},{label:"analog_range_back_pin: ",type:"option"},{label:"analog_range_click_pin: ",type:"option"},{label:"analog_range_down_pin: ",type:"option"},{label:"analog_range_kill_pin: ",type:"option"},{label:"analog_range_up_pin: ",type:"option"},{label:"anchor_x: ",type:"option"},{label:"anchor_y: ",type:"option"},{label:"anchor_z: ",type:"option"},{label:"angle: ",type:"option"},{label:"arm_length: ",type:"option"},{label:"auto_cancel_variation: ",type:"option"},{label:"auto_load_speed: ",type:"option"},{label:"axes: ",type:"option"},{label:"axes_map: ",type:"option"},{label:"back_pin: ",type:"option"},{label:"baud: ",type:"option"},{label:"beta: ",type:"option"},{label:"bicubic_tension: ",type:"option"},{label:"cal_dia1: ",type:"option"},{label:"cal_dia2: ",type:"option"},{label:"canbus_interface: ",type:"option"},{label:"canbus_uuid: ",type:"option"},{label:"chain_count: ",type:"option"},{label:"chain_length: ",type:"option"},{label:"channel_",type:"option"},{label:"check_gain_time: ",type:"option"},{label:"click_pin: ",type:"option"},{label:"clock_pin: ",type:"option"},{label:"color_order: ",type:"option"},{label:"contrast: ",type:"option"},{label:"control: ",type:"option"},{label:"control_pin: ",type:"option"},{label:"cs_pin: ",type:"option"},{label:"cycle_time: ",type:"option"},{label:"d4_pin: ",type:"option"},{label:"d5_pin: ",type:"option"},{label:"d6_pin: ",type:"option"},{label:"d7_pin: ",type:"option"},{label:"damping_ratio_x: ",type:"option"},{label:"damping_ratio_y: ",type:"option"},{label:"data_pin: ",type:"option"},{label:"deactivate_gcode: ",type:"option"},{label:"deactivate_on_each_sample: ",type:"option"},{label:"default_nominal_filament_diameter: ",type:"option"},{label:"default_prefix: ",type:"option"},{label:"default_type: ",type:"option"},{label:"delta_radius: ",type:"option"},{label:"description: ",type:"option"},{label:"detection_length: ",type:"option"},{label:"diag0_pin: ",type:"option"},{label:"diag1_pin: ",type:"option"},{label:"diag_pin: ",type:"option"},{label:"dir_pin: ",type:"option"},{label:"display_group: ",type:"option"},{label:"down_pin: ",type:"option"},{label:"driver_CHM: ",type:"option"},{label:"driver_DISS2G: ",type:"option"},{label:"driver_DISS2VS: ",type:"option"},{label:"driver_FD3: ",type:"option"},{label:"driver_FREEWHEEL: ",type:"option"},{label:"driver_HDEC: ",type:"option"},{label:"driver_HEND: ",type:"option"},{label:"driver_HSTRT: ",type:"option"},{label:"driver_IHOLDDELAY: ",type:"option"},{label:"driver_PWM_AMPL: ",type:"option"},{label:"driver_PWM_AUTOGRAD: ",type:"option"},{label:"driver_PWM_AUTOSCALE: ",type:"option"},{label:"driver_PWM_FREQ: ",type:"option"},{label:"driver_PWM_GRAD: ",type:"option"},{label:"driver_PWM_LIM: ",type:"option"},{label:"driver_PWM_OFS: ",type:"option"},{label:"driver_PWM_REG: ",type:"option"},{label:"driver_RNDTF: ",type:"option"},{label:"driver_SEIMIN: ",type:"option"},{label:"driver_SEMAX: ",type:"option"},{label:"driver_SEMIN: ",type:"option"},{label:"driver_SEUP: ",type:"option"},{label:"driver_SFILT: ",type:"option"},{label:"driver_SGT: ",type:"option"},{label:"driver_SGT: ",type:"option"},{label:"driver_SGTHRS: ",type:"option"},{label:"driver_SLPH: ",type:"option"},{label:"driver_SLPL: ",type:"option"},{label:"driver_TBL: ",type:"option"},{label:"driver_TOFF: ",type:"option"},{label:"driver_TPFD: ",type:"option"},{label:"driver_TPOWERDOWN: ",type:"option"},{label:"driver_TS2G: ",type:"option"},{label:"driver_VHIGHCHM: ",type:"option"},{label:"driver_VHIGHFS: ",type:"option"},{label:"ds18_report_time: ",type:"option"},{label:"e_pin: ",type:"option"},{label:"enable: ",type:"option"},{label:"enable_force_move: ",type:"option"},{label:"enable_pin: ",type:"option"},{label:"encoder_pins: ",type:"option"},{label:"endstop_accuracy: ",type:"option"},{label:"endstop_align_zero: ",type:"option"},{label:"endstop_pin: ",type:"option"},{label:"event_delay: ",type:"option"},{label:"extruder: ",type:"option"},{label:"fade_end: ",type:"option"},{label:"fade_start: ",type:"option"},{label:"fade_target: ",type:"option"},{label:"faulty_region_1_max: ",type:"option"},{label:"faulty_region_1_min: ",type:"option"},{label:"feedrate_normal: ",type:"option"},{label:"feedrate_splice: ",type:"option"},{label:"filename: ",type:"option"},{label:"full_steps_per_rotation: ",type:"option"},{label:"gantry_corners: ",type:"option"},{label:"gcode: ",type:"option"},{label:"gcode_id: ",type:"option"},{label:"gear_ratio: ",type:"option"},{label:"hardware_pwm: ",type:"option"},{label:"hd44780_protocol_init: ",type:"option"},{label:"heater_pin: ",type:"option"},{label:"heaters: ",type:"option"},{label:"heating_gain: ",type:"option"},{label:"hold_current: ",type:"option"},{label:"home_xy_position: ",type:"option"},{label:"homing_positive_dir: ",type:"option"},{label:"homing_retract_dist: ",type:"option"},{label:"homing_retract_speed: ",type:"option"},{label:"homing_speed: ",type:"option"},{label:"horizontal_move_z: ",type:"option"},{label:"host_mcu: ",type:"option"},{label:"htu21d_hold_master: ",type:"option"},{label:"htu21d_report_time: ",type:"option"},{label:"htu21d_resolution: ",type:"option"},{label:"hysteresis: ",type:"option"},{label:"hz_per_sec: ",type:"option"},{label:"i2c_address: ",type:"option"},{label:"i2c_bus: ",type:"option"},{label:"i2c_mcu: ",type:"option"},{label:"i2c_speed: ",type:"option"},{label:"idle_current_percent: ",type:"option"},{label:"idle_speed: ",type:"option"},{label:"idle_timeout: ",type:"option"},{label:"initial_BLUE: ",type:"option"},{label:"initial_GREEN: ",type:"option"},{label:"initial_RED: ",type:"option"},{label:"initial_WHITE: ",type:"option"},{label:"initial_angle: ",type:"option"},{label:"initial_duration: ",type:"option"},{label:"initial_pulse_width: ",type:"option"},{label:"inline_resistor: ",type:"option"},{label:"input: ",type:"option"},{label:"input_max: ",type:"option"},{label:"input_min: ",type:"option"},{label:"input_step: ",type:"option"},{label:"insert_gcode: ",type:"option"},{label:"instantaneous_corner_velocity: ",type:"option"},{label:"interpolate: ",type:"option"},{label:"invert: ",type:"option"},{label:"kick_start_time: ",type:"option"},{label:"kill_pin: ",type:"option"},{label:"kinematics: ",type:"option"},{label:"lcd_type: ",type:"option"},{label:"lift_speed: ",type:"option"},{label:"line_length: ",type:"option"},{label:"lm75_report_time: ",type:"option"},{label:"logging: ",type:"option"},{label:"lower_arm_length: ",type:"option"},{label:"max_accel: ",type:"option"},{label:"max_accel_to_decel: ",type:"option"},{label:"max_adjust: ",type:"option"},{label:"max_delta: ",type:"option"},{label:"max_difference: ",type:"option"},{label:"max_error: ",type:"option"},{label:"max_extrude_cross_section: ",type:"option"},{label:"max_extrude_only_accel: ",type:"option"},{label:"max_extrude_only_distance: ",type:"option"},{label:"max_extrude_only_velocity: ",type:"option"},{label:"max_freq: ",type:"option"},{label:"max_power: ",type:"option"},{label:"max_smoothing: ",type:"option"},{label:"max_temp: ",type:"option"},{label:"max_velocity: ",type:"option"},{label:"max_z_accel: ",type:"option"},{label:"max_z_velocity: ",type:"option"},{label:"maximum_mcu_duration: ",type:"option"},{label:"maximum_pulse_width: ",type:"option"},{label:"maximum_servo_angle: ",type:"option"},{label:"measurement_delay: ",type:"option"},{label:"measurement_interval: ",type:"option"},{label:"menu_reverse_navigation: ",type:"option"},{label:"menu_root: ",type:"option"},{label:"menu_timeout: ",type:"option"},{label:"mesh_max: ",type:"option"},{label:"mesh_min: ",type:"option"},{label:"mesh_origin: ",type:"option"},{label:"mesh_pps: ",type:"option"},{label:"mesh_radius: ",type:"option"},{label:"microsteps: ",type:"option"},{label:"min_diameter: ",type:"option"},{label:"min_extrude_temp: ",type:"option"},{label:"min_freq: ",type:"option"},{label:"min_temp: ",type:"option"},{label:"minimum_pulse_width: ",type:"option"},{label:"move_check_distance: ",type:"option"},{label:"move_to_previous: ",type:"option"},{label:"name: ",type:"option"},{label:"nozzle_diameter: ",type:"option"},{label:"off_below: ",type:"option"},{label:"param_",type:"option"},{label:"path: ",type:"option"},{label:"pause_delay: ",type:"option"},{label:"pause_on_runout: ",type:"option"},{label:"pid_Kd: ",type:"option"},{label:"pid_Ki: ",type:"option"},{label:"pid_Kp: ",type:"option"},{label:"pin: ",type:"option"},{label:"pin_move_time: ",type:"option"},{label:"pin_up_reports_not_triggered: ",type:"option"},{label:"pin_up_touch_mode_reports_triggered: ",type:"option"},{label:"pins: ",type:"option"},{label:"points: ",type:"option"},{label:"position: ",type:"option"},{label:"position_endstop: ",type:"option"},{label:"position_max: ",type:"option"},{label:"position_min: ",type:"option"},{label:"press_gcode: ",type:"option"},{label:"pressure_advance: ",type:"option"},{label:"pressure_advance_smooth_time: ",type:"option"},{label:"print_radius: ",type:"option"},{label:"probe_count: ",type:"option"},{label:"probe_points: ",type:"option"},{label:"probe_with_touch_mode: ",type:"option"},{label:"pullup_resistor: ",type:"option"},{label:"pwm: ",type:"option"},{label:"pwm_cycle_time: ",type:"option"},{label:"rate: ",type:"option"},{label:"raw_dia1: ",type:"option"},{label:"raw_dia2: ",type:"option"},{label:"realtime: ",type:"option"},{label:"recover_velocity: ",type:"option"},{label:"relative_reference_index: ",type:"option"},{label:"release_gcode: ",type:"option"},{label:"rename_existing: ",type:"option"},{label:"resistance",type:"option"},{label:"resolution: ",type:"option"},{label:"restart_method: ",type:"option"},{label:"retract_length: ",type:"option"},{label:"retract_speed: ",type:"option"},{label:"retries: ",type:"option"},{label:"retry_tolerance: ",type:"option"},{label:"revision: ",type:"option"},{label:"rotation_distance: ",type:"option"},{label:"round_probe_count: ",type:"option"},{label:"rs_pin: ",type:"option"},{label:"rst_pin: ",type:"option"},{label:"rtd_nominal_r: ",type:"option"},{label:"rtd_num_of_wires: ",type:"option"},{label:"rtd_reference_r: ",type:"option"},{label:"rtd_use_50Hz_filter: ",type:"option"},{label:"run_current: ",type:"option"},{label:"runout_gcode: ",type:"option"},{label:"sample_retract_dist: ",type:"option"},{label:"samples: ",type:"option"},{label:"samples_result: ",type:"option"},{label:"samples_tolerance: ",type:"option"},{label:"samples_tolerance_retries: ",type:"option"},{label:"scale: ",type:"option"},{label:"screw1: ",type:"option"},{label:"screw1_fine_adjust: ",type:"option"},{label:"screw1_name: ",type:"option"},{label:"screw2: ",type:"option"},{label:"screw2_fine_adjust: ",type:"option"},{label:"screw2_name: ",type:"option"},{label:"screw3: ",type:"option"},{label:"screw3_fine_adjust: ",type:"option"},{label:"screw3_name: ",type:"option"},{label:"screw4: ",type:"option"},{label:"screw4_fine_adjust: ",type:"option"},{label:"screw4_name: ",type:"option"},{label:"screw_thread: ",type:"option"},{label:"second_homing_speed: ",type:"option"},{label:"select_pins: ",type:"option"},{label:"sense_resistor: ",type:"option"},{label:"sensor_adc",type:"option"},{label:"sensor_mcu: ",type:"option"},{label:"sensor_path: ",type:"option"},{label:"sensor_pin: ",type:"option"},{label:"sensor_temperature: ",type:"option"},{label:"sensor_type: ",type:"option"},{label:"serial: ",type:"option"},{label:"serial_no: ",type:"option"},{label:"set_output_mode: ",type:"option"},{label:"set_position_x: ",type:"option"},{label:"set_position_y: ",type:"option"},{label:"set_position_z: ",type:"option"},{label:"shaper_freq_x: ",type:"option"},{label:"shaper_freq_y: ",type:"option"},{label:"shaper_type: ",type:"option"},{label:"shaper_type_x: ",type:"option"},{label:"shaper_type_y: ",type:"option"},{label:"shoulder_height: ",type:"option"},{label:"shoulder_radius: ",type:"option"},{label:"shutdown_speed: ",type:"option"},{label:"shutdown_value: ",type:"option"},{label:"sid_pin: ",type:"option"},{label:"smooth_time: ",type:"option"},{label:"smooth_time: ",type:"option"},{label:"speed: ",type:"option"},{label:"spi_bus: ",type:"option"},{label:"spi_software_miso_pin: ",type:"option"},{label:"spi_software_mosi_pin: ",type:"option"},{label:"spi_software_sclk_pin: ",type:"option"},{label:"spi_speed: ",type:"option"},{label:"split_delta_z: ",type:"option"},{label:"square_corner_velocity: ",type:"option"},{label:"standstill_power_down: ",type:"option"},{label:"static_value: ",type:"option"},{label:"stealthchop_threshold: ",type:"option"},{label:"step_pin: ",type:"option"},{label:"stepper_e_chopper_blank_time_high: ",type:"option"},{label:"stepper_e_chopper_hysteresis_high: ",type:"option"},{label:"stepper_e_chopper_off_time_high: ",type:"option"},{label:"stepper_e_current: ",type:"option"},{label:"stepper_e_microstep_mode: ",type:"option"},{label:"stepper_h_chopper_blank_time_high: ",type:"option"},{label:"stepper_h_chopper_hysteresis_high: ",type:"option"},{label:"stepper_h_chopper_off_time_high: ",type:"option"},{label:"stepper_h_current: ",type:"option"},{label:"stepper_h_microstep_mode: ",type:"option"},{label:"stepper_x_chopper_blank_time_high: ",type:"option"},{label:"stepper_x_chopper_hysteresis_high: ",type:"option"},{label:"stepper_x_chopper_off_time_high: ",type:"option"},{label:"stepper_x_current: ",type:"option"},{label:"stepper_x_microstep_mode: ",type:"option"},{label:"stepper_y_chopper_blank_time_high: ",type:"option"},{label:"stepper_y_chopper_hysteresis_high: ",type:"option"},{label:"stepper_y_chopper_off_time_high: ",type:"option"},{label:"stepper_y_current: ",type:"option"},{label:"stepper_y_microstep_mode: ",type:"option"},{label:"stepper_z_chopper_blank_time_high: ",type:"option"},{label:"stepper_z_chopper_hysteresis_high: ",type:"option"},{label:"stepper_z_chopper_off_time_high: ",type:"option"},{label:"stepper_z_current: ",type:"option"},{label:"stepper_z_microstep_mode: ",type:"option"},{label:"steppers: ",type:"option"},{label:"stow_on_each_sample: ",type:"option"},{label:"switch_pin: ",type:"option"},{label:"tachometer_pin: ",type:"option"},{label:"tachometer_poll_interval: ",type:"option"},{label:"tachometer_ppr: ",type:"option"},{label:"tc_averaging_count: ",type:"option"},{label:"tc_type: ",type:"option"},{label:"tc_use_50Hz_filter: ",type:"option"},{label:"temperature",type:"option"},{label:"text: ",type:"option"},{label:"timeout: ",type:"option"},{label:"trigger_phase: ",type:"option"},{label:"tx_pin: ",type:"option"},{label:"type: ",type:"option"},{label:"uart_pin: ",type:"option"},{label:"unretract_extra_length: ",type:"option"},{label:"unretract_speed: ",type:"option"},{label:"up_pin: ",type:"option"},{label:"upper_arm_length: ",type:"option"},{label:"use_current_dia_while_delay: ",type:"option"},{label:"value: ",type:"option"},{label:"variable_",type:"option"},{label:"vcomh: ",type:"option"},{label:"voltage",type:"option"},{label:"voltage_offset: ",type:"option"},{label:"vssa_pin: ",type:"option"},{label:"wiper: ",type:"option"},{label:"wiper_",type:"option"},{label:"x_adjust: ",type:"option"},{label:"x_offset: ",type:"option"},{label:"y_adjust: ",type:"option"},{label:"y_offset: ",type:"option"},{label:"z_adjust: ",type:"option"},{label:"z_hop: ",type:"option"},{label:"z_hop_speed: ",type:"option"},{label:"z_offset: ",type:"option"},{label:"z_positions: ",type:"option"}])});function tF(){return new Sh(eF,[uj])}function nr(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var n=i[r];typeof n=="string"?t.setAttribute(r,n):n!=null&&(t[r]=n)}e++}for(;e<arguments.length;e++)iF(t,arguments[e]);return t}function iF(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)iF(t,e[i]);else throw new RangeError("Unsupported child node: "+e)}var rF=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,da=class{constructor(e,i,r=0,n=e.length,o,a){this.test=a,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,n),this.bufferStart=r,this.normalize=o?l=>o(rF(l)):rF,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Bi(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=dc(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=Lr(e);let n=this.normalize(i);for(let o=0,a=r;;o++){let l=n.charCodeAt(o),h=this.match(l,a,this.bufferPos+this.bufferStart);if(o==n.length-1){if(h)return this.value=h,this;break}a==r&&o<i.length&&i.charCodeAt(o)==l&&a++}}}match(e,i,r){let n=null;for(let o=0;o<this.matches.length;o+=2){let a=this.matches[o],l=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?n={from:this.matches[o+1],to:r}:(this.matches[o]++,l=!0)),l||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:i,to:r}:this.matches.push(1,i)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}};typeof Symbol!="undefined"&&(da.prototype[Symbol.iterator]=function(){return this});var aF={from:-1,to:-1,match:/.*/.exec("")},h1="gm"+(/x/.unicode==null?"":"u"),k0=class{constructor(e,i,r,n=0,o=e.length){if(this.text=e,this.to=o,this.curLine="",this.done=!1,this.value=aF,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new B0(e,i,r,n,o);this.re=new RegExp(i,h1+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let a=e.lineAt(n);this.curLineStart=a.from,this.matchPos=N0(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let r=this.curLineStart+i.index,n=r+i[0].length;if(this.matchPos=N0(this.text,n+(r==n?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<n||r>this.value.to)&&(!this.test||this.test(r,n,i)))return this.value={from:r,to:n,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},r1=new WeakMap,F0=class t{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,r){let n=r1.get(e);if(!n||n.from>=r||n.to<=i){let l=new t(i,e.sliceString(i,r));return r1.set(e,l),l}if(n.from==i&&n.to==r)return n;let{text:o,from:a}=n;return a>i&&(o=e.sliceString(i,a)+o,a=i),n.to<r&&(o+=e.sliceString(n.to,r)),r1.set(e,new t(a,o)),new t(i,o.slice(i-a,r-a))}},B0=class{constructor(e,i,r,n,o){this.text=e,this.to=o,this.done=!1,this.value=aF,this.matchPos=N0(e,n),this.re=new RegExp(i,h1+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=F0.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i){let r=this.flat.from+i.index,n=r+i[0].length;if((this.flat.to>=this.to||i.index+i[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,n,i)))return this.value={from:r,to:n,match:i},this.matchPos=N0(this.text,n+(r==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=F0.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol!="undefined"&&(k0.prototype[Symbol.iterator]=B0.prototype[Symbol.iterator]=function(){return this});function cj(t){try{return new RegExp(t,h1),!0}catch(e){return!1}}function N0(t,e){if(e>=t.length)return e;let i=t.lineAt(e),r;for(;e<i.to&&(r=i.text.charCodeAt(e-i.from))>=56320&&r<57344;)e++;return e}function n1(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),i=nr("input",{class:"cm-textfield",name:"line",value:e}),r=nr("form",{class:"cm-gotoLine",onkeydown:o=>{o.keyCode==27?(o.preventDefault(),t.dispatch({effects:U0.of(!1)}),t.focus()):o.keyCode==13&&(o.preventDefault(),n())},onsubmit:o=>{o.preventDefault(),n()}},nr("label",t.state.phrase("Go to line"),": ",i)," ",nr("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function n(){let o=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(i.value);if(!o)return;let{state:a}=t,l=a.doc.lineAt(a.selection.main.head),[,h,u,c,f]=o,d=c?+c.slice(1):0,m=u?+u:l.number;if(u&&f){let g=m/100;h&&(g=g*(h=="-"?-1:1)+l.number/a.doc.lines),m=Math.round(a.doc.lines*g)}else u&&h&&(m=m*(h=="-"?-1:1)+l.number);let p=a.doc.line(Math.max(1,Math.min(a.doc.lines,m))),v=ge.cursor(p.from+Math.max(0,Math.min(d,p.length)));t.dispatch({effects:[U0.of(!1),ze.scrollIntoView(v.from,{y:"center"})],selection:v}),t.focus()}return{dom:r}}var U0=Dt.define(),nF=Zi.define({create(){return!0},update(t,e){for(let i of e.effects)i.is(U0)&&(t=i.value);return t},provide:t=>Ic.from(t,e=>e?n1:null)}),fj=t=>{let e=kc(t,n1);if(!e){let i=[U0.of(!0)];t.state.field(nF,!1)==null&&i.push(Dt.appendConfig.of([nF,dj])),t.dispatch({effects:i}),e=kc(t,n1)}return e&&e.dom.querySelector("input").select(),!0},dj=ze.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),pj={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},lF=Ve.define({combine(t){return Qr(t,pj,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function q0(t){let e=[yj,_j];return t&&e.push(lF.of(t)),e}var mj=yt.mark({class:"cm-selectionMatch"}),gj=yt.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function sF(t,e,i,r){return(i==0||t(e.sliceDoc(i-1,i))!=Jt.Word)&&(r==e.doc.length||t(e.sliceDoc(r,r+1))!=Jt.Word)}function vj(t,e,i,r){return t(e.sliceDoc(i,i+1))==Jt.Word&&t(e.sliceDoc(r-1,r))==Jt.Word}var _j=Ki.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(lF),{state:i}=t,r=i.selection;if(r.ranges.length>1)return yt.none;let n=r.main,o,a=null;if(n.empty){if(!e.highlightWordAroundCursor)return yt.none;let h=i.wordAt(n.head);if(!h)return yt.none;a=i.charCategorizer(n.head),o=i.sliceDoc(h.from,h.to)}else{let h=n.to-n.from;if(h<e.minSelectionLength||h>200)return yt.none;if(e.wholeWords){if(o=i.sliceDoc(n.from,n.to),a=i.charCategorizer(n.head),!(sF(a,i,n.from,n.to)&&vj(a,i,n.from,n.to)))return yt.none}else if(o=i.sliceDoc(n.from,n.to),!o)return yt.none}let l=[];for(let h of t.visibleRanges){let u=new da(i.doc,o,h.from,h.to);for(;!u.next().done;){let{from:c,to:f}=u.value;if((!a||sF(a,i,c,f))&&(n.empty&&c<=n.from&&f>=n.to?l.push(gj.range(c,f)):(c>=n.to||f<=n.from)&&l.push(mj.range(c,f)),l.length>e.maxMatches))return yt.none}}return yt.set(l)}},{decorations:t=>t.decorations}),yj=ze.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),xj=({state:t,dispatch:e})=>{let{selection:i}=t,r=ge.create(i.ranges.map(n=>t.wordAt(n.head)||ge.cursor(n.head)),i.mainIndex);return r.eq(i)?!1:(e(t.update({selection:r})),!0)};function bj(t,e){let{main:i,ranges:r}=t.selection,n=t.wordAt(i.head),o=n&&n.from==i.from&&n.to==i.to;for(let a=!1,l=new da(t.doc,e,r[r.length-1].to);;)if(l.next(),l.done){if(a)return null;l=new da(t.doc,e,0,Math.max(0,r[r.length-1].from-1)),a=!0}else{if(a&&r.some(h=>h.from==l.value.from))continue;if(o){let h=t.wordAt(l.value.from);if(!h||h.from!=l.value.from||h.to!=l.value.to)continue}return l.value}}var wj=({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some(o=>o.from===o.to))return xj({state:t,dispatch:e});let r=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some(o=>t.sliceDoc(o.from,o.to)!=r))return!1;let n=bj(t,r);return n?(e(t.update({selection:t.selection.addRange(ge.range(n.from,n.to),!1),effects:ze.scrollIntoView(n.to)})),!0):!1},Ph=Ve.define({combine(t){return Qr(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new l1(e),scrollToMatch:e=>ze.scrollIntoView(e)})}});var z0=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||cj(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(i,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new o1(this):new s1(this)}getCursor(e,i=0,r){let n=e.doc?e:Nt.create({doc:e});return r==null&&(r=n.doc.length),this.regexp?Ah(this,n,i,r):Th(this,n,i,r)}},G0=class{constructor(e){this.spec=e}};function Th(t,e,i,r){return new da(e.doc,t.unquoted,i,r,t.caseSensitive?void 0:n=>n.toLowerCase(),t.wholeWord?Sj(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Sj(t,e){return(i,r,n,o)=>((o>i||o+n.length<r)&&(o=Math.max(0,i-2),n=t.sliceString(o,Math.min(t.length,r+2))),(e(H0(n,i-o))!=Jt.Word||e(W0(n,i-o))!=Jt.Word)&&(e(W0(n,r-o))!=Jt.Word||e(H0(n,r-o))!=Jt.Word))}var s1=class extends G0{constructor(e){super(e)}nextMatch(e,i,r){let n=Th(this.spec,e,r,e.doc.length).nextOverlapping();return n.done&&(n=Th(this.spec,e,0,i).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,i,r){for(let n=r;;){let o=Math.max(i,n-1e4-this.spec.unquoted.length),a=Th(this.spec,e,o,n),l=null;for(;!a.nextOverlapping().done;)l=a.value;if(l)return l;if(o==i)return null;n-=1e4}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,i){let r=Th(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=i)return null;n.push(r.value)}return n}highlight(e,i,r,n){let o=Th(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}};function Ah(t,e,i,r){return new k0(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Cj(e.charCategorizer(e.selection.main.head)):void 0},i,r)}function H0(t,e){return t.slice(Ni(t,e,!1),e)}function W0(t,e){return t.slice(e,Ni(t,e))}function Cj(t){return(e,i,r)=>!r[0].length||(t(H0(r.input,r.index))!=Jt.Word||t(W0(r.input,r.index))!=Jt.Word)&&(t(W0(r.input,r.index+r[0].length))!=Jt.Word||t(H0(r.input,r.index+r[0].length))!=Jt.Word)}var o1=class extends G0{nextMatch(e,i,r){let n=Ah(this.spec,e,r,e.doc.length).next();return n.done&&(n=Ah(this.spec,e,0,i).next()),n.done?null:n.value}prevMatchInRange(e,i,r){for(let n=1;;n++){let o=Math.max(i,r-n*1e4),a=Ah(this.spec,e,o,r),l=null;for(;!a.next().done;)l=a.value;if(l&&(o==i||l.from>o+10))return l;if(o==i)return null}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(i,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:i)}matchAll(e,i){let r=Ah(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=i)return null;n.push(r.value)}return n}highlight(e,i,r,n){let o=Ah(this.spec,e,Math.max(0,i-250),Math.min(r+250,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}},af=Dt.define(),u1=Dt.define(),fa=Zi.define({create(t){return new of(a1(t).create(),null)},update(t,e){for(let i of e.effects)i.is(af)?t=new of(i.value.create(),t.panel):i.is(u1)&&(t=new of(t.query,i.value?c1:null));return t},provide:t=>Ic.from(t,e=>e.panel)});var of=class{constructor(e,i){this.query=e,this.panel=i}},Ej=yt.mark({class:"cm-searchMatch"}),Mj=yt.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Tj=Ki.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(fa))}update(t){let e=t.state.field(fa);(e!=t.startState.field(fa)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return yt.none;let{view:i}=this,r=new os;for(let n=0,o=i.visibleRanges,a=o.length;n<a;n++){let{from:l,to:h}=o[n];for(;n<a-1&&h>o[n+1].from-2*250;)h=o[++n].to;t.highlight(i.state,l,h,(u,c)=>{let f=i.state.selection.ranges.some(d=>d.from==u&&d.to==c);r.add(u,c,f?Mj:Ej)})}return r.finish()}},{decorations:t=>t.decorations});function lf(t){return e=>{let i=e.state.field(fa,!1);return i&&i.query.spec.valid?t(e,i):cF(e)}}var V0=lf((t,{query:e})=>{let{to:i}=t.state.selection.main,r=e.nextMatch(t.state,i,i);if(!r)return!1;let n=ge.single(r.from,r.to),o=t.state.facet(Ph);return t.dispatch({selection:n,effects:[f1(t,r),o.scrollToMatch(n.main,t)],userEvent:"select.search"}),uF(t),!0}),j0=lf((t,{query:e})=>{let{state:i}=t,{from:r}=i.selection.main,n=e.prevMatch(i,r,r);if(!n)return!1;let o=ge.single(n.from,n.to),a=t.state.facet(Ph);return t.dispatch({selection:o,effects:[f1(t,n),a.scrollToMatch(o.main,t)],userEvent:"select.search"}),uF(t),!0}),Aj=lf((t,{query:e})=>{let i=e.matchAll(t.state,1e3);return!i||!i.length?!1:(t.dispatch({selection:ge.create(i.map(r=>ge.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),Pj=({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:r,to:n}=i.main,o=[],a=0;for(let l=new da(t.doc,t.sliceDoc(r,n));!l.next().done;){if(o.length>1e3)return!1;l.value.from==r&&(a=o.length),o.push(ge.range(l.value.from,l.value.to))}return e(t.update({selection:ge.create(o,a),userEvent:"select.search.matches"})),!0},oF=lf((t,{query:e})=>{let{state:i}=t,{from:r,to:n}=i.selection.main;if(i.readOnly)return!1;let o=e.nextMatch(i,r,r);if(!o)return!1;let a=[],l,h,u=[];if(o.from==r&&o.to==n&&(h=i.toText(e.getReplacement(o)),a.push({from:o.from,to:o.to,insert:h}),o=e.nextMatch(i,o.from,o.to),u.push(ze.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(r).number)+"."))),o){let c=a.length==0||a[0].from>=o.to?0:o.to-o.from-h.length;l=ge.single(o.from-c,o.to-c),u.push(f1(t,o)),u.push(i.facet(Ph).scrollToMatch(l.main,t))}return t.dispatch({changes:a,selection:l,effects:u,userEvent:"input.replace"}),!0}),Rj=lf((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state,1e9).map(n=>{let{from:o,to:a}=n;return{from:o,to:a,insert:e.getReplacement(n)}});if(!i.length)return!1;let r=t.state.phrase("replaced $ matches",i.length)+".";return t.dispatch({changes:i,effects:ze.announce.of(r),userEvent:"input.replace.all"}),!0});function c1(t){return t.state.facet(Ph).createPanel(t)}function a1(t,e){var i,r,n,o,a;let l=t.selection.main,h=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!h)return e;let u=t.facet(Ph);return new z0({search:((i=e==null?void 0:e.literal)!==null&&i!==void 0?i:u.literal)?h:h.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:u.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:u.literal,regexp:(o=e==null?void 0:e.regexp)!==null&&o!==void 0?o:u.regexp,wholeWord:(a=e==null?void 0:e.wholeWord)!==null&&a!==void 0?a:u.wholeWord})}function hF(t){let e=kc(t,c1);return e&&e.dom.querySelector("[main-field]")}function uF(t){let e=hF(t);e&&e==t.root.activeElement&&e.select()}var cF=t=>{let e=t.state.field(fa,!1);if(e&&e.panel){let i=hF(t);if(i&&i!=t.root.activeElement){let r=a1(t.state,e.query.spec);r.valid&&t.dispatch({effects:af.of(r)}),i.focus(),i.select()}}else t.dispatch({effects:[u1.of(!0),e?af.of(a1(t.state,e.query.spec)):Dt.appendConfig.of(Oj)]});return!0},fF=t=>{let e=t.state.field(fa,!1);if(!e||!e.panel)return!1;let i=kc(t,c1);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:u1.of(!1)}),!0},X0=[{key:"Mod-f",run:cF,scope:"editor search-panel"},{key:"F3",run:V0,shift:j0,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:V0,shift:j0,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:fF,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Pj},{key:"Mod-Alt-g",run:fj},{key:"Mod-d",run:wj,preventDefault:!0}],l1=class{constructor(e){this.view=e;let i=this.query=e.state.field(fa).query.spec;this.commit=this.commit.bind(this),this.searchField=nr("input",{value:i.search,placeholder:xn(e,"Find"),"aria-label":xn(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=nr("input",{value:i.replace,placeholder:xn(e,"Replace"),"aria-label":xn(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=nr("input",{type:"checkbox",name:"case",form:"",checked:i.caseSensitive,onchange:this.commit}),this.reField=nr("input",{type:"checkbox",name:"re",form:"",checked:i.regexp,onchange:this.commit}),this.wordField=nr("input",{type:"checkbox",name:"word",form:"",checked:i.wholeWord,onchange:this.commit});function r(n,o,a){return nr("button",{class:"cm-button",name:n,onclick:o,type:"button"},a)}this.dom=nr("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,r("next",()=>V0(e),[xn(e,"next")]),r("prev",()=>j0(e),[xn(e,"previous")]),r("select",()=>Aj(e),[xn(e,"all")]),nr("label",null,[this.caseField,xn(e,"match case")]),nr("label",null,[this.reField,xn(e,"regexp")]),nr("label",null,[this.wordField,xn(e,"by word")]),...e.state.readOnly?[]:[nr("br"),this.replaceField,r("replace",()=>oF(e),[xn(e,"replace")]),r("replaceAll",()=>Rj(e),[xn(e,"replace all")])],nr("button",{name:"close",onclick:()=>fF(e),"aria-label":xn(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new z0({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:af.of(e)}))}keydown(e){PD(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?j0:V0)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),oF(this.view))}update(e){for(let i of e.transactions)for(let r of i.effects)r.is(af)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Ph).top}};function xn(t,e){return t.state.phrase(e)}var D0=30,I0=/[\s\.,:;?!]/;function f1(t,{from:e,to:i}){let r=t.state.doc.lineAt(e),n=t.state.doc.lineAt(i).to,o=Math.max(r.from,e-D0),a=Math.min(n,i+D0),l=t.state.sliceDoc(o,a);if(o!=r.from){for(let h=0;h<D0;h++)if(!I0.test(l[h+1])&&I0.test(l[h])){l=l.slice(h);break}}if(a!=n){for(let h=l.length-1;h>l.length-D0;h--)if(!I0.test(l[h-1])&&I0.test(l[h])){l=l.slice(0,h);break}}return ze.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${r.number}.`)}var Lj=ze.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Oj=[fa,Os.low(Tj),Lj];RSBase.component("rsGcodeEditor",{require:{ngModel:"^ngModel"},bindings:{ro:"<"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=ze.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=ze.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=aa.define(i.theme==="dark"?[{tag:J.keyword,color:"#3DA6E8"},{tag:J.processingInstruction,color:"#97c3e0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#A5C29A"},{tag:J.variableName,color:"#fdfdfd"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#CBCBCB"},{tag:J.brace,color:"#f5e882"},{tag:J.squareBracket,color:"#c7c7c7"},{tag:J.paren,color:"#ffffff"},{tag:J.modifier,color:"#66cdaa"},{tag:J.self,color:"#cccccc"},{tag:J.attributeName,color:"#ffffff"},{tag:J.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:J.keyword,color:"#246186"},{tag:J.processingInstruction,color:"#7c9bb0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#b63dcb"},{tag:J.variableName,color:"#000000"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#737373"},{tag:J.brace,color:"#3300ff"},{tag:J.squareBracket,color:"#3a3a3a"},{tag:J.paren,color:"#000000"},{tag:J.modifier,color:"#668c86"},{tag:J.self,color:"#737373"},{tag:J.attributeName,color:"#000000"},{tag:J.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends xr{toDOM(){return document.createTextNode("\xF8")}},h=vh({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});this.editable=new hh,r.extensions=[Bg(),Ng(),Ig(),n0(),$g(),Dg(),Nt.allowMultipleSelections.of(!0),Kg(),t0({brackets:"[]"}),T0(),R0(),Fg(),kg(),q0(),$a.of([...A0,...u0,...X0,...o0,...Jg,...sf,c0]),qk(),n,o,e0(a),h,ze.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())}),this.editable.of(ze.editable.of(this.ro!==!0))],r.startState=Nt.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new ze({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Nt.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)}),this.$onChanges=u=>{u.ro&&this.view.dispatch({effects:this.editable.reconfigure(ze.editable.of(this.ro!==!0))})}}}],controllerAs:"ctrl"});RSBase.component("rsKlipperConfigEditor",{require:{ngModel:"^ngModel"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=ze.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=ze.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=aa.define(i.theme==="dark"?[{tag:J.keyword,color:"#3DA6E8"},{tag:J.processingInstruction,color:"#97c3e0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#A5C29A"},{tag:J.variableName,color:"#fdfdfd"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#CBCBCB"},{tag:J.brace,color:"#f5e882"},{tag:J.squareBracket,color:"#c7c7c7"},{tag:J.paren,color:"#ffffff"},{tag:J.modifier,color:"#66cdaa"},{tag:J.self,color:"#cccccc"},{tag:J.attributeName,color:"#ffffff"},{tag:J.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:J.keyword,color:"#246186"},{tag:J.processingInstruction,color:"#7c9bb0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#b63dcb"},{tag:J.variableName,color:"#000000"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#737373"},{tag:J.brace,color:"#3300ff"},{tag:J.squareBracket,color:"#3a3a3a"},{tag:J.paren,color:"#000000"},{tag:J.modifier,color:"#668c86"},{tag:J.self,color:"#737373"},{tag:J.attributeName,color:"#000000"},{tag:J.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends xr{toDOM(){return document.createTextNode("\xF8")}},h=vh({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});r.extensions=[Bg(),Ng(),Ig(),n0(),$g(),Dg(),Nt.allowMultipleSelections.of(!0),Kg(),t0({brackets:"[](){}"}),T0(),R0(),Fg(),kg(),q0(),$a.of([...A0,...u0,...X0,...o0,...Jg,...sf,c0]),tF(),n,o,e0(a),h,ze.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())})],r.startState=Nt.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new ze({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Nt.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)})}}],controllerAs:"ctrl"});RSBase.component("rsCodeEditor",{require:{ngModel:"^ngModel"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=ze.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=ze.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=aa.define(i.theme==="dark"?[{tag:J.keyword,color:"#3DA6E8"},{tag:J.processingInstruction,color:"#97c3e0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#A5C29A"},{tag:J.variableName,color:"#fdfdfd"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#CBCBCB"},{tag:J.brace,color:"#f5e882"},{tag:J.squareBracket,color:"#c7c7c7"},{tag:J.paren,color:"#ffffff"},{tag:J.modifier,color:"#66cdaa"},{tag:J.self,color:"#cccccc"},{tag:J.attributeName,color:"#ffffff"},{tag:J.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:J.keyword,color:"#246186"},{tag:J.processingInstruction,color:"#7c9bb0"},{tag:J.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:J.number,color:"#b63dcb"},{tag:J.variableName,color:"#000000"},{tag:J.string,color:"#C9856C"},{tag:J.blockComment,color:"#737373"},{tag:J.brace,color:"#3300ff"},{tag:J.squareBracket,color:"#3a3a3a"},{tag:J.paren,color:"#000000"},{tag:J.modifier,color:"#668c86"},{tag:J.self,color:"#737373"},{tag:J.attributeName,color:"#000000"},{tag:J.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends xr{toDOM(){return document.createTextNode("\xF8")}},h=vh({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});r.extensions=[Bg(),Ng(),Ig(),n0(),$g(),Dg(),Nt.allowMultipleSelections.of(!0),Kg(),cI.fallback,t0({brackets:"[](){}"}),T0(),R0(),Fg(),kg(),q0(),$a.of([...A0,...u0,...X0,...o0,...Jg,...sf,c0]),n,o,e0(a),h,ze.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())})],r.startState=Nt.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new ze({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Nt.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)})}}],controllerAs:"ctrl"});function hf(t,e){return function(){return t.apply(e,arguments)}}var{toString:Dj}=Object.prototype,{getPrototypeOf:m1}=Object,Z0=(t=>e=>{let i=Dj.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Ws=t=>(t=t.toLowerCase(),e=>Z0(e)===t),K0=t=>e=>typeof e===t,{isArray:Rh}=Array,uf=K0("undefined");function Ij(t){return t!==null&&!uf(t)&&t.constructor!==null&&!uf(t.constructor)&&Un(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}var mF=Ws("ArrayBuffer");function kj(t){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&mF(t.buffer),e}var Fj=K0("string"),Un=K0("function"),gF=K0("number"),Q0=t=>t!==null&&typeof t=="object",Bj=t=>t===!0||t===!1,Y0=t=>{if(Z0(t)!=="object")return!1;let e=m1(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Nj=Ws("Date"),Uj=Ws("File"),zj=Ws("Blob"),Gj=Ws("FileList"),Hj=t=>Q0(t)&&Un(t.pipe),Wj=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Un(t.append)&&((e=Z0(t))==="formdata"||e==="object"&&Un(t.toString)&&t.toString()==="[object FormData]"))},Vj=Ws("URLSearchParams"),jj=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function cf(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t=="undefined")return;let r,n;if(typeof t!="object"&&(t=[t]),Rh(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{let o=i?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length,l;for(r=0;r<a;r++)l=o[r],e.call(null,t[l],l,t)}}function vF(t,e){e=e.toLowerCase();let i=Object.keys(t),r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}var _F=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,yF=t=>!uf(t)&&t!==_F;function p1(){let{caseless:t}=yF(this)&&this||{},e={},i=(r,n)=>{let o=t&&vF(e,n)||n;Y0(e[o])&&Y0(r)?e[o]=p1(e[o],r):Y0(r)?e[o]=p1({},r):Rh(r)?e[o]=r.slice():e[o]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&cf(arguments[r],i);return e}var qj=(t,e,i,{allOwnKeys:r}={})=>(cf(e,(n,o)=>{i&&Un(n)?t[o]=hf(n,i):t[o]=n},{allOwnKeys:r}),t),Xj=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Yj=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Zj=(t,e,i,r)=>{let n,o,a,l={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),o=n.length;o-- >0;)a=n[o],(!r||r(a,t,e))&&!l[a]&&(e[a]=t[a],l[a]=!0);t=i!==!1&&m1(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Kj=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;let r=t.indexOf(e,i);return r!==-1&&r===i},Qj=t=>{if(!t)return null;if(Rh(t))return t;let e=t.length;if(!gF(e))return null;let i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},Jj=(t=>e=>t&&e instanceof t)(typeof Uint8Array!="undefined"&&m1(Uint8Array)),$j=(t,e)=>{let r=(t&&t[Symbol.iterator]).call(t),n;for(;(n=r.next())&&!n.done;){let o=n.value;e.call(t,o[0],o[1])}},eq=(t,e)=>{let i,r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},tq=Ws("HTMLFormElement"),iq=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),dF=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),rq=Ws("RegExp"),xF=(t,e)=>{let i=Object.getOwnPropertyDescriptors(t),r={};cf(i,(n,o)=>{let a;(a=e(n,o,t))!==!1&&(r[o]=a||n)}),Object.defineProperties(t,r)},nq=t=>{xF(t,(e,i)=>{if(Un(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let r=t[i];if(Un(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},sq=(t,e)=>{let i={},r=n=>{n.forEach(o=>{i[o]=!0})};return Rh(t)?r(t):r(String(t).split(e)),i},oq=()=>{},aq=(t,e)=>(t=+t,Number.isFinite(t)?t:e),d1="abcdefghijklmnopqrstuvwxyz",pF="0123456789",bF={DIGIT:pF,ALPHA:d1,ALPHA_DIGIT:d1+d1.toUpperCase()+pF},lq=(t=16,e=bF.ALPHA_DIGIT)=>{let i="",{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function hq(t){return!!(t&&Un(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}var uq=t=>{let e=new Array(10),i=(r,n)=>{if(Q0(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;let o=Rh(r)?[]:{};return cf(r,(a,l)=>{let h=i(a,n+1);!uf(h)&&(o[l]=h)}),e[n]=void 0,o}}return r};return i(t,0)},cq=Ws("AsyncFunction"),fq=t=>t&&(Q0(t)||Un(t))&&Un(t.then)&&Un(t.catch),fe={isArray:Rh,isArrayBuffer:mF,isBuffer:Ij,isFormData:Wj,isArrayBufferView:kj,isString:Fj,isNumber:gF,isBoolean:Bj,isObject:Q0,isPlainObject:Y0,isUndefined:uf,isDate:Nj,isFile:Uj,isBlob:zj,isRegExp:rq,isFunction:Un,isStream:Hj,isURLSearchParams:Vj,isTypedArray:Jj,isFileList:Gj,forEach:cf,merge:p1,extend:qj,trim:jj,stripBOM:Xj,inherits:Yj,toFlatObject:Zj,kindOf:Z0,kindOfTest:Ws,endsWith:Kj,toArray:Qj,forEachEntry:$j,matchAll:eq,isHTMLForm:tq,hasOwnProperty:dF,hasOwnProp:dF,reduceDescriptors:xF,freezeMethods:nq,toObjectSet:sq,toCamelCase:iq,noop:oq,toFiniteNumber:aq,findKey:vF,global:_F,isContextDefined:yF,ALPHABET:bF,generateString:lq,isSpecCompliantForm:hq,toJSONObject:uq,isAsyncFn:cq,isThenable:fq};function Lh(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}fe.inherits(Lh,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:fe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var wF=Lh.prototype,SF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{SF[t]={value:t}});Object.defineProperties(Lh,SF);Object.defineProperty(wF,"isAxiosError",{value:!0});Lh.from=(t,e,i,r,n,o)=>{let a=Object.create(wF);return fe.toFlatObject(t,a,function(h){return h!==Error.prototype},l=>l!=="isAxiosError"),Lh.call(a,t.message,e,i,r,n),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};var It=Lh;var J0=null;function g1(t){return fe.isPlainObject(t)||fe.isArray(t)}function EF(t){return fe.endsWith(t,"[]")?t.slice(0,-2):t}function CF(t,e,i){return t?t.concat(e).map(function(n,o){return n=EF(n),!i&&o?"["+n+"]":n}).join(i?".":""):e}function dq(t){return fe.isArray(t)&&!t.some(g1)}var pq=fe.toFlatObject(fe,{},null,function(e){return/^is[A-Z]/.test(e)});function mq(t,e,i){if(!fe.isObject(t))throw new TypeError("target must be an object");e=e||new(J0||FormData),i=fe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,g){return!fe.isUndefined(g[v])});let r=i.metaTokens,n=i.visitor||c,o=i.dots,a=i.indexes,h=(i.Blob||typeof Blob!="undefined"&&Blob)&&fe.isSpecCompliantForm(e);if(!fe.isFunction(n))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if(fe.isDate(p))return p.toISOString();if(!h&&fe.isBlob(p))throw new It("Blob is not supported. Use a Buffer instead.");return fe.isArrayBuffer(p)||fe.isTypedArray(p)?h&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,v,g){let _=p;if(p&&!g&&typeof p=="object"){if(fe.endsWith(v,"{}"))v=r?v:v.slice(0,-2),p=JSON.stringify(p);else if(fe.isArray(p)&&dq(p)||(fe.isFileList(p)||fe.endsWith(v,"[]"))&&(_=fe.toArray(p)))return v=EF(v),_.forEach(function(b,y){!(fe.isUndefined(b)||b===null)&&e.append(a===!0?CF([v],y,o):a===null?v:v+"[]",u(b))}),!1}return g1(p)?!0:(e.append(CF(g,v,o),u(p)),!1)}let f=[],d=Object.assign(pq,{defaultVisitor:c,convertValue:u,isVisitable:g1});function m(p,v){if(!fe.isUndefined(p)){if(f.indexOf(p)!==-1)throw Error("Circular reference detected in "+v.join("."));f.push(p),fe.forEach(p,function(_,x){(!(fe.isUndefined(_)||_===null)&&n.call(e,_,fe.isString(x)?x.trim():x,v,d))===!0&&m(_,v?v.concat(x):[x])}),f.pop()}}if(!fe.isObject(t))throw new TypeError("data must be an object");return m(t),e}var pa=mq;function MF(t){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function TF(t,e){this._pairs=[],t&&pa(t,this,e)}var AF=TF.prototype;AF.append=function(e,i){this._pairs.push([e,i])};AF.toString=function(e){let i=e?function(r){return e.call(this,r,MF)}:MF;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};var $0=TF;function gq(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ff(t,e,i){if(!e)return t;let r=i&&i.encode||gq,n=i&&i.serialize,o;if(n?o=n(e,i):o=fe.isURLSearchParams(e)?e.toString():new $0(e,i).toString(r),o){let a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}var v1=class{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){fe.forEach(this.handlers,function(r){r!==null&&e(r)})}},_1=v1;var ev={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var PF=typeof URLSearchParams!="undefined"?URLSearchParams:$0;var RF=typeof FormData!="undefined"?FormData:null;var LF=typeof Blob!="undefined"?Blob:null;var OF={isBrowser:!0,classes:{URLSearchParams:PF,FormData:RF,Blob:LF},protocols:["http","https","file","blob","url","data"]};var y1={};im(y1,{hasBrowserEnv:()=>DF,hasStandardBrowserEnv:()=>vq,hasStandardBrowserWebWorkerEnv:()=>_q});var DF=typeof window!="undefined"&&typeof document!="undefined",vq=(t=>DF&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator!="undefined"&&navigator.product),_q=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";var Fr=Mt(Mt({},y1),OF);function x1(t,e){return pa(t,new Fr.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,o){return Fr.isNode&&fe.isBuffer(i)?(this.append(r,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function yq(t){return fe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function xq(t){let e={},i=Object.keys(t),r,n=i.length,o;for(r=0;r<n;r++)o=i[r],e[o]=t[o];return e}function bq(t){function e(i,r,n,o){let a=i[o++];if(a==="__proto__")return!0;let l=Number.isFinite(+a),h=o>=i.length;return a=!a&&fe.isArray(n)?n.length:a,h?(fe.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!l):((!n[a]||!fe.isObject(n[a]))&&(n[a]=[]),e(i,r,n[a],o)&&fe.isArray(n[a])&&(n[a]=xq(n[a])),!l)}if(fe.isFormData(t)&&fe.isFunction(t.entries)){let i={};return fe.forEachEntry(t,(r,n)=>{e(yq(r),n,i,0)}),i}return null}var tv=bq;function wq(t,e,i){if(fe.isString(t))try{return(e||JSON.parse)(t),fe.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}var b1={transitional:ev,adapter:["xhr","http"],transformRequest:[function(e,i){let r=i.getContentType()||"",n=r.indexOf("application/json")>-1,o=fe.isObject(e);if(o&&fe.isHTMLForm(e)&&(e=new FormData(e)),fe.isFormData(e))return n?JSON.stringify(tv(e)):e;if(fe.isArrayBuffer(e)||fe.isBuffer(e)||fe.isStream(e)||fe.isFile(e)||fe.isBlob(e))return e;if(fe.isArrayBufferView(e))return e.buffer;if(fe.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return x1(e,this.formSerializer).toString();if((l=fe.isFileList(e))||r.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return pa(l?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||n?(i.setContentType("application/json",!1),wq(e)):e}],transformResponse:[function(e){let i=this.transitional||b1.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(e&&fe.isString(e)&&(r&&!this.responseType||n)){let a=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(l){if(a)throw l.name==="SyntaxError"?It.from(l,It.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Fr.classes.FormData,Blob:Fr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};fe.forEach(["delete","get","head","post","put","patch"],t=>{b1.headers[t]={}});var Oh=b1;var Sq=fe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),IF=t=>{let e={},i,r,n;return t&&t.split(`
`).forEach(function(a){n=a.indexOf(":"),i=a.substring(0,n).trim().toLowerCase(),r=a.substring(n+1).trim(),!(!i||e[i]&&Sq[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e};var kF=Symbol("internals");function df(t){return t&&String(t).trim().toLowerCase()}function iv(t){return t===!1||t==null?t:fe.isArray(t)?t.map(iv):String(t)}function Cq(t){let e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}var Eq=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function w1(t,e,i,r,n){if(fe.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!fe.isString(e)){if(fe.isString(r))return e.indexOf(r)!==-1;if(fe.isRegExp(r))return r.test(e)}}function Mq(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function Tq(t,e){let i=fe.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,o,a){return this[r].call(this,e,n,o,a)},configurable:!0})})}var Dh=class{constructor(e){e&&this.set(e)}set(e,i,r){let n=this;function o(l,h,u){let c=df(h);if(!c)throw new Error("header name must be a non-empty string");let f=fe.findKey(n,c);(!f||n[f]===void 0||u===!0||u===void 0&&n[f]!==!1)&&(n[f||h]=iv(l))}let a=(l,h)=>fe.forEach(l,(u,c)=>o(u,c,h));return fe.isPlainObject(e)||e instanceof this.constructor?a(e,i):fe.isString(e)&&(e=e.trim())&&!Eq(e)?a(IF(e),i):e!=null&&o(i,e,r),this}get(e,i){if(e=df(e),e){let r=fe.findKey(this,e);if(r){let n=this[r];if(!i)return n;if(i===!0)return Cq(n);if(fe.isFunction(i))return i.call(this,n,r);if(fe.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=df(e),e){let r=fe.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||w1(this,this[r],r,i)))}return!1}delete(e,i){let r=this,n=!1;function o(a){if(a=df(a),a){let l=fe.findKey(r,a);l&&(!i||w1(r,r[l],l,i))&&(delete r[l],n=!0)}}return fe.isArray(e)?e.forEach(o):o(e),n}clear(e){let i=Object.keys(this),r=i.length,n=!1;for(;r--;){let o=i[r];(!e||w1(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){let i=this,r={};return fe.forEach(this,(n,o)=>{let a=fe.findKey(r,o);if(a){i[a]=iv(n),delete i[o];return}let l=e?Mq(o):String(o).trim();l!==o&&delete i[o],i[l]=iv(n),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let i=Object.create(null);return fe.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&fe.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){let r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){let r=(this[kF]=this[kF]={accessors:{}}).accessors,n=this.prototype;function o(a){let l=df(a);r[l]||(Tq(n,a),r[l]=!0)}return fe.isArray(e)?e.forEach(o):o(e),this}};Dh.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);fe.reduceDescriptors(Dh.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});fe.freezeMethods(Dh);var Br=Dh;function pf(t,e){let i=this||Oh,r=e||i,n=Br.from(r.headers),o=r.data;return fe.forEach(t,function(l){o=l.call(i,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function mf(t){return!!(t&&t.__CANCEL__)}function FF(t,e,i){It.call(this,t==null?"canceled":t,It.ERR_CANCELED,e,i),this.name="CanceledError"}fe.inherits(FF,It,{__CANCEL__:!0});var ma=FF;function S1(t,e,i){let r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new It("Request failed with status code "+i.status,[It.ERR_BAD_REQUEST,It.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}var BF=Fr.hasStandardBrowserEnv?{write(t,e,i,r,n,o){let a=[t+"="+encodeURIComponent(e)];fe.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),fe.isString(r)&&a.push("path="+r),fe.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){let e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function C1(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function E1(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function gf(t,e){return t&&!C1(e)?E1(t,e):e}var NF=Fr.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a"),r;function n(o){let a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(a){let l=fe.isString(a)?n(a):a;return l.protocol===r.protocol&&l.host===r.host}}():function(){return function(){return!0}}();function M1(t){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Aq(t,e){t=t||10;let i=new Array(t),r=new Array(t),n=0,o=0,a;return e=e!==void 0?e:1e3,function(h){let u=Date.now(),c=r[o];a||(a=u),i[n]=h,r[n]=u;let f=o,d=0;for(;f!==n;)d+=i[f++],f=f%t;if(n=(n+1)%t,n===o&&(o=(o+1)%t),u-a<e)return;let m=c&&u-c;return m?Math.round(d*1e3/m):void 0}}var UF=Aq;function zF(t,e){let i=0,r=UF(50,250);return n=>{let o=n.loaded,a=n.lengthComputable?n.total:void 0,l=o-i,h=r(l),u=o<=a;i=o;let c={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:h||void 0,estimated:h&&a&&u?(a-o)/h:void 0,event:n};c[e?"download":"upload"]=!0,t(c)}}var Pq=typeof XMLHttpRequest!="undefined",GF=Pq&&function(t){return new Promise(function(i,r){let n=t.data,o=Br.from(t.headers).normalize(),{responseType:a,withXSRFToken:l}=t,h;function u(){t.cancelToken&&t.cancelToken.unsubscribe(h),t.signal&&t.signal.removeEventListener("abort",h)}let c;if(fe.isFormData(n)){if(Fr.hasStandardBrowserEnv||Fr.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((c=o.getContentType())!==!1){let[v,...g]=c?c.split(";").map(_=>_.trim()).filter(Boolean):[];o.setContentType([v||"multipart/form-data",...g].join("; "))}}let f=new XMLHttpRequest;if(t.auth){let v=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";o.set("Authorization","Basic "+btoa(v+":"+g))}let d=gf(t.baseURL,t.url);f.open(t.method.toUpperCase(),ff(d,t.params,t.paramsSerializer),!0),f.timeout=t.timeout;function m(){if(!f)return;let v=Br.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),_={data:!a||a==="text"||a==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:v,config:t,request:f};S1(function(b){i(b),u()},function(b){r(b),u()},_),f=null}if("onloadend"in f?f.onloadend=m:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(m)},f.onabort=function(){f&&(r(new It("Request aborted",It.ECONNABORTED,t,f)),f=null)},f.onerror=function(){r(new It("Network Error",It.ERR_NETWORK,t,f)),f=null},f.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",_=t.transitional||ev;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),r(new It(g,_.clarifyTimeoutError?It.ETIMEDOUT:It.ECONNABORTED,t,f)),f=null},Fr.hasStandardBrowserEnv&&(l&&fe.isFunction(l)&&(l=l(t)),l||l!==!1&&NF(d))){let v=t.xsrfHeaderName&&t.xsrfCookieName&&BF.read(t.xsrfCookieName);v&&o.set(t.xsrfHeaderName,v)}n===void 0&&o.setContentType(null),"setRequestHeader"in f&&fe.forEach(o.toJSON(),function(g,_){f.setRequestHeader(_,g)}),fe.isUndefined(t.withCredentials)||(f.withCredentials=!!t.withCredentials),a&&a!=="json"&&(f.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&f.addEventListener("progress",zF(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&f.upload&&f.upload.addEventListener("progress",zF(t.onUploadProgress)),(t.cancelToken||t.signal)&&(h=v=>{f&&(r(!v||v.type?new ma(null,t,f):v),f.abort(),f=null)},t.cancelToken&&t.cancelToken.subscribe(h),t.signal&&(t.signal.aborted?h():t.signal.addEventListener("abort",h)));let p=M1(d);if(p&&Fr.protocols.indexOf(p)===-1){r(new It("Unsupported protocol "+p+":",It.ERR_BAD_REQUEST,t));return}f.send(n||null)})};var T1={http:J0,xhr:GF};fe.forEach(T1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(i){}Object.defineProperty(t,"adapterName",{value:e})}});var HF=t=>`- ${t}`,Rq=t=>fe.isFunction(t)||t===null||t===!1,rv={getAdapter:t=>{t=fe.isArray(t)?t:[t];let{length:e}=t,i,r,n={};for(let o=0;o<e;o++){i=t[o];let a;if(r=i,!Rq(i)&&(r=T1[(a=String(i)).toLowerCase()],r===void 0))throw new It(`Unknown adapter '${a}'`);if(r)break;n[a||"#"+o]=r}if(!r){let o=Object.entries(n).map(([l,h])=>`adapter ${l} `+(h===!1?"is not supported by the environment":"is not available in the build")),a=e?o.length>1?`since :
`+o.map(HF).join(`
`):" "+HF(o[0]):"as no adapter specified";throw new It("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:T1};function A1(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ma(null,t)}function nv(t){return A1(t),t.headers=Br.from(t.headers),t.data=pf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),rv.getAdapter(t.adapter||Oh.adapter)(t).then(function(r){return A1(t),r.data=pf.call(t,t.transformResponse,r),r.headers=Br.from(r.headers),r},function(r){return mf(r)||(A1(t),r&&r.response&&(r.response.data=pf.call(t,t.transformResponse,r.response),r.response.headers=Br.from(r.response.headers))),Promise.reject(r)})}var WF=t=>t instanceof Br?Mt({},t):t;function wo(t,e){e=e||{};let i={};function r(u,c,f){return fe.isPlainObject(u)&&fe.isPlainObject(c)?fe.merge.call({caseless:f},u,c):fe.isPlainObject(c)?fe.merge({},c):fe.isArray(c)?c.slice():c}function n(u,c,f){if(fe.isUndefined(c)){if(!fe.isUndefined(u))return r(void 0,u,f)}else return r(u,c,f)}function o(u,c){if(!fe.isUndefined(c))return r(void 0,c)}function a(u,c){if(fe.isUndefined(c)){if(!fe.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function l(u,c,f){if(f in e)return r(u,c);if(f in t)return r(void 0,u)}let h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(u,c)=>n(WF(u),WF(c),!0)};return fe.forEach(Object.keys(Object.assign({},t,e)),function(c){let f=h[c]||n,d=f(t[c],e[c],c);fe.isUndefined(d)&&f!==l||(i[c]=d)}),i}var sv="1.6.8";var P1={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{P1[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});var VF={};P1.transitional=function(e,i,r){function n(o,a){return"[Axios v"+sv+"] Transitional option '"+o+"'"+a+(r?". "+r:"")}return(o,a,l)=>{if(e===!1)throw new It(n(a," has been removed"+(i?" in "+i:"")),It.ERR_DEPRECATED);return i&&!VF[a]&&(VF[a]=!0,console.warn(n(a," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,a,l):!0}};function Lq(t,e,i){if(typeof t!="object")throw new It("options must be an object",It.ERR_BAD_OPTION_VALUE);let r=Object.keys(t),n=r.length;for(;n-- >0;){let o=r[n],a=e[o];if(a){let l=t[o],h=l===void 0||a(l,o,t);if(h!==!0)throw new It("option "+o+" must be "+h,It.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new It("Unknown option "+o,It.ERR_BAD_OPTION)}}var ov={assertOptions:Lq,validators:P1};var ga=ov.validators,Ih=class{constructor(e){this.defaults=e,this.interceptors={request:new _1,response:new _1}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;let o=n.stack?n.stack.replace(/^.+\n/,""):"";r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=wo(this.defaults,i);let{transitional:r,paramsSerializer:n,headers:o}=i;r!==void 0&&ov.assertOptions(r,{silentJSONParsing:ga.transitional(ga.boolean),forcedJSONParsing:ga.transitional(ga.boolean),clarifyTimeoutError:ga.transitional(ga.boolean)},!1),n!=null&&(fe.isFunction(n)?i.paramsSerializer={serialize:n}:ov.assertOptions(n,{encode:ga.function,serialize:ga.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let a=o&&fe.merge(o.common,o[i.method]);o&&fe.forEach(["delete","get","head","post","put","patch","common"],p=>{delete o[p]}),i.headers=Br.concat(a,o);let l=[],h=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(i)===!1||(h=h&&v.synchronous,l.unshift(v.fulfilled,v.rejected))});let u=[];this.interceptors.response.forEach(function(v){u.push(v.fulfilled,v.rejected)});let c,f=0,d;if(!h){let p=[nv.bind(this),void 0];for(p.unshift.apply(p,l),p.push.apply(p,u),d=p.length,c=Promise.resolve(i);f<d;)c=c.then(p[f++],p[f++]);return c}d=l.length;let m=i;for(f=0;f<d;){let p=l[f++],v=l[f++];try{m=p(m)}catch(g){v.call(this,g);break}}try{c=nv.call(this,m)}catch(p){return Promise.reject(p)}for(f=0,d=u.length;f<d;)c=c.then(u[f++],u[f++]);return c}getUri(e){e=wo(this.defaults,e);let i=gf(e.baseURL,e.url);return ff(i,e.params,e.paramsSerializer)}};fe.forEach(["delete","get","head","options"],function(e){Ih.prototype[e]=function(i,r){return this.request(wo(r||{},{method:e,url:i,data:(r||{}).data}))}});fe.forEach(["post","put","patch"],function(e){function i(r){return function(o,a,l){return this.request(wo(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Ih.prototype[e]=i(),Ih.prototype[e+"Form"]=i(!0)});var vf=Ih;var R1=class t{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});let r=this;this.promise.then(n=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](n);r._listeners=null}),this.promise.then=n=>{let o,a=new Promise(l=>{r.subscribe(l),o=l}).then(n);return a.cancel=function(){r.unsubscribe(o)},a},e(function(o,a,l){r.reason||(r.reason=new ma(o,a,l),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new t(function(n){e=n}),cancel:e}}},jF=R1;function L1(t){return function(i){return t.apply(null,i)}}function O1(t){return fe.isObject(t)&&t.isAxiosError===!0}var D1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(D1).forEach(([t,e])=>{D1[e]=t});var qF=D1;function XF(t){let e=new vf(t),i=hf(vf.prototype.request,e);return fe.extend(i,vf.prototype,e,{allOwnKeys:!0}),fe.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return XF(wo(t,n))},i}var zi=XF(Oh);zi.Axios=vf;zi.CanceledError=ma;zi.CancelToken=jF;zi.isCancel=mf;zi.VERSION=sv;zi.toFormData=pa;zi.AxiosError=It;zi.Cancel=zi.CanceledError;zi.all=function(e){return Promise.all(e)};zi.spread=L1;zi.isAxiosError=O1;zi.mergeConfig=wo;zi.AxiosHeaders=Br;zi.formToJSON=t=>tv(fe.isHTMLForm(t)?new FormData(t):t);zi.getAdapter=rv.getAdapter;zi.HttpStatusCode=qF;zi.default=zi;var ui=zi;var{Axios:wTe,AxiosError:STe,CanceledError:CTe,isCancel:ETe,CancelToken:MTe,VERSION:TTe,all:ATe,Cancel:PTe,isAxiosError:RTe,spread:LTe,toFormData:OTe,AxiosHeaders:DTe,HttpStatusCode:ITe,formToJSON:kTe,getAdapter:FTe,mergeConfig:BTe}=ui;var I1={arrowX:null,arrowY:null,arrowZ:null,rotateX:null,rotateY:null,rotateZ:null,scaleX:null,scaleY:null,scaleZ:null,nozzle:null},Oq={x:new ir({name:"xAxisMaterial",color:12202281,specular:1118481,shininess:50,side:xi}),y:new ir({name:"yAxisMaterial",color:3717661,specular:1118481,shininess:50,side:xi}),z:new ir({name:"zAxisMaterial",color:4149685,specular:1118481,shininess:50,side:xi}),nozzle:new ir({name:"nozzleMaterial",color:13674342,specular:1118481,shininess:50,side:xi,flatShading:!0,transparent:!0,opacity:.6})},ds=[new j(1,0,0),new j(0,1,0),new j(0,0,1)],k1=class{constructor(){this.openHelpers=0,this._initialized=null}get initialized(){return this._initialized===null&&(this._initialized=new Promise((e,i)=>{this._initResolve=e,this._initReject=i,this.maxTextureSize=0,I1.arrowX===null&&this.loadHelper()})),this._initialized}loadGeoHelper(e,i){this.openHelpers++,new ih().load(i,n=>{n[0].geometry.name=e,I1[e]=n[0].geometry,this.openHelpers--,this.openHelpers===0&&this._initResolve()})}loadHelper(){this.openHelpers++,this.loadGeoHelper("arrowX","/views/printer/slicer/arrow2X.rmf"),this.loadGeoHelper("arrowY","/views/printer/slicer/arrow2Y.rmf"),this.loadGeoHelper("arrowZ","/views/printer/slicer/arrow2Z.rmf"),this.loadGeoHelper("scaleX","/views/printer/slicer/scaleX.rmf"),this.loadGeoHelper("scaleY","/views/printer/slicer/scaleY.rmf"),this.loadGeoHelper("scaleZ","/views/printer/slicer/scaleZ.rmf"),this.loadGeoHelper("rotateX","/views/printer/slicer/rotateX.rmf"),this.loadGeoHelper("rotateY","/views/printer/slicer/rotateY.rmf"),this.loadGeoHelper("rotateZ","/views/printer/slicer/rotateZ.rmf"),this.loadGeoHelper("nozzle","/views/printer/slicer/nozzle.rmf"),this.openHelpers--}getAxisMaterials(){return Oq}getGeometryHelper(){return I1}getMaxTextureSize(){if(!this.maxTextureSize){let i=document.createElement("canvas").getContext("webgl");this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),i=null}return this.maxTextureSize}get isWebGL2Supported(){return this._isWebGL2Supported||(this._isWebGL2Supported=()=>!!document.createElement("canvas").getContext("webgl2")),this._isWebGL2Supported}},gi=new k1;RSBase.factory("RSCom",["$q","$rootScope","User","$location","$uibModal","$http","$templateCache","localStorageService","$timeout","Flash","Confirm","$interval","$state",function(t,e,i,r,n,o,a,l,h,u,c,f,d){e.mobile=typeof window.orientation!="undefined"||navigator.userAgent.indexOf("IEMobile")!==-1,e.isWebGL2Supported=gi.isWebGL2Supported,e.isMobile=Ls;let m={},p={},v=0,g=null,_=0;m.connected=!1,m.wasConnected=!1,e.alert=!1;let x=[],b="",y=null,S=0,w=!0,M=50,C="",E=-1;e.hardwareInfo={maxUrgency:-1,list:[]},m.isSecure=function(){return window.location.protocol==="https:"},m.closeOopsDialog=function(){y&&y.close(),y=null},m.getCookie=function(B){let G=`; ${document.cookie}`.split(`; ${B}=`);if(G.length===2)return G.pop().split(";").shift().trim()},m.isSecure()?e.httpType="https":e.httpType="http",e.update={features:0},window.rs=e,e.hasFeature=function(B){return(B&e.update.features)===B},e.toClipboard=function(B){if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(B);return}let U=document.createElement("textarea");U.style.position="fixed",U.style.top="0",U.style.left="0",U.style.width="1px",U.style.height="1px",U.style.padding="0",U.style.border="none",U.style.outline="none",U.style.boxShadow="none",U.style.background="transparent",U.value=B,document.body.appendChild(U),U.focus(),U.select();try{document.execCommand("copy"),u.success("<?php _('Text copied') ?>")}catch(G){}document.body.removeChild(U)},e.isOEM=function(){return e.hasFeature(32768)},e.isPro=function(){return e.hasFeature(2048)},e.isLight=function(){return e.hasFeature(4096)},e.hasFeature1=!1,o.get("uib/template/modal/backdrop.html",{cache:a}),o.get("uib/template/modal/window.html",{cache:a}),o.get("/views/base/connectionLost.php?lang="+window.lang,{cache:a}),m.updateImportant=function(){m.send("csrf",{csrf:m.getCookie("Csrf-Token")}),m.send("updateAvailable",{}).then(function(B){e.update=B,B.currentVersion!==C&&(C!==""&&location.reload(!0),C=B.currentVersion),e.hasFeature1=e.hasFeature(1),e.hasWebcamSupport=e.hasFeature(4),e.hasLocalCloud=e.hasFeature(32),e.hasFirmwareUpload=e.hasFeature(256),e.$broadcast("newUpdateLoaded",B)},function(){})},e.globalErrorsVisible=[],e.fetchGlobalErrors=function(){m.send("getGlobalErrors",{}).then(B=>{angular.forEach(B.errors,U=>{e.globalErrorsVisible.find(G=>G===U.id)?console.log("error id: ",U.id,"already open"):(e.globalErrorsVisible.push(U.id),console.log("errors visible before confirm",e.globalErrorsVisible),c(U.data.headline,U.data.text,"<?php _('Confirm') ?>","",!0,"",!0).then(function(){m.send("removeGlobalError",{id:U.id}).then(()=>{let G=e.globalErrorsVisible.indexOf(U.id);G>-1&&e.globalErrorsVisible.splice(G,1)})}))})})},e.$on("globalErrorsChanged",function(){e.fetchGlobalErrors()}),e.$on("licenceChanged",function(){m.updateImportant()});let P=["rs-fw rs-bigtab","fa fa-bolt rs-fw rs-bigtab","fa fa-thermometer-half rs-fw rs-bigtab","fa fa-exclamation-triangle rs-fw rs-bigtab","fa fa-battery-full rs-fw rs-bigtab","fa fa-bug rs-fw rs-bigtab","fa fa-plug rs-fw rs-bigtab","fa fa-usb rs-fw rs-bigtab","rs rs-webcam rs-fw rs-bigtab","fa fa-tasks rs-fw rs-bigtab","fa fa-bell rs-fw rs-bigtab","fa fa-bluetooth rs-fw rs-bigtab","fa fa-square-o rs-fw rs-bigtab","fa fa-check-square-o rs-fw rs-bigtab","fa fa-hdd-o rs-fw rs-bigtab","fa fa-hourglass rs-fw rs-bigtab","fa fa-wifi rs-fw rs-bigtab","fa fa-microchip rs-fw rs-bigtab","fa fa-clock-o rs-fw rs-bigtab"];e.autoupdateRunning=!1,e.$on("autoupdateStarted",function(){e.autoupdateRunning=!0}),e.$on("hardwareInfo",function(B,U){switch(e.hardwareInfo=U.data,e.hardwareInfo.maxUrgency){case 0:case 1:e.hardwareInfo.boltClass="fa fa-bolt";break;case 2:e.hardwareInfo.boltClass="fa fa-bolt text-warning-light";break;case 3:e.hardwareInfo.boltClass="fa fa-bolt text-danger-light";break}angular.forEach(e.hardwareInfo.list,function(G){let Y=G.url?' &nbsp; <i class="fa fa-external-link"></i>':"";switch(G.msgType){case 0:G.content=G.name+" "+G.text+Y;break;case 1:G.content=G.name+" "+parseInt(G.value)+" "+G.unit+Y;break;case 2:G.content=G.name+" "+parseFloat(G.value).toFixed(1)+" "+G.unit+Y;break;case 3:G.content=G.name+" "+parseFloat(G.value).toFixed(1)+" "+G.unit+Y;break}G.iconClass=P[G.icon],G.urgency===2&&(G.iconClass+=" text-warning-light"),G.urgency===3&&(G.iconClass+=" text-danger-light")})});let A=!1,R=!1,k=async function(){if(A||!R||g!==null&&g.readyState===WebSocket.OPEN)return;if(typeof document.hidden!="undefined"&&document.hidden){setTimeout(k,50);return}if(A=!0,!await i.refreshSession(m)){A=!1,setTimeout(k,M),M<1e3?M=2*M:M=2e3;return}_++,_>20&&(_=0,console.clear());let B="";E=-1,window.frontEnd&&(B+="&front=1");try{g=new WebSocket((m.isSecure()?"wss://":"ws://")+window.location.host+"/socket/?lang="+window.lang+B),g.onopen=function(){A=!1,e.autoupdateRunning&&location.reload(!0),e.autoupdateRunning=!1,m.connected=!0,S=0,y&&y.close(),y=null,m.updateImportant();let U=[];angular.forEach(p,function(Y){U.push(Y)}),e.$broadcast("connected");let G=function(){if(g.readyState!==1){g.readyState<1&&h(G,20);return}w=!1,$.each(x,function(Y,re){re.resolve(g)}),x=[],M=50,m.wasConnected=!0};angular.forEach(U,function(Y){let re=t.defer();x.push(re),re.promise.then(function(){(!Y.request.ws||Y.request.ws!==g)&&(delete Y.request.ws,g.send(angular.toJson(Y.request)),Y.request.ws=g)},function(){})}),h(G,10),e.$apply()},g.onerror=function(U){A=!1,console.log("websocket error",U)},g.onclose=function(){A=!1,console.log("close socket"),m.connected&&(m.connected=!1,e.$broadcast("disconnected"),y===null&&!w&&i.isLoggedIn&&(y=n.open({templateUrl:"/views/base/connectionLost.php?lang="+window.lang,keyboard:!1,size:"lg",backdrop:"static"}),y.result.catch(function(U){}))),setTimeout(k,M),M<1e3?M=2*M:M=2e3},g.onmessage=function(U){e.timeMS=new Date().getTime();try{L(angular.fromJson(U.data))}catch(G){console.log("websocket listener"),console.log(G),console.log(U)}}}catch(U){console.log("connection error",U),A=!1}};m.stopConnection=function(){R=!1,g&&(g.onclose=function(){g=null,M=50},g.close()),m.closeOopsDialog()},$(window).unload(function(){g&&(g.onclose=function(){},g.close())}),e.forceLogin=function(){r.path()!=="/login"?e.pathAfterLogin=r.path():e.pathAfterLogin="/",i.autologin(m)},window.loc=r,e.forceLogin();function I(B){let U=t.defer();if(B.callback_id=T(),B.action==="login"&&(E=B.callback_id),p[B.callback_id]={time:new Date,cb:U,request:B},!m.connected||!g||g&&g.readyState!==1){let G=t.defer();x.push(G),G.promise.then(function(){(!B.ws||B.ws!==g)&&(delete B.ws,g.send(angular.toJson(B)),B.ws=g)},function(){})}else g.send(angular.toJson(B)),B.ws=g;return U.promise}function L(B){let U=B;if(U.callback_id<0)angular.forEach(U.data,function(G){e.$broadcast(G.event,G),e.$apply(),G.event==="pong"&&m.send("ping",{source:"gui-Pong"})});else if(p[U.callback_id]){let G=p[U.callback_id];if(E<0&&E>U.callback_id&&(E=-1),typeof U.data.permissionDenied!="undefined"){E>=0&&U.callback_id<E?(G.cb.reject(),delete p[U.callback_id]):U.data.loggedIn===!0?d.go("home"):(G.cb.reject(),delete p[U.callback_id],i.logout(),e.forceLogin());return}else if(typeof U.data.alert!="undefined"){G.cb.reject(),delete p[U.callback_id],e.alert=U.data.alert;return}e.$apply(G.cb.resolve(U.data)),delete p[U.callback_id]}}function T(){return v+=1,v>1e4&&(v=0),v}m.startConnection=()=>{console.log("Service.startConnection"),M=1,R=!0,k()},m.uploadFiles=async function({url:B,a:U,files:G,group:Y,autostart:re},N){let z=0,ie=1,Z={onUploadProgress:ae=>{let ue=Math.round(z+ie*ae.loaded/ae.total*100);N(ue)},headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0},ne=0;for(let ae of G)ne+=ae.filename.size;let K=(ae,ue)=>{let _e=new FormData;return _e.append("a",U),_e.append("name",ae),_e.append("filename",ue),Y&&_e.append("group",Y),re&&_e.append("autostart",re),ui.post(B,_e,Z)};m.extendPing(300);for(let ae of G){ie=ae.filename.size/ne;let ue=await K(ae.name,ae.filename);z+=100*ie;let _e=typeof ue.data=="object"?ue:JSON.parse(ue.data);_e.error===void 0||u.error("<?php _('Upload failed') ?>: "+_e.error)}m.extendPing(0)},m.send=function(B,U,G){return G||(G=b),U||(U={}),I({action:B,data:U,printer:G})},m.selectPrinter=function(B){b=B,m.send("activePrinter",{printer:B},B)},m.extendPing=function(B){m.send("extendPing",{timeout:B})},e.RSCom=m;let O=!1,D=function(){m.connected&&g&&g.readyState===1&&(S>10?g.close():(typeof document.hidden!="undefined"&&O!==document.hidden&&(m.extendPing(document.hidden?300:0),O=document.hidden),S++,m.send("ping",{source:"gui"}).then(function(){S--},function(){})))};return f(function(){ui.get("/global/ping").then(function(B){B.status===200&&!B.data.ok&&i.refreshSession(m)})},6e4),f(D,2e3),m}]).factory("RSOverview",["$rootScope","RSCom","$timeout","$compile","$q","Confirm","$filter","User","$state","Flash",function(t,e,i,r,n,o,a,l,h,u){t.externalCommands=[],t.externalLinks=[],t.loading=!1,t.printerList=[],t.printerListActive=[],t.printerListInactive=[],t.printerStateList={},t.active={status:{}},t.activeConfig={},t.activeSlug="",t.serverSetup={},t.printerConfig={},t.printer={},t.serverSettings={},t.printerWithJobs=[],t.folders=[],t.dispatcherOpen=0,t.manufacturerNews=[],t.newManufacturerNews=!1;let c=!0,f=!0,d=null,m=null,v=angular.element('<div class="loading" ng-show="loading"><i class="icon-spin icon-spinner"></i> Loading ...</div>');r(v)(t),angular.element(document.body).append(v),t.$on("load",function(){t.loading=!0}),t.$on("loaded",function(){t.loading=!1});let g=function(){e.send("getFolders",{}).then(function(I){t.folders=I.folders})},_=()=>{e.send("getManufacturerNews",{}).then(function(I){I.ok&&(t.manufacturerNews=I.messages,t.manufacturerNewsTitle=I.title,t.newManufacturerNews=I.newMessages,t.$broadcast("manufacturerNewsUpdated"))})};t.$on("manufacturerNewsChanged",_);let x=function(){angular.forEach(t.printer,function(I,L){e.send("getDialogs",{lang},L).then(function(T){I.dialogs=T.dialogs})})};t.$on("dialogsChanged",function(I,L){e.send("getDialogs",{lang},L.printer).then(function(T){t.printer[L.printer].dialogs=T.dialogs})}),t.$on("dispatcherCount",function(I,L){t.dispatcherOpen=L.data.count}),t.$on("foldersChanged",g);let b=function(){angular.forEach(t.printer,function(I,L){e.send("getRecover",{},L).then(function(T){I.recover=T.recover})})},y=n.defer(),S=function(I){t.printer[I.slug]?t.printer[I.slug].status=I:(t.printer[I.slug]={status:I,state:{},log:[],history:[],layer:[],dialogs:[],previousLayer:[],recover:{state:-1},local:{},reconnectCounter:0},e.send("getDialogs",{lang},I.slug).then(function(L){t.printer[I.slug].dialogs=L.dialogs})),t.printer[I.slug].state.isJobActive=I.jobstate==="running",I.slug===t.activeSlug&&(t.active=t.printer[I.slug]),I.done&&t.printerWithJobs.push(I)},w="",M="",C=function(I){let L=angular.toJson(I),T=l.getSetting("printerOrder","dynamic");if(w!==L||M!==T){w=L,M=T,T==="name"?t.printerList=a("orderBy")(I,["name"]):t.printerList=a("orderBy")(I,["-online","-active","name"]),t.printerListActive=a("filter")(t.printerList,{active:!0}),t.printerListInactive=a("filter")(t.printerList,{active:!1}),t.printerWithJobs=[];let O=I.length;t.stateTime=new Date().getTime(),angular.forEach(I,function(D){S(D),(c||typeof t.printerConfig[D.slug]=="undefined")&&(O++,e.send("getPrinterConfig",{printer:D.slug}).then(function(F){Object.entries(F).length?(F.isZBelt=F.shape.basicShape.shape==="zbelt",t.printerConfig[D.slug]=F,t.printer[D.slug]&&t.printer[D.slug].local.showAbsolutePositions===void 0&&(t.printer[D.slug].local.showAbsolutePositions=F.movement.startWithAbsolutePositions),t.activeConfig=t.printerConfig[t.activeSlug],O--,c&&O===0&&(c=!1,y.resolve(),b()),t.$broadcast("loadedPrinterConfig",D.slug)):delete t.printer[D.slug]})),O--}),c&&O===0&&(c=!1,y.resolve(),b()),t.$broadcast("printerListUpdated",t.printerList)}},E=function(){d!==null&&d!==!0&&i.cancel(d),d=!0,e.send("listPrinter",{}).then(function(I){C(I),d=i(E,5e3)},function(){d=null})},P=function(I,L){I.fans&&I.fans.forEach(function(T){T.percent=Math.floor(.5+T.voltage/2.55)}),t.printer[L].status?(I.isJobActive=t.printer[L].status.jobstate==="running",I.canMove=!I.doorOpen||t.printerConfig&&t.printerConfig[L]&&t.printerConfig[L].general.doorHandling!==2):(I.isJobActive=!1,I.canMove=!1)},A=function(I,L){let T=t.printer[I];if(T)if(L.x!==void 0){let O=T.state.x!==L.x||T.state.x!==L.y||T.state.x!==L.z;angular.forEach(L.heatedBeds,function(D,F){T.state&&T.state.heatedBeds&&T.state.heatedBeds[F]&&T.state.heatedBeds[F].history&&!L.heatedBeds[F].history&&(L.heatedBeds[F].history=T.state.heatedBeds[F].history)}),angular.forEach(L.heatedChambers,function(D,F){T.state&&T.state.heatedChambers&&T.state.heatedChambers[F]&&T.state.heatedChambers[F].history&&!L.heatedChambers[F].history&&(L.heatedChambers[F].history=T.state.heatedChambers[F].history)}),angular.forEach(L.extruder,function(D,F){!D.history&&T.state&&T.state.extruder&&T.state.extruder[F]&&T.state.extruder[F].history&&(D.history=T.state.extruder[F].history)}),T.state=L,P(T.state,I),O&&I===t.activeSlug&&t.$broadcast("toolMoved",{data:T.state})}else T.state=Object.assign({},T.state,L),T.state.isJobActive=!1,T.state.canMove=!1},R=function(){if(m!==null&&m!==!0&&i.cancel(m),!l.isLoggedIn){m=i(R,2e3);return}m=!0,e.send("stateList",{includeHistory:f}).then(function(I){t.stateTime=new Date().getTime(),angular.forEach(I,function(L,T){A(T,L)}),f=!1,m=i(R,2e3)},function(){m=i(R,2e3)})};t.$on("state",function(I,L){L&&L.printer&&t.printer[L.printer]&&(angular.extend(t.printer[L.printer].state,L.data),P(t.printer[L.printer].state,L.printer))}),t.$on("updatePrinterState",function(I,L){A(L.printer,L.data)}),t.$on("printerListChanged",function(I,L){C(L.data)}),t.$on("temp",function(I,L){let T=t.printer[L.printer];if(!T||!T.state)return;let O=L.data.id;if(typeof T.state=="undefined"&&console.log("history error",T),O>=0&&typeof T.state.extruder=="undefined")return;let D=O>999?O>1999?T.state.heatedChambers[O-2e3]:T.state.heatedBeds[O-1e3]:typeof T.state.extruder[O]=="undefined"?void 0:T.state.extruder[O];if(D){for(D.history||(D.history=[]);D.history.length>0&&D.history[0].t+3e5<L.data.t;)D.history.splice(0,1);D.history.push(L.data)}}),t.$on("config",function(I,L){let T=L.data;T.isZBelt=T.shape.basicShape.shape==="zbelt",t.printerConfig[T.general.slug]=T,t.activeConfig=t.printerConfig[t.activeSlug]});function k(){e.send("getExternalLinks",{}).then(function(I){t.externalLinks=I.links,t.globalExternalLinks=[],angular.forEach(t.externalLinks,function(L){L.gui&&L.slug===""&&t.globalExternalLinks.push(L)}),t.$broadcast("int_externalLinksChanged",t.externalLinks)})}return t.$on("connected",function(){d===null&&E(),m===null&&R(),e.send("featurePermissions",{}).then(function(I){t.hasMaintainer=I.hasMaintainer,t.features=I.features,t.$broadcast("userSettingsChanged")}),e.send("listExternalCommands",{}).then(function(I){t.externalCommands=I,t.$broadcast("externalCommandsChanged",I)}),k(),e.send("webCallsList",{}).then(function(I){t.webCalls=I.list,t.$broadcast("webCallsListChanged",I)}),e.send("GPIOGetList",{}).then(function(I){t.gpio=I.list,t.$broadcast("gpioChanged",I)}),g(),b(),x(),_()}),t.$on("externalLinksChanged",k),t.$on("recoverChanged",function(I,L){t.printer[L.printer]&&(t.printer[L.printer].recover=L.data)}),t.$on("reconnectCounter",function(I,L){t.printer[L.printer].reconnectCounter=L.data.reconnectCounter}),t.$on("webCallsChanged",function(){e.send("webCallsList",{}).then(function(I){t.webCalls=I.list,t.$broadcast("webCallsListChanged",I)})}),t.$on("gpioListChanged",function(){e.send("GPIOGetList",{}).then(function(I){t.gpio=I.list,t.$broadcast("gpioChanged",I)})}),t.$on("gpioPinChanged",function(I,L){L=L.data,t.gpio&&angular.forEach(t.gpio,function(T){L.uuid===T.uuid&&(T.state=L.state,T.pwmDutyCycle=L.pwmDutyCycle)})}),t.$on("disconnected",function(){d!==null&&d!==!0&&i.cancel(d),d=null,m!==null&&m!==!0&&i.cancel(m),m=null}),{selectPrinter:function(I){e.selectPrinter(I),t.activeSlug=I,I===""?(t.activeConfig={},t.active={}):(t.activeConfig=t.printerConfig[I],t.printer[I]&&(t.active=t.printer[I])),t.$broadcast("printerSelected",I)},runExternalCommand:function(I){let L=t.externalCommands[I],T=!1;if(L.ifAllNotPrinting&&(T=Object.values(t.printer).filter(O=>O.state.isJobActive).length>0),L.ifThisNotPrinting&&L.slug&&t.printer[L.slug]&&(T||(T=t.printer[L.slug].state.isJobActive)),T){u.error("<?php _('Printer not idle - execution stopped!') ?>");return}L.confirm.length>0?o("<?php _('Security Question') ?>",L.confirm,"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){L.terminal?h.go("terminalCommand",{id:I}):e.send("runExternalCommand",{id:I})},function(){}):L.terminal?h.go("terminalCommand",{id:I}):e.send("runExternalCommand",{id:I})},supportsFullscreen:function(){let I=window.document.body;return I.requestFullscreen||I.mozRequestFullScreen||I.webkitRequestFullscreen||I.msRequestFullscreen},updateStateNow:function(){setTimeout(R,100)},updatePrintersNew:function(){E()},printerListLoadedPromise:y.promise}}]).factory("RSMessages",["$rootScope","RSCom",function(t,e){let i=[];t.messages=i;let r=function(){e.send("messages",{}).then(function(l){t.messages=i=l})};t.$on("messagesChanged",function(){r()}),t.$on("connected",function(){r()});let n=function(l){let h="job";l.link.indexOf("unpause")>0&&(h="unpause"),e.send("removeMessage",{id:l.id,a:h},l.slug)},a={messages:i,remove:n,removeAll:function(){angular.forEach(i,function(l){l.link.indexOf("unpause")<0&&n(l)})}};return t.RSMessages=a,a}]).factory("Flash",function(){let t={};return toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},t.success=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.success(i,e))},t.info=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.info(i,e))},t.warning=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.warning(i,e))},t.error=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.error(i,e))},t}).factory("RSPasswordCheck",["RSCom",function(t){let e={};return t.send("getPasswordRules",{}).then(i=>{e=i}),i=>{let r=0,n=0,o=0;if(i.length<e.minLength)return"<?php _('Minimum password length is @1') ?>".replace("@1",e.minLength);if(e.differentCharacterGroups){for(let a of i)a>="a"&&a<="z"?r=1:a>="A"&&a<="Z"?n=1:o=1;if(r+n+o<2)return"Password must contain characters of different groups a-z, A-Z and other characters"}return""}}]).factory("GSettings",["RSCom","$rootScope","$q","$state",function(t,e,i,r){let n={},o={},a=i.defer();e.serverSettings={pricing:{currency:"EUR",digits:2,perPrint:5,perHour:.3,filaments:[{u:RSUtils.createAlphaID(10),n:"PLA",p:25,w:1.25}],map:{}}},e.$on("settingChanged",function(h,u){$.extend(e.serverSettings,u.data),$.extend(o,angular.copy(u.data))}),n.serverSettingsChanged=function(){let h={};if(angular.forEach(e.serverSettings,function(u,c){angular.equals(u,o[c])||(h[c]=angular.copy(u))}),$.isEmptyObject(h)){let u=i.defer();return u.resolve(),u.promise}return o=angular.copy(e.serverSettings),t.send("updateSettings",h)};let l=function(){t.send("getSettings",{}).then(function(h){angular.extend(e.serverSettings,h),o=angular.copy(e.serverSettings),a.resolve(),e.serverSettings.policy_accepted===!1&&r.go("privacypolicy")})};return e.$on("connected",function(){l()}),t.connected&&l(),n.promise=a.promise,n}]).filter("slice",function(){return function(t,e,i){return t?(Math.abs(Number(e))===1/0?e=Number(e):e=parseInt(e),isNaN(e)?t:(i=!i||Number.isNaN(i)?0:parseInt(i),i=i<0&&i>=-t.length?t.length+i:i,e>=0?t.slice(i,i+e):i===0?t.slice(e,t.length):t.slice(Math.max(0,i+e),i))):[]}}).factory("Theme",["$rootScope",function(t){let e={mode:"auto",detected:""},i="(prefers-color-scheme: dark)",r="(prefers-color-scheme: light)";function n(l){t.theme=l,document.getElementsByTagName("html")[0].setAttribute("data-theme",l),t.$broadcast("themeChanged",l)}function o(){if(!window.matchMedia){console.log("matchMedia not supported");return}function l(c){c.matches&&(c.media===i?(e.detected="dark",e.mode==="auto"&&n("dark")):c.media===r&&(e.detected="light",e.mode==="auto"&&n("light")))}let h=window.matchMedia(i);h.addListener(l),l(h);let u=window.matchMedia(r);u.addListener(l),l(u)}function a(l){l==="auto"?e.mode!=="auto"&&(e.mode="auto",n(e.detected)):(e.mode=l,n(l))}return o(),e.setMode=a,e}]).factory("Wifi",["RSCom","$rootScope",function(t,e){let i={routerListResponse:void 0,apModeList:[{id:0,n:"<?php _('Never enable AP') ?>"},{id:1,n:"<?php _('Enable AP when not connected') ?>"},{id:2,n:"<?php _('Always enable AP') ?>"}]},r=!1;return i.updateRouterList=function(){r||t.connected!==!1&&(r=!0,t.send("wifiRefreshRouter",{}).then(function(n){i.routerListResponse=n,r=!1},function(){r=!1}))},i.setWifiList=function(n){i.routerListResponse=n},e.$on("wifiChanged",function(n,o){let a=i.routerListResponse.regions;i.routerListResponse=Object.assign(i.routerListResponse,o.data,{ethernet:Object.assign(i.routerListResponse.ethernet,o.data.ethernet)}),i.routerListResponse.regions=a}),i.refreshRouterList=function(){r||t.connected!==!1&&(r=!0,t.send("wifiRefreshRouter").then(function(n){i.routerListResponse=n,r=!1},function(){r=!1}))},i.eth=function(){return i.routerListResponse.ethernet},i.getRouterList=function(){return i.routerListResponse?i.routerListResponse.routerList:[]},i.getManageable=function(){return i.routerListResponse?i.routerListResponse.manageable:(i.updateRouterList(),!1)},i.manualWifi=function(){return i.routerListResponse.manualWifi},i.getHostname=function(){return i.routerListResponse.hostname},i.setHostname=function(n){t.send("wifiSetHostname",{hostname:n})},i.getAPSSID=function(){return i.routerListResponse.apSSID},i.setAPSSID=function(n){t.send("wifiSetAPSSID",{ssid:n})},i.setAPPassword=function(n){t.send("wifiSetAPPassword",{password:n})},i.getAPMode=function(){return i.routerListResponse.apMode},i.getSupportAP=function(){return i.routerListResponse.supportAP},i.setAPMode=function(n){t.send("wifiSetAPMode",{apMode:n})},i.getAPChannel=function(){return i.routerListResponse.channel},i.setAPChannel=function(n){t.send("wifiSetAPChannel",{channel:n})},i.getRegion=function(){return i.routerListResponse.country},i.setRegion=function(n){t.send("wifiSetCountry",{country:n})},i.setAPPassword=function(n){t.send("wifiSetAPPassword",{password:n})},i.connect=function(n){return t.send("wifiConnect",{uuid:n})},i.activateAP=function(){t.send("wifiActivateAP",{})},i.updateRouterList(),i}]);window.RSUserModule=angular.module("RSUser",["ui.router","RSBase","LocalStorageModule"]).factory("User",["$rootScope","$location","$q","localStorageService","$state","Theme","$http",function(t,e,i,r,n,o,a){let l=15,h="";function u(){let g=window.location.href,_="",x=g.indexOf("#");x>-1&&(_=g.substring(x),g=g.substring(0,x));let b=g.split("?")[0]+"?",y=decodeURIComponent(window.location.search.substring(1)),S=y.split("&"),w,M=!1;for(let C=0;C<S.length;C++)w=S[C].split("="),w[0]!=="login"&&w[0]!=="password"?b=b+w[0]+"="+w[1]+"&":M=!0;b=b.substring(0,b.length-1)+_,M&&(window.location.href=b)}let c=!1,f=i.defer(),d={},m=!1,p={isLoggedIn:!1,isRealUser:!1,loggedIn:function(){return c||h===""&&l!==0},realUser:function(){return h!==""&&h!=="global"},canPrint:function(){return(l&1)===1},canAddFiles:function(){return(l&2)===2},canDeleteFiles:function(){return(l&4)===4},canChangeConfig:function(){return(l&8)===8},canHistory:function(){return(l&16)===16},canSeeProjects:function(){return(l&32)===32},canEditProjects:function(){return(l&64)===64},canReadFiles:function(){return(l&256)===256},canFullStop:function(){return(l&512)===512},canManageAccounts:function(){return(l&1024)===1024},isAdmin:function(){return(l&2048)===2048},isMaintainer:function(){return(l&16384)===16384},canChangePassword:function(){return(l&6144)!==0},showFeature:function(g){return g===""?!0:t.features&&t.features[g]?(t.features[g]&l)!==0:!1},getLogin:function(){return h},printPermission:!1,readPermission:!1,addPermission:!1,delPermission:!1,changeConfigPermission:!1,historyPermission:!1,seeProjectsPermission:!1,editProjectsPermission:!1,fullStopPermission:!1,manageAccountsPermission:!1,adminPermission:!1,maintainPermission:!1,changePasswordPermission:!1,animatedLogin:!1,autologinPromise:i.defer(),sessionStarted:function(){return f.promise},getSetting:function(g,_){return typeof d[g]=="undefined"&&(t.RSCom.send("updateUserSetting",{key:g,value:_}),d[g]=_),d[g]},setSetting:function(g,_){d[g]!==_&&(d[g]=_,t.RSCom.send("updateUserSetting",{key:g,value:_}),t.$broadcast("userSettingsChanged"))}},v=function(){let g=[];angular.forEach(t.externalCommands,function(_){_.permPrint&&!p.printPermission||_.permConfig&&!p.changeConfigPermission||_.permAdd&&!p.addPermission||_.permDel&&!p.delPermission||g.push(_)}),t.externalCommandsFiltered=g};return p.logout=function(){p.isLoggedIn===!1&&h===""||(p.setPermissions(0),h="",c=!1,p.isLoggedIn=!1,p.isRealUser=!1,t.RSCom&&t.RSCom.stopConnection(),a.post("/global/user/logout",{}),n.go("login"),t.RSCom)},p.logoutFromOutside=function(){p.isLoggedIn===!1&&h===""||(p.setPermissions(0),h="",c=!1,p.isLoggedIn=!1,p.isRealUser=!1,m=!1,n.go("login"))},p.setPermissions=function(g){l=g,p.permissions=g,p.printPermission=p.canPrint(),p.readPermission=p.canReadFiles(),p.addPermission=p.canAddFiles(),p.delPermission=p.canDeleteFiles(),p.changeConfigPermission=p.canChangeConfig(),p.historyPermission=p.canHistory(),p.seeProjectsPermission=p.canSeeProjects(),p.editProjectsPermission=p.canEditProjects(),p.fullStopPermission=p.canFullStop(),p.manageAccountsPermission=p.canManageAccounts(),p.adminPermission=p.isAdmin(),p.maintainPermission=p.isMaintainer(),p.changePasswordPermission=p.canChangePassword(),t.frontend.visible["user.printPermission"]=p.printPermission,t.frontend.visible["user.addPermission"]=p.addPermission,t.frontend.visible["user.readPermission"]=p.readPermission,t.frontend.visible["user.delPermission"]=p.delPermission,t.frontend.visible["user.changeConfigPermission"]=p.changeConfigPermission,t.frontend.visible["user.historyPermission"]=p.historyPermission,t.frontend.visible["user.seeProjectsPermission"]=p.seePermission,t.frontend.visible["user.editProjectsPermission"]=p.editPermission,t.frontend.visible["user.fullStopPermission"]=p.fullStopPermission,t.frontend.visible["user.adminPermission"]=p.adminPermission,t.frontend.visible["user.maintainPermission"]=p.maintainPermission,v()},p.refreshSession=async function(g){if(e.path()==="/login")return p.isLoggedIn;c=!1,m=!0;try{let _=await a.post("/global/user/verify",{});return ui.defaults.headers.common["X-Csrf-Token"]=g.getCookie("Csrf-Token"),_.data.ok?(p.setCredentialsFromServer(_.data),!0):(e.path()!=="/login"?t.pathAfterLogin=e.path():t.pathAfterLogin="/",p.logout(),!1)}catch(_){return!1}},p.recheckLogin=function(){return c||a.post("/global/user/verify",{}).then(function(g){p.animatedLogin=g.data.animatedLogin,ui.defaults.headers.common["X-Csrf-Token"]=t.RSCom.getCookie("Csrf-Token"),g.data.ok&&(p.setCredentialsFromServer(g.data),t.RSCom.startConnection())}),!0},p.autologin=function(g){return m||c||(c=!1,m=!0,a.post("/global/user/verify",{}).then(function(_){ui.defaults.headers.common["X-Csrf-Token"]=g.getCookie("Csrf-Token"),_.data.ok?(p.setCredentialsFromServer(_.data),g.startConnection(),p.autologinPromise.resolve()):(p.autologinPromise.resolve(),e.path("/login"))})),!0},p.setCredentials=function(g){let _=c;c=!0,p.setPermissions(g.permissions),h=g.login,d=g.settings,p.isLoggedIn=p.loggedIn(),p.isRealUser=p.realUser(),u(),_||t.$broadcast("connected");let x=p.getSetting("theme","auto");o.setMode(x),f.resolve(),t.$broadcast("userSettingsChanged")},p.setCredentialsFromServer=function(g){let _=c;c=!0,p.setPermissions(g.permissions),h=g.login,d=g.settings,p.isLoggedIn=p.loggedIn(),p.isRealUser=p.realUser(),u(),_||t.$broadcast("connected"),(n.is("login")||e.path()==="/login")&&n.go("home");let x=p.getSetting("theme","auto");o.setMode(x),f.resolve(),t.$broadcast("userSettingsChanged")},t.$on("userCredentials",function(g,_){p.setCredentialsFromServer(_.data)}),t.$on("logout",()=>{p.logoutFromOutside()}),t.$on("disconnected",function(){m=!1}),t.$on("externalCommandsChanged",function(){v()}),p}]);RSBase.factory("RSFirmware",["$q","$rootScope","RSCom","$filter",function(t,e,i,r){let n={},o=t.defer();n.firmwareNames=[],n.firmwareInfo=[],n.firmwareInfoMap={};let a=function(){i.send("listFirmwareNames",{}).then(function(h){n.firmwareNames=r("orderBy")(h.firmwareNames,"",!1),o.resolve()})},l=function(){i.send("listFirmwareInfo",{}).then(function(h){n.firmwareInfo=r("orderBy")(h.firmwareInfo,"name",!1),n.firmwareInfo.forEach(function(u){n.firmwareInfoMap[u.name]=u}),o.resolve()})};return e.$on("connected",function(){n.firmwareNames.length===0&&a(),l()}),a(),l(),n.promise=t.all([o]),n}]);var y3=hn(_3());RSBase.factory("RSPrinters",["$q","RSPrinter","$rootScope","$uibModal","RSOverview","Confirm","RSCom","Flash","$state","Info",function(t,e,i,r,n,o,a,l,h,u){let c={};i.globals||(i.globals={}),c.globals=i.globals,c.addPrinter=function(){r.open({templateUrl:"/views/printer/dialog/addPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance","RSCom",function(d,m,p){d.newprinter={name:"",slug:""},d.createPrinter=function(){d.newprinter.errors={},d.newprinter.name.length===0&&(d.newprinter.errors.name="<?php _('No printer name given.') ?>"),d.newprinter.slug.match(/^[a-zA-Z0-9]+$/)||(d.newprinter.errors.slug="<?php _('Only a-z, A-Z and 0-9 are allowed.') ?>"),typeof i.printerConfig[d.newprinter.slug]!="undefined"&&(d.newprinter.errors.slug="<?php _('Slug name already in use.') ?>"),!(Object.keys(d.newprinter.errors).length>0)&&p.send("createConfiguration",d.newprinter).then(function(){m.close()})},d.close=function(){m.dismiss()}}]}).result.catch(function(d){})},c.backupPrinter=function(d){r.open({templateUrl:"/views/printer/dialog/backupPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance",function(m,p){m.printerSlug=d.slug,m.backupJobs=!1,m.backupModels=!1,m.backupConfig=!0,m.backupTimelapse=!1,m.restoreId=-1,m.backupLogs=!1,m.folderSizes={logs:{count:0,size:0},jobs:{entryCount:0,count:0,size:0,countFiltered:0},models:{entryCount:0,count:0,size:0,countFiltered:0},timelapse:{entryCount:0,count:0,size:0,countFiltered:0}},m.getBackupRequestLink=function(){return"/printer/pconfig/"+m.printerSlug+"?a=download&exportModels="+m.backupModels+"&exportJobs="+m.backupJobs+"&exportLogs="+m.backupLogs+"&exportConfig="+m.backupConfig+"&exportTimelapse="+m.backupTimelapse},m.fetchFolderSize=function(){return console.log(m.printerSlug),new Promise((v,g)=>{a.send("getPrinterFolderInfo",{},m.printerSlug).then(_=>{_.ok?v(_.data):g(_)})})},m.getFolderSizes=async function(){m.folderSizes={logs:{count:0,size:0,countFiltered:0},jobs:{entryCount:0,count:0,size:0,countFiltered:0},models:{entryCount:0,count:0,size:0,countFiltered:0},timelapse:{entryCount:0,count:0,size:0,countFiltered:0}},m.folderSizes=await m.fetchFolderSize()},m.getFolderSizes(),m.toggleSelectAll=function(){m.folderSizes.jobs.countFiltered&&(m.backupJobs=m.selectAll),m.folderSizes.models.countFiltered&&(m.backupModels=m.selectAll),m.folderSizes.timelapse.countFiltered&&(m.backupTimelapse=m.selectAll),m.folderSizes.logs.count&&(m.backupLogs=m.selectAll),m.backupConfig=m.selectAll},m.close=function(){p.dismiss()}}]}).result.catch(function(m){})},c.uploadPrinter=function(d){r.open({templateUrl:"/views/printer/dialog/uploadPrinter.php?lang="+lang,backdrop:"static",controller:["$scope","$uibModalInstance",function(m,p){m.confupload=d?{mode:0,name:d.name,slug:d.slug}:{mode:1,name:"",overwriteConnection:!1,keepPermanentVariables:!1,slug:""};let v=100;m.ports=[],m.menuPort=!1,m.getRestoreRequestUrl=function(){return d?"/printer/pconfig/"+d.slug+"/":"/printer/pconfig/"},m.getPorts=function(){a.send("listPorts",{}).then(function(g){m.ports=g})},m.getPorts(),m.confOptions={format:0,printerName:"",connectionMethod:0,serialPort:"",pipe:"",ipAdr:"",ipPort:0,jobs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},models:{available:!1,restore:!1,size:0,count:0,countFiltered:0},timelapses:{available:!1,restore:!1,size:0,count:0,countFiltered:0},logs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},config:{available:!1,restore:!1,size:0,count:0,countFiltered:0}},m.selectAll=!1,m.selectedfilename="",m.uploadConfigProgress=0,m.restoreProgress=0,m.diskUsage={capacity:0,available:0},m.spaceNeeded=0,m.toggleSelectAll=function(){m.confOptions.jobs.available&&(m.confOptions.jobs.restore=m.selectAll),m.confOptions.models.available&&(m.confOptions.models.restore=m.selectAll),m.confOptions.timelapses.available&&(m.confOptions.timelapses.restore=m.selectAll),m.confOptions.logs.available&&(m.confOptions.logs.restore=m.selectAll),m.confOptions.config.available&&m.confupload.mode!==1&&(m.confOptions.config.restore=m.selectAll)},m.checkDiskSpaceForRestore=function(){if($("#confuploadbutton")[0].files[0]!==void 0){v=$("#confuploadbutton")[0].files[0].size;let g=0;return angular.forEach(m.confOptions,_=>{_.restore&&(g+=_.size)}),m.spaceNeeded=m.diskUsage.available-(g+v+100*1024*1024),m.spaceNeeded>0}else return!1},m.analyzeRPCFile=function(){a.send("freeSpace",{}).then(function(y){m.diskUsage=y}),m.confOptions={format:0,printerName:"",connectionMethod:0,serialPort:"",pipe:"",ipAdr:"",ipPort:0,jobs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},models:{available:!1,restore:!1,size:0,count:0,countFiltered:0},timelapses:{available:!1,restore:!1,size:0,count:0,countFiltered:0},logs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},config:{available:!1,restore:!1,size:0,count:0,countFiltered:0}};let g=$("#confuploadbutton")[0].files[0],_=t.defer(),x=new FileReader;x.onload=function(y){let S=new DataView(x.result),w="";for(let M=0;M!==3;M++)w+=String.fromCharCode(S.getUint8(M));if(w==="<?x"){m.confOptions.format=1;return}if(w==="rpc"){m.confOptions.format=2;let M=new FileReader;M.onerror=_.reject.bind(_),M.onload=function(E){let A=new DataView(M.result).getUint32(0,!0),R=new FileReader;R.onerror=_.reject.bind(_),R.onload=function(I){if(!R.result){_.reject(new Error("Unknown error"));return}let L=new Uint8Array(R.result),T=y3.default.decode(L),O=function(D,F,B){D.available=(T.c&F)===F,D.count=D.available?T[B+"c"]:0,D.countFiltered=D.available?T[B+"cf"]:0,D.size=D.available?T[B+"s"]:0};if(T){switch(m.confupload.restoreData=!0,m.confupload.name=T.pn,m.confOptions.connectionMethod=T.cm,m.confOptions.connectionMethod){case 0:m.confOptions.serialPort=T.pc;break;case 1:m.confOptions.pipe=T.pc;break;case 2:m.confOptions.ipAdr=T.pIpAdr,m.confOptions.ipPort=T.pIpPort;break;case 3:m.confOptions.pipe=T.pc;break}O(m.confOptions.config,16,"c"),O(m.confOptions.logs,8,"l"),O(m.confOptions.jobs,4,"j"),O(m.confOptions.models,2,"m"),O(m.confOptions.timelapses,1,"t")}};let k=g.slice(7,A+7);R.readAsArrayBuffer(k)};let C=g.slice(3,7);M.readAsArrayBuffer(C)}else m.confOptions.format=3};let b=g.slice(0,3);return x.readAsArrayBuffer(b),m.checkDiskSpaceForRestore(),_.promise},m.newPrinter=function(){window.open("#!/configWizard","_self"),p.dismiss()},m.createPrinterFromConfig=function(){m.confupload.errors={},m.selectfilename="",a.extendPing(600),!(Object.keys(m.confupload.errors).length>0)&&$("#formuploadconfig").ajaxSubmit({success:function(g){g=angular.fromJson(g),m.restoreId=g.id},uploadProgress:function(g,_,x,b){m.uploadConfigProgress=b},headers:{"X-Csrf-Token":a.getCookie("Csrf-Token")}})},m.$on("restoreFinished",(g,_)=>{m.restoreId===_.data.id&&(m.uploadConfigProgress=0,m.restoreProgress=0,a.extendPing(0),p.close(),_.data.error?(m.confupload.errors.createerror=_.data.error,l.error("<?php _('Upload failed: ') ?>"+_.data.error),p.close()):l.success("<?php _('Upload finished') ?>"))}),m.$on("restoreProgress",(g,_)=>{m.restoreProgress=Math.round(_.data/v*100)}),m.close=function(){m.uploadConfigProgress===0&&p.dismiss()},m.canUpload=function(){let g=$("#confuploadbutton").val();m.selectfilename=g.replace(/\\/g,"/").replace(/.*\//,""),m.confupload.slug=d?d.slug:c.autocreateSlug(m.confupload.name);let _=g&&g.length>4&&(g.lastIndexOf(".rpc")===g.length-4||g.lastIndexOf(".xml")===g.length-4);return _&=m.confupload.name.length>0,m.checkDiskSpaceForRestore()&&_&&(m.confupload.mode!==1||!(m.confupload.mode===1&&m.confOptions.format===2&&!m.confOptions.config.available))}}]}).result.catch(function(m){})},c.removePrinter=function(d){a.send("getKlipperStatus",{}).then(m=>{m.installations.includes(d.slug)?u("<?php _('Operation not permitted') ?>","<?php _('You have a klipper installation for this printer. Please uninstall the klipper installation first!') ?>").then(()=>{h.go("printer.klipperConfig",{slug:d.slug})}):o("<?php _('Confirmation required') ?>","<?php _('Really delete printer setup for #1 and all associated g-code files?') ?>".replace("#1",d.name+""),null,null,!0).then(function(){a.send("removeConfiguration",{slug:d.slug}).then(function(p){p.ok?(delete i.printerConfig[d.slug],delete i.printer[d.slug],l.success("<?php _('Printer deleted') ?>"),h.go("home")):l.error("<?php _('Printer deletion failed!') ?> "+p.error)})},function(p){l.error("<?php _('Printer deletion failed!') ?> "+p.error)})},()=>{})},c.emergencyStop=function(d){a.send("emergencyStop",{},d.slug)},c.stopPrint=function(d){i.active.status.jobid&&a.send("stopJob",{id:i.active.status.jobid},d.slug)},c.pausePrint=function(d){a.send("send",{cmd:"@pause <?php _('User requested pause.') ?>"},d.slug)},c.unpausePrint=function(d){console.log("unpause",d.slug),a.send("continueJob",{},d.slug)},c.activate=function(d){a.send("activate",{printer:d.slug}).then(function(m){m.ok?l.success("<?php _('Printer activated') ?>"):l.error("<?php _('Printer activation failed') ?>",m.error,2e4,!0)})},c.deactivate=function(d){a.send("deactivate",{printer:d.slug}).then(function(){l.success("<?php _('Printer deactivated') ?>")})};let f=function(d){return d>="0"&&d<="9"};return c.doesSlugExist=function(d){return typeof i.printerConfig[d]!="undefined"},c.autocreateSlug=function(d){let m="",p=0,v=d.length;for(;p<v;p++){let _=d[p];_>="a"&&_<="z"||_>="A"&&_<="Z"||_>="0"&&_<="9"||_==="_"?m+=_:_===" "&&(m+="_")}let g="";for(;m.length>0&&f(m[m.length-1]);)g=m[m.length-1]+g,m=m.substr(0,m.length-1);for(;c.doesSlugExist(m+g);)g.length===0&&(g="0"),g=(parseInt(g)+1).toString();return m+g},c.printersUsingPort=function(d,m){function p(g){let _="";return angular.forEach(i.printerList,function(x){x.slug===g&&(x.active?x.online===1?_=" (<?php _('Online') ?>)":x.online===2?_=" (<?php _('Connected') ?>)":_=" (<?php _('Offline') ?>)":_=" (<?php _('Deactivated') ?>)")}),_}let v=[];return angular.forEach(i.printerConfig,function(g,_){_===m||!g.connection||!g.connection.serial||g.connection.connectionMethod!==0||g.connection.serial.device===d&&(g.connection.serial.device==="VirtualCartesian"||g.connection.serial.device==="VirtualDelta"||v.push("<li>"+g.general.name+p(_)+"</li>"))}),v.length===0?!1:"<ul>"+v.join("")+"</ul>"},i.RSPrinters=c,c}]);RSBase.factory("RSPrinter",["$q","$rootScope","RSOverview","RSCom","$uibModal","RSPrinterConfig","$timeout","$filter","Flash","User","localStorageService","Confirm",function(t,e,i,r,n,o,a,l,h,u,c,f){let d=function(){e.activeSlug&&(m.fetchModelsFor(e.activeSlug),m.fetchPrintqueueFor(e.activeSlug),m.updateExcludeRegions())},m={excludeRegions:[],pauseNames:["<?php _('Pause') ?>","<?php _('Continue') ?>","<?php _('Preheat') ?>","<?php _('Heating...') ?>","<?php _('Paused') ?>","<?php _('Continue') ?>","<?php _('Restarting...') ?>"],eepromLoaded:!1,eepromErrors:!1,eepromData:[],visibleQuickCommands:{},visibleWizards:{}};e.RSPrinter=m,e.globals||(e.globals={}),m.globals=e.globals;let p={},v=function(C,E,P,A,R){if(R||(R=1),typeof P=="undefined")return"/mod/server/img/rendering_"+A+".png";let k=C+"_"+E+P+A;return p[k]||(p[k]="/dyn/render_image?q="+E+"&id="+P+"&slug="+C+"&t="+A+"&v="+R),e.hasFeature(1)?p[k]:"/img/pro_"+A+".png"};e.$on("connected",function(){p=[],d()}),e.$on("gcodeInfoUpdated",function(C,E){E.data.list==="jobs"?m.fetchPrintqueueFor(E.printer):m.fetchModelsFor(E.printer)}),e.$on("newRenderImage",function(C,E){let P=E.data,A=E.printer+"_"+P.list+P.id;p[A+"l"]="/dyn/render_image?q="+P.list+"&id="+P.id+"&slug="+E.printer+"&t=l&tm="+new Date().getTime(),p[A+"m"]="/dyn/render_image?q="+P.list+"&id="+P.id+"&slug="+E.printer+"&t=m&tm="+new Date().getTime(),p[A+"s"]="/dyn/render_image?q="+P.list+"&id="+P.id+"&slug="+E.printer+"&t=s&tm="+new Date().getTime(),P.list==="jobs"?m.fetchPrintqueueFor(E.printer):m.fetchModelsFor(E.printer)}),m.setActivePage=function(C,E){let P=c.get("v1PrinterPage");P===null&&(P={}),P[C]=E,c.set("v1PrinterPage",P)},m.getActivePage=function(C,E){let P=c.get("v1PrinterPage");return P===null&&(P={}),P[C]?P[C]:E},m.printingImage=function(C,E){return!e.active.status||!e.active.status.jobid?"":v(E||e.activeSlug,"jobs",e.active.status.jobid,C||"l")},m.updateVisibleQuickCommands=()=>(console.log("updateVisibleQuickCommands"),r.send("printerVisibleQuickCommands",{},e.activeSlug).then(function(C){console.log("updateVisibleQuickCommands",C),C.ok&&(m.visibleQuickCommands=C.quickCommands)})),m.updateVisibleWizards=()=>r.send("printerVisibleWizards",{},e.activeSlug).then(function(C){C.ok&&(m.visibleWizards=C.wizards)}),m.sortModelsFor=function(C){let E=m.localFor(C),P=E.sortModelsBy||0,A=(P&1)===1,R=l("orderBy"),k=e.printer[C];switch(P&254){case 0:k.models=R(k.allModels,"name",A);break;case 2:k.models=R(k.allModels,"created",A);break;case 4:k.models=R(k.allModels,"printTime",A);break;case 6:k.models=R(k.allModels,"length",A);break;case 8:k.models=R(k.allModels,"lines",A);break;case 10:k.models=R(k.allModels,"filamentTotal",A);break;case 12:k.models=R(k.allModels,"layer",A);break}let I=(E.modelFilter||"").toLowerCase();if(I!==""&&(k.models=k.models.reduce(function(L,T){return(T.name.toLowerCase().indexOf(I)!==-1||T.notes.toLowerCase().indexOf(I)!==-1)&&L.push(T),L},[])),E.activeGroup!=="*"){let L=[];angular.forEach(k.models,function(T){T.group===E.activeGroup&&L.push(T)}),k.models=L,e.globals.gcodeView&&e.globals.gcodeView.perPage<=k.models.length&&(e.globals.gcodeView.page=1)}},m.localFor=function(C){let E=e.printer[C];if(E!==void 0)return typeof E.local=="undefined"&&(E.local={}),E.local},m.local=function(){return m.localFor(e.activeSlug)},m.showConnectionData=function(){r.send("communicationData",{}).then(function(C){n.open({templateUrl:"/views/printer/dialog/connectionData.php?lang="+lang,controller:["$scope","$uibModalInstance",function(E,P){E.comData=C,E.close=function(){P.close()}}],size:"sm"}).result.catch(function(E){})})},m.fetchPrintqueueFor=function(C){let E=e.printer[C];E&&(E.queue||(E.queue=[]),r.send("listJobs",{includeRunning:!0},C).then(function(P){E.queue=P.data,E.queueFilament=0,E.queueTime=0,E.queueLines=0;let A=m.localFor(C);angular.forEach(E.queue,function(R){R.error=R.analysed===2,R.processing=R.analysed===0,R.ok=R.analysed===1,R.list="jobs",R.imgL=v(C,"jobs",R.id,"l",R.version+encodeURIComponent(R.name)),R.imgM=v(C,"jobs",R.id,"m",R.version+encodeURIComponent(R.name)),R.imgT=v(C,"jobs",R.id,"s",R.version+encodeURIComponent(R.name)),A.activeGCode&&A.activeGCode.id===R.id&&A.activeGCode.list===R.list&&(A.activeGCode=R,e.$broadcast("selectActiveGCode",R,1)),R.printTimeBest=R.lastPrintTime?R.lastPrintTime:R.printTime,E.queueFilament+=R.filamentTotal*R.repeat,E.queueTime+=R.printTimeBest*R.repeat,E.queueLines+=R.lines*R.repeat})}))},m.fetchPrintqueue=function(C,E){E.printer===e.activeSlug&&m.fetchPrintqueueFor(e.activeSlug)},m.fetchModelsFor=function(C){if(!e.printer[C])return;let E=e.printer[C];E.models||(E.models=[]),r.send("listModels",{},C).then(function(P){E.allModels=P.data;let A=m.localFor(C);angular.forEach(E.allModels,function(R){R.error=R.analysed===2,R.processing=R.analysed===0,R.ok=R.analysed===1,R.list="models",R.imgL=v(C,"models",R.id,"l",R.version+encodeURIComponent(R.name)),R.imgM=v(C,"models",R.id,"m",R.version+encodeURIComponent(R.name)),R.imgT=v(C,"models",R.id,"s",R.version+encodeURIComponent(R.name)),typeof A.activeGCode!="undefined"&&A.activeGCode.id===R.id&&A.activeGCode.list===R.list&&(A.activeGCode=R,e.$broadcast("selectActiveGCode",R,2)),R.printTimeBest=R.lastPrintTime?R.lastPrintTime:R.printTime}),m.sortModelsFor(C)})},m.fetchModels=function(C,E){E.printer===e.activeSlug&&m.fetchModelsFor(e.activeSlug)},m.motorsOff=function(){r.send("motorsOff",{})},m.updateExcludeRegions=function(){r.send("getExcludeRegions",{}).then(function(C){m.excludeRegions=C.regions,e.$broadcast("excludeRegionsStored")})},e.$on("printqueueChanged",m.fetchPrintqueue),e.$on("jobsChanged",m.fetchModels),e.$on("excludeRegionsChanged",m.updateExcludeRegions),e.$watch("activeSlug",d),d(),m.hasFirmwareSettings=!1,m.firmwareSettings=[];let g=function(){let C=o.config,E=m.firmwareSettings;E.hasOwnProperty("KeepAliveInterval")&&E.KeepAliveInterval>1e3&&(C.connection.serial.communicationTimeout=parseInt(E.KeepAliveInterval/1e3)),E.hasOwnProperty("baudrate")&&(C.connection.serial.baudrate=E.baudrate),E.hasOwnProperty("InputBuffer")&&(C.connection.serial.inputBufferSize=E.InputBuffer),E.hasOwnProperty("PrintlineCache")&&(C.movement.movebuffer=E.PrintlineCache),E.hasOwnProperty("maxXYSpeed")&&(C.movement.maxXYSpeed=E.maxXYSpeed),E.hasOwnProperty("xyJerk")&&(C.movement.xyJerk=E.xyJerk),E.hasOwnProperty("maxZSpeed")&&(C.movement.maxZSpeed=E.maxZSpeed),E.hasOwnProperty("zJerk")&&(E.zJerk>0?C.movement.zJerk=E.zJerk:E.xyJerk>0&&(C.movement.zJerk=E.xyJerk)),E.hasOwnProperty("xPrintAcceleration")&&E.hasOwnProperty("yPrintAcceleration")&&E.xPrintAcceleration===E.yPrintAcceleration&&(C.movement.xyPrintAcceleration=E.xPrintAcceleration),E.hasOwnProperty("xyPrintAcceleration")&&(C.movement.xyPrintAcceleration=E.xyPrintAcceleration),E.hasOwnProperty("xTravelAcceleration")&&E.hasOwnProperty("yTravelAcceleration")&&E.xTravelAcceleration===E.yTravelAcceleration&&(C.movement.xyTravelAcceleration=E.xTravelAcceleration),E.hasOwnProperty("xyTravelAcceleration")&&(C.movement.xyTravelAcceleration=E.xyTravelAcceleration),E.hasOwnProperty("zPrintAcceleration")&&(C.movement.zPrintAcceleration=E.zPrintAcceleration),E.hasOwnProperty("zTravelAcceleration")&&(C.movement.zTravelAcceleration=E.zTravelAcceleration),E.hasOwnProperty("ZLength")&&(C.movement.zMax=E.ZLength),E.hasOwnProperty("RetractionSpeed")&&(C.movement.G10Speed=E.RetractionSpeed),E.hasOwnProperty("RetractionLength")&&(C.movement.G10Distance=E.RetractionLength),E.hasOwnProperty("RetractionLongLength")&&(C.movement.G10LongDistance=E.RetractionLongLength),E.hasOwnProperty("RetractionUndoSpeed")&&(C.movement.G11Speed=E.RetractionUndoSpeed),E.hasOwnProperty("RetractionUndoExtraLength")&&(C.movement.G11ExtraDistance=E.RetractionUndoExtraLength),E.hasOwnProperty("RetractionUndoExtraLongLength")&&(C.movement.G11ExtraLongDistance=E.RetractionUndoExtraLongLength),E.hasOwnProperty("RetractionZLift")&&(C.movement.G10ZLift=E.RetractionZLift),E.hasOwnProperty("XHomePos")&&(C.movement.xHome=E.XHomePos),E.hasOwnProperty("YHomePos")&&(C.movement.yHome=E.YHomePos),E.hasOwnProperty("ZHomePos")&&(C.movement.zHome=E.ZHomePos),E.hasOwnProperty("ZMin")&&(C.shape.basicShape.zMin=C.movement.zMin=E.ZMin,E.hasOwnProperty("ZLength")&&(C.shape.basicShape.zMax=C.movement.zMax=E.ZMin+E.ZLength)),E.hasOwnProperty("ZMax")&&(C.shape.basicShape.zMax=C.movement.zMax=E.ZMax),E.hasOwnProperty("printerType")?(C.general.printerVariant="cartesian",E.printerType===2&&(C.general.printerVariant="delta",C.shape.basicShape.shape="circle",E.hasOwnProperty("printableRadius")&&(C.shape.basicShape.radius=E.printableRadius,C.shape.basicShape.xMin=C.movement.xMin=-E.printableRadius,C.shape.basicShape.xMax=C.movement.xMax=E.printableRadius,C.shape.basicShape.yMin=C.movement.yMin=-E.printableRadius,C.shape.basicShape.yMax=C.movement.yMax=E.printableRadius)),E.printerType===1&&(E.hasOwnProperty("XMin")&&(C.shape.basicShape.xMin=C.movement.xMin=E.XMin,E.hasOwnProperty("XLength")&&(C.shape.basicShape.xMax=C.movement.xMax=E.XMin+E.XLength)),E.hasOwnProperty("YMin")&&(C.shape.basicShape.yMin=C.movement.yMin=E.YMin,E.hasOwnProperty("YLength")&&(C.shape.basicShape.yMax=C.movement.yMax=E.YMin+E.YLength)),E.hasOwnProperty("XMax")&&(C.shape.basicShape.xMax=C.movement.xMax=E.XMax),E.hasOwnProperty("YMax")&&(C.shape.basicShape.yMax=C.movement.yMax=E.YMax))):(E.hasOwnProperty("XMin")&&(C.shape.basicShape.xMin=C.movement.xMin=E.XMin,E.hasOwnProperty("XLength")&&(C.shape.basicShape.xMax=C.movement.xMax=E.XMin+E.XLength)),E.hasOwnProperty("YMin")&&(C.shape.basicShape.yMin=C.movement.yMin=E.YMin,E.hasOwnProperty("YLength")&&(C.shape.basicShape.yMax=C.movement.yMax=E.YMin+E.YLength)),E.hasOwnProperty("ZMin")&&(C.shape.basicShape.zMin=C.movement.zMin=E.ZMin,E.hasOwnProperty("ZLength")&&(C.shape.basicShape.zMax=C.movement.zMax=E.ZMin+E.ZLength)),E.hasOwnProperty("XMax")&&(C.shape.basicShape.xMax=C.movement.xMax=E.XMax),E.hasOwnProperty("YMax")&&(C.shape.basicShape.yMax=C.movement.yMax=E.YMax),E.hasOwnProperty("ZMax")&&(C.shape.basicShape.zMax=C.movement.zMax=E.ZMax)),E.hasOwnProperty("BedXMin")&&(C.shape.basicShape.xMin=E.BedXMin),E.hasOwnProperty("BedYMin")&&(C.shape.basicShape.yMin=E.BedYMin),E.hasOwnProperty("BedXMax")&&(C.shape.basicShape.xMax=E.BedXMax),E.hasOwnProperty("BedYMax")&&(C.shape.basicShape.yMax=E.BedYMax),E.hasOwnProperty("hasHeatedBed")&&C.heatedBeds.length===0&&C.heatedBeds.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,cooldownPerSecond:.1,temperatures:[]}),E.hasOwnProperty("hasHeatedChamber")&&C.heatedChambers.length===0&&C.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,cooldownPerSecond:.1,temperatures:[]}),E.hasOwnProperty("maxBedTemp")&&(C.heatedBeds[0].maxTemp=E.maxBedTemp),E.hasOwnProperty("maxChamberTemp")&&(C.heatedChambers[0].maxTemp=E.maxChamberTemp),E.hasOwnProperty("sdInstalled")&&(C.general.sdcard=!!E.sdInstalled),E.hasOwnProperty("minFansInstalled")&&(C.general.numFans=Math.max(C.general.numFans,E.minFansInstalled)),E.hasOwnProperty("fansInstalled")&&(C.general.numFans=E.fansInstalled),E.hasOwnProperty("softwarePowerSwitch")&&(C.general.softwarePower=!!E.softwarePowerSwitch),E.hasOwnProperty("CaseLights")&&(C.general.softwareLight=!!E.CaseLights),angular.forEach(C.extruders,function(P,A){let R="["+A+"]";E.hasOwnProperty("extrJerk"+R)&&(P.eJerk=E["extrJerk"+R]),E.hasOwnProperty("extrMaxSpeed"+R)&&(P.maxSpeed=E["extrMaxSpeed"+R]),E.hasOwnProperty("extrMaxTemp"+R)&&(P.maxTemp=E["extrMaxTemp"+R]),E.hasOwnProperty("extrAcceleration"+R)&&(P.acceleration=E["extrAcceleration"+R])})};m.readingFirmware=!1;let _=null,x=function(){r.send("getFirmwareSettings",{}).then(function(C){m.firmwareSettings=C.settings,m.hasFirmwareSettings=!0,g(),m.readingFirmware=!1,e.$broadcast("firmwareConfigRead",m.firmwareSettings),_!=null&&(_.resolve(m.firmwareSettings),_=null)})},b=!1,y=null;function S(){b=!1,y=null}let w=function(C){let E=!0,P=/^-?\d+$/,A=/^-?\d+\.?\d*$/,R;C.type==="0"&&(P.exec(C.value)===null?E=!1:(R=parseInt(C.value),E=R>-128&&R<256)),C.type==="1"&&(P.exec(C.value)===null?E=!1:(R=parseInt(C.value),E=R>-32768&&R<65536)),C.type==="2"&&(P.exec(C.value)===null?E=!1:(R=parseInt(C.value),E=R>-2147483648&&R<4294967296)),C.type==="3"&&A.exec(C.value)===null&&(E=!1),E?C.value===C.valueOrig?C.class="":C.class="has-success":C.class="has-error",m.eepromErrors=m.eepromErrors||!E};m.updateEepromErrors=function(){m.eepromErrors=!1,angular.forEach(m.eepromData,function(C){w(C)})},e.$on("eepromClear",function(C,E){E.printer===e.activeSlug&&(m.eepromData=[],b=!0,y&&window.clearTimeout(y),y=window.setTimeout(S,1e3))}),e.$on("eepromData",function(C,E){if(E.printer===e.activeSlug){if(!b)return;m.eepromData=m.eepromData.concat(E.data),m.updateEepromErrors(),y&&window.clearTimeout(y),y=window.setTimeout(S,1e3)}}),e.$on("eepromImport",function(C,E){E.printer===e.activeSlug&&(angular.forEach(E.data.eeprom,function(P){angular.forEach(m.eepromData,function(A,R){P.text===A.text&&P.type===A.type&&(m.eepromData[R].value=P.value)})}),m.updateEepromErrors(),h.success("<?php _('EEPROM data imported') ?>"))}),m.saveEeprom=function(C,E){m.updateEepromErrors(),!m.eepromErrors&&r.send("setEeprom",{eeprom:m.eepromData}).then(function(){angular.forEach(m.eepromData,function(P){P.valueOrig=P.value}),m.updateEepromErrors(),h.success("<?php _('EEPROM data updated!') ?>","",3e3)})},m.eepromDescription=function(C){let E=C.indexOf("[");return E<0?C:C.substr(0,E)},m.eepromUnits=function(C){let E=C.indexOf("[");if(E<0)return"";let P=C.indexOf("]",E);return P<0?"":C.substring(E+1,P).replace("^2","\xB2").replace("^3","\xB3")},m.exportEEPROM=function(){r.send("storeEEPROMFile",{eeprom:m.eepromData}).then(function(){window.open("/printer/eeprom/"+e.activeSlug+"?a=export","_self")})},m.readEEPROM=function(){r.send("getEeprom",{})};let M=function(){m.eepromLoaded=!1,m.eepromErrors=!1,m.eepromData=[],m.hasFirmwareSettings=!1,m.firmwareSettings=[],r.send("getFirmwareSettings",{}).then(function(C){m.firmwareSettings=C.settings,m.hasFirmwareSettings=!0,e.$broadcast("firmwareConfigRead",m.firmwareSettings)})};return m.updateFirmwareAutoset=function(){e.$broadcast("firmwareConfigRead",m.firmwareSettings)},m.updateFirmwareSettings=function(){return m.readingFirmware=!0,_=t.defer(),r.send("startUpdateFirmwareSettings",{}).then(function(){a(x,3e3)}),_.promise},m.setExtruderTemperature=function(C,E){r.send("setExtruderTemperature",{temperature:E,extruder:C})},m.setBedTemperature=function(C,E){E===void 0&&(E=0),r.send("setBedTemperature",{temperature:C,bedId:E})},m.setChamberTemperature=function(C,E){E===void 0&&(E=0),r.send("setChamberTemperature",{temperature:C,chamberId:E})},m.sendGCode=function(C){r.send("send",{cmd:C})},m.disableAutostartNextPrint=function(){r.send("setAutostart",{state:!1})},m.setAutostartNextPrint=function(C){C?m.enableAutostartNextPrint():m.disableAutostartNextPrint()},m.enableAutostartNextPrint=function(){r.send("setAutostart",{state:!0})},m.recomputeAllGCodeInfo=function(){r.send("recomputeAllGCodeInfo",{})},m.recomputeGCodeInfo=function(C){r.send("recomputeGCodeInfo",{id:C.id,list:C.list})},m.sendQuickCommand=function(C){r.send("sendQuickCommand",{name:C})},m.sendWizardCommand=function(C){r.send("sendWizardCommand",{uuid:C})},m.power=function(){m.sendGCode("@runButtonCommand togglePower")},m.autolevel=function(){f('<?php _("Auto Bed Leveling") ?>','<?php _("Please ensure that the bed is free of obstacles.") ?>','<?php _("Continue") ?>','<?php _("Cancel") ?>',!0).then(function(){m.sendGCode("@runButtonCommand autolevel")})},m.emergencyStop=function(){r.send("emergencyStop",{})},m.toggleShutdownAfterPrint=function(){r.send("setShutdownAfterPrint",{shutdown:!e.active.state.shutdownAfterPrint})},m.toggleFilterFan=function(){r.send("setFilterFan",{filter:!e.active.state.filterFan})},m.speedChange=function(C){e.active.state.speedMultiply=C,r.send("setSpeedMultiply",{speed:e.active.state.speedMultiply})},m.flowChange=function(C){e.active.state.flowMultiply=C,r.send("setFlowMultiply",{speed:e.active.state.flowMultiply})},m.setFanPercent=function(C,E){r.send("setFanSpeed",{speed:Math.round(C*2.55),fanId:E})},m.setFanOn=function(C,E){e.active.state.fans[E].on=C,r.send("setFanSpeed",{speed:Math.round(e.active.state.fans[E].percent*2.55),on:C,fanId:E})},m.toggleCaseLights=function(){m.sendGCode("@runButtonCommand toggleLight")},m.xMoveRel=function(C){e.activeConfig.movement.invertX&&(C=-C),r.send("move",{x:C,relative:!0}),i.updateStateNow()},m.yMoveRel=function(C){e.activeConfig.movement.invertY&&(C=-C),r.send("move",{y:C,relative:!0}),i.updateStateNow()},m.zMoveRel=function(C){e.activeConfig.movement.invertZ&&(C=-C),r.send("move",{z:C,relative:!0}),i.updateStateNow()},m.eMoveRel=function(C,E){r.send("move",{e:C,relative:!0,speed:E}),i.updateStateNow()},m.selectExtruder=function(C){r.send("activateExtruder",{extruder:parseInt(C)}),e.active.state.activeExtruder=C,i.updateStateNow()},m.runScript=function(C){r.send("runScript",{script:C})},m.activate=function(){r.send("activate",{printer:slug})},m.deactivate=function(){r.send("deactivate",{printer:slug})},m.stopPrint=function(){e.active.status.jobid&&r.send("stopJob",{id:e.active.status.jobid})},m.pausePrint=function(){r.send("send",{cmd:"@pause <?php _('User requested pause.') ?>"})},m.unpausePrint=function(){r.send("continueJob",{})},m.toolNames=["<?php _('Extruder') ?>","<?php _('Milling head') ?>","<?php _('Laser') ?>","<?php _('Syringe') ?>","<?php _('Heated Chamber') ?>"],m.toolIcons=["rs rs-extruder","rs rs-mill","rs rs-laser","rs rs-syringe","rs rs-chamber"],m.toolDiameterName=["<?php _('Nozzle diameter') ?>","<?php _('Milling width') ?>","<?php _('Laser diameter') ?>","<?php _('Syringe diameter') ?>","<?php _('Diameter') ?>"],m.heaterIcons=["rs rs-bed","rs rs-chamber","rs rs-humidity","rs rs-water-temp","rs rs-chip","rs rs-fan","rs rs-pressure"],m.extruderName=function(C){if(e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length){let E=e.activeConfig.extruders[C].alias;return E||m.toolNames[e.activeConfig.extruders[C].toolType]+" "+(C+1)}return"<?php _('Extruder') ?> "+(C+1)},m.extruderIcon=function(C){return e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length?m.toolIcons[e.activeConfig.extruders[C].toolType]:m.toolIcons[0]},m.extruderDiameterName=function(C){return e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length?m.toolDiameterName[e.activeConfig.extruders[C].toolType]:m.toolDiameterName[0]},m.bedName=function(C){if(e.activeConfig&&e.activeConfig.heatedBeds&&C>=0&&C<e.activeConfig.heatedBeds.length){let E=e.activeConfig.heatedBeds[C].alias;return E||"<?php _('Heated Bed') ?>"+(C>0?" "+(C+1):"")}return"<?php _('Heated Bed') ?>"+(C>0?" "+(C+1):"")},m.chamberName=function(C){if(e.activeConfig&&e.activeConfig.heatedChambers&&C>=0&&C<e.activeConfig.heatedChambers.length){let E=e.activeConfig.heatedChambers[C].alias;return E||"<?php _('Heated Chamber') ?>"+(C>0?" "+(C+1):"")}return"<?php _('Heated Chamber') ?>"+(C>0?" "+(C+1):"")},m.chamberIcon=function(C){return e.activeConfig&&e.activeConfig.heatedChambers&&C>=0&&C<e.activeConfig.heatedChambers.length?m.heaterIcons[e.activeConfig.heatedChambers[C].sensorType]:m.heaterIcons[0]},m.chamberUnit=function(C){var E;return e.activeConfig&&e.activeConfig.heatedChambers&&C>=0&&C<e.activeConfig.heatedChambers.length&&(E=e.activeConfig.heatedChambers[C].unit)!=null?E:"\xBAC"},m.bedIcon=function(C){return e.activeConfig&&e.activeConfig.heatedBeds&&C>=0&&C<e.activeConfig.heatedBeds.length?m.heaterIcons[e.activeConfig.heatedBeds[C].sensorType]:m.heaterIcons[0]},e.$on("printerSelected",M),e.activeSlug&&M(),m}]);RSBase.factory("Confirm",["$uibModal","$sce",function(t,e){return function(i,r,n,o,a,l,h){let u=t.open({templateUrl:"/views/base/confirm.php?lang="+lang,controller:["$scope","$uibModalInstance",function(c,f){c.infoText=r,c.infoHeader=i,c.infoYes=n||"<?php _('Yes') ?>",c.infoNo=o||"<?php _('No') ?>",c.infoHtml=e.trustAsHtml(l||""),c.infoNoClass="",c.infoYesClass="",h&&(c.infoNoClass+="hidden "),a?(c.infoYesClass+="btn-danger",c.infoNoClass+="btn-primary"):(c.infoYesClass+="btn-primary",c.infoNoClass+="btn-default"),c.confirmNo=function(){f.dismiss()},c.confirmYes=function(){f.close()}}],size:"lg"});return u.result.catch(function(c){}),u.result}}]).factory("Info",["$uibModal",function(t){return function(e,i,r){let n=t.open({templateUrl:"/views/base/info.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.infoText=i,o.infoHeader=e,o.infoOk=r||"<?php _('ok') ?>",o.infoOkClass="btn-primary",o.ok=function(){a.close()}}],size:"lg"});return n.result.catch(function(o){}),n.result}}]).factory("StringDialog",["$uibModal",function(t){return function(e,i,r,n,o,a){let l=t.open({templateUrl:"/views/base/string.php?lang="+lang,controller:["$scope","$uibModalInstance",function(h,u){h.value=r,h.infoText=i,h.infoHeader=e,h.infoYes=n||"<?php _('Ok') ?>",h.infoNo=o||"<?php _('Cancel') ?>",a?(h.infoYesClass="btn-danger",h.infoNoClass="btn-primary"):(h.infoYesClass="btn-primary",h.infoNoClass="btn-default"),h.confirmNo=function(){u.dismiss()},h.confirmYes=function(){u.close(h.value)},setTimeout(function(){let c=document.getElementById("textinput");c&&c.focus()},200)}],size:"sm",backdrop:"static"});return l.result.catch(function(h){}),l.result}}]);RSBase.filter("online",function(){return function(t){return t.active?t.online?t.done?'<span class="label label-success label-online">'+t.done.toFixed(1)+"%</span>":t.online===1?`<span class="label label-success label-online"><?php _('Online') ?></span>`:`<span class="label label-warning label-online"><?php _('Connected') ?></span>`:`<span class="label label-danger label-online"><?php _('Offline') ?></span>`:`<span class="label label-default label-online"><?php _('Deactivated') ?></span>`}}).filter("onlinecircle",function(){return function(t){return t?t.active?t.online===1?`<span class="fg-success" title="<?php _('Online') ?>"><i class="fa fa-link fa-lg"></i></span>`:t.online===2?`<span class="fg-warning" title="<?php _('Connected') ?>"><i class="fa fa-signal fa-lg"></i></span>`:`<span class="fg-danger" title="<?php _('Offline') ?>"><i class="fa fa-unlink fa-lg" ></i></span>`:`<span style="color:#999999" title="<?php _('Deactivated') ?>"><i class="fa fa-power-off fa-lg"></i></span>`:""}}).filter("printerConditionIconHome",function(){return function(t){if(!t)return"";if(!t.status.active)return"fa fa-power-off";if(t.status.online===0)return"fa fa-unlink";switch(t.state.condition){case 0:return"fa fa-link";case 1:return"fa fa-link";case 2:return"fa fa-warning fg-warning";case 3:return"fa fa-exclamation";case 4:return"fa fa-warning";case 5:return"fa fa-power-off"}return"fa fa-link"}}).filter("printerConditionIcon",function(){return function(t){if(!t)return"";if(!t.status.active)return'<span style="color:#999999"><i class="fa fa-power-off fa-lg margin-right"></i></span>';if(t.status.online===0)return'<span class="fg-danger"><i class="fa fa-unlink fa-lg" ></i></span>';switch(t.state.condition){case 0:return'<span class="fa fa-lg fa-question fg-gray margin-right"></span>';case 1:return'<span class="fa fa-lg fa-check fg-success margin-right"></span>';case 2:return'<span class="fa fa-lg fa-warning fg-warning margin-right"></span>';case 3:return'<span class="fa fa-lg fa-exclamation fg-danger margin-right"></span>';case 4:return'<span class="fa fa-lg fa-warning fg-warning margin-right"></span>';case 5:return'<span class="fa fa-lg fa-power-off fg-gray margin-right"></span>'}return""}}).filter("printerConditionText",function(){return function(t){if(!t)return"";if(!t.status.active)return"<?php _('Deactivated') ?>";if(t.status.online===0)return"<?php _('Offline') ?>";switch(t.state.condition){case 0:return"<?php _('Waiting for communication') ?>";case 1:return"<?php _('Online') ?>";case 2:return"<?php _('Shutdown') ?>";case 3:return"<?php _('Error') ?>";case 4:return"<?php _('Printer Problems') ?>";case 5:return"<?php _('Offline') ?>"}return""}}).filter("onlineclass",function(){return function(t){return t.active?t.online===1?"success":t.online===2?"warning":"danger":"default"}}).filter("onlinepanel",function(){return function(t){return t.active?t.online===1?"panel-green":t.online===2?"panel-warning":"panel-red":"panel-default"}}).filter("temp",function(){return function(t){return t===0?"<?php _('Off') ?>":t===-333?"<?php _('DEF') ?>":t===-444?"<?php _('DEC') ?>":t+"\xB0C"}}).filter("printing",function(){return function(t){return t.job==="none"?"<?php _('No print job running') ?>":t.job}}).filter("byte",function(){return function(t){return t<1024?t+" <?php _('byte') ?>":(t/=1024,t<1024?t.toFixed(1)+" <?php _('kB') ?>":(t/=1024,t<1024?t.toFixed(1)+" <?php _('MB') ?>":(t/=1024,t.toFixed(1)+" <?php _('GB') ?>")))}}).filter("hms",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"<?php _('Computing ...') ?>";var i=Math.floor(e/3600);e-=3600*i;var r=Math.floor(e/60);e-=r*60;var n="";return i>0&&(n+=i+"h "),(r>0||i>0)&&(n+=r+"m "),i>0?n:n+Math.round(e)+"s"}}).filter("hmsFinal",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"0s";var i=Math.floor(e/3600);e-=3600*i;var r=Math.floor(e/60);e-=r*60;var n="";return i>0&&(n+=i+"h "),(r>0||i>0)&&(n+=r+"m "),i>0?n:n+Math.round(e)+"s"}}).filter("dhms",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"<?php _('Computing ...') ?>";var i=Math.floor(e/3600);e-=3600*i;var r=0;i>23&&(r=Math.floor(i/24),i-=r*24);var n=Math.floor(e/60);e-=n*60;var o="";return r>0&&(o+=r+"d "),(i>0||r>0)&&(o+=i+"h "),(n>0||i>0)&&(o+=t(n)+"m "),r===0&&(o+=t(e)+"s "),o}}).filter("permissions",function(){return function(t){let e="";return t&2048&&(e+=" / <?php _('Admin') ?>"),t&1024&&(e+=" / <?php _('Manage Accounts') ?>"),t&4096&&(e+=" / <?php _('Change password') ?>"),t&1&&(e+=" / <?php _('Print') ?>"),t&512&&(e+=" / <?php _('Full Stop / Stop / Pause / Deactivate') ?>"),t&256&&(e+=" / <?php _('Read Files') ?>"),t&2&&(e+=" / <?php _('Add Files') ?>"),t&4&&(e+=" / <?php _('Remove Files') ?>"),t&8&&(e+=" / <?php _('Configure') ?>"),t&16&&(e+=" / <?php _('History') ?>"),t&32&&(e+=" / <?php _('See Projects') ?>"),t&64&&(e+=" / <?php _('Edit Projects') ?>"),e.length>0&&(e=e.substring(3)),e}}).filter("yesno",function(){return function(t){return t?"<?php _('Yes') ?>":"<?php _('No') ?>"}}).filter("onoff",function(){return function(t){return t?"<?php _('On') ?>":"<?php _('Off') ?>"}}).filter("convertReturn",function(){return function(t){return t.replace(/</g,"&lt;").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n/g,"<br>")}}).filter("matches",function(){return function(t,e,i){var r=[];if(t)for(var n=0;n<t.length;n++){var o=t[n];o[e]===i&&r.push(o)}return r}}).filter("tempRead",function(){return function(t,e,i){if(e||(e=0),typeof t=="undefined")return"";if(t===-333)return"<?php _('DEF') ?>";if(t===-444)return"<?php _('DEC') ?>";let r="\xB0C";return i&&i.unit&&(r=i.unit),t.toFixed(e)+r}}).filter("cropLogName",function(){return function(t){let e=t.split("_").slice(1).join("_");return e.length==0&&(e=t),e}}).filter("tempFull",function(){return function(t,e){if(e||(e=0),!t)return"";if(t.tempRead===-333)return"<?php _('DEF') ?>";if(t.tempRead===-444)return"<?php _('DEC') ?>";let i="\xB0C";return t.tempRead.toFixed(e)+i+" / "+(t.tempSet===0?"<?php _('Off') ?>":t.tempSet.toFixed(0)+i)}}).filter("tempFullConf",function(){return function(t,e,i){if(i||(i=0),!t)return"";if(t.tempRead===-333)return"<?php _('DEF') ?>";if(t.tempRead===-444)return"<?php _('DEC') ?>";let r=e.unit?e.unit:"\xB0C";return t.tempRead.toFixed(i)+r+(e.supportTemperature?" / "+(t.tempSet===0?"<?php _('Off') ?>":t.tempSet.toFixed(e.setPrecision)+r):"")}}).filter("unsafe",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]);(function(){let t=[],e=[],i=[],r=null,n={setupMenu:[],printerMenu:[],printerTabs:[],printerConfigTabs:[],globalSettings:[],visible:{true:!0,false:!1}};function o(l,h){return l.prio<h.prio?-1:l.prio>h.prio?1:0}n.registerPrinterMenuEntry=function(l){l.prio||(l.prio=1e4),t.push(l),t.sort(o)},n.registerSetupMenuEntry=function(l){l.prio||(l.prio=1e4),n.setupMenu.push(l),n.setupMenu.sort(o)},n.registerPrinterTab=function(l){l.prio||(l.prio=1e4),e.push(l),e.sort(o)},n.setPrinterTabNameByState=function(l,h){angular.forEach(e,function(u){u.state===l&&(u.name=h)})},n.setPrinterTabIconByState=function(l,h){angular.forEach(e,function(u){u.state===l&&(u.icon=h)})},n.registerPrinterConfigTab=function(l){l.prio||(l.prio=1e4),l.feature||(l.feature=""),i.push(l),i.sort(o)},n.registerGlobalSettingsConfig=function(l){n.globalSettings.push(l)},n.setVisible=function(l,h){n.visible[l]=h};let a=function(l,h,u){return l.visible&&!n.visible[l.visible]||l.feature&&r&&!r.showFeature(l.feature)||l.requireOnline&&!h?!1:!(l.requireActive&&!u)};RSBase.provider("RSFrontend",[function(){this.$get=function(){return n},this.registerPrinterTab=n.registerPrinterTab,this.setPrinterTabNameByState=n.setPrinterTabNameByState,this.registerPrinterConfigTab=n.registerPrinterConfigTab,this.registerSetupMenuEntry=n.registerSetupMenuEntry,this.registerGlobalSettingsConfig=n.registerGlobalSettingsConfig,this.registerPrinterMenuEntry=n.registerPrinterMenuEntry,this.setVisible=n.setVisible}]),RSBase.run(["$rootScope","RSFrontend","$timeout",function(l,h,u){l.frontend=h;let c=function(){r=l.user;let f=l.active&&l.active.status&&l.active.status.online===1,d=l.active&&l.active.status&&l.active.status.active;n.printerTabs=[],angular.forEach(e,function(m){a(m,f,d)&&n.printerTabs.push(m)}),n.printerConfigTabs=[],angular.forEach(i,function(m){a(m,f,d)&&n.printerConfigTabs.push(m)}),n.printerMenu=[],angular.forEach(t,function(m){a(m,f,d)&&n.printerMenu.push(m)})};n.setVisible=function(f,d){n.visible[f]=d,c()},l.$watch("active.status.online",c),l.$watch("active.status.active",c),l.$on("printerConfigTabs",c),l.$on("userCredentials",()=>{u(c,50)}),c()}])})();RSBase.controller("PushMessageController",["$scope","$rootScope","RSCom","GSettings","RSGS","Flash",function(t,e,i,r,n,o){t.textThirdParty="<?php _('Here you can enter your external push service API link to push a message. Please use the {{message}} placeholder for the text parameter. For an example with CallMeBot see: ') ?>",t.groupId=e.serverSettings.g_push_group;let a=e.serverSettings.g_push_group;t.serverSettingsChanged=r.serverSettingsChanged,t.timeout=30,e.$watch("serverSettings.g_push_group",function(u){u!==a&&(a=t.groupId=u)}),e.$watch("serverSettings.g_push_print_busy_timeout",function(u){t.timeout=u}),t.$watch("timeout",function(u){u&&u>=10&&(e.serverSettings.g_push_print_busy_timeout=u,r.serverSettingsChanged())});function l(u){return u.length===29}function h(u){u=ac("-","",u.toUpperCase()).trim();let c="";for(let f=0;f<u.length;f++){let d=u.charAt(f);(d>="0"&&d<="9"||d>="A"&&d<="Z")&&(c+=d)}for(u=c.substring(0,25),c="";u.length>0;)c+=u.substring(0,5),u.length>5?(c+="-",u=u.substring(5)):u="";return c}t.$watch("groupId",function(u){if(typeof u=="undefined")return;let c=h(u);c!==u&&(t.groupId=c),l(c)&&c!==e.serverSettings.g_push_group&&(e.serverSettings.g_push_group=c,r.serverSettingsChanged())}),t.sendTestMessage=function(u){let c=u==="repetierInformer"?"testPushMessage":"";c=u==="pushover"?"testPushoverPushMessage":c,c=u==="thirdParty"?"testThirdPartyPushMessage":c,i.send(c,{}).then(function(f){f.send?o.success("<?php _('Push message send') ?>"):o.error("<?php _('Failed to send push message') ?>")})}}]);RSBase.controller("UpdateController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout",function(t,e,i,r,n,o){t.checkingUpdate=!0,t.updateError="",t.registerResult="",t.isUpdating=!1,t.licence={licence:"",active:!1,wantsBranding:!1,hasBranding:!1};let a=function(){i.send("getLicenceData",{}).then(function(h){t.licence=h})};function l(){i.send("checkForUpdates",{}).then(function(){i.updateImportant()}),a()}l(),t.$on("newUpdateLoaded",function(){o(function(){t.checkingUpdate=!1},500)}),t.autoupdate=function(){t.isUpdating||(t.isUpdating=!1,i.send("autoupdate",{}).then(function(h){t.isUpdating=!0,t.updateError=h.error,h.error===""?(r.success("<?php _('Autoupdate started') ?>"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="<?php _('Downloading and starting update. Display will reload when finished.') ?>":t.registerResult="<?php _('Downloading and starting update.') ?>"):t.isUpdating=!1}))},t.$on("connected",function(){t.isUpdating?location.reload(!0):l()}),t.startPeriod=function(){r.info("<?php _('Starting Trial Period') ?>"),i.send("setTestperiodMode",{mode:2})}}]);RSBase.controller("RegisterController",["$scope","$rootScope","RSCom","Flash",function(t,e,i,r){t.update={},t.licence={licence:"",active:!1,wantsBranding:!1,hasBranding:!1},t.upgradeLicense="",t.upgradeLicenseValid=!1,t.licenceValid=!1,t.deactivated=!1,t.licenceError=!1,t.waitActivate=!1,t.waitDeactivate=!1,t.updateError="",t.registerResult="",t.isUpdating=!1,t.infoClass=()=>e.isOEM()?"col-xs-6":"col-xs-4";let n=function(){i.updateImportant(),i.send("getLicenceData",{}).then(function(l){t.licence=l,t.licence.wantsBranding&&!t.licence.active&&location.reload(!0)})};t.startPeriod=function(){r.info("<?php _('Starting Trial Period') ?>"),i.send("setTestperiodMode",{mode:2})},t.$on("connected",function(){t.isUpdating?location.reload(!0):n()}),t.$on("autoupdateResponse",function(l,h){h.data.code===0?t.registerResult=h.data.response:t.updateError=h.data.response,t.isUpdating=!1});function o(l){return l.length===29}function a(l){l=ac("-","",l.toUpperCase()).trim();let h="";for(let u=0;u<l.length;u++){let c=l.charAt(u);(c>="0"&&c<="9"||c>="A"&&c<="Z")&&(h+=c)}for(l=h.substring(0,25),h="";l.length>0;)h+=l.substring(0,5),l.length>5?(h+="-",l=l.substring(5)):l="";return h}t.$watch("licence.licence",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.licence.licence=h),t.licenceValid=o(h)}),t.$watch("upgradeLicense",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.upgradeLicense=h),t.upgradeLicenseValid=o(h)}),t.clearLicense=function(){i.send("setLicenceData",{a:"clear",licence:t.licence.licence}).then(()=>{n()})},t.activate=function(){t.waitActivate=!0,i.send("setLicenceData",{a:"activate",licence:t.licence.licence}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,location.reload(!0),n()):t.licenceError=l.errorMsg})},t.upgradeFromOEM=function(){t.waitActivate=!0,i.send("upgradeLicence",{licence:t.upgradeLicense}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,location.reload(!0)):t.licenceError=l.errorMsg,n()})},t.deactivate=function(){t.licence.active&&(t.waitDeactivate=!0,i.send("setLicenceData",{a:"deactivate"}).then(function(l){t.waitDeactivate=!1,l.success?(t.licence.active=!1,t.deactivated=!0,t.licenceError=!1,location.reload(!0)):t.licenceError=l.errorMsg,n()}))},t.autoupdate=function(){t.isUpdating=!1,i.send("autoupdate",{}).then(function(l){t.isUpdating=!0,t.updateError=l.error,l.error===""&&(r.success("<?php _('Autoupdate started') ?>"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="<?php _('Downloading and starting update. Display will reload when finished.') ?>":t.registerResult="<?php _('Downloading and starting update.') ?>")})},n()}]);RSBase.controller("RegisterBrandingController",["$scope","$rootScope","RSCom","Flash",function(t,e,i,r){t.update={},t.licence={licence:"",active:!1},t.licenceValid=!1,t.deactivated=!1,t.licenceError=!1,t.waitActivate=!1,t.waitDeactivate=!1,t.updateError="",t.registerResult="",t.isUpdating=!1;let n=function(){i.updateImportant(),i.send("getLicenceData",{}).then(function(l){t.licence=l})};t.$on("connected",function(){t.isUpdating?location.reload(!0):n()}),t.$on("autoupdateResponse",function(l,h){h.data.code===0?t.registerResult=h.data.response:t.updateError=h.data.response,t.isUpdating=!1});function o(l){return l.length===29}t.clearLicense=function(){i.send("setLicenceData",{a:"clear",licence:t.licence.licence}).then(()=>{n()})};function a(l){l=ac("-","",l.toUpperCase()).trim();let h="";for(let u=0;u<l.length;u++){let c=l.charAt(u);(c>="0"&&c<="9"||c>="A"&&c<="Z")&&(h+=c)}for(l=h.substr(0,25),h="";l.length>0;)h+=l.substr(0,5),l.length>5?(h+="-",l=l.substr(5)):l="";return h}t.$watch("licence.licence",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.licence.licence=h),t.licenceValid=o(h)}),t.activate=function(){t.waitActivate=!0,i.send("setLicenceData",{a:"activate",licence:t.licence.licence}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,window.location.href="/?lang="+window.lang):t.licenceError=l.errorMsg,n()})},t.autoupdate=function(){t.isUpdating=!1,i.send("autoupdate",{}).then(function(l){t.isUpdating=!0,t.updateError=l.error,l.error===""&&(r.success("<?php _('Autoupdate started') ?>"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="<?php _('Downloading and starting update. Display will reload when finished.') ?>":t.registerResult="<?php _('Downloading and starting update.') ?>")})},n()}]);RSBase.controller("ServerController",["$scope","$rootScope","$timeout","$http","RSCom","$q","User","RSOverview","RSMessages","RSRegistry","GSettings","RSFrontend","$uibModal","Flash","Fullscreen","$state","Confirm","RSPrinter","AdvertisementController",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_,x){e.user=a,t.overview=l,t.RSRegistry=u,e.page="",e.ft=51,t.question={},t.menuMessages=!1,t.menuMain=!1,t.menuHardware=!1,t.menuLanguage=!1,t.menuPrinter=!1;let b=Math.floor(Math.random()*10)+1;e.view={showLeft:!0,showRight:!0,showFullscreen:!1};let y={hideLeft:!1,hideRight:!1,fullscreen:!1};e.setOverride=(R,k)=>{y[R]=k,M()};let S=!1,w=()=>{l.printerListLoadedPromise.then(function(){let R=!1;if(!e.isPro()&&!e.isOEM()||R){let k=localStorage.getItem("RServer.reminderLastTimeVisible")||new Date;if(!S&&(R||b===10||new Date().getTime()>=parseInt(k))){b=0;let I=new Date;I.setDate(I.getDate()+7),S=!0,x().then(()=>{localStorage.setItem("RServer.reminderLastTimeVisible",I.getTime().toString()),S=!1})}}})},M=()=>{let R=!1;a.isLoggedIn&&(R=a.getSetting("leftPrinterList","0")==="1"),e.view.showLeft=R&&a.getSetting("leftPrinterList","0")==="1"&&e.wwidth>1520&&!y.hideLeft,e.view.showFullscreen=y.fullscreen};M(),e.$on("userSettingsChanged",M),t.closeMessages=function(){t.menuMessages=!1},t.closeMain=function(){t.menuMain=!1},t.closeHardware=function(){t.menuHardware=!1},t.closeLanguage=function(){t.menuLanguage=!1},t.showPrinter=function(R){let k=_.getActivePage(R,{state:"printer.print",params:{slug:R}});v.go(k.state,k.params),t.menuPrinter=!1},t.supportedLanguages={},r.get("/languages.json").then(function(R){t.supportedLanguages=R.data},function(){});let C=function(){e.wwidth=$(window).width(),e.wheight=$(window).height(),M(),e.$broadcast("windowResized",{width:e.wwidth,height:e.wheight})};$(window).resize(C),C(),t.executeGlobalExternalLink=function(R){if(t.menuMain=!1,R.openExternal){let k=window.location.host.match(/(.*?)(:\d+)?$/)[1],I=R.href.replace("0.0.0.0",k);window.open(I,"_blank")}else v.go("externalLink",{id:R.id})},t.$on("$destroy",()=>{e.setOverride("hideLeft",!1),$(window).off("resize",C)}),t.toggleFullscreen=function(){p.toggleFullscreen(window.document.body)},t.selectLanguage=function(R){let k=document.URL,I=k.indexOf("lang=");I<0?(I=k.indexOf("#"),k.indexOf("?")<0?(I<0&&(I=k.length),k=k.substring(0,I)+"?lang="+R+k.substring(I)):k=k.substring(0,I)+"&lang="+R+k.substring(I)):k=k.substring(0,I+5)+R+k.substring(I+7),console.log("select ",R,k),window.location=k};let E=-1;t.$on("newUpdateLoaded",function(R,k){k.testperiodMode===2&&E>-1&&E!==2&&location.reload(!0),k.testperiodMode>2&&E===2&&(E=k.testperiodMode,location.reload(!0)),k.testperiodMode===2&&(E=2),k.testperiodMode===0&&E!==0&&(E=0,d.open({templateUrl:"/views/services/startTestperiod.modal.php?lang="+lang,scope:t,size:"lg",controller:["$scope","$uibModalInstance",function(I,L){I.noTest=function(){n.send("setTestperiodMode",{mode:1}).then(function(){L.close()},function(){})},I.startPeriod=function(){m.info("<?php _('Starting Trial Period') ?>"),n.send("setTestperiodMode",{mode:2}).then(function(){L.close()})}}]}).result.catch(function(I){})),k.testperiodMode===3&&E!==3&&(E=3,d.open({templateUrl:"/views/services/endTestperiod.modal.php?lang="+lang,scope:t,size:"lg",controller:["$scope","$uibModalInstance",function(I,L){I.ok=function(){n.send("setTestperiodMode",{mode:4}).then(function(){L.close()})}}]}).result.catch(function(I){}))});let P={};t.qr=function(R,k,I,L,T){L||(L=0),T||(T=4);let O=R+"://"+k+":"+I,D=P[O];return D||(D=QRCode.generatePNG(O,{modulesize:T,margin:L}),P[O]=D),D},t.qr6=function(R,k,I,L,T){L||(L=0),T||(T=4);let O=R+"://["+k+"]:"+I,D=P[O];return D||(D=QRCode.generatePNG(O,{modulesize:T,margin:L}),P[O]=D),D},t.runCall=function(R){R.question?g("<?php _('Security question') ?>",R.question).then(function(){n.send("webCallExecute",{name:R.name,params:["Test"]})}):n.send("webCallExecute",{name:R.name,params:["Test"]})},t.runGPIOCall=function(R){if(R.operation===3)if(R.securityQuestion){let k=(R.state?"<?php _('Really disable @?') ?>":"<?php _('Really enable @?') ?>").replace("@",R.display);g("<?php _('Security Question') ?>",k,"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){n.send("GPIORun",{uuid:R.uuid,cmd:"toggle"})},function(){})}else n.send("GPIORun",{uuid:R.uuid,cmd:"toggle"});R.operation===4&&d.open({templateUrl:"/views/gsettings/gpioPWMDialog.php?lang="+lang,size:"sm",controller:["$scope",function(k){k.pin=R,console.log("pin diag",R,k),k.disablePin=function(){n.send("GPIORun",{uuid:k.pin.uuid,cmd:"off"}).then(function(){k.$close()},function(){})},k.setPWM=function(I){k.pin.state=!0,console.log("pwm",I,k.pin),n.send("GPIORun",{uuid:k.pin.uuid,cmd:""+I})}}]})},t.$on("changeFilamentRequested",function(R,k){console.log("Change filament requested",k),v.go("printer.filamentchange",{slug:k.printer,extruder:k.data.extruder})});function A(){localStorage.getItem("RServer.fullWidth")==="true"?document.body.classList.add("full-width"):document.body.classList.remove("full-width")}e.toggleFullWidth=function(){localStorage.setItem("RServer.fullWidth",localStorage.getItem("RServer.fullWidth")!=="true"),A()},A()}]);RSBase.controller("ManufacturerNewsController",["$scope","$rootScope","$http","RSCom","$q","User","RSOverview","Flash",function(t,e,i,r,n,o,a,l){let h=c=>{r.send("markManufacturerNewsRead",{uuid:c.uuid}).then(function(){c.read=!0})};t.panelClass={};let u=()=>{e.manufacturerNews.forEach(c=>{t.panelClass[c.uuid]||(t.panelClass[c.uuid]=c.read?"panel-default":"panel-info",c.read||h(c))})};t.$on("manufacturerNewsUpdated",u),u()}]);RSBase.directive("slider",[function(){return{scope:{model:"=ngModel",min:"@min",max:"@max",step:"@step",precision:"@precision",size:"@",enabled:"@",moved:"&"},restrict:"A",replace:!1,link:function(t,e,i){let r=!1,n="";i.flip&&(r=!!i.flip),i.letter&&(n=i.letter),$(e).slider({orientation:i.orientation,step:i.step,min:0,max:100,flip:r,letter:n,formater:function(a){return t.$eval(a+" | number:precision")}}).on("slideStop",function(a){t.$apply(function(){t.model=parseFloat(a.value),t.moved&&t.moved({value:parseFloat(a.value)})})}),t.$watch("model",function(){(typeof i.enabled=="undefined"||t.enabled)&&$(e).slider("setValue",t.model)}),t.$watch("enabled",function(){$(e).slider("setEnabled",!!t.enabled),t.enabled&&$(e).slider("setValue",t.model)}),t.$watch("min",function(){$(e).slider("setMin",parseFloat(t.min)),$(e).slider("setValue",t.model)}),t.$watch("max",function(){$(e).slider("setMax",parseFloat(t.max)),$(e).slider("setValue",t.model)}),t.$watch("step",function(){$(e).slider("setStep",parseFloat(t.step)),$(e).slider("setValue",t.model)}),t.$watch("size",function(){$(e).slider("setSize",parseFloat(t.size)),$(e).slider("setValue",t.model)})}}}]);function DY(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function IY(){let t=DY("canvas");return t.style.display="block",t}function yv(t={}){let e=t.canvas!==void 0?t.canvas:IY(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,o=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,l=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,h=t.powerPreference!==void 0?t.powerPreference:"default",u=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,c;t.context!==void 0?c=i.getContextAttributes().alpha:c=t.alpha!==void 0?t.alpha:!1;let f=null,d=null,m=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Er,this.physicallyCorrectLights=!1,this.toneMapping=qr,this.toneMappingExposure=1;let v=this,g=!1,_=0,x=0,b=null,y=-1,S=null,w=new Vt,M=new Vt,C=null,E=e.width,P=e.height,A=1,R=null,k=null,I=new Vt(0,0,E,P),L=new Vt(0,0,E,P),T=!1,O=new Go,D=!1,F=!1,B=null,U=new dt,G=new $e,Y=new j,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function N(){return b===null?A:1}let z=i;function ie(W,q){for(let te=0;te<W.length;te++){let Q=W[te],ee=e.getContext(Q,q);if(ee!==null)return ee}return null}try{let W={alpha:!0,depth:r,stencil:n,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Lu}`),e.addEventListener("webglcontextlost",H,!1),e.addEventListener("webglcontextrestored",pe,!1),z===null){let q=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&q.shift(),z=ie(q,W),z===null)throw ie(q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(W){throw console.error("THREE.WebGLRenderer: "+W.message),W}let Z,ne,K,ae,ue,_e,Re,Le,Et,it,je,ut,jt,Wt,X,V,me,Ce,De,He,Qe,de,Ge;function gt(){Z=new CR(z),ne=new pR(z,Z,t),Z.init(ne),de=new lL(z,Z,ne),K=new oL(z,Z,ne),ae=new TR(z),ue=new KR,_e=new aL(z,Z,K,ue,ne,de,ae),Re=new gR(v),Le=new SR(v),Et=new MA(z,ne),Ge=new fR(z,Z,Et,ne),it=new ER(z,Et,ae,Ge),je=new PR(z,it,Et,ae),De=new AR(z,ne,_e),V=new mR(ue),ut=new ZR(v,Re,Le,Z,ne,Ge,V),jt=new hL(v,ue),Wt=new $R,X=new iL(Z,ne),Ce=new cR(v,Re,K,je,c,a),me=new sL(v,je,ne),He=new dR(z,Z,ae,ne),Qe=new MR(z,Z,ae,ne),ae.programs=ut.programs,v.capabilities=ne,v.extensions=Z,v.properties=ue,v.renderLists=Wt,v.shadowMap=me,v.state=K,v.info=ae}gt();let We=new Um(v,z);this.xr=We,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){let W=Z.get("WEBGL_lose_context");W&&W.loseContext()},this.forceContextRestore=function(){let W=Z.get("WEBGL_lose_context");W&&W.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(W){W!==void 0&&(A=W,this.setSize(E,P,!1))},this.getSize=function(W){return W.set(E,P)},this.setSize=function(W,q,te){if(We.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=W,P=q,e.width=Math.floor(W*A),e.height=Math.floor(q*A),te!==!1&&(e.style.width=W+"px",e.style.height=q+"px"),this.setViewport(0,0,W,q)},this.getDrawingBufferSize=function(W){return W.set(E*A,P*A).floor()},this.setDrawingBufferSize=function(W,q,te){E=W,P=q,A=te,e.width=Math.floor(W*te),e.height=Math.floor(q*te),this.setViewport(0,0,W,q)},this.getCurrentViewport=function(W){return W.copy(w)},this.getViewport=function(W){return W.copy(I)},this.setViewport=function(W,q,te,Q){W.isVector4?I.set(W.x,W.y,W.z,W.w):I.set(W,q,te,Q),K.viewport(w.copy(I).multiplyScalar(A).floor())},this.getScissor=function(W){return W.copy(L)},this.setScissor=function(W,q,te,Q){W.isVector4?L.set(W.x,W.y,W.z,W.w):L.set(W,q,te,Q),K.scissor(M.copy(L).multiplyScalar(A).floor())},this.getScissorTest=function(){return T},this.setScissorTest=function(W){K.setScissorTest(T=W)},this.setOpaqueSort=function(W){R=W},this.setTransparentSort=function(W){k=W},this.getClearColor=function(W){return W.copy(Ce.getClearColor())},this.setClearColor=function(){Ce.setClearColor.apply(Ce,arguments)},this.getClearAlpha=function(){return Ce.getClearAlpha()},this.setClearAlpha=function(){Ce.setClearAlpha.apply(Ce,arguments)},this.clear=function(W=!0,q=!0,te=!0){let Q=0;W&&(Q|=z.COLOR_BUFFER_BIT),q&&(Q|=z.DEPTH_BUFFER_BIT),te&&(Q|=z.STENCIL_BUFFER_BIT),z.clear(Q)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",H,!1),e.removeEventListener("webglcontextrestored",pe,!1),Wt.dispose(),X.dispose(),ue.dispose(),Re.dispose(),Le.dispose(),je.dispose(),Ge.dispose(),ut.dispose(),We.dispose(),We.removeEventListener("sessionstart",Ot),We.removeEventListener("sessionend",Ct),B&&(B.dispose(),B=null),$i.stop()};function H(W){W.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let W=ae.autoReset,q=me.enabled,te=me.autoUpdate,Q=me.needsUpdate,ee=me.type;gt(),ae.autoReset=W,me.enabled=q,me.autoUpdate=te,me.needsUpdate=Q,me.type=ee}function we(W){let q=W.target;q.removeEventListener("dispose",we),Ue(q)}function Ue(W){Ie(W),ue.remove(W)}function Ie(W){let q=ue.get(W).programs;q!==void 0&&(q.forEach(function(te){ut.releaseProgram(te)}),W.isShaderMaterial&&ut.releaseShaderCache(W))}let Ze=0;this.renderBufferDirect=function(W,q,te,Q,ee,ye){if(q===null&&(q=re),te.isFilament){if(ye.count===0)return;let Se=ye.sx?ye.sx:0,Fe=ye.sy?ye.sy:0,st=ye.sz?ye.sz:0,mt=ye.sw?ye.sw:0,Ut=Q.uniforms.splitPos.value;(Ut[0]!==Se||Ut[1]!==Fe||Ut[2]!==st||Ut[3]!==mt)&&(Q.uniformsNeedUpdate=!0,Ut[0]=Se,Ut[1]=Fe,Ut[2]=st,Ut[3]=mt)}let ce=ee.isMesh&&ee.matrixWorld.determinant()<0,Pe=em(W,q,te,Q,ee);K.setMaterial(Q,ce);let ke=te.index,ct=te.attributes.position;if(ke===null){if(ct===void 0||ct.count===0)return}else if(ke.count===0)return;let Xe=1;Q.wireframe===!0&&(ke=it.getWireframeAttribute(te),Xe=2),Ge.setup(ee,Q,Pe,te,ke);let Ke,nt=He;ke!==null&&(Ke=Et.get(ke),nt=Qe,nt.setIndex(Ke));let ot=ke!==null?ke.count:ct.count,lt=te.drawRange.start*Xe,Je=te.drawRange.count*Xe,oi=ye!==null?ye.start*Xe:0,xt=ye!==null?ye.count*Xe:1/0,be=Math.max(lt,oi),le=Math.min(ot,lt+Je,oi+xt)-1;te.isFilament&&(be=lt,le=lt+Je-1);let xe=Math.max(0,le-be+1);if(!(xe<=0)){if(ee.isMesh)Q.wireframe===!0?(K.setLineWidth(Q.wireframeLinewidth*N()),nt.setMode(z.LINES)):nt.setMode(z.TRIANGLES);else if(ee.isLine){let Se=Q.linewidth;Se===void 0&&(Se=1),K.setLineWidth(Se*N()),ee.isLineSegments?nt.setMode(z.LINES):ee.isLineLoop?nt.setMode(z.LINE_LOOP):nt.setMode(z.LINE_STRIP)}else ee.isPoints?nt.setMode(z.POINTS):ee.isSprite&&nt.setMode(z.TRIANGLES);if(ee.isInstancedMesh)nt.renderInstances(be,xe,ee.count);else if(te.isInstancedBufferGeometry){let Se=Math.min(te.instanceCount,te._maxInstanceCount);te.isFilament&&(Se=xt),Se>0&&nt.renderInstances(be,xe,Se)}else nt.render(be,xe)}},this.compile=function(W,q){d=X.get(W),d.init(),p.push(d),W.traverseVisible(function(te){te.isLight&&te.layers.test(q.layers)&&(d.pushLight(te),te.castShadow&&d.pushShadow(te))}),d.setupLights(v.physicallyCorrectLights),W.traverse(function(te){let Q=te.material;if(Q)if(Array.isArray(Q))for(let ee=0;ee<Q.length;ee++){let ye=Q[ee];Ll(ye,W,te)}else Ll(Q,W,te)}),p.pop(),d=null};let Ee=null;function ft(W){Ee&&Ee(W)}function Ot(){$i.stop()}function Ct(){$i.start()}let $i=new wm;$i.setAnimationLoop(ft),typeof self!="undefined"&&$i.setContext(self),this.setAnimationLoop=function(W){Ee=W,We.setAnimationLoop(W),W===null?$i.stop():$i.start()},We.addEventListener("sessionstart",Ot),We.addEventListener("sessionend",Ct),this.render=function(W,q){if(q!==void 0&&q.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;W.autoUpdate===!0&&W.updateMatrixWorld(),q.parent===null&&q.updateMatrixWorld(),We.enabled===!0&&We.isPresenting===!0&&(We.cameraAutoUpdate===!0&&We.updateCamera(q),q=We.getCamera()),W.isScene===!0&&W.onBeforeRender(v,W,q,b),d=X.get(W,p.length),d.init(),p.push(d),U.multiplyMatrices(q.projectionMatrix,q.matrixWorldInverse),O.setFromProjectionMatrix(U),F=this.localClippingEnabled,D=V.init(this.clippingPlanes,F,q),f=Wt.get(W,m.length),f.init(),m.push(f),ln(W,q,0,v.sortObjects),f.finish(),v.sortObjects===!0&&f.sort(R,k),D===!0&&V.beginShadows();let te=d.state.shadowsArray;if(me.render(te,W,q),D===!0&&V.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ce.render(f,W),d.setupLights(v.physicallyCorrectLights),q.isArrayCamera){let Q=q.cameras;for(let ee=0,ye=Q.length;ee<ye;ee++){let ce=Q[ee];Tu(f,W,ce,ce.viewport)}}else Tu(f,W,q);b!==null&&(_e.updateMultisampleRenderTarget(b),_e.updateRenderTargetMipmap(b)),W.isScene===!0&&W.onAfterRender(v,W,q),Ge.resetDefaultState(),y=-1,S=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,m.pop(),m.length>0?f=m[m.length-1]:f=null};function ln(W,q,te,Q){if(W.visible===!1)return;if(W.layers.test(q.layers)){if(W.isGroup)te=W.renderOrder;else if(W.isLOD)W.autoUpdate===!0&&W.update(q);else if(W.isLight)d.pushLight(W),W.castShadow&&d.pushShadow(W);else if(W.isSprite){if(!W.frustumCulled||O.intersectsSprite(W)){Q&&Y.setFromMatrixPosition(W.matrixWorld).applyMatrix4(U);let ce=je.update(W),Pe=W.material;Pe.visible&&f.push(W,ce,Pe,te,Y.z,null)}}else if((W.isMesh||W.isLine||W.isPoints)&&(W.isSkinnedMesh&&W.skeleton.frame!==ae.render.frame&&(W.skeleton.update(),W.skeleton.frame=ae.render.frame),!W.frustumCulled||O.intersectsObject(W))){Q&&Y.setFromMatrixPosition(W.matrixWorld).applyMatrix4(U);let ce=je.update(W),Pe=W.material;if(Array.isArray(Pe)){let ke=ce.groups;for(let ct=0,Xe=ke.length;ct<Xe;ct++){let Ke=ke[ct],nt=Pe[Ke.materialIndex];nt&&nt.visible&&f.push(W,ce,nt,te,Y.z,Ke)}}else Pe.visible&&f.push(W,ce,Pe,te,Y.z,null)}}let ye=W.children;for(let ce=0,Pe=ye.length;ce<Pe;ce++)ln(ye[ce],q,te,Q)}function Tu(W,q,te,Q){let ee=W.opaque,ye=W.transmissive,ce=W.transparent;d.setupLightsView(te),ye.length>0&&wT(ee,q,te),Q&&K.viewport(w.copy(Q)),ee.length>0&&Au(ee,q,te),ye.length>0&&Au(ye,q,te),ce.length>0&&Au(ce,q,te),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function wT(W,q,te){let Q=ne.isWebGL2;B===null&&(B=new pr(1,1,{generateMipmaps:!0,type:de.convert(Es)!==null?Es:Rn,minFilter:No,samples:Q&&o===!0?4:0})),v.getDrawingBufferSize(G),Q?B.setSize(G.x,G.y):B.setSize(Nu(G.x),Nu(G.y));let ee=v.getRenderTarget();v.setRenderTarget(B),v.clear();let ye=v.toneMapping;v.toneMapping=qr,Au(W,q,te),v.toneMapping=ye,_e.updateMultisampleRenderTarget(B),_e.updateRenderTargetMipmap(B),v.setRenderTarget(ee)}function Au(W,q,te){let Q=q.isScene===!0?q.overrideMaterial:null;for(let ee=0,ye=W.length;ee<ye;ee++){let ce=W[ee],Pe=ce.object,ke=ce.geometry,ct=Q===null?ce.material:Q,Xe=ce.group;Pe.layers.test(te.layers)&&$p(Pe,q,te,ke,ct,Xe)}}function $p(W,q,te,Q,ee,ye){W.onBeforeRender(v,q,te,Q,ee,ye),W.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,W.matrixWorld),W.normalMatrix.getNormalMatrix(W.modelViewMatrix),ee.onBeforeRender(v,q,te,Q,W,ye),ee.transparent===!0&&ee.side===qt?(ee.side=Li,ee.needsUpdate=!0,v.renderBufferDirect(te,q,Q,ee,W,ye),ee.side=xi,ee.needsUpdate=!0,v.renderBufferDirect(te,q,Q,ee,W,ye),ee.side=qt):v.renderBufferDirect(te,q,Q,ee,W,ye),W.onAfterRender(v,q,te,Q,ee,ye)}function Ll(W,q,te){q.isScene!==!0&&(q=re);let Q=ue.get(W),ee=d.state.lights,ye=d.state.shadowsArray,ce=ee.state.version,Pe=ut.getParameters(W,ee.state,ye,q,te),ke=ut.getProgramCacheKey(Pe),ct=Q.programs;Q.environment=W.isMeshStandardMaterial?q.environment:null,Q.fog=q.fog,Q.envMap=(W.isMeshStandardMaterial?Le:Re).get(W.envMap||Q.environment),ct===void 0&&(W.addEventListener("dispose",we),ct=new Map,Q.programs=ct);let Xe=ct.get(ke);if(Xe!==void 0){if(Q.currentProgram===Xe&&Q.lightsStateVersion===ce)return Pu(W,Pe),Xe}else Pe.uniforms=ut.getUniforms(W),W.onBuild(te,Pe,v),W.onBeforeCompile(Pe,v),Xe=ut.acquireProgram(Pe,ke),ct.set(ke,Xe),Q.uniforms=Pe.uniforms;let Ke=Q.uniforms;(!W.isShaderMaterial&&!W.isRawShaderMaterial||W.clipping===!0)&&(Ke.clippingPlanes=V.uniform),Pu(W,Pe),Q.needsLights=at(W),Q.lightsStateVersion=ce,Q.needsLights&&(Ke.ambientLightColor.value=ee.state.ambient,Ke.lightProbe.value=ee.state.probe,Ke.directionalLights.value=ee.state.directional,Ke.directionalLightShadows.value=ee.state.directionalShadow,Ke.spotLights.value=ee.state.spot,Ke.spotLightShadows.value=ee.state.spotShadow,Ke.rectAreaLights.value=ee.state.rectArea,Ke.ltc_1.value=ee.state.rectAreaLTC1,Ke.ltc_2.value=ee.state.rectAreaLTC2,Ke.pointLights.value=ee.state.point,Ke.pointLightShadows.value=ee.state.pointShadow,Ke.hemisphereLights.value=ee.state.hemi,Ke.directionalShadowMap.value=ee.state.directionalShadowMap,Ke.directionalShadowMatrix.value=ee.state.directionalShadowMatrix,Ke.spotShadowMap.value=ee.state.spotShadowMap,Ke.spotShadowMatrix.value=ee.state.spotShadowMatrix,Ke.pointShadowMap.value=ee.state.pointShadowMap,Ke.pointShadowMatrix.value=ee.state.pointShadowMatrix);let nt=Xe.getUniforms(),ot=Rs.seqWithValue(nt.seq,Ke);return Q.currentProgram=Xe,Q.uniformsList=ot,Xe}function Pu(W,q){let te=ue.get(W);te.outputEncoding=q.outputEncoding,te.instancing=q.instancing,te.skinning=q.skinning,te.morphTargets=q.morphTargets,te.morphNormals=q.morphNormals,te.morphColors=q.morphColors,te.morphTargetsCount=q.morphTargetsCount,te.numClippingPlanes=q.numClippingPlanes,te.numIntersection=q.numClipIntersection,te.vertexAlphas=q.vertexAlphas,te.vertexTangents=q.vertexTangents,te.toneMapping=q.toneMapping}function em(W,q,te,Q,ee){q.isScene!==!0&&(q=re),_e.resetTextureUnits();let ye=q.fog,ce=Q.isMeshStandardMaterial?q.environment:null,Pe=b===null?v.outputEncoding:b.isXRRenderTarget===!0?b.texture.encoding:Er,ke=(Q.isMeshStandardMaterial?Le:Re).get(Q.envMap||ce),ct=Q.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,Xe=!!Q.normalMap&&!!te.attributes.tangent,Ke=!!te.morphAttributes.position,nt=!!te.morphAttributes.normal,ot=!!te.morphAttributes.color,lt=Q.toneMapped?v.toneMapping:qr,Je=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,oi=Je!==void 0?Je.length:0,xt=ue.get(Q),be=d.state.lights;if(D===!0&&(F===!0||W!==S)){let Ci=W===S&&Q.id===y;V.setState(Q,W,Ci)}let le=!1;Q.version===xt.__version?(xt.needsLights&&xt.lightsStateVersion!==be.state.version||xt.outputEncoding!==Pe||ee.isInstancedMesh&&xt.instancing===!1||!ee.isInstancedMesh&&xt.instancing===!0||ee.isSkinnedMesh&&xt.skinning===!1||!ee.isSkinnedMesh&&xt.skinning===!0||xt.envMap!==ke||Q.fog&&xt.fog!==ye||xt.numClippingPlanes!==void 0&&(xt.numClippingPlanes!==V.numPlanes||xt.numIntersection!==V.numIntersection)||xt.vertexAlphas!==ct||xt.vertexTangents!==Xe||xt.morphTargets!==Ke||xt.morphNormals!==nt||xt.morphColors!==ot||xt.toneMapping!==lt||ne.isWebGL2===!0&&xt.morphTargetsCount!==oi)&&(le=!0):(le=!0,xt.__version=Q.version);let xe=xt.currentProgram;le===!0&&(xe=Ll(Q,q,ee));let Se=!1,Fe=!1,st=!1,mt=xe.getUniforms(),Ut=xt.uniforms;if(K.useProgram(xe.program)&&(Se=!0,Fe=!0,st=!0),Q.id!==y&&(y=Q.id,Fe=!0),Se||S!==W){if(mt.setValue(z,"projectionMatrix",W.projectionMatrix),ne.logarithmicDepthBuffer&&mt.setValue(z,"logDepthBufFC",2/(Math.log(W.far+1)/Math.LN2)),S!==W&&(S=W,Fe=!0,st=!0),Q.isShaderMaterial||Q.isMeshPhongMaterial||Q.isMeshToonMaterial||Q.isMeshStandardMaterial||Q.envMap){let Ci=mt.map.cameraPosition;Ci!==void 0&&Ci.setValue(z,Y.setFromMatrixPosition(W.matrixWorld))}(Q.isMeshPhongMaterial||Q.isMeshToonMaterial||Q.isMeshLambertMaterial||Q.isMeshBasicMaterial||Q.isMeshStandardMaterial||Q.isShaderMaterial)&&mt.setValue(z,"isOrthographic",W.isOrthographicCamera===!0),(Q.isMeshPhongMaterial||Q.isMeshToonMaterial||Q.isMeshLambertMaterial||Q.isMeshBasicMaterial||Q.isMeshStandardMaterial||Q.isShaderMaterial||Q.isShadowMaterial||ee.isSkinnedMesh)&&mt.setValue(z,"viewMatrix",W.matrixWorldInverse)}if(ee.isSkinnedMesh){mt.setOptional(z,ee,"bindMatrix"),mt.setOptional(z,ee,"bindMatrixInverse");let Ci=ee.skeleton;Ci&&(ne.floatVertexTextures?(Ci.boneTexture===null&&Ci.computeBoneTexture(),mt.setValue(z,"boneTexture",Ci.boneTexture,_e),mt.setValue(z,"boneTextureSize",Ci.boneTextureSize)):mt.setOptional(z,Ci,"boneMatrices"))}let ar=te.morphAttributes;return(ar.position!==void 0||ar.normal!==void 0||ar.color!==void 0&&ne.isWebGL2===!0)&&De.update(ee,te,Q,xe),(Fe||xt.receiveShadow!==ee.receiveShadow)&&(xt.receiveShadow=ee.receiveShadow,mt.setValue(z,"receiveShadow",ee.receiveShadow)),Fe&&(mt.setValue(z,"toneMappingExposure",v.toneMappingExposure),xt.needsLights&&se(Ut,st),ye&&Q.fog&&jt.refreshFogUniforms(Ut,ye),jt.refreshMaterialUniforms(Ut,Q,A,P,B),Rs.upload(z,xt.uniformsList,Ut,_e)),Q.isShaderMaterial&&Q.uniformsNeedUpdate===!0&&(Rs.upload(z,xt.uniformsList,Ut,_e),Q.uniformsNeedUpdate=!1),Q.isSpriteMaterial&&mt.setValue(z,"center",ee.center),mt.setValue(z,"modelViewMatrix",ee.modelViewMatrix),mt.setValue(z,"normalMatrix",ee.normalMatrix),mt.setValue(z,"modelMatrix",ee.matrixWorld),xe}function se(W,q){W.ambientLightColor.needsUpdate=q,W.lightProbe.needsUpdate=q,W.directionalLights.needsUpdate=q,W.directionalLightShadows.needsUpdate=q,W.pointLights.needsUpdate=q,W.pointLightShadows.needsUpdate=q,W.spotLights.needsUpdate=q,W.spotLightShadows.needsUpdate=q,W.rectAreaLights.needsUpdate=q,W.hemisphereLights.needsUpdate=q}function at(W){return W.isMeshLambertMaterial||W.isMeshToonMaterial||W.isMeshPhongMaterial||W.isMeshStandardMaterial||W.isShadowMaterial||W.isShaderMaterial&&W.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(W,q,te){ue.get(W.texture).__webglTexture=q,ue.get(W.depthTexture).__webglTexture=te;let Q=ue.get(W);Q.__hasExternalTextures=!0,Q.__hasExternalTextures&&(Q.__autoAllocateDepthBuffer=te===void 0,Q.__autoAllocateDepthBuffer||Z.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Q.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(W,q){let te=ue.get(W);te.__webglFramebuffer=q,te.__useDefaultFramebuffer=q===void 0},this.setRenderTarget=function(W,q=0,te=0){b=W,_=q,x=te;let Q=!0;if(W){let ke=ue.get(W);ke.__useDefaultFramebuffer!==void 0?(K.bindFramebuffer(z.FRAMEBUFFER,null),Q=!1):ke.__webglFramebuffer===void 0?_e.setupRenderTarget(W):ke.__hasExternalTextures&&_e.rebindTextures(W,ue.get(W.texture).__webglTexture,ue.get(W.depthTexture).__webglTexture)}let ee=null,ye=!1,ce=!1;if(W){let ke=W.texture;(ke.isData3DTexture||ke.isDataArrayTexture)&&(ce=!0);let ct=ue.get(W).__webglFramebuffer;W.isWebGLCubeRenderTarget?(ee=ct[q],ye=!0):ne.isWebGL2&&W.samples>0&&_e.useMultisampledRTT(W)===!1?ee=ue.get(W).__webglMultisampledFramebuffer:ee=ct,w.copy(W.viewport),M.copy(W.scissor),C=W.scissorTest}else w.copy(I).multiplyScalar(A).floor(),M.copy(L).multiplyScalar(A).floor(),C=T;if(K.bindFramebuffer(z.FRAMEBUFFER,ee)&&ne.drawBuffers&&Q&&K.drawBuffers(W,ee),K.viewport(w),K.scissor(M),K.setScissorTest(C),ye){let ke=ue.get(W.texture);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+q,ke.__webglTexture,te)}else if(ce){let ke=ue.get(W.texture),ct=q||0;z.framebufferTextureLayer(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,ke.__webglTexture,te||0,ct)}y=-1},this.readRenderTargetPixels=function(W,q,te,Q,ee,ye,ce){if(!(W&&W.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Pe=ue.get(W).__webglFramebuffer;if(W.isWebGLCubeRenderTarget&&ce!==void 0&&(Pe=Pe[ce]),Pe){K.bindFramebuffer(z.FRAMEBUFFER,Pe);try{let ke=W.texture,ct=ke.format,Xe=ke.type;if(ct!==er&&de.convert(ct)!==z.getParameter(z.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ke=Xe===Es&&(Z.has("EXT_color_buffer_half_float")||ne.isWebGL2&&Z.has("EXT_color_buffer_float"));if(Xe!==Rn&&de.convert(Xe)!==z.getParameter(z.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Xe===Jn&&(ne.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float")))&&!Ke){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z.checkFramebufferStatus(z.FRAMEBUFFER)===z.FRAMEBUFFER_COMPLETE?q>=0&&q<=W.width-Q&&te>=0&&te<=W.height-ee&&z.readPixels(q,te,Q,ee,de.convert(ct),de.convert(Xe),ye):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let ke=b!==null?ue.get(b).__webglFramebuffer:null;K.bindFramebuffer(z.FRAMEBUFFER,ke)}}},this.copyFramebufferToTexture=function(W,q,te=0){if(q.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}let Q=Math.pow(2,-te),ee=Math.floor(q.image.width*Q),ye=Math.floor(q.image.height*Q);_e.setTexture2D(q,0),z.copyTexSubImage2D(z.TEXTURE_2D,te,0,0,W.x,W.y,ee,ye),K.unbindTexture()},this.copyTextureToTexture=function(W,q,te,Q=0){let ee=q.image.width,ye=q.image.height,ce=de.convert(te.format),Pe=de.convert(te.type);_e.setTexture2D(te,0),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,te.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,te.unpackAlignment),q.isDataTexture?z.texSubImage2D(z.TEXTURE_2D,Q,W.x,W.y,ee,ye,ce,Pe,q.image.data):q.isCompressedTexture?z.compressedTexSubImage2D(z.TEXTURE_2D,Q,W.x,W.y,q.mipmaps[0].width,q.mipmaps[0].height,ce,q.mipmaps[0].data):z.texSubImage2D(z.TEXTURE_2D,Q,W.x,W.y,ce,Pe,q.image),Q===0&&te.generateMipmaps&&z.generateMipmap(z.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(W,q,te,Q,ee=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let ye=W.max.x-W.min.x+1,ce=W.max.y-W.min.y+1,Pe=W.max.z-W.min.z+1,ke=de.convert(Q.format),ct=de.convert(Q.type),Xe;if(Q.isData3DTexture)_e.setTexture3D(Q,0),Xe=z.TEXTURE_3D;else if(Q.isDataArrayTexture)_e.setTexture2DArray(Q,0),Xe=z.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,Q.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,Q.unpackAlignment);let Ke=z.getParameter(z.UNPACK_ROW_LENGTH),nt=z.getParameter(z.UNPACK_IMAGE_HEIGHT),ot=z.getParameter(z.UNPACK_SKIP_PIXELS),lt=z.getParameter(z.UNPACK_SKIP_ROWS),Je=z.getParameter(z.UNPACK_SKIP_IMAGES),oi=te.isCompressedTexture?te.mipmaps[0]:te.image;z.pixelStorei(z.UNPACK_ROW_LENGTH,oi.width),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,oi.height),z.pixelStorei(z.UNPACK_SKIP_PIXELS,W.min.x),z.pixelStorei(z.UNPACK_SKIP_ROWS,W.min.y),z.pixelStorei(z.UNPACK_SKIP_IMAGES,W.min.z),te.isDataTexture||te.isData3DTexture?z.texSubImage3D(Xe,ee,q.x,q.y,q.z,ye,ce,Pe,ke,ct,oi.data):te.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),z.compressedTexSubImage3D(Xe,ee,q.x,q.y,q.z,ye,ce,Pe,ke,oi.data)):z.texSubImage3D(Xe,ee,q.x,q.y,q.z,ye,ce,Pe,ke,ct,oi),z.pixelStorei(z.UNPACK_ROW_LENGTH,Ke),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,nt),z.pixelStorei(z.UNPACK_SKIP_PIXELS,ot),z.pixelStorei(z.UNPACK_SKIP_ROWS,lt),z.pixelStorei(z.UNPACK_SKIP_IMAGES,Je),ee===0&&Q.generateMipmaps&&z.generateMipmap(Xe),K.unbindTexture()},this.initTexture=function(W){_e.setTexture2D(W,0),K.unbindTexture()},this.resetState=function(){_=0,x=0,b=null,K.reset(),Ge.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}yv.prototype.isWebGLRenderer=!0;Vt.prototype.toVector3=function(){return new j(this.x/this.w,this.y/this.w,this.z/this.w)};j.prototype.toVector4=function(){return new Vt(this.x,this.y,this.z,1)};j.prototype.toArray=function(){return[this.x,this.y,this.z]};dt.prototype.lookAt2=function(){let t=new j,e=new j,i=new j;return function(r,n,o){let a=this.elements;return i.subVectors(r,n).normalize(),i.length()===0&&(i.z=1),t.crossVectors(o,i).normalize(),t.length()===0&&(i.x+=1e-4,t.crossVectors(o,i).normalize()),e.crossVectors(i,t),a[0]=t.x,a[4]=t.y,a[8]=t.z,a[1]=e.x,a[5]=e.y,a[9]=e.z,a[2]=i.x,a[6]=i.y,a[10]=i.z,a[12]=-(t.x*r.x+t.y*r.y+t.z*r.z),a[13]=-(e.x*r.x+e.y*r.y+e.z*r.z),a[14]=-(i.x*r.x+i.y*r.y+i.z*r.z),a[15]=1,this}}();var cS=class{constructor(){this.disposables=new Set}add(e){return e.dispose&&this.disposables.add(e),e}remove(e,i){e.dispose&&((i===!0||i===void 0)&&e.dispose(),this.disposables.delete(e))}dispose(){for(let e of this.disposables)e.dispose();this.disposables.clear()}};function qh(t,e,i,r,n,o){n===void 0&&(n=!0),this.tracker=new cS,this.withShadows=n;let a=!1,l=e?i.printerConfig[e]:!1,h=l?l.shape:void 0,u=r?$(r):!1,c=!1,f=$(".axis",t),d={x:0,y:0};this.mouse=d,this.renderCallback=!1,this.clickCallback=!1,this.unclickCallback=!1,this.doRaycasts=!1,this.ray=new Vm,this.textMaterials={};function m(se){return parseInt("0x"+se.substring(1))}this.makeMaterialWithText=function(se){let at=se+"-"+i.theme;if(this.textMaterials[at])return this.textMaterials[at];let W=document.createElement("canvas");W.height=64,W.width=256;let q=W.getContext("2d");q.font="64px Arial",q.textAlign="center",q.textBaseline="top",i.theme==="dark"?q.fillStyle="rgba(255,255,255,1)":q.fillStyle="rgba(0,0,0,1)",q.fillText(se,128,0);let te=new Di(W);te.needsUpdate=!0,this.tracker.add(te);let Q=new ki({map:te,side:qt,alphaTest:.05,transparent:!0});return this.tracker.add(Q),this.textMaterials[at]=Q,W=null,Q};let p=null,v=l!==!1?new Mi({color:m(h.gridColor),transparent:!0}):new Mi({color:m("#454545"),transparent:!0}),g=l!==!1?new Mi({color:m(h.gridColor),linewidth:2,transparent:!0}):new Mi({color:m("#454545"),linewidth:2,transparent:!0}),_=l!==!1?this.tracker.add(new ki({color:m(h.gridColor),depthFunc:Ss,transparent:!0,opacity:.7,side:qt})):this.tracker.add(new ki({color:m("#dddddd"),depthFunc:Ss,transparent:!0,opacity:.7,side:qt})),x=l!==!1?this.tracker.add(new ki({color:m(h.gridColor),depthFunc:Ss,transparent:!0,side:qt})):this.tracker.add(new ki({color:m("#dddddd"),depthFunc:Ss,transparent:!0,side:qt})),b=l!==!1?new ki({side:xi,color:m(l.shape.basicShape.color),transparent:!1}):new ki({side:xi,color:m("#cccccc"),transparent:!1});this.tracker.add(v),this.tracker.add(g),this.tracker.add(b),this.disposed=!1;let y=l!==!1?l.shape.basicShape:!1;this.isZBelt=y.shape==="zbelt";let S,w,M,C,E,P,A,R,k,I,L,T=t.width(),O=!1,D=0,F=Math.PI/2,B=-Math.PI/2,U=200,G=800,Y=!1,re=!1,N=null,z=null,ie=null,Z=null,ne=null,K=new Ei,ae=new Ei,ue=!0,_e=new Zo,Re=!0,Le=new Zo,Et=new Zo;this.scene=_e,this.scene2=Le,this.sceneBed=new Zo,this.sceneAxis=Et;let it=new j(0,0,0),je=null,ut=null,jt=!0;this.bedGroup=new Pr,this.bedGroup.renderOrder=-1,this.sceneBed.add(this.bedGroup),this.setSize=function(se,at,W){R=se,k=at,I=W,L=Math.sqrt(R*R+k*k+I*I)},this.setChanged=function(){Re=!0},this.setScene=function(se){_e=se,Re=!0},this.getScene=function(){return _e},this.setObjectsBBox=function(se){K=se.clone()},this.setPrinterBox=function(se){ae=se.clone()},this.addAxis=function(){gi.initialized.then(()=>{let se=gi.getGeometryHelper(),at=gi.getAxisMaterials(),W=at.x.clone(),q=at.y.clone(),te=at.z.clone();this.tracker.add(W),this.tracker.add(q),this.tracker.add(te);let Q=se.arrowX.clone(),ee=se.arrowY.clone(),ye=se.arrowZ.clone();this.tracker.add(Q),this.tracker.add(Q),this.tracker.add(Q),this.sceneAxis.add(new _t(Q,W)),this.sceneAxis.add(new _t(ee,q)),this.sceneAxis.add(new _t(ye,te)),this.setChanged()})};let Wt=()=>{if(this.disposed||!Re&&!O)return;if(c&&p.update(),O)switch(D){case 1:N.fov-=.2,N.fov<.1&&(N.fov=.1),N.updateProjectionMatrix();break;case 2:N.fov+=.2,N.fov>60&&(N.fov=60),N.updateProjectionMatrix();break;case 3:B+=.01,B>Math.PI&&(B-=2*Math.PI),this.orbit.rotateLeft(.01);break;case 4:B-=.01/3,B<-Math.PI&&(B+=2*Math.PI),this.orbit.rotateLeft(-.01/3);break;case 5:F-=.01;break;case 6:F+=.01;break}this.orbit.update();let se=new Ei;se.setFromObject(this.scene,!1),se.expandByObject(this.sceneBed,!1),se.expandByObject(this.scene2,!1),se.applyMatrix4(N.matrixWorldInverse),N.far=10-se.min.z,N.near=Math.max(1,-se.max.z),N.updateProjectionMatrix(),this.doRaycasts&&this.ray.setFromCamera(d,N);let at=!1;this.renderCallback!==!1&&this.renderCallback()===!0&&(at=!0),je.clear(),je.render(this.sceneBed,N),je.render(_e,N),Le.children.length>this.numLights&&(je.clearDepth(),je.render(Le,N)),ut&&(ne.position.copy(N.position),ne.position.sub(this.orbit.target),ne.position.setLength(150),ne.lookAt(Et.position),ne.updateProjectionMatrix(),ut.clear(),ut.render(Et,ne)),Re=at||O};this.toggleAnimate=se=>{O?this.stopAnimate():this.startAnimate(se)},this.stopAnimate=function(){O=!1},this.startAnimate=function(se){D=se,O=!0};let X=()=>{this.startAnimate(1)},V=()=>{this.startAnimate(2)},me=()=>{this.startAnimate(5)},Ce=()=>{this.startAnimate(6)},De=()=>{this.startAnimate(3)},He=()=>{this.startAnimate(4)},Qe=()=>{c&&(p=new Stats,p.setMode(0),p.domElement.style.position="absolute",p.domElement.style.left="0px",p.domElement.style.top="0px",t.append(p.domElement)),$(window).resize(de),u!==!1&&($(".btn",u).mouseout(()=>{this.stopAnimate()}),$(".btn",u).mouseup(()=>{this.stopAnimate()}),$(".zoomin",u).mousedown(X),$(".zoomout",u).mousedown(V),$(".up",t).mousedown(me),$(".down",t).mousedown(Ce),$(".left",t).mousedown(De),$(".right",t).mousedown(He),$(".orientLeft",u).click(()=>{this.orientLeft()}),$(".orientRight",u).click(()=>{this.orientRight()}),$(".orientTop",u).click(()=>{this.orientTop()}),$(".orientBottom",u).click(()=>{this.orientBottom()}),$(".orientFront",u).click(()=>{this.orientFront()}),$(".orientBack",u).click(()=>{this.orientBack()}),$(".orientIso",u).click(()=>{this.orientIsometric()}),$(".fitObjects",u).click(()=>{this.fitObjects()}),$(".fitPrinter",u).click(()=>{this.fitPrinter()})),je=new yv({canvas:$("canvas",t)[0],antialias:!1,powerPreference:"high-performance",sortObjects:!0,autoClear:!1,autoClearDepth:!1,autoClearStencil:!1}),je.setPixelRatio(window.devicePixelRatio),je.setSize(t.width(),t.height()),this.withShadows&&(je.shadowMap.enabled=!0,je.shadowMapSoft=!0,je.shadowMap.type=nm),je.autoClear=!1,window.rs.theme==="dark"?je.setClearColor(1710618,1):je.setClearColor(16777215,1),ut=new yv({canvas:$("canvas",f)[0],antialias:!0,alpha:!0,powerPreference:"high-performance",sortObjects:!0,autoClear:!1,autoClearDepth:!1,autoClearStencil:!1}),ut.setSize(f.width(),f.height()),f.append(ut.domElement),N=ie=new Fi(30,t.width()/t.height(),.1,3e3),N.up.set(0,0,1),N.position.set(0,-200,0),N.lookAt(new j(0,0,0)),ne=new Fi(30,1,.1,1e3),ne.up.set(0,0,1),o&&o.printerType===2&&(this.isZBelt=!0),this.isZBelt&&(N.up.set(0,1,0),ne.up.set(0,1,0)),this.tracker.add(ie),this.tracker.add(ne),this.camera=N,this.renderer=je,t.append(je.domElement),z=$(je.domElement),this.canvas=z,this.orbit=this.orbitPerspective=new Bt.OrbitControls(N,je.domElement),this.orbit.zoomSpeed=.5,this.orbit.zoomSpeed=.5,this.orbit.listenToKeyEvents(je.domElement),this.orbit.addEventListener("change",()=>{Re=!0}),this.tracker.add(this.orbitPerspective),Z=new co(t.width()/-2,t.width()/2,t.height()/2,t.height()/-2,.1,3e3),this.tracker.add(Z),Z.up.set(0,0,1),Z.position.set(0,1,200),Z.lookAt(new j(0,0,0)),this.orbitParallel=new Bt.OrbitControls(Z,je.domElement),this.orbitParallel.zoomSpeed=.5,this.orbitParallel.listenToKeyEvents(je.domElement),this.orbitParallel.addEventListener("change",()=>{Re=!0}),this.orbitParallel.enabled=!1,this.tracker.add(this.orbitParallel)};this.selectCamera=se=>{se?(N=ie,this.orbit=this.orbitPerspective,this.orbitParallel.enabled=!1,this.orbitPerspective.enabled=!0,jt=!0):(N=Z,this.orbit=this.orbitParallel,this.orbitParallel.enabled=!0,this.orbitPerspective.enabled=!1,jt=!1),this.setChanged()};let de=()=>{je&&(z.width(t.width()),z.height(t.height()),N.aspect=t.width()/t.height(),jt||(N.left=-N.aspect*N.top,N.right=N.aspect*N.top),N.updateProjectionMatrix(),je.setSize(t.width(),t.height()),Re=!0,setTimeout(()=>{je&&(z.width(t.width()),z.height(t.height()),N.aspect=t.width()/t.height(),jt||(N.left=-N.aspect*N.top,N.right=N.aspect*N.top),N.updateProjectionMatrix(),je.setSize(t.width(),t.height()),Re=!0)},300))};this.recursiveRemove=se=>{for(;se.children.length>0;)this.recursiveRemove(se.children[0]),se.remove(se.children[0]);Re=!0},this.disconnect=()=>{this.renderer.setAnimationLoop(null),this.disposed=!0,$(window).off("resize",de),t.off(),u!==!1&&u.off(),this.recursiveRemove(this.sceneBed),this.recursiveRemove(this.scene),this.recursiveRemove(this.scene2),this.recursiveRemove(this.sceneAxis),this.tracker.dispose(),je.forceContextLoss(),je.dispose(),ut.forceContextLoss(),ut.dispose(),this.orbit=null,this.canvas=null,je=null,ut=null,re=!0},this.refresh=function(){de()};let Ge,gt,We;function H(){return new Promise((se,at)=>{let W=new Image;h.imageExtension!=="png"?(W.onload=async()=>{(W.height===0||W.width===0)&&(console.warn("unknown image size - this svg is not supported"),at(new Error("unknown image size - this svg is not supported")));let q=document.createElement("canvas"),te=q.getContext("2d"),Q,ee,ye=gi.getMaxTextureSize(),ce=ye>4096?4096:ye;Ls&&ce>1024&&(ce=1024);let Pe=!1,ke=document.createElement("canvas");ke.width=1,ke.height=1;let ct=ke.getContext("2d");do{Q=q.width=ce,ee=q.height=Math.floor(ce*W.height/W.width),te.fillStyle="#818283",te.fillRect(Q-1,ee-1,1,1),ct.drawImage(q,Q-1,ee-1,1,1,0,0,1,1);let Ke=ct.getImageData(0,0,1,1).data;Pe=ce<1e3||ee<=ye&&Ke[3]!==0,Pe||(ce=ce/2)}while(!Pe);gt=Q,We=ee,te.clearRect(Q-1,Q-1,1,1),te.drawImage(W,0,0,Q,ee),ke.remove();let Xe=document.createElement("img");Xe.src=q.toDataURL(),q.remove(),q=null,se(Xe)},ui.get("/printer/bed/"+e+"/get_image?r="+Math.random()).then(q=>{if(q.status===200){let ee=new DOMParser().parseFromString(q.data,"text/xml").getElementsByTagName("svg")[0],ye=0,ce=0,Pe=q.data.match(/viewBox="(.*?)"/);if(Pe.length===2){let ke=Pe[1].split(" ");ke.length===4&&(ye=Number(ke[2]),ce=Number(ke[3]))}ye!==0&&ce!==0&&(ee.setAttribute("width",Math.floor(ye)+"px"),ee.setAttribute("height",Math.floor(ce)+"px")),W.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(ee))}else at()},()=>{at(new Error("Failed downloading image"))})):(W.onload=()=>{gt=W.width,We=W.height,se(W)},W.src="/printer/bed/"+e+"/get_image?r="+Math.random())})}let pe=async()=>{let se=await H();Ge=new Di,Ge.magFilter=ji,Ge.minFilter=iA,Ge.image=se,Ge.needsUpdate=!0,S=new ki({map:Ge,opacity:h.imageOpacity*.01,transparent:!0,side:xi,depthWrite:!1,depthFunc:Ss}),this.tracker.add(Ge),this.tracker.add(S)};this.addYLine=(se,at,W,q,te)=>{let Q=Math.min(W,q)-.5*te,ee=Math.max(W,q)+.5*te,ye=at-.5*te,ce=at+.5*te;se.push(ce,ee,this.zMin,ye,ee,this.zMin,ye,Q,this.zMin),se.push(ce,ee,this.zMin,ye,Q,this.zMin,ce,Q,this.zMin)},this.addXLine=(se,at,W,q,te)=>{let Q=Math.min(at,W)-.5*te,ee=Math.max(at,W)+.5*te;if(this.isZBelt){let ye=q-.5*te,ce=q+.5*te;se.push(ee,y.yMin,ce,Q,y.yMin,ce,Q,y.yMin,ye),se.push(ee,y.yMin,ce,Q,y.yMin,ye,ee,y.yMin,ye)}else{let ye=q-.5*te,ce=q+.5*te;se.push(ee,ce,this.zMin,Q,ce,this.zMin,Q,ye,this.zMin),se.push(ee,ce,this.zMin,Q,ye,this.zMin,ee,ye,this.zMin)}},this.addZLine=(se,at,W,q,te)=>{let Q=Math.min(W,q)-.5*te,ee=Math.max(W,q)+.5*te,ye=at-.5*te,ce=at+.5*te;se.push(ce,y.yMin,ee,ye,y.yMin,ee,ye,y.yMin,Q),se.push(ce,y.yMin,ee,ye,y.yMin,Q,ce,y.yMin,Q)},this.addSquareBed=se=>{this.bedGroup.clear(),se=Math.ceil(se/100)*100;let at=this.tracker.add(new Mr(se,se,10,10)),W=new _t(at,b);W.castShadow=!1,W.receiveShadow=!0,this.bedGroup.add(W);let q=se/2,te=10;q>1e3?(te=Math.floor(q/10),te=Math.floor(q/5)*5):q>300&&(te=25);let Q=te,ee=.01*Q,ye=.03*Q,ce=[],Pe=[];this.addXLine(Pe,-q,q,-q,ye),this.addXLine(Pe,-q,q,q,ye),this.addYLine(Pe,-q,-q,q,ye),this.addYLine(Pe,q,-q,q,ye),q=se/2;let ke=0;for(;ke<q;){let be=Math.round(ke/Q)%5==0;be?(this.addYLine(Pe,ke,-q,q,ye),this.addXLine(Pe,-q,q,ke,ye)):(this.addYLine(ce,ke,-q,q,ee),this.addXLine(ce,-q,q,ke,ee)),ke>0&&(be?(this.addYLine(Pe,-ke,-q,q,ye),this.addXLine(Pe,-q,q,-ke,ye)):(this.addYLine(ce,-ke,-q,q,ee),this.addXLine(ce,-q,q,-ke,ee))),ke+=Q}let ct=this.tracker.add(new pt);ct.setAttribute("position",new vt(new Float32Array(Pe),3));let Xe=new _t(ct,x);Xe.renderOrder=20,this.bedGroup.add(Xe);let Ke=this.tracker.add(new pt);Ke.setAttribute("position",new vt(new Float32Array(ce),3));let nt=new _t(Ke,_);nt.renderOrder=20,this.bedGroup.add(nt);let ot=3+.5*ye,lt=this.tracker.add(new Mr(4*ot,ot)),Je=(be,le,xe,Se)=>{let Fe=new _t(lt,be);Fe.position.set(le,xe,Se*.05),Fe.rotation.set(0,0,Se),this.bedGroup.add(Fe)};for(let be=0;be<=q;be+=te){let le=this.makeMaterialWithText(be);if(be!==0){let xe=this.makeMaterialWithText("-"+be);Je(xe,-be,-q-ot,0),Je(xe,-q-ot,-be,1.5*Math.PI),Je(xe,-be,q+ot,Math.PI),Je(xe,q+ot,-be,.5*Math.PI)}Je(le,be,-q-ot,0),Je(le,-q-ot,be,1.5*Math.PI),Je(le,be,q+ot,Math.PI),Je(le,q+ot,be,.5*Math.PI)}let oi=this.makeMaterialWithText("X"),xt=this.makeMaterialWithText("Y");Je(oi,0,-q-2.5*ot,0),Je(oi,0,q+2.5*ot,Math.PI),Je(xt,-q-2.5*ot,0,1.5*Math.PI),Je(xt,q+2.5*ot,0,.5*Math.PI)},this.addPrinter=()=>{this.bedGroup.clear();let se=i.printerConfig[e].movement,at=new pt;this.tracker.add(at),at.name="PrinterGeom";let W=new pt;this.tracker.add(W),W.name="printerGeomFat";let q=[],te=[],Q;this.zMin=se.zMin,this.zMax=se.zMax,this.isZBelt&&this.zMaxContent&&this.zMaxContent>this.zMax&&(this.zMax=this.zMaxContent),P=this.zMin,A=this.zMax,w=y.xMin,M=y.xMax,C=y.yMin,E=y.yMax;let ee=h.gridSpacing,ye=.01*ee,ce=.03*ee;K.makeEmpty(),K.expandByPoint(new j(w,C,P)),K.expandByPoint(new j(M,E,A)),R=M-w,k=E-C,I=A-P,L=Math.sqrt(R*R+k*k+I*I),U=2*L;let Pe,ke,ct,Xe,Ke,nt,ot=h.imageZoom*.01,lt=[],Je=[];if(this.isZBelt){Pe=new Mr(y.xMax-y.xMin,this.zMax,1,1),Pe.name="Bed plane",this.tracker.add(Pe),Q=new _t(Pe,b),Q.position.x=.5*(y.xMax+y.xMin),Q.position.y=y.yMin,Q.position.z=.5*this.zMax,Q.rotateX(-Math.PI*.5),this.addXLine(Je,y.xMin,y.xMax,this.zMin,ce),this.addXLine(Je,y.xMin,y.xMax,this.zMax,ce),this.addZLine(Je,y.xMin,this.zMin,this.zMax,ce),this.addZLine(Je,y.xMax,this.zMin,this.zMax,ce);let le=Math.sin(y.angle*Math.PI/180),xe=Math.cos(y.angle*Math.PI/180),Se=[new j(y.xMin,y.yMin,this.zMin),new j(y.xMax,y.yMin*le,this.zMin),new j(y.xMax,y.yMax*le,this.zMin+y.yMax*xe),new j(y.xMin,y.yMax*le,this.zMin+y.yMax*xe),new j(y.xMin,y.yMin*le,this.zMax),new j(y.xMax,y.yMin*le,this.zMax),new j(y.xMax,y.yMax*le,this.zMin+y.yMax*xe),new j(y.xMin,y.yMax*le,this.zMin+y.yMax*xe)];q.push(Se[0].x,Se[0].y,Se[0].z,Se[3].x,Se[3].y,Se[3].z,Se[4].x,Se[4].y,Se[4].z,Se[7].x,Se[7].y,Se[7].z,Se[5].x,Se[5].y,Se[5].z,Se[6].x,Se[6].y,Se[6].z,Se[1].x,Se[1].y,Se[1].z,Se[2].x,Se[2].y,Se[2].z,Se[3].x,Se[3].y,Se[3].z,Se[7].x,Se[7].y,Se[7].z,Se[7].x,Se[7].y,Se[7].z,Se[6].x,Se[6].y,Se[6].z,Se[6].x,Se[6].y,Se[6].z,Se[2].x,Se[2].y,Se[2].z,Se[2].x,Se[2].y,Se[2].z,Se[3].x,Se[3].y,Se[3].z),q.name="printerGeomPos";let Fe=Math.ceil(y.xMin/ee)*ee;for(;Fe<y.xMax;)parseInt(Fe/ee)%5==0?this.addZLine(Je,Fe,this.zMin,this.zMax,ce):this.addZLine(lt,Fe,this.zMin,this.zMax,ye),Fe+=ee;for(Fe=Math.ceil(this.zMin/ee)*ee;Fe<this.zMax;)parseInt(Fe/ee)%5==0?this.addXLine(Je,y.xMin,y.xMax,Fe,ce):this.addXLine(lt,y.xMin,y.xMax,Fe,ye),Fe+=ee;!S&&h.showImage&&pe().then(()=>{let st=I,mt=R,Ut=st/mt,ar=gt/We;Ut<ar?mt=st/ar:st=mt*ar;let Ci=new Mr(st*ot,mt*ot);this.tracker.add(Ci),Ci.name="Bed image",Ci.rotateZ(-Math.PI*.5),Ci.rotateX(-Math.PI*.5),Ci.translate(.5*(y.xMax+y.xMin),y.yMin,.5*(this.zMax+this.zMin));let kG=new _t(Ci,S);this.bedGroup.add(kG)})}else if(y.shape==="rectangle"){Pe=new Mr(y.xMax-y.xMin,y.yMax-y.yMin,1,1),Pe.name="Bed plane",this.tracker.add(Pe),Q=new _t(Pe,b),Q.position.x=.5*(y.xMax+y.xMin),Q.position.y=.5*(y.yMax+y.yMin),Q.position.z=P,this.addXLine(Je,y.xMin,y.xMax,y.yMin,ce),this.addXLine(Je,y.xMin,y.xMax,y.yMax,ce),this.addYLine(Je,y.xMin,y.yMin,y.yMax,ce),this.addYLine(Je,y.xMax,y.yMin,y.yMax,ce);let le=[new j(y.xMin,y.yMin,se.zMin),new j(y.xMax,y.yMin,se.zMin),new j(y.xMax,y.yMax,se.zMin),new j(y.xMin,y.yMax,se.zMin),new j(y.xMin,y.yMin,se.zMax),new j(y.xMax,y.yMin,se.zMax),new j(y.xMax,y.yMax,se.zMax),new j(y.xMin,y.yMax,se.zMax)];q.push(le[0].x,le[0].y,le[0].z,le[4].x,le[4].y,le[4].z,le[1].x,le[1].y,le[1].z,le[5].x,le[5].y,le[5].z,le[2].x,le[2].y,le[2].z,le[6].x,le[6].y,le[6].z,le[3].x,le[3].y,le[3].z,le[7].x,le[7].y,le[7].z,le[4].x,le[4].y,le[4].z,le[5].x,le[5].y,le[5].z,le[5].x,le[5].y,le[5].z,le[6].x,le[6].y,le[6].z,le[6].x,le[6].y,le[6].z,le[7].x,le[7].y,le[7].z,le[7].x,le[7].y,le[7].z,le[4].x,le[4].y,le[4].z),q.name="printerGeomPos";let xe=Math.ceil(y.xMin/ee)*ee;for(;xe<y.xMax;)parseInt(xe/ee)%5==0?this.addYLine(Je,xe,y.yMin,y.yMax,ce):this.addYLine(lt,xe,y.yMin,y.yMax,ye),xe+=ee;for(xe=Math.ceil(y.yMin/ee)*ee;xe<y.yMax;)parseInt(xe/ee)%5==0?this.addXLine(Je,y.xMin,y.xMax,xe,ce):this.addXLine(lt,y.xMin,y.xMax,xe,ye),xe+=ee;!S&&h.showImage&&pe().then(()=>{let Se=M-w,Fe=E-C,st=Se/Fe,mt=gt/We;st<mt?Fe=Se/mt:Se=Fe*mt;let Ut=new Mr(Se*ot,Fe*ot);this.tracker.add(Ut),Ut.name="Bed image",Ut.translate(.5*(y.xMax+y.xMin),.5*(y.yMax+y.yMin),se.zMin);let ar=new _t(Ut,S);this.bedGroup.add(ar)})}else{Pe=new ec(y.radius,64),this.tracker.add(Pe),Pe.name="Bed circle",Q=new _t(Pe,b),Q.position.x=y.x,Q.position.y=y.y,Q.position.z=P;let le=y.radius;for(let Fe=0;Fe<8;Fe++)nt=.25*Math.PI*Fe,Xe=Math.cos(nt)*le,Ke=Math.sin(nt)*le,q.push(Xe,Ke,P,Xe,Ke,A);for(let Fe=0;Fe<64;Fe++){nt=.0625*Math.PI*Fe*.5,Xe=Math.cos(nt)*(le-.5*ce),Ke=Math.sin(nt)*(le-.5*ce),ke=Math.cos(nt)*(le+.5*ce),ct=Math.sin(nt)*(le+.5*ce);let st=.0625*Math.PI*(Fe+1)*.5,mt=Math.cos(st)*(le-.5*ce),Ut=Math.sin(st)*(le-.5*ce),ar=Math.cos(st)*(le+.5*ce),Ci=Math.sin(st)*(le+.5*ce);Je.push(ke,ct,P,ar,Ci,P,mt,Ut,P,ke,ct,P,mt,Ut,P,Xe,Ke,P),Je.push(ke,ct,A,ar,Ci,A,mt,Ut,A,ke,ct,A,mt,Ut,A,Xe,Ke,A)}!S&&h.showImage&&pe().then(()=>{let Fe=2*y.radius,st=2*y.radius,mt=gt/We;1<mt?st=Fe/mt:st=st*mt;let Ut=new Mr(Fe*ot,st*ot);this.tracker.add(Ut),Ut.name="Bed image",Ut.translate(0,0,se.zMin);let ar=new _t(Ut,S);this.bedGroup.add(ar)});let xe=ee,Se=Math.max(Math.abs(y.x-y.radius),Math.abs(y.x+y.radius),Math.abs(y.y-y.radius),Math.abs(y.y+y.radius));if(parseFloat(ee)>=1){0>y.yMin&&0<y.yMax&&this.addXLine(Je,y.x-y.radius,y.x+y.radius,0,ce),0>y.xMin&&0<y.xMax&&this.addYLine(Je,0,y.y-y.radius,y.y+y.radius,ce);let Fe,st;for(;xe<Se;){let mt=parseInt(xe/ee)%5==0;xe>y.yMin&&xe<y.yMax&&(Fe=Math.asin((-xe-y.y)/le),st=le*Math.cos(Fe),mt?this.addXLine(Je,y.x-st,y.x+st,y.y-xe,ce):this.addXLine(lt,y.x-st,y.x+st,y.y-xe,ye)),xe>y.xMin&&xe<y.xMax&&(Fe=Math.asin((xe-y.x)/le),st=le*Math.cos(Fe),mt?this.addYLine(Je,y.x+xe,y.y-st,y.y+st,ce):this.addYLine(lt,y.x+xe,y.y-st,y.y+st,ye)),xe!==0&&(-xe>y.yMin&&-xe<y.yMax&&(Fe=Math.asin((xe-y.y)/le),st=le*Math.cos(Fe),mt?this.addXLine(Je,y.x-st,y.x+st,y.y+xe,ce):this.addXLine(lt,y.x-st,y.x+st,y.y+xe,ye)),-xe>y.xMin&&-xe<y.xMax&&(Fe=Math.asin((-xe-y.x)/le),st=le*Math.cos(Fe),mt?this.addYLine(Je,y.x-xe,y.y-st,y.y+st,ce):this.addYLine(lt,y.x-xe,y.y-st,y.y+st,ye))),xe+=ee}}}Q.receiveShadow=this.withShadows,this.bedGroup.add(Q),at.setAttribute("position",new kt(q,3));let oi=new Zr(at,v);if(oi.renderOrder=10,oi.castShadow=!1,this.bedGroup.add(oi),te.length>0){W.setAttribute("position",new kt(te,3));let le=new Zr(W,g);le.castShadow=!1,this.bedGroup.add(le)}this.printerTriSmallGeom=this.tracker.add(new pt),this.printerTriSmallGeom.setAttribute("position",new vt(new Float32Array(Je),3));let xt=new _t(this.printerTriSmallGeom,x);xt.renderOrder=20,xt.translateZ(P),this.bedGroup.add(xt),this.printerTriSmallGeom=this.tracker.add(new pt),this.printerTriSmallGeom.setAttribute("position",new vt(new Float32Array(lt),3));let be=new _t(this.printerTriSmallGeom,_);be.translateZ(P),be.renderOrder=20,this.bedGroup.add(be),ue&&(K.getCenter(it),K.getCenter(this.orbit.target),G=U=4*L,ae=K.clone(),this.orientIsometric(),this.fitBoundingBox(K)),ue=!1,Re=!0},this.addProject=se=>{this.bedGroup.clear();let at=new pt;this.tracker.add(at),at.name="PrinterGeom";let W=new pt;this.tracker.add(W),W.name="printerGeomFat";let q=[],te=[],Q;this.zMin=se.zMin,this.zMax=se.zMax+20,this.isZBelt=se.printerType===2,y={xMin:se.xMin-20,xMax:se.xMax+20,yMin:this.isZBelt?se.yMin:se.yMinMove-20,yMax:this.isZBelt?se.yMaxMove+20:se.yMax+20,angle:se.printerParam1,shape:"rectangle"},ae.set(new j(y.xMin,y.yMin,this.zMin),new j(y.xMax,y.yMax,this.zMax)),this.isZBelt&&(N.up.set(0,1,0),ne.up.set(0,1,0)),P=this.zMin,A=this.zMax,w=y.xMin,M=y.xMax,C=y.yMin,E=y.yMax;let ee=10,ye=.01*ee,ce=.03*ee;K.makeEmpty(),K.expandByPoint(new j(w,C,P)),K.expandByPoint(new j(M,E,A)),R=M-w,k=E-C,I=A-P,L=Math.sqrt(R*R+k*k+I*I),U=2*L;let Pe,ke,ct,Xe,Ke,nt,ot=[],lt=[];if(this.isZBelt){Pe=new Mr(y.xMax-y.xMin,this.zMax,1,1),Pe.name="Bed plane",this.tracker.add(Pe),Q=new _t(Pe,b),Q.position.x=.5*(y.xMax+y.xMin),Q.position.y=y.yMin,Q.position.z=.5*this.zMax,Q.rotateX(-Math.PI*.5),this.addXLine(lt,y.xMin,y.xMax,this.zMin,ce),this.addXLine(lt,y.xMin,y.xMax,this.zMax,ce),this.addZLine(lt,y.xMin,this.zMin,this.zMax,ce),this.addZLine(lt,y.xMax,this.zMin,this.zMax,ce);let be=Math.sin(y.angle*Math.PI/180),le=Math.cos(y.angle*Math.PI/180),xe=[new j(y.xMin,y.yMin,this.zMin),new j(y.xMax,y.yMin*be,this.zMin),new j(y.xMax,y.yMax*be,this.zMin+y.yMax*le),new j(y.xMin,y.yMax*be,this.zMin+y.yMax*le),new j(y.xMin,y.yMin*be,this.zMax),new j(y.xMax,y.yMin*be,this.zMax),new j(y.xMax,y.yMax*be,this.zMin+y.yMax*le),new j(y.xMin,y.yMax*be,this.zMin+y.yMax*le)];q.push(xe[0].x,xe[0].y,xe[0].z,xe[3].x,xe[3].y,xe[3].z,xe[4].x,xe[4].y,xe[4].z,xe[7].x,xe[7].y,xe[7].z,xe[5].x,xe[5].y,xe[5].z,xe[6].x,xe[6].y,xe[6].z,xe[1].x,xe[1].y,xe[1].z,xe[2].x,xe[2].y,xe[2].z,xe[3].x,xe[3].y,xe[3].z,xe[7].x,xe[7].y,xe[7].z,xe[7].x,xe[7].y,xe[7].z,xe[6].x,xe[6].y,xe[6].z,xe[6].x,xe[6].y,xe[6].z,xe[2].x,xe[2].y,xe[2].z,xe[2].x,xe[2].y,xe[2].z,xe[3].x,xe[3].y,xe[3].z),q.name="printerGeomPos";let Se=Math.ceil(y.xMin/ee)*ee;for(;Se<y.xMax;)parseInt(Se/ee)%5==0?this.addZLine(lt,Se,this.zMin,this.zMax,ce):this.addZLine(ot,Se,this.zMin,this.zMax,ye),Se+=ee;for(Se=Math.ceil(this.zMin/ee)*ee;Se<this.zMax;)parseInt(Se/ee)%5==0?this.addXLine(lt,y.xMin,y.xMax,Se,ce):this.addXLine(ot,y.xMin,y.xMax,Se,ye),Se+=ee}else if(y.shape==="rectangle"){Pe=new Mr(y.xMax-y.xMin,y.yMax-y.yMin,1,1),Pe.name="Bed plane",this.tracker.add(Pe),Q=new _t(Pe,b),Q.position.x=.5*(y.xMax+y.xMin),Q.position.y=.5*(y.yMax+y.yMin),Q.position.z=P,this.addXLine(lt,y.xMin,y.xMax,y.yMin,ce),this.addXLine(lt,y.xMin,y.xMax,y.yMax,ce),this.addYLine(lt,y.xMin,y.yMin,y.yMax,ce),this.addYLine(lt,y.xMax,y.yMin,y.yMax,ce);let be=[new j(y.xMin,y.yMin,this.zMin),new j(y.xMax,y.yMin,this.zMin),new j(y.xMax,y.yMax,this.zMin),new j(y.xMin,y.yMax,this.zMin),new j(y.xMin,y.yMin,this.zMax),new j(y.xMax,y.yMin,this.zMax),new j(y.xMax,y.yMax,this.zMax),new j(y.xMin,y.yMax,this.zMax)];q.push(be[0].x,be[0].y,be[0].z,be[4].x,be[4].y,be[4].z,be[1].x,be[1].y,be[1].z,be[5].x,be[5].y,be[5].z,be[2].x,be[2].y,be[2].z,be[6].x,be[6].y,be[6].z,be[3].x,be[3].y,be[3].z,be[7].x,be[7].y,be[7].z,be[4].x,be[4].y,be[4].z,be[5].x,be[5].y,be[5].z,be[5].x,be[5].y,be[5].z,be[6].x,be[6].y,be[6].z,be[6].x,be[6].y,be[6].z,be[7].x,be[7].y,be[7].z,be[7].x,be[7].y,be[7].z,be[4].x,be[4].y,be[4].z),q.name="printerGeomPos";let le=Math.ceil(y.xMin/ee)*ee;for(;le<y.xMax;)parseInt(le/ee)%5==0?this.addYLine(lt,le,y.yMin,y.yMax,ce):this.addYLine(ot,le,y.yMin,y.yMax,ye),le+=ee;for(le=Math.ceil(y.yMin/ee)*ee;le<y.yMax;)parseInt(le/ee)%5==0?this.addXLine(lt,y.xMin,y.xMax,le,ce):this.addXLine(ot,y.xMin,y.xMax,le,ye),le+=ee}else{Pe=new ec(y.radius,64),this.tracker.add(Pe),Pe.name="Bed circle",Q=new _t(Pe,b),Q.position.x=y.x,Q.position.y=y.y,Q.position.z=P;let be=y.radius;for(let Se=0;Se<8;Se++)nt=.25*Math.PI*Se,Xe=Math.cos(nt)*be,Ke=Math.sin(nt)*be,q.push(Xe,Ke,P,Xe,Ke,A);for(let Se=0;Se<64;Se++){nt=.0625*Math.PI*Se*.5,Xe=Math.cos(nt)*(be-.5*ce),Ke=Math.sin(nt)*(be-.5*ce),ke=Math.cos(nt)*(be+.5*ce),ct=Math.sin(nt)*(be+.5*ce);let Fe=.0625*Math.PI*(Se+1)*.5,st=Math.cos(Fe)*(be-.5*ce),mt=Math.sin(Fe)*(be-.5*ce),Ut=Math.cos(Fe)*(be+.5*ce),ar=Math.sin(Fe)*(be+.5*ce);lt.push(ke,ct,P,Ut,ar,P,st,mt,P,ke,ct,P,st,mt,P,Xe,Ke,P),lt.push(ke,ct,A,Ut,ar,A,st,mt,A,ke,ct,A,st,mt,A,Xe,Ke,A)}let le=ee,xe=Math.max(Math.abs(y.x-y.radius),Math.abs(y.x+y.radius),Math.abs(y.y-y.radius),Math.abs(y.y+y.radius));if(parseFloat(ee)>=1){0>y.yMin&&0<y.yMax&&this.addXLine(lt,y.x-y.radius,y.x+y.radius,0,ce),0>y.xMin&&0<y.xMax&&this.addYLine(lt,0,y.y-y.radius,y.y+y.radius,ce);let Se,Fe;for(;le<xe;){let st=parseInt(le/ee)%5==0;le>y.yMin&&le<y.yMax&&(Se=Math.asin((-le-y.y)/be),Fe=be*Math.cos(Se),st?this.addXLine(lt,y.x-Fe,y.x+Fe,y.y-le,ce):this.addXLine(ot,y.x-Fe,y.x+Fe,y.y-le,ye)),le>y.xMin&&le<y.xMax&&(Se=Math.asin((le-y.x)/be),Fe=be*Math.cos(Se),st?this.addYLine(lt,y.x+le,y.y-Fe,y.y+Fe,ce):this.addYLine(ot,y.x+le,y.y-Fe,y.y+Fe,ye)),le!==0&&(-le>y.yMin&&-le<y.yMax&&(Se=Math.asin((le-y.y)/be),Fe=be*Math.cos(Se),st?this.addXLine(lt,y.x-Fe,y.x+Fe,y.y+le,ce):this.addXLine(ot,y.x-Fe,y.x+Fe,y.y+le,ye)),-le>y.xMin&&-le<y.xMax&&(Se=Math.asin((-le-y.x)/be),Fe=be*Math.cos(Se),st?this.addYLine(lt,y.x-le,y.y-Fe,y.y+Fe,ce):this.addYLine(ot,y.x-le,y.y-Fe,y.y+Fe,ye))),le+=ee}}}Q.receiveShadow=this.withShadows,this.bedGroup.add(Q),at.setAttribute("position",new kt(q,3));let Je=new Zr(at,v);if(Je.renderOrder=10,Je.castShadow=!1,this.bedGroup.add(Je),te.length>0){W.setAttribute("position",new kt(te,3));let be=new Zr(W,g);be.castShadow=!1,this.bedGroup.add(be)}this.printerTriSmallGeom=this.tracker.add(new pt),this.printerTriSmallGeom.setAttribute("position",new vt(new Float32Array(lt),3));let oi=new _t(this.printerTriSmallGeom,x);oi.renderOrder=20,oi.translateZ(P),this.bedGroup.add(oi),this.printerTriSmallGeom=this.tracker.add(new pt),this.printerTriSmallGeom.setAttribute("position",new vt(new Float32Array(ot),3));let xt=new _t(this.printerTriSmallGeom,_);xt.translateZ(P),xt.renderOrder=20,this.bedGroup.add(xt),ue&&(K.getCenter(it),K.getCenter(this.orbit.target),G=U=4*L,ae=K.clone(),this.orientIsometric(),this.fitBoundingBox(K)),ue=!1,Re=!0},this.fitBoundingBox=se=>{let at=t.width()/t.height(),W=1.5*Math.sqrt((R*R+k*k+I*I)*.25);se.getCenter(it),this.orbit.target.copy(it),U=G;let q=8,te=(jt?N.fov:30)/2*Math.PI/180;for(;q>0;){q--,this.orbit.fromPhiTheta(U),this.orbit.update();let Q=new j().copy(N.position),ee=new dt;ee.lookAt2(Q,it,N.up);let ye=new dt,ce=new j;ce.subVectors(it,Q),ce.normalize();let Pe=-ce.dot(Q),ke=Math.max(1,Pe-W),ct=Math.max(W*2,Pe+W),Xe=2*Math.tan(te)*Pe;if(!jt)ye.makeOrthographic(-.5*Xe*at,.5*Xe*at,.5*Xe,-.5*Xe,ke,ct),q=0;else{let oi=Math.tan(te)*ke,xt=oi*at;ye.makePerspective(-xt,xt,-oi,oi,ke,ct)}let Ke=new dt;Ke.multiplyMatrices(ye,ee);let nt=new Ei,ot=se.min.toVector4().applyMatrix4(Ke).toVector3();nt.expandByPoint(ot),ot=se.max.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot);let lt=new j(se.min.x,se.max.y,se.min.z);ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot),lt=new j(se.max.x,se.min.y,se.min.z),ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot),lt=new j(se.max.x,se.max.y,se.min.z),ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot),lt=new j(se.min.x,se.max.y,se.max.z),ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot),lt=new j(se.min.x,se.min.y,se.max.z),ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot),lt=new j(se.max.x,se.min.y,se.max.z),ot=lt.toVector4().applyMatrix4(Ke).toVector3(),nt.expandByPoint(ot);let Je=Math.max(Math.abs(nt.min.x),Math.abs(nt.max.x));Je=Math.max(Je,Math.abs(nt.min.y)),Je=Math.max(Je,Math.abs(nt.max.y)),jt?U*=Je*1.03:(Je=Je*1.03*.5,N.left=-Je*Xe*at,N.right=Je*Xe*at,N.top=Je*Xe,N.bottom=-Je*Xe,N.near=ke,N.far=ct,N.zoom=1,N.updateProjectionMatrix())}N.updateProjectionMatrix(),Re=!0},this.orientFront=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,-Math.PI/2):this.orbit.setPhiTheta(Math.PI/2,0),this.fitBoundingBox(ae)},this.orientBack=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,Math.PI/2):this.orbit.setPhiTheta(Math.PI/2,Math.PI),this.fitBoundingBox(ae)},this.orientLeft=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,Math.PI):this.orbit.setPhiTheta(Math.PI/2,-Math.PI/2),this.fitBoundingBox(ae)},this.orientRight=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,0):this.orbit.setPhiTheta(Math.PI/2,Math.PI/2),this.fitBoundingBox(ae)},this.orientTop=()=>{this.isZBelt?this.orbit.setPhiTheta(1e-5,-Math.PI*.5):this.orbit.setPhiTheta(1e-5,0),this.fitBoundingBox(ae)},this.orientBottom=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI,-Math.PI*.5):this.orbit.setPhiTheta(Math.PI,0),this.fitBoundingBox(ae)},this.orientIsometric=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI*.3,-Math.PI/5-.5*Math.PI):this.orbit.setPhiTheta(Math.PI*.3,-Math.PI/5),this.fitBoundingBox(ae)},this.fitObjects=()=>{this.fitBoundingBox(K)},this.fitPrinter=()=>{this.fitBoundingBox(ae)},this.removeLightsIn=se=>{let at=[];se.children.forEach(W=>{W.isLight&&at.push(W)}),at.forEach(W=>{this.tracker.remove(W,!0),se.remove(W)})},this.addLights=()=>{this.removeLightsIn(_e),this.removeLightsIn(Le),this.removeLightsIn(this.sceneBed),this.removeLightsIn(Et),this.ambientLight=new ic(4210752),_e.add(this.tracker.add(this.ambientLight)),Le.add(this.tracker.add(this.ambientLight.clone())),this.sceneBed.add(this.tracker.add(this.ambientLight.clone())),Et.add(this.tracker.add(this.ambientLight.clone()));let se=y===!1?R:Math.max(Math.abs(y.xMin),Math.abs(y.xMax)),at=y===!1?k:Math.max(Math.abs(y.yMin),Math.abs(y.yMax)),W=Math.sqrt(se*se+at*at)*.5,q=new th(16777215);this.directLight1=q;let te=(this.isZBelt?k:I)/L;if(this.isZBelt?q.position.set(te*.5*L,te*.2*L,.3*te*L):q.position.set(te*.3*L,te*.5*L,.2*te*L),_e.add(this.tracker.add(q)),Le.add(this.tracker.add(q.clone())),this.sceneBed.add(this.tracker.add(q.clone())),Et.add(this.tracker.add(q.clone())),q.castShadow=this.withShadows,q.shadow.camera.left=-W,q.shadow.camera.right=W,q.shadow.camera.top=W,q.shadow.camera.bottom=-W,q.shadow.camera.near=0,q.shadow.camera.far=2*L,q.shadow.mapSize.width=4096,q.shadow.mapSize.height=4096,q.shadow.bias=.005,a){let Q=new sc(q,5,0);_e.add(Q),this.tracker.add(Q);let ee=new oc(q.shadow.camera);_e.add(ee),this.tracker.add(ee)}if(q=this.tracker.add(new th(16777215)),this.directLight1=q,this.isZBelt?q.position.set(te*-.5*L,te*.2*L,-.4*te*L):q.position.set(te*-.4*L,te*-.5*L,.2*te*L),_e.add(this.tracker.add(q)),Le.add(this.tracker.add(q.clone())),this.sceneBed.add(this.tracker.add(q.clone())),Et.add(this.tracker.add(q.clone())),q.castShadow=this.withShadows,q.shadow.camera.left=-W,q.shadow.camera.right=W,q.shadow.camera.top=W,q.shadow.camera.bottom=-W,q.shadow.camera.near=0,q.shadow.camera.far=2*L*te,q.shadow.mapSize.width=4096,q.shadow.mapSize.height=4096,q.shadow.bias=.005,a){let Q=new sc(q,5,0);_e.add(Q),this.tracker.add(Q);let ee=new oc(q.shadow.camera);_e.add(ee),this.tracker.add(ee)}this.numLights=3,Re=!0},this.getPrinterBox=function(){return ae};let we,Ue,Ie,Ze,Ee={},ft=se=>{this.shiftKey=se.shiftKey,this.ctrlKey=se.ctrlKey,this.altKey=se.altKey;let at=z.offset();Ee[se.pointerId]={x:se.clientX,y:se.clientY},se.points=Object.values(Ee);let W={x:0,y:0},q=se.points.length;se.points.forEach(te=>{W.x+=te.x/q,W.y+=te.y/q}),se.center=W,se.handleAsLeftButton=se.pointerType==="touch"&&q===1||se.button===0,d.x=(W.x-at.left)/z.width()*2-1,d.y=-((W.y-at.top)/z.height())*2+1,this.ray.setFromCamera(d,N)},Ot=se=>{ft(se),this.clickCallback&&this.clickCallback(se)},Ct=se=>{ft(se),this.moveCallback&&this.moveCallback(se)},$i=se=>{ft(se),this.unclickCallback&&this.unclickCallback(se),Ee[se.pointerId]&&delete Ee[se.pointerId],Y=!1},ln=se=>{ft(se),Ee[se.pointerId]&&delete Ee[se.pointerId],this.cancelCallback&&this.cancelCallback(se),Y=!1};this.disablePointerCallbacks=()=>{this.clickCallback=void 0,this.moveCallback=void 0,this.unclickCallback=void 0,this.cancelCallback=void 0};function Tu(se){}function wT(se){se.touches.length===1&&(se.preventDefault(),we=se.touches[0].pageX,Ue=se.touches[0].pageY,Ie=B,Ze=F)}function Au(se){se.touches.length===1&&(se.preventDefault(),B=(we-se.touches[0].pageX)*.0174+Ie,F=-(se.touches[0].pageY-Ue)*.0174+Ze)}function $p(){let se=t.width();T!==se&&(de(),T=se),re||setTimeout($p,500)}$p();let Ll=se=>(se.preventDefault(),se.returnValue=!1,!1),Pu=()=>{Y=!1,document.removeEventListener("mousewheel",Tu,!1),window.removeEventListener("DOMMouseScroll",Ll,!1)},em=()=>{document.addEventListener("mousewheel",Tu,!1),window.addEventListener("DOMMouseScroll",Ll,!1)};this.enableRaycasts=()=>{this.doRaycasts=!0,t[0].addEventListener("pointerdown",Ot),t[0].addEventListener("pointermove",Ct),t[0].addEventListener("pointerup",$i),t[0].addEventListener("pointerout",Pu),t[0].addEventListener("pointerenter",em),t[0].addEventListener("pointercancel",ln)},this.disableRaycasts=()=>{this.doRaycasts=!1,t[0].removeEventListener("pointerdown",Ot),t[0].removeEventListener("pointermove",Ct),t[0].removeEventListener("pointerup",$i),t[0].removeEventListener("pointerout",Pu),t[0].removeEventListener("pointerenter",em),t[0].removeEventListener("pointercancel",ln)},Qe(),this.renderer.setAnimationLoop(Wt),Re=!0}RSBase.directive("autoscroll",function(){return{scope:{scroll:"=autoscroll"},restrict:"A",link:function(t,e){t.$watch("scroll",function(){t.scroll&&(e[0].scrollTop=e[0].scrollHeight)}),e.bind("scroll",function(){t.$apply(function(){t.scroll&&(e[0].scrollTop=e[0].scrollHeight)})})}}}).directive("enter",function(){return function(t,e,i){e.bind("keydown keypress",function(r){r.which===13&&(t.$apply(function(){t.$eval(i.enter)}),r.preventDefault())})}});RSBase.component("rsIconEditor",{template:`
<!-- <script type="text/ng-template" id="rsIconEditor.html">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title">I'm a modal!</h3>
        </div>
        <div class="modal-body" id="modal-body">
            <ul>
                <li ng-repeat="item in $ctrl.items">
                    <a href="#" ng-click="$event.preventDefault(); $ctrl.selected.item = item">{{ item }}</a>
                </li>
            </ul>
            Selected: 
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="$ctrl.ok()">OK</button>
            <button class="btn btn-warning" type="button" ng-click="$ctrl.cancel()">Cancel</button>
        </div>
    <\/script> -->
<div class="input-group" ng-click="ctrl.openEditor()">
        <input type="text" class="form-control" readonly ng-model="ctrl.ngModel" ng-change="ctrl.ngModelChange()">
        <span class="input-group-addon" id="basic-addon2"><rs-menu-icon icon="{{ctrl.defaultIcon}}" icon-img="ctrl.ngModel"></rs-menu-icon></span>
      </div>`,controllerAs:"ctrl",bindings:{ngModel:"<",defaultIcon:"@"},require:{ngModelCtrl:"ngModel"},controller:["$uibModal",function(t){let e=this;this.openEditor=()=>{let i,r=t.open({template:`
        <div id="iconDrop">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title"><?php _('Icon Editor') ?></h3>
        </div>
        <div class="modal-body" id="modal-body">
        <h3><?php _('Preview') ?></h3>
        <div class="alert alert-info margin-top margin-bottom" >
           <?php _('You see a preview of the icon in light and dark mode in small and big. All should look great. For comparison the icon is followed by a X sign for comparison and judjing position when used with text content.') ?>            
        </div>
        <div style="display: flex;justify-content: space-around">
        <div style="background:#eeeeee;padding:10px;flex-grow: 1;display:flex;justify-content: space-around;align-items: center">
        <span style="font-size:19px;color: #111111;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        <span style="font-size:64px;color: #111111;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        </div>
        <div style="background:#111111;padding:10px;flex-grow: 1;display:flex;justify-content: space-around;align-items: center">
        <span style="font-size:19px;color: #eeeeee;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        <span style="font-size:64px;color: #eeeeee;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
         </div>
        </div>
        <h3><?php _('Editor') ?></h3>
            <div class="btn-group  btn-group-justified" >
              <div class="btn-group btn-group-lg" style="width: 100%">
              <div style="" class="btn btn-file btn-primary btn-block">
                <input type="file" id="iconUpload"/>            
                {{$ctrl.dragMessage}}
              </div>
              </div>
              <div class="btn-group btn-group-lg" style="width: 70px" ng-if="$ctrl.original!==$ctrl.icon">
              <div class="btn btn-primary" ng-click="$ctrl.reset()"><i class="fa fa-undo"></i></div>
              </div>
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isPNG"><i class="fa fa-warning"></i>
              <?php _('You have uploaded a image. Images will not correctly adjust to font color and resolution. Therefore, you should consider replacing the pixel image with a SVG image.') ?>            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isURL"><i class="fa fa-warning"></i>
              <?php _('You have selected a URL. Images will not correctly adjust to font color and resolution. Therefore, you should consider replacing the pixel image with an inlined SVG image.') ?>            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isEmpty"><i class="fa fa-warning"></i>
              <?php _('Enter preferrably a single color SVG image code here. URL or PNG image is also possible, but will prevent adjusting to font color.') ?>            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isUnknown"><i class="fa fa-warning"></i>
              <?php _('Unrecogniced format. Make sure at least the icon appears correctly or delete content to prevent errors!') ?>            
            </div>

            <textarea spellcheck="false" ng-model="$ctrl.icon" style="width:100%;height:150px"></textarea>
                
            <div ng-if="$ctrl.isSVG && $ctrl.colors && $ctrl.colors.length>0">
              <div class="alert alert-info margin-top margin-bottom">
                The SVG needs to use currentColor as color, so it uses font size and adjust to correct font color. We found the following colors. To convert them to currentColor hit the button with the color name you want to change.            
              </div>
              <div class="btn btn-default" ng-click="$ctrl.replaceColors($ctrl.colors)"><?php _('Replace all colors') ?></div>
              <div class="btn btn-default" ng-repeat="c in $ctrl.colors" style="background:{{c}};text-shadow: 0px 0px 3px rgba(0,0,0,0.95);" ng-click="$ctrl.replaceColors([c])">{{c}}</div>
            </div>        
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="$ctrl.ok()"><?php _('OK') ?></button>
            <button class="btn btn-default" type="button" ng-click="$ctrl.cancel()"><?php _('Cancel') ?></button>
        </div>
        </div>
        `,controller:["$uibModalInstance","icon","$scope",function(n,o,a){i=this,i.colors=!1,this.icon=o,i.ok=function(){u(),n.close(i.icon)},i.dragMessage="<?php _('Drag SVG Icon Here') ?>",i.cancel=function(){n.dismiss("cancel")};let l=[new RegExp('(.*?)(fill\\s*?:\\s*?([^\\s};"]+))(.*)',"gmsi"),new RegExp('(.*?)(fill\\s*?=\\s*?"\\s*?([^"]+))(.*)',"gmsi"),new RegExp('(.*?)(color\\s*?:\\s*?([^\\s};"]+))(.*)',"gmsi"),new RegExp('(.*?)(stroke\\s*?=\\s*?"\\s*?([^"]+))(.*)',"gmsi")];function h(){if(i.isSVG===!1)return;let c=i.icon,f={},d=[],m=!0;for(let p=0;p<l.length;p++)for(l[p].lastIndex=-1;;){let v=l[p].lastIndex,g=l[p].exec(c);if(g!==null&&g.length>3)!f[g[3]]&&g[3]!=="currentColor"&&d.push(g[3]),f[g[3]]=!0,l[p].lastIndex=v+g[1].length+g[2].length;else break}d.sort(),i.colors=d}i.replaceColors=c=>{let f=i.icon,d=!0,m=new Array(l.length).fill(-1);for(;d;){d=!1;for(let p=0;p<l.length;p++)if(m[p]!==-2){l[p].lastIndex=m[p];do{let v=Math.max(0,l[p].lastIndex),g=l[p].exec(f);if(g!==null&&g.length>3){if(c.includes(g[3])){f=f.substr(0,v)+g[1]+g[2].replace(g[3],"currentColor")+g[4],d=!0,m[p]=v+g[1].length+12;break}g[1].length+g[2].length&&(l[p].lastIndex=g[1].length+g[2].length+v)}else{m[p]=-2;break}}while(!0)}}i.icon=f,h()};function u(){i.isSVG=!1,i.isEmpty=!1,i.isPNG=!1,i.isURL=!1,i.isUnknown=!1;let c=i.icon,f=c.indexOf("<svg");if(f>=0){if(i.isSVG=!0,c=c.substr(f),c.match(/fill\s*?[:=]/)||(c='<svg fill="currentColor"'+c.substr(4)),!c.match(/viewBox/)){let m=0,p=0,v=new RegExp('<svg.*?\\bwidth\\w*?=\\w*?"(.*?)".*?>',"gmsi").exec(c);v&&(m=v[1]);let g=new RegExp('<svg.*?\\bheight\\w*?=\\w*?"(.*?)".*?>',"gmsi").exec(c);v&&(p=g[1]),m!==0&&p!==0&&(c=c.replace("<svg",`<svg viewBox="0 0 ${m} ${p}"`))}c=c.replace(new RegExp('(<svg.*?)(\\swidth=".*?")(.*?>)',"gms"),"$1$3"),c=c.replace(new RegExp('(<svg.*?)(\\sheight=".*?")(.*?>)',"gms"),"$1$3"),c=c.replaceAll(new RegExp('(\\s+?(inkscape:|sodipodi:|xmlns).*?".*?")',"gmsi"),""),c=c.replace(new RegExp("<metadata.*?<\\/metadata>","gmsi"),"")}else c.charCodeAt(1)===80&&c.charCodeAt(2)===78&&c.charCodeAt(3)===71&&c.charCodeAt(4)===13&&c.charCodeAt(5)===10&&c.charCodeAt(6)===26&&c.charCodeAt(7)===10?(i.isPNG=!0,c="data:image/png;base64,"+btoa(c)):c.charCodeAt(0)===255&&c.charCodeAt(1)==216&&c.charCodeAt(2)===255?(i.isPNG=!0,c="data:image/jpeg;base64,"+btoa(c)):c.substr(0,5)==="data:"?i.isPNG=!0:c.substr(0,4)==="http"||c.substr(0,4)==="data"||c[0]==="/"?i.isURL=!0:c.length===0?i.isEmpty=!0:i.isUnknown=!0;i.original=i.icon=c}a.$watch("icon",function(){u(),h()}),this.$onChanges=c=>{c.icon&&h()},i.readFile=c=>{var f=c.target.files[0];if(f){var d=new FileReader;d.onload=function(m){i.original=i.icon=m.target.result,u(),h()},d.readAsBinaryString(f)}},i.reset=function(){i.icon=i.original,u(),h()},i.$postLink=function(){i.original=i.icon;let c=document.getElementById("iconDrop");document.getElementById("iconUpload").onchange=i.readFile,c.ondrop=f=>{f.preventDefault();let d=f.dataTransfer.files[0],m=new FileReader;return m.onload=function(p){i.original=i.icon=p.target.result,u(),h()},m.readAsBinaryString(d),!1},c.ondragover=function(){return this.className="dragOver",i.dragMessage="<?php _('Drop file now') ?>",!1},c.onmouseleave=function(){return this.className="",i.dragMessage="<?php _('Drag SVG Icon Here') ?>",!1},u()}}],controllerAs:"$ctrl",size:"lg",backdrop:"static",resolve:{icon:function(){return e.ngModel}}});window.mi=r,r.rendered.then(()=>{i.$postLink()}),r.result.then(n=>{this.ngModel=n,this.ngModelCtrl.$setViewValue(this.ngModel)},()=>{})},this.$onInit=()=>{this.ngModelChange=()=>{this.ngModelCtrl.$setViewValue(this.ngModel)}}}]});RSBase.factory("RSBrowseFolder",["$rootScope","$timeout","RSCom",function(t,e,i){let r={selectedFolder:t.folders.length>0?t.folders[0].id:0,activeFolderPath:"",filesInPath:[],unfiltered:[],filter:"",useFilter:!0,numSelected:0};return r.toggleSelectFile=function(n){if(n.isDir){r.activeFolderPath=n.path,r.updateFiles("");return}n.selected=!n.selected,r.updateFilter()},r.updateFilter=function(){r.filesInPath=[],r.numSelected=0,angular.forEach(r.unfiltered,function(n){let o=!1,a=n.name.substring(n.name.lastIndexOf(".")+1).toLowerCase();r.useFilter===!1?o=!0:n.name!==".."&&n.name.startsWith(".")?o=!1:(n.isDir||r.filter==="gcode"&&(a==="g"||a==="gco"||a==="gcode"||a==="bgcode"||a==="nc"||a==="tap"||a==="gcd"||a==="dnc"||a==="cnc"||a==="zip"||a==="")||r.filter==="model"&&(a==="stl"||a==="obj"||a==="amf"))&&(o=!0),o&&(r.filesInPath.push(n),n.selected&&r.numSelected++)}),r.filesInPath.sort(function(n,o){return n.isDir!==o.isDir?n.isDir?-1:1:n.name.toLowerCase()<o.name.toLowerCase()?-1:1})},r.updateFiles=function(n){n||(n=""),i.send("browseFolder",{folder:r.selectedFolder,next:n,root:r.activeFolderPath}).then(function(o){o.ok&&(r.unfiltered=o.files,angular.forEach(r.unfiltered,function(a){a.selected=!1;let l=a.name.substr(a.name.lastIndexOf(".")+1).toLowerCase();a.isDir?a.icon="fa fa-folder-o":l==="g"||l==="gco"||l==="gcode"||l==="bgcode"||l==="nc"||l==="tap"||l==="cnc"||l==="gcd"||l==="dnc"||l==="cnc"||l===""?a.icon="rs rs-file-gcode":l==="stl"||l==="obj"||l==="amf"?a.icon="rs rs-file-object":l==="mov"||l==="mp4"||l==="wmv"?a.icon="rs rs-file-video":l==="png"||l==="gif"||l==="jpg"?a.icon="rs rs-file-image":l==="zip"?a.icon="fa fa-file-archive-o":a.icon="rs rs-file",a.icon+=" rs-bigtab"}),r.activeFolderPath=o.root,r.updateFilter())})},r}]);(function(){window.RSPrinterModule=angular.module("RSPrinter",["ui.router","RSBase"]).config(["$stateProvider","RSFrontendProvider",function(t,e){t.state("about",{url:"/about",templateUrl:"/views/base/about.php?lang="+window.lang,controller:"AboutController"}).state("privacypolicy",{url:"/privacypolicy",templateUrl:"/views/base/privacypolicy.php?lang="+window.lang,controller:"PrivacyPolicyController"}).state("register",{url:"/register",templateUrl:"/views/base/register.php?lang="+window.lang,controller:"RegisterController"}).state("troubleshooting",{url:"/troubleshooting",templateUrl:"/views/base/troubleshooting.php?lang="+window.lang,controller:"TroubleshootingController"}).state("update",{url:"/update",templateUrl:"/views/base/update.php?lang="+window.lang,controller:"UpdateController"}).state("manufacturerNews",{url:"/manufacturerNews",templateUrl:"/views/base/manufacturerNews.php?lang="+window.lang,controller:"ManufacturerNewsController"}).state("project",{url:"/project/:serverid/:projectid",templateUrl:"/views/projects/projects.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"ProjectController"}).state("projectgcodepreview",{url:"/projectgcodepreview/:serverid/:projectid/:model/:tab",templateUrl:"/views/projects/gcodepreview.php?lang="+window.lang,controller:"ProjectGCodePreviewController"}).state("externalLink",{name:"externalLink",url:"/externalLink/{id}",templateUrl:"/views/base/externallink.php?lang="+window.lang,controller:"ExternalLinkPrinterController"}).state("terminalCommand",{name:"terminalCommand",url:"/terminalCommand/{id}",templateUrl:"/views/base/terminalCommand.php?lang="+window.lang,controller:"TerminalCommandController"}).state("browse_projects",{url:"/browse_projects/:serverid/:folderid",templateUrl:"/views/projects/browseProjects.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"BrowseProjectController"}).state("search_projects",{url:"/search_projects/:serverid/:tag/:search",params:{tag:{dynamic:!0},search:{dynamic:!0}},templateUrl:"/views/projects/searchProjects.php?lang="+window.lang,controller:"SearchProjectController"}).state("home",{url:"/dashboard",templateUrl:"/views/home.php?lang="+window.lang,controller:"HomeController",resolve:{IPS:["RSCom",function(i){return i.send("networkInterfaces",{})}]}}).state("start",{url:"/",template:"",controller:"StartController"}).state({name:"printer",url:"/printer/{slug}",templateUrl:"/views/printer/control/printer.php?lang="+window.lang,resolve:{P:["RSOverview","$stateParams","$rootScope","$q",function(i,r,n,o){let a=o.defer();return i.printerListLoadedPromise.then(function(){i.selectPrinter(r.slug),a.resolve()}),a.promise}]},controller:"PrinterController"}).state("printer.externalLink",{name:"externalLinkPrinter",url:"/externalLinkPrinter/{id}",templateUrl:"/views/printer/control/printer.externallink.php?lang="+window.lang,controller:"ExternalLinkPrinterController"}).state("printer.camera",{url:"/camera",templateUrl:"/views/printer/control/printer.camera.php?lang="+window.lang+"index=0",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterCameraController"}).state("printer.timelapse",{url:"/timelapse",templateUrl:"/views/printer/control/printer.timelapse.php?lang="+window.lang+"index=1",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterCameraController"}).state("printer.console",{url:"/console",templateUrl:"/views/printer/control/printer.console.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterConsoleController"}).state("printer.filamentchange",{url:"/filamentchange",templateUrl:"/views/printer/control/printer.filamentchange.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterFilamentChangeController"}).state("printer.control",{url:"/control?page",templateUrl:"/views/printer/control/printer.control.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterControlController"}).state("printer.eeprom",{url:"/eeprom",templateUrl:"/views/printer/control/printer.eeprom.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterEepromController"}).state("printer.klipperConfig",{url:"/klipper_config",templateUrl:"/views/printer/control/printer.klipperConfig.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterKlipperConfigController"}).state("printer.setup",{url:"/setup",templateUrl:"/views/printer/control/printer.setup.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterSetupController"}).state("printer.rescue",{url:"/rescue",templateUrl:"/views/printer/control/printer.rescue.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterRecoverController"}).state("printer.logs",{url:"/logs",templateUrl:"/views/printer/control/printer.logs.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterLogsController"}).state("printer.history",{url:"/history",templateUrl:"/views/printer/control/printer.history.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterHistoryController"}).state({name:"printer.print",url:"/print",templateUrl:"/views/printer/control/printer.print.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"PrinterGCodesController"}).state("printer.plates",{url:"/plates",templateUrl:"/views/printer/slicer/plates.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PlatesController"}).state("printer.preview",{url:"/preview/:model/:tab",templateUrl:"/views/printer/control/printer.preview.php?lang="+window.lang,controller:"PrinterPreviewController"}).state("printer.preview_demo",{url:"/preview_demo/:model/:tab",templateUrl:"/views/printer/control/printer.preview_demo.php?lang="+window.lang,controller:"PrinterPreviewController"}).state("printerConfig",{url:"/printerConfig/:slug",templateUrl:"/views/printer/config/printerConfig.php?lang="+window.lang,resolve:{resA:["RSPrinterConfig","$stateParams","RSFirmware","$q",function(i,r,n,o){return o.all([i.selectPrinter(r.slug),n.promise])}]},onExit:["RSPrinterConfig","Confirm",function(i,r){i.hasConfigChanged()&&!i.hasErrors()&&r("<?php _('Save Configuration?') ?>","<?php _('Your configuration has changed and is unsaved. Should I save the changes?') ?>").then(function(){i.save()},function(){})}],controller:"PrinterConfigController"}).state("printerConfig.webcam",{url:"/webcam",templateUrl:"/views/printer/config/printerConfig.webcam.php?lang="+window.lang,controller:"PrinterConfigAdvancedController"}).state("printerConfig.extruder",{url:"/extruder",templateUrl:"/views/printer/config/printerConfig.extruder.php?lang="+window.lang,controller:"PrinterConfigExtruderController"}).state("printerConfig.general",{url:"/general",templateUrl:"/views/printer/config/printerConfig.general.php?lang="+window.lang,controller:"PrinterConfigGeneralController"}).state("printerConfig.gcodes",{url:"/gcodes",templateUrl:"/views/printer/config/printerConfig.gcodes.php?lang="+window.lang,controller:"PrinterConfigGCodesController"}).state("printerConfig.rescue",{url:"/rescue",templateUrl:"/views/printer/config/printerConfig.rescue.php?lang="+window.lang,controller:"PrinterConfigRecoverController"}).state("printerConfig.shape",{url:"/shape",templateUrl:"/views/printer/config/printerConfig.shape.php?lang="+window.lang,controller:"PrinterConfigShapeController"}).state("configWizard",{url:"/configWizard",templateUrl:"/views/printer/config/configWizard.php?lang="+window.lang,controller:"ConfigWizardController"}).state("slicer",{url:"/slicer/:slug/:plateid",templateUrl:"/views/printer/slicer/editPlate.php?lang="+window.lang,controller:"EditPlateController",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}],resA:["RSPrinterConfig","$stateParams","RSFirmware","$q",function(i,r,n,o){return o.all([i.selectPrinter(r.slug),n.promise])}]}}),e.registerPrinterTab({name:"<?php _('Print') ?>",icon:"rs rs-print",visible:"true",state:"printer.print",prio:100,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Change Filament') ?>",icon:"rs rs-filamentchange",visible:"showFilamentchange",state:"printer.filamentchange",prio:250,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Control') ?>",icon:"fa fa-arrows",visible:"true",state:"printer.control",prio:200,requireOnline:!0,requireActive:!0}),e.registerPrinterTab({name:"<?php _('Console') ?>",icon:"fa fa-terminal",visible:"showConsole",feature:"show-console",state:"printer.console",prio:300,requireOnline:!1,requireActive:!0}),e.registerPrinterTab({name:"<?php _('Webcam') ?>",icon:"rs rs-webcam",visible:"activeWebcam",state:"printer.camera",prio:400,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Records') ?>",icon:"rs rs-timelapse",visible:"showTimelapseTab",state:"printer.timelapse",prio:500,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('EEPROM') ?>",icon:"rs rs-eeprom-settings",visible:"activeEEPROM",state:"printer.eeprom",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Klipper Configuration') ?>",icon:"rs rs-klipper",visible:"activeKlipperConfig",state:"printer.klipperConfig",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Printer Setup') ?>",icon:"fa fa-wrench",visible:"activePrinterSetup",state:"printer.setup",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Rescue') ?>",icon:"rs rs-print",visible:"activeRecover",state:"printer.rescue",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Preview') ?>",icon:"fa fa-eye",visible:"gcodePreview",state:"printer.preview",prio:700,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('Logs') ?>",icon:"rs rs-log",visible:"logs",state:"printer.logs",prio:800,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('History') ?>",icon:"rs rs-history",visible:"history",state:"printer.history",prio:900,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"<?php _('External Link') ?>",icon:"fa fa-external-link",visible:"externalLink",state:"printer.externalLink",prio:900,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('General') ?>",icon:"fa fa-list-ul",visible:"true",feature:"printer-configure-general",state:"printerConfig.general",prio:100,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('Tools') ?>",icon:"rs rs-extruder",visible:"true",feature:"printer-configure-tools",state:"printerConfig.extruder",prio:200,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('Printer Shape') ?>",icon:"fa fa-square-o",visible:"true",feature:"printer-configure-shape",state:"printerConfig.shape",prio:300,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('Webcam') ?>",icon:"rs rs-webcam",visible:"true",feature:"printer-configure-webcam",state:"printerConfig.webcam",prio:400,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('G-Codes') ?>",icon:"rs rs-file-gcode",visible:"true",feature:"printer-configure-gcodes",state:"printerConfig.gcodes",prio:500,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"<?php _('Rescue') ?>",icon:"rs rs-print",visible:"true",feature:"printer-configure-rescue",state:"printerConfig.rescue",prio:600,requireOnline:!1,requireActive:!1}),e.setVisible("externalLink",!1)}]),RSPrinterModule.run(["$transitions","$rootScope","User","$q",function(t,e,i,r){t.onBefore({},function(n){let o=n.to().name;if(e.serverSettings&&e.serverSettings.policy_accepted===!1){if(o!=="privacypolicy"&&o!=="login")return n.router.stateService.target("privacypolicy")}else if(o!=="login"&&!i.isLoggedIn){let a=r.defer();return i.autologinPromise.promise.then(()=>{i.isLoggedIn?a.resolve():a.resolve(n.router.stateService.target("login"))}),a.promise}return!0})}])})();var b3=function(){if(typeof Map!="undefined")return Map;function t(e,i){var r=-1;return e.some(function(n,o){return n[0]===i?(r=o,!0):!1}),r}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(i){var r=t(this.__entries__,i),n=this.__entries__[r];return n&&n[1]},e.prototype.set=function(i,r){var n=t(this.__entries__,i);~n?this.__entries__[n][1]=r:this.__entries__.push([i,r])},e.prototype.delete=function(i){var r=this.__entries__,n=t(r,i);~n&&r.splice(n,1)},e.prototype.has=function(i){return!!~t(this.__entries__,i)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(i,r){r===void 0&&(r=null);for(var n=0,o=this.__entries__;n<o.length;n++){var a=o[n];i.call(r,a[1],a[0])}},e}()}(),fS=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,xv=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),kY=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(xv):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),FY=2;function BY(t,e){var i=!1,r=!1,n=0;function o(){i&&(i=!1,t()),r&&l()}function a(){kY(o)}function l(){var h=Date.now();if(i){if(h-n<FY)return;r=!0}else i=!0,r=!1,setTimeout(a,e);n=h}return l}var NY=20,UY=["top","right","bottom","left","width","height","size","weight"],zY=typeof MutationObserver!="undefined",GY=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=BY(this.refresh.bind(this),NY)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var i=this.observers_,r=i.indexOf(e);~r&&i.splice(r,1),!i.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return e.forEach(function(i){return i.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!fS||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),zY?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!fS||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var i=e.propertyName,r=i===void 0?"":i,n=UY.some(function(o){return!!~r.indexOf(o)});n&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),w3=function(t,e){for(var i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];Object.defineProperty(t,n,{value:e[n],enumerable:!1,writable:!1,configurable:!0})}return t},Xh=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||xv},S3=wv(0,0,0,0);function bv(t){return parseFloat(t)||0}function x3(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(r,n){var o=t["border-"+n+"-width"];return r+bv(o)},0)}function HY(t){for(var e=["top","right","bottom","left"],i={},r=0,n=e;r<n.length;r++){var o=n[r],a=t["padding-"+o];i[o]=bv(a)}return i}function WY(t){var e=t.getBBox();return wv(0,0,e.width,e.height)}function VY(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return S3;var r=Xh(t).getComputedStyle(t),n=HY(r),o=n.left+n.right,a=n.top+n.bottom,l=bv(r.width),h=bv(r.height);if(r.boxSizing==="border-box"&&(Math.round(l+o)!==e&&(l-=x3(r,"left","right")+o),Math.round(h+a)!==i&&(h-=x3(r,"top","bottom")+a)),!qY(t)){var u=Math.round(l+o)-e,c=Math.round(h+a)-i;Math.abs(u)!==1&&(l-=u),Math.abs(c)!==1&&(h-=c)}return wv(n.left,n.top,l,h)}var jY=function(){return typeof SVGGraphicsElement!="undefined"?function(t){return t instanceof Xh(t).SVGGraphicsElement}:function(t){return t instanceof Xh(t).SVGElement&&typeof t.getBBox=="function"}}();function qY(t){return t===Xh(t).document.documentElement}function XY(t){return fS?jY(t)?WY(t):VY(t):S3}function YY(t){var e=t.x,i=t.y,r=t.width,n=t.height,o=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,a=Object.create(o.prototype);return w3(a,{x:e,y:i,width:r,height:n,top:i,right:e+r,bottom:n+i,left:e}),a}function wv(t,e,i,r){return{x:t,y:e,width:i,height:r}}var ZY=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=wv(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=XY(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),KY=function(){function t(e,i){var r=YY(i);w3(this,{target:e,contentRect:r})}return t}(),QY=function(){function t(e,i,r){if(this.activeObservations_=[],this.observations_=new b3,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=i,this.callbackCtx_=r}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Xh(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)||(i.set(e,new ZY(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Xh(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)&&(i.delete(e),i.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&e.activeObservations_.push(i)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,i=this.activeObservations_.map(function(r){return new KY(r.target,r.broadcastRect())});this.callback_.call(e,i,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),C3=typeof WeakMap!="undefined"?new WeakMap:new b3,E3=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=GY.getInstance(),r=new QY(e,i,this);C3.set(this,r)}return t}();["observe","unobserve","disconnect"].forEach(function(t){E3.prototype[t]=function(){var e;return(e=C3.get(this))[t].apply(e,arguments)}});var JY=function(){return typeof xv.ResizeObserver!="undefined"?xv.ResizeObserver:E3}(),M3=JY;RSPrinterModule.component("websocketCamera",{template:'<img alt="webcam" style="{{$ctrl.myStyle}}" src="/img/empty.png">',controllerAs:"$ctrl",bindings:{imgUrl:"@",imgStyle:"@",imgClass:"@",rotate:"<",fullscreen:"<",maxHeight:"<",forceMjpg:"<",maxRefresh:"<"},controller:["RSCom","$rootScope","User","$element","$scope","$q",function(t,e,i,r,n,o){let a=this,l=null,h=!1,u=!1,c=100,f=null,d=null,m=null;n.frames=0;let p=null,v=null,g=0,_=null,x=!1,b=()=>{n.frames=g,g=0};a.myStyle="",a.myStyleMargin="",a.myStyleTrans="",a.myStyleMaxHeight="",a.myStyleExtra="";let y=-1,S=!1,w=!0,M,C;typeof document.hidden!="undefined"?(M="hidden",C="visibilitychange"):typeof document.msHidden!="undefined"?(M="msHidden",C="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(M="webkitHidden",C="webkitvisibilitychange");function E(){if(!_)return;let O=_.offsetWidth,D=_.offsetHeight,F="0px",B="0px",U=O,G=D,Y=1,re=0,N;switch(a.rotate){case 0:case 180:U=O,G=D,N="height:100vh; max-height:100vh;";break;case 90:case 270:U=D,G=O,a.maxHeight&&a.maxHeight<G&&(Y=a.maxHeight/G,re=(-(G-a.maxHeight)/2).toFixed(0)+"px"),F=Math.max(0,Math.round((O-D)/2)).toFixed(0)+"px",N="width:100vh; max-width:100vh;";break}if(U>0&&G>0){let z="translateY("+re+") scale("+Y+") rotate("+a.rotate+"deg)";a.myStyleTrans=`-webkit-transform:${z};-ms-transform:${z};transform:${z};`,a.myStyleMargin=`margin:${F} ${B}; object-fit:contain;`}a.myStyle=a.myStyleMargin+a.myStyleTrans+a.myStyleMaxHeight,a.myStyle+=a.fullscreen?N:a.myStyleExtra}function P(){f&&(URL.revokeObjectURL(f),f=null),d&&(URL.revokeObjectURL(d),d=null)}function A(){if(l)return;m&&clearInterval(m),x=!0,h=!1,u=!1,l=new WebSocket(S);let O=l;l.onopen=function(){if(l===null){O.close();return}h=!0,l.send("next"),a.maxRefresh||l.send("next")},l.onerror=function(D){},l.onclose=function(){if(h=!1,P(),u!==!1){u.resolve();return}l=null,c*=2,c>5e3&&(c=5e3),setTimeout(A,c)},l.onmessage=function(D){c=100,f===null?(f=(window.URL||window.webkitURL).createObjectURL(D.data),_.src=f):d===null&&(d=(window.URL||window.webkitURL).createObjectURL(D.data)),g++}}function R(){if(m&&clearInterval(m),l==null){let O=o.defer();return O.resolve(),O.promise}return u=o.defer(),x=!1,h&&l.close(),l=null,u.promise}let k=[];function I(O){O&&(k.length>1?k=[k[0],O]:k.push(O));function D(F){P(),S=F,F.startsWith("/printer/cammjpg/")?a.forceMjpg||!1?(y=2,_.src=S,x=!0,u=!1):(y=1,S=(t.isSecure()?"wss://":"ws://")+window.location.host+"/socket/mjpg/"+F.substr(17),A()):(u=!1,y=0,_.src=S,x=!0),k.length&&I(!1)}k.length!==0&&(O=k.shift(),O!==S&&(y===1?R().then(()=>{D(O)}):D(O)))}this.$onChanges=function(O){O.imgUrl&&y!==-1&&I(this.imgUrl),O.imgStyle&&y!==-1&&(a.myStyleExtra=this.imgStyle,E()),O.imgClass&&y!==-1&&(_.className=this.imgClass||""),O.maxHeight&&(a.myStyleMaxHeight=this.maxHeight?`max-height:${this.maxHeight}px;`:"",E()),O.rotate&&E(),O.fullscreen&&E()};function L(){y===1&&h&&(f&&(URL.revokeObjectURL(this.src),f=null),d?(f=d,d=null,this.src=f):l&&(a.maxRefresh?setTimeout(()=>{l&&l.send("next")},a.maxRefresh):l.send("next")))}function T(){let O=w&&!document[M];y<1||x===O||(x=O,x?y===2?_.src=S:y===1&&(u===!1?A():u.promise.then(()=>{A()})):y===2?_.src="/img/nowebcam.png":y===1&&u===!1&&R())}this.$postLink=()=>{_=$("img",r)[0],_.onload=L,a.myStyleExtra=_.style=this.imgStyle||"",_.className=this.imgClass||"",I(this.imgUrl),p=new IntersectionObserver(O=>{w=O[0].isIntersecting,T(),!(y<1||x===O[0].isIntersecting)&&(x=O[0].isIntersecting,x?y===2?_.src=S:y===1&&A():y===2?_.src="/img/nowebcam.png":y===1&&R())},{}),p.observe(_),v=new M3(O=>{E()}),v.observe(_),document.addEventListener(C,T,!1),E()},this.$onDestroy=function(){p&&p.disconnect(),v&&v.disconnect(),document.removeEventListener(C,T,!1),R(),P(),_.src="/img/empty.png"}}]});var L3=hn(A3()),O3=hn(P3()),D3=hn(R3());RSPrinterModule.component("rsTerminal",{template:`<div style="width:100%; height:100%; position:absolute; padding:10px; background:#000000; opacity: 0.8">
<div style="width:100%; height:100%; overflow-x: hidden; box-sizing: border-box;" class="rs-terminal"></div>
<div ng-if="$ctrl.closed" style="position: absolute; left:0; right:0; top:0" class="text-white bg-info"><?php _('Terminal closed') ?></div>
</div>`,bindings:{callback:"<",channel:"<",readonly:"<"},controller:["$rootScope","Fullscreen","$element","$interval","RSCom","$scope","$timeout","Confirm",function(t,e,i,r,n,o,a,l){let h={cursorStyle:"bar",cursorBlink:!0,disableStdin:this.readonly===!0},u=new TextDecoder,c="",f=new L3.Terminal(h),d=new O3.FitAddon,m=new D3.WebLinksAddon,p=80,v=24;f.loadAddon(d),f.loadAddon(m),this.closed=!1,this.paused=!1;let g=()=>{this.paused||(this.paused=!0,this.channel&&n.send("terminal",{id:this.channel,a:"pause",data:""}))},_=k=>{this.channel&&!this.closed&&(k.id=this.channel,n.send("terminal",k))},x=()=>{this.paused&&(this.paused=!1,_({a:"resume",data:""}))},b=1e5,y=1e4,S=0;f.open($(".rs-terminal",i)[0]),f.onData(k=>{_({a:"send",data:k})});let w=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g"),M=new RegExp(`[\r
]`,"g"),C=t.$on("terminal",(k,I)=>{if(I.data.id!==this.channel)return;let L=I.data.a;if(L==="recv"){let O=window.atob(I.data.data.replace(M,"")),D=O.length,F=new Uint8Array(D);for(let B=0;B<D;B++)F[B]=O.charCodeAt(B);if(this.callback&&this.callback.onLine)for(c+=u.decode(F);c.length>0;){let B=c.indexOf(`
`);if(B<0)break;var T=c.substring(0,B).trim().replace(w,"");this.callback.onLine(T),c=c.substring(B+1)}S+=D,f.write(F,()=>{S=Math.max(S-D,0),S<y&&x()}),S>b&&g()}else L==="close"&&(this.callback&&this.callback.onClose&&this.callback.onClose(),this.closed=!0)}),E=()=>{a(()=>{try{let k=d.proposeDimensions();k&&k.cols&&k.rows&&(k.cols!==p||k.rows!==v)&&(p=k.cols,v=k.rows,_({a:"resize",rows:k.rows,cols:k.cols})),f._core._renderService.clear(),f.resize(k.cols,k.rows),f.scrollToBottom()}catch(k){console.error(k)}},0)},P=()=>{if(this.closed){r.cancel(A),A=!1;return}_({a:"ping",data:""})},A=r(P,5e3);this.$onChanges=function(k){k.channel&&(this.closed=!1,this.paused=!1,_({a:"resize",rows:v,cols:p}),A||(this.pingInterval=r(P,5e3)))};let R=k=>{console.log("canLeaveWindow",this.closed),!this.closed&&_({a:"close",data:""})};window.addEventListener("beforeunload",R,!1),E(),o.$on("windowResized",E),this.readonly!==!0&&f.focus(),this.$onDestroy=()=>{console.log("destroy terminal",this.channel),window.removeEventListener("beforeunload",R),_({a:"close",data:""}),A&&r.cancel(A),d.dispose(),f.dispose(),C()}}]});RSPrinterModule.directive("filamentchange",["$timeout",function(t){return{restrict:"E",templateUrl:"/views/printer/control/filamentchange.php?lang="+window.lang,replace:!0,controller:["$scope","$rootScope","RSCom","RSPrinter",function(e,i,r,n){e.page=0,e.remove=!1,e.t={targetExtruder:-1,fastDistance:0,slowDistance:0,targetTemperature:0},e.startTemperature=0,e.showStart=!1,e.waitForTargetTemp=!1,e.status="",e.filamentWasInserted=!1,e.exlist=[],e.title="<?php _('Change Filament') ?>";let o=!1;e.$on("$destroy",function(){o=!0,e.page===1&&n.setExtruderTemperature(e.targetExtruder,e.startTemperature)});let a=function(){o||(e.t.targetExtruder===-1&&i.active.state.activeExtruder!==void 0&&i.activeConfig.extruders&&i.activeConfig.extruders.length>0&&(e.t.targetExtruder=i.active.state.activeExtruder,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp,e.exlist=[],angular.forEach(i.activeConfig.extruders,function(c,f){e.exlist.push({id:f,name:n.extruderName(f)})})),e.waitForTargetTemp&&(e.active.state.extruder[e.t.targetExtruder].tempRead>=e.t.targetTemperature-.7?l():e.status="<?php _('Heating') ?>..."+i.active.state.extruder[e.t.targetExtruder].tempRead.toFixed(1)+"/"+e.t.targetTemperature+"\xB0C"),o||t(a,500))};a(),e.$watch("active.state.activeExtruder",function(c,f){c!==e.t.targetExtruder&&(e.t.targetExtruder=c,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp)}),e.setExtruder=function(c){n.selectExtruder(c),i.active.state.activeExtruder=c,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp},e.setTargetTemp=function(){},e.setFastDistance=function(){},e.setSlowDistance=function(){};let l=function(){e.waitForTargetTemp=!1;let c=0;e.remove?(n.runScript("remove_filament"),c=(e.slowDistance+e.fastDistance)/i.activeConfig.extruders[e.t.targetExtruder].retractSpeed,e.status="<?php _('Retracting filament...') ?>",n.eMoveRel(-(e.t.fastDistance+e.t.slowDistance),e.activeConfig.extruders[e.t.targetExtruder].retractSpeed),t(function(){e.status="<?php _('Use extrude or retract if necessary.') ?>"},c*1e3)):(e.status="<?php _('Put filament in extruder and press Start to insert.') ?>",e.showStart=!0)};e.startPressed=function(){e.showStart=!1,n.runScript("insert_filament");let c=e.t.slowDistance/e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed+e.t.fastDistance/e.activeConfig.extruders[e.t.targetExtruder].retractSpeed;e.status="<?php _('Inserting filament...') ?>",n.eMoveRel(e.t.fastDistance,e.activeConfig.extruders[e.t.targetExtruder].retractSpeed),n.eMoveRel(e.t.slowDistance,e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed),t(function(){e.status="<?php _('Use extrude or retract if necessary.') ?>"},c*1e3)};let h=function(){(e.t.fastDistance!==e.activeConfig.extruders[e.t.targetExtruder].changeFastDistance||e.t.slowDistance!==e.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance)&&(e.activeConfig.extruders[e.t.targetExtruder].changeFastDistance=e.t.fastDistance,e.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance=e.t.slowDistance,r.send("setPrinterConfig",e.activeConfig))},u=function(){e.activeConfig.extruders[e.t.targetExtruder].supportTemperature?(e.startTemperature=e.active.state.extruder[e.t.targetExtruder].tempSet,n.setExtruderTemperature(e.t.targetExtruder,e.t.targetTemperature),e.waitForTargetTemp=!0,n.setExtruderTemperature(e.t.targetExtruder,e.t.targetTemperature),e.status="<?php _('Heating') ?>..."+i.active.state.extruder[e.t.targetExtruder].tempRead.toFixed(1)+"/"+e.t.targetTemperature+"\xB0C"):l()};e.removeFilament=function(){e.remove=!0,e.title="<?php _('Remove Filament') ?>",e.page=1,e.showStart=!1,e.filamentWasInserted=!1,h(),u()},e.insertFilament=function(){e.remove=!1,e.title="<?php _('Insert Filament') ?>",e.page=1,e.showStart=!1,e.filamentWasInserted=!0,h(),u()},e.cancel=function(){e.page===1&&(e.filamentWasInserted&&n.runScript("insert_filament_finished"),n.setExtruderTemperature(e.targetExtruder,e.startTemperature)),e.page=0},e.insertMore=function(c){n.eMoveRel(c,e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed)},e.removeMore=function(c){n.eMoveRel(-c,e.activeConfig.extruders[e.t.targetExtruder].retractSpeed)}}]}}]);RSPrinterModule.controller("HomeController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state","IPS","User","Theme","localStorageService","RSPrinter","PrinterConditionDialog","Flash",function(t,e,i,r,n,o,a,l,h,u,c,f,d){e.setOverride("hideLeft",!0),e.titlePrepend="",t.showCam=!1,t.menuTheme=!1,t.menuAddPrinter=!1,t.menuOrder=!1,t.menuEmergency={},t.theme=h,r.selectPrinter(""),t.ips=a,window.scrollTo(0,0),t.disk={},t.update={},t.menuContext={},t.closeContext=function(p){t.menuContext[p]=!1},t.printerOrder=l.getSetting("printerOrder","dynamic"),t.setPrinterOrder=function(p){t.menuOrder=!1,l.setSetting("printerOrder",p),t.printerOrder=p,r.updatePrintersNew()},t.showMaxActiveInfo=()=>{d.error("<?php _('Active Printer Limit') ?>","<?php _('Your active license only allows up to @ active printers. Please activate a proper license for the planned amount of printers.') ?>".replace("@",""+t.licence.maxActivePrinter),2e4,!0)},t.showPrinterCondition=function(p){f(p)};let m=function(){n.send("freeSpace",{}).then(function(p){t.disk=p,t.disk.usage=100-100*(p.available/p.capacity),p.capacity<1e3*1024*1024?t.disk.class="progress-bar-warning":p.capacity<500*1024*1024?t.disk.class="progress-bar-danger":t.disk.class="progress-bar-success"}),n.send("getLicenceData",{}).then(function(p){t.licence=p})};t.$on("connected",m),t.ignoreVersion=function(){n.send("ignoreUpdate",{}),m()},t.$on("$destroy",()=>{e.setOverride("hideLeft",!1)}),t.showPrinter=function(p){let v=c.getActivePage(p,{state:"printer.print",params:{slug:p}});o.get(v.state)?o.go(v.state,v.params):o.go("printer.print",v.params)},t.canShowCam=function(p){return t.showCam&&e.printerConfig&&e.printerConfig[p]&&typeof e.printerConfig[p].webcams=="object"&&e.printerConfig[p].webcams.length>0&&(t.printerConfig[p].webcams[0].method&3)!==0},t.setTheme=function(p){l.setSetting("theme",p),h.setMode(p)},t.closeTheme=function(){t.menuTheme=!1},t.closeAddPrinter=function(){t.menuAddPrinter=!1},t.closeOrder=function(){t.menuOrder=!1},t.closeEmergency=function(p){t.menuEmergency[p]=!1},m(),t.storeCam=function(){u.set("v1HomeShowCam",t.showCam)},e.printerListActive.length<=30&&u.get("v1HomeShowCam")!==null&&(t.showCam=u.get("v1HomeShowCam"))}]);RSPrinterModule.controller("StartController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state",function(t,e,i,r,n,o){r.printerListLoadedPromise.then(function(){let a=0,l;angular.forEach(e.printerList,function(h){h.active&&(a++,a===1&&(l=h))}),a===1?o.go("printer.print",{slug:l.slug}):o.go("home")},function(){})}]);RSPrinterModule.controller("TroubleshootingController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state","$interval",function(t,e,i,r,n,o,a){t.wd={};function l(f,d=!1){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){(f.scrollTop>=f.scrollHeight-350||!d)&&(f.scrollTop=f.scrollHeight)})})}function h(){let f=document.getElementById("logpanel");f||setTimeout(h,50),n.send("getLastErrors",{}).then(d=>{if(f){let m="";d.data.forEach(p=>{m+='<div class="logError">'+p.toString()+"</div>"}),f.innerHTML=m,l(f)}})}h(),t.$on("addErrorLogLine",function(){let f=document.getElementById("logpanel");if(f){let d=document.createElement("div");d.className="logError",n.send("getLastErrors",{}).then(m=>{d.append(m.data[m.data.length-1]),f.append(d)}),f.childElementCount>200&&f.removeChild(f.firstChild),l(f,!0)}});let u=function(){n.send("WDispatcherStatus",{}).then(function(f){t.wd=f})},c=a(u,1e3);t.$on("$destroy",function(){a.cancel(c)}),t.stopExt=function(){n.send("WDispatcherStopExt",{})},t.stopInt=function(){n.send("WDispatcherStopInt",{})},u()}]);function $Y(t){var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){return e.reject(i)})})}var I3=$Y;function eZ(t){var e=this;return new e(function(i,r){if(!(t&&typeof t.length!="undefined"))return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var n=Array.prototype.slice.call(t);if(n.length===0)return i([]);var o=n.length;function a(h,u){if(u&&(typeof u=="object"||typeof u=="function")){var c=u.then;if(typeof c=="function"){c.call(u,function(f){a(h,f)},function(f){n[h]={status:"rejected",reason:f},--o===0&&i(n)});return}}n[h]={status:"fulfilled",value:u},--o===0&&i(n)}for(var l=0;l<n.length;l++)a(l,n[l])})}var k3=eZ;function F3(t,e){this.name="AggregateError",this.errors=t,this.message=e||""}F3.prototype=Error.prototype;function tZ(t){var e=this;return new e(function(i,r){if(!(t&&typeof t.length!="undefined"))return r(new TypeError("Promise.any accepts an array"));var n=Array.prototype.slice.call(t);if(n.length===0)return r();for(var o=[],a=0;a<n.length;a++)try{e.resolve(n[a]).then(i).catch(function(l){o.push(l),o.length===n.length&&r(new F3(o,"All promises were rejected"))})}catch(l){r(l)}})}var B3=tZ;var iZ=setTimeout;function N3(t){return!!(t&&typeof t.length!="undefined")}function rZ(){}function nZ(t,e){return function(){t.apply(e,arguments)}}function vi(t){if(!(this instanceof vi))throw new TypeError("Promises must be constructed via new");if(typeof t!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],z3(t,this)}function U3(t,e){for(;t._state===3;)t=t._value;if(t._state===0){t._deferreds.push(e);return}t._handled=!0,vi._immediateFn(function(){var i=t._state===1?e.onFulfilled:e.onRejected;if(i===null){(t._state===1?gS:Mf)(e.promise,t._value);return}var r;try{r=i(t._value)}catch(n){Mf(e.promise,n);return}gS(e.promise,r)})}function gS(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var i=e.then;if(e instanceof vi){t._state=3,t._value=e,vS(t);return}else if(typeof i=="function"){z3(nZ(i,e),t);return}}t._state=1,t._value=e,vS(t)}catch(r){Mf(t,r)}}function Mf(t,e){t._state=2,t._value=e,vS(t)}function vS(t){t._state===2&&t._deferreds.length===0&&vi._immediateFn(function(){t._handled||vi._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)U3(t,t._deferreds[e]);t._deferreds=null}function sZ(t,e,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.promise=i}function z3(t,e){var i=!1;try{t(function(r){i||(i=!0,gS(e,r))},function(r){i||(i=!0,Mf(e,r))})}catch(r){if(i)return;i=!0,Mf(e,r)}}vi.prototype.catch=function(t){return this.then(null,t)};vi.prototype.then=function(t,e){var i=new this.constructor(rZ);return U3(this,new sZ(t,e,i)),i};vi.prototype.finally=I3;vi.all=function(t){return new vi(function(e,i){if(!N3(t))return i(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(r.length===0)return e([]);var n=r.length;function o(l,h){try{if(h&&(typeof h=="object"||typeof h=="function")){var u=h.then;if(typeof u=="function"){u.call(h,function(c){o(l,c)},i);return}}r[l]=h,--n===0&&e(r)}catch(c){i(c)}}for(var a=0;a<r.length;a++)o(a,r[a])})};vi.any=B3;vi.allSettled=k3;vi.resolve=function(t){return t&&typeof t=="object"&&t.constructor===vi?t:new vi(function(e){e(t)})};vi.reject=function(t){return new vi(function(e,i){i(t)})};vi.race=function(t){return new vi(function(e,i){if(!N3(t))return i(new TypeError("Promise.race accepts an array"));for(var r=0,n=t.length;r<n;r++)vi.resolve(t[r]).then(e,i)})};vi._immediateFn=typeof setImmediate=="function"&&function(t){setImmediate(t)}||function(t){iZ(t,0)};vi._unhandledRejectionFn=function(e){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var G3=vi;var X3=hn(V3(),1);typeof globalThis=="undefined"&&(typeof self!="undefined"?self.globalThis=self:typeof global!="undefined"&&(global.globalThis=global));globalThis.Promise||(globalThis.Promise=G3);Object.assign||(Object.assign=X3.default);var uZ=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});globalThis.performance&&globalThis.performance.now||(j3=Date.now(),globalThis.performance||(globalThis.performance={}),globalThis.performance.now=function(){return Date.now()-j3});var j3,_S=Date.now(),q3=["ms","moz","webkit","o"];for(Mv=0;Mv<q3.length&&!globalThis.requestAnimationFrame;++Mv)Tv=q3[Mv],globalThis.requestAnimationFrame=globalThis[Tv+"RequestAnimationFrame"],globalThis.cancelAnimationFrame=globalThis[Tv+"CancelAnimationFrame"]||globalThis[Tv+"CancelRequestAnimationFrame"];var Tv,Mv;globalThis.requestAnimationFrame||(globalThis.requestAnimationFrame=function(t){if(typeof t!="function")throw new TypeError(t+"is not a function");var e=Date.now(),i=uZ+_S-e;return i<0&&(i=0),_S=e,globalThis.self.setTimeout(function(){_S=Date.now(),t(performance.now())},i)});globalThis.cancelAnimationFrame||(globalThis.cancelAnimationFrame=function(t){return clearTimeout(t)});Math.sign||(Math.sign=function(e){return e=Number(e),e===0||isNaN(e)?e:e>0?1:-1});Number.isInteger||(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});globalThis.ArrayBuffer||(globalThis.ArrayBuffer=Array);globalThis.Float32Array||(globalThis.Float32Array=Array);globalThis.Uint32Array||(globalThis.Uint32Array=Array);globalThis.Uint16Array||(globalThis.Uint16Array=Array);globalThis.Uint8Array||(globalThis.Uint8Array=Array);globalThis.Int32Array||(globalThis.Int32Array=Array);var wa={};im(wa,{BaseTextureCache:()=>Cn,CanvasRenderTarget:()=>Uv,DATA_URI:()=>PN,EventEmitter:()=>Xs.default,ProgramCache:()=>Nv,TextureCache:()=>Wr,clearTextureCache:()=>WJ,correctBlendMode:()=>Nf,createIndicesForQuads:()=>IS,decomposeDataUri:()=>VJ,deprecation:()=>Gi,destroyTextureCache:()=>HJ,determineCrossOrigin:()=>FS,earcut:()=>Gf.default,getBufferType:()=>zf,getResolutionOfUrl:()=>ba,hex2rgb:()=>Vn,hex2string:()=>Ff,interleaveTypedArrays:()=>zJ,isMobile:()=>nn,isPow2:()=>Fv,isWebGLSupported:()=>OS,log2:()=>Bv,nextPow2:()=>ru,path:()=>AN,premultiplyBlendMode:()=>kv,premultiplyRgba:()=>DS,premultiplyTint:()=>vl,premultiplyTintToRgba:()=>Uf,removeItems:()=>vs,rgb2hex:()=>BJ,sayHello:()=>LS,sign:()=>To,skipHello:()=>ZZ,string2hex:()=>Bf,trimCanvas:()=>kS,uid:()=>qs,url:()=>Mo});var Vs;(function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"})(Vs||(Vs={}));var Yh;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"})(Yh||(Yh={}));var Tf;(function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"})(Tf||(Tf={}));var et;(function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"})(et||(et={}));var tn;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(tn||(tn={}));var Ae;(function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(Ae||(Ae={}));var xa;(function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(xa||(xa={}));var rt;(function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"})(rt||(rt={}));var Af;(function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"})(Af||(Af={}));var Hn;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"})(Hn||(Hn={}));var Ur;(function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Ur||(Ur={}));var zr;(function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"})(zr||(zr={}));var rn;(function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(rn||(rn={}));var Sn;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"})(Sn||(Sn={}));var Zh;(function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"})(Zh||(Zh={}));var Gr;(function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"})(Gr||(Gr={}));var wi;(function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR"})(wi||(wi={}));var Y3;(function(t){t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA"})(Y3||(Y3={}));var $t;(function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"})($t||($t={}));var ms;(function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(ms||(ms={}));var cZ={createCanvas:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var t;return(t=document.baseURI)!==null&&t!==void 0?t:window.location.href},fetch:function(t,e){return fetch(t,e)}},yS=/iPhone/i,Z3=/iPod/i,K3=/iPad/i,Q3=/\biOS-universal(?:.+)Mac\b/i,xS=/\bAndroid(?:.+)Mobile\b/i,J3=/Android/i,Kh=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Av=/Silk/i,Eo=/Windows Phone/i,$3=/\bWindows(?:.+)ARM\b/i,eN=/BlackBerry/i,tN=/BB10/i,iN=/Opera Mini/i,rN=/\b(CriOS|Chrome)(?:.+)Mobile/i,nN=/Mobile(?:.+)Firefox\b/i,sN=function(t){return typeof t!="undefined"&&t.platform==="MacIntel"&&typeof t.maxTouchPoints=="number"&&t.maxTouchPoints>1&&typeof MSStream=="undefined"};function fZ(t){return function(e){return e.test(t)}}function dZ(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof t=="string"?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var i=e.userAgent,r=i.split("[FBAN");typeof r[1]!="undefined"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]!="undefined"&&(i=r[0]);var n=fZ(i),o={apple:{phone:n(yS)&&!n(Eo),ipod:n(Z3),tablet:!n(yS)&&(n(K3)||sN(e))&&!n(Eo),universal:n(Q3),device:(n(yS)||n(Z3)||n(K3)||n(Q3)||sN(e))&&!n(Eo)},amazon:{phone:n(Kh),tablet:!n(Kh)&&n(Av),device:n(Kh)||n(Av)},android:{phone:!n(Eo)&&n(Kh)||!n(Eo)&&n(xS),tablet:!n(Eo)&&!n(Kh)&&!n(xS)&&(n(Av)||n(J3)),device:!n(Eo)&&(n(Kh)||n(Av)||n(xS)||n(J3))||n(/\bokhttp\b/i)},windows:{phone:n(Eo),tablet:n($3),device:n(Eo)||n($3)},other:{blackberry:n(eN),blackberry10:n(tN),opera:n(iN),firefox:n(nN),chrome:n(rN),device:n(eN)||n(tN)||n(iN)||n(nN)||n(rN)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var nn=dZ(globalThis.navigator);function pZ(){return!nn.apple.device}function mZ(t){var e=!0;if(nn.tablet||nn.phone){if(nn.apple.device){var i=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(i){var r=parseInt(i[1],10);r<11&&(e=!1)}}if(nn.android.device){var i=navigator.userAgent.match(/Android\s([0-9.]*)/);if(i){var r=parseInt(i[1],10);r<7&&(e=!1)}}}return e?t:4}var Oe={ADAPTER:cZ,MIPMAP_TEXTURES:zr.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:$t.NONE,SPRITE_MAX_TEXTURES:mZ(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:Zh.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Ur.CLAMP,SCALE_MODE:Hn.LINEAR,PRECISION_VERTEX:Gr.HIGH,PRECISION_FRAGMENT:nn.apple.device?Gr.HIGH:Gr.MEDIUM,CAN_UPLOAD_SAME_BUFFER:pZ(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Xs=hn(aN(),1),Gf=hn(fN(),1),iu=hn(CN(),1);var Mo={parse:iu.parse,format:iu.format,resolve:iu.resolve};function gs(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function EN(t){var e=t.split("?")[0];return e.split("#")[0]}function qZ(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function XZ(t,e,i){return t.replace(new RegExp(qZ(e),"g"),i)}function YZ(t,e){for(var i="",r=0,n=-1,o=0,a,l=0;l<=t.length;++l){if(l<t.length)a=t.charCodeAt(l);else{if(a===47)break;a=47}if(a===47){if(!(n===l-1||o===1))if(n!==l-1&&o===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){var h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",r=0):(i=i.slice(0,h),r=i.length-1-i.lastIndexOf("/")),n=l,o=0;continue}}else if(i.length===2||i.length===1){i="",r=0,n=l,o=0;continue}}e&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+="/"+t.slice(n+1,l):i=t.slice(n+1,l),r=l-n-1;n=l,o=0}else a===46&&o!==-1?++o:o=-1}return i}var AN={toPosix:function(t){return XZ(t,"\\","/")},isUrl:function(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:function(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol:function(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol:function(t){gs(t),t=this.toPosix(t);var e="",i=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),n=/^[^/:]+:\//.exec(t);if(i||r||n){var o=(i==null?void 0:i[0])||(r==null?void 0:r[0])||(n==null?void 0:n[0]);e=o,t=t.slice(o.length)}return e},toAbsolute:function(t,e,i){if(this.isDataUrl(t))return t;var r=EN(this.toPosix(e!=null?e:Oe.ADAPTER.getBaseUrl())),n=EN(this.toPosix(i!=null?i:this.rootname(r)));if(gs(t),t=this.toPosix(t),t.startsWith("/"))return AN.join(n,t.slice(1));var o=this.isAbsolute(t)?t:this.join(r,t);return o},normalize:function(t){if(t=this.toPosix(t),gs(t),t.length===0)return".";var e="",i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));var r=t.endsWith("/");return t=YZ(t,!1),t.length>0&&r&&(t+="/"),i?"/"+t:e+t},isAbsolute:function(t){return gs(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join:function(){for(var t=arguments,e,i=[],r=0;r<arguments.length;r++)i[r]=t[r];if(i.length===0)return".";for(var n,o=0;o<i.length;++o){var a=i[o];if(gs(a),a.length>0)if(n===void 0)n=a;else{var l=(e=i[o-1])!==null&&e!==void 0?e:"";this.extname(l)?n+="/../"+a:n+="/"+a}}return n===void 0?".":this.normalize(n)},dirname:function(t){if(gs(t),t.length===0)return".";t=this.toPosix(t);var e=t.charCodeAt(0),i=e===47,r=-1,n=!0,o=this.getProtocol(t),a=t;t=t.slice(o.length);for(var l=t.length-1;l>=1;--l)if(e=t.charCodeAt(l),e===47){if(!n){r=l;break}}else n=!1;return r===-1?i?"/":this.isUrl(a)?o+t:o:i&&r===1?"//":o+t.slice(0,r)},rootname:function(t){gs(t),t=this.toPosix(t);var e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){var i=t.indexOf("/",e.length);i!==-1?e=t.slice(0,i):e=t,e.endsWith("/")||(e+="/")}return e},basename:function(t,e){gs(t),e&&gs(e),t=this.toPosix(t);var i=0,r=-1,n=!0,o;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,l=-1;for(o=t.length-1;o>=0;--o){var h=t.charCodeAt(o);if(h===47){if(!n){i=o+1;break}}else l===-1&&(n=!1,l=o+1),a>=0&&(h===e.charCodeAt(a)?--a===-1&&(r=o):(a=-1,r=l))}return i===r?r=l:r===-1&&(r=t.length),t.slice(i,r)}for(o=t.length-1;o>=0;--o)if(t.charCodeAt(o)===47){if(!n){i=o+1;break}}else r===-1&&(n=!1,r=o+1);return r===-1?"":t.slice(i,r)},extname:function(t){gs(t),t=this.toPosix(t);for(var e=-1,i=0,r=-1,n=!0,o=0,a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(l===47){if(!n){i=a+1;break}continue}r===-1&&(n=!1,r=a+1),l===46?e===-1?e=a:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||r===-1||o===0||o===1&&e===r-1&&e===i+1?"":t.slice(e,r)},parse:function(t){gs(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=this.toPosix(t);var i=t.charCodeAt(0),r=this.isAbsolute(t),n;e.root=this.rootname(t),r||this.hasProtocol(t)?n=1:n=0;for(var o=-1,a=0,l=-1,h=!0,u=t.length-1,c=0;u>=n;--u){if(i=t.charCodeAt(u),i===47){if(!h){a=u+1;break}continue}l===-1&&(h=!1,l=u+1),i===46?o===-1?o=u:c!==1&&(c=1):o!==-1&&(c=-1)}return o===-1||l===-1||c===0||c===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=t.slice(1,l):e.base=e.name=t.slice(a,l)):(a===0&&r?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"};Oe.RETINA_PREFIX=/@([0-9\.]+)x/;Oe.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var RS=!1,MN="6.5.10";function ZZ(){RS=!0}function LS(t){var e;if(!RS){if(Oe.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var i=[`
 %c %c %c PixiJS `+MN+" - \u2730 "+t+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=globalThis.console).log.apply(e,i)}else globalThis.console&&globalThis.console.log("PixiJS "+MN+" - "+t+" - http://www.pixijs.com/");RS=!0}}var PS;function OS(){return typeof PS=="undefined"&&(PS=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:Oe.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Oe.ADAPTER.getWebGLRenderingContext())return!1;var i=Oe.ADAPTER.createCanvas(),r=i.getContext("webgl",e)||i.getContext("experimental-webgl",e),n=!!(r&&r.getContextAttributes().stencil);if(r){var o=r.getExtension("WEBGL_lose_context");o&&o.loseContext()}return r=null,n}catch(a){return!1}}()),PS}var KZ="#f0f8ff",QZ="#faebd7",JZ="#00ffff",$Z="#7fffd4",eK="#f0ffff",tK="#f5f5dc",iK="#ffe4c4",rK="#000000",nK="#ffebcd",sK="#0000ff",oK="#8a2be2",aK="#a52a2a",lK="#deb887",hK="#5f9ea0",uK="#7fff00",cK="#d2691e",fK="#ff7f50",dK="#6495ed",pK="#fff8dc",mK="#dc143c",gK="#00ffff",vK="#00008b",_K="#008b8b",yK="#b8860b",xK="#a9a9a9",bK="#006400",wK="#a9a9a9",SK="#bdb76b",CK="#8b008b",EK="#556b2f",MK="#ff8c00",TK="#9932cc",AK="#8b0000",PK="#e9967a",RK="#8fbc8f",LK="#483d8b",OK="#2f4f4f",DK="#2f4f4f",IK="#00ced1",kK="#9400d3",FK="#ff1493",BK="#00bfff",NK="#696969",UK="#696969",zK="#1e90ff",GK="#b22222",HK="#fffaf0",WK="#228b22",VK="#ff00ff",jK="#dcdcdc",qK="#f8f8ff",XK="#daa520",YK="#ffd700",ZK="#808080",KK="#008000",QK="#adff2f",JK="#808080",$K="#f0fff0",eQ="#ff69b4",tQ="#cd5c5c",iQ="#4b0082",rQ="#fffff0",nQ="#f0e68c",sQ="#fff0f5",oQ="#e6e6fa",aQ="#7cfc00",lQ="#fffacd",hQ="#add8e6",uQ="#f08080",cQ="#e0ffff",fQ="#fafad2",dQ="#d3d3d3",pQ="#90ee90",mQ="#d3d3d3",gQ="#ffb6c1",vQ="#ffa07a",_Q="#20b2aa",yQ="#87cefa",xQ="#778899",bQ="#778899",wQ="#b0c4de",SQ="#ffffe0",CQ="#00ff00",EQ="#32cd32",MQ="#faf0e6",TQ="#ff00ff",AQ="#800000",PQ="#66cdaa",RQ="#0000cd",LQ="#ba55d3",OQ="#9370db",DQ="#3cb371",IQ="#7b68ee",kQ="#00fa9a",FQ="#48d1cc",BQ="#c71585",NQ="#191970",UQ="#f5fffa",zQ="#ffe4e1",GQ="#ffe4b5",HQ="#ffdead",WQ="#000080",VQ="#fdf5e6",jQ="#808000",qQ="#6b8e23",XQ="#ffa500",YQ="#ff4500",ZQ="#da70d6",KQ="#eee8aa",QQ="#98fb98",JQ="#afeeee",$Q="#db7093",eJ="#ffefd5",tJ="#ffdab9",iJ="#cd853f",rJ="#ffc0cb",nJ="#dda0dd",sJ="#b0e0e6",oJ="#800080",aJ="#663399",lJ="#ff0000",hJ="#bc8f8f",uJ="#4169e1",cJ="#8b4513",fJ="#fa8072",dJ="#f4a460",pJ="#2e8b57",mJ="#fff5ee",gJ="#a0522d",vJ="#c0c0c0",_J="#87ceeb",yJ="#6a5acd",xJ="#708090",bJ="#708090",wJ="#fffafa",SJ="#00ff7f",CJ="#4682b4",EJ="#d2b48c",MJ="#008080",TJ="#d8bfd8",AJ="#ff6347",PJ="#40e0d0",RJ="#ee82ee",LJ="#f5deb3",OJ="#ffffff",DJ="#f5f5f5",IJ="#ffff00",kJ="#9acd32",FJ={aliceblue:KZ,antiquewhite:QZ,aqua:JZ,aquamarine:$Z,azure:eK,beige:tK,bisque:iK,black:rK,blanchedalmond:nK,blue:sK,blueviolet:oK,brown:aK,burlywood:lK,cadetblue:hK,chartreuse:uK,chocolate:cK,coral:fK,cornflowerblue:dK,cornsilk:pK,crimson:mK,cyan:gK,darkblue:vK,darkcyan:_K,darkgoldenrod:yK,darkgray:xK,darkgreen:bK,darkgrey:wK,darkkhaki:SK,darkmagenta:CK,darkolivegreen:EK,darkorange:MK,darkorchid:TK,darkred:AK,darksalmon:PK,darkseagreen:RK,darkslateblue:LK,darkslategray:OK,darkslategrey:DK,darkturquoise:IK,darkviolet:kK,deeppink:FK,deepskyblue:BK,dimgray:NK,dimgrey:UK,dodgerblue:zK,firebrick:GK,floralwhite:HK,forestgreen:WK,fuchsia:VK,gainsboro:jK,ghostwhite:qK,goldenrod:XK,gold:YK,gray:ZK,green:KK,greenyellow:QK,grey:JK,honeydew:$K,hotpink:eQ,indianred:tQ,indigo:iQ,ivory:rQ,khaki:nQ,lavenderblush:sQ,lavender:oQ,lawngreen:aQ,lemonchiffon:lQ,lightblue:hQ,lightcoral:uQ,lightcyan:cQ,lightgoldenrodyellow:fQ,lightgray:dQ,lightgreen:pQ,lightgrey:mQ,lightpink:gQ,lightsalmon:vQ,lightseagreen:_Q,lightskyblue:yQ,lightslategray:xQ,lightslategrey:bQ,lightsteelblue:wQ,lightyellow:SQ,lime:CQ,limegreen:EQ,linen:MQ,magenta:TQ,maroon:AQ,mediumaquamarine:PQ,mediumblue:RQ,mediumorchid:LQ,mediumpurple:OQ,mediumseagreen:DQ,mediumslateblue:IQ,mediumspringgreen:kQ,mediumturquoise:FQ,mediumvioletred:BQ,midnightblue:NQ,mintcream:UQ,mistyrose:zQ,moccasin:GQ,navajowhite:HQ,navy:WQ,oldlace:VQ,olive:jQ,olivedrab:qQ,orange:XQ,orangered:YQ,orchid:ZQ,palegoldenrod:KQ,palegreen:QQ,paleturquoise:JQ,palevioletred:$Q,papayawhip:eJ,peachpuff:tJ,peru:iJ,pink:rJ,plum:nJ,powderblue:sJ,purple:oJ,rebeccapurple:aJ,red:lJ,rosybrown:hJ,royalblue:uJ,saddlebrown:cJ,salmon:fJ,sandybrown:dJ,seagreen:pJ,seashell:mJ,sienna:gJ,silver:vJ,skyblue:_J,slateblue:yJ,slategray:xJ,slategrey:bJ,snow:wJ,springgreen:SJ,steelblue:CJ,tan:EJ,teal:MJ,thistle:TJ,tomato:AJ,turquoise:PJ,violet:RJ,wheat:LJ,white:OJ,whitesmoke:DJ,yellow:IJ,yellowgreen:kJ};function Vn(t,e){return e===void 0&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(t&255)/255,e}function Ff(t){var e=t.toString(16);return e="000000".substring(0,6-e.length)+e,"#"+e}function Bf(t){return typeof t=="string"&&(t=FJ[t.toLowerCase()]||t,t[0]==="#"&&(t=t.slice(1))),parseInt(t,16)}function BJ(t){return(t[0]*255<<16)+(t[1]*255<<8)+(t[2]*255|0)}function NJ(){for(var t=[],e=[],i=0;i<32;i++)t[i]=i,e[i]=i;t[et.NORMAL_NPM]=et.NORMAL,t[et.ADD_NPM]=et.ADD,t[et.SCREEN_NPM]=et.SCREEN,e[et.NORMAL]=et.NORMAL_NPM,e[et.ADD]=et.ADD_NPM,e[et.SCREEN]=et.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}var kv=NJ();function Nf(t,e){return kv[e?1:0][t]}function DS(t,e,i,r){return i=i||new Float32Array(4),r||r===void 0?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function vl(t,e){if(e===1)return(e*255<<24)+t;if(e===0)return 0;var i=t>>16&255,r=t>>8&255,n=t&255;return i=i*e+.5|0,r=r*e+.5|0,n=n*e+.5|0,(e*255<<24)+(i<<16)+(r<<8)+n}function Uf(t,e,i,r){return i=i||new Float32Array(4),i[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(t&255)/255,(r||r===void 0)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function IS(t,e){e===void 0&&(e=null);var i=t*6;if(e=e||new Uint16Array(i),e.length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}function zf(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}var UJ={Float32Array,Uint32Array,Int32Array,Uint8Array};function zJ(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;for(var a=new ArrayBuffer(i*4),l=null,h=0,o=0;o<t.length;o++){var u=e[o],c=t[o],f=zf(c);n[f]||(n[f]=new UJ[f](a)),l=n[f];for(var d=0;d<c.length;d++){var m=(d/u|0)*r+h,p=d%u;l[m+p]=c[d]}h+=u}return new Float32Array(a)}function ru(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function Fv(t){return!(t&t-1)&&!!t}function Bv(t){var e=(t>65535?1:0)<<4;t>>>=e;var i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function vs(t,e,i){var r=t.length,n;if(!(e>=r||i===0)){i=e+i>r?r-e:i;var o=r-i;for(n=e;n<o;++n)t[n]=t[n+i];t.length=o}}function To(t){return t===0?0:t<0?-1:1}var GJ=0;function qs(){return++GJ}var TN={};function Gi(t,e,i){if(i===void 0&&(i=3),!TN[e]){var r=new Error().stack;typeof r=="undefined"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+t):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+t),console.warn(r))),TN[e]=!0}}var Nv={},Wr=Object.create(null),Cn=Object.create(null);function HJ(){var t;for(t in Wr)Wr[t].destroy();for(t in Cn)Cn[t].destroy()}function WJ(){var t;for(t in Wr)delete Wr[t];for(t in Cn)delete Cn[t]}var Uv=function(){function t(e,i,r){this.canvas=Oe.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||Oe.RESOLUTION,this.resize(e,i)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(e,i){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(i*this.resolution)},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=Math.round(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=Math.round(e)},enumerable:!1,configurable:!0}),t}();function kS(t){var e=t.width,i=t.height,r=t.getContext("2d",{willReadFrequently:!0}),n=r.getImageData(0,0,e,i),o=n.data,a=o.length,l={top:null,left:null,right:null,bottom:null},h=null,u,c,f;for(u=0;u<a;u+=4)o[u+3]!==0&&(c=u/4%e,f=~~(u/4/e),l.top===null&&(l.top=f),(l.left===null||c<l.left)&&(l.left=c),(l.right===null||l.right<c)&&(l.right=c+1),(l.bottom===null||l.bottom<f)&&(l.bottom=f));return l.top!==null&&(e=l.right-l.left,i=l.bottom-l.top+1,h=r.getImageData(l.left,l.top,e,i)),{height:i,width:e,data:h}}var PN=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function VJ(t){var e=PN.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}var Iv;function FS(t,e){if(e===void 0&&(e=globalThis.location),t.indexOf("data:")===0)return"";e=e||globalThis.location,Iv||(Iv=document.createElement("a")),Iv.href=t;var i=Mo.parse(Iv.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function ba(t,e){var i=Oe.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):e!==void 0?e:1}var Hf=Math.PI*2,RN=180/Math.PI,LN=Math.PI/180,Ji;(function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"})(Ji||(Ji={}));var Gt=function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.x=0,this.y=0,this.x=e,this.y=i}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},t.prototype.copyTo=function(e){return e.set(this.x,this.y),e},t.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},t.prototype.set=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),this.x=e,this.y=i,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),zv=[new Gt,new Gt,new Gt,new Gt],wt=function(){function t(e,i,r,n){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(n),this.type=Ji.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},t.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},t.prototype.contains=function(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height},t.prototype.intersects=function(e,i){if(!i){var r=this.x<e.x?e.x:this.x,n=this.right>e.right?e.right:this.right;if(n<=r)return!1;var o=this.y<e.y?e.y:this.y,a=this.bottom>e.bottom?e.bottom:this.bottom;return a>o}var l=this.left,h=this.right,u=this.top,c=this.bottom;if(h<=l||c<=u)return!1;var f=zv[0].set(e.left,e.top),d=zv[1].set(e.left,e.bottom),m=zv[2].set(e.right,e.top),p=zv[3].set(e.right,e.bottom);if(m.x<=f.x||d.y<=f.y)return!1;var v=Math.sign(i.a*i.d-i.b*i.c);if(v===0||(i.apply(f,f),i.apply(d,d),i.apply(m,m),i.apply(p,p),Math.max(f.x,d.x,m.x,p.x)<=l||Math.min(f.x,d.x,m.x,p.x)>=h||Math.max(f.y,d.y,m.y,p.y)<=u||Math.min(f.y,d.y,m.y,p.y)>=c))return!1;var g=v*(d.y-f.y),_=v*(f.x-d.x),x=g*l+_*u,b=g*h+_*u,y=g*l+_*c,S=g*h+_*c;if(Math.max(x,b,y,S)<=g*f.x+_*f.y||Math.min(x,b,y,S)>=g*p.x+_*p.y)return!1;var w=v*(f.y-m.y),M=v*(m.x-f.x),C=w*l+M*u,E=w*h+M*u,P=w*l+M*c,A=w*h+M*c;return!(Math.max(C,E,P,A)<=w*f.x+M*f.y||Math.min(C,E,P,A)>=w*p.x+M*p.y)},t.prototype.pad=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this},t.prototype.fit=function(e){var i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),o=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=n,this.height=Math.max(o-n,0),this},t.prototype.ceil=function(e,i){e===void 0&&(e=1),i===void 0&&(i=.001);var r=Math.ceil((this.x+this.width-i)*e)/e,n=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=n-this.y,this},t.prototype.enlarge=function(e){var i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),o=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=n,this.height=o-n,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),ON=function(){function t(e,i,r){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),this.x=e,this.y=i,this.radius=r,this.type=Ji.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(e,i){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-e,o=this.y-i;return n*=n,o*=o,n+o<=r},t.prototype.getBounds=function(){return new wt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},t.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},t}(),DN=function(){function t(e,i,r,n){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=e,this.y=i,this.width=r,this.height=n,this.type=Ji.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(e,i){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,n=(i-this.y)/this.height;return r*=r,n*=n,r+n<=1},t.prototype.getBounds=function(){return new wt(this.x-this.width,this.y-this.height,this.width,this.height)},t.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),nu=function(){function t(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=Array.isArray(i[0])?i[0]:i;if(typeof n[0]!="number"){for(var o=[],a=0,l=n.length;a<l;a++)o.push(n[a].x,n[a].y);n=o}this.points=n,this.type=Ji.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=this.points.slice(),i=new t(e);return i.closeStroke=this.closeStroke,i},t.prototype.contains=function(e,i){for(var r=!1,n=this.points.length/2,o=0,a=n-1;o<n;a=o++){var l=this.points[o*2],h=this.points[o*2+1],u=this.points[a*2],c=this.points[a*2+1],f=h>i!=c>i&&e<(u-l)*((i-h)/(c-h))+l;f&&(r=!r)}return r},t.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(e,i){return e+", "+i},"")+"]")},t}(),IN=function(){function t(e,i,r,n,o){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),o===void 0&&(o=20),this.x=e,this.y=i,this.width=r,this.height=n,this.radius=o,this.type=Ji.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(e,i){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;var n=e-(this.x+r),o=i-(this.y+r),a=r*r;if(n*n+o*o<=a||(n=e-(this.x+this.width-r),n*n+o*o<=a)||(o=i-(this.y+this.height-r),n*n+o*o<=a)||(n=e-(this.x+r),n*n+o*o<=a))return!0}return!1},t.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},t}(),Sa=function(){function t(e,i,r,n){r===void 0&&(r=0),n===void 0&&(n=0),this._x=r,this._y=n,this.cb=e,this.scope=i}return t.prototype.clone=function(e,i){return e===void 0&&(e=this.cb),i===void 0&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(e){return e.set(this._x,this._y),e},t.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Zt=function(){function t(e,i,r,n,o,a){e===void 0&&(e=1),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=0),a===void 0&&(a=0),this.array=null,this.a=e,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=a}return t.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},t.prototype.set=function(e,i,r,n,o,a){return this.a=e,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=a,this},t.prototype.toArray=function(e,i){this.array||(this.array=new Float32Array(9));var r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(e,i){i=i||new Gt;var r=e.x,n=e.y;return i.x=this.a*r+this.c*n+this.tx,i.y=this.b*r+this.d*n+this.ty,i},t.prototype.applyInverse=function(e,i){i=i||new Gt;var r=1/(this.a*this.d+this.c*-this.b),n=e.x,o=e.y;return i.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,i},t.prototype.translate=function(e,i){return this.tx+=e,this.ty+=i,this},t.prototype.scale=function(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this},t.prototype.rotate=function(e){var i=Math.cos(e),r=Math.sin(e),n=this.a,o=this.c,a=this.tx;return this.a=n*i-this.b*r,this.b=n*r+this.b*i,this.c=o*i-this.d*r,this.d=o*r+this.d*i,this.tx=a*i-this.ty*r,this.ty=a*r+this.ty*i,this},t.prototype.append=function(e){var i=this.a,r=this.b,n=this.c,o=this.d;return this.a=e.a*i+e.b*n,this.b=e.a*r+e.b*o,this.c=e.c*i+e.d*n,this.d=e.c*r+e.d*o,this.tx=e.tx*i+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*o+this.ty,this},t.prototype.setTransform=function(e,i,r,n,o,a,l,h,u){return this.a=Math.cos(l+u)*o,this.b=Math.sin(l+u)*o,this.c=-Math.sin(l-h)*a,this.d=Math.cos(l-h)*a,this.tx=e-(r*this.a+n*this.c),this.ty=i-(r*this.b+n*this.d),this},t.prototype.prepend=function(e){var i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this},t.prototype.decompose=function(e){var i=this.a,r=this.b,n=this.c,o=this.d,a=e.pivot,l=-Math.atan2(-n,o),h=Math.atan2(r,i),u=Math.abs(l+h);return u<1e-5||Math.abs(Hf-u)<1e-5?(e.rotation=h,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=l,e.skew.y=h),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(n*n+o*o),e.position.x=this.tx+(a.x*i+a.y*n),e.position.y=this.ty+(a.x*r+a.y*o),e},t.prototype.invert=function(){var e=this.a,i=this.b,r=this.c,n=this.d,o=this.tx,a=e*n-i*r;return this.a=n/a,this.b=-i/a,this.c=-r/a,this.d=e/a,this.tx=(r*this.ty-n*o)/a,this.ty=-(e*this.ty-i*o)/a,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),_l=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],yl=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xl=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],bl=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],BS=[],kN=[],Gv=Math.sign;function jJ(){for(var t=0;t<16;t++){var e=[];BS.push(e);for(var i=0;i<16;i++)for(var r=Gv(_l[t]*_l[i]+xl[t]*yl[i]),n=Gv(yl[t]*_l[i]+bl[t]*yl[i]),o=Gv(_l[t]*xl[i]+xl[t]*bl[i]),a=Gv(yl[t]*xl[i]+bl[t]*bl[i]),l=0;l<16;l++)if(_l[l]===r&&yl[l]===n&&xl[l]===o&&bl[l]===a){e.push(l);break}}for(var t=0;t<16;t++){var h=new Zt;h.set(_l[t],yl[t],xl[t],bl[t],0,0),kN.push(h)}}jJ();var fi={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return _l[t]},uY:function(t){return yl[t]},vX:function(t){return xl[t]},vY:function(t){return bl[t]},inv:function(t){return t&8?t&15:-t&7},add:function(t,e){return BS[t][e]},sub:function(t,e){return BS[t][fi.inv(e)]},rotate180:function(t){return t^4},isVertical:function(t){return(t&3)===2},byDirection:function(t,e){return Math.abs(t)*2<=Math.abs(e)?e>=0?fi.S:fi.N:Math.abs(e)*2<=Math.abs(t)?t>0?fi.E:fi.W:e>0?t>0?fi.SE:fi.SW:t>0?fi.NE:fi.NW},matrixAppendRotationInv:function(t,e,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var n=kN[fi.inv(e)];n.tx=i,n.ty=r,t.append(n)}},Hv=function(){function t(){this.worldTransform=new Zt,this.localTransform=new Zt,this.position=new Sa(this.onChange,this,0,0),this.scale=new Sa(this.onChange,this,1,1),this.pivot=new Sa(this.onChange,this,0,0),this.skew=new Sa(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},t.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(e){var i=this.localTransform;if(this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,n=this.worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=i.tx*r.a+i.ty*r.c+r.tx,n.ty=i.tx*r.b+i.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},t.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();Oe.SORTABLE_CHILDREN=!1;var su=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?wt.EMPTY:(e=e||new wt(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},t.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},t.prototype.addPointMatrix=function(e,i){var r=e.a,n=e.b,o=e.c,a=e.d,l=e.tx,h=e.ty,u=r*i.x+o*i.y+l,c=n*i.x+a*i.y+h;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},t.prototype.addQuad=function(e){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY,a=e[0],l=e[1];i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[2],l=e[3],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[4],l=e[5],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[6],l=e[7],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,this.minX=i,this.minY=r,this.maxX=n,this.maxY=o},t.prototype.addFrame=function(e,i,r,n,o){this.addFrameMatrix(e.worldTransform,i,r,n,o)},t.prototype.addFrameMatrix=function(e,i,r,n,o){var a=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,f=e.ty,d=this.minX,m=this.minY,p=this.maxX,v=this.maxY,g=a*i+h*r+c,_=l*i+u*r+f;d=g<d?g:d,m=_<m?_:m,p=g>p?g:p,v=_>v?_:v,g=a*n+h*r+c,_=l*n+u*r+f,d=g<d?g:d,m=_<m?_:m,p=g>p?g:p,v=_>v?_:v,g=a*i+h*o+c,_=l*i+u*o+f,d=g<d?g:d,m=_<m?_:m,p=g>p?g:p,v=_>v?_:v,g=a*n+h*o+c,_=l*n+u*o+f,d=g<d?g:d,m=_<m?_:m,p=g>p?g:p,v=_>v?_:v,this.minX=d,this.minY=m,this.maxX=p,this.maxY=v},t.prototype.addVertexData=function(e,i,r){for(var n=this.minX,o=this.minY,a=this.maxX,l=this.maxY,h=i;h<r;h+=2){var u=e[h],c=e[h+1];n=u<n?u:n,o=c<o?c:o,a=u>a?u:a,l=c>l?c:l}this.minX=n,this.minY=o,this.maxX=a,this.maxY=l},t.prototype.addVertices=function(e,i,r,n){this.addVerticesMatrix(e.worldTransform,i,r,n)},t.prototype.addVerticesMatrix=function(e,i,r,n,o,a){o===void 0&&(o=0),a===void 0&&(a=o);for(var l=e.a,h=e.b,u=e.c,c=e.d,f=e.tx,d=e.ty,m=this.minX,p=this.minY,v=this.maxX,g=this.maxY,_=r;_<n;_+=2){var x=i[_],b=i[_+1],y=l*x+u*b+f,S=c*b+h*x+d;m=Math.min(m,y-o),v=Math.max(v,y+o),p=Math.min(p,S-a),g=Math.max(g,S+a)}this.minX=m,this.minY=p,this.maxX=v,this.maxY=g},t.prototype.addBounds=function(e){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY;this.minX=e.minX<i?e.minX:i,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>o?e.maxY:o},t.prototype.addBoundsMask=function(e,i){var r=e.minX>i.minX?e.minX:i.minX,n=e.minY>i.minY?e.minY:i.minY,o=e.maxX<i.maxX?e.maxX:i.maxX,a=e.maxY<i.maxY?e.maxY:i.maxY;if(r<=o&&n<=a){var l=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=r<l?r:l,this.minY=n<h?n:h,this.maxX=o>u?o:u,this.maxY=a>c?a:c}},t.prototype.addBoundsMatrix=function(e,i){this.addFrameMatrix(i,e.minX,e.minY,e.maxX,e.maxY)},t.prototype.addBoundsArea=function(e,i){var r=e.minX>i.x?e.minX:i.x,n=e.minY>i.y?e.minY:i.y,o=e.maxX<i.x+i.width?e.maxX:i.x+i.width,a=e.maxY<i.y+i.height?e.maxY:i.y+i.height;if(r<=o&&n<=a){var l=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=r<l?r:l,this.minY=n<h?n:h,this.maxX=o>u?o:u,this.maxY=a>c?a:c}},t.prototype.pad=function(e,i){e===void 0&&(e=0),i===void 0&&(i=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=i,this.maxY+=i)},t.prototype.addFramePad=function(e,i,r,n,o,a){e-=o,i-=a,r+=o,n+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>n?this.maxY:n},t}();var NS=function(t,e){return NS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},NS(t,e)};function US(t,e){NS(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var ni=function(t){US(e,t);function e(){var i=t.call(this)||this;return i.tempDisplayObjectParent=null,i.transform=new Hv,i.alpha=1,i.visible=!0,i.renderable=!0,i.cullable=!1,i.cullArea=null,i.parent=null,i.worldAlpha=1,i._lastSortedIndex=0,i._zIndex=0,i.filterArea=null,i.filters=null,i._enabledFilters=null,i._bounds=new su,i._localBounds=null,i._boundsID=0,i._boundsRect=null,i._localBoundsRect=null,i._mask=null,i._maskRefCount=0,i._destroyed=!1,i.isSprite=!1,i.isMask=!1,i}return e.mixin=function(i){for(var r=Object.keys(i),n=0;n<r.length;++n){var o=r[n];Object.defineProperty(e.prototype,o,Object.getOwnPropertyDescriptor(i,o))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(i,r){return i||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new wt),r=this._boundsRect),this._bounds.getRectangle(r)},e.prototype.getLocalBounds=function(i){i||(this._localBoundsRect||(this._localBoundsRect=new wt),i=this._localBoundsRect),this._localBounds||(this._localBounds=new su);var r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var o=this._bounds,a=this._boundsID;this._bounds=this._localBounds;var l=this.getBounds(!1,i);return this.parent=n,this.transform=r,this._bounds=o,this._bounds.updateID+=this._boundsID-a,l},e.prototype.toGlobal=function(i,r,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(i,r)},e.prototype.toLocal=function(i,r,n,o){return r&&(i=r.toGlobal(i,n,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(i,n)},e.prototype.setParent=function(i){if(!i||!i.addChild)throw new Error("setParent: Argument must be a Container");return i.addChild(this),i},e.prototype.setTransform=function(i,r,n,o,a,l,h,u,c){return i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=1),a===void 0&&(a=0),l===void 0&&(l=0),h===void 0&&(h=0),u===void 0&&(u=0),c===void 0&&(c=0),this.position.x=i,this.position.y=r,this.scale.x=n||1,this.scale.y=o||1,this.rotation=a,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=c,this},e.prototype.destroy=function(i){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new zS),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var i=this.parent;return this.parent=this._tempDisplayObjectParent,i},e.prototype.disableTempParent=function(i){this.parent=i},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(i){this.transform.position.x=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(i){this.transform.position.y=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(i){this.transform.position.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(i){this.transform.scale.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(i){this.transform.pivot.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(i){this.transform.skew.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(i){this.transform.rotation=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*RN},set:function(i){this.transform.rotation=i*LN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(i){this._zIndex=i,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var i=this;do{if(!i.visible)return!1;i=i.parent}while(i);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(i){if(this._mask!==i){if(this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=i,this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}},enumerable:!1,configurable:!0}),e}(Xs.default),zS=function(t){US(e,t);function e(){var i=t!==null&&t.apply(this,arguments)||this;return i.sortDirty=null,i}return e}(ni);ni.prototype.displayObjectUpdateTransform=ni.prototype.updateTransform;function qJ(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}var di=function(t){US(e,t);function e(){var i=t.call(this)||this;return i.children=[],i.sortableChildren=Oe.SORTABLE_CHILDREN,i.sortDirty=!1,i}return e.prototype.onChildrenChange=function(i){},e.prototype.addChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.addChild(r[o]);else{var a=r[0];a.parent&&a.parent.removeChild(a),a.parent=this,this.sortDirty=!0,a.transform._parentID=-1,this.children.push(a),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",a,this,this.children.length-1),a.emit("added",this)}return r[0]},e.prototype.addChildAt=function(i,r){if(r<0||r>this.children.length)throw new Error(i+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(r,0,i),this._boundsID++,this.onChildrenChange(r),i.emit("added",this),this.emit("childAdded",i,this,r),i},e.prototype.swapChildren=function(i,r){if(i!==r){var n=this.getChildIndex(i),o=this.getChildIndex(r);this.children[n]=r,this.children[o]=i,this.onChildrenChange(n<o?n:o)}},e.prototype.getChildIndex=function(i){var r=this.children.indexOf(i);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},e.prototype.setChildIndex=function(i,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(i);vs(this.children,n,1),this.children.splice(r,0,i),this.onChildrenChange(r)},e.prototype.getChildAt=function(i){if(i<0||i>=this.children.length)throw new Error("getChildAt: Index ("+i+") does not exist.");return this.children[i]},e.prototype.removeChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.removeChild(r[o]);else{var a=r[0],l=this.children.indexOf(a);if(l===-1)return null;a.parent=null,a.transform._parentID=-1,vs(this.children,l,1),this._boundsID++,this.onChildrenChange(l),a.emit("removed",this),this.emit("childRemoved",a,this,l)}return r[0]},e.prototype.removeChildAt=function(i){var r=this.getChildAt(i);return r.parent=null,r.transform._parentID=-1,vs(this.children,i,1),this._boundsID++,this.onChildrenChange(i),r.emit("removed",this),this.emit("childRemoved",r,this,i),r},e.prototype.removeChildren=function(i,r){i===void 0&&(i=0),r===void 0&&(r=this.children.length);var n=i,o=r,a=o-n,l;if(a>0&&a<=o){l=this.children.splice(n,a);for(var h=0;h<l.length;++h)l[h].parent=null,l[h].transform&&(l[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(var h=0;h<l.length;++h)l[h].emit("removed",this),this.emit("childRemoved",l[h],this,h);return l}else if(a===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var i=!1,r=0,n=this.children.length;r<n;++r){var o=this.children[r];o._lastSortedIndex=r,!i&&o.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(qJ),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,r=this.children.length;i<r;++i){var n=this.children[i];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var r=this.children[i];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var n=r._mask.isMaskData?r._mask.maskObject:r._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)):this._bounds.addBounds(r._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(i,r){r===void 0&&(r=!1);var n=t.prototype.getLocalBounds.call(this,i);if(!r)for(var o=0,a=this.children.length;o<a;++o){var l=this.children[o];l.visible&&l.updateTransform()}return n},e.prototype._calculateBounds=function(){},e.prototype._renderWithCulling=function(i){var r=i.renderTexture.sourceFrame;if(r.width>0&&r.height>0){var n,o;if(this.cullArea?(n=this.cullArea,o=this.worldTransform):this._render!==e.prototype._render&&(n=this.getBounds(!0)),n&&r.intersects(n,o))this._render(i);else if(this.cullArea)return;for(var a=0,l=this.children.length;a<l;++a){var h=this.children[a],u=h.cullable;h.cullable=u||!this.cullArea,h.render(i),h.cullable=u}}},e.prototype.render=function(i){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(i);else if(this.cullable)this._renderWithCulling(i);else{this._render(i);for(var r=0,n=this.children.length;r<n;++r)this.children[r].render(i)}},e.prototype.renderAdvanced=function(i){var r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var o=0;o<r.length;o++)r[o].enabled&&this._enabledFilters.push(r[o])}var a=r&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==wi.NONE));if(a&&i.batch.flush(),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.push(this,this._enabledFilters),n&&i.mask.push(this,this._mask),this.cullable)this._renderWithCulling(i);else{this._render(i);for(var o=0,l=this.children.length;o<l;++o)this.children[o].render(i)}a&&i.batch.flush(),n&&i.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.pop()},e.prototype._render=function(i){},e.prototype.destroy=function(i){t.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof i=="boolean"?i:i&&i.children,n=this.removeChildren(0,this.children.length);if(r)for(var o=0;o<n.length;++o)n[o].destroy(i)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(i){var r=this.getLocalBounds().width;r!==0?this.scale.x=i/r:this.scale.x=1,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(i){var r=this.getLocalBounds().height;r!==0?this.scale.y=i/r:this.scale.y=1,this._height=i},enumerable:!1,configurable:!0}),e}(ni);di.prototype.containerUpdateTransform=di.prototype.updateTransform;var Wf=function(){return Wf=Object.assign||function(e){for(var i=arguments,r,n=1,o=arguments.length;n<o;n++){r=i[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Wf.apply(this,arguments)},At;(function(t){t.Application="application",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Loader="loader",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser"})(At||(At={}));var FN=function(t){if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");var e=typeof t.extension!="object"?{type:t.extension}:t.extension;t=Wf(Wf({},e),{ref:t})}if(typeof t=="object")t=Wf({},t);else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},En={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var t=arguments,e=this,i=[],r=0;r<arguments.length;r++)i[r]=t[r];return i.map(FN).forEach(function(n){n.type.forEach(function(o){var a,l;return(l=(a=e._removeHandlers)[o])===null||l===void 0?void 0:l.call(a,n)})}),this},add:function(){for(var t=arguments,e=this,i=[],r=0;r<arguments.length;r++)i[r]=t[r];return i.map(FN).forEach(function(n){n.type.forEach(function(o){var a=e._addHandlers,l=e._queue;a[o]?a[o](n):(l[o]=l[o]||[],l[o].push(n))})}),this},handle:function(t,e,i){var r=this._addHandlers=this._addHandlers||{},n=this._removeHandlers=this._removeHandlers||{};if(r[t]||n[t])throw new Error("Extension type "+t+" already has a handler");r[t]=e,n[t]=i;var o=this._queue;return o[t]&&(o[t].forEach(function(a){return e(a)}),delete o[t]),this},handleByMap:function(t,e){return this.handle(t,function(i){e[i.name]=i.ref},function(i){delete e[i.name]})},handleByList:function(t,e){return this.handle(t,function(i){var r,n;e.includes(i.ref)||(e.push(i.ref),t===At.Loader&&((n=(r=i.ref).add)===null||n===void 0||n.call(r)))},function(i){var r=e.indexOf(i.ref);r!==-1&&e.splice(r,1)})}};var sr=function(){function t(e){this.items=[],this._name=e,this._aliasCount=0}return t.prototype.emit=function(e,i,r,n,o,a,l,h){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,f=u.items;this._aliasCount++;for(var d=0,m=f.length;d<m;d++)f[d][c](e,i,r,n,o,a,l,h);return f===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},t.prototype.remove=function(e){var i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this},t.prototype.contains=function(e){return this.items.indexOf(e)!==-1},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(sr.prototype,{dispatch:{value:sr.prototype.emit},run:{value:sr.prototype.emit}});Oe.TARGET_FPMS=.06;var jn;(function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"})(jn||(jn={}));var GS=function(){function t(e,i,r,n){i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=n}return t.prototype.match=function(e,i){return i===void 0&&(i=null),this.fn===e&&this.context===i},t.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i},t.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},t.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var i=this.next;return this.next=e?null:i,this.previous=null,i},t}(),Pi=function(){function t(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new GS(null,null,1/0),this.deltaMS=1/Oe.TARGET_FPMS,this.elapsedMS=1/Oe.TARGET_FPMS,this._tick=function(i){e._requestId=null,e.started&&(e.update(i),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return t.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(e,i,r){return r===void 0&&(r=jn.NORMAL),this._addListener(new GS(e,i,r))},t.prototype.addOnce=function(e,i,r){return r===void 0&&(r=jn.NORMAL),this._addListener(new GS(e,i,r,!0))},t.prototype._addListener=function(e){var i=this._head.next,r=this._head;if(!i)e.connect(r);else{for(;i;){if(e.priority>i.priority){e.connect(r);break}r=i,i=i.next}e.previous||e.connect(r)}return this._startIfPossible(),this},t.prototype.remove=function(e,i){for(var r=this._head.next;r;)r.match(e,i)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,i=this._head;i=i.next;)e++;return e},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(e){e===void 0&&(e=performance.now());var i;if(e>this.lastTime){if(i=this.elapsedMS=e-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*Oe.TARGET_FPMS;for(var n=this._head,o=n.next;o;)o=o.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var i=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,i)/1e3,Oe.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var i=Math.max(this.minFPS,e);this._minElapsedMS=1/(i/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),BN=function(){function t(){}return t.init=function(e){var i=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,jn.LOW)},get:function(){return this._ticker}}),this.stop=function(){i._ticker.stop()},this.start=function(){i._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Pi.shared:new Pi,e.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},t.extension=At.Application,t}();Oe.PREFER_ENV=nn.any?Vs.WEBGL:Vs.WEBGL2;Oe.STRICT_TEXTURE_CACHE=!1;var Zv=[];function iC(t,e){if(!t)return null;var i="";if(typeof t=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var n=Zv.length-1;n>=0;--n){var o=Zv[n];if(o.test&&o.test(t,i))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var $S=function(t,e){return $S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},$S(t,e)};function si(t,e){$S(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var eC=function(){return eC=Object.assign||function(e){for(var i=arguments,r,n=1,o=arguments.length;n<o;n++){r=i[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},eC.apply(this,arguments)};function XJ(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i}var au=function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new sr("setRealSize"),this.onUpdate=new sr("update"),this.onError=new sr("onError")}return t.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},t.prototype.resize=function(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(e,i,r){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(e,i){return!1},t}(),Sl=function(t){si(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height;if(!a||!l)throw new Error("BufferResource width or height invalid");return n=t.call(this,a,l)||this,n.data=i,n}return e.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===rn.UNPACK);var a=r.realWidth,l=r.realHeight;return n.width===a&&n.height===l?o.texSubImage2D(r.target,0,0,0,a,l,r.format,n.type,this.data):(n.width=a,n.height=l,o.texImage2D(r.target,0,n.internalFormat,a,l,0,r.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(i){return i instanceof Float32Array||i instanceof Uint8Array||i instanceof Uint32Array},e}(au),YJ={scaleMode:Hn.NEAREST,format:Ae.RGBA,alphaMode:rn.NPM},St=function(t){si(e,t);function e(i,r){i===void 0&&(i=null),r===void 0&&(r=null);var n=t.call(this)||this;r=r||{};var o=r.alphaMode,a=r.mipmap,l=r.anisotropicLevel,h=r.scaleMode,u=r.width,c=r.height,f=r.wrapMode,d=r.format,m=r.type,p=r.target,v=r.resolution,g=r.resourceOptions;return i&&!(i instanceof au)&&(i=iC(i,g),i.internal=!0),n.resolution=v||Oe.RESOLUTION,n.width=Math.round((u||0)*n.resolution)/n.resolution,n.height=Math.round((c||0)*n.resolution)/n.resolution,n._mipmap=a!==void 0?a:Oe.MIPMAP_TEXTURES,n.anisotropicLevel=l!==void 0?l:Oe.ANISOTROPIC_LEVEL,n._wrapMode=f||Oe.WRAP_MODE,n._scaleMode=h!==void 0?h:Oe.SCALE_MODE,n.format=d||Ae.RGBA,n.type=m||rt.UNSIGNED_BYTE,n.target=p||xa.TEXTURE_2D,n.alphaMode=o!==void 0?o:rn.UNPACK,n.uid=qs(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=u>0&&c>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(i),n}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(i,r){var n;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,n=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(i,r,n){return n=n||this.resolution,this.setRealSize(i*n,r*n,n)},e.prototype.setRealSize=function(i,r,n){return this.resolution=n||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(r)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=Fv(this.realWidth)&&Fv(this.realHeight)},e.prototype.setResolution=function(i){var r=this.resolution;return r===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*r)/i,this.height=Math.round(this.height*r)/i,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(i){this.emit("error",this,i)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Cn[this.cacheId],delete Wr[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(i,r,n){n===void 0&&(n=Oe.STRICT_TEXTURE_CACHE);var o=typeof i=="string",a=null;if(o)a=i;else{if(!i._pixiId){var l=r&&r.pixiIdPrefix||"pixiid";i._pixiId=l+"_"+qs()}a=i._pixiId}var h=Cn[a];if(o&&n&&!h)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return h||(h=new e(i,r),h.cacheId=a,e.addToCache(h,a)),h},e.fromBuffer=function(i,r,n,o){i=i||new Float32Array(r*n*4);var a=new Sl(i,{width:r,height:n}),l=i instanceof Float32Array?rt.FLOAT:rt.UNSIGNED_BYTE;return new e(a,Object.assign({},YJ,o||{width:r,height:n,type:l}))},e.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),Cn[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),Cn[r]=i)},e.removeFromCache=function(i){if(typeof i=="string"){var r=Cn[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete Cn[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)delete Cn[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},e._globalBatch=0,e}(Xs.default),rC=function(t){si(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height;n=t.call(this,a,l)||this,n.items=[],n.itemDirtyIds=[];for(var h=0;h<i;h++){var u=new St;n.items.push(u),n.itemDirtyIds.push(-2)}return n.length=i,n._load=null,n.baseTexture=null,n}return e.prototype.initFromArray=function(i,r){for(var n=0;n<this.length;n++)i[n]&&(i[n].castToBaseTexture?this.addBaseTextureAt(i[n].castToBaseTexture(),n):i[n]instanceof au?this.addResourceAt(i[n],n):this.addResourceAt(iC(i[n],r),n))},e.prototype.dispose=function(){for(var i=0,r=this.length;i<r;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(i,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return i.valid&&!this.valid&&this.resize(i.width,i.height),this.items[r].setResource(i),this},e.prototype.bind=function(i){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=i,this.items[r].on("update",i.update,i)},e.prototype.unbind=function(i){t.prototype.unbind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",i.update,i)},e.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.items.map(function(o){return o.resource}).filter(function(o){return o}),n=r.map(function(o){return o.load()});return this._load=Promise.all(n).then(function(){var o=i.items[0],a=o.realWidth,l=o.realHeight;return i.resize(a,l),Promise.resolve(i)}),this._load},e}(au),QN=function(t){si(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height,h,u;return Array.isArray(i)?(h=i,u=i.length):u=i,n=t.call(this,u,{width:a,height:l})||this,h&&n.initFromArray(h,r),n}return e.prototype.addBaseTextureAt=function(i,r){if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(i){t.prototype.bind.call(this,i),i.target=xa.TEXTURE_2D_ARRAY},e.prototype.upload=function(i,r,n){var o=this,a=o.length,l=o.itemDirtyIds,h=o.items,u=i.gl;n.dirtyId<0&&u.texImage3D(u.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,a,0,r.format,n.type,null);for(var c=0;c<a;c++){var f=h[c];l[c]<f.dirtyId&&(l[c]=f.dirtyId,f.valid&&u.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,c,f.resource.width,f.resource.height,1,r.format,n.type,f.resource.source))}return!0},e}(rC),Ao=function(t){si(e,t);function e(i){var r=this,n=i,o=n.naturalWidth||n.videoWidth||n.width,a=n.naturalHeight||n.videoHeight||n.height;return r=t.call(this,o,a)||this,r.source=i,r.noSubImage=!1,r}return e.crossOrigin=function(i,r,n){n===void 0&&r.indexOf("data:")!==0?i.crossOrigin=FS(r):n!==!1&&(i.crossOrigin=typeof n=="string"?n:"anonymous")},e.prototype.upload=function(i,r,n,o){var a=i.gl,l=r.realWidth,h=r.realHeight;if(o=o||this.source,o instanceof HTMLImageElement){if(!o.complete||o.naturalWidth===0)return!1}else if(o instanceof HTMLVideoElement&&o.readyState<=1)return!1;return a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===rn.UNPACK),!this.noSubImage&&r.target===a.TEXTURE_2D&&n.width===l&&n.height===h?a.texSubImage2D(a.TEXTURE_2D,0,0,0,r.format,n.type,o):(n.width=l,n.height=h,a.texImage2D(r.target,0,n.internalFormat,r.format,n.type,o)),!0},e.prototype.update=function(){if(!this.destroyed){var i=this.source,r=i.naturalWidth||i.videoWidth||i.width,n=i.naturalHeight||i.videoHeight||i.height;this.resize(r,n),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(au),JN=function(t){si(e,t);function e(i){return t.call(this,i)||this}return e.test=function(i){var r=globalThis.OffscreenCanvas;return r&&i instanceof r?!0:globalThis.HTMLCanvasElement&&i instanceof HTMLCanvasElement},e}(Ao),$N=function(t){si(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height,h=o.autoLoad,u=o.linkBaseTexture;if(i&&i.length!==e.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");n=t.call(this,6,{width:a,height:l})||this;for(var c=0;c<e.SIDES;c++)n.items[c].target=xa.TEXTURE_CUBE_MAP_POSITIVE_X+c;return n.linkBaseTexture=u!==!1,i&&n.initFromArray(i,r),h!==!1&&n.load(),n}return e.prototype.bind=function(i){t.prototype.bind.call(this,i),i.target=xa.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(i,r,n){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=xa.TEXTURE_CUBE_MAP_POSITIVE_X+r,i.parentTextureArray=this.baseTexture,this.items[r]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[r]=i,this},e.prototype.upload=function(i,r,n){for(var o=this.itemDirtyIds,a=0;a<e.SIDES;a++){var l=this.items[a];(o[a]<l.dirtyId||n.dirtyId<r.dirtyId)&&(l.valid&&l.resource?(l.resource.upload(i,l,n),o[a]=l.dirtyId):o[a]<-1&&(i.gl.texImage2D(l.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),o[a]=-1))}return!0},e.test=function(i){return Array.isArray(i)&&i.length===e.SIDES},e.SIDES=6,e}(rC),nC=function(t){si(e,t);function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLImageElement)){var o=new Image;Ao.crossOrigin(o,i,r.crossorigin),o.src=i,i=o}return n=t.call(this,i)||this,!i.complete&&n._width&&n._height&&(n._width=0,n._height=0),n.url=i.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(r.createBitmap!==void 0?r.createBitmap:Oe.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,n.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,n.bitmap=null,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(i){var r=this;return this._load?this._load:(i!==void 0&&(this.createBitmap=i),this._load=new Promise(function(n,o){var a=r.source;r.url=a.src;var l=function(){r.destroyed||(a.onload=null,a.onerror=null,r.resize(a.width,a.height),r._load=null,r.createBitmap?n(r.process()):n(r))};a.complete&&a.src?l():(a.onload=l,a.onerror=function(h){o(h),r.onError.emit(h)})}),this._load)},e.prototype.process=function(){var i=this,r=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var n=globalThis.createImageBitmap,o=!r.crossOrigin||r.crossOrigin==="anonymous";return this._process=fetch(r.src,{mode:o?"cors":"no-cors"}).then(function(a){return a.blob()}).then(function(a){return n(a,0,0,r.width,r.height,{premultiplyAlpha:i.alphaMode===null||i.alphaMode===rn.UNPACK?"premultiply":"none"})}).then(function(a){return i.destroyed?Promise.reject():(i.bitmap=a,i.update(),i._process=null,Promise.resolve(i))}),this._process},e.prototype.upload=function(i,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,i,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,i,r,n,this.bitmap),!this.preserveBitmap){var o=!0,a=r._glTextures;for(var l in a){var h=a[l];if(h!==n&&h.dirtyId!==r.dirtyId){o=!1;break}}o&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(i){return typeof i=="string"||i instanceof HTMLImageElement},e}(Ao),eU=function(t){si(e,t);function e(i,r){var n=this;return r=r||{},n=t.call(this,Oe.ADAPTER.createCanvas())||this,n._width=0,n._height=0,n.svg=i,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(){var i=this;return this._load?this._load:(this._load=new Promise(function(r){if(i._resolve=function(){i.resize(i.source.width,i.source.height),r(i)},e.SVG_XML.test(i.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");i.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i.svg)))}i._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var i=this,r=new Image;Ao.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(n){i._resolve&&(r.onerror=null,i.onError.emit(n))},r.onload=function(){if(i._resolve){var n=r.width,o=r.height;if(!n||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var a=n*i.scale,l=o*i.scale;(i._overrideWidth||i._overrideHeight)&&(a=i._overrideWidth||i._overrideHeight/o*n,l=i._overrideHeight||i._overrideWidth/n*o),a=Math.round(a),l=Math.round(l);var h=i.source;h.width=a,h.height=l,h._pixiId="canvas_"+qs(),h.getContext("2d").drawImage(r,0,0,n,o,0,0,a,l),i._resolve(),i._resolve=null}}},e.getSize=function(i){var r=e.SVG_SIZE.exec(i),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(i,r){return r==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&e.SVG_XML.test(i)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(Ao),tU=function(t){si(e,t);function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);var a=i[0].src||i[0];Ao.crossOrigin(o,a,r.crossorigin);for(var l=0;l<i.length;++l){var h=document.createElement("source"),u=i[l],c=u.src,f=u.mime;c=c||i[l];var d=c.split("?").shift().toLowerCase(),m=d.slice(d.lastIndexOf(".")+1);f=f||e.MIME_TYPES[m]||"video/"+m,h.src=c,h.type=f,o.appendChild(h)}i=o}return n=t.call(this,i)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=r.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),r.autoLoad!==!1&&n.load(),n}return e.prototype.update=function(i){if(!this.destroyed){var r=Pi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){i.valid?n(i):(i._resolve=n,r.load())}),this._load},e.prototype._onError=function(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)},e.prototype._isSourcePlaying=function(){var i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()},e.prototype._isSourceReady=function(){var i=this.source;return i.readyState>2},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Pi.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Pi.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(i.videoWidth,i.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(Pi.shared.remove(this.update,this),this._isConnectedToTicker=!1);var i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Pi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Pi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(i){i!==this._updateFPS&&(this._updateFPS=i)},enumerable:!1,configurable:!0}),e.test=function(i,r){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(Ao),iU=function(t){si(e,t);function e(i){return t.call(this,i)||this}return e.test=function(i){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap},e}(Ao);Zv.push(nC,iU,JN,tU,eU,Sl,$N,QN);var rU={__proto__:null,Resource:au,BaseImageResource:Ao,INSTALLED:Zv,autoDetectResource:iC,AbstractMultiResource:rC,ArrayResource:QN,BufferResource:Sl,CanvasResource:JN,CubeResource:$N,ImageResource:nC,SVGResource:eU,VideoResource:tU,ImageBitmapResource:iU},ZJ=function(t){si(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===rn.UNPACK);var a=r.realWidth,l=r.realHeight;return n.width===a&&n.height===l?o.texSubImage2D(r.target,0,0,0,a,l,r.format,n.type,this.data):(n.width=a,n.height=l,o.texImage2D(r.target,0,n.internalFormat,a,l,0,r.format,n.type,this.data)),!0},e}(Sl),tC=function(){function t(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new sr("disposeFramebuffer"),this.multisample=$t.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(e,i){return e===void 0&&(e=0),this.colorTextures[e]=i||new St(null,{scaleMode:Hn.NEAREST,resolution:1,mipmap:zr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(e){return this.depthTexture=e||new St(new ZJ(null,{width:this.width,height:this.height}),{scaleMode:Hn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:zr.OFF,format:Ae.DEPTH_COMPONENT,type:rt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],o=n.resolution;n.setSize(e/o,i/o)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(e/o,i/o)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),nU=function(t){si(e,t);function e(i){i===void 0&&(i={});var r=this;if(typeof i=="number"){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];i={width:n,height:o,scaleMode:a,resolution:l}}return i.width=i.width||100,i.height=i.height||100,i.multisample=i.multisample!==void 0?i.multisample:$t.NONE,r=t.call(this,null,i)||this,r.mipmap=zr.OFF,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new tC(r.realWidth,r.realHeight).addColorTexture(0,r),r.framebuffer.multisample=i.multisample,r.maskStack=[],r.filterStack=[{}],r}return e.prototype.resize=function(i,r){this.framebuffer.resize(i*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(St),sU=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(e,i,r){var n=i.width,o=i.height;if(r){var a=e.width/2/n,l=e.height/2/o,h=e.x/n+a,u=e.y/o+l;r=fi.add(r,fi.NW),this.x0=h+a*fi.uX(r),this.y0=u+l*fi.uY(r),r=fi.add(r,2),this.x1=h+a*fi.uX(r),this.y1=u+l*fi.uY(r),r=fi.add(r,2),this.x2=h+a*fi.uX(r),this.y2=u+l*fi.uY(r),r=fi.add(r,2),this.x3=h+a*fi.uX(r),this.y3=u+l*fi.uY(r)}else this.x0=e.x/n,this.y0=e.y/o,this.x1=(e.x+e.width)/n,this.y1=e.y/o,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/o,this.x3=e.x/n,this.y3=(e.y+e.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},t}(),NN=new sU;function Wv(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var tt=function(t){si(e,t);function e(i,r,n,o,a,l){var h=t.call(this)||this;if(h.noFrame=!1,r||(h.noFrame=!0,r=new wt(0,0,1,1)),i instanceof e&&(i=i.baseTexture),h.baseTexture=i,h._frame=r,h.trim=o,h.valid=!1,h._uvs=NN,h.uvMatrix=null,h.orig=n||r,h._rotate=Number(a||0),a===!0)h._rotate=2;else if(h._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=l?new Gt(l.x,l.y):new Gt(0,0),h._updateID=0,h.textureCacheIds=[],i.valid?h.noFrame?i.valid&&h.onBaseTextureUpdated(i):h.frame=r:i.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&i.on("update",h.onBaseTextureUpdated,h),h}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(i){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=i.width,this._frame.height=i.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(i){if(this.baseTexture){if(i){var r=this.baseTexture.resource;r&&r.url&&Wr[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var i=this._frame.clone(),r=this._frame===this.orig?i:this.orig.clone(),n=new e(this.baseTexture,!this.noFrame&&i,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=i),n},e.prototype.updateUvs=function(){this._uvs===NN&&(this._uvs=new sU),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(i,r,n){r===void 0&&(r={}),n===void 0&&(n=Oe.STRICT_TEXTURE_CACHE);var o=typeof i=="string",a=null;if(o)a=i;else if(i instanceof St){if(!i.cacheId){var l=r&&r.pixiIdPrefix||"pixiid";i.cacheId=l+"-"+qs(),St.addToCache(i,i.cacheId)}a=i.cacheId}else{if(!i._pixiId){var l=r&&r.pixiIdPrefix||"pixiid";i._pixiId=l+"_"+qs()}a=i._pixiId}var h=Wr[a];if(o&&n&&!h)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return!h&&!(i instanceof St)?(r.resolution||(r.resolution=ba(i)),h=new e(new St(i,r)),h.baseTexture.cacheId=a,St.addToCache(h.baseTexture,a),e.addToCache(h,a)):!h&&i instanceof St&&(h=new e(i),e.addToCache(h,a)),h},e.fromURL=function(i,r){var n=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),o=e.from(i,Object.assign({resourceOptions:n},r),!1),a=o.baseTexture.resource;return o.baseTexture.valid?Promise.resolve(o):a.load().then(function(){return Promise.resolve(o)})},e.fromBuffer=function(i,r,n,o){return new e(St.fromBuffer(i,r,n,o))},e.fromLoader=function(i,r,n,o){var a=new St(i,Object.assign({scaleMode:Oe.SCALE_MODE,resolution:ba(r)},o)),l=a.resource;l instanceof nC&&(l.url=r);var h=new e(a);return n||(n=r),St.addToCache(h.baseTexture,n),e.addToCache(h,n),n!==r&&(St.addToCache(h.baseTexture,r),e.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(function(u){h.baseTexture.once("loaded",function(){return u(h)})})},e.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),Wr[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),Wr[r]=i)},e.removeFromCache=function(i){if(typeof i=="string"){var r=Wr[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete Wr[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)Wr[i.textureCacheIds[o]]===i&&delete Wr[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(i){this._frame=i,this.noFrame=!1;var r=i.x,n=i.y,o=i.width,a=i.height,l=r+o>this.baseTexture.width,h=n+a>this.baseTexture.height;if(l||h){var u=l&&h?"and":"or",c="X: "+r+" + "+o+" = "+(r+o)+" > "+this.baseTexture.width,f="Y: "+n+" + "+a+" = "+(n+a)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+u+" "+f))}this.valid=o&&a&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=i),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(i){this._rotate=i,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(e,"EMPTY",{get:function(){return e._EMPTY||(e._EMPTY=new e(new St),Wv(e._EMPTY),Wv(e._EMPTY.baseTexture)),e._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WHITE",{get:function(){if(!e._WHITE){var i=Oe.ADAPTER.createCanvas(16,16),r=i.getContext("2d");i.width=16,i.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),e._WHITE=new e(St.from(i)),Wv(e._WHITE),Wv(e._WHITE.baseTexture)}return e._WHITE},enumerable:!1,configurable:!0}),e}(Xs.default),Po=function(t){si(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(i){this.framebuffer.multisample=i},enumerable:!1,configurable:!0}),e.prototype.resize=function(i,r,n){n===void 0&&(n=!0);var o=this.baseTexture.resolution,a=Math.round(i*o)/o,l=Math.round(r*o)/o;this.valid=a>0&&l>0,this._frame.width=this.orig.width=a,this._frame.height=this.orig.height=l,n&&this.baseTexture.resize(a,l),this.updateUvs()},e.prototype.setResolution=function(i){var r=this.baseTexture;r.resolution!==i&&(r.setResolution(i),this.resize(r.width,r.height,!1))},e.create=function(i){for(var r=arguments,n=[],o=1;o<arguments.length;o++)n[o-1]=r[o];return typeof i=="number"&&(Gi("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),i={width:i,height:n[0],scaleMode:n[1],resolution:n[2]}),new e(new nU(i))},e}(tt),KJ=function(){function t(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(e,i,r){r===void 0&&(r=$t.NONE);var n=new nU(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new Po(n)},t.prototype.getOptimalTexture=function(e,i,r,n){r===void 0&&(r=1),n===void 0&&(n=$t.NONE);var o;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=ru(e),i=ru(i),o=((e&65535)<<16|i&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);var a=this.texturePool[o].pop();return a||(a=this.createTexture(e,i,n)),a.filterPoolKey=o,a.setResolution(r),a},t.prototype.getFilterTexture=function(e,i,r){var n=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||$t.NONE);return n.filterFrame=e.filterFrame,n},t.prototype.returnTexture=function(e){var i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)},t.prototype.returnFilterTexture=function(e){this.returnTexture(e)},t.prototype.clear=function(e){if(e=e!==!1,e)for(var i in this.texturePool){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(var i in this.texturePool)if(Number(i)<0){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY=-1,t}(),UN=function(){function t(e,i,r,n,o,a,l){i===void 0&&(i=0),r===void 0&&(r=!1),n===void 0&&(n=rt.FLOAT),this.buffer=e,this.size=i,this.normalized=r,this.type=n,this.stride=o,this.start=a,this.instance=l}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,n,o){return new t(e,i,r,n,o)},t}(),QJ=0,Ri=function(){function t(e,i,r){i===void 0&&(i=!0),r===void 0&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=QJ++,this.disposeRunner=new sr("disposeBuffer")}return t.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(t.prototype,"index",{get:function(){return this.type===ms.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?ms.ELEMENT_ARRAY_BUFFER:ms.ARRAY_BUFFER},enumerable:!1,configurable:!0}),t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}(),JJ={Float32Array,Uint32Array,Int32Array,Uint8Array};function $J(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;for(var a=new ArrayBuffer(i*4),l=null,h=0,o=0;o<t.length;o++){var u=e[o],c=t[o],f=zf(c);n[f]||(n[f]=new JJ[f](a)),l=n[f];for(var d=0;d<c.length;d++){var m=(d/u|0)*r+h,p=d%u;l[m+p]=c[d]}h+=u}return new Float32Array(a)}var zN={5126:4,5123:2,5121:1},e$=0,t$={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Cl=function(){function t(e,i){e===void 0&&(e=[]),i===void 0&&(i={}),this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=e$++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new sr("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(e,i,r,n,o,a,l,h){if(r===void 0&&(r=0),n===void 0&&(n=!1),h===void 0&&(h=!1),!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof Ri||(i instanceof Array&&(i=new Float32Array(i)),i=new Ri(i));var u=e.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],i,r,n,o);return this}var f=this.buffers.indexOf(i);return f===-1&&(this.buffers.push(i),f=this.buffers.length-1),this.attributes[e]=new UN(f,r,n,o,a,l,h),this.instanced=this.instanced||h,this},t.prototype.getAttribute=function(e){return this.attributes[e]},t.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},t.prototype.addIndex=function(e){return e instanceof Ri||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ri(e)),e.type=ms.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],i=[],r=new Ri,n;for(n in this.attributes){var o=this.attributes[n],a=this.buffers[o.buffer];e.push(a.data),i.push(o.size*zN[o.type]/4),o.buffer=0}for(r.data=$J(e,i),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var e in this.attributes){var i=this.attributes[e],r=this.buffers[i.buffer];return r.data.length/(i.stride/4||i.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new Ri(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new UN(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=ms.ELEMENT_ARRAY_BUFFER),e},t.merge=function(e){for(var i=new t,r=[],n=[],o=[],a,l=0;l<e.length;l++){a=e[l];for(var h=0;h<a.buffers.length;h++)n[h]=n[h]||0,n[h]+=a.buffers[h].data.length,o[h]=0}for(var l=0;l<a.buffers.length;l++)r[l]=new t$[zf(a.buffers[l].data)](n[l]),i.buffers[l]=new Ri(r[l]);for(var l=0;l<e.length;l++){a=e[l];for(var h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,o[h]),o[h]+=a.buffers[h].data.length}if(i.attributes=a.attributes,a.indexBuffer){i.indexBuffer=i.buffers[a.buffers.indexOf(a.indexBuffer)],i.indexBuffer.type=ms.ELEMENT_ARRAY_BUFFER;for(var u=0,c=0,f=0,d=0,l=0;l<a.buffers.length;l++)if(a.buffers[l]!==a.indexBuffer){d=l;break}for(var l in a.attributes){var m=a.attributes[l];(m.buffer|0)===d&&(c+=m.size*zN[m.type]/4)}for(var l=0;l<e.length;l++){for(var p=e[l].indexBuffer.data,h=0;h<p.length;h++)i.indexBuffer.data[h+f]+=u;u+=e[l].buffers[d].data.length/c,f+=p.length}}return i},t}(),i$=function(t){si(e,t);function e(){var i=t.call(this)||this;return i.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),i}return e}(Cl),sC=function(t){si(e,t);function e(){var i=t.call(this)||this;return i.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),i.uvs=new Float32Array([0,0,1,0,1,1,0,1]),i.vertexBuffer=new Ri(i.vertices),i.uvBuffer=new Ri(i.uvs),i.addAttribute("aVertexPosition",i.vertexBuffer).addAttribute("aTextureCoord",i.uvBuffer).addIndex([0,1,2,0,2,3]),i}return e.prototype.map=function(i,r){var n=0,o=0;return this.uvs[0]=n,this.uvs[1]=o,this.uvs[2]=n+r.width/i.width,this.uvs[3]=o,this.uvs[4]=n+r.width/i.width,this.uvs[5]=o+r.height/i.height,this.uvs[6]=n,this.uvs[7]=o+r.height/i.height,n=r.x,o=r.y,this.vertices[0]=n,this.vertices[1]=o,this.vertices[2]=n+r.width,this.vertices[3]=o,this.vertices[4]=n+r.width,this.vertices[5]=o+r.height,this.vertices[6]=n,this.vertices[7]=o+r.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(Cl),r$=0,Ca=function(){function t(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=r$++,this.static=!!i,this.ubo=!!r,e instanceof Ri?(this.buffer=e,this.buffer.type=ms.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ri(new Float32Array(1)),this.buffer.type=ms.UNIFORM_BUFFER,this.autoManage=!0))}return t.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},t.prototype.add=function(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},t.from=function(e,i,r){return new t(e,i,r)},t.uboFrom=function(e,i){return new t(e,i!=null?i:!0,!0)},t}(),n$=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=$t.NONE,this.sourceFrame=new wt,this.destinationFrame=new wt,this.bindingSourceFrame=new wt,this.bindingDestinationFrame=new wt,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),Vv=[new Gt,new Gt,new Gt,new Gt],HS=new Zt,oU=function(){function t(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new KJ,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new i$,this.quadUv=new sC,this.tempRect=new wt,this.activeState={},this.globalUniforms=new Ca({outputFrame:new wt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return t.prototype.push=function(e,i){for(var r,n,o=this.renderer,a=this.defaultFilterStack,l=this.statePool.pop()||new n$,h=this.renderer.renderTexture,u=i[0].resolution,c=i[0].multisample,f=i[0].padding,d=i[0].autoFit,m=(r=i[0].legacy)!==null&&r!==void 0?r:!0,p=1;p<i.length;p++){var v=i[p];u=Math.min(u,v.resolution),c=Math.min(c,v.multisample),f=this.useMaxPadding?Math.max(f,v.padding):f+v.padding,d=d&&v.autoFit,m=m||((n=v.legacy)!==null&&n!==void 0?n:!0)}a.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),a.push(l),l.resolution=u,l.multisample=c,l.legacy=m,l.target=e,l.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),l.sourceFrame.pad(f);var g=this.tempRect.copyFrom(h.sourceFrame);o.projection.transform&&this.transformAABB(HS.copyFrom(o.projection.transform).invert(),g),d?(l.sourceFrame.fit(g),(l.sourceFrame.width<=0||l.sourceFrame.height<=0)&&(l.sourceFrame.width=0,l.sourceFrame.height=0)):l.sourceFrame.intersects(g)||(l.sourceFrame.width=0,l.sourceFrame.height=0),this.roundFrame(l.sourceFrame,h.current?h.current.resolution:o.resolution,h.sourceFrame,h.destinationFrame,o.projection.transform),l.renderTexture=this.getOptimalFilterTexture(l.sourceFrame.width,l.sourceFrame.height,u,c),l.filters=i,l.destinationFrame.width=l.renderTexture.width,l.destinationFrame.height=l.renderTexture.height;var _=this.tempRect;_.x=0,_.y=0,_.width=l.sourceFrame.width,_.height=l.sourceFrame.height,l.renderTexture.filterFrame=l.sourceFrame,l.bindingSourceFrame.copyFrom(h.sourceFrame),l.bindingDestinationFrame.copyFrom(h.destinationFrame),l.transform=o.projection.transform,o.projection.transform=null,h.bind(l.renderTexture,l.sourceFrame,_),o.framebuffer.clear(0,0,0,0)},t.prototype.pop=function(){var e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;var n=this.globalUniforms.uniforms;n.outputFrame=i.sourceFrame,n.resolution=i.resolution;var o=n.inputSize,a=n.inputPixel,l=n.inputClamp;if(o[0]=i.destinationFrame.width,o[1]=i.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=Math.round(o[0]*i.resolution),a[1]=Math.round(o[1]*i.resolution),a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=i.sourceFrame.width*o[2]-.5*a[2],l[3]=i.sourceFrame.height*o[3]-.5*a[3],i.legacy){var h=n.filterArea;h[0]=i.destinationFrame.width,h[1]=i.destinationFrame.height,h[2]=i.sourceFrame.x,h[3]=i.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var u=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,u.renderTexture,Sn.BLEND,i),this.returnFilterTexture(i.renderTexture);else{var c=i.renderTexture,f=this.getOptimalFilterTexture(c.width,c.height,i.resolution);f.filterFrame=c.filterFrame;var d=0;for(d=0;d<r.length-1;++d){d===1&&i.multisample>1&&(f=this.getOptimalFilterTexture(c.width,c.height,i.resolution),f.filterFrame=c.filterFrame),r[d].apply(this,c,f,Sn.CLEAR,i);var m=c;c=f,f=m}r[d].apply(this,c,u.renderTexture,Sn.BLEND,i),d>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(f)}i.clear(),this.statePool.push(i)},t.prototype.bindAndClear=function(e,i){i===void 0&&(i=Sn.CLEAR);var r=this.renderer,n=r.renderTexture,o=r.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,n.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var l=o.stateId&1||this.forceClear;(i===Sn.CLEAR||i===Sn.BLIT&&l)&&this.renderer.framebuffer.clear(0,0,0,0)},t.prototype.applyFilter=function(e,i,r,n){var o=this.renderer;o.state.set(e.state),this.bindAndClear(r,n),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(tn.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(tn.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(e,i){var r=this.activeState,n=r.sourceFrame,o=r.destinationFrame,a=i._texture.orig,l=e.set(o.width,0,0,o.height,n.x,n.y),h=i.worldTransform.copyTo(Zt.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/a.width,1/a.height),l.translate(i.anchor.x,i.anchor.y),l},t.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(e,i,r,n){return r===void 0&&(r=1),n===void 0&&(n=$t.NONE),this.texturePool.getOptimalTexture(e,i,r,n)},t.prototype.getFilterTexture=function(e,i,r){if(typeof e=="number"){var n=e;e=i,i=n}e=e||this.activeState.renderTexture;var o=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||$t.NONE);return o.filterFrame=e.filterFrame,o},t.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t.prototype.transformAABB=function(e,i){var r=Vv[0],n=Vv[1],o=Vv[2],a=Vv[3];r.set(i.left,i.top),n.set(i.left,i.bottom),o.set(i.right,i.top),a.set(i.right,i.bottom),e.apply(r,r),e.apply(n,n),e.apply(o,o),e.apply(a,a);var l=Math.min(r.x,n.x,o.x,a.x),h=Math.min(r.y,n.y,o.y,a.y),u=Math.max(r.x,n.x,o.x,a.x),c=Math.max(r.y,n.y,o.y,a.y);i.x=l,i.y=h,i.width=u-l,i.height=c-h},t.prototype.roundFrame=function(e,i,r,n,o){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(o){var a=o.a,l=o.b,h=o.c,u=o.d;if((Math.abs(l)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(u)>1e-4))return}o=o?HS.copyFrom(o):HS.identity(),o.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(o,e),e.ceil(i),this.transformAABB(o.invert(),e)}},t}(),lu=function(){function t(e){this.renderer=e}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(e){},t}(),aU=function(){function t(e){this.renderer=e,this.emptyRenderer=new lu(e),this.currentRenderer=this.emptyRenderer}return t.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(e,i){for(var r=this.renderer.texture.boundTextures,n=i-1;n>=0;--n)e[n]=r[n]||null,e[n]&&(e[n]._batchLocation=n)},t.prototype.boundArray=function(e,i,r,n){for(var o=e.elements,a=e.ids,l=e.count,h=0,u=0;u<l;u++){var c=o[u],f=c._batchLocation;if(f>=0&&f<n&&i[f]===c){a[u]=f;continue}for(;h<n;){var d=i[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}a[u]=h,c._batchLocation=h,i[h]=c;break}}},t.prototype.destroy=function(){this.renderer=null},t}(),GN=0,lU=function(){function t(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(t.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),t.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=GN++},t.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=GN++,this.renderer.runners.contextChange.emit(e)},t.prototype.initFromOptions=function(e){var i=this.createContext(this.renderer.view,e);this.initFromContext(i)},t.prototype.createContext=function(e,i){var r;if(Oe.PREFER_ENV>=Vs.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},t.prototype.getExtensions=function(){var e=this.gl,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},t.prototype.handleContextLost=function(e){var i=this;e.preventDefault(),setTimeout(function(){i.gl.isContextLost()&&i.extensions.loseContext&&i.extensions.loseContext.restoreContext()},0)},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},t.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},t.prototype.validateContext=function(e){var i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},t}(),s$=function(){function t(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=$t.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return t}(),o$=new wt,hU=function(){function t(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new tC(10,10),this.msaaSamples=null}return t.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new wt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Oe.PREFER_ENV===Vs.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=function(n){return i.drawBuffersWEBGL(n)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},t.prototype.bind=function(e,i,r){r===void 0&&(r=0);var n=this.gl;if(e){var o=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,o.mipLevel=r),o.dirtyId!==e.dirtyId&&(o.dirtyId=e.dirtyId,o.dirtyFormat!==e.dirtyFormat?(o.dirtyFormat=e.dirtyFormat,o.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):o.dirtySize!==e.dirtySize&&(o.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var a=0;a<e.colorTextures.length;a++){var l=e.colorTextures[a];this.renderer.texture.unbind(l.parentTextureArray||l)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){var h=i.width>>r,u=i.height>>r,c=h/i.width;this.setViewport(i.x*c,i.y*c,h,u)}else{var h=e.width>>r,u=e.height>>r;this.setViewport(0,0,h,u)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(e,i,r,n){var o=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),n=Math.round(n),(o.width!==r||o.height!==n||o.x!==e||o.y!==i)&&(o.x=e,o.y=i,o.width=r,o.height=n,this.gl.viewport(e,i,r,n))},Object.defineProperty(t.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),t.prototype.clear=function(e,i,r,n,o){o===void 0&&(o=Tf.COLOR|Tf.DEPTH);var a=this.gl;a.clearColor(e,i,r,n),a.clear(o)},t.prototype.initFramebuffer=function(e){var i=this.gl,r=new s$(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r},t.prototype.resizeFramebuffer=function(e){var i=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.RGBA8,e.width,e.height)),r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));var n=e.colorTextures,o=n.length;i.drawBuffers||(o=Math.min(o,1));for(var a=0;a<o;a++){var l=n[a],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},t.prototype.updateFramebuffer=function(e,i){var r=this.gl,n=e.glFramebuffers[this.CONTEXT_UID],o=e.colorTextures,a=o.length;r.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?(n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var l=[],h=0;h<a;h++){var u=o[h],c=u.parentTextureArray||u;this.renderer.texture.bind(c,0),!(h===0&&n.msaaBuffer)&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,u.target,c._glTextures[this.CONTEXT_UID].texture,i),l.push(r.COLOR_ATTACHMENT0+h))}if(l.length>1&&r.drawBuffers(l),e.depthTexture){var f=this.writeDepthTexture;if(f){var d=e.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,i)}}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)},t.prototype.canMultisampleFramebuffer=function(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture},t.prototype.detectSamples=function(e){var i=this.msaaSamples,r=$t.NONE;if(e<=1||i===null)return r;for(var n=0;n<i.length;n++)if(i[n]<=e){r=i[n];break}return r===1&&(r=$t.NONE),r},t.prototype.blit=function(e,i,r){var n=this,o=n.current,a=n.renderer,l=n.gl,h=n.CONTEXT_UID;if(a.context.webGLVersion===2&&o){var u=o.glFramebuffers[h];if(u){if(!e){if(!u.msaaBuffer)return;var c=o.colorTextures[0];if(!c)return;u.blitFramebuffer||(u.blitFramebuffer=new tC(o.width,o.height),u.blitFramebuffer.addColorTexture(0,c)),e=u.blitFramebuffer,e.colorTextures[0]!==c&&(e.colorTextures[0]=c,e.dirtyId++,e.dirtyFormat++),(e.width!==o.width||e.height!==o.height)&&(e.width=o.width,e.height=o.height,e.dirtyId++,e.dirtySize++)}i||(i=o$,i.width=o.width,i.height=o.height),r||(r=i);var f=i.width===r.width&&i.height===r.height;this.bind(e),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}}},t.prototype.disposeFramebuffer=function(e,i){var r=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(r){delete e.glFramebuffers[this.CONTEXT_UID];var o=this.managedFramebuffers.indexOf(e);o>=0&&this.managedFramebuffers.splice(o,1),e.disposeRunner.remove(this),i||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}},t.prototype.disposeAll=function(e){var i=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)},t.prototype.forceStencil=function(){var e=this.current;if(e){var i=e.glFramebuffers[this.CONTEXT_UID];if(!(!i||i.stencil)){e.stencil=!0;var r=e.width,n=e.height,o=this.gl,a=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,a),i.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,i.multisample,o.DEPTH24_STENCIL8,r,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,n),i.stencil=a,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,a)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new wt},t.prototype.destroy=function(){this.renderer=null},t}(),WS={5126:4,5123:2,5121:1},uU=function(){function t(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return t.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){var r=this.renderer.context.extensions.vertexArrayObject;Oe.PREFER_ENV===Vs.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(o){return r.bindVertexArrayOES(o)},e.deleteVertexArray=function(o){return r.deleteVertexArrayOES(o)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(i.webGLVersion!==2){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(o,a){return n.vertexAttribDivisorANGLE(o,a)},e.drawElementsInstanced=function(o,a,l,h,u){return n.drawElementsInstancedANGLE(o,a,l,h,u)},e.drawArraysInstanced=function(o,a,l,h){return n.drawArraysInstancedANGLE(o,a,l,h)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex},t.prototype.bind=function(e,i){i=i||this.renderer.shader.shader;var r=this.gl,n=e.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);var a=n[i.program.id]||this.initGeometryVao(e,i,o);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(e,i.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var e=this._activeGeometry,i=this.renderer.buffer,r=0;r<e.buffers.length;r++){var n=e.buffers[r];i.update(n)}},t.prototype.checkCompatibility=function(e,i){var r=e.attributes,n=i.attributeData;for(var o in n)if(!r[o])throw new Error('shader and geometry incompatible, geometry missing the "'+o+'" attribute')},t.prototype.getSignature=function(e,i){var r=e.attributes,n=i.attributeData,o=["g",e.id];for(var a in r)n[a]&&o.push(a,n[a].location);return o.join("-")},t.prototype.initGeometryVao=function(e,i,r){r===void 0&&(r=!0);var n=this.gl,o=this.CONTEXT_UID,a=this.renderer.buffer,l=i.program;l.glPrograms[o]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,l);var h=this.getSignature(e,l),u=e.glVertexArrayObjects[this.CONTEXT_UID],c=u[h];if(c)return u[l.id]=c,c;var f=e.buffers,d=e.attributes,m={},p={};for(var v in f)m[v]=0,p[v]=0;for(var v in d)!d[v].size&&l.attributeData[v]?d[v].size=l.attributeData[v].size:d[v].size||console.warn("PIXI Geometry attribute '"+v+"' size cannot be determined (likely the bound shader does not have the attribute)"),m[d[v].buffer]+=d[v].size*WS[d[v].type];for(var v in d){var g=d[v],_=g.size;g.stride===void 0&&(m[g.buffer]===_*WS[g.type]?g.stride=0:g.stride=m[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=_*WS[g.type])}c=n.createVertexArray(),n.bindVertexArray(c);for(var x=0;x<f.length;x++){var b=f[x];a.bind(b),r&&b._glBuffers[o].refCount++}return this.activateVao(e,l),this._activeVao=c,u[l.id]=c,u[h]=c,c},t.prototype.disposeGeometry=function(e,i){var r;if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var n=e.glVertexArrayObjects[this.CONTEXT_UID],o=this.gl,a=e.buffers,l=(r=this.renderer)===null||r===void 0?void 0:r.buffer;if(e.disposeRunner.remove(this),!!n){if(l)for(var h=0;h<a.length;h++){var u=a[h]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!i&&l.dispose(a[h],i))}if(!i){for(var c in n)if(c[0]==="g"){var f=n[c];this._activeVao===f&&this.unbind(),o.deleteVertexArray(f)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(e){for(var i=Object.keys(this.managedGeometries),r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)},t.prototype.activateVao=function(e,i){var r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.buffers,l=e.attributes;e.indexBuffer&&o.bind(e.indexBuffer);var h=null;for(var u in l){var c=l[u],f=a[c.buffer],d=f._glBuffers[n];if(i.attributeData[u]){h!==d&&(o.bind(f),h=d);var m=i.attributeData[u].location;if(r.enableVertexAttribArray(m),r.vertexAttribPointer(m,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(m,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},t.prototype.draw=function(e,i,r,n){var o=this.gl,a=this._activeGeometry;if(a.indexBuffer){var l=a.indexBuffer.data.BYTES_PER_ELEMENT,h=l===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?o.drawElementsInstanced(e,i||a.indexBuffer.data.length,h,(r||0)*l,n||1):o.drawElements(e,i||a.indexBuffer.data.length,h,(r||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?o.drawArraysInstanced(e,r,i||a.getSize(),n||1):o.drawArrays(e,r,i||a.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t.prototype.destroy=function(){this.renderer=null},t}(),a$=function(){function t(e){e===void 0&&(e=null),this.type=wi.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Oe.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(t.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=wi.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},t.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function HN(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function WN(t,e){var i=t.getShaderSource(e).split(`
`).map(function(u,c){return c+": "+u}),r=t.getShaderInfoLog(e),n=r.split(`
`),o={},a=n.map(function(u){return parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(u){return u&&!o[u]?(o[u]=!0,!0):!1}),l=[""];a.forEach(function(u){i[u-1]="%c"+i[u-1]+"%c",l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=i.join(`
`);l[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,l),console.groupEnd()}function l$(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||WN(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||WN(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function VS(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function cU(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return VS(2*e);case"bvec3":return VS(3*e);case"bvec4":return VS(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var fU={},Vf=fU;function h$(){if(Vf===fU||Vf&&Vf.isContextLost()){var t=Oe.ADAPTER.createCanvas(),e=void 0;Oe.PREFER_ENV>=Vs.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Vf=e}return Vf}var jv;function u$(){if(!jv){jv=Gr.MEDIUM;var t=h$();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);jv=e.precision?Gr.HIGH:Gr.MEDIUM}}return jv}function VN(t,e,i){if(t.substring(0,9)!=="precision"){var r=e;return e===Gr.HIGH&&i!==Gr.HIGH&&(r=Gr.MEDIUM),"precision "+r+` float;
`+t}else if(i!==Gr.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var c$={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function dU(t){return c$[t]}var qv=null,jN={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function pU(t,e){if(!qv){var i=Object.keys(jN);qv={};for(var r=0;r<i.length;++r){var n=i[r];qv[t[n]]=jN[n]}}return qv[e]}var ou=[{test:function(t){return t.type==="float"&&t.size===1&&!t.isArray},code:function(t){return`
            if(uv["`+t+'"] !== ud["'+t+`"].value)
            {
                ud["`+t+'"].value = uv["'+t+`"]
                gl.uniform1f(ud["`+t+'"].location, uv["'+t+`"])
            }
            `}},{test:function(t,e){return(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0)},code:function(t){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+t+`"], t);

            if(ud["`+t+`"].value !== t)
            {
                ud["`+t+`"].value = t;
                gl.uniform1i(ud["`+t+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(t,e){return t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0},code:function(t){return`
            gl.uniformMatrix3fv(ud["`+t+'"].location, false, uv["'+t+`"].toArray(true));
            `},codeUbo:function(t){return`
                var `+t+"_matrix = uv."+t+`.toArray(true);

                data[offset] = `+t+`_matrix[0];
                data[offset+1] = `+t+`_matrix[1];
                data[offset+2] = `+t+`_matrix[2];
        
                data[offset + 4] = `+t+`_matrix[3];
                data[offset + 5] = `+t+`_matrix[4];
                data[offset + 6] = `+t+`_matrix[5];
        
                data[offset + 8] = `+t+`_matrix[6];
                data[offset + 9] = `+t+`_matrix[7];
                data[offset + 10] = `+t+`_matrix[8];
            `}},{test:function(t,e){return t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+t+`"].location, v.x, v.y);
                }`},codeUbo:function(t){return`
                v = uv.`+t+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(t){return t.type==="vec2"&&t.size===1&&!t.isArray},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+t+`"].location, v[0], v[1]);
                }
            `}},{test:function(t,e){return t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+t+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(t){return`
                    v = uv.`+t+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(t){return t.type==="vec4"&&t.size===1&&!t.isArray},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+t+`"].location, v[0], v[1], v[2], v[3])
                }`}}],f$={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},d$={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function p$(t,e){var i,r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in t.uniforms){var o=e[n];if(!o){!((i=t.uniforms[n])===null||i===void 0)&&i.group&&(t.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var a=t.uniforms[n],l=!1,h=0;h<ou.length;h++)if(ou[h].test(o,a)){r.push(ou[h].code(n,a)),l=!0;break}if(!l){var u=o.size===1&&!o.isArray?f$:d$,c=u[o.type].replace("location",'ud["'+n+'"].location');r.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+c+";")}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}var m$=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function g$(t){for(var e="",i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+="if(test == "+i+".0){}");return e}function v$(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=m$.replace(/%forloop%/gi,g$(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var jf;function _$(){if(typeof jf=="boolean")return jf;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");jf=t({a:"b"},"a","b")===!0}catch(e){jf=!1}return jf}var y$=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,x$=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,b$=0,Xv={},El=function(){function t(e,i,r){r===void 0&&(r="pixi-shader"),this.id=b$++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Xv[r]?(Xv[r]++,r+="-"+Xv[r]):Xv[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=VN(this.vertexSrc,Oe.PRECISION_VERTEX,Gr.HIGH),this.fragmentSrc=VN(this.fragmentSrc,Oe.PRECISION_FRAGMENT,u$())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(t,"defaultVertexSrc",{get:function(){return x$},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return y$},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var n=e+i,o=Nv[n];return o||(Nv[n]=o=new t(e,i,r)),o},t}(),qn=function(){function t(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof Ca?this.uniformGroup=i:this.uniformGroup=new Ca(i):this.uniformGroup=new Ca({}),this.disposeRunner=new sr("disposeShader")}return t.prototype.checkUniformExists=function(e,i){if(i.uniforms[e])return!0;for(var r in i.uniforms){var n=i.uniforms[r];if(n.group&&this.checkUniformExists(e,n))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var n=El.from(e,i);return new t(n,r)},t}(),jS=0,qS=1,XS=2,YS=3,ZS=4,KS=5,_s=function(){function t(){this.data=0,this.blendMode=et.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(this.data&1<<jS)},set:function(e){!!(this.data&1<<jS)!==e&&(this.data^=1<<jS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(this.data&1<<qS)},set:function(e){!!(this.data&1<<qS)!==e&&(this.data^=1<<qS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(this.data&1<<XS)},set:function(e){!!(this.data&1<<XS)!==e&&(this.data^=1<<XS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(this.data&1<<YS)},set:function(e){!!(this.data&1<<YS)!==e&&(this.data^=1<<YS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(this.data&1<<KS)},set:function(e){!!(this.data&1<<KS)!==e&&(this.data^=1<<KS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<ZS)},set:function(e){!!(this.data&1<<ZS)!==e&&(this.data^=1<<ZS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==et.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),w$=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,S$=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,sn=function(t){si(e,t);function e(i,r,n){var o=this,a=El.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return o=t.call(this,a,n)||this,o.padding=0,o.resolution=Oe.FILTER_RESOLUTION,o.multisample=Oe.FILTER_MULTISAMPLE,o.enabled=!0,o.autoFit=!0,o.state=new _s,o}return e.prototype.apply=function(i,r,n,o,a){i.applyFilter(this,r,n,o)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._resolution=i},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return S$},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return w$},enumerable:!1,configurable:!0}),e}(qn),C$=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,E$=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,qN=new Zt,Yf=function(){function t(e,i){this._texture=e,this.mapCoord=new Zt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i=="undefined"?.5:i,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(e,i){i===void 0&&(i=e);for(var r=this.mapCoord,n=0;n<e.length;n+=2){var o=e[n],a=e[n+1];i[n]=o*r.a+a*r.c+r.tx,i[n+1]=o*r.b+a*r.d+r.ty}return i},t.prototype.update=function(e){var i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;var r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=i.orig,o=i.trim;o&&(qN.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(qN));var a=i.baseTexture,l=this.uClampFrame,h=this.clampMargin/a.resolution,u=this.clampOffset;return l[0]=(i._frame.x+h+u)/a.width,l[1]=(i._frame.y+h+u)/a.height,l[2]=(i._frame.x+i._frame.width-h+u)/a.width,l[3]=(i._frame.y+i._frame.height-h+u)/a.height,this.uClampOffset[0]=u/a.realWidth,this.uClampOffset[1]=u/a.realHeight,this.isSimple=i._frame.width===a.width&&i._frame.height===a.height&&i.rotate===0,!0},t}(),M$=function(t){si(e,t);function e(i,r,n){var o=this,a=null;return typeof i!="string"&&r===void 0&&n===void 0&&(a=i,i=void 0,r=void 0,n=void 0),o=t.call(this,i||C$,r||E$,n)||this,o.maskSprite=a,o.maskMatrix=new Zt,o}return Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(i){this._maskSprite=i,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(i,r,n,o){var a=this._maskSprite,l=a._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new Yf(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=i.calculateSpriteMatrix(this.maskMatrix,a).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,i.applyFilter(this,r,n,o))},e}(sn),mU=function(){function t(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},t.prototype.push=function(e,i){var r=i;if(!r.isMaskData){var n=this.maskDataPool.pop()||new a$;n.pooled=!0,n.maskObject=i,r=n}var o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(o),r._colorMask=o?o._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==wi.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case wi.SCISSOR:this.renderer.scissor.push(r);break;case wi.STENCIL:this.renderer.stencil.push(r);break;case wi.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case wi.COLOR:this.pushColorMask(r);break}r.type===wi.SPRITE&&this.maskStack.push(r)},t.prototype.pop=function(e){var i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case wi.SCISSOR:this.renderer.scissor.pop(i);break;case wi.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case wi.SPRITE:this.popSpriteMask(i);break;case wi.COLOR:this.popColorMask(i);break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){var r=this.maskStack[this.maskStack.length-1];r.type===wi.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}},t.prototype.detect=function(e){var i=e.maskObject;i?i.isSprite?e.type=wi.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=wi.SCISSOR:e.type=wi.STENCIL:e.type=wi.COLOR},t.prototype.pushSpriteMask=function(e){var i,r,n=e.maskObject,o=e._target,a=e._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new M$]));var l=this.renderer,h=l.renderTexture,u,c;if(h.current){var f=h.current;u=e.resolution||f.resolution,c=(i=e.multisample)!==null&&i!==void 0?i:f.multisample}else u=e.resolution||l.resolution,c=(r=e.multisample)!==null&&r!==void 0?r:l.multisample;a[0].resolution=u,a[0].multisample=c,a[0].maskSprite=n;var d=o.filterArea;o.filterArea=n.getBounds(!0),l.filter.push(o,a),o.filterArea=d,e._filters||this.alphaMaskIndex++},t.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},t.prototype.pushColorMask=function(e){var i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},t.prototype.popColorMask=function(e){var i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},t.prototype.destroy=function(){this.renderer=null},t}(),gU=function(){function t(e){this.renderer=e,this.maskStack=[],this.glConst=0}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(e){var i=this.renderer.gl,r=this.getStackLength();this.maskStack=e;var n=this.getStackLength();n!==r&&(n===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){this.renderer=null,this.maskStack=null},t}(),XN=new Zt,YN=[],vU=function(t){si(e,t);function e(i){var r=t.call(this,i)||this;return r.glConst=Oe.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,r}return e.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0},e.prototype.calcScissorRect=function(i){var r;if(!i._scissorRectLocal){var n=i._scissorRect,o=i.maskObject,a=this.renderer,l=a.renderTexture,h=o.getBounds(!0,(r=YN.pop())!==null&&r!==void 0?r:new wt);this.roundFrameToPixels(h,l.current?l.current.resolution:a.resolution,l.sourceFrame,l.destinationFrame,a.projection.transform),n&&h.fit(n),i._scissorRectLocal=h}},e.isMatrixRotated=function(i){if(!i)return!1;var r=i.a,n=i.b,o=i.c,a=i.d;return(Math.abs(n)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(r)>1e-4||Math.abs(a)>1e-4)},e.prototype.testScissor=function(i){var r=i.maskObject;if(!r.isFastRect||!r.isFastRect()||e.isMatrixRotated(r.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);var n=i._scissorRectLocal;return n.width>0&&n.height>0},e.prototype.roundFrameToPixels=function(i,r,n,o,a){e.isMatrixRotated(a)||(a=a?XN.copyFrom(a):XN.identity(),a.translate(-n.x,-n.y).scale(o.width/n.width,o.height/n.height).translate(o.x,o.y),this.renderer.filter.transformAABB(a,i),i.fit(o),i.x=Math.round(i.x*r),i.y=Math.round(i.y*r),i.width=Math.round(i.width*r),i.height=Math.round(i.height*r))},e.prototype.push=function(i){i._scissorRectLocal||this.calcScissorRect(i);var r=this.renderer.gl;i._scissorRect||r.enable(r.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(i){var r=this.renderer.gl;i&&YN.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():r.disable(r.SCISSOR_TEST)},e.prototype._useCurrent=function(){var i=this.maskStack[this.maskStack.length-1]._scissorRect,r;this.renderer.renderTexture.current?r=i.y:r=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,r,i.width,i.height)},e}(gU),_U=function(t){si(e,t);function e(i){var r=t.call(this,i)||this;return r.glConst=Oe.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,r}return e.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._stencilCounter:0},e.prototype.push=function(i){var r=i.maskObject,n=this.renderer.gl,o=i._stencilCounter;o===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),i._stencilCounter++;var a=i._colorMask;a!==0&&(i._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,o,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,a!==0&&(i._colorMask=a,n.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)),this._useCurrent()},e.prototype.pop=function(i){var r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,o=n?n._colorMask:15;o!==0&&(n._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,o!==0&&(n._colorMask=o,r.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}},e.prototype._useCurrent=function(){var i=this.renderer.gl;i.stencilFunc(i.EQUAL,this.getStackLength(),4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},e}(gU),yU=function(){function t(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Zt,this.transform=null}return t.prototype.update=function(e,i,r,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);var o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(e,i,r,n){var o=this.projectionMatrix,a=n?-1:1;o.identity(),o.a=1/i.width*2,o.d=a*(1/i.height*2),o.tx=-1-i.x*o.a,o.ty=-a-i.y*o.d},t.prototype.setTransform=function(e){},t.prototype.destroy=function(){this.renderer=null},t}(),wl=new wt,qf=new wt,xU=function(){function t(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new wt,this.destinationFrame=new wt,this.viewportFrame=new wt}return t.prototype.bind=function(e,i,r){e===void 0&&(e=null);var n=this.renderer;this.current=e;var o,a,l;e?(o=e.baseTexture,l=o.resolution,i||(wl.width=e.frame.width,wl.height=e.frame.height,i=wl),r||(qf.x=e.frame.x,qf.y=e.frame.y,qf.width=i.width,qf.height=i.height,r=qf),a=o.framebuffer):(l=n.resolution,i||(wl.width=n.screen.width,wl.height=n.screen.height,i=wl),r||(r=wl,r.width=i.width,r.height=i.height));var h=this.viewportFrame;h.x=r.x*l,h.y=r.y*l,h.width=r.width*l,h.height=r.height*l,e||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,i,l,!a),e?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)},t.prototype.clear=function(e,i){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor;var r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,o=r.width!==n.width||r.height!==n.height;if(o){var a=this.viewportFrame,l=a.x,h=a.y,u=a.width,c=a.height;l=Math.round(l),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,c)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],i),o&&this.renderer.scissor.pop()},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t.prototype.destroy=function(){this.renderer=null},t}();function T$(t,e,i,r,n){i.buffer.update(n)}var A$={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},bU={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function P$(t){for(var e=t.map(function(h){return{data:h,offset:0,dataLen:0,dirty:0}}),i=0,r=0,n=0,o=0;o<e.length;o++){var a=e[o];if(i=bU[a.data.type],a.data.size>1&&(i=Math.max(i,16)*a.data.size),a.dataLen=i,r%i!==0&&r<16){var l=r%i%16;r+=l,n+=l}r+i>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=i,r=i):(a.offset=n,r+=i,n+=i)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function R$(t,e){var i=[];for(var r in t)e[r]&&i.push(e[r]);return i.sort(function(n,o){return n.index-o.index}),i}function L$(t,e){if(!t.autoManage)return{size:0,syncFunc:T$};for(var i=R$(t.uniforms,e),r=P$(i),n=r.uboElements,o=r.size,a=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],l=0;l<n.length;l++){for(var h=n[l],u=t.uniforms[h.data.name],c=h.data.name,f=!1,d=0;d<ou.length;d++){var m=ou[d];if(m.codeUbo&&m.test(h.data,u)){a.push("offset = "+h.offset/4+";",ou[d].codeUbo(h.data.name,u)),f=!0;break}}if(!f)if(h.data.size>1){var p=dU(h.data.type),v=Math.max(bU[h.data.type]/16,1),g=p/v,_=(4-g%4)%4;a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;

                t = 0;

                for(var i=0; i < `+h.data.size*v+`; i++)
                {
                    for(var j = 0; j < `+g+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+_+`;
                }

                `)}else{var x=A$[h.data.type];a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;
                `+x+`;
                `)}}return a.push(`
       renderer.buffer.update(buffer);
    `),{size:o,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join(`
`))}}var O$=function(){function t(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},t}();function D$(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=e.getActiveAttrib(t,n);if(o.name.indexOf("gl_")!==0){var a=pU(e,o.type),l={type:a,name:o.name,size:dU(a),location:e.getAttribLocation(t,o.name)};i[o.name]=l}}return i}function I$(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=e.getActiveUniform(t,n),a=o.name.replace(/\[.*?\]$/,""),l=!!o.name.match(/\[.*?\]$/),h=pU(e,o.type);i[a]={name:a,index:n,type:h,size:o.size,isArray:l,value:cU(h,o.size)}}return i}function k$(t,e){var i=HN(t,t.VERTEX_SHADER,e.vertexSrc),r=HN(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();if(t.attachShader(n,i),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||l$(t,n,i,r),e.attributeData=D$(n,t),e.uniformData=I$(n,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var o=Object.keys(e.attributeData);o.sort(function(c,f){return c>f?1:-1});for(var a=0;a<o.length;a++)e.attributeData[o[a]].location=a,t.bindAttribLocation(n,a,o[a]);t.linkProgram(n)}t.deleteShader(i),t.deleteShader(r);var l={};for(var a in e.uniformData){var h=e.uniformData[a];l[a]={location:t.getUniformLocation(n,a),value:cU(h.type,h.size)}}var u=new O$(n,l);return u}var F$=0,Yv={textureCount:0,uboCount:0},wU=function(){function t(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=F$++}return t.prototype.systemCheck=function(){if(!_$())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(e){this.gl=e,this.reset()},t.prototype.bind=function(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),i||(Yv.textureCount=0,Yv.uboCount=0,this.syncUniformGroup(e.uniformGroup,Yv)),n},t.prototype.setUniforms=function(e){var i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)},t.prototype.syncUniformGroup=function(e,i){var r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))},t.prototype.syncUniforms=function(e,i,r){var n=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);n(i.uniformData,e.uniforms,this.renderer,r)},t.prototype.createSyncGroups=function(e){var i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=p$(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]},t.prototype.syncUniformBufferGroup=function(e,i){var r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;var n=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),n(r.uniformData,e.uniforms,this.renderer,Yv,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])},t.prototype.createSyncBufferGroup=function(e,i,r){var n=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var o=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(i.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;var a=this.getSignature(e,this.shader.program.uniformData,"ubo"),l=this._uboCache[a];if(l||(l=this._uboCache[a]=L$(e,this.shader.program.uniformData)),e.autoManage){var h=new Float32Array(l.size/4);e.buffer.update(h)}return i.uniformGroups[e.id]=l.syncFunc,i.uniformGroups[e.id]},t.prototype.getSignature=function(e,i,r){var n=e.uniforms,o=[r+"-"];for(var a in n)o.push(a),i[a]&&o.push(i[a].type);return o.join("-")},t.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateProgram=function(e){var i=this.gl,r=e.program,n=k$(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.disposeShader=function(e){this.shader===e&&(this.shader=null)},t.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},t}();function B$(t,e){return e===void 0&&(e=[]),e[et.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.ADD]=[t.ONE,t.ONE],e[et.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.NONE]=[0,0],e[et.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[et.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[et.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[et.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[et.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[et.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[et.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[et.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[et.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[et.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[et.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var N$=0,U$=1,z$=2,G$=3,H$=4,W$=5,SU=function(){function t(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=et.NONE,this._blendEq=!1,this.map=[],this.map[N$]=this.setBlend,this.map[U$]=this.setOffset,this.map[z$]=this.setCullFace,this.map[G$]=this.setDepthTest,this.map[H$]=this.setFrontFace,this.map[W$]=this.setDepthMask,this.checks=[],this.defaultState=new _s,this.defaultState.blend=!0}return t.prototype.contextChange=function(e){this.gl=e,this.blendModes=B$(e),this.set(this.defaultState),this.reset()},t.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var i=this.stateId^e.data,r=0;i;)i&1&&this.map[r].call(this,!!(e.data&1<<r)),i=i>>1,r++;this.stateId=e.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,e)},t.prototype.forceState=function(e){e=e||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(e.data&1<<i));for(var i=0;i<this.checks.length;i++)this.checks[i](this,e);this.stateId=e.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setDepthMask=function(e){this.gl.depthMask(e)},t.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},t.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var i=this.blendModes[e],r=this.gl;i.length===2?r.blendFunc(i[0],i[1]):r.blendFuncSeparate(i[0],i[1],i[2],i[3]),i.length===6?(this._blendEq=!0,r.blendEquationSeparate(i[4],i[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},t.prototype.setPolygonOffset=function(e,i){this.gl.polygonOffset(e,i)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(e,i){var r=this.checks.indexOf(e);i&&r===-1?this.checks.push(e):!i&&r!==-1&&this.checks.splice(r,1)},t.checkBlendMode=function(e,i){e.setBlendMode(i.blendMode)},t.checkPolygonOffset=function(e,i){e.setPolygonOffset(1,i.polygonOffset)},t.prototype.destroy=function(){this.gl=null},t}(),CU=function(){function t(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Oe.GC_MAX_IDLE,this.checkCountMax=Oe.GC_MAX_CHECK_COUNT,this.mode=Oe.GC_MODE}return t.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==Zh.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},t.prototype.run=function(){for(var e=this.renderer.texture,i=e.managedTextures,r=!1,n=0;n<i.length;n++){var o=i[n];!o.framebuffer&&this.count-o.touched>this.maxIdle&&(e.destroyTexture(o,!0),i[n]=null,r=!0)}if(r){for(var a=0,n=0;n<i.length;n++)i[n]!==null&&(i[a++]=i[n]);i.length=a}},t.prototype.unload=function(e){var i=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&i.destroyTexture(r);for(var n=e.children.length-1;n>=0;n--)this.unload(e.children[n])},t.prototype.destroy=function(){this.renderer=null},t}();function V$(t){var e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_,x,b,y,S,w,M;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?M=(e={},e[rt.UNSIGNED_BYTE]=(i={},i[Ae.RGBA]=t.RGBA8,i[Ae.RGB]=t.RGB8,i[Ae.RG]=t.RG8,i[Ae.RED]=t.R8,i[Ae.RGBA_INTEGER]=t.RGBA8UI,i[Ae.RGB_INTEGER]=t.RGB8UI,i[Ae.RG_INTEGER]=t.RG8UI,i[Ae.RED_INTEGER]=t.R8UI,i[Ae.ALPHA]=t.ALPHA,i[Ae.LUMINANCE]=t.LUMINANCE,i[Ae.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,i),e[rt.BYTE]=(r={},r[Ae.RGBA]=t.RGBA8_SNORM,r[Ae.RGB]=t.RGB8_SNORM,r[Ae.RG]=t.RG8_SNORM,r[Ae.RED]=t.R8_SNORM,r[Ae.RGBA_INTEGER]=t.RGBA8I,r[Ae.RGB_INTEGER]=t.RGB8I,r[Ae.RG_INTEGER]=t.RG8I,r[Ae.RED_INTEGER]=t.R8I,r),e[rt.UNSIGNED_SHORT]=(n={},n[Ae.RGBA_INTEGER]=t.RGBA16UI,n[Ae.RGB_INTEGER]=t.RGB16UI,n[Ae.RG_INTEGER]=t.RG16UI,n[Ae.RED_INTEGER]=t.R16UI,n[Ae.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,n),e[rt.SHORT]=(o={},o[Ae.RGBA_INTEGER]=t.RGBA16I,o[Ae.RGB_INTEGER]=t.RGB16I,o[Ae.RG_INTEGER]=t.RG16I,o[Ae.RED_INTEGER]=t.R16I,o),e[rt.UNSIGNED_INT]=(a={},a[Ae.RGBA_INTEGER]=t.RGBA32UI,a[Ae.RGB_INTEGER]=t.RGB32UI,a[Ae.RG_INTEGER]=t.RG32UI,a[Ae.RED_INTEGER]=t.R32UI,a[Ae.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,a),e[rt.INT]=(l={},l[Ae.RGBA_INTEGER]=t.RGBA32I,l[Ae.RGB_INTEGER]=t.RGB32I,l[Ae.RG_INTEGER]=t.RG32I,l[Ae.RED_INTEGER]=t.R32I,l),e[rt.FLOAT]=(h={},h[Ae.RGBA]=t.RGBA32F,h[Ae.RGB]=t.RGB32F,h[Ae.RG]=t.RG32F,h[Ae.RED]=t.R32F,h[Ae.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,h),e[rt.HALF_FLOAT]=(u={},u[Ae.RGBA]=t.RGBA16F,u[Ae.RGB]=t.RGB16F,u[Ae.RG]=t.RG16F,u[Ae.RED]=t.R16F,u),e[rt.UNSIGNED_SHORT_5_6_5]=(c={},c[Ae.RGB]=t.RGB565,c),e[rt.UNSIGNED_SHORT_4_4_4_4]=(f={},f[Ae.RGBA]=t.RGBA4,f),e[rt.UNSIGNED_SHORT_5_5_5_1]=(d={},d[Ae.RGBA]=t.RGB5_A1,d),e[rt.UNSIGNED_INT_2_10_10_10_REV]=(m={},m[Ae.RGBA]=t.RGB10_A2,m[Ae.RGBA_INTEGER]=t.RGB10_A2UI,m),e[rt.UNSIGNED_INT_10F_11F_11F_REV]=(p={},p[Ae.RGB]=t.R11F_G11F_B10F,p),e[rt.UNSIGNED_INT_5_9_9_9_REV]=(v={},v[Ae.RGB]=t.RGB9_E5,v),e[rt.UNSIGNED_INT_24_8]=(g={},g[Ae.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,g),e[rt.FLOAT_32_UNSIGNED_INT_24_8_REV]=(_={},_[Ae.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,_),e):M=(x={},x[rt.UNSIGNED_BYTE]=(b={},b[Ae.RGBA]=t.RGBA,b[Ae.RGB]=t.RGB,b[Ae.ALPHA]=t.ALPHA,b[Ae.LUMINANCE]=t.LUMINANCE,b[Ae.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,b),x[rt.UNSIGNED_SHORT_5_6_5]=(y={},y[Ae.RGB]=t.RGB,y),x[rt.UNSIGNED_SHORT_4_4_4_4]=(S={},S[Ae.RGBA]=t.RGBA,S),x[rt.UNSIGNED_SHORT_5_5_5_1]=(w={},w[Ae.RGBA]=t.RGBA,w),x),M}var QS=function(){function t(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=rt.UNSIGNED_BYTE,this.internalFormat=Ae.RGBA,this.samplerType=0}return t}(),EU=function(){function t(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new St,this.hasIntegerTextures=!1}return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=V$(e);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(var r=0;r<i;r++)this.boundTextures[r]=null;this.emptyTextures={};var n=new QS(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new QS(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var r=0;r<this.boundTextures.length;r++)this.bind(null,r)},t.prototype.bind=function(e,i){i===void 0&&(i=0);var r=this.gl;if(e=e==null?void 0:e.castToBaseTexture(),e&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;var n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},t.prototype.unbind=function(e){var i=this,r=i.gl,n=i.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<n.length;o++)n[o]===this.unknownTexture&&this.bind(null,o)}for(var o=0;o<n.length;o++)n[o]===e&&(this.currentLocation!==o&&(r.activeTexture(r.TEXTURE0+o),this.currentLocation=o),r.bindTexture(e.target,this.emptyTextures[e.target].texture),n[o]=null)},t.prototype.ensureSamplerType=function(e){var i=this,r=i.boundTextures,n=i.hasIntegerTextures,o=i.CONTEXT_UID;if(n)for(var a=e-1;a>=0;--a){var l=r[a];if(l){var h=l._glTextures[o];h.samplerType!==Af.FLOAT&&this.renderer.texture.unbind(l)}}},t.prototype.initTexture=function(e){var i=new QS(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i},t.prototype.initTextureType=function(e,i){var r,n;i.internalFormat=(n=(r=this.internalFormats[e.type])===null||r===void 0?void 0:r[e.format])!==null&&n!==void 0?n:e.format,this.webGLVersion===2&&e.type===rt.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type},t.prototype.updateTexture=function(e){var i=e._glTextures[this.CONTEXT_UID];if(i){var r=this.renderer;if(this.initTextureType(e,i),e.resource&&e.resource.upload(r,e,i))i.samplerType!==Af.FLOAT&&(this.hasIntegerTextures=!0);else{var n=e.realWidth,o=e.realHeight,a=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}},t.prototype.destroyTexture=function(e,i){var r=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){var n=this.managedTextures.indexOf(e);n!==-1&&vs(this.managedTextures,n,1)}},t.prototype.updateTextureStyle=function(e){var i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===zr.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Ur.CLAMP:i.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)},t.prototype.setStyle=function(e,i){var r=this.gl;if(i.mipmap&&e.mipmap!==zr.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Hn.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===Hn.LINEAR){var o=Math.min(e.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Hn.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Hn.LINEAR?r.LINEAR:r.NEAREST)},t.prototype.destroy=function(){this.renderer=null},t}(),MU={__proto__:null,FilterSystem:oU,BatchSystem:aU,ContextSystem:lU,FramebufferSystem:hU,GeometrySystem:uU,MaskSystem:mU,ScissorSystem:vU,StencilSystem:_U,ProjectionSystem:yU,RenderTextureSystem:xU,ShaderSystem:wU,StateSystem:SU,TextureGCSystem:CU,TextureSystem:EU},JS=new Zt,j$=function(t){si(e,t);function e(i,r){i===void 0&&(i=Yh.UNKNOWN);var n=t.call(this)||this;return r=Object.assign({},Oe.RENDER_OPTIONS,r),n.options=r,n.type=i,n.screen=new wt(0,0,r.width,r.height),n.view=r.view||Oe.ADAPTER.createCanvas(),n.resolution=r.resolution||Oe.RESOLUTION,n.useContextAlpha=r.useContextAlpha,n.autoDensity=!!r.autoDensity,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n.backgroundAlpha=r.backgroundAlpha,r.transparent!==void 0&&(Gi("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=r.transparent,n.backgroundAlpha=r.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return e.prototype.initPlugins=function(i){for(var r in i)this.plugins[r]=new i[r](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(i,r){this.view.width=Math.round(i*this.resolution),this.view.height=Math.round(r*this.resolution);var n=this.view.width/this.resolution,o=this.view.height/this.resolution;this.screen.width=n,this.screen.height=o,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=o+"px"),this.emit("resize",n,o)},e.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={}),typeof r=="number"&&(Gi("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),r={scaleMode:r,resolution:n,region:o});var a=r.region,l=XJ(r,["region"]);o=a||i.getLocalBounds(null,!0),o.width===0&&(o.width=1),o.height===0&&(o.height=1);var h=Po.create(eC({width:o.width,height:o.height},l));return JS.tx=-o.x,JS.ty=-o.y,this.render(i,{renderTexture:h,clear:!1,transform:JS,skipUpdateTransform:!!i.parent}),h},e.prototype.destroy=function(i){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;i&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=Yh.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(i){this._backgroundColor=i,this._backgroundColorString=Ff(i),Vn(i,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(i){this._backgroundColorRgba[3]=i},enumerable:!1,configurable:!0}),e}(Xs.default),q$=function(){function t(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return t}(),X$=function(){function t(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}return t.prototype.destroy=function(){this.renderer=null},t.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},t.prototype.bind=function(e){var i=this,r=i.gl,n=i.CONTEXT_UID,o=e._glBuffers[n]||this.createGLBuffer(e);r.bindBuffer(e.type,o.buffer)},t.prototype.bindBufferBase=function(e,i){var r=this,n=r.gl,o=r.CONTEXT_UID;if(this.boundBufferBases[i]!==e){var a=e._glBuffers[o]||this.createGLBuffer(e);this.boundBufferBases[i]=e,n.bindBufferBase(n.UNIFORM_BUFFER,i,a.buffer)}},t.prototype.bindBufferRange=function(e,i,r){var n=this,o=n.gl,a=n.CONTEXT_UID;r=r||0;var l=e._glBuffers[a]||this.createGLBuffer(e);o.bindBufferRange(o.UNIFORM_BUFFER,i||0,l.buffer,r*256,256)},t.prototype.update=function(e){var i=this,r=i.gl,n=i.CONTEXT_UID,o=e._glBuffers[n];if(e._updateID!==o.updateID)if(o.updateID=e._updateID,r.bindBuffer(e.type,o.buffer),o.byteLength>=e.data.byteLength)r.bufferSubData(e.type,0,e.data);else{var a=e.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;o.byteLength=e.data.byteLength,r.bufferData(e.type,e.data,a)}},t.prototype.dispose=function(e,i){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var r=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),r&&(i||n.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeAll=function(e){for(var i=Object.keys(this.managedBuffers),r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)},t.prototype.createGLBuffer=function(e){var i=this,r=i.CONTEXT_UID,n=i.gl;return e._glBuffers[r]=new q$(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[r]},t}(),TU=function(t){si(e,t);function e(i){var r=t.call(this,Yh.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new sr("destroy"),contextChange:new sr("contextChange"),reset:new sr("reset"),update:new sr("update"),postrender:new sr("postrender"),prerender:new sr("prerender"),resize:new sr("resize")},r.runners.contextChange.add(r),r.globalUniforms=new Ca({projectionMatrix:new Zt},!0),r.addSystem(mU,"mask").addSystem(lU,"context").addSystem(SU,"state").addSystem(wU,"shader").addSystem(EU,"texture").addSystem(X$,"buffer").addSystem(uU,"geometry").addSystem(hU,"framebuffer").addSystem(vU,"scissor").addSystem(_U,"stencil").addSystem(yU,"projection").addSystem(CU,"textureGC").addSystem(oU,"filter").addSystem(xU,"renderTexture").addSystem(aU,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:i.antialias,premultipliedAlpha:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,LS(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return e.create=function(i){if(OS())return new e(i);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var i=this.gl,r;if(this.context.webGLVersion===1){var n=i.getParameter(i.FRAMEBUFFER_BINDING);i.bindFramebuffer(i.FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.FRAMEBUFFER,n)}else{var n=i.getParameter(i.DRAW_FRAMEBUFFER_BINDING);i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n)}r>=$t.HIGH?this.multisample=$t.HIGH:r>=$t.MEDIUM?this.multisample=$t.MEDIUM:r>=$t.LOW?this.multisample=$t.LOW:this.multisample=$t.NONE},e.prototype.addSystem=function(i,r){var n=new i(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=n;for(var o in this.runners)this.runners[o].add(n);return this},e.prototype.render=function(i,r){var n,o,a,l;if(r&&(r instanceof Po?(Gi("6.0.0","Renderer#render arguments changed, use options instead."),n=r,o=arguments[2],a=arguments[3],l=arguments[4]):(n=r.renderTexture,o=r.clear,a=r.transform,l=r.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=a,!this.context.isLost){if(n||(this._lastObjectRendered=i),!l){var h=i.enableTempParent();i.updateTransform(),i.disableTempParent(h)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(o!==void 0?o:this.clearBeforeRender)&&this.renderTexture.clear(),i.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={});var a=t.prototype.generateTexture.call(this,i,r,n,o);return this.framebuffer.blit(),a},e.prototype.resize=function(i,r){t.prototype.resize.call(this,i,r),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(i){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();t.prototype.destroy.call(this,i),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return Gi("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(i,r){Gi("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),En.add({name:i,type:At.RendererPlugin,ref:r})},e.__plugins={},e}(j$);En.handleByMap(At.RendererPlugin,TU.__plugins);function AU(t){return TU.create(t)}var Y$=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Z$=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,PU=Y$,Kv=Z$,xRe=function(){function t(e){Gi("6.1.0","System class is deprecated, implemement ISystem interface instead."),this.renderer=e}return t.prototype.destroy=function(){this.renderer=null},t}(),Qv=function(){function t(){this.texArray=null,this.blend=0,this.type=tn.TRIANGLES,this.start=0,this.size=0,this.data=null}return t}(),Jv=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},t}(),$v=function(){function t(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(e){return this[e+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},t}(),K$=function(t){si(e,t);function e(i){var r=t.call(this,i)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=_s.for2d(),r.size=Oe.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),i.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return e.prototype.contextChange=function(){var i=this.renderer.gl;Oe.PREFER_ENV===Vs.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Oe.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=v$(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var i=e._drawCallPool,r=e._textureArrayPool,n=this.size/4,o=Math.floor(n/this.MAX_TEXTURES)+1;i.length<n;)i.push(new Qv);for(;r.length<o;)r.push(new Jv);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(i){i._texture.valid&&(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)},e.prototype.buildTexturesAndDrawCalls=function(){var i=this,r=i._bufferedTextures,n=i.MAX_TEXTURES,o=e._textureArrayPool,a=this.renderer.batch,l=this._tempBoundTextures,h=this.renderer.textureGC.count,u=++St._globalBatch,c=0,f=o[0],d=0;a.copyBoundTextures(l,n);for(var m=0;m<this._bufferSize;++m){var p=r[m];r[m]=null,p._batchEnabled!==u&&(f.count>=n&&(a.boundArray(f,l,u,n),this.buildDrawCalls(f,d,m),d=m,f=o[++c],++u),p._batchEnabled=u,p.touched=h,f.elements[f.count++]=p)}f.count>0&&(a.boundArray(f,l,u,n),this.buildDrawCalls(f,d,this._bufferSize),++c,++u);for(var m=0;m<l.length;m++)l[m]=null;St._globalBatch=u},e.prototype.buildDrawCalls=function(i,r,n){var o=this,a=o._bufferedElements,l=o._attributeBuffer,h=o._indexBuffer,u=o.vertexSize,c=e._drawCallPool,f=this._dcIndex,d=this._aIndex,m=this._iIndex,p=c[f];p.start=this._iIndex,p.texArray=i;for(var v=r;v<n;++v){var g=a[v],_=g._texture.baseTexture,x=kv[_.alphaMode?1:0][g.blendMode];a[v]=null,r<v&&p.blend!==x&&(p.size=m-p.start,r=v,p=c[++f],p.texArray=i,p.start=m),this.packInterleavedGeometry(g,l,h,d,m),d+=g.vertexData.length/2*u,m+=g.indices.length,p.blend=x}r<n&&(p.size=m-p.start,++f),this._dcIndex=f,this._aIndex=d,this._iIndex=m},e.prototype.bindAndClearTexArray=function(i){for(var r=this.renderer.texture,n=0;n<i.count;n++)r.bind(i.elements[n],i.ids[n]),i.elements[n]=null;i.count=0},e.prototype.updateGeometry=function(){var i=this,r=i._packedGeometries,n=i._attributeBuffer,o=i._indexBuffer;Oe.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var i=this._dcIndex,r=this.renderer,n=r.gl,o=r.state,a=e._drawCallPool,l=null,h=0;h<i;h++){var u=a[h],c=u.texArray,f=u.type,d=u.size,m=u.start,p=u.blend;l!==c&&(l=c,this.bindAndClearTexArray(c)),this.state.blendMode=p,o.set(this.state),n.drawElements(f,d,n.UNSIGNED_SHORT,m*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Oe.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(i){var r=ru(Math.ceil(i/8)),n=Bv(r),o=r*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var a=this._aBuffers[o];return a||(this._aBuffers[o]=a=new $v(o*this.vertexSize*4)),a},e.prototype.getIndexBuffer=function(i){var r=ru(Math.ceil(i/12)),n=Bv(r),o=r*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var a=this._iBuffers[n];return a||(this._iBuffers[n]=a=new Uint16Array(o)),a},e.prototype.packInterleavedGeometry=function(i,r,n,o,a){for(var l=r.uint32View,h=r.float32View,u=o/this.vertexSize,c=i.uvs,f=i.indices,d=i.vertexData,m=i._texture.baseTexture._batchLocation,p=Math.min(i.worldAlpha,1),v=p<1&&i._texture.baseTexture.alphaMode?vl(i._tintRGB,p):i._tintRGB+(p*255<<24),g=0;g<d.length;g+=2)h[o++]=d[g],h[o++]=d[g+1],h[o++]=c[g],h[o++]=c[g+1],l[o++]=v,h[o++]=m;for(var g=0;g<f.length;g++)n[a++]=u+f[g]},e._drawCallPool=[],e._textureArrayPool=[],e}(lu),Q$=function(){function t(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},i.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(i.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(e){if(!this.programCache[e]){for(var i=new Int32Array(e),r=0;r<e;r++)i[r]=r;this.defaultGroupCache[e]=Ca.from({uSamplers:i},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+e),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new El(this.vertexSrc,n)}var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Zt,default:this.defaultGroupCache[e]};return new qn(this.programCache[e],o)},t.prototype.generateSampleSrc=function(e){var i="";i+=`
`,i+=`
`;for(var r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+="if(vTextureId < "+r+".5)"),i+=`
{`,i+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",i+=`
}`;return i+=`
`,i+=`
`,i},t}(),oC=function(t){si(e,t);function e(i){i===void 0&&(i=!1);var r=t.call(this)||this;return r._buffer=new Ri(null,i,!1),r._indexBuffer=new Ri(null,i,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,rt.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,rt.FLOAT).addAttribute("aColor",r._buffer,4,!0,rt.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,rt.FLOAT).addIndex(r._indexBuffer),r}return e}(Cl),ZN=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,KN=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,J$=function(){function t(){}return t.create=function(e){var i=Object.assign({vertex:ZN,fragment:KN,geometryClass:oC,vertexSize:6},e),r=i.vertex,n=i.fragment,o=i.vertexSize,a=i.geometryClass;return function(l){si(h,l);function h(u){var c=l.call(this,u)||this;return c.shaderGenerator=new Q$(r,n),c.geometryClass=a,c.vertexSize=o,c}return h}(K$)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return ZN},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return KN},enumerable:!1,configurable:!0}),t}(),aC=J$.create();Object.assign(aC,{extension:{name:"batch",type:At.RendererPlugin}});var $$={},eee=function(t){Object.defineProperty($$,t,{get:function(){return Gi("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),rU[t]}})};for(Xf in rU)eee(Xf);var Xf,tee={},iee=function(t){Object.defineProperty(tee,t,{get:function(){return Gi("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),MU[t]}})};for(Xf in MU)iee(Xf);var Xf;var ree={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ni.mixin(ree);var nee=9,e_=100,see=0,oee=0,RU=2,LU=1,aee=-1e3,lee=-1e3,hee=2,OU=function(){function t(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(nn.tablet||nn.phone)&&this.createTouchHook();var i=document.createElement("div");i.style.width=e_+"px",i.style.height=e_+"px",i.style.position="absolute",i.style.top=see+"px",i.style.left=oee+"px",i.style.zIndex=RU.toString(),this.div=i,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var e=this,i=document.createElement("button");i.style.width=LU+"px",i.style.height=LU+"px",i.style.position="absolute",i.style.top=aee+"px",i.style.left=lee+"px",i.style.zIndex=hee.toString(),i.style.backgroundColor="#FF0000",i.title="select to enable accessibility for this content",i.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(i),this._hookDiv=i},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)===null||e===void 0||e.appendChild(this.div))},t.prototype.deactivate=function(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)===null||e===void 0||e.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(e){if(!(!e.visible||!e.accessibleChildren)){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);var i=e.children;if(i)for(var r=0;r<i.length;r++)this.updateAccessibleObjects(i[r])}},t.prototype.update=function(){var e=performance.now();if(!(nn.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var i=this.renderer.view.getBoundingClientRect(),r=i.left,n=i.top,o=i.width,a=i.height,l=this.renderer,h=l.width,u=l.height,c=l.resolution,f=o/h*c,d=a/u*c,m=this.div;m.style.left=r+"px",m.style.top=n+"px",m.style.width=h+"px",m.style.height=u+"px";for(var p=0;p<this.children.length;p++){var v=this.children[p];if(v.renderId!==this.renderId)v._accessibleActive=!1,vs(this.children,p,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,p--;else{m=v._accessibleDiv;var g=v.hitArea,_=v.worldTransform;v.hitArea?(m.style.left=(_.tx+g.x*_.a)*f+"px",m.style.top=(_.ty+g.y*_.d)*d+"px",m.style.width=g.width*_.a*f+"px",m.style.height=g.height*_.d*d+"px"):(g=v.getBounds(),this.capHitArea(g),m.style.left=g.x*f+"px",m.style.top=g.y*d+"px",m.style.width=g.width*f+"px",m.style.height=g.height*d+"px",m.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(m.title=v.accessibleTitle),m.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&m.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==m.title||v.tabIndex!==m.tabIndex)&&(m.title=v.accessibleTitle,m.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(m))}}this.renderId++}},t.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},t.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);var i=this.renderer,r=i.width,n=i.height;e.x+e.width>r&&(e.width=r-e.x),e.y+e.height>n&&(e.height=n-e.y)},t.prototype.addChild=function(e){var i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=e_+"px",i.style.height=e_+"px",i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=RU.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=e.accessiblePointerEvents,i.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?i.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(i.title="displayObject "+e.tabIndex),e.accessibleHint&&e.accessibleHint!==null&&i.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(i),e._accessibleActive=!0,e._accessibleDiv=i,i.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},t.prototype._onClick=function(e){var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"click",n),i.dispatchEvent(r,"pointertap",n),i.dispatchEvent(r,"tap",n)},t.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"mouseover",n)},t.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"mouseout",n)},t.prototype._onKeyDown=function(e){e.keyCode===nee&&this.activate()},t.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t.extension={name:"accessibility",type:[At.RendererPlugin,At.CanvasRendererPlugin]},t}();var r_=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Gt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(e,i,r){return e.worldTransform.applyInverse(r||this.global,i)},t.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var i="buttons"in e&&e.buttons;this.buttons=Number.isInteger(i)?i:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}();var hC=function(t,e){return hC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},hC(t,e)};function uee(t,e){hC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var cee=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),lC=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(e,i){i?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return(this._flags&t.FLAGS.OVER)!==0},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return(this._flags&t.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return(this._flags&t.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),fee=function(){function t(){this._tempPoint=new Gt}return t.prototype.recursiveFindHit=function(e,i,r,n,o){var a;if(!i||!i.visible)return!1;var l=e.data.global;o=i.interactive||o;var h=!1,u=o,c=!0;if(i.hitArea)n&&(i.worldTransform.applyInverse(l,this._tempPoint),i.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?h=!0:(n=!1,c=!1)),u=!1;else if(i._mask&&n){var f=i._mask.isMaskData?i._mask.maskObject:i._mask;f&&!(!((a=f.containsPoint)===null||a===void 0)&&a.call(f,l))&&(n=!1)}if(c&&i.interactiveChildren&&i.children)for(var d=i.children,m=d.length-1;m>=0;m--){var p=d[m],v=this.recursiveFindHit(e,p,r,n,u);if(v){if(!p.parent)continue;u=!1,v&&(e.target&&(n=!1),h=!0)}}return o&&(n&&!e.target&&!i.hitArea&&i.containsPoint&&i.containsPoint(l)&&(h=!0),i.interactive&&(h&&!e.target&&(e.target=i),r&&r(e,i,!!h))),h},t.prototype.findHit=function(e,i,r,n){this.recursiveFindHit(e,i,r,n,!1)},t}(),dee={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(t){t?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ni.mixin(dee);var t_=1,i_={target:null,data:{global:null}},DU=function(t){uee(e,t);function e(i,r){var n=t.call(this)||this;return r=r||{},n.renderer=i,n.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new r_,n.mouse.identifier=t_,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[t_]=n.mouse,n.interactionDataPool=[],n.eventData=new cee,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in globalThis),n.supportsTouchEvents="ontouchstart"in globalThis,n.supportsPointerEvents=!!globalThis.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new fee,n._tempDisplayObject=new zS,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(i){this._useSystemTicker=i,i?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(i,r){return i_.target=null,i_.data.global=i,r||(r=this.lastObjectRendered),this.processInteractive(i_,r,null,!0),i_.target},e.prototype.setTargetElement=function(i,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=i,this.resolution=r,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Pi.system.add(this.tickerUpdate,this,jn.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Pi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(i.msContentZooming="none",i.msTouchAction="none"):this.supportsPointerEvents&&(i.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(i.msContentZooming="",i.msTouchAction=""):this.supportsPointerEvents&&(i.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(i){this._deltaTime+=i,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var i in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(i)){var r=this.activeInteractionData[i];if(r.originalEvent&&r.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(i){i=i||"default";var r=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(r=!1),this.currentCursorMode!==i){this.currentCursorMode=i;var n=this.cursorStyles[i];if(n)switch(typeof n){case"string":r&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(i);break;case"object":r&&Object.assign(this.interactionDOMElement.style,n);break}else r&&typeof i=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,i)&&(this.interactionDOMElement.style.cursor=i)}},e.prototype.dispatchEvent=function(i,r,n){(!n.stopPropagationHint||i===n.stopsPropagatingAt)&&(n.currentTarget=i,n.type=r,i.emit(r,n),i[r]&&i[r](n))},e.prototype.delayDispatchEvent=function(i,r,n){this.delayedEvents.push({displayObject:i,eventString:r,eventData:n})},e.prototype.mapPositionToPoint=function(i,r,n){var o;this.interactionDOMElement.parentElement?o=this.interactionDOMElement.getBoundingClientRect():o={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var a=1/this.resolution;i.x=(r-o.left)*(this.interactionDOMElement.width/o.width)*a,i.y=(n-o.top)*(this.interactionDOMElement.height/o.height)*a},e.prototype.processInteractive=function(i,r,n,o){var a=this.search.findHit(i,r,n,o),l=this.delayedEvents;if(!l.length)return a;i.stopPropagationHint=!1;var h=l.length;this.delayedEvents=[];for(var u=0;u<h;u++){var c=l[u],f=c.displayObject,d=c.eventString,m=c.eventData;m.stopsPropagatingAt===f&&(m.stopPropagationHint=!0),this.dispatchEvent(f,d,m)}return a},e.prototype.onPointerDown=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);if(this.autoPreventDefault&&r[0].isNormalized){var n=i.cancelable||!("cancelable"in i);n&&i.preventDefault()}for(var o=r.length,a=0;a<o;a++){var l=r[a],h=this.getInteractionDataForPointerId(l),u=this.configureInteractionEventForDOMEvent(this.eventData,l,h);if(u.data.originalEvent=i,this.processInteractive(u,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",u),l.pointerType==="touch")this.emit("touchstart",u);else if(l.pointerType==="mouse"||l.pointerType==="pen"){var c=l.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(i,r,n){var o=i.data,a=i.data.identifier;if(n){if(r.trackedPointers[a]||(r.trackedPointers[a]=new lC(a)),this.dispatchEvent(r,"pointerdown",i),o.pointerType==="touch")this.dispatchEvent(r,"touchstart",i);else if(o.pointerType==="mouse"||o.pointerType==="pen"){var l=o.button===2;l?r.trackedPointers[a].rightDown=!0:r.trackedPointers[a].leftDown=!0,this.dispatchEvent(r,l?"rightdown":"mousedown",i)}}},e.prototype.onPointerComplete=function(i,r,n){var o=this.normalizeToPointerData(i),a=o.length,l=i.target;i.composedPath&&i.composedPath().length>0&&(l=i.composedPath()[0]);for(var h=l!==this.interactionDOMElement?"outside":"",u=0;u<a;u++){var c=o[u],f=this.getInteractionDataForPointerId(c),d=this.configureInteractionEventForDOMEvent(this.eventData,c,f);if(d.data.originalEvent=i,this.processInteractive(d,this.lastObjectRendered,n,r||!h),this.emit(r?"pointercancel":"pointerup"+h,d),c.pointerType==="mouse"||c.pointerType==="pen"){var m=c.button===2;this.emit(m?"rightup"+h:"mouseup"+h,d)}else c.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+h,d),this.releaseInteractionDataForPointerId(c.pointerId))}},e.prototype.onPointerCancel=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(i,r){var n=i.data,o=i.data.identifier;r.trackedPointers[o]!==void 0&&(delete r.trackedPointers[o],this.dispatchEvent(r,"pointercancel",i),n.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",i))},e.prototype.onPointerUp=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!1,this.processPointerUp)},e.prototype.processPointerUp=function(i,r,n){var o=i.data,a=i.data.identifier,l=r.trackedPointers[a],h=o.pointerType==="touch",u=o.pointerType==="mouse"||o.pointerType==="pen",c=!1;if(u){var f=o.button===2,d=lC.FLAGS,m=f?d.RIGHT_DOWN:d.LEFT_DOWN,p=l!==void 0&&l.flags&m;n?(this.dispatchEvent(r,f?"rightup":"mouseup",i),p&&(this.dispatchEvent(r,f?"rightclick":"click",i),c=!0)):p&&this.dispatchEvent(r,f?"rightupoutside":"mouseupoutside",i),l&&(f?l.rightDown=!1:l.leftDown=!1)}n?(this.dispatchEvent(r,"pointerup",i),h&&this.dispatchEvent(r,"touchend",i),l&&((!u||c)&&this.dispatchEvent(r,"pointertap",i),h&&(this.dispatchEvent(r,"tap",i),l.over=!1))):l&&(this.dispatchEvent(r,"pointerupoutside",i),h&&this.dispatchEvent(r,"touchendoutside",i)),l&&l.none&&delete r.trackedPointers[a]},e.prototype.onPointerMove=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=r.length,o=0;o<n;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);h.data.originalEvent=i,this.processInteractive(h,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),a.pointerType==="touch"&&this.emit("touchmove",h),(a.pointerType==="mouse"||a.pointerType==="pen")&&this.emit("mousemove",h)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(i,r,n){var o=i.data,a=o.pointerType==="touch",l=o.pointerType==="mouse"||o.pointerType==="pen";l&&this.processPointerOverOut(i,r,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(r,"pointermove",i),a&&this.dispatchEvent(r,"touchmove",i),l&&this.dispatchEvent(r,"mousemove",i))},e.prototype.onPointerOut=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i),n=r[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var o=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,o);a.data.originalEvent=n,this.processInteractive(a,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",a),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",a):this.releaseInteractionDataForPointerId(o.identifier)}},e.prototype.processPointerOverOut=function(i,r,n){var o=i.data,a=i.data.identifier,l=o.pointerType==="mouse"||o.pointerType==="pen",h=r.trackedPointers[a];n&&!h&&(h=r.trackedPointers[a]=new lC(a)),h!==void 0&&(n&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(r,"pointerover",i),l&&this.delayDispatchEvent(r,"mouseover",i)),l&&this.cursor===null&&(this.cursor=r.cursor)):h.over&&(h.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),l&&this.dispatchEvent(r,"mouseout",i),h.none&&delete r.trackedPointers[a]))},e.prototype.onPointerOver=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i),n=r[0],o=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,o);a.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",a),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",a)}},e.prototype.getInteractionDataForPointerId=function(i){var r=i.pointerId,n;return r===t_||i.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[r]?n=this.activeInteractionData[r]:(n=this.interactionDataPool.pop()||new r_,n.identifier=r,this.activeInteractionData[r]=n),n.copyEvent(i),n},e.prototype.releaseInteractionDataForPointerId=function(i){var r=this.activeInteractionData[i];r&&(delete this.activeInteractionData[i],r.reset(),this.interactionDataPool.push(r))},e.prototype.configureInteractionEventForDOMEvent=function(i,r,n){return i.data=n,this.mapPositionToPoint(n.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=n.global.x,r.globalY=n.global.y),n.originalEvent=r,i.reset(),i},e.prototype.normalizeToPointerData=function(i){var r=[];if(this.supportsTouchEvents&&i instanceof TouchEvent)for(var n=0,o=i.changedTouches.length;n<o;n++){var a=i.changedTouches[n];typeof a.button=="undefined"&&(a.button=i.touches.length?1:0),typeof a.buttons=="undefined"&&(a.buttons=i.touches.length?1:0),typeof a.isPrimary=="undefined"&&(a.isPrimary=i.touches.length===1&&i.type==="touchstart"),typeof a.width=="undefined"&&(a.width=a.radiusX||1),typeof a.height=="undefined"&&(a.height=a.radiusY||1),typeof a.tiltX=="undefined"&&(a.tiltX=0),typeof a.tiltY=="undefined"&&(a.tiltY=0),typeof a.pointerType=="undefined"&&(a.pointerType="touch"),typeof a.pointerId=="undefined"&&(a.pointerId=a.identifier||0),typeof a.pressure=="undefined"&&(a.pressure=a.force||.5),typeof a.twist=="undefined"&&(a.twist=0),typeof a.tangentialPressure=="undefined"&&(a.tangentialPressure=0),typeof a.layerX=="undefined"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY=="undefined"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,r.push(a)}else if(!globalThis.MouseEvent||i instanceof MouseEvent&&(!this.supportsPointerEvents||!(i instanceof globalThis.PointerEvent))){var l=i;typeof l.isPrimary=="undefined"&&(l.isPrimary=!0),typeof l.width=="undefined"&&(l.width=1),typeof l.height=="undefined"&&(l.height=1),typeof l.tiltX=="undefined"&&(l.tiltX=0),typeof l.tiltY=="undefined"&&(l.tiltY=0),typeof l.pointerType=="undefined"&&(l.pointerType="mouse"),typeof l.pointerId=="undefined"&&(l.pointerId=t_),typeof l.pressure=="undefined"&&(l.pressure=.5),typeof l.twist=="undefined"&&(l.twist=0),typeof l.tangentialPressure=="undefined"&&(l.tangentialPressure=0),l.isNormalized=!0,r.push(l)}else r.push(i);return r},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e.extension={name:"interaction",type:[At.RendererPlugin,At.CanvasRendererPlugin]},e}(Xs.default);var pee=new wt,mee=4,IU=function(){function t(e){this.renderer=e}return t.prototype.image=function(e,i,r){var n=new Image;return n.src=this.base64(e,i,r),n},t.prototype.base64=function(e,i,r){return this.canvas(e).toDataURL(i,r)},t.prototype.canvas=function(e,i){var r=this._rawPixels(e,i),n=r.pixels,o=r.width,a=r.height,l=r.flipY,h=new Uv(o,a,1),u=h.context.getImageData(0,0,o,a);if(t.arrayPostDivide(n,u.data),h.context.putImageData(u,0,0),l){var c=new Uv(h.width,h.height,1);c.context.scale(1,-1),c.context.drawImage(h.canvas,0,-a),h.destroy(),h=c}return h.canvas},t.prototype.pixels=function(e,i){var r=this._rawPixels(e,i).pixels;return t.arrayPostDivide(r,r),r},t.prototype._rawPixels=function(e,i){var r=this.renderer,n,o=!1,a,l=!1;if(e)if(e instanceof Po)a=e;else{var h=r.context.webGLVersion>=2?r.multisample:$t.NONE;if(a=this.renderer.generateTexture(e,{multisample:h}),h!==$t.NONE){var u=Po.create({width:a.width,height:a.height});r.framebuffer.bind(a.framebuffer),r.framebuffer.blit(u.framebuffer),r.framebuffer.bind(null),a.destroy(!0),a=u}l=!0}a?(n=a.baseTexture.resolution,i=i!=null?i:a.frame,o=!1,r.renderTexture.bind(a)):(n=r.resolution,i||(i=pee,i.width=r.width,i.height=r.height),o=!0,r.renderTexture.bind(null));var c=Math.round(i.width*n),f=Math.round(i.height*n),d=new Uint8Array(mee*c*f),m=r.gl;return m.readPixels(Math.round(i.x*n),Math.round(i.y*n),c,f,m.RGBA,m.UNSIGNED_BYTE,d),l&&a.destroy(!0),{pixels:d,width:c,height:f,flipY:o}},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(e,i){for(var r=0;r<e.length;r+=4){var n=i[r+3]=e[r+3];n!==0?(i[r]=Math.round(Math.min(e[r]*255/n,255)),i[r+1]=Math.round(Math.min(e[r+1]*255/n,255)),i[r+2]=Math.round(Math.min(e[r+2]*255/n,255))):(i[r]=e[r],i[r+1]=e[r+1],i[r+2]=e[r+2])}},t.extension={name:"extract",type:At.RendererPlugin},t}();var n_=function(){function t(e,i,r){i===void 0&&(i=!1),this._fn=e,this._once=i,this._thisArg=r,this._next=this._prev=this._owner=null}return t.prototype.detach=function(){return this._owner===null?!1:(this._owner.detach(this),!0)},t}();function kU(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var Ro=function(){function t(){this._head=this._tail=void 0}return t.prototype.handlers=function(e){e===void 0&&(e=!1);var i=this._head;if(e)return!!i;for(var r=[];i;)r.push(i),i=i._next;return r},t.prototype.has=function(e){if(!(e instanceof n_))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return e._owner===this},t.prototype.dispatch=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=this._head;if(!n)return!1;for(;n;)n._once&&this.detach(n),n._fn.apply(n._thisArg,i),n=n._next;return!0},t.prototype.add=function(e,i){if(i===void 0&&(i=null),typeof e!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return kU(this,new n_(e,!1,i))},t.prototype.once=function(e,i){if(i===void 0&&(i=null),typeof e!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return kU(this,new n_(e,!0,i))},t.prototype.detach=function(e){if(!(e instanceof n_))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,e._next===null&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)},t.prototype.detachAll=function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this},t}();function UU(t,e){e=e||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[i.key[o]]=r[o]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(a,l,h){l&&(n[i.q.name][l]=h)}),n}var uC,s_=null,gee=0,FU=200,vee=204,_ee=1223,yee=2;function BU(){}function NU(t,e,i){e&&e.indexOf(".")===0&&(e=e.substring(1)),e&&(t[e]=i)}function cC(t){return t.toString().replace("object ","")}var li=function(){function t(e,i,r){if(this._dequeue=BU,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,typeof e!="string"||typeof i!="string")throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,i.indexOf("data:")===0),this.name=e,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=r.crossOrigin===!0?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=BU,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Ro,this.onProgress=new Ro,this.onComplete=new Ro,this.onAfterMiddleware=new Ro}return t.setExtensionLoadType=function(e,i){NU(t._loadTypeMap,e,i)},t.setExtensionXhrType=function(e,i){NU(t._xhrTypeMap,e,i)},Object.defineProperty(t.prototype,"isDataUrl",{get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),t.prototype.complete=function(){this._clearEvents(),this._finish()},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.prototype.load=function(e){var i=this;if(!this.isLoading){if(this.isComplete){e&&setTimeout(function(){return e(i)},1);return}else e&&this.onComplete.once(e);switch(this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:typeof uC=="undefined"&&(uC=!!(globalThis.XDomainRequest&&!("withCredentials"in new XMLHttpRequest))),uC&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},t.prototype._hasFlag=function(e){return(this._flags&e)!==0},t.prototype._setFlag=function(e,i){this._flags=i?this._flags|e:this._flags&~e},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:e==="image"&&typeof globalThis.Image!="undefined"?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:e==="audio"&&typeof globalThis.Audio!="undefined"?this.data=new Audio:this.data=document.createElement(e),this.data===null){this.abort("Unsupported element: "+e);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var i=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(i)?i[r]:i));else{var i=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(i)?i[0]:i))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;this.crossOrigin==="use-credentials"&&(e.withCredentials=!0),e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new globalThis.XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},t.prototype._createSource=function(e,i,r){r||(r=e+"/"+this._getExtension(i));var n=document.createElement("source");return n.src=i,n.type=r,n},t.prototype._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},t.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},t.prototype._onTimeout=function(){this.abort("Load timed out.")},t.prototype._xhrOnError=function(){var e=this.xhr;this.abort(cC(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},t.prototype._xhrOnTimeout=function(){var e=this.xhr;this.abort(cC(e)+" Request timed out.")},t.prototype._xhrOnAbort=function(){var e=this.xhr;this.abort(cC(e)+" Request was aborted by the user.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,i="",r=typeof e.status=="undefined"?FU:e.status;(e.responseType===""||e.responseType==="text"||typeof e.responseType=="undefined")&&(i=e.responseText),r===gee&&(i.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=FU:r===_ee&&(r=vee);var n=r/100|0;if(n===yee)if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=t.TYPE.JSON}catch(l){this.abort("Error trying to parse loaded json: "+l);return}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(globalThis.DOMParser){var o=new DOMParser;this.data=o.parseFromString(i,"text/xml")}else{var a=document.createElement("div");a.innerHTML=i,this.data=a}this.type=t.TYPE.XML}catch(l){this.abort("Error trying to parse loaded xml: "+l);return}else this.data=e.response||i;else{this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL);return}this.complete()},t.prototype._determineCrossOrigin=function(e,i){if(e.indexOf("data:")===0)return"";if(globalThis.origin!==globalThis.location.origin)return"anonymous";i=i||globalThis.location,s_||(s_=document.createElement("a")),s_.href=e;var r=UU(s_.href,{strictMode:!0}),n=!r.port&&i.port===""||r.port===i.port,o=r.protocol?r.protocol+":":"";return r.host!==i.hostname||!n||o!==i.protocol?"anonymous":""},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(e){e===void 0&&(e=this.url);var i="";if(this.isDataUrl){var r=e.indexOf("/");i=e.substring(r+1,e.indexOf(";",r))}else{var n=e.indexOf("?"),o=e.indexOf("#"),a=Math.min(n>-1?n:e.length,o>-1?o:e.length);e=e.substring(0,a),i=e.substring(e.lastIndexOf(".")+1)}return i.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t}();(function(t){(function(e){e[e.NONE=0]="NONE",e[e.DATA_URL=1]="DATA_URL",e[e.COMPLETE=2]="COMPLETE",e[e.LOADING=4]="LOADING"})(t.STATUS_FLAGS||(t.STATUS_FLAGS={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.XML=2]="XML",e[e.IMAGE=3]="IMAGE",e[e.AUDIO=4]="AUDIO",e[e.VIDEO=5]="VIDEO",e[e.TEXT=6]="TEXT"}(t.TYPE||(t.TYPE={})),function(e){e[e.XHR=1]="XHR",e[e.IMAGE=2]="IMAGE",e[e.AUDIO=3]="AUDIO",e[e.VIDEO=4]="VIDEO"}(t.LOAD_TYPE||(t.LOAD_TYPE={})),function(e){e.DEFAULT="text",e.BUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.TEXT="text"}(t.XHR_RESPONSE_TYPE||(t.XHR_RESPONSE_TYPE={})),t._loadTypeMap={gif:t.LOAD_TYPE.IMAGE,png:t.LOAD_TYPE.IMAGE,bmp:t.LOAD_TYPE.IMAGE,jpg:t.LOAD_TYPE.IMAGE,jpeg:t.LOAD_TYPE.IMAGE,tif:t.LOAD_TYPE.IMAGE,tiff:t.LOAD_TYPE.IMAGE,webp:t.LOAD_TYPE.IMAGE,tga:t.LOAD_TYPE.IMAGE,avif:t.LOAD_TYPE.IMAGE,svg:t.LOAD_TYPE.IMAGE,"svg+xml":t.LOAD_TYPE.IMAGE,mp3:t.LOAD_TYPE.AUDIO,ogg:t.LOAD_TYPE.AUDIO,wav:t.LOAD_TYPE.AUDIO,mp4:t.LOAD_TYPE.VIDEO,webm:t.LOAD_TYPE.VIDEO},t._xhrTypeMap={xhtml:t.XHR_RESPONSE_TYPE.DOCUMENT,html:t.XHR_RESPONSE_TYPE.DOCUMENT,htm:t.XHR_RESPONSE_TYPE.DOCUMENT,xml:t.XHR_RESPONSE_TYPE.DOCUMENT,tmx:t.XHR_RESPONSE_TYPE.DOCUMENT,svg:t.XHR_RESPONSE_TYPE.DOCUMENT,tsx:t.XHR_RESPONSE_TYPE.DOCUMENT,gif:t.XHR_RESPONSE_TYPE.BLOB,png:t.XHR_RESPONSE_TYPE.BLOB,bmp:t.XHR_RESPONSE_TYPE.BLOB,jpg:t.XHR_RESPONSE_TYPE.BLOB,jpeg:t.XHR_RESPONSE_TYPE.BLOB,tif:t.XHR_RESPONSE_TYPE.BLOB,tiff:t.XHR_RESPONSE_TYPE.BLOB,webp:t.XHR_RESPONSE_TYPE.BLOB,tga:t.XHR_RESPONSE_TYPE.BLOB,avif:t.XHR_RESPONSE_TYPE.BLOB,json:t.XHR_RESPONSE_TYPE.JSON,text:t.XHR_RESPONSE_TYPE.TEXT,txt:t.XHR_RESPONSE_TYPE.TEXT,ttf:t.XHR_RESPONSE_TYPE.BUFFER,otf:t.XHR_RESPONSE_TYPE.BUFFER},t.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})(li||(li={}));function Ml(){}function xee(t){return function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(t===null)throw new Error("Callback was already called.");var o=t;t=null,o.apply(this,r)}}var bee=function(){function t(e,i){this.data=e,this.callback=i}return t}(),fC=function(){function t(e,i){var r=this;if(i===void 0&&(i=1),this.workers=0,this.saturated=Ml,this.unsaturated=Ml,this.empty=Ml,this.drain=Ml,this.error=Ml,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(n,o,a){if(a&&typeof a!="function")throw new Error("task callback must be a function");if(r.started=!0,n==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var l=new bee(n,typeof a=="function"?a:Ml);o?r._tasks.unshift(l):r._tasks.push(l),setTimeout(r.process,1)},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var n=r._tasks.shift();r._tasks.length===0&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(n.data,xee(r._next(n)))}},this._worker=e,i===0)throw new Error("Concurrency must not be zero");this.concurrency=i,this.buffer=i/4}return t.prototype._next=function(e){var i=this;return function(){for(var r=arguments,n=[],o=0;o<arguments.length;o++)n[o]=r[o];i.workers-=1,e.callback.apply(e,n),n[0]!=null&&i.error(n[0],e.data),i.workers<=i.concurrency-i.buffer&&i.unsaturated(),i.idle()&&i.drain(),i.process()}},t.prototype.push=function(e,i){this._insert(e,!1,i)},t.prototype.kill=function(){this.workers=0,this.drain=Ml,this.started=!1,this._tasks=[]},t.prototype.unshift=function(e,i){this._insert(e,!0,i)},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){this.paused!==!0&&(this.paused=!0)},t.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var e=1;e<=this.concurrency;e++)this.process()}},t.eachSeries=function(e,i,r,n){var o=0,a=e.length;function l(h){if(h||o===a){r&&r(h);return}n?setTimeout(function(){i(e[o++],l)},1):i(e[o++],l)}l()},t.queue=function(e,i){return new t(e,i)},t}(),dC=100,wee=/(#[\w-]+)?$/,o_=function(){function t(e,i){var r=this;e===void 0&&(e=""),i===void 0&&(i=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return r._loadResource(h,u)},this.resources={},this.baseUrl=e,this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return r._loadResource(h,u)},this._queue=fC.queue(this._boundLoadResource,i),this._queue.pause(),this.resources={},this.onProgress=new Ro,this.onError=new Ro,this.onLoad=new Ro,this.onStart=new Ro,this.onComplete=new Ro;for(var n=0;n<t._plugins.length;++n){var o=t._plugins[n],a=o.pre,l=o.use;a&&this.pre(a),l&&this.use(l)}this._protected=!1}return t.prototype._add=function(e,i,r,n){if(this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(i=this._prepareUrl(i),this.resources[e]=new li(e,i,r),typeof n=="function"&&this.resources[e].onAfterMiddleware.once(n),this.loading){for(var o=r.parentResource,a=[],l=0;l<o.children.length;++l)o.children[l].isComplete||a.push(o.children[l]);var h=o.progressChunk*(a.length+1),u=h/(a.length+2);o.children.push(this.resources[e]),o.progressChunk=u;for(var l=0;l<a.length;++l)a[l].progressChunk=u;this.resources[e].progressChunk=u}return this._queue.push(this.resources[e]),this},t.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},t.prototype.use=function(e){return this._afterMiddleware.push(e),this},t.prototype.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var e in this.resources){var i=this.resources[e];i._onLoadBinding&&i._onLoadBinding.detach(),i.isLoading&&i.abort("loader reset")}return this.resources={},this},t.prototype.load=function(e){if(Gi("6.5.0","@pixi/loaders is being replaced with @pixi/assets in the next major release."),typeof e=="function"&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var i=this._queue._tasks.length,r=dC/i,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},Object.defineProperty(t.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e},enumerable:!1,configurable:!0}),t.prototype._prepareUrl=function(e){var i=UU(e,{strictMode:!0}),r;if(i.protocol||!i.path||e.indexOf("//")===0?r=e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&e.charAt(0)!=="/"?r=this.baseUrl+"/"+e:r=this.baseUrl+e,this.defaultQueryString){var n=wee.exec(r)[0];r=r.slice(0,r.length-n.length),r.indexOf("?")!==-1?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=n}return r},t.prototype._loadResource=function(e,i){var r=this;e._dequeue=i,fC.eachSeries(this._beforeMiddleware,function(n,o){n.call(r,e,function(){o(e.isComplete?{}:null)})},function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=dC,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(e){var i=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),fC.eachSeries(this._afterMiddleware,function(r,n){r.call(i,e,n)},function(){e.onAfterMiddleware.dispatch(e),i.progress=Math.min(dC,i.progress+e.progressChunk),i.onProgress.dispatch(i,e),e.error?i.onError.dispatch(e.error,i,e):i.onLoad.dispatch(i,e),i._resourcesParsing.splice(i._resourcesParsing.indexOf(e),1),i._queue.idle()&&i._resourcesParsing.length===0&&i._onComplete()},!0)},t.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(t,"shared",{get:function(){var e=t._shared;return e||(e=new t,e._protected=!0,t._shared=e),e},enumerable:!1,configurable:!0}),t.registerPlugin=function(e){return Gi("6.5.0","Loader.registerPlugin() is deprecated, use extensions.add() instead."),En.add({type:At.Loader,ref:e}),t},t._plugins=[],t}();En.handleByList(At.Loader,o_._plugins);o_.prototype.add=function(e,i,r,n){if(Array.isArray(e)){for(var o=0;o<e.length;++o)this.add(e[o]);return this}if(typeof e=="object"&&(r=e,n=i||r.callback||r.onComplete,i=r.url,e=r.name||r.key||r.url),typeof i!="string"&&(n=r,r=i,i=e),typeof i!="string")throw new Error("No url passed to add resource to loader.");return typeof r=="function"&&(n=r,r=null),this._add(e,i,r,n)};var zU=function(){function t(){}return t.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?o_.shared:new o_},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.extension=At.Application,t}(),See=function(){function t(){}return t.add=function(){li.setExtensionLoadType("svg",li.LOAD_TYPE.XHR),li.setExtensionXhrType("svg",li.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){if(e.data&&(e.type===li.TYPE.IMAGE||e.extension==="svg")){var r=e.data,n=e.url,o=e.name,a=e.metadata;tt.fromLoader(r,n,o,a).then(function(l){e.texture=l,i()}).catch(i)}else i()},t.extension=At.Loader,t}(),Cee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Eee(t){for(var e="",i=0;i<t.length;){for(var r=[0,0,0],n=[0,0,0,0],o=0;o<r.length;++o)i<t.length?r[o]=t.charCodeAt(i++)&255:r[o]=0;n[0]=r[0]>>2,n[1]=(r[0]&3)<<4|r[1]>>4,n[2]=(r[1]&15)<<2|r[2]>>6,n[3]=r[2]&63;var a=i-(t.length-1);switch(a){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64;break}for(var o=0;o<n.length;++o)e+=Cee.charAt(n[o])}return e}function Mee(t,e){if(!t.data){e();return}if(t.xhr&&t.xhrType===li.XHR_RESPONSE_TYPE.BLOB){if(!self.Blob||typeof t.data=="string"){var i=t.xhr.getResponseHeader("content-type");if(i&&i.indexOf("image")===0){t.data=new Image,t.data.src="data:"+i+";base64,"+Eee(t.xhr.responseText),t.type=li.TYPE.IMAGE,t.data.onload=function(){t.data.onload=null,e()};return}}else if(t.data.type.indexOf("image")===0){var r=globalThis.URL||globalThis.webkitURL,n=r.createObjectURL(t.data);t.blob=t.data,t.data=new Image,t.data.src=n,t.type=li.TYPE.IMAGE,t.data.onload=function(){r.revokeObjectURL(n),t.data.onload=null,e()};return}}e()}var Tee=function(){function t(){}return t.extension=At.Loader,t.use=Mee,t}();En.add(See,Tee);var Kt,Pt;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR"})(Pt||(Pt={}));var u_=(Kt={},Kt[Pt.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,Kt[Pt.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,Kt[Pt.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,Kt[Pt.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,Kt[Pt.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,Kt[Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,Kt[Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,Kt[Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,Kt[Pt.COMPRESSED_R11_EAC]=.5,Kt[Pt.COMPRESSED_SIGNED_R11_EAC]=.5,Kt[Pt.COMPRESSED_RG11_EAC]=1,Kt[Pt.COMPRESSED_SIGNED_RG11_EAC]=1,Kt[Pt.COMPRESSED_RGB8_ETC2]=.5,Kt[Pt.COMPRESSED_RGBA8_ETC2_EAC]=1,Kt[Pt.COMPRESSED_SRGB8_ETC2]=.5,Kt[Pt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,Kt[Pt.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,Kt[Pt.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,Kt[Pt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,Kt[Pt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,Kt[Pt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,Kt[Pt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,Kt[Pt.COMPRESSED_RGB_ETC1_WEBGL]=.5,Kt[Pt.COMPRESSED_RGB_ATC_WEBGL]=.5,Kt[Pt.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,Kt[Pt.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,Kt[Pt.COMPRESSED_RGBA_ASTC_4x4_KHR]=1,Kt);var mC=function(t,e){return mC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},mC(t,e)};function VU(t,e){mC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}function Aee(t,e,i,r){function n(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(c){try{u(r.next(c))}catch(f){a(f)}}function h(c){try{u(r.throw(c))}catch(f){a(f)}}function u(c){c.done?o(c.value):n(c.value).then(l,h)}u((r=r.apply(t,e||[])).next())})}function Pee(t,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(u){return function(c){return h([u,c])}}function h(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=u[0]&2?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(u[0]===6&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(c){u=[6,c],n=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ree=function(t){VU(e,t);function e(i,r){r===void 0&&(r={width:1,height:1,autoLoad:!0});var n=this,o,a;return typeof i=="string"?(o=i,a=new Uint8Array):(o=null,a=i),n=t.call(this,a,r)||this,n.origin=o,n.buffer=a?new $v(a):null,n.origin&&r.autoLoad!==!1&&n.load(),a&&a.length&&(n.loaded=!0,n.onBlobLoaded(n.buffer.rawBinaryData)),n}return e.prototype.onBlobLoaded=function(i){},e.prototype.load=function(){return Aee(this,void 0,Promise,function(){var i,r,n;return Pee(this,function(o){switch(o.label){case 0:return[4,fetch(this.origin)];case 1:return i=o.sent(),[4,i.blob()];case 2:return r=o.sent(),[4,r.arrayBuffer()];case 3:return n=o.sent(),this.data=new Uint32Array(n),this.buffer=new $v(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),[2,this]}})})},e}(Sl),gC=function(t){VU(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.format=r.format,n.levels=r.levels||1,n._width=r.width,n._height=r.height,n._extension=e._formatToExtension(n.format),(r.levelBuffers||n.buffer)&&(n._levelBuffers=r.levelBuffers||e._createLevelBuffers(i instanceof Uint8Array?i:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return e.prototype.upload=function(i,r,n){var o=i.gl,a=i.context.extensions[this._extension];if(!a)throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var l=0,h=this.levels;l<h;l++){var u=this._levelBuffers[l],c=u.levelID,f=u.levelWidth,d=u.levelHeight,m=u.levelBuffer;o.compressedTexImage2D(o.TEXTURE_2D,c,this.format,f,d,0,m)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(i){if(i>=33776&&i<=33779)return"s3tc";if(i>=37488&&i<=37497)return"etc";if(i>=35840&&i<=35843)return"pvrtc";if(i>=36196)return"etc1";if(i>=35986&&i<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(i,r,n,o,a,l,h){for(var u=new Array(n),c=i.byteOffset,f=l,d=h,m=f+o-1&~(o-1),p=d+a-1&~(a-1),v=m*p*u_[r],g=0;g<n;g++)u[g]={levelID:g,levelWidth:n>1?f:m,levelHeight:n>1?d:p,levelBuffer:new Uint8Array(i.buffer,c,v)},c+=v,f=f>>1||1,d=d>>1||1,m=f+o-1&~(o-1),p=d+a-1&~(a-1),v=m*p*u_[r];return u},e}(Ree),jU=function(){function t(){}return t.use=function(e,i){var r=e.data,n=this;if(e.type===li.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var o=r.textures,a=void 0,l=void 0,h=0,u=o.length;h<u;h++){var c=o[h],f=c.src,d=c.format;if(d||(l=f),t.textureFormats[d]){a=f;break}}if(a=a||l,!a){i(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));return}if(a===e.url){i(new Error("URL of compressed texture cannot be the same as the manifest's URL"));return}var m={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},p=Mo.resolve(e.url.replace(n.baseUrl,""),a),v=r.cacheID;n.add(v,p,m,function(g){if(g.error){i(g.error);return}var _=g.texture,x=_===void 0?null:_,b=g.textures,y=b===void 0?{}:b;Object.assign(e,{texture:x,textures:y}),i()})}else i()},Object.defineProperty(t,"textureExtensions",{get:function(){if(!t._textureExtensions){var e=Oe.ADAPTER.createCanvas(),i=e.getContext("webgl");if(!i)return console.warn("WebGL not available for compressed textures. Silently failing."),{};var r={s3tc:i.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:i.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:i.getExtension("WEBGL_compressed_texture_etc"),etc1:i.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:i.getExtension("WEBGL_compressed_texture_atc"),astc:i.getExtension("WEBGL_compressed_texture_astc")};t._textureExtensions=r}return t._textureExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t,"textureFormats",{get:function(){if(!t._textureFormats){var e=t.textureExtensions;t._textureFormats={};for(var i in e){var r=e[i];r&&Object.assign(t._textureFormats,Object.getPrototypeOf(r))}}return t._textureFormats},enumerable:!1,configurable:!0}),t.extension=At.Loader,t}();function qU(t,e,i){var r={textures:{},texture:null};if(!e)return r;var n=e.map(function(o){return new tt(new St(o,Object.assign({mipmap:zr.OFF,alphaMode:rn.NO_PREMULTIPLIED_ALPHA},i)))});return n.forEach(function(o,a){var l=o.baseTexture,h=t+"-"+(a+1);St.addToCache(l,h),tt.addToCache(o,h),a===0&&(St.addToCache(l,t),tt.addToCache(o,t),r.texture=o),r.textures[h]=o}),r}var Zf,ys,pC=4,a_=124,Lee=32,GU=20,Oee=542327876,l_={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Dee={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},h_={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},bs;(function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"})(bs||(bs={}));var vC;(function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"})(vC||(vC={}));var Iee=1,kee=2,Fee=4,Bee=64,Nee=512,Uee=131072,zee=827611204,Gee=861165636,Hee=894720068,Wee=808540228,Vee=4,jee=(Zf={},Zf[zee]=Pt.COMPRESSED_RGBA_S3TC_DXT1_EXT,Zf[Gee]=Pt.COMPRESSED_RGBA_S3TC_DXT3_EXT,Zf[Hee]=Pt.COMPRESSED_RGBA_S3TC_DXT5_EXT,Zf),qee=(ys={},ys[bs.DXGI_FORMAT_BC1_TYPELESS]=Pt.COMPRESSED_RGBA_S3TC_DXT1_EXT,ys[bs.DXGI_FORMAT_BC1_UNORM]=Pt.COMPRESSED_RGBA_S3TC_DXT1_EXT,ys[bs.DXGI_FORMAT_BC2_TYPELESS]=Pt.COMPRESSED_RGBA_S3TC_DXT3_EXT,ys[bs.DXGI_FORMAT_BC2_UNORM]=Pt.COMPRESSED_RGBA_S3TC_DXT3_EXT,ys[bs.DXGI_FORMAT_BC3_TYPELESS]=Pt.COMPRESSED_RGBA_S3TC_DXT5_EXT,ys[bs.DXGI_FORMAT_BC3_UNORM]=Pt.COMPRESSED_RGBA_S3TC_DXT5_EXT,ys[bs.DXGI_FORMAT_BC1_UNORM_SRGB]=Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,ys[bs.DXGI_FORMAT_BC2_UNORM_SRGB]=Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,ys[bs.DXGI_FORMAT_BC3_UNORM_SRGB]=Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,ys);function Xee(t){var e=new Uint32Array(t),i=e[0];if(i!==Oee)throw new Error("Invalid DDS file magic word");var r=new Uint32Array(t,0,a_/Uint32Array.BYTES_PER_ELEMENT),n=r[l_.HEIGHT],o=r[l_.WIDTH],a=r[l_.MIPMAP_COUNT],l=new Uint32Array(t,l_.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Lee/Uint32Array.BYTES_PER_ELEMENT),h=l[Iee];if(h&Fee){var u=l[Dee.FOURCC];if(u!==Wee){var c=jee[u],f=pC+a_,d=new Uint8Array(t,f),m=new gC(d,{format:c,width:o,height:n,levels:a});return[m]}var p=pC+a_,v=new Uint32Array(e.buffer,p,GU/Uint32Array.BYTES_PER_ELEMENT),g=v[h_.DXGI_FORMAT],_=v[h_.RESOURCE_DIMENSION],x=v[h_.MISC_FLAG],b=v[h_.ARRAY_SIZE],y=qee[g];if(y===void 0)throw new Error("DDSParser cannot parse texture data with DXGI format "+g);if(x===Vee)throw new Error("DDSParser does not support cubemap textures");if(_===vC.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");var S=new Array,w=pC+a_+GU;if(b===1)S.push(new Uint8Array(t,w));else{for(var M=u_[y],C=0,E=o,P=n,A=0;A<a;A++){var R=Math.max(1,E+3&-4),k=Math.max(1,P+3&-4),I=R*k*M;C+=I,E=E>>>1,P=P>>>1}for(var L=w,A=0;A<b;A++)S.push(new Uint8Array(t,L,C)),L+=C}return S.map(function(T){return new gC(T,{format:y,width:o,height:n,levels:a})})}throw h&Bee?new Error("DDSParser does not support uncompressed texture data."):h&Nee?new Error("DDSParser does not supported YUV uncompressed texture data."):h&Uee?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&kee?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var Ea,Lo,Kf,HU=[171,75,84,88,32,49,49,187,13,10,26,10],Yee=67305985,xs={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},_C=64,WU=(Ea={},Ea[rt.UNSIGNED_BYTE]=1,Ea[rt.UNSIGNED_SHORT]=2,Ea[rt.INT]=4,Ea[rt.UNSIGNED_INT]=4,Ea[rt.FLOAT]=4,Ea[rt.HALF_FLOAT]=8,Ea),Zee=(Lo={},Lo[Ae.RGBA]=4,Lo[Ae.RGB]=3,Lo[Ae.RG]=2,Lo[Ae.RED]=1,Lo[Ae.LUMINANCE]=1,Lo[Ae.LUMINANCE_ALPHA]=2,Lo[Ae.ALPHA]=1,Lo),Kee=(Kf={},Kf[rt.UNSIGNED_SHORT_4_4_4_4]=2,Kf[rt.UNSIGNED_SHORT_5_5_5_1]=2,Kf[rt.UNSIGNED_SHORT_5_6_5]=2,Kf);function Qee(t,e,i){i===void 0&&(i=!1);var r=new DataView(e);if(!Jee(t,r))return null;var n=r.getUint32(xs.ENDIANNESS,!0)===Yee,o=r.getUint32(xs.GL_TYPE,n),a=r.getUint32(xs.GL_FORMAT,n),l=r.getUint32(xs.GL_INTERNAL_FORMAT,n),h=r.getUint32(xs.PIXEL_WIDTH,n),u=r.getUint32(xs.PIXEL_HEIGHT,n)||1,c=r.getUint32(xs.PIXEL_DEPTH,n)||1,f=r.getUint32(xs.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=r.getUint32(xs.NUMBER_OF_FACES,n),m=r.getUint32(xs.NUMBER_OF_MIPMAP_LEVELS,n),p=r.getUint32(xs.BYTES_OF_KEY_VALUE_DATA,n);if(u===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(f!==1)throw new Error("WebGL does not support array textures");var v=4,g=4,_=h+3&-4,x=u+3&-4,b=new Array(f),y=h*u;o===0&&(y=_*x);var S;if(o!==0?WU[o]?S=WU[o]*Zee[a]:S=Kee[o]:S=u_[l],S===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var w=i?ete(r,p,n):null,M=y*S,C=M,E=h,P=u,A=_,R=x,k=_C+p,I=0;I<m;I++){for(var L=r.getUint32(k,n),T=k+4,O=0;O<f;O++){var D=b[O];D||(D=b[O]=new Array(m)),D[I]={levelID:I,levelWidth:m>1||o!==0?E:A,levelHeight:m>1||o!==0?P:R,levelBuffer:new Uint8Array(e,T,C)},T+=C}k+=L+4,k=k%4!==0?k+4-k%4:k,E=E>>1||1,P=P>>1||1,A=E+v-1&~(v-1),R=P+g-1&~(g-1),C=A*R*S}return o!==0?{uncompressed:b.map(function(F){var B=F[0].levelBuffer,U=!1;return o===rt.FLOAT?B=new Float32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4):o===rt.UNSIGNED_INT?(U=!0,B=new Uint32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4)):o===rt.INT&&(U=!0,B=new Int32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4)),{resource:new Sl(B,{width:F[0].levelWidth,height:F[0].levelHeight}),type:o,format:U?$ee(a):a}}),kvData:w}:{compressed:b.map(function(F){return new gC(null,{format:l,width:h,height:u,levels:m,levelBuffers:F})}),kvData:w}}function Jee(t,e){for(var i=0;i<HU.length;i++)if(e.getUint8(i)!==HU[i])return console.error(t+" is not a valid *.ktx file!"),!1;return!0}function $ee(t){switch(t){case Ae.RGBA:return Ae.RGBA_INTEGER;case Ae.RGB:return Ae.RGB_INTEGER;case Ae.RG:return Ae.RG_INTEGER;case Ae.RED:return Ae.RED_INTEGER;default:return t}}function ete(t,e,i){for(var r=new Map,n=0;n<e;){var o=t.getUint32(_C+n,i),a=_C+n+4,l=3-(o+3)%4;if(o===0||o>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}for(var h=0;h<o&&t.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}var u=new TextDecoder().decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,o-h-1);r.set(u,c),n+=4+o+l}return r}li.setExtensionXhrType("dds",li.XHR_RESPONSE_TYPE.BUFFER);var XU=function(){function t(){}return t.use=function(e,i){if(e.extension==="dds"&&e.data)try{Object.assign(e,qU(e.name||e.url,Xee(e.data),e.metadata))}catch(r){i(r);return}i()},t.extension=At.Loader,t}();li.setExtensionXhrType("ktx",li.XHR_RESPONSE_TYPE.BUFFER);var YU=function(){function t(){}return t.use=function(e,i){if(e.extension==="ktx"&&e.data)try{var r=e.name||e.url,n=Qee(r,e.data,this.loadKeyValueData),o=n.compressed,a=n.uncompressed,l=n.kvData;if(o){var h=qU(r,o,e.metadata);if(l&&h.textures)for(var u in h.textures)h.textures[u].baseTexture.ktxKeyValueData=l;Object.assign(e,h)}else if(a){var c={};a.forEach(function(f,d){var m=new tt(new St(f.resource,{mipmap:zr.OFF,alphaMode:rn.NO_PREMULTIPLIED_ALPHA,type:f.type,format:f.format})),p=r+"-"+(d+1);l&&(m.baseTexture.ktxKeyValueData=l),St.addToCache(m.baseTexture,p),tt.addToCache(m,p),d===0&&(c[r]=m,St.addToCache(m.baseTexture,r),tt.addToCache(m,r)),c[p]=m}),Object.assign(e,{textures:c})}}catch(f){i(f);return}i()},t.extension=At.Loader,t.loadKeyValueData=!1,t}();var yC=function(t,e){return yC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},yC(t,e)};function KU(t,e){yC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var JRe=function(t){KU(e,t);function e(i,r,n,o){i===void 0&&(i=1500),n===void 0&&(n=16384),o===void 0&&(o=!1);var a=t.call(this)||this,l=16384;return n>l&&(n=l),a._properties=[!1,!0,!1,!1,!1],a._maxSize=i,a._batchSize=n,a._buffers=null,a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=et.NORMAL,a.autoResize=o,a.roundPixels=!0,a.baseTexture=null,a.setProperties(r),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return e.prototype.setProperties=function(i){i&&(this._properties[0]="vertices"in i||"scale"in i?!!i.vertices||!!i.scale:this._properties[0],this._properties[1]="position"in i?!!i.position:this._properties[1],this._properties[2]="rotation"in i?!!i.rotation:this._properties[2],this._properties[3]="uvs"in i?!!i.uvs:this._properties[3],this._properties[4]="tint"in i||"alpha"in i?!!i.tint||!!i.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i,Vn(i,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(i){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),i.batch.setObjectRenderer(i.plugins.particle),i.plugins.particle.render(this))},e.prototype.onChildrenChange=function(i){for(var r=Math.floor(i/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._buffers=null}},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e}(di),ZU=function(){function t(e,i,r){this.geometry=new Cl,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var o=e[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||rt.FLOAT,offset:o.offset},i[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var e=this.geometry,i=0;this.indexBuffer=new Ri(IS(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];n.offset=i,i+=n.size,this.dynamicStride+=n.size}var o=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(o),this.dynamicDataUint32=new Uint32Array(o),this.dynamicBuffer=new Ri(this.dynamicData,!1,!1);var a=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];n.offset=a,a+=n.size,this.staticStride+=n.size}var l=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(l),this.staticDataUint32=new Uint32Array(l),this.staticBuffer=new Ri(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];e.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===rt.UNSIGNED_BYTE,n.type,this.dynamicStride*4,n.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];e.addAttribute(n.attributeName,this.staticBuffer,0,n.type===rt.UNSIGNED_BYTE,n.type,this.staticStride*4,n.offset*4)}},t.prototype.uploadDynamic=function(e,i,r){for(var n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,i,r,o.type===rt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(e,i,r){for(var n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,i,r,o.type===rt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),tte=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,ite=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,QU=function(t){KU(e,t);function e(i){var r=t.call(this,i)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Zt,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:rt.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=qn.from(ite,tte,{}),r.state=_s.for2d(),r}return e.prototype.render=function(i){var r=i.children,n=i._maxSize,o=i._batchSize,a=this.renderer,l=r.length;if(l!==0){l>n&&!i.autoResize&&(l=n);var h=i._buffers;h||(h=i._buffers=this.generateBuffers(i));var u=r[0]._texture.baseTexture,c=u.alphaMode>0;this.state.blendMode=Nf(i.blendMode,c),a.state.set(this.state);var f=a.gl,d=i.worldTransform.copyTo(this.tempMatrix);d.prepend(a.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=DS(i.tintRgb,i.worldAlpha,this.shader.uniforms.uColor,c),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);for(var m=!1,p=0,v=0;p<l;p+=o,v+=1){var g=l-p;g>o&&(g=o),v>=h.length&&h.push(this._generateOneMoreBuffer(i));var _=h[v];_.uploadDynamic(r,p,g);var x=i._bufferUpdateIDs[v]||0;m=m||_._updateID<x,m&&(_._updateID=i._updateID,_.uploadStatic(r,p,g)),a.geometry.bind(_.geometry),f.drawElements(f.TRIANGLES,g*6,f.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(i){for(var r=[],n=i._maxSize,o=i._batchSize,a=i._properties,l=0;l<n;l+=o)r.push(new ZU(this.properties,a,o));return r},e.prototype._generateOneMoreBuffer=function(i){var r=i._batchSize,n=i._properties;return new ZU(this.properties,n,r)},e.prototype.uploadVertices=function(i,r,n,o,a,l){for(var h=0,u=0,c=0,f=0,d=0;d<n;++d){var m=i[r+d],p=m._texture,v=m.scale.x,g=m.scale.y,_=p.trim,x=p.orig;_?(u=_.x-m.anchor.x*x.width,h=u+_.width,f=_.y-m.anchor.y*x.height,c=f+_.height):(h=x.width*(1-m.anchor.x),u=x.width*-m.anchor.x,c=x.height*(1-m.anchor.y),f=x.height*-m.anchor.y),o[l]=u*v,o[l+1]=f*g,o[l+a]=h*v,o[l+a+1]=f*g,o[l+a*2]=h*v,o[l+a*2+1]=c*g,o[l+a*3]=u*v,o[l+a*3+1]=c*g,l+=a*4}},e.prototype.uploadPosition=function(i,r,n,o,a,l){for(var h=0;h<n;h++){var u=i[r+h].position;o[l]=u.x,o[l+1]=u.y,o[l+a]=u.x,o[l+a+1]=u.y,o[l+a*2]=u.x,o[l+a*2+1]=u.y,o[l+a*3]=u.x,o[l+a*3+1]=u.y,l+=a*4}},e.prototype.uploadRotation=function(i,r,n,o,a,l){for(var h=0;h<n;h++){var u=i[r+h].rotation;o[l]=u,o[l+a]=u,o[l+a*2]=u,o[l+a*3]=u,l+=a*4}},e.prototype.uploadUvs=function(i,r,n,o,a,l){for(var h=0;h<n;++h){var u=i[r+h]._texture._uvs;u?(o[l]=u.x0,o[l+1]=u.y0,o[l+a]=u.x1,o[l+a+1]=u.y1,o[l+a*2]=u.x2,o[l+a*2+1]=u.y2,o[l+a*3]=u.x3,o[l+a*3+1]=u.y3,l+=a*4):(o[l]=0,o[l+1]=0,o[l+a]=0,o[l+a+1]=0,o[l+a*2]=0,o[l+a*2+1]=0,o[l+a*3]=0,o[l+a*3+1]=0,l+=a*4)}},e.prototype.uploadTint=function(i,r,n,o,a,l){for(var h=0;h<n;++h){var u=i[r+h],c=u._texture.baseTexture.alphaMode>0,f=u.alpha,d=f<1&&c?vl(u._tintRGB,f):u._tintRGB+(f*255<<24);o[l]=d,o[l+a]=d,o[l+a*2]=d,o[l+a*3]=d,l+=a*4}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e.extension={name:"particle",type:At.RendererPlugin},e}(lu);var Oo;(function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"})(Oo||(Oo={}));var Ma;(function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"})(Ma||(Ma={}));var Qf={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(e===void 0&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},n4=function(){function t(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}();var wC=function(t,e){return wC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},wC(t,e)};function SC(t,e){wC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}function JU(t,e){var i,r;e===void 0&&(e=!1);var n=t.length;if(!(n<6)){for(var o=0,a=0,l=t[n-2],h=t[n-1];a<n;a+=2){var u=t[a],c=t[a+1];o+=(u-l)*(c+h),l=u,h=c}if(!e&&o>0||e&&o<=0)for(var f=n/2,a=f+f%2;a<n;a+=2){var d=n-a-2,m=n-a-1,p=a,v=a+1;i=[t[p],t[d]],t[d]=i[0],t[p]=i[1],r=[t[v],t[m]],t[m]=r[0],t[v]=r[1]}}}var s4={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,r=t.holes,n=e.points,o=e.indices;if(i.length>=6){JU(i,!1);for(var a=[],l=0;l<r.length;l++){var h=r[l];JU(h.points,!0),a.push(i.length/2),i=i.concat(h.points)}var u=(0,Gf.default)(i,a,2);if(!u)return;for(var c=n.length/2,l=0;l<u.length;l+=3)o.push(u[l]+c),o.push(u[l+1]+c),o.push(u[l+2]+c);for(var l=0;l<i.length;l++)n.push(i[l])}}},d_={build:function(t){var e=t.points,i,r,n,o,a,l;if(t.type===Ji.CIRC){var h=t.shape;i=h.x,r=h.y,a=l=h.radius,n=o=0}else if(t.type===Ji.ELIP){var u=t.shape;i=u.x,r=u.y,a=u.width,l=u.height,n=o=0}else{var c=t.shape,f=c.width/2,d=c.height/2;i=c.x+f,r=c.y+d,a=l=Math.max(0,Math.min(c.radius,Math.min(f,d))),n=f-a,o=d-l}if(!(a>=0&&l>=0&&n>=0&&o>=0)){e.length=0;return}var m=Math.ceil(2.3*Math.sqrt(a+l)),p=m*8+(n?4:0)+(o?4:0);if(e.length=p,p!==0){if(m===0){e.length=8,e[0]=e[6]=i+n,e[1]=e[3]=r+o,e[2]=e[4]=i-n,e[5]=e[7]=r-o;return}var v=0,g=m*4+(n?2:0)+2,_=g,x=p;{var b=n+a,y=o,S=i+b,w=i-b,M=r+y;if(e[v++]=S,e[v++]=M,e[--g]=M,e[--g]=w,o){var C=r-y;e[_++]=w,e[_++]=C,e[--x]=C,e[--x]=S}}for(var E=1;E<m;E++){var P=Math.PI/2*(E/m),b=n+Math.cos(P)*a,y=o+Math.sin(P)*l,S=i+b,w=i-b,M=r+y,C=r-y;e[v++]=S,e[v++]=M,e[--g]=M,e[--g]=w,e[_++]=w,e[_++]=C,e[--x]=C,e[--x]=S}{var b=n,y=o+l,S=i+b,w=i-b,M=r+y,C=r-y;e[v++]=S,e[v++]=M,e[--x]=C,e[--x]=S,n&&(e[v++]=w,e[v++]=M,e[--x]=C,e[--x]=w)}}},triangulate:function(t,e){var i=t.points,r=e.points,n=e.indices;if(i.length!==0){var o=r.length/2,a=o,l,h;if(t.type!==Ji.RREC){var u=t.shape;l=u.x,h=u.y}else{var c=t.shape;l=c.x+c.width/2,h=c.y+c.height/2}var f=t.matrix;r.push(t.matrix?f.a*l+f.c*h+f.tx:l,t.matrix?f.b*l+f.d*h+f.ty:h),o++,r.push(i[0],i[1]);for(var d=2;d<i.length;d+=2)r.push(i[d],i[d+1]),n.push(o++,a,o);n.push(a+1,a,o)}}},rte={build:function(t){var e=t.shape,i=e.x,r=e.y,n=e.width,o=e.height,a=t.points;a.length=0,a.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(t,e){var i=t.points,r=e.points,n=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function hu(t,e,i){var r=e-t;return t+r*i}function c_(t,e,i,r,n,o,a){a===void 0&&(a=[]);for(var l=20,h=a,u=0,c=0,f=0,d=0,m=0,p=0,v=0,g=0;v<=l;++v)g=v/l,u=hu(t,i,g),c=hu(e,r,g),f=hu(i,n,g),d=hu(r,o,g),m=hu(u,f,g),p=hu(c,d,g),!(v===0&&h[h.length-2]===m&&h[h.length-1]===p)&&h.push(m,p);return h}var nte={build:function(t){if(Si.nextRoundedRectBehavior){d_.build(t);return}var e=t.shape,i=t.points,r=e.x,n=e.y,o=e.width,a=e.height,l=Math.max(0,Math.min(e.radius,Math.min(o,a)/2));i.length=0,l?(c_(r,n+l,r,n,r+l,n,i),c_(r+o-l,n,r+o,n,r+o,n+l,i),c_(r+o,n+a-l,r+o,n+a,r+o-l,n+a,i),c_(r+l,n+a,r,n+a,r,n+a-l,i)):i.push(r,n,r+o,n,r+o,n+a,r,n+a)},triangulate:function(t,e){if(Si.nextRoundedRectBehavior){d_.triangulate(t,e);return}for(var i=t.points,r=e.points,n=e.indices,o=r.length/2,a=(0,Gf.default)(i,null,2),l=0,h=a.length;l<h;l+=3)n.push(a[l]+o),n.push(a[l+1]+o),n.push(a[l+2]+o);for(var l=0,h=i.length;l<h;l++)r.push(i[l],i[++l])}};function $U(t,e,i,r,n,o,a,l){var h=t-i*n,u=e-r*n,c=t+i*o,f=e+r*o,d,m;a?(d=r,m=-i):(d=-r,m=i);var p=h+d,v=u+m,g=c+d,_=f+m;return l.push(p,v),l.push(g,_),2}function Tl(t,e,i,r,n,o,a,l){var h=i-t,u=r-e,c=Math.atan2(h,u),f=Math.atan2(n-t,o-e);l&&c<f?c+=Math.PI*2:!l&&c>f&&(f+=Math.PI*2);var d=c,m=f-c,p=Math.abs(m),v=Math.sqrt(h*h+u*u),g=(15*p*Math.sqrt(v)/Math.PI>>0)+1,_=m/g;if(d+=_,l){a.push(t,e),a.push(i,r);for(var x=1,b=d;x<g;x++,b+=_)a.push(t,e),a.push(t+Math.sin(b)*v,e+Math.cos(b)*v);a.push(t,e),a.push(n,o)}else{a.push(i,r),a.push(t,e);for(var x=1,b=d;x<g;x++,b+=_)a.push(t+Math.sin(b)*v,e+Math.cos(b)*v),a.push(t,e);a.push(n,o),a.push(t,e)}return g*2}function ste(t,e){var i=t.shape,r=t.points||i.points.slice(),n=e.closePointEps;if(r.length!==0){var o=t.lineStyle,a=new Gt(r[0],r[1]),l=new Gt(r[r.length-2],r[r.length-1]),h=i.type!==Ji.POLY||i.closeStroke,u=Math.abs(a.x-l.x)<n&&Math.abs(a.y-l.y)<n;if(h){r=r.slice(),u&&(r.pop(),r.pop(),l.set(r[r.length-2],r[r.length-1]));var c=(a.x+l.x)*.5,f=(l.y+a.y)*.5;r.unshift(c,f),r.push(c,f)}var d=e.points,m=r.length/2,p=r.length,v=d.length/2,g=o.width/2,_=g*g,x=o.miterLimit*o.miterLimit,b=r[0],y=r[1],S=r[2],w=r[3],M=0,C=0,E=-(y-w),P=b-S,A=0,R=0,k=Math.sqrt(E*E+P*P);E/=k,P/=k,E*=g,P*=g;var I=o.alignment,L=(1-I)*2,T=I*2;h||(o.cap===Ma.ROUND?p+=Tl(b-E*(L-T)*.5,y-P*(L-T)*.5,b-E*L,y-P*L,b+E*T,y+P*T,d,!0)+2:o.cap===Ma.SQUARE&&(p+=$U(b,y,E,P,L,T,!0,d))),d.push(b-E*L,y-P*L),d.push(b+E*T,y+P*T);for(var O=1;O<m-1;++O){b=r[(O-1)*2],y=r[(O-1)*2+1],S=r[O*2],w=r[O*2+1],M=r[(O+1)*2],C=r[(O+1)*2+1],E=-(y-w),P=b-S,k=Math.sqrt(E*E+P*P),E/=k,P/=k,E*=g,P*=g,A=-(w-C),R=S-M,k=Math.sqrt(A*A+R*R),A/=k,R/=k,A*=g,R*=g;var D=S-b,F=y-w,B=S-M,U=C-w,G=D*B+F*U,Y=F*B-U*D,re=Y<0;if(Math.abs(Y)<.001*Math.abs(G)){d.push(S-E*L,w-P*L),d.push(S+E*T,w+P*T),G>=0&&(o.join===Oo.ROUND?p+=Tl(S,w,S-E*L,w-P*L,S-A*L,w-R*L,d,!1)+4:p+=2,d.push(S-A*T,w-R*T),d.push(S+A*L,w+R*L));continue}var N=(-E+b)*(-P+w)-(-E+S)*(-P+y),z=(-A+M)*(-R+w)-(-A+S)*(-R+C),ie=(D*z-B*N)/Y,Z=(U*N-F*z)/Y,ne=(ie-S)*(ie-S)+(Z-w)*(Z-w),K=S+(ie-S)*L,ae=w+(Z-w)*L,ue=S-(ie-S)*T,_e=w-(Z-w)*T,Re=Math.min(D*D+F*F,B*B+U*U),Le=re?L:T,Et=Re+Le*Le*_,it=ne<=Et;it?o.join===Oo.BEVEL||ne/_>x?(re?(d.push(K,ae),d.push(S+E*T,w+P*T),d.push(K,ae),d.push(S+A*T,w+R*T)):(d.push(S-E*L,w-P*L),d.push(ue,_e),d.push(S-A*L,w-R*L),d.push(ue,_e)),p+=2):o.join===Oo.ROUND?re?(d.push(K,ae),d.push(S+E*T,w+P*T),p+=Tl(S,w,S+E*T,w+P*T,S+A*T,w+R*T,d,!0)+4,d.push(K,ae),d.push(S+A*T,w+R*T)):(d.push(S-E*L,w-P*L),d.push(ue,_e),p+=Tl(S,w,S-E*L,w-P*L,S-A*L,w-R*L,d,!1)+4,d.push(S-A*L,w-R*L),d.push(ue,_e)):(d.push(K,ae),d.push(ue,_e)):(d.push(S-E*L,w-P*L),d.push(S+E*T,w+P*T),o.join===Oo.ROUND?re?p+=Tl(S,w,S+E*T,w+P*T,S+A*T,w+R*T,d,!0)+2:p+=Tl(S,w,S-E*L,w-P*L,S-A*L,w-R*L,d,!1)+2:o.join===Oo.MITER&&ne/_<=x&&(re?(d.push(ue,_e),d.push(ue,_e)):(d.push(K,ae),d.push(K,ae)),p+=2),d.push(S-A*L,w-R*L),d.push(S+A*T,w+R*T),p+=2)}b=r[(m-2)*2],y=r[(m-2)*2+1],S=r[(m-1)*2],w=r[(m-1)*2+1],E=-(y-w),P=b-S,k=Math.sqrt(E*E+P*P),E/=k,P/=k,E*=g,P*=g,d.push(S-E*L,w-P*L),d.push(S+E*T,w+P*T),h||(o.cap===Ma.ROUND?p+=Tl(S-E*(L-T)*.5,w-P*(L-T)*.5,S-E*L,w-P*L,S+E*T,w+P*T,d,!1)+2:o.cap===Ma.SQUARE&&(p+=$U(S,w,E,P,L,T,!1,d)));for(var je=e.indices,ut=Qf.epsilon*Qf.epsilon,O=v;O<p+v-2;++O)b=d[O*2],y=d[O*2+1],S=d[(O+1)*2],w=d[(O+1)*2+1],M=d[(O+2)*2],C=d[(O+2)*2+1],!(Math.abs(b*(w-C)+S*(C-y)+M*(y-w))<ut)&&je.push(O,O+1,O+2)}}function ote(t,e){var i=0,r=t.shape,n=t.points||r.points,o=r.type!==Ji.POLY||r.closeStroke;if(n.length!==0){var a=e.points,l=e.indices,h=n.length/2,u=a.length/2,c=u;for(a.push(n[0],n[1]),i=1;i<h;i++)a.push(n[i*2],n[i*2+1]),l.push(c,c+1),c++;o&&l.push(c,u)}}function e4(t,e){t.lineStyle.native?ote(t,e):ste(t,e)}var t4=function(){function t(){}return t.curveTo=function(e,i,r,n,o,a){var l=a[a.length-2],h=a[a.length-1],u=h-i,c=l-e,f=n-i,d=r-e,m=Math.abs(u*d-c*f);if(m<1e-8||o===0)return(a[a.length-2]!==e||a[a.length-1]!==i)&&a.push(e,i),null;var p=u*u+c*c,v=f*f+d*d,g=u*f+c*d,_=o*Math.sqrt(p)/m,x=o*Math.sqrt(v)/m,b=_*g/p,y=x*g/v,S=_*d+x*c,w=_*f+x*u,M=c*(x+b),C=u*(x+b),E=d*(_+y),P=f*(_+y),A=Math.atan2(C-w,M-S),R=Math.atan2(P-w,E-S);return{cx:S+e,cy:w+i,radius:o,startAngle:A,endAngle:R,anticlockwise:c*f>d*u}},t.arc=function(e,i,r,n,o,a,l,h,u){for(var c=l-a,f=Qf._segmentsCount(Math.abs(c)*o,Math.ceil(Math.abs(c)/Hf)*40),d=c/(f*2),m=d*2,p=Math.cos(d),v=Math.sin(d),g=f-1,_=g%1/g,x=0;x<=g;++x){var b=x+_*x,y=d+a+m*b,S=Math.cos(y),w=-Math.sin(y);u.push((p*S+v*w)*o+r,(p*-w+v*S)*o+n)}},t}(),ate=function(){function t(){}return t.curveLength=function(e,i,r,n,o,a,l,h){for(var u=10,c=0,f=0,d=0,m=0,p=0,v=0,g=0,_=0,x=0,b=0,y=0,S=e,w=i,M=1;M<=u;++M)f=M/u,d=f*f,m=d*f,p=1-f,v=p*p,g=v*p,_=g*e+3*v*f*r+3*p*d*o+m*l,x=g*i+3*v*f*n+3*p*d*a+m*h,b=S-_,y=w-x,S=_,w=x,c+=Math.sqrt(b*b+y*y);return c},t.curveTo=function(e,i,r,n,o,a,l){var h=l[l.length-2],u=l[l.length-1];l.length-=2;var c=Qf._segmentsCount(t.curveLength(h,u,e,i,r,n,o,a)),f=0,d=0,m=0,p=0,v=0;l.push(h,u);for(var g=1,_=0;g<=c;++g)_=g/c,f=1-_,d=f*f,m=d*f,p=_*_,v=p*_,l.push(m*h+3*d*_*e+3*f*p*r+v*o,m*u+3*d*_*i+3*f*p*n+v*a)},t}(),lte=function(){function t(){}return t.curveLength=function(e,i,r,n,o,a){var l=e-2*r+o,h=i-2*n+a,u=2*r-2*e,c=2*n-2*i,f=4*(l*l+h*h),d=4*(l*u+h*c),m=u*u+c*c,p=2*Math.sqrt(f+d+m),v=Math.sqrt(f),g=2*f*v,_=2*Math.sqrt(m),x=d/v;return(g*p+v*d*(p-_)+(4*m*f-d*d)*Math.log((2*v+x+p)/(x+_)))/(4*g)},t.curveTo=function(e,i,r,n,o){for(var a=o[o.length-2],l=o[o.length-1],h=Qf._segmentsCount(t.curveLength(a,l,e,i,r,n)),u=0,c=0,f=1;f<=h;++f){var d=f/h;u=a+(e-a)*d,c=l+(i-l)*d,o.push(u+(e+(r-e)*d-u)*d,c+(i+(n-i)*d-c)*d)}},t}(),hte=function(){function t(){this.reset()}return t.prototype.begin=function(e,i,r){this.reset(),this.style=e,this.start=i,this.attribStart=r},t.prototype.end=function(e,i){this.attribSize=i-this.attribStart,this.size=e-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),Al,xC=(Al={},Al[Ji.POLY]=s4,Al[Ji.CIRC]=d_,Al[Ji.ELIP]=d_,Al[Ji.RECT]=rte,Al[Ji.RREC]=nte,Al),i4=[],f_=[],r4=function(){function t(e,i,r,n){i===void 0&&(i=null),r===void 0&&(r=null),n===void 0&&(n=null),this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=i,this.matrix=n,this.type=e.type}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),uu=new Gt,ute=function(t){SC(e,t);function e(){var i=t.call(this)||this;return i.closePointEps=1e-4,i.boundsPadding=0,i.uvsFloat32=null,i.indicesUint16=null,i.batchable=!1,i.points=[],i.colors=[],i.uvs=[],i.indices=[],i.textureIds=[],i.graphicsData=[],i.drawCalls=[],i.batchDirty=-1,i.batches=[],i.dirty=0,i.cacheDirty=-1,i.clearDirty=0,i.shapeIndex=0,i._bounds=new su,i.boundsDirty=-1,i}return Object.defineProperty(e.prototype,"bounds",{get:function(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),f_.push(this.drawCalls[i]);this.drawCalls.length=0;for(var i=0;i<this.batches.length;i++){var r=this.batches[i];r.reset(),i4.push(r)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(i,r,n,o){r===void 0&&(r=null),n===void 0&&(n=null),o===void 0&&(o=null);var a=new r4(i,r,n,o);return this.graphicsData.push(a),this.dirty++,this},e.prototype.drawHole=function(i,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var n=new r4(i,null,null,r),o=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=o.lineStyle,o.holes.push(n),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(i){for(var r=this.graphicsData,n=0;n<r.length;++n){var o=r[n];if(o.fillStyle.visible&&o.shape&&(o.matrix?o.matrix.applyInverse(i,uu):uu.copyFrom(i),o.shape.contains(uu.x,uu.y))){var a=!1;if(o.holes)for(var l=0;l<o.holes.length;l++){var h=o.holes[l];if(h.shape.contains(uu.x,uu.y)){a=!0;break}}if(!a)return!0}}return!1},e.prototype.updateBatches=function(){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var i=this.uvs,r=this.graphicsData,n=null,o=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],o=n.style);for(var a=this.shapeIndex;a<r.length;a++){this.shapeIndex++;var l=r[a],h=l.fillStyle,u=l.lineStyle,c=xC[l.type];c.build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||u.visible)&&this.processHoles(l.holes);for(var f=0;f<2;f++){var d=f===0?h:u;if(d.visible){var m=d.texture.baseTexture,p=this.indices.length,v=this.points.length/2;m.wrapMode=Ur.REPEAT,f===0?this.processFill(l):this.processLine(l);var g=this.points.length/2-v;g!==0&&(n&&!this._compareStyles(o,d)&&(n.end(p,v),n=null),n||(n=i4.pop()||new hte,n.begin(d,p,v),this.batches.push(n),o=d),this.addUvs(this.points,i,d.texture,v,g,d.matrix))}}}var _=this.indices.length,x=this.points.length/2;if(n&&n.end(_,x),this.batches.length===0){this.batchable=!0;return}var b=x>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&b===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=b?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},e.prototype._compareStyles=function(i,r){return!(!i||!r||i.texture.baseTexture!==r.texture.baseTexture||i.color+i.alpha!==r.color+r.alpha||!!i.native!=!!r.native)},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var i=0,r=this.graphicsData.length;i<r;i++){var n=this.graphicsData[i],o=n.fillStyle,a=n.lineStyle;if(o&&!o.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var i=this.batches,r=0,n=i.length;r<n;r++)for(var o=i[r],a=0;a<o.size;a++){var l=o.start+a;this.indicesUint16[l]=this.indicesUint16[l]-o.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var i=this.batches,r=0;r<i.length;r++)if(i[r].style.native)return!1;return this.points.length<e.BATCHABLE_SIZE*2},e.prototype.buildDrawCalls=function(){for(var i=++St._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),f_.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,o=this.textureIds,a=f_.pop();a||(a=new Qv,a.texArray=new Jv),a.texArray.count=0,a.start=0,a.size=0,a.type=tn.TRIANGLES;var l=0,h=null,u=0,c=!1,f=tn.TRIANGLES,d=0;this.drawCalls.push(a);for(var r=0;r<this.batches.length;r++){var m=this.batches[r],p=8,v=m.style,g=v.texture.baseTexture;c!==!!v.native&&(c=!!v.native,f=c?tn.LINES:tn.TRIANGLES,h=null,l=p,i++),h!==g&&(h=g,g._batchEnabled!==i&&(l===p&&(i++,l=0,a.size>0&&(a=f_.pop(),a||(a=new Qv,a.texArray=new Jv),this.drawCalls.push(a)),a.start=d,a.size=0,a.texArray.count=0,a.type=f),g.touched=1,g._batchEnabled=i,g._batchLocation=l,g.wrapMode=Ur.REPEAT,a.texArray.elements[a.texArray.count++]=g,l++)),a.size+=m.size,d+=m.size,u=g._batchLocation,this.addColors(n,v.color,v.alpha,m.attribSize,m.attribStart),this.addTextureIds(o,u,m.attribSize,m.attribStart)}St._globalBatch=i,this.packAttributes()},e.prototype.packAttributes=function(){for(var i=this.points,r=this.uvs,n=this.colors,o=this.textureIds,a=new ArrayBuffer(i.length*3*4),l=new Float32Array(a),h=new Uint32Array(a),u=0,c=0;c<i.length/2;c++)l[u++]=i[c*2],l[u++]=i[c*2+1],l[u++]=r[c*2],l[u++]=r[c*2+1],h[u++]=n[c],l[u++]=o[c];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(i){if(i.holes.length)s4.triangulate(i,this);else{var r=xC[i.type];r.triangulate(i,this)}},e.prototype.processLine=function(i){e4(i,this);for(var r=0;r<i.holes.length;r++)e4(i.holes[r],this)},e.prototype.processHoles=function(i){for(var r=0;r<i.length;r++){var n=i[r],o=xC[n.type];o.build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(i,r){for(var n=0;n<i.length/2;n++){var o=i[n*2],a=i[n*2+1];i[n*2]=r.a*o+r.c*a+r.tx,i[n*2+1]=r.b*o+r.d*a+r.ty}},e.prototype.addColors=function(i,r,n,o,a){a===void 0&&(a=0);var l=(r>>16)+(r&65280)+((r&255)<<16),h=vl(l,n);i.length=Math.max(i.length,a+o);for(var u=0;u<o;u++)i[a+u]=h},e.prototype.addTextureIds=function(i,r,n,o){o===void 0&&(o=0),i.length=Math.max(i.length,o+n);for(var a=0;a<n;a++)i[o+a]=r},e.prototype.addUvs=function(i,r,n,o,a,l){l===void 0&&(l=null);for(var h=0,u=r.length,c=n.frame;h<a;){var f=i[(o+h)*2],d=i[(o+h)*2+1];if(l){var m=l.a*f+l.c*d+l.tx;d=l.b*f+l.d*d+l.ty,f=m}h++,r.push(f/c.width,d/c.height)}var p=n.baseTexture;(c.width<p.width||c.height<p.height)&&this.adjustUvs(r,n,u,a)},e.prototype.adjustUvs=function(i,r,n,o){for(var a=r.baseTexture,l=1e-6,h=n+o*2,u=r.frame,c=u.width/a.width,f=u.height/a.height,d=u.x/u.width,m=u.y/u.height,p=Math.floor(i[n]+l),v=Math.floor(i[n+1]+l),g=n+2;g<h;g+=2)p=Math.min(p,Math.floor(i[g]+l)),v=Math.min(v,Math.floor(i[g+1]+l));d-=p,m-=v;for(var g=n;g<h;g+=2)i[g]=(i[g]+d)*c,i[g+1]=(i[g+1]+m)*f},e.BATCHABLE_SIZE=100,e}(oC),cte=function(t){SC(e,t);function e(){var i=t!==null&&t.apply(this,arguments)||this;return i.width=0,i.alignment=.5,i.native=!1,i.cap=Ma.BUTT,i.join=Oo.MITER,i.miterLimit=10,i}return e.prototype.clone=function(){var i=new e;return i.color=this.color,i.alpha=this.alpha,i.texture=this.texture,i.matrix=this.matrix,i.visible=this.visible,i.width=this.width,i.alignment=this.alignment,i.native=this.native,i.cap=this.cap,i.join=this.join,i.miterLimit=this.miterLimit,i},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(n4),fte=new Float32Array(3),bC={},Si=function(t){SC(e,t);function e(i){i===void 0&&(i=null);var r=t.call(this)||this;return r.shader=null,r.pluginName="batch",r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r._fillStyle=new n4,r._lineStyle=new cte,r._matrix=null,r._holeMode=!1,r.state=_s.for2d(),r._geometry=i||new ute,r._geometry.refCount++,r._transformID=-1,r.tint=16777215,r.blendMode=et.NORMAL,r}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(i,r,n,o,a){return i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=.5),a===void 0&&(a=!1),typeof i=="number"&&(i={width:i,color:r,alpha:n,alignment:o,native:a}),this.lineTextureStyle(i)},e.prototype.lineTextureStyle=function(i){i=Object.assign({width:0,texture:tt.WHITE,color:i&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ma.BUTT,join:Oo.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();var r=i.width>0&&i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:r},i)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var i=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new nu,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[r-2],i[r-1]))}else this.currentPath=new nu,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(i,r){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=r,this},e.prototype.lineTo=function(i,r){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,o=n[n.length-2],a=n[n.length-1];return(o!==i||a!==r)&&n.push(i,r),this},e.prototype._initCurve=function(i,r){i===void 0&&(i=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,r]):this.moveTo(i,r)},e.prototype.quadraticCurveTo=function(i,r,n,o){this._initCurve();var a=this.currentPath.points;return a.length===0&&this.moveTo(0,0),lte.curveTo(i,r,n,o,a),this},e.prototype.bezierCurveTo=function(i,r,n,o,a,l){return this._initCurve(),ate.curveTo(i,r,n,o,a,l,this.currentPath.points),this},e.prototype.arcTo=function(i,r,n,o,a){this._initCurve(i,r);var l=this.currentPath.points,h=t4.curveTo(i,r,n,o,a,l);if(h){var u=h.cx,c=h.cy,f=h.radius,d=h.startAngle,m=h.endAngle,p=h.anticlockwise;this.arc(u,c,f,d,m,p)}return this},e.prototype.arc=function(i,r,n,o,a,l){if(l===void 0&&(l=!1),o===a)return this;!l&&a<=o?a+=Hf:l&&o<=a&&(o+=Hf);var h=a-o;if(h===0)return this;var u=i+Math.cos(o)*n,c=r+Math.sin(o)*n,f=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){var m=Math.abs(d[d.length-2]-u),p=Math.abs(d[d.length-1]-c);m<f&&p<f||d.push(u,c)}else this.moveTo(u,c),d=this.currentPath.points;return t4.arc(u,c,i,r,n,o,a,l,d),this},e.prototype.beginFill=function(i,r){return i===void 0&&(i=0),r===void 0&&(r=1),this.beginTextureFill({texture:tt.WHITE,color:i,alpha:r})},e.prototype.beginTextureFill=function(i){i=Object.assign({texture:tt.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();var r=i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:r},i)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(i,r,n,o){return this.drawShape(new wt(i,r,n,o))},e.prototype.drawRoundedRect=function(i,r,n,o,a){return this.drawShape(new IN(i,r,n,o,a))},e.prototype.drawCircle=function(i,r,n){return this.drawShape(new ON(i,r,n))},e.prototype.drawEllipse=function(i,r,n,o){return this.drawShape(new DN(i,r,n,o))},e.prototype.drawPolygon=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];var o,a=!0,l=r[0];l.points?(a=l.closeStroke,o=l.points):Array.isArray(r[0])?o=r[0]:o=r;var h=new nu(o);return h.closeStroke=a,this.drawShape(h),this},e.prototype.drawShape=function(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===Ji.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)},e.prototype._render=function(i){this.finishPoly();var r=this._geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))},e.prototype._populateBatches=function(){var i=this._geometry,r=this.blendMode,n=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(i.points);for(var o=0;o<n;o++){var a=i.batches[o],l=a.style.color,h=new Float32Array(this.vertexData.buffer,a.attribStart*4*2,a.attribSize*2),u=new Float32Array(i.uvsFloat32.buffer,a.attribStart*4*2,a.attribSize*2),c=new Uint16Array(i.indicesUint16.buffer,a.start*2,a.size),f={vertexData:h,blendMode:r,indices:c,uvs:u,_batchRGB:Vn(l),_tintRGB:l,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[o]=f}},e.prototype._renderBatched=function(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,n=this.batches.length;r<n;r++){var o=this.batches[r];o.worldAlpha=this.worldAlpha*o.alpha,i.plugins[this.pluginName].render(o)}}},e.prototype._renderDirect=function(i){var r=this._resolveDirectShader(i),n=this._geometry,o=this.tint,a=this.worldAlpha,l=r.uniforms,h=n.drawCalls;l.translationMatrix=this.transform.worldTransform,l.tint[0]=(o>>16&255)/255*a,l.tint[1]=(o>>8&255)/255*a,l.tint[2]=(o&255)/255*a,l.tint[3]=a,i.shader.bind(r),i.geometry.bind(n,r),i.state.set(this.state);for(var u=0,c=h.length;u<c;u++)this._renderDrawCallDirect(i,n.drawCalls[u])},e.prototype._renderDrawCallDirect=function(i,r){for(var n=r.texArray,o=r.type,a=r.size,l=r.start,h=n.count,u=0;u<h;u++)i.texture.bind(n.elements[u],u);i.geometry.draw(o,a,l)},e.prototype._resolveDirectShader=function(i){var r=this.shader,n=this.pluginName;if(!r){if(!bC[n]){for(var o=i.plugins[n].MAX_TEXTURES,a=new Int32Array(o),l=0;l<o;l++)a[l]=l;var h={tint:new Float32Array([1,1,1,1]),translationMatrix:new Zt,default:Ca.from({uSamplers:a},!0)},u=i.plugins[n]._shader.program;bC[n]=new qn(u,h)}r=bC[n]}return r},e.prototype._calculateBounds=function(){this.finishPoly();var i=this._geometry;if(i.graphicsData.length){var r=i.bounds,n=r.minX,o=r.minY,a=r.maxX,l=r.maxY;this._bounds.addFrame(this.transform,n,o,a,l)}},e.prototype.containsPoint=function(i){return this.worldTransform.applyInverse(i,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var i=Vn(this.tint,fte),r=0;r<this.batches.length;r++){var n=this.batches[r],o=n._batchRGB,a=i[0]*o[0]*255,l=i[1]*o[1]*255,h=i[2]*o[2]*255,u=(a<<16)+(l<<8)+(h|0);n._tintRGB=(u>>16)+(u&65280)+((u&255)<<16)}}},e.prototype.calculateVertices=function(){var i=this.transform._worldID;if(this._transformID!==i){this._transformID=i;for(var r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this._geometry.points,f=this.vertexData,d=0,m=0;m<c.length;m+=2){var p=c[m],v=c[m+1];f[d++]=n*p+a*v+h,f[d++]=l*v+o*p+u}}},e.prototype.closePath=function(){var i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(i){return this._matrix=i,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,i)},e.nextRoundedRectBehavior=!1,e._TEMP_POINT=new Gt,e}(di);var CC=function(t,e){return CC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},CC(t,e)};function dte(t,e){CC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Jf=new Gt,pte=new Uint16Array([0,1,2,0,2,3]),Do=function(t){dte(e,t);function e(i){var r=t.call(this)||this;return r._anchor=new Sa(r._onAnchorUpdate,r,i?i.defaultAnchor.x:0,i?i.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=et.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=i||tt.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=pte,r.pluginName="batch",r.isSprite=!0,r._roundPixels=Oe.ROUND_PIXELS,r}return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=To(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=To(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var i=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===i._updateID)){this._textureID!==i._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=i._updateID;var r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this.vertexData,f=i.trim,d=i.orig,m=this._anchor,p=0,v=0,g=0,_=0;if(f?(v=f.x-m._x*d.width,p=v+f.width,_=f.y-m._y*d.height,g=_+f.height):(v=-m._x*d.width,p=v+d.width,_=-m._y*d.height,g=_+d.height),c[0]=n*v+a*_+h,c[1]=l*_+o*v+u,c[2]=n*p+a*_+h,c[3]=l*_+o*p+u,c[4]=n*p+a*g+h,c[5]=l*g+o*p+u,c[6]=n*v+a*g+h,c[7]=l*g+o*v+u,this._roundPixels)for(var x=Oe.RESOLUTION,b=0;b<c.length;++b)c[b]=Math.round((c[b]*x|0)/x)}},e.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var i=this._texture,r=this.vertexTrimmedData,n=i.orig,o=this._anchor,a=this.transform.worldTransform,l=a.a,h=a.b,u=a.c,c=a.d,f=a.tx,d=a.ty,m=-o._x*n.width,p=m+n.width,v=-o._y*n.height,g=v+n.height;r[0]=l*m+u*v+f,r[1]=c*v+h*m+d,r[2]=l*p+u*v+f,r[3]=c*v+h*p+d,r[4]=l*p+u*g+f,r[5]=c*g+h*p+d,r[6]=l*m+u*g+f,r[7]=c*g+h*m+d},e.prototype._render=function(i){this.calculateVertices(),i.batch.setObjectRenderer(i.plugins[this.pluginName]),i.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var i=this._texture.trim,r=this._texture.orig;!i||i.width===r.width&&i.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(i){return this.children.length===0?(this._localBounds||(this._localBounds=new su),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),i||(this._localBoundsRect||(this._localBoundsRect=new wt),i=this._localBoundsRect),this._localBounds.getRectangle(i)):t.prototype.getLocalBounds.call(this,i)},e.prototype.containsPoint=function(i){this.worldTransform.applyInverse(i,Jf);var r=this._texture.orig.width,n=this._texture.orig.height,o=-r*this.anchor.x,a=0;return Jf.x>=o&&Jf.x<o+r&&(a=-n*this.anchor.y,Jf.y>=a&&Jf.y<a+n)},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof i=="boolean"?i:i&&i.texture;if(r){var n=typeof i=="boolean"?i:i&&i.baseTexture;this._texture.destroy(!!n)}this._texture=null},e.from=function(i,r){var n=i instanceof tt?i:tt.from(i,r);return new e(n)},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){var r=To(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){var r=To(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(i){this._anchor.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i,this._tintRGB=(i>>16)+(i&65280)+((i&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(i){this._texture!==i&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=i||tt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,i&&(i.baseTexture.valid?this._onTextureUpdate():i.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(di);var AC=function(t,e){return AC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},AC(t,e)};function mte(t,e){AC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var cu;(function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(cu||(cu={}));var EC={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:cu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},gte=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ta=function(){function t(e){this.styleID=0,this.reset(),TC(this,e,e)}return t.prototype.clone=function(){var e={};return TC(e,this,EC),new t(e)},t.prototype.reset=function(){TC(this,EC,EC)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){var i=MC(e);this._dropShadowColor!==i&&(this._dropShadowColor=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(e){var i=MC(e);this._fill!==i&&(this._fill=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){vte(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var i=MC(e);this._stroke!==i&&(this._stroke=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var e=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,i=this.fontFamily;Array.isArray(this.fontFamily)||(i=this.fontFamily.split(","));for(var r=i.length-1;r>=0;r--){var n=i[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&gte.indexOf(n)<0&&(n='"'+n+'"'),i[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+i.join(",")},t}();function o4(t){return typeof t=="number"?Ff(t):(typeof t=="string"&&t.indexOf("0x")===0&&(t=t.replace("0x","#")),t)}function MC(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=o4(t[e]);return t}else return o4(t)}function vte(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function TC(t,e,i){for(var r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var p_={willReadFrequently:!0},Xn=function(){function t(e,i,r,n,o,a,l,h,u){this.text=e,this.style=i,this.width=r,this.height=n,this.lines=o,this.lineWidths=a,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}return t.measureText=function(e,i,r,n){n===void 0&&(n=t._canvas),r=r==null?i.wordWrap:r;var o=i.toFontString(),a=t.measureFont(o);a.fontSize===0&&(a.fontSize=i.fontSize,a.ascent=i.fontSize);var l=n.getContext("2d",p_);l.font=o;for(var h=r?t.wordWrap(e,i,n):e,u=h.split(/(?:\r\n|\r|\n)/),c=new Array(u.length),f=0,d=0;d<u.length;d++){var m=l.measureText(u[d]).width+(u[d].length-1)*i.letterSpacing;c[d]=m,f=Math.max(f,m)}var p=f+i.strokeThickness;i.dropShadow&&(p+=i.dropShadowDistance);var v=i.lineHeight||a.fontSize+i.strokeThickness,g=Math.max(v,a.fontSize+i.strokeThickness)+(u.length-1)*(v+i.leading);return i.dropShadow&&(g+=i.dropShadowDistance),new t(e,i,p,g,u,c,v+i.leading,f,a)},t.wordWrap=function(e,i,r){r===void 0&&(r=t._canvas);for(var n=r.getContext("2d",p_),o=0,a="",l="",h=Object.create(null),u=i.letterSpacing,c=i.whiteSpace,f=t.collapseSpaces(c),d=t.collapseNewlines(c),m=!f,p=i.wordWrapWidth+u,v=t.tokenize(e),g=0;g<v.length;g++){var _=v[g];if(t.isNewline(_)){if(!d){l+=t.addLine(a),m=!f,a="",o=0;continue}_=" "}if(f){var x=t.isBreakingSpace(_),b=t.isBreakingSpace(a[a.length-1]);if(x&&b)continue}var y=t.getFromCache(_,u,h,n);if(y>p)if(a!==""&&(l+=t.addLine(a),a="",o=0),t.canBreakWords(_,i.breakWords))for(var S=t.wordWrapSplit(_),w=0;w<S.length;w++){for(var M=S[w],C=1;S[w+C];){var E=S[w+C],P=M[M.length-1];if(!t.canBreakChars(P,E,_,w,i.breakWords))M+=E;else break;C++}w+=M.length-1;var A=t.getFromCache(M,u,h,n);A+o>p&&(l+=t.addLine(a),m=!1,a="",o=0),a+=M,o+=A}else{a.length>0&&(l+=t.addLine(a),a="",o=0);var R=g===v.length-1;l+=t.addLine(_,!R),m=!1,a="",o=0}else y+o>p&&(m=!1,l+=t.addLine(a),a="",o=0),(a.length>0||!t.isBreakingSpace(_)||m)&&(a+=_,o+=y)}return l+=t.addLine(a,!1),l},t.addLine=function(e,i){return i===void 0&&(i=!0),e=t.trimRight(e),e=i?e+`
`:e,e},t.getFromCache=function(e,i,r,n){var o=r[e];if(typeof o!="number"){var a=e.length*i;o=n.measureText(e).width+a,r[e]=o}return o},t.collapseSpaces=function(e){return e==="normal"||e==="pre-line"},t.collapseNewlines=function(e){return e==="normal"},t.trimRight=function(e){if(typeof e!="string")return"";for(var i=e.length-1;i>=0;i--){var r=e[i];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return typeof e!="string"?!1:t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,i){return typeof e!="string"?!1:t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var i=[],r="";if(typeof e!="string")return i;for(var n=0;n<e.length;n++){var o=e[n],a=e[n+1];if(t.isBreakingSpace(o,a)||t.isNewline(o)){r!==""&&(i.push(r),r=""),i.push(o);continue}r+=o}return r!==""&&i.push(r),i},t.canBreakWords=function(e,i){return i},t.canBreakChars=function(e,i,r,n,o){return!0},t.wordWrapSplit=function(e){return e.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var i={ascent:0,descent:0,fontSize:0},r=t._canvas,n=t._context;n.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(n.measureText(o).width),l=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),h=Math.ceil(t.HEIGHT_MULTIPLIER*l);l=l*t.BASELINE_MULTIPLIER|0,r.width=a,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,a,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,l);var u=n.getImageData(0,0,a,h).data,c=u.length,f=a*4,d=0,m=0,p=!1;for(d=0;d<l;++d){for(var v=0;v<f;v+=4)if(u[m+v]!==255){p=!0;break}if(!p)m+=f;else break}for(i.ascent=l-d,m=c-f,p=!1,d=h;d>l;--d){for(var v=0;v<f;v+=4)if(u[m+v]!==255){p=!0;break}if(!p)m-=f;else break}return i.descent=d-l,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i},t.clearMetrics=function(e){e===void 0&&(e=""),e?delete t._fonts[e]:t._fonts={}},Object.defineProperty(t,"_canvas",{get:function(){if(!t.__canvas){var e=void 0;try{var i=new OffscreenCanvas(0,0),r=i.getContext("2d",p_);if(r&&r.measureText)return t.__canvas=i,i;e=Oe.ADAPTER.createCanvas()}catch(n){e=Oe.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas},enumerable:!1,configurable:!0}),Object.defineProperty(t,"_context",{get:function(){return t.__context||(t.__context=t._canvas.getContext("2d",p_)),t.__context},enumerable:!1,configurable:!0}),t}();Xn._fonts={};Xn.METRICS_STRING="|\xC9q\xC5";Xn.BASELINE_SYMBOL="M";Xn.BASELINE_MULTIPLIER=1.4;Xn.HEIGHT_MULTIPLIER=2;Xn._newlines=[10,13];Xn._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var _te={texture:!0,children:!1,baseTexture:!0},Yn=function(t){mte(e,t);function e(i,r,n){var o=this,a=!1;n||(n=Oe.ADAPTER.createCanvas(),a=!0),n.width=3,n.height=3;var l=tt.from(n);return l.orig=new wt,l.trim=new wt,o=t.call(this,l)||this,o._ownCanvas=a,o.canvas=n,o.context=n.getContext("2d",{willReadFrequently:!0}),o._resolution=Oe.RESOLUTION,o._autoResolution=!0,o._text=null,o._style=null,o._styleListener=null,o._font="",o.text=i,o.style=r,o.localStyleID=-1,o}return e.prototype.updateText=function(i){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&i)){this._font=this._style.toFontString();var n=this.context,o=Xn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=o.width,l=o.height,h=o.lines,u=o.lineHeight,c=o.lineWidths,f=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,l)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;for(var m,p,v=r.dropShadow?2:1,g=0;g<v;++g){var _=r.dropShadow&&g===0,x=_?Math.ceil(Math.max(1,l)+r.padding*2):0,b=x*this._resolution;if(_){n.fillStyle="black",n.strokeStyle="black";var y=r.dropShadowColor,S=Vn(typeof y=="number"?y:Bf(y)),w=r.dropShadowBlur*this._resolution,M=r.dropShadowDistance*this._resolution;n.shadowColor="rgba("+S[0]*255+","+S[1]*255+","+S[2]*255+","+r.dropShadowAlpha+")",n.shadowBlur=w,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*M,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*M+b}else n.fillStyle=this._generateFillStyle(r,h,o),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;var C=(u-d.fontSize)/2;(!e.nextLineHeightBehavior||u-d.fontSize<0)&&(C=0);for(var E=0;E<h.length;E++)m=r.strokeThickness/2,p=r.strokeThickness/2+E*u+d.ascent+C,r.align==="right"?m+=f-c[E]:r.align==="center"&&(m+=(f-c[E])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(h[E],m+r.padding,p+r.padding-x,!0),r.fill&&this.drawLetterSpacing(h[E],m+r.padding,p+r.padding-x)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(i,r,n,o){o===void 0&&(o=!1);var a=this._style,l=a.letterSpacing,h=e.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(l===0||h){h&&(this.context.letterSpacing=l,this.context.textLetterSpacing=l),o?this.context.strokeText(i,r,n):this.context.fillText(i,r,n);return}for(var u=r,c=Array.from?Array.from(i):i.split(""),f=this.context.measureText(i).width,d=0,m=0;m<c.length;++m){var p=c[m];o?this.context.strokeText(p,u,n):this.context.fillText(p,u,n);for(var v="",g=m+1;g<c.length;++g)v+=c[g];d=this.context.measureText(v).width,u+=f-d+l,f=d}},e.prototype.updateTexture=function(){var i=this.canvas;if(this._style.trim){var r=kS(i);r.data&&(i.width=r.width,i.height=r.height,this.context.putImageData(r.data,0,0))}var n=this._texture,o=this._style,a=o.trim?0:o.padding,l=n.baseTexture;n.trim.width=n._frame.width=i.width/this._resolution,n.trim.height=n._frame.height=i.height/this._resolution,n.trim.x=-a,n.trim.y=-a,n.orig.width=n._frame.width-a*2,n.orig.height=n._frame.height-a*2,this._onTextureUpdate(),l.setRealSize(i.width,i.height,this._resolution),n.updateUvs(),this.dirty=!1},e.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,i)},e.prototype.updateTransform=function(){this.updateText(!0),t.prototype.updateTransform.call(this)},e.prototype.getBounds=function(i,r){return this.updateText(!0),this._textureID===-1&&(i=!1),t.prototype.getBounds.call(this,i,r)},e.prototype.getLocalBounds=function(i){return this.updateText(!0),t.prototype.getLocalBounds.call(this,i)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(i,r,n){var o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;var a,l=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,u=this.canvas.width/this._resolution-l-h*2,c=this.canvas.height/this._resolution-l-h*2,f=o.slice(),d=i.fillGradientStops.slice();if(!d.length)for(var m=f.length+1,p=1;p<m;++p)d.push(p/m);if(f.unshift(o[0]),d.unshift(0),f.push(o[o.length-1]),d.push(1),i.fillGradientType===cu.LINEAR_VERTICAL){a=this.context.createLinearGradient(u/2,h,u/2,c+h);for(var v=n.fontProperties.fontSize+i.strokeThickness,p=0;p<r.length;p++){var g=n.lineHeight*(p-1)+v,_=n.lineHeight*p,x=_;p>0&&g>_&&(x=(_+g)/2);var b=_+v,y=n.lineHeight*(p+1),S=b;p+1<r.length&&y<b&&(S=(b+y)/2);for(var w=(S-x)/c,M=0;M<f.length;M++){var C=0;typeof d[M]=="number"?C=d[M]:C=M/f.length;var E=Math.min(1,Math.max(0,x/c+C*w));E=Number(E.toFixed(5)),a.addColorStop(E,f[M])}}}else{a=this.context.createLinearGradient(h,c/2,u+h,c/2);for(var P=f.length+1,A=1,p=0;p<f.length;p++){var R=void 0;typeof d[p]=="number"?R=d[p]:R=A/P,a.addColorStop(R,f[p]),A++}}return a},e.prototype.destroy=function(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},_te,i),t.prototype.destroy.call(this,i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){this.updateText(!0);var r=To(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){this.updateText(!0);var r=To(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(i){i=i||{},i instanceof Ta?this._style=i:this._style=new Ta(i),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e.experimentalLetterSpacing=!1,e}(Do);Oe.UPLOADS_PER_FRAME=4;var PC=function(t,e){return PC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},PC(t,e)};function yte(t,e){PC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var xte=function(){function t(e){this.maxItemsPerFrame=e,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function bte(t,e){var i=!1;if(t&&t._textures&&t._textures.length){for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof tt){var n=t._textures[r].baseTexture;e.indexOf(n)===-1&&(e.push(n),i=!0)}}return i}function wte(t,e){if(t.baseTexture instanceof St){var i=t.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Ste(t,e){if(t._texture&&t._texture instanceof tt){var i=t._texture.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Cte(t,e){return e instanceof Yn?(e.updateText(!0),!0):!1}function Ete(t,e){if(e instanceof Ta){var i=e.toFontString();return Xn.measureFont(i),!0}return!1}function Mte(t,e){if(t instanceof Yn){e.indexOf(t.style)===-1&&e.push(t.style),e.indexOf(t)===-1&&e.push(t);var i=t._texture.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Tte(t,e){return t instanceof Ta?(e.indexOf(t)===-1&&e.push(t),!0):!1}var Ate=function(){function t(e){var i=this;this.limiter=new xte(Oe.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){i.queue&&i.prepareItems()},this.registerFindHook(Mte),this.registerFindHook(Tte),this.registerFindHook(bte),this.registerFindHook(wte),this.registerFindHook(Ste),this.registerUploadHook(Cte),this.registerUploadHook(Ete)}return t.prototype.upload=function(e,i){var r=this;return typeof e=="function"&&(i=e,e=null),i&&Gi("6.5.0","BasePrepare.upload callback is deprecated, use the return Promise instead."),new Promise(function(n){e&&r.add(e);var o=function(){i==null||i(),n()};r.queue.length?(r.completes.push(o),r.ticking||(r.ticking=!0,Pi.system.addOnce(r.tick,r,jn.UTILITY))):o()})},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],i=!1;if(e&&!e._destroyed){for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),i=!0;break}}i||this.queue.shift()}if(this.queue.length)Pi.system.addOnce(this.tick,this,jn.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var r=0,n=o.length;r<n;r++)o[r]()}},t.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},t.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},t.prototype.add=function(e){for(var i=0,r=this.addHooks.length;i<r&&!this.addHooks[i](e,this.queue);i++);if(e instanceof di)for(var i=e.children.length-1;i>=0;i--)this.add(e.children[i]);return this},t.prototype.destroy=function(){this.ticking&&Pi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function a4(t,e){return e instanceof St?(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0):!1}function Pte(t,e){if(!(e instanceof Si))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&a4(t,o.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function Rte(t,e){return t instanceof Si?(e.push(t),!0):!1}var l4=function(t){yte(e,t);function e(i){var r=t.call(this,i)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(Rte),r.registerUploadHook(a4),r.registerUploadHook(Pte),r}return e.extension={name:"prepare",type:At.RendererPlugin},e}(Ate),MLe=function(){function t(e){this.maxMilliseconds=e,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}();var Lte=function(){function t(e,i,r){r===void 0&&(r=null),this.linkedSheets=[],this._texture=e instanceof tt?e:null,this.baseTexture=e instanceof St?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=i;var n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(e){e===void 0&&(e=null);var i=this.data.meta.scale,r=ba(e,null);return r===null&&(r=i!==void 0?parseFloat(i):1),r!==1&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){var i=this;return e&&Gi("6.5.0","Spritesheet.parse callback is deprecated, use the return Promise instead."),new Promise(function(r){i._callback=function(n){e==null||e(n),r(n)},i._batchIndex=0,i._frameKeys.length<=t.BATCH_SIZE?(i._processFrames(0),i._processAnimations(),i._parseComplete()):i._nextBatch()})},t.prototype._processFrames=function(e){for(var i=e,r=t.BATCH_SIZE;i-e<r&&i<this._frameKeys.length;){var n=this._frameKeys[i],o=this._frames[n],a=o.frame;if(a){var l=null,h=null,u=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,c=new wt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);o.rotated?l=new wt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new wt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(h=new wt(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new tt(this.baseTexture,l,c,h,o.rotated?2:0,o.anchor),tt.addToCache(this.textures[n],n)}i++}},t.prototype._processAnimations=function(){var e=this.data.animations||{};for(var i in e){this.animations[i]=[];for(var r=0;r<e[i].length;r++){var n=e[i][r];this.animations[i].push(this.textures[n])}}},t.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},t.prototype.destroy=function(e){var i;e===void 0&&(e=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((i=this._texture)===null||i===void 0||i.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]},t.BATCH_SIZE=1e3,t}(),h4=function(){function t(){}return t.use=function(e,i){var r,n,o=this,a=e.name+"_image";if(!e.data||e.type!==li.TYPE.JSON||!e.data.frames||o.resources[a]){i();return}var l=(n=(r=e.data)===null||r===void 0?void 0:r.meta)===null||n===void 0?void 0:n.related_multi_packs;if(Array.isArray(l))for(var h=function(p){if(typeof p!="string")return"continue";var v=p.replace(".json",""),g=Mo.resolve(e.url.replace(o.baseUrl,""),p);if(o.resources[v]||Object.values(o.resources).some(function(x){return Mo.format(Mo.parse(x.url))===g}))return"continue";var _={crossOrigin:e.crossOrigin,loadType:li.LOAD_TYPE.XHR,xhrType:li.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};o.add(v,g,_)},u=0,c=l;u<c.length;u++){var f=c[u];h(f)}var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},m=t.getResourcePath(e,o.baseUrl);o.add(a,m,d,function(v){if(v.error){i(v.error);return}var g=new Lte(v.texture,e.data,e.url);g.parse().then(function(){e.spritesheet=g,e.textures=g.textures,i()})})},t.getResourcePath=function(e,i){return e.isDataUrl?e.data.meta.image:Mo.resolve(e.url.replace(i,""),e.data.meta.image)},t.extension=At.Loader,t}();var RC=function(t,e){return RC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},RC(t,e)};function c4(t,e){RC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var $f=new Gt,NLe=function(t){c4(e,t);function e(i,r,n){r===void 0&&(r=100),n===void 0&&(n=100);var o=t.call(this,i)||this;return o.tileTransform=new Hv,o._width=r,o._height=n,o.uvMatrix=o.texture.uvMatrix||new Yf(i),o.pluginName="tilingSprite",o.uvRespectAnchor=!1,o}return Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(i){this.uvMatrix.clampMargin=i,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(i){this.tileTransform.scale.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(i){this.tileTransform.position.copyFrom(i)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(i){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),i.batch.setObjectRenderer(i.plugins[this.pluginName]),i.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var i=this._width*-this._anchor._x,r=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),o=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,i,r,n,o)},e.prototype.getLocalBounds=function(i){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),i||(this._localBoundsRect||(this._localBoundsRect=new wt),i=this._localBoundsRect),this._bounds.getRectangle(i)):t.prototype.getLocalBounds.call(this,i)},e.prototype.containsPoint=function(i){this.worldTransform.applyInverse(i,$f);var r=this._width,n=this._height,o=-r*this.anchor._x;if($f.x>=o&&$f.x<o+r){var a=-n*this.anchor._y;if($f.y>=a&&$f.y<a+n)return!0}return!1},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this.tileTransform=null,this.uvMatrix=null},e.from=function(i,r){var n=i instanceof tt?i:tt.from(i,r);return new e(n,r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(i){this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(i){this._height=i},enumerable:!1,configurable:!0}),e}(Do),Ote=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,u4=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Dte=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Ite=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,kte=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,m_=new Zt,f4=function(t){c4(e,t);function e(i){var r=t.call(this,i)||this;return i.runners.contextChange.add(r),r.quad=new sC,r.state=_s.for2d(),r}return e.prototype.contextChange=function(){var i=this.renderer,r={globals:i.globalUniforms};this.simpleShader=qn.from(u4,Ote,r),this.shader=i.context.webGLVersion>1?qn.from(Ite,kte,r):qn.from(u4,Dte,r)},e.prototype.render=function(i){var r=this.renderer,n=this.quad,o=n.vertices;o[0]=o[6]=i._width*-i.anchor.x,o[1]=o[3]=i._height*-i.anchor.y,o[2]=o[4]=i._width*(1-i.anchor.x),o[5]=o[7]=i._height*(1-i.anchor.y);var a=i.uvRespectAnchor?i.anchor.x:0,l=i.uvRespectAnchor?i.anchor.y:0;o=n.uvs,o[0]=o[6]=-a,o[1]=o[3]=-l,o[2]=o[4]=1-a,o[5]=o[7]=1-l,n.invalidate();var h=i._texture,u=h.baseTexture,c=u.alphaMode>0,f=i.tileTransform.localTransform,d=i.uvMatrix,m=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;m&&(u._glTextures[r.CONTEXT_UID]?m=u.wrapMode!==Ur.CLAMP:u.wrapMode===Ur.CLAMP&&(u.wrapMode=Ur.REPEAT));var p=m?this.simpleShader:this.shader,v=h.width,g=h.height,_=i._width,x=i._height;m_.set(f.a*v/_,f.b*v/x,f.c*g/_,f.d*g/x,f.tx/_,f.ty/x),m_.invert(),m?m_.prepend(d.mapCoord):(p.uniforms.uMapCoord=d.mapCoord.toArray(!0),p.uniforms.uClampFrame=d.uClampFrame,p.uniforms.uClampOffset=d.uClampOffset),p.uniforms.uTransform=m_.toArray(!0),p.uniforms.uColor=Uf(i.tint,i.worldAlpha,p.uniforms.uColor,c),p.uniforms.translationMatrix=i.transform.worldTransform.toArray(!0),p.uniforms.uSampler=h,r.shader.bind(p),r.geometry.bind(n),this.state.blendMode=Nf(i.blendMode,c),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e.extension={name:"tilingSprite",type:At.RendererPlugin},e}(lu);var OC=function(t,e){return OC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},OC(t,e)};function DC(t,e){OC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Fte=function(){function t(e,i){this.uvBuffer=e,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(e){if(!(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}},t}(),LC=new Gt,d4=new nu,Pl=function(t){DC(e,t);function e(i,r,n,o){o===void 0&&(o=tn.TRIANGLES);var a=t.call(this)||this;return a.geometry=i,a.shader=r,a.state=n||_s.for2d(),a.drawMode=o,a.start=0,a.size=0,a.uvs=null,a.indices=null,a.vertexData=new Float32Array(1),a.vertexDirty=-1,a._transformID=-1,a._roundPixels=Oe.ROUND_PIXELS,a.batchUvs=null,a}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(i){this.shader=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(i){this.shader.tint=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(i){this.shader.texture=i},enumerable:!1,configurable:!0}),e.prototype._render=function(i){var r=this.geometry.buffers[0].data,n=this.shader;n.batchable&&this.drawMode===tn.TRIANGLES&&r.length<e.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)},e.prototype._renderDefault=function(i){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),i.batch.flush(),r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(r),i.state.set(this.state),i.geometry.bind(this.geometry,r),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(i){var r=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;var o=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[o]),i.plugins[o].render(this)},e.prototype.calculateVertices=function(){var i=this.geometry,r=i.buffers[0],n=r.data,o=r._updateID;if(!(o===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==n.length&&(this.vertexData=new Float32Array(n.length));for(var a=this.transform.worldTransform,l=a.a,h=a.b,u=a.c,c=a.d,f=a.tx,d=a.ty,m=this.vertexData,p=0;p<m.length/2;p++){var v=n[p*2],g=n[p*2+1];m[p*2]=l*v+u*g+f,m[p*2+1]=h*v+c*g+d}if(this._roundPixels)for(var _=Oe.RESOLUTION,p=0;p<m.length;++p)m[p]=Math.round((m[p]*_|0)/_);this.vertexDirty=o}},e.prototype.calculateUvs=function(){var i=this.geometry.buffers[1],r=this.shader;r.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new Fte(i,r.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,LC);for(var r=this.geometry.getBuffer("aVertexPosition").data,n=d4.points,o=this.geometry.getIndex().data,a=o.length,l=this.drawMode===4?3:1,h=0;h+2<a;h+=l){var u=o[h]*2,c=o[h+1]*2,f=o[h+2]*2;if(n[0]=r[u],n[1]=r[u+1],n[2]=r[c],n[3]=r[c+1],n[4]=r[f],n[5]=r[f+1],d4.contains(LC.x,LC.y))return!0}return!1},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(di),Bte=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Nte=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,Rl=function(t){DC(e,t);function e(i,r){var n=this,o={uSampler:i,alpha:1,uTextureMatrix:Zt.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(o,r.uniforms),n=t.call(this,r.program||El.from(Nte,Bte),o)||this,n._colorDirty=!1,n.uvMatrix=new Yf(i),n.batchable=r.program===void 0,n.pluginName=r.pluginName,n.tint=r.tint,n.alpha=r.alpha,n}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(i){this.uniforms.uSampler!==i&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!i.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=i,this.uvMatrix.texture=i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(i){i!==this._alpha&&(this._alpha=i,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){i!==this._tint&&(this._tint=i,this._tintRGB=(i>>16)+(i&65280)+((i&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var i=this.texture.baseTexture;Uf(this._tint,this._alpha,this.uniforms.uColor,i.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(qn),fu=function(t){DC(e,t);function e(i,r,n){var o=t.call(this)||this,a=new Ri(i),l=new Ri(r,!0),h=new Ri(n,!0,!0);return o.addAttribute("aVertexPosition",a,2,!1,rt.FLOAT).addAttribute("aTextureCoord",l,2,!1,rt.FLOAT).addIndex(h),o._updateId=-1,o}return Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(Cl);var kC=function(t,e){return kC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},kC(t,e)};function Ute(t,e){kC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var v_=function(){function t(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}return t}(),zte=function(){function t(){}return t.test=function(e){return typeof e=="string"&&e.indexOf("info face=")===0},t.parse=function(e){var i=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var n in i){var o=i[n].match(/^[a-z]+/gm)[0],a=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(var h in a){var u=a[h].split("="),c=u[0],f=u[1].replace(/"/gm,""),d=parseFloat(f),m=isNaN(d)?f:d;l[c]=m}r[o].push(l)}var p=new v_;return r.info.forEach(function(v){return p.info.push({face:v.face,size:parseInt(v.size,10)})}),r.common.forEach(function(v){return p.common.push({lineHeight:parseInt(v.lineHeight,10)})}),r.page.forEach(function(v){return p.page.push({id:parseInt(v.id,10),file:v.file})}),r.char.forEach(function(v){return p.char.push({id:parseInt(v.id,10),page:parseInt(v.page,10),x:parseInt(v.x,10),y:parseInt(v.y,10),width:parseInt(v.width,10),height:parseInt(v.height,10),xoffset:parseInt(v.xoffset,10),yoffset:parseInt(v.yoffset,10),xadvance:parseInt(v.xadvance,10)})}),r.kerning.forEach(function(v){return p.kerning.push({first:parseInt(v.first,10),second:parseInt(v.second,10),amount:parseInt(v.amount,10)})}),r.distanceField.forEach(function(v){return p.distanceField.push({distanceRange:parseInt(v.distanceRange,10),fieldType:v.fieldType})}),p},t}(),FC=function(){function t(){}return t.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},t.parse=function(e){for(var i=new v_,r=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),o=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),l=e.getElementsByTagName("kerning"),h=e.getElementsByTagName("distanceField"),u=0;u<r.length;u++)i.info.push({face:r[u].getAttribute("face"),size:parseInt(r[u].getAttribute("size"),10)});for(var u=0;u<n.length;u++)i.common.push({lineHeight:parseInt(n[u].getAttribute("lineHeight"),10)});for(var u=0;u<o.length;u++)i.page.push({id:parseInt(o[u].getAttribute("id"),10)||0,file:o[u].getAttribute("file")});for(var u=0;u<a.length;u++){var c=a[u];i.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(var u=0;u<l.length;u++)i.kerning.push({first:parseInt(l[u].getAttribute("first"),10),second:parseInt(l[u].getAttribute("second"),10),amount:parseInt(l[u].getAttribute("amount"),10)});for(var u=0;u<h.length;u++)i.distanceField.push({fieldType:h[u].getAttribute("fieldType"),distanceRange:parseInt(h[u].getAttribute("distanceRange"),10)});return i},t}(),Gte=function(){function t(){}return t.test=function(e){if(typeof e=="string"&&e.indexOf("<font>")>-1){var i=new globalThis.DOMParser().parseFromString(e,"text/xml");return FC.test(i)}return!1},t.parse=function(e){var i=new globalThis.DOMParser().parseFromString(e,"text/xml");return FC.parse(i)},t}(),IC=[zte,FC,Gte];function v4(t){for(var e=0;e<IC.length;e++)if(IC[e].test(t))return IC[e];return null}function Hte(t,e,i,r,n,o){var a=i.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;var l,h=i.dropShadow?i.dropShadowDistance:0,u=i.padding||0,c=t.width/r-h-u*2,f=t.height/r-h-u*2,d=a.slice(),m=i.fillGradientStops.slice();if(!m.length)for(var p=d.length+1,v=1;v<p;++v)m.push(v/p);if(d.unshift(a[0]),m.unshift(0),d.push(a[a.length-1]),m.push(1),i.fillGradientType===cu.LINEAR_VERTICAL){l=e.createLinearGradient(c/2,u,c/2,f+u);for(var g=0,_=o.fontProperties.fontSize+i.strokeThickness,x=_/f,v=0;v<n.length;v++)for(var b=o.lineHeight*v,y=0;y<d.length;y++){var S=0;typeof m[y]=="number"?S=m[y]:S=y/d.length;var w=b/f+S*x,M=Math.max(g,w);M=Math.min(M,1),l.addColorStop(M,d[y]),g=M}}else{l=e.createLinearGradient(u,f/2,c+u,f/2);for(var C=d.length+1,E=1,v=0;v<d.length;v++){var P=void 0;typeof m[v]=="number"?P=m[v]:P=E/C,l.addColorStop(P,d[v]),E++}}return l}function Wte(t,e,i,r,n,o,a){var l=i.text,h=i.fontProperties;e.translate(r,n),e.scale(o,o);var u=a.strokeThickness/2,c=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=Hte(t,e,a,o,[l],i),e.strokeStyle=a.stroke,a.dropShadow){var f=a.dropShadowColor,d=Vn(typeof f=="number"?f:Bf(f)),m=a.dropShadowBlur*o,p=a.dropShadowDistance*o;e.shadowColor="rgba("+d[0]*255+","+d[1]*255+","+d[2]*255+","+a.dropShadowAlpha+")",e.shadowBlur=m,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*p,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*p}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(l,u,c+i.lineHeight-h.descent),a.fill&&e.fillText(l,u,c+i.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function _4(t){return Array.from?Array.from(t):t.split("")}function Vte(t){typeof t=="string"&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n)){if(n.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<o)throw new Error("[BitmapFont]: Invalid character range.");for(var l=o,h=a;l<=h;l++)e.push(String.fromCharCode(l))}else e.push.apply(e,_4(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function g_(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}var Aa=function(){function t(e,i,r){var n,o,a=e.info[0],l=e.common[0],h=e.page[0],u=e.distanceField[0],c=ba(h.file),f={};this._ownsTextures=r,this.font=a.face,this.size=a.size,this.lineHeight=l.lineHeight/c,this.chars={},this.pageTextures=f;for(var d=0;d<e.page.length;d++){var m=e.page[d],p=m.id,v=m.file;f[p]=i instanceof Array?i[d]:i[v],u!=null&&u.fieldType&&u.fieldType!=="none"&&(f[p].baseTexture.alphaMode=rn.NO_PREMULTIPLIED_ALPHA,f[p].baseTexture.mipmap=zr.OFF)}for(var d=0;d<e.char.length;d++){var g=e.char[d],p=g.id,_=g.page,x=e.char[d],b=x.x,y=x.y,S=x.width,w=x.height,M=x.xoffset,C=x.yoffset,E=x.xadvance;b/=c,y/=c,S/=c,w/=c,M/=c,C/=c,E/=c;var P=new wt(b+f[_].frame.x/c,y+f[_].frame.y/c,S,w);this.chars[p]={xOffset:M,yOffset:C,xAdvance:E,kerning:{},texture:new tt(f[_].baseTexture,P),page:_}}for(var d=0;d<e.kerning.length;d++){var A=e.kerning[d],R=A.first,k=A.second,I=A.amount;R/=c,k/=c,I/=c,this.chars[k]&&(this.chars[k].kerning[R]=I)}this.distanceFieldRange=u==null?void 0:u.distanceRange,this.distanceFieldType=(o=(n=u==null?void 0:u.fieldType)===null||n===void 0?void 0:n.toLowerCase())!==null&&o!==void 0?o:"none"}return t.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i,r){var n;if(e instanceof v_)n=e;else{var o=v4(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}i instanceof tt&&(i=[i]);var a=new t(n,i,r);return t.available[a.font]=a,a},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,r),o=n.chars,a=n.padding,l=n.resolution,h=n.textureWidth,u=n.textureHeight,c=Vte(o),f=i instanceof Ta?i:new Ta(i),d=h,m=new v_;m.info[0]={face:f.fontFamily,size:f.fontSize},m.common[0]={lineHeight:f.fontSize};for(var p=0,v=0,g,_,x,b=0,y=[],S=0;S<c.length;S++){g||(g=Oe.ADAPTER.createCanvas(),g.width=h,g.height=u,_=g.getContext("2d"),x=new St(g,{resolution:l}),y.push(new tt(x)),m.page.push({id:y.length-1,file:""}));var w=c[S],M=Xn.measureText(w,f,!1,g),C=M.width,E=Math.ceil(M.height),P=Math.ceil((f.fontStyle==="italic"?2:1)*C);if(v>=u-E*l){if(v===0)throw new Error("[BitmapFont] textureHeight "+u+"px is too small "+("(fontFamily: '"+f.fontFamily+"', fontSize: "+f.fontSize+"px, char: '"+w+"')"));--S,g=null,_=null,x=null,v=0,p=0,b=0;continue}if(b=Math.max(E+M.fontProperties.descent,b),P*l+p>=d){if(p===0)throw new Error("[BitmapFont] textureWidth "+h+"px is too small "+("(fontFamily: '"+f.fontFamily+"', fontSize: "+f.fontSize+"px, char: '"+w+"')"));--S,v+=b*l,v=Math.ceil(v),p=0,b=0;continue}Wte(g,_,M,p,v,l,f);var A=g_(M.text);m.char.push({id:A,page:y.length-1,x:p/l,y:v/l,width:P,height:E,xoffset:0,yoffset:0,xadvance:Math.ceil(C-(f.dropShadow?f.dropShadowDistance:0)-(f.stroke?f.strokeThickness:0))}),p+=(P+2*a)*l,p=Math.ceil(p)}if(!(r!=null&&r.skipKerning))for(var S=0,R=c.length;S<R;S++)for(var k=c[S],I=0;I<R;I++){var L=c[I],T=_.measureText(k).width,O=_.measureText(L).width,D=_.measureText(k+L).width,F=D-(T+O);F&&m.kerning.push({first:g_(k),second:g_(L),amount:F})}var B=new t(m,y,!0);return t.available[e]!==void 0&&t.uninstall(e),t.available[e]=B,B},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),jte=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,qte=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`,p4=[],m4=[],g4=[],iOe=function(t){Ute(e,t);function e(i,r){r===void 0&&(r={});var n=t.call(this)||this;n._tint=16777215;var o=Object.assign({},e.styleDefaults,r),a=o.align,l=o.tint,h=o.maxWidth,u=o.letterSpacing,c=o.fontName,f=o.fontSize;if(!Aa.available[c])throw new Error('Missing BitmapFont "'+c+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=a,n._tint=l,n._font=void 0,n._fontName=c,n._fontSize=f,n.text=i,n._maxWidth=h,n._maxLineHeight=0,n._letterSpacing=u,n._anchor=new Sa(function(){n.dirty=!0},n,0,0),n._roundPixels=Oe.ROUND_PIXELS,n.dirty=!0,n._resolution=Oe.RESOLUTION,n._autoResolution=!0,n._textureCache={},n}return e.prototype.updateText=function(){for(var i,r=Aa.available[this._fontName],n=this.fontSize,o=n/r.size,a=new Gt,l=[],h=[],u=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",f=_4(c),d=this._maxWidth*r.size/n,m=r.distanceFieldType==="none"?p4:m4,p=null,v=0,g=0,_=0,x=-1,b=0,y=0,S=0,w=0,M=0;M<f.length;M++){var C=f[M],E=g_(C);if(/(?:\s)/.test(C)&&(x=M,b=v,w++),C==="\r"||C===`
`){h.push(v),u.push(-1),g=Math.max(g,v),++_,++y,a.x=0,a.y+=r.lineHeight,p=null,w=0;continue}var P=r.chars[E];if(P){p&&P.kerning[p]&&(a.x+=P.kerning[p]);var A=g4.pop()||{texture:tt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Gt};A.texture=P.texture,A.line=_,A.charCode=E,A.position.x=a.x+P.xOffset+this._letterSpacing/2,A.position.y=a.y+P.yOffset,A.prevSpaces=w,l.push(A),v=A.position.x+Math.max(P.xAdvance-P.xOffset,P.texture.orig.width),a.x+=P.xAdvance+this._letterSpacing,S=Math.max(S,P.yOffset+P.texture.height),p=E,x!==-1&&d>0&&a.x>d&&(++y,vs(l,1+x-y,1+M-x),M=x,x=-1,h.push(b),u.push(l.length>0?l[l.length-1].prevSpaces:0),g=Math.max(g,b),_++,a.x=0,a.y+=r.lineHeight,p=null,w=0)}}var R=f[f.length-1];R!=="\r"&&R!==`
`&&(/(?:\s)/.test(R)&&(v=b),h.push(v),g=Math.max(g,v),u.push(-1));for(var k=[],M=0;M<=_;M++){var I=0;this._align==="right"?I=g-h[M]:this._align==="center"?I=(g-h[M])/2:this._align==="justify"&&(I=u[M]<0?0:(g-h[M])/u[M]),k.push(I)}var L=l.length,T={},O=[],D=this._activePagesMeshData;m.push.apply(m,D);for(var M=0;M<L;M++){var F=l[M].texture,B=F.baseTexture.uid;if(!T[B]){var U=m.pop();if(!U){var G=new fu,Y=void 0,re=void 0;r.distanceFieldType==="none"?(Y=new Rl(tt.EMPTY),re=et.NORMAL):(Y=new Rl(tt.EMPTY,{program:El.from(qte,jte),uniforms:{uFWidth:0}}),re=et.NORMAL_NPM);var N=new Pl(G,Y);N.blendMode=re,U={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:N,vertices:null,uvs:null,indices:null}}U.index=0,U.indexCount=0,U.vertexCount=0,U.uvsCount=0,U.total=0;var z=this._textureCache;z[B]=z[B]||new tt(F.baseTexture),U.mesh.texture=z[B],U.mesh.tint=this._tint,O.push(U),T[B]=U}T[B].total++}for(var M=0;M<D.length;M++)O.indexOf(D[M])===-1&&this.removeChild(D[M].mesh);for(var M=0;M<O.length;M++)O[M].mesh.parent!==this&&this.addChild(O[M].mesh);this._activePagesMeshData=O;for(var M in T){var U=T[M],ie=U.total;if(!(((i=U.indices)===null||i===void 0?void 0:i.length)>6*ie)||U.vertices.length<Pl.BATCHABLE_SIZE*2)U.vertices=new Float32Array(4*2*ie),U.uvs=new Float32Array(4*2*ie),U.indices=new Uint16Array(6*ie);else for(var Z=U.total,ne=U.vertices,K=Z*4*2;K<ne.length;K++)ne[K]=0;U.mesh.size=6*ie}for(var M=0;M<L;M++){var C=l[M],ae=C.position.x+k[C.line]*(this._align==="justify"?C.prevSpaces:1);this._roundPixels&&(ae=Math.round(ae));var ue=ae*o,_e=C.position.y*o,F=C.texture,Re=T[F.baseTexture.uid],Le=F.frame,Et=F._uvs,it=Re.index++;Re.indices[it*6+0]=0+it*4,Re.indices[it*6+1]=1+it*4,Re.indices[it*6+2]=2+it*4,Re.indices[it*6+3]=0+it*4,Re.indices[it*6+4]=2+it*4,Re.indices[it*6+5]=3+it*4,Re.vertices[it*8+0]=ue,Re.vertices[it*8+1]=_e,Re.vertices[it*8+2]=ue+Le.width*o,Re.vertices[it*8+3]=_e,Re.vertices[it*8+4]=ue+Le.width*o,Re.vertices[it*8+5]=_e+Le.height*o,Re.vertices[it*8+6]=ue,Re.vertices[it*8+7]=_e+Le.height*o,Re.uvs[it*8+0]=Et.x0,Re.uvs[it*8+1]=Et.y0,Re.uvs[it*8+2]=Et.x1,Re.uvs[it*8+3]=Et.y1,Re.uvs[it*8+4]=Et.x2,Re.uvs[it*8+5]=Et.y2,Re.uvs[it*8+6]=Et.x3,Re.uvs[it*8+7]=Et.y3}this._textWidth=g*o,this._textHeight=(a.y+r.lineHeight)*o;for(var M in T){var U=T[M];if(this.anchor.x!==0||this.anchor.y!==0)for(var je=0,ut=this._textWidth*this.anchor.x,jt=this._textHeight*this.anchor.y,Wt=0;Wt<U.total;Wt++)U.vertices[je++]-=ut,U.vertices[je++]-=jt,U.vertices[je++]-=ut,U.vertices[je++]-=jt,U.vertices[je++]-=ut,U.vertices[je++]-=jt,U.vertices[je++]-=ut,U.vertices[je++]-=jt;this._maxLineHeight=S*o;var X=U.mesh.geometry.getBuffer("aVertexPosition"),V=U.mesh.geometry.getBuffer("aTextureCoord"),me=U.mesh.geometry.getIndex();X.data=U.vertices,V.data=U.uvs,me.data=U.indices,X.update(),V.update(),me.update()}for(var M=0;M<l.length;M++)g4.push(l[M]);this._font=r,this.dirty=!1},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);var r=Aa.available[this._fontName],n=r.distanceFieldRange,o=r.distanceFieldType,a=r.size;if(o!=="none")for(var l=this.worldTransform,h=l.a,u=l.b,c=l.c,f=l.d,d=Math.sqrt(h*h+u*u),m=Math.sqrt(c*c+f*f),p=(Math.abs(d)+Math.abs(m))/2,v=this.fontSize/a,g=0,_=this._activePagesMeshData;g<_.length;g++){var x=_[g];x.mesh.shader.uniforms.uFWidth=p*n*v*this._resolution}t.prototype._render.call(this,i)},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){var i=Aa.available[this._fontName];if(!i)throw new Error('Missing BitmapFont "'+this._fontName+'"');this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){if(this._tint!==i){this._tint=i;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=i}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(i){this._align!==i&&(this._align=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(i){if(!Aa.available[i])throw new Error('Missing BitmapFont "'+i+'"');this._fontName!==i&&(this._fontName=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){var i;return(i=this._fontSize)!==null&&i!==void 0?i:Aa.available[this._fontName].size},set:function(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(i){var r=this._textureCache,n=Aa.available[this._fontName],o=n.distanceFieldType==="none"?p4:m4;o.push.apply(o,this._activePagesMeshData);for(var a=0,l=this._activePagesMeshData;a<l.length;a++){var h=l[a];this.removeChild(h.mesh)}this._activePagesMeshData=[],o.filter(function(f){return r[f.mesh.texture.baseTexture.uid]}).forEach(function(f){f.mesh.texture=tt.EMPTY});for(var u in r){var c=r[u];c.destroy(),delete r[u]}this._font=null,this._textureCache=null,t.prototype.destroy.call(this,i)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(di),y4=function(){function t(){}return t.add=function(){li.setExtensionXhrType("fnt",li.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){var r=v4(e.data);if(!r){i();return}for(var n=t.getBaseUrl(this,e),o=r.parse(e.data),a={},l=function(v){a[v.metadata.pageFile]=v.texture,Object.keys(a).length===o.page.length&&(e.bitmapFont=Aa.install(o,a,!0),i())},h=0;h<o.page.length;++h){var u=o.page[h].file,c=n+u,f=!1;for(var d in this.resources){var m=this.resources[d];if(m.url===c){m.metadata.pageFile=u,m.texture?l(m):m.onAfterMiddleware.add(l),f=!0;break}}if(!f){var p={crossOrigin:e.crossOrigin,loadType:li.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:u},e.metadata.imageMetadata),parentResource:e};this.add(c,p,l)}}},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&(r==="."&&(r=""),e.baseUrl&&r&&e.baseUrl.charAt(e.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(e.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},t.dirname=function(e){var i=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return i===e?".":i===""?"/":i},t.extension=At.Loader,t}();var BC=function(t,e){return BC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},BC(t,e)};function Xte(t,e){BC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Yte=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,Zte=function(t){Xte(e,t);function e(i){i===void 0&&(i=1);var r=t.call(this,PU,Yte,{uAlpha:1})||this;return r.alpha=i,r}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(i){this.uniforms.uAlpha=i},enumerable:!1,configurable:!0}),e}(sn);var NC=function(t,e){return NC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},NC(t,e)};function x4(t,e){NC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Kte=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Qte(t,e){var i=Math.ceil(t/2),r=Kte,n="",o;e?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var l=o.replace("%index%",a.toString());l=l.replace("%sampleIndex%",a-(i-1)+".0"),n+=l,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}var Jte={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},$te=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function eie(t){for(var e=Jte[t],i=e.length,r=$te,n="",o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",a,l=0;l<t;l++){var h=o.replace("%index%",l.toString());a=l,l>=i&&(a=t-l-1),h=h.replace("%value%",e[a].toString()),n+=h,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}var UC=function(t){x4(e,t);function e(i,r,n,o,a){r===void 0&&(r=8),n===void 0&&(n=4),o===void 0&&(o=Oe.FILTER_RESOLUTION),a===void 0&&(a=5);var l=this,h=Qte(a,i),u=eie(a);return l=t.call(this,h,u)||this,l.horizontal=i,l.resolution=o,l._quality=0,l.quality=n,l.blur=r,l}return e.prototype.apply=function(i,r,n,o){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/i.renderer.width*(i.renderer.width/r.width):this.uniforms.strength=1/i.renderer.height*(i.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)i.applyFilter(this,r,n,o);else{var a=i.getFilterTexture(),l=i.renderer,h=r,u=a;this.state.blend=!1,i.applyFilter(this,h,u,Sn.CLEAR);for(var c=1;c<this.passes-1;c++){i.bindAndClear(h,Sn.BLIT),this.uniforms.uSampler=u;var f=u;u=h,h=f,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,i.applyFilter(this,u,n,o),i.returnFilterTexture(a)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(i){this.padding=1+Math.abs(i)*2,this.strength=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(i){this._quality=i,this.passes=i},enumerable:!1,configurable:!0}),e}(sn),tie=function(t){x4(e,t);function e(i,r,n,o){i===void 0&&(i=8),r===void 0&&(r=4),n===void 0&&(n=Oe.FILTER_RESOLUTION),o===void 0&&(o=5);var a=t.call(this)||this;return a.blurXFilter=new UC(!0,i,r,n,o),a.blurYFilter=new UC(!1,i,r,n,o),a.resolution=n,a.quality=r,a.blur=i,a.repeatEdgePixels=!1,a}return e.prototype.apply=function(i,r,n,o){var a=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(a&&l){var h=i.getFilterTexture();this.blurXFilter.apply(i,r,h,Sn.CLEAR),this.blurYFilter.apply(i,h,n,o),i.returnFilterTexture(h)}else l?this.blurYFilter.apply(i,r,n,o):this.blurXFilter.apply(i,r,n,o)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(i){this.blurXFilter.blur=this.blurYFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(i){this.blurXFilter.quality=this.blurYFilter.quality=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(i){this.blurXFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(i){this.blurYFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(i){this.blurYFilter.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(i){this._repeatEdgePixels=i,this.updatePadding()},enumerable:!1,configurable:!0}),e}(sn);var zC=function(t,e){return zC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},zC(t,e)};function iie(t,e){zC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var rie=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,GC=function(t){iie(e,t);function e(){var i=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return i=t.call(this,Kv,rie,r)||this,i.alpha=1,i}return e.prototype._loadMatrix=function(i,r){r===void 0&&(r=!1);var n=i;r&&(this._multiply(n,this.uniforms.m,i),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(i,r,n){return i[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],i[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],i[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],i[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],i[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],i[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],i[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],i[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],i[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],i[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],i[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],i[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],i[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],i[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],i[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],i[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],i[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],i[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],i[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],i[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],i},e.prototype._colorMatrix=function(i){var r=new Float32Array(i);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},e.prototype.brightness=function(i,r){var n=[i,0,0,0,0,0,i,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.tint=function(i,r){var n=i>>16&255,o=i>>8&255,a=i&255,l=[n/255,0,0,0,0,0,o/255,0,0,0,0,0,a/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)},e.prototype.greyscale=function(i,r){var n=[i,i,i,0,0,i,i,i,0,0,i,i,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.blackAndWhite=function(i){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.hue=function(i,r){i=(i||0)/180*Math.PI;var n=Math.cos(i),o=Math.sin(i),a=Math.sqrt,l=1/3,h=a(l),u=n+(1-n)*l,c=l*(1-n)-h*o,f=l*(1-n)+h*o,d=l*(1-n)+h*o,m=n+l*(1-n),p=l*(1-n)-h*o,v=l*(1-n)-h*o,g=l*(1-n)+h*o,_=n+l*(1-n),x=[u,c,f,0,0,d,m,p,0,0,v,g,_,0,0,0,0,0,1,0];this._loadMatrix(x,r)},e.prototype.contrast=function(i,r){var n=(i||0)+1,o=-.5*(n-1),a=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.saturate=function(i,r){i===void 0&&(i=0);var n=i*2/3+1,o=(n-1)*-.5,a=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(i){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.sepia=function(i){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.technicolor=function(i){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.polaroid=function(i){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.toBGR=function(i){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.kodachrome=function(i){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.browni=function(i){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.vintage=function(i){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.colorTone=function(i,r,n,o,a){i=i||.2,r=r||.15,n=n||16770432,o=o||3375104;var l=(n>>16&255)/255,h=(n>>8&255)/255,u=(n&255)/255,c=(o>>16&255)/255,f=(o>>8&255)/255,d=(o&255)/255,m=[.3,.59,.11,0,0,l,h,u,i,0,c,f,d,r,0,l-c,h-f,u-d,0,0];this._loadMatrix(m,a)},e.prototype.night=function(i,r){i=i||.1;var n=[i*-2,-i,0,0,0,-i,0,i,0,0,0,i,i*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.predator=function(i,r){var n=[11.224130630493164*i,-4.794486999511719*i,-2.8746118545532227*i,0*i,.40342438220977783*i,-3.6330697536468506*i,9.193157196044922*i,-2.951810836791992*i,0*i,-1.316135048866272*i,-3.2184197902679443*i,-4.2375030517578125*i,7.476448059082031*i,0*i,.8044459223747253*i,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.lsd=function(i){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.reset=function(){var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(i,!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(i){this.uniforms.m=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(i){this.uniforms.uAlpha=i},enumerable:!1,configurable:!0}),e}(sn);GC.prototype.grayscale=GC.prototype.greyscale;var HC=function(t,e){return HC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},HC(t,e)};function nie(t,e){HC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var sie=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,oie=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,aie=function(t){nie(e,t);function e(i,r){var n=this,o=new Zt;return i.renderable=!1,n=t.call(this,oie,sie,{mapSampler:i._texture,filterMatrix:o,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,n.maskSprite=i,n.maskMatrix=o,r==null&&(r=20),n.scale=new Gt(r,r),n}return e.prototype.apply=function(i,r,n,o){this.uniforms.filterMatrix=i.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var a=this.maskSprite.worldTransform,l=Math.sqrt(a.a*a.a+a.b*a.b),h=Math.sqrt(a.c*a.c+a.d*a.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=a.a/l,this.uniforms.rotation[1]=a.b/l,this.uniforms.rotation[2]=a.c/h,this.uniforms.rotation[3]=a.d/h),i.applyFilter(this,r,n,o)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(i){this.uniforms.mapSampler=i},enumerable:!1,configurable:!0}),e}(sn);var WC=function(t,e){return WC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},WC(t,e)};function lie(t,e){WC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var hie=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,uie=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,cie=function(t){lie(e,t);function e(){return t.call(this,hie,uie)||this}return e}(sn);var VC=function(t,e){return VC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},VC(t,e)};function fie(t,e){VC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var die=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,pie=function(t){fie(e,t);function e(i,r){i===void 0&&(i=.5),r===void 0&&(r=Math.random());var n=t.call(this,Kv,die,{uNoise:0,uSeed:0})||this;return n.noise=i,n.seed=r,n}return Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(i){this.uniforms.uNoise=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(i){this.uniforms.uSeed=i},enumerable:!1,configurable:!0}),e}(sn);var b4=new Zt;ni.prototype._cacheAsBitmap=!1;ni.prototype._cacheData=null;ni.prototype._cacheAsBitmapResolution=null;ni.prototype._cacheAsBitmapMultisample=$t.NONE;var mie=function(){function t(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return t}();Object.defineProperties(ni.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var e;t?(this._cacheData||(this._cacheData=new mie),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}});ni.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};ni.prototype._initCachedDisplayObject=function(e){var i;if(!(this._cacheData&&this._cacheData.sprite)){var r=this.alpha;this.alpha=1,e.batch.flush();var n=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var o=this.filters[0].padding;n.pad(o)}n.ceil(Oe.RESOLUTION);var a=e.renderTexture.current,l=e.renderTexture.sourceFrame.clone(),h=e.renderTexture.destinationFrame.clone(),u=e.projection.transform,c=Po.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:(i=this.cacheAsBitmapMultisample)!==null&&i!==void 0?i:e.multisample}),f="cacheAsBitmap_"+qs();this._cacheData.textureCacheId=f,St.addToCache(c.baseTexture,f),tt.addToCache(c,f);var d=this.transform.localTransform.copyTo(b4).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=u,e.renderTexture.bind(a,l,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var m=new Do(c);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(n.x/n.width),m.anchor.y=-(n.y/n.height),m.alpha=r,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=m.containsPoint.bind(m)}};ni.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};ni.prototype._initCachedDisplayObjectCanvas=function(e){if(!(this._cacheData&&this._cacheData.sprite)){var i=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var n=e.context,o=e._projTransform;i.ceil(Oe.RESOLUTION);var a=Po.create({width:i.width,height:i.height}),l="cacheAsBitmap_"+qs();this._cacheData.textureCacheId=l,St.addToCache(a.baseTexture,l),tt.addToCache(a,l);var h=b4;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=i.x,h.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),e.context=n,e._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var u=new Do(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(i.x/i.width),u.anchor.y=-(i.y/i.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}};ni.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ni.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ni.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,St.removeFromCache(this._cacheData.textureCacheId),tt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ni.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};ni.prototype.name=null;di.prototype.getChildByName=function(e,i){for(var r=0,n=this.children.length;r<n;r++)if(this.children[r].name===e)return this.children[r];if(i)for(var r=0,n=this.children.length;r<n;r++){var o=this.children[r];if(o.getChildByName){var a=o.getChildByName(e,!0);if(a)return a}}return null};ni.prototype.getGlobalPosition=function(e,i){return e===void 0&&(e=new Gt),i===void 0&&(i=!1),this.parent?this.parent.toGlobal(this.position,e,i):(e.x=this.position.x,e.y=this.position.y),e};var gie=function(){function t(){}return t.init=function(e){var i=this;Object.defineProperty(this,"resizeTo",{set:function(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){i._resizeTo&&(i.cancelResize(),i._resizeId=requestAnimationFrame(function(){return i.resize()}))},this.cancelResize=function(){i._resizeId&&(cancelAnimationFrame(i._resizeId),i._resizeId=null)},this.resize=function(){if(i._resizeTo){i.cancelResize();var r,n;if(i._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{var o=i._resizeTo,a=o.clientWidth,l=o.clientHeight;r=a,n=l}i.renderer.resize(r,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},t.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t.extension=At.Application,t}(),jC=function(){function t(e){var i=this;this.stage=new di,e=Object.assign({forceCanvas:!1},e),this.renderer=AU(e),t._plugins.forEach(function(r){r.init.call(i,e)})}return t.registerPlugin=function(e){Gi("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),En.add({type:At.Application,ref:e})},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,i){var r=this,n=t._plugins.slice(0);n.reverse(),n.forEach(function(o){o.destroy.call(r)}),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}();En.handleByList(At.Application,jC._plugins);En.add(gie);var qC=function(t,e){return qC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},qC(t,e)};function du(t,e){qC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var vie=function(t){du(e,t);function e(i,r,n,o){i===void 0&&(i=100),r===void 0&&(r=100),n===void 0&&(n=10),o===void 0&&(o=10);var a=t.call(this)||this;return a.segWidth=n,a.segHeight=o,a.width=i,a.height=r,a.build(),a}return e.prototype.build=function(){for(var i=this.segWidth*this.segHeight,r=[],n=[],o=[],a=this.segWidth-1,l=this.segHeight-1,h=this.width/a,u=this.height/l,c=0;c<i;c++){var f=c%this.segWidth,d=c/this.segWidth|0;r.push(f*h,d*u),n.push(f/a,d/l)}for(var m=a*l,c=0;c<m;c++){var p=c%a,v=c/a|0,g=v*this.segWidth+p,_=v*this.segWidth+p+1,x=(v+1)*this.segWidth+p,b=(v+1)*this.segWidth+p+1;o.push(g,_,x,_,b,x)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(o),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(fu),_ie=function(t){du(e,t);function e(i,r,n){i===void 0&&(i=200),n===void 0&&(n=0);var o=t.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return o.points=r,o._width=i,o.textureScale=n,o.build(),o}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var i=this.points;if(i){var r=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),o=this.getIndex();if(!(i.length<1)){r.data.length/4!==i.length&&(r.data=new Float32Array(i.length*4),n.data=new Float32Array(i.length*4),o.data=new Uint16Array((i.length-1)*6));var a=n.data,l=o.data;a[0]=0,a[1]=0,a[2]=0,a[3]=1;for(var h=0,u=i[0],c=this._width*this.textureScale,f=i.length,d=0;d<f;d++){var m=d*4;if(this.textureScale>0){var p=u.x-i[d].x,v=u.y-i[d].y,g=Math.sqrt(p*p+v*v);u=i[d],h+=g/c}else h=d/(f-1);a[m]=h,a[m+1]=0,a[m+2]=h,a[m+3]=1}for(var _=0,d=0;d<f-1;d++){var m=d*2;l[_++]=m,l[_++]=m+1,l[_++]=m+2,l[_++]=m+2,l[_++]=m+1,l[_++]=m+3}n.update(),o.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var i=this.points;if(!(i.length<1)){for(var r=i[0],n,o=0,a=0,l=this.buffers[0].data,h=i.length,u=0;u<h;u++){var c=i[u],f=u*4;u<i.length-1?n=i[u+1]:n=c,a=-(n.x-r.x),o=n.y-r.y;var d=Math.sqrt(o*o+a*a),m=this.textureScale>0?this.textureScale*this._width/2:this._width/2;o/=d,a/=d,o*=m,a*=m,l[f]=c.x+o,l[f+1]=c.y+a,l[f+2]=c.x-o,l[f+3]=c.y-a,r=c}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(fu),BOe=function(t){du(e,t);function e(i,r,n){n===void 0&&(n=0);var o=this,a=new _ie(i.height,r,n),l=new Rl(i);return n>0&&(i.baseTexture.wrapMode=Ur.REPEAT),o=t.call(this,a,l)||this,o.autoUpdate=!0,o}return e.prototype._render=function(i){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),t.prototype._render.call(this,i)},e}(Pl),yie=function(t){du(e,t);function e(i,r,n){var o=this,a=new vie(i.width,i.height,r,n),l=new Rl(tt.WHITE);return o=t.call(this,a,l)||this,o.texture=i,o.autoResize=!0,o}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var i=this.geometry,r=this.shader.texture,n=r.width,o=r.height;this.autoResize&&(i.width!==n||i.height!==o)&&(i.width=this.shader.texture.width,i.height=this.shader.texture.height,i.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(i){this.shader.texture!==i&&(this.shader.texture=i,this._textureID=-1,i.baseTexture.valid?this.textureUpdated():i.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(i){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,i)},e.prototype.destroy=function(i){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,i)},e}(Pl),NOe=function(t){du(e,t);function e(i,r,n,o,a){i===void 0&&(i=tt.EMPTY);var l=this,h=new fu(r,n,o);h.getBuffer("aVertexPosition").static=!1;var u=new Rl(i);return l=t.call(this,h,u,null,a)||this,l.autoUpdate=!0,l}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(i){this.geometry.getBuffer("aVertexPosition").data=i},enumerable:!1,configurable:!0}),e.prototype._render=function(i){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,i)},e}(Pl),__=10,UOe=function(t){du(e,t);function e(i,r,n,o,a){r===void 0&&(r=__),n===void 0&&(n=__),o===void 0&&(o=__),a===void 0&&(a=__);var l=t.call(this,tt.WHITE,4,4)||this;return l._origWidth=i.orig.width,l._origHeight=i.orig.height,l._width=l._origWidth,l._height=l._origHeight,l._leftWidth=r,l._rightWidth=o,l._topHeight=n,l._bottomHeight=a,l.texture=i,l}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(i){this.geometry.getBuffer("aVertexPosition").data=i},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var i=this.vertices,r=this._getMinScale();i[9]=i[11]=i[13]=i[15]=this._topHeight*r,i[17]=i[19]=i[21]=i[23]=this._height-this._bottomHeight*r,i[25]=i[27]=i[29]=i[31]=this._height},e.prototype.updateVerticalVertices=function(){var i=this.vertices,r=this._getMinScale();i[2]=i[10]=i[18]=i[26]=this._leftWidth*r,i[4]=i[12]=i[20]=i[28]=this._width-this._rightWidth*r,i[6]=i[14]=i[22]=i[30]=this._width},e.prototype._getMinScale=function(){var i=this._leftWidth+this._rightWidth,r=this._width>i?1:this._width/i,n=this._topHeight+this._bottomHeight,o=this._height>n?1:this._height/n,a=Math.min(r,o);return a},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(i){this._width=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(i){this._height=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(i){this._leftWidth=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(i){this._rightWidth=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(i){this._topHeight=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(i){this._bottomHeight=i,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var i=this.texture,r=this.geometry.buffers[1].data;this._origWidth=i.orig.width,this._origHeight=i.orig.height;var n=1/this._origWidth,o=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=n*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-n*this._rightWidth,r[9]=r[11]=r[13]=r[15]=o*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-o*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(yie);var XC=function(t,e){return XC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},XC(t,e)};function xie(t,e){XC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var VOe=function(t){xie(e,t);function e(i,r){r===void 0&&(r=!0);var n=t.call(this,i[0]instanceof tt?i[0]:i[0].texture)||this;return n._textures=null,n._durations=null,n._autoUpdate=r,n._isConnectedToTicker=!1,n.animationSpeed=1,n.loop=!0,n.updateAnchor=!1,n.onComplete=null,n.onFrameChange=null,n.onLoop=null,n._currentTime=0,n._playing=!1,n._previousFrame=null,n.textures=i,n}return e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Pi.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Pi.shared.add(this.update,this,jn.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(i){this.stop();var r=this.currentFrame;this._currentTime=i,r!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(i){var r=this.currentFrame;this._currentTime=i,r!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(i){if(this._playing){var r=this.animationSpeed*i,n=this.currentFrame;if(this._durations!==null){var o=this._currentTime%1*this._durations[this.currentFrame];for(o+=r/60*1e3;o<0;)this._currentTime--,o+=this._durations[this.currentFrame];var a=Math.sign(this.animationSpeed*i);for(this._currentTime=Math.floor(this._currentTime);o>=this._durations[this.currentFrame];)o-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=o/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())}},e.prototype.updateTexture=function(){var i=this.currentFrame;this._previousFrame!==i&&(this._previousFrame=i,this._texture=this._textures[i],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(i){this.stop(),t.prototype.destroy.call(this,i),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(i){for(var r=[],n=0;n<i.length;++n)r.push(tt.from(i[n]));return new e(r)},e.fromImages=function(i){for(var r=[],n=0;n<i.length;++n)r.push(tt.from(i[n]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(i){if(i[0]instanceof tt)this._textures=i,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<i.length;r++)this._textures.push(i[r].texture),this._durations.push(i[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var i=Math.floor(this._currentTime)%this._textures.length;return i<0&&(i+=this._textures.length),i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Pi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Pi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(Do);En.add(OU,IU,DU,QU,l4,aC,f4,y4,jU,XU,YU,h4,BN,zU);var wie=`
#define PHONG
#define OUTPUT_FLAT_NORMAL 0

varying vec3 vViewPosition;

#include <common>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif

// Filament specific attributes
attribute vec3 aColor;
attribute vec3 aPos;
attribute vec3 aRot; // alpha1 = x, alpha2 = y, beta = z
attribute vec3 aSize; // w = x, h = y, L = z  x < 0 => start filament, y < 0 => End filament
uniform ivec4 splitPos;
uniform float opacity;
uniform vec3 diffuse;
#if OUTPUT_FLAT_NORMAL
  attribute vec3 face_normal;
  varying vec3 flatNormal;
#endif
const vec4 invisiblePos = vec4(-2.0, -2.0, 0.0, 1.0);
void makeInvisible() {
  gl_Position = invisiblePos;
}

void main() {
	// aColor = Filament color, color = material color
#if defined( USE_COLOR_ALPHA )
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = vec4( aColor, 1.0 );
#else // if defined( USE_COLOR )
#if IS_TRANSPARENT == 0
 if(gl_InstanceID < splitPos.x) {
   makeInvisible();
   return; 
 }
  if (gl_InstanceID < splitPos.y) {
  	vColor = diffuse; // color; 
  } else {
    vColor = aColor;
  }
#else  
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = aColor;
#endif 
#endif
	vec2 sc = vec2(sin(aRot.z), cos(aRot.z));
	float Lrec = 1.0 / aSize.z;
	vec3 transformed = position.xyz; // vec3( position );
#if FIL_NO_ENDCAPS == 0
  vec2 wh = abs(aSize.xy);	
  if(transformed.x < 0.0) { // Start cap
	  if(aSize.x >= 0.0) {
	    makeInvisible();
	    return;
	  }
	  if(transformed.x < -1.1) {
	    transformed.x = -0.5 * wh.x * Lrec;
	  } else {
	    transformed.x = 0.0;
	  }
	} else if(transformed.x > 1.5) { // end cap
	  if(aSize.y >= 0.0) {
	    makeInvisible();
	    return;
	  }
	  if(transformed.x > 2.1) {
	    transformed.x = 0.5 * wh.x * Lrec + 1.0;
	  } else {
	    transformed.x = 1.0;
	  }
	}
#else
	vec2 wh = aSize.xy;	
#endif
  vec2 scDivW = sc / wh.x;	
  vec2 scDivL = sc * Lrec;
  vec2 scMulW = sc * wh.x;	
  vec2 scMulL = sc * aSize.z;
  // mat3 rotNorm = mat3(scDivL.y, -s / w, 0.0, scDivL.x, -scDivW.y, 0.0, 0.0, 0.0, 1.0 / wh.y);
  mat3 rotNorm = mat3(scDivL.y, scDivL.x, 0.0, -scDivW.x, -scDivW.y, 0.0, 0.0, 0.0, 1.0 / wh.y);
#if OUTPUT_FLAT_NORMAL  
  flatNormal = normalize(normalMatrix * rotNorm * face_normal);
#endif  
  vNormal = normalize( normalMatrix * rotNorm * normal );

	if(transformed.x == 0.0) { // Start rotation
	  transformed.x += aRot.x * transformed.y;
	}  else if(transformed.x == 1.0) {
	  transformed.x += aRot.y * transformed.y;
	}
	mat3 rot = mat3(scMulL.y, scMulL.x, 0.0, -scMulW.x, scMulW.y, 0.0, 0.0, 0.0, wh.y);
  vec4 mvPosition = modelViewMatrix * vec4( rot * transformed + aPos, 1.0 );
  gl_Position = projectionMatrix * mvPosition;
  /* 
  gl_Position is clipped space (-1 to 1 for all axes = visible area)
  clipped = (
      any(lessThan(gl_Position.xyz, -gl_Position.www)) ||
      any(greaterThan(gl_Position.xyz, gl_Position.www))
    ) ? 1.0 : 0.0; */
	// Position is computed - adjust gl_Position

	vViewPosition = -mvPosition.xyz;

	// include <worldpos_vertex>

}
`,Sie=`
#define PHONG

uniform vec3 diffuse;
#if HAS_EMISSIVE
uniform vec3 emissive;
#endif
uniform vec3 specular;
uniform float shininess;
#if HAS_OPACITY	
uniform float opacity;
#endif

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;	
#endif
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

#include <bsdfs>
#include <lights_pars_begin>
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
varying vec3 vViewPosition;

struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)

// varying float vVisible;
// varying vec3 flatNormal;

void main() {
  /* if(vVisible < 1.0) {
    discard;
    return;
  } */

	// vec4 diffuseColor = vec4( diffuse, opacity );
#if HAS_OPACITY	
	vec4 diffuseColor = vec4( vColor.xyz, opacity );
#else
	vec4 diffuseColor = vec4( vColor.xyz, 1.0 );
#endif	
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

/*
#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif
*/
#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif
  float specularStrength = 1.0;
	// float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
	// bool frontFacing = dot(flatNormal, vViewPosition) > 0.0;
  /*if(!gl_FrontFacing) {
    discard;
    return;
  }*/

	// vec3 normal = normalize( flatNormal );
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
	  if(!gl_FrontFacing) {
		  normal = -normal;
		}
	#endif
#if 0
if (normal.z > 0.0) {
  // gl_FragColor = vec4( 0.0, vNormal.z, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( 0.0, normal.z, 0.0, 1.0 );
} else {
  // gl_FragColor = vec4( vNormal.z, 0.0, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( -normal.z, 0.0, 0.0, 1.0 );
}
return;
#endif
  // vec3 geometryNormal = normal; // unused variable  

	// accumulation
  BlinnPhongMaterial material;
  material.diffuseColor = diffuseColor.rgb;
  material.specularColor = specular;
  material.specularShininess = shininess;
  material.specularStrength = specularStrength;

  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
  	
 	float dotNL;
  vec3 irradiance;
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		// getDirectionalLightInfo( directionalLight, geometry, directLight );
		// directLight.color = directionalLight.color;
		// directLight.direction = directionalLight.direction;
		// directLight.visible = true;
  	dotNL = saturate( dot( geometry.normal, directionalLight.direction ) );
	  irradiance = dotNL * directionalLight.color;
	  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directionalLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
	}
	#pragma unroll_loop_end
#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif

#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif

#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular
#if HAS_EMISSIVE	 
	+ emissive
#endif	
	;
#ifdef OPAQUE
  diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
  diffuseColor.a *= transmissionAlpha + 0.1;
#endif
  gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	gl_FragColor = linearToOutputTexel( gl_FragColor );
#ifdef PREMULTIPLIED_ALPHA
	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif
}
`,Cie=`
#define PHONG
#define OUTPUT_FLAT_NORMAL 0

varying vec3 vViewPosition;

#include <common>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif

// Filament specific attributes
attribute vec3 aColor;
attribute vec3 aPos; // x,y,z
attribute vec2 aSize; // x = radius, y = height
uniform ivec4 splitPos;
uniform float opacity;
uniform vec3 diffuse;
const vec4 invisiblePos = vec4(-2.0, -2.0, 0.0, 1.0);
void makeInvisible() {
  gl_Position = invisiblePos;
}

void main() {
	// aColor = Filament color, color = material color
#if defined( USE_COLOR_ALPHA )
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
  makeInvisible();
  return; 
 }
	vColor = vec4( aColor, 1.0 );
#else // if defined( USE_COLOR )
#if IS_TRANSPARENT == 0
 if(gl_InstanceID < splitPos.x) {
   makeInvisible();
   return; 
 }
 if (gl_InstanceID < splitPos.y) {
  	vColor = diffuse; // color; 
  } else {
    vColor = aColor;
  }
#else  
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = aColor;
#endif 
#endif
  // Compute real vertex position
	vec3 transformed = (position.xyz * aSize.xxy) + aPos.xyz;
  vNormal = normalize( normalMatrix * normal );

  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
  gl_Position = projectionMatrix * mvPosition;
	vViewPosition = -mvPosition.xyz;
}
`,Eie=`
#define PHONG

uniform vec3 diffuse;
#if HAS_EMISSIVE
uniform vec3 emissive;
#endif
uniform vec3 specular;
uniform float shininess;
#if HAS_OPACITY	
uniform float opacity;
#endif

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;	
#endif
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

#include <bsdfs>
#include <lights_pars_begin>
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
varying vec3 vViewPosition;

struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)

// varying float vVisible;
// varying vec3 flatNormal;

void main() {
  /* if(vVisible < 1.0) {
    discard;
    return;
  } */
 //gl_FragColor = vec4( vColor.xyz, 1.0 );
 // return;
	// vec4 diffuseColor = vec4( diffuse, opacity );
#if HAS_OPACITY	
	vec4 diffuseColor = vec4( vColor.xyz, opacity );
#else
	vec4 diffuseColor = vec4( vColor.xyz, 1.0 );
#endif	
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

/*
#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif
*/
#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif
  float specularStrength = 1.0;
	// float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
	// bool frontFacing = dot(flatNormal, vViewPosition) > 0.0;
  /*if(!gl_FrontFacing) {
    discard;
    return;
  }*/

	// vec3 normal = normalize( flatNormal );
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
	  if(!gl_FrontFacing) {
		  normal = -normal;
		}
	#endif
#if 0
if (normal.z > 0.0) {
  // gl_FragColor = vec4( 0.0, vNormal.z, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( 0.0, normal.z, 0.0, 1.0 );
} else {
  // gl_FragColor = vec4( vNormal.z, 0.0, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( -normal.z, 0.0, 0.0, 1.0 );
}
return;
#endif
  // vec3 geometryNormal = normal; // unused variable  

	// accumulation
  BlinnPhongMaterial material;
  material.diffuseColor = diffuseColor.rgb;
  material.specularColor = specular;
  material.specularShininess = shininess;
  material.specularStrength = specularStrength;

  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
  	
 	float dotNL;
  vec3 irradiance;
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		// getDirectionalLightInfo( directionalLight, geometry, directLight );
		// directLight.color = directionalLight.color;
		// directLight.direction = directionalLight.direction;
		// directLight.visible = true;
  	dotNL = saturate( dot( geometry.normal, directionalLight.direction ) );
	  irradiance = dotNL * directionalLight.color;
	  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directionalLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
	}
	#pragma unroll_loop_end
#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif

#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif

#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular
#if HAS_EMISSIVE	 
	+ emissive
#endif	
	;
#ifdef OPAQUE
  diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
  diffuseColor.a *= transmissionAlpha + 0.1;
#endif
  gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	gl_FragColor = linearToOutputTexel( gl_FragColor );
#ifdef PREMULTIPLIED_ALPHA
	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif
}
`;function Mie(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}var pu=class extends ir{constructor(e){let i=e.sphereMaterial===!0;i&&delete e.sphereMaterial,super(),this.type="PhongShaderMaterial",this.defines={},this.uniforms={},i?(this.vertexShader=Cie,this.fragmentShader=Eie):(this.vertexShader=wie,this.fragmentShader=Sie),this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.color=new Ye(16777215),this.specular=new Ye(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dl,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Mie(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(let n in this.uniforms){let a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}};pu.prototype.isShaderMaterial=!0;var pi=!0,Tie=.7071068,y_=3*.7071068,Aie={menuId:!1,quality:3,show:0,transparentTop:!1,transparentBottom:!0,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,smoothNozzleMove:!1,live:!1},x_=pi?[{value:0,name:"<?php _('Low') ?>"},{value:1,name:"<?php _('Normal') ?>"},{value:2,name:"<?php _('High') ?>"}]:[{value:0,name:"<?php _('Lowest - Lines') ?>"},{value:1,name:"<?php _('Low - Faces') ?>"},{value:2,name:"<?php _('Medium - Rectangles') ?>"},{value:3,name:"<?php _('High - Ellipsis') ?>"},{value:4,name:"<?php _('Highest - HQ Ellipsis') ?>"}],ws=[{value:0,name:"<?php _('Extruder') ?>"},{value:1,name:"<?php _('Feature Type') ?>"},{value:2,name:"<?php _('Speed') ?>"},{value:3,name:"<?php _('Width') ?>"},{value:4,name:"<?php _('Height') ?>"}],ed=[{value:0,name:"<?php _('Unknown') ?>",color:"#ff0000"},{value:1,name:"<?php _('Perimeter') ?>",color:"#ffd540"},{value:2,name:"<?php _('External Perimeter') ?>",color:"#ff801a"},{value:3,name:"<?php _('Overhang Perimeter') ?>",color:"#0f49ff"},{value:4,name:"<?php _('Internal Infill') ?>",color:"#c75923"},{value:5,name:"<?php _('Solid Infill') ?>",color:"#bf00ff"},{value:6,name:"<?php _('Top Solid Infill') ?>",color:"#d93030"},{value:7,name:"<?php _('Bridge Infill') ?>",color:"#845ae8"},{value:8,name:"<?php _('Gap Fill') ?>",color:"#ffffff"},{value:9,name:"<?php _('Skirt') ?>",color:"#a9fcb4"},{value:10,name:"<?php _('Support Material') ?>",color:"#5eee48"},{value:11,name:"<?php _('Support Material Interface') ?>",color:"#6fa953"},{value:12,name:"<?php _('Wipe Tower') ?>",color:"#bceca2"},{value:13,name:"<?php _('Custom') ?>",color:"#469a42"},{value:14,name:"<?php _('Raft') ?>",color:"#46a5b7"},{value:15,name:"<?php _('Brim') ?>",color:"#a9fcb4"},{value:16,name:"<?php _('Ooze Shield') ?>",color:"#5fb77e"},{value:17,name:"<?php _('Bridge') ?>",color:"#5ba8e8"},{value:18,name:"<?php _('Internal Single Extrusion') ?>",color:"#caef8e"},{value:19,name:"<?php _('Ironing') ?>",color:"#fa9361"},{value:20,name:"<?php _('Mixed') ?>",color:"#8000ff"},{value:21,name:"<?php _('Set Next Chance') ?>",color:"#005B73"},{value:22,name:"<?php _('Bottom ') ?>",color:"#794419"},{value:23,name:"<?php _('Support Transition') ?>",color:"#3c4234"},{value:24,name:"<?php _('Internal Bridge') ?>",color:"#004773"}],mu=class{constructor(e,i){Kn(this,"_renderCallback",()=>{if(this.renderCallback&&this.renderCallback(),this.nozzleMoveList.length===0&&this.setNextLiveProgress(),this.nozzleMoveList.length){let e=performance.now(),i=.001*(e-this.lastMoveTime);for(;i>1e-4&&this.nozzleMoveList.length;){let r=this.nozzleMoveList[0],n=r.x-this.nozzle.position.x,o=r.y-this.nozzle.position.y,a=r.z-this.nozzle.position.z,h=Math.sqrt(n*n+o*o+a*a)/(r.f*(1+(this.nozzleMoveList.length+this.liveProgressBuffer.length-1)*.3));if(h<i){i-=h,this.nozzle.position.x=r.x,this.nozzle.position.y=r.y,this.nozzle.position.z=r.z,this.nozzleMoveList.shift(),this.nozzleMoveList.length===0&&this.setNextLiveProgress();continue}i=i/h,this.nozzle.position.x+=n*i,this.nozzle.position.y+=o*i,this.nozzle.position.z+=a*i,i=0}return this.lastMoveTime=e,!0}return this.forceRenderLoop});Kn(this,"updateView",()=>{this.view.refresh()});this.reader=null,this.container=e,this.quality=2,this.options=Mt({},Aie),this.numSpheres=0,this.setOptions(i),this.view=new qh(this.container,this.options.slug,this.options.rootScope,this.options.menuId,!1,this.model),this.view.renderer.shadowMap.enabled=!1,i.analyser.source==="project"?this.view.addProject(i.model):this.view.addPrinter(),this.view.addLights(),this.view.refresh(),this.excludeGroup=new Pr,this.gcodeGroup=new Pr,this.view.scene.add(this.gcodeGroup),this.view.sceneBed.add(this.excludeGroup),this.analysedLayerNumber=-1,this.filamentColors=["#d28614","#005B73","#59BDBE","#D0A766","#80ff00","#0000ff","#ff00ff","#0080ff","#0080ff","#005B73","#59BDBE","#D0A766","#d28614","#005B73","#59BDBE","#D0A766"],this.rainbowColors=["#ff0000","#ff8000","#0000ff","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff","#ff00ff","#0080ff"],this.seamColor="#ffffff",this.retractColor="#ff00ff",this.deretractColor="#00ffff",this.excludeColors=[12267302,12279591,12231720,9878056,2865704,2669227,2645946,4663482,9185466,12200059],this.materials=[],this.excludeMaterials=[],this.nozzle=null,this.liveLayer=0,this.crossMesh=null,this.renderCallback=null,this.forceRenderLoop=!1,this.liveComplete=!1,this.livePos={x:-99999,y:-99999},this.liveOffset={x:0,y:0,z:0},this.liveProgressBuffer=[],this.includedOffset={x:0,y:0,z:0},$(window).resize(this.updateView),this.view.addAxis(),gi.initialized.then(()=>{let r=gi.getGeometryHelper(),n=gi.getAxisMaterials(),o=this.view.tracker.add(n.nozzle.clone()),a=this.view.tracker.add(r.nozzle.clone());this.nozzle=new _t(a,o),this.nozzle.visible=!1,this.view.renderCallback=this._renderCallback,this.view.scene.add(this.nozzle),this.view.setChanged()}),this.featureHeadline="",this.features=[],this.roundFeatures=[],this.featureMap={},this.maxF=10,this.lastF=10,this.nozzleMoveList=[],this.lastMoveTime=performance.now()}$destroy(){$(window).off("resize",this.updateView),this.layerData=null,this.freeGCodeStorage(),this.deleteMaterials(),this.view.disconnect(),this.container.innerHTML="",this.container=null,delete this.layerIndices}updateExcludeRegions(){this.excludeGroup.clear();let e=this.options.rootScope.RSPrinter.excludeRegions,i=this.analyser.layerInfo?this.analyser.layerInfo.layers[this.analyser.layerInfo.layers.length-1].h+1:50;this.excludeMaterials.length===0&&this.createMaterials();for(let r=0;r<e.length;r++){let n=e[r],o=new rs(n.xmax-n.xmin,n.ymax-n.ymin,i),a=new _t(o,this.excludeMaterials[r%this.excludeMaterials.length]);a.position.x=n.xmin+.5*(n.xmax-n.xmin),a.position.y=n.ymin+.5*(n.ymax-n.ymin),a.position.z=.15+this.options.rootScope.activeConfig.movement.zMin+.5*i,this.excludeGroup.add(a)}this.view.setChanged()}pushNozzleMove(e){this.nozzleMoveList.length===0&&(this.lastMoveTime=performance.now()),this.nozzleMoveList.push(e),this.nozzle&&(this.nozzle.visible=!0),this.view.setChanged()}createCross(){if(this.crossMesh)return;let e=[-1e3,0,0,1e3,0,0,0,-1e3,0,0,1e3,0],i=[0,1,2,3];this.crossGeom=new pt,this.crossGeom.setIndex(i),this.crossGeom.setAttribute("position",new kt(e,3)),this.crossMesh=new Zr(this.crossGeom,this.materials[14]),this.crossMesh.renderOrder=2e3,this.view.scene2.add(this.crossMesh),this.view.tracker.add(this.crossMesh)}drawCross(e){this.createCross(),this.crossMesh.position.x=e.x,this.crossMesh.position.y=e.y,this.crossMesh.position.z=this.options.rootScope.activeConfig.movement.zMin,this.crossMesh.needsUpdate=!0,this.view.setChanged()}hideCross(){this.crossMesh&&(this.view.scene2.remove(this.crossMesh),this.crossGeom.dispose(),this.view.tracker.remove(this.crossMesh),this.crossMesh=null,this.crossGeom=null,this.view.setChanged())}drawSelectionBox(e,i){if(!this.selectionBox){let r=new rs(1,1,1),n=new ki({color:16711680});this.selectionBox=new _t(r,n),this.view.scene.add(this.selectionBox),this.view.tracker.add(this.selectionBox),this.view.tracker.add(n),this.view.tracker.add(r)}this.selectionBox.visible=!0,this.selectionBox.position.x=.5*(e.x+i.x),this.selectionBox.position.y=.5*(e.y+i.y),this.selectionBox.position.z=.5*(e.z+i.z),this.selectionBox.scale.x=Math.abs(e.x-i.x),this.selectionBox.scale.y=Math.abs(e.y-i.y),this.selectionBox.scale.z=Math.abs(e.z-i.z),this.selectionBox.needsUpdate=!0}hideSelectionBox(){this.selectionBox&&(this.selectionBox.visible=!1,this.selectionBox.needsUpdate=!0)}setOptions(e){this.options=Mt(Mt({},this.options),e),this.analyser=this.options.analyser,this.quality=this.options.quality,this.model=this.options.model}addFeature(e,i){if(e===void 0||i===void 0){console.log("illegal feature id");return}i===0&&this.options.show>=3||(this.featureMap[e]?this.featureMap[e].count++:this.featureMap[e]={id:e,value:parseFloat(""+e),count:1,index:-1})}sortedFeatureMapByValue(){let e=Object.values(this.featureMap);return e.sort((i,r)=>i.value>r.value?1:r.value>i.value?-1:0),e}buildFeatureList(){let e=Object.values(this.featureMap).length,i=this.sortedFeatureMapByValue();switch(i.length===0&&i.push({id:"0",value:0,count:1,index:0}),this.roundFeatures=[],this.options.showSeams&&this.roundFeatures.push({color:this.seamColor,name:"<?php _('Seams') ?>"}),this.options.showRetractions&&this.roundFeatures.push({color:this.retractColor,name:"<?php _('Retractions') ?>"}),this.options.showDeretractions&&this.roundFeatures.push({color:this.deretractColor,name:"<?php _('Deretractions') ?>"}),this.features=i,this.options.show){case 0:this.featureInterpolate=!1,i.forEach(r=>{r.color=this.filamentColors[r.value%this.filamentColors.length],r.name="<?php _('Extruder') ?> "+(r.value+1)});break;case 1:this.featureInterpolate=!1,i.forEach(r=>{r.color=ed[r.value].color,r.name=ed[r.value].name});break;case 2:if(e<=this.rainbowColors.length)this.featureInterpolate=!1,i.forEach((r,n)=>{r.color=this.rainbowColors[n],r.name=r.id+" mm/s"});else{let r=[],n=i[0].value,o=i[e-1].value,a=this.rainbowColors.length,l=(o-n)/(a-1);for(let h=0;h<a;h++){let u=n+h*l;r.push({name:u.toFixed(0)+" mm/s",value:u,color:this.rainbowColors[h]})}this.features=r,this.featureInterpolate=!0}console.log("speed list",this.features);break;case 3:case 4:if(e<=this.rainbowColors.length)this.featureInterpolate=!1,i.forEach((r,n)=>{r.color=this.rainbowColors[n],r.name=r.id+" \xB5m"});else{let r=[],n=i[0].value,o=i[e-1].value,a=this.rainbowColors.length,l=(o-n)/(a-1);for(let h=0;h<a;h++){let u=n+h*l;r.push({name:u.toFixed(0)+" \xB5m",value:u,color:this.rainbowColors[h]})}this.features=r,this.featureInterpolate=!0}break}}setColorForFeatureValue(e){if(this.featureInterpolate){this.activeColor=16711680;let i=this.features.length;if(i===0)return;let r=Math.floor((i-1)*(e-this.features[0].value)/(this.features[i-1].value-this.features[0].value));r===i-1?r=i-2:r<i-1&&this.features[r+1].value<e&&r++;let n=r+1;if(r<0){this.activeColor=parseInt(this.features[0].color.replace("#","0x"));return}let o=parseInt(this.features[r].color.replace("#","0x")),a=parseInt(this.features[n].color.replace("#","0x")),l=(e-this.features[r].value)/(this.features[n].value-this.features[r].value),h=1-l,u=Math.round(l*(o>>16&255)+h*(a>>16&255)),c=Math.round(l*(o>>8&255)+h*(a>>8&255)),f=Math.round(l*(o&255)+h*(a&255));this.activeColor=(u<<16)+(c<<8)+f}else{let i=1e20;this.features.forEach(r=>{let n=Math.abs(e-r.value);n<i&&(i=n,this.activeColor=parseInt(r.color.replace("#","0x")))})}}deleteMaterials(){this.materials.forEach(e=>{e&&e.dispose()}),this.materials=[],this.excludeMaterials.forEach(e=>{e&&e.dispose()}),this.excludeMaterials=[]}createSphereMaterial(e,i){let r=qu.merge([Tr.phong.uniforms,{splitPos:new rc(new Int32Array(4))}]);return new pu({uniforms:r,lights:!0,name:"sphere-material",vertexColors:!1,side:i?qt:xi,opacity:i?.02:1,transparent:i,depthWrite:!i,flatShading:!1,color:new Ye(e?parseInt(e.replace("#","0x")):13619151),specular:new Ye(2631720),emissive:0,shininess:70,defines:{IS_TRANSPARENT:i?1:0,HAS_EMISSIVE:0,HAS_OPACITY:i?1:0},sphereMaterial:!0})}createFilamentMaterial(e,i,r){if(pi){let n=qu.merge([Tr.phong.uniforms,{splitPos:new rc(new Int32Array(4))}]),o=new pu({uniforms:n,lights:!0,name:"filament-material",vertexColors:!1,side:i?qt:xi,opacity:i?.02:1,transparent:i,depthWrite:!i,flatShading:!1,color:new Ye(e?parseInt(e.replace("#","0x")):13619151),specular:new Ye(2631720),emissive:0,shininess:70,defines:{IS_TRANSPARENT:i?1:0,HAS_EMISSIVE:0,HAS_OPACITY:i?1:0}});return r===!0?o.vertexShader=o.vertexShader.replaceAll("FIL_NO_ENDCAPS","1"):o.vertexShader=o.vertexShader.replaceAll("FIL_NO_ENDCAPS","0"),o}else return this.quality>0?new ir({color:e?parseInt(e.replace("#","0x")):13619151,emissive:2105376,specular:1118481,shininess:50,side:this.quality<2?qt:xi,flatShading:this.quality<3,vertexColors:!0,opacity:i?.05:1,transparent:i}):new Mi({color:e?parseInt(e.replace("#","0x")):0,linewidth:1,vertexColors:!e})}createMaterials(){this.deleteMaterials(),this.materials.push(new Mi({color:16711935,linewidth:1})),this.materials.push(new ki({color:16711680,side:qt})),this.materials.push(new ki({color:255,side:qt})),this.quality>0?(this.materials.push(new ir({color:5592405,specular:1118481,shininess:50,side:qt,flatShading:!pi&&this.quality<3})),this.materials.push(new ir({color:5592405,specular:1118481,shininess:50,opacity:.05,transparent:!0,side:qt,flatShading:this.quality<3})),this.materials.push(new ir({color:5592405,specular:1118481,shininess:50,opacity:.05,transparent:!0,side:qt,flatShading:this.quality<3,vertexColors:!0}))):(this.materials.push(new Mi({color:5592405,linewidth:2})),this.materials.push(new Mi({color:5592405,linewidth:2,opacity:.5,transparent:!0})),this.materials.push(new Mi({color:5592405,linewidth:2,opacity:.1,transparent:!0,vertexColors:!0}))),this.materials.push(this.createFilamentMaterial(!1,!1,!1)),this.materials.push(this.createFilamentMaterial(!1,!1,!0)),this.materials.push(this.createFilamentMaterial("#555555",!1,!1)),this.materials.push(this.createFilamentMaterial("#555555",!1,!0)),this.materials.push(this.createFilamentMaterial(!1,!0,!1)),this.materials.push(this.createFilamentMaterial(!1,!0,!0)),this.materials.push(this.createSphereMaterial("#555555",!1)),this.materials.push(this.createSphereMaterial("#555555",!0)),this.materials.push(new Mi({color:49152,depthTest:Ss}));for(let e=0;e<this.excludeColors.length;e++)this.excludeMaterials.push(new ir({color:this.excludeColors[e],opacity:.6,transparent:!0,side:qt,depthWrite:!1,specular:1118481,shininess:50}))}includeXY(e,i){this.analysis.xMin=Math.min(this.analysis.xMin,e),this.analysis.xMax=Math.max(this.analysis.xMax,e),this.analysis.yMin=Math.min(this.analysis.yMin,i),this.analysis.yMax=Math.max(this.analysis.yMax,i)}computeMemoryForBlock(e){if(e.t===2){let i=e.m.length;return i<2?{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0}:{points:i,lines:0,triangles:0,lineTravel:i-1,filEnd:0,fil:0,spheres:0}}if(e.t===3&&!this.hideGCode){let i=e.m.length;if(i<2)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0};if(pi){let r=0;this.options.showSeams&&this.lastFeature===2&&(r=2);let n=e.m.length-2,o=0;for(let a=0;a<=n;a++){let l=Math.atan2(e.m[a+1].y-e.m[a].y,e.m[a+1].x-e.m[a].x);if(a){let h=this.angleFromTo(o,l);Math.abs(h)>=y_&&i++}o=l}return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:i>=3?2:1,fil:i>3?i-3:0,spheres:r}}else switch(this.quality){case 0:return{points:i,lines:i-1,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0};case 1:return{points:2*i,lines:0,triangles:(i-1)*2,lineTravel:0,filEnd:0,fil:0,spheres:0};case 2:return{points:4*i,lines:0,triangles:(i-1)*8+4,lineTravel:0,filEnd:0,fil:0,spheres:0};case 3:return{points:4*(2*i-2)+2,lines:0,triangles:(i-1)*8+8,lineTravel:0,filEnd:0,fil:0,spheres:0};case 4:return{points:8*(2*i-2)+2,lines:0,triangles:(i-1)*16+16,lineTravel:0,filEnd:0,fil:0,spheres:0}}}if(e.t===10)this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4,this.options.show===1&&this.addFeature(""+e.ft,e.ft);else if(e.t===1)this.options.show===0&&this.addFeature(e.e,e.e),this.options.show===2&&this.addFeature((e.s/60).toFixed(1),e.s/60),this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0)));else if(e.t===4){if(this.options.showRetractions)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1}}else if(e.t===5){if(this.options.showDeretractions)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1}}else e.t===6?(this.maxF=Math.max(this.maxF,e.s/60),this.options.show===2&&this.addFeature((e.s/60).toFixed(1),e.s/60)):e.t===8?this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0))):e.t===11?(this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0))),this.options.show===4&&this.addFeature(""+(1e3*e.h).toFixed(0),parseFloat((e.h*1e3).toFixed(0)))):e.t===7&&this.options.show===0&&this.addFeature(""+e.e,e.e);return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0}}appendDetailedMemoryForBlock(e,i){if(e.t===2){let r=e.m.length;if(r<2)return;i.push({x:e.m[1].x,y:e.m[1].y,f:this.lastF,points:3*2,lines:0,triangles:0,lineTravel:2,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});for(let n=2;n<r;n++)i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*2,lines:0,triangles:0,lineTravel:2,filEnd:0,fil:0,spheres:0,offset:this.includedOffset})}else if(e.t===3&&!this.hideGCode){let r=e.m.length;if(r<2)return;if(pi){let n=this.options.showSeams&&this.lastFeature===2?1:0,o=e.m.length-2,a=0,l;for(let h=0;h<=o;h++){let u=Math.atan2(e.m[h+1].y-e.m[h].y,e.m[h+1].x-e.m[h].x),c=0;h&&(l=this.angleFromTo(a,u),Math.abs(l)>=y_&&(c=1));let f=h===0||h===o;i.push({x:e.m[h+1].x,y:e.m[h+1].y,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:f?1:0,fil:f?c:1+c,spheres:n*((h===0?1:0)+(h===o?1:0)),offset:this.includedOffset}),a=u}}else for(let n=1;n<r;n++){let o=n===1,a=n===r-1;switch(this.quality){case 0:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(1+(o?1:0)),lines:2,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 1:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(2+(o?2:0)),lines:0,triangles:3*2,lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 2:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(4+(o?4:0)),lines:0,triangles:3*(8+(o?2:0)+(a?2:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 3:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(8+(o?1:0)+(a?1:0)),lines:0,triangles:3*(8+(o?4:0)+(a?4:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 4:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(16+(o?1:0)+(a?1:0)),lines:0,triangles:3*(16+(o?8:0)+(a?8:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break}}}else if(e.t===10)this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4;else if(e.t===4){if(this.options.showRetractions){let r=i.length>0?i[i.length-1]:void 0;i.push({x:r?r.x:0,y:r?r.y:0,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1,offset:this.includedOffset})}}else if(e.t===5){if(this.options.showDeretractions){let r=i.length>0?i[i.length-1]:void 0;i.push({x:r?r.x:0,y:r?r.y:0,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1,offset:this.includedOffset})}}else e.t===1?this.lastF=e.s/60:e.t===6?this.lastF=e.s/60:e.t===12&&(this.includedOffset=e)}pushLayerIndex(){this.layerIndices.push({points:this.pointArrayPos,triangles:this.geomTrianglePos,lines:this.geomLinePos,lineTravel:this.geomTravelPos,filEnd:pi?this.aPosEnd:0,fil:pi?this.aPos:0,spheres:this.numSpheres})}normalize(e){let i=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);i>0&&(e.x/=i,e.y/=i,e.z/=i)}prepareExtrusionConstants(){if(!pi){switch(this.quality){case 0:this.numVerticesCircumsphere=1;break;case 1:this.numVerticesCircumsphere=2;break;case 2:case 3:this.numVerticesCircumsphere=4;break;case 4:this.numVerticesCircumsphere=8;break}if(this.dh=.5*this.height,this.dw=.5*this.width,this.angles=[],this.quality===1)this.angles.push(0),this.angles.push(Math.PI);else if(this.quality===2){let e=Math.atan(this.dh/this.dw);this.angles.push(e),this.angles.push(Math.PI-e),this.angles.push(Math.PI+e),this.angles.push(-e)}else{let e=Math.PI*2/this.numVerticesCircumsphere;for(let i=0;i<this.numVerticesCircumsphere;i++)this.angles.push(i*e)}this.rad=this.quality===1?this.dw:Math.sqrt(this.dh*this.dh+this.dw*this.dw)}}angleFromTo(e,i){let r=i-e;for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return r}drawExtrusion(e){if(!(e.m.length<2||this.hideGCode))if(pi){let i=this.aPos*3,r=i,n=this.aPosEnd*3,o=n,a=null,l=null,h=null,u=null,c,f=0,d=e.m.length-2,m=this.options.showSeams&&this.lastFeature===2?1:0;for(let p=0;p<=d;p++){let v=p===0,g=p===d;a=h,h={x:e.m[p].x,y:e.m[p].y,z:this.z-.5*this.height},l={x:e.m[p+1].x,y:e.m[p+1].y,z:this.z-.5*this.height},c={x:l.x-h.x,y:l.y-h.y,z:l.z-h.z};let _=Math.atan2(c.y,c.x),x=0,b=0,y=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);if(this.normalize(c),!v){let S=this.angleFromTo(f,_);if(Math.abs(S)<y_)x=Math.tan(.5*S)*this.width/y;else{x=Math.tan(.25*S)*this.width/y;let w=f+.5*S;this.aPosArray[r]=h.x,this.aPosArray[r+1]=h.y,this.aPosArray[r+2]=h.z-.5*this.height,this.aSizeArray[r]=1*this.width,this.aSizeArray[r+1]=this.height,this.aSizeArray[r+2]=.01,this.aRot[r]=x*y/.01,this.aRot[r+1]=-x*y/.01,this.aRot[r+2]=w,r+=3,this.aPos++}}if(!g){let S=Math.atan2(e.m[p+2].y-l.y,e.m[p+2].x-l.x),w=this.angleFromTo(_,S);Math.abs(w)<y_?b=-Math.tan(.5*w)*this.width/y:b=-Math.tan(.25*w)*this.width/y}g||v?(g&&(this.lastPos=l),m&&(v&&this.addSphere(Qs(Mt({},h),{z:this.z-.5*this.height}),this.width*1.3,this.seamColor),g&&this.addSphere(this.lastPos,this.width*1.3,this.seamColor)),this.aPosArrayEnd[o]=h.x,this.aPosArrayEnd[o+1]=h.y,this.aPosArrayEnd[o+2]=h.z,this.aSizeArrayEnd[o]=1*(v?-this.width:this.width),this.aSizeArrayEnd[o+1]=g?-this.height:this.height,this.aSizeArrayEnd[o+2]=y,this.aRotEnd[o]=x,this.aRotEnd[o+1]=b,this.aRotEnd[o+2]=_,o+=3,this.aPosEnd++):(this.aPosArray[r]=h.x,this.aPosArray[r+1]=h.y,this.aPosArray[r+2]=h.z,this.aSizeArray[r]=1*(v?-this.width:this.width),this.aSizeArray[r+1]=g?-this.height:this.height,this.aSizeArray[r+2]=y,this.aRot[r]=x,this.aRot[r+1]=b,this.aRot[r+2]=_,r+=3,this.aPos++),u=c,f=_}for(;i<r;)this.aColor[i++]=this.activeColor>>16&255,this.aColor[i++]=this.activeColor>>8&255,this.aColor[i++]=this.activeColor&255;for(;n<o;)this.aColorEnd[n++]=this.activeColor>>16&255,this.aColorEnd[n++]=this.activeColor>>8&255,this.aColorEnd[n++]=this.activeColor&255}else{let i=this.numVerticesCircumsphere,r=this.pointArrayPos;if(this.quality>0){let o,a=this.quality>=3,l={x:0,y:0,z:1},h,u,c,f=3*i,d=this.pointArrayPos,m=this.pointArrayPos+(a?3:0)+f*(this.quality>=3?2*e.m.length-2:e.m.length);a&&(this.pointArrayPos+=3);let p=null,v=null,g=null,_=null,x=null,b;for(let y=0;y<e.m.length;y++){let S=y===0,w=y===e.m.length-1;if(p=g,g={x:e.m[y].x,y:e.m[y].y,z:this.z},y<e.m.length-1?v={x:e.m[y+1].x,y:e.m[y+1].y,z:this.z}:v=null,_=x,v&&(x={x:v.x-g.x,y:v.y-g.y,z:0},this.normalize(x)),S){if(a){this.pointArray[d]=g.x-x.x*this.dw,this.pointArray[d+1]=g.y-x.y*this.dw,this.pointArray[d+2]=g.z-this.dh,this.normalArray[d]=-x.x,this.normalArray[d+1]=-x.y,this.normalArray[d+2]=-x.z;let R=this.pointArrayPos/3;for(let k=0;k<i;k++)this.geomIndices[this.geomTrianglePos++]=d/3,this.geomIndices[this.geomTrianglePos++]=R+k,this.geomIndices[this.geomTrianglePos++]=R+(k+1)%i}else if(this.quality===2){let R=this.pointArrayPos/3;this.geomIndices[this.geomTrianglePos++]=R,this.geomIndices[this.geomTrianglePos++]=R+1,this.geomIndices[this.geomTrianglePos++]=R+2,this.geomIndices[this.geomTrianglePos++]=R,this.geomIndices[this.geomTrianglePos++]=R+2,this.geomIndices[this.geomTrianglePos++]=R+3}}if(w){if(a){this.pointArray[m]=g.x+_.x*this.width*.5,this.pointArray[m+1]=g.y+_.y*this.width*.5,this.pointArray[m+2]=g.z-this.height*.5,this.normalArray&&(this.normalArray[m]=_.x,this.normalArray[m+1]=_.y,this.normalArray[m+2]=_.z);let R=this.pointArrayPos/3;for(let k=0;k<i;k++)this.geomIndices[this.geomTrianglePos++]=R+k,this.geomIndices[this.geomTrianglePos++]=m/3,this.geomIndices[this.geomTrianglePos++]=R+(k+1)%i}else if(this.quality===2){let R=this.pointArrayPos/3;this.geomIndices[this.geomTrianglePos++]=R+1,this.geomIndices[this.geomTrianglePos++]=R,this.geomIndices[this.geomTrianglePos++]=R+2,this.geomIndices[this.geomTrianglePos++]=R+2,this.geomIndices[this.geomTrianglePos++]=R,this.geomIndices[this.geomTrianglePos++]=R+3}}_?(b={x:_.x+x.x,y:_.y+x.y,z:0},this.normalize(b)):b=Mt({},x);let M=b.x*x.x+b.y*x.y,C=M<Tie;M=1/(M>1?1:M<.3?.3:M);let E={x:-b.y,y:b.x,z:b.z},P={x:-x.y,y:x.x,z:x.z},A=this.pointArrayPos/3+(S?0:a?i:0);for(let R=0;R<i;R++){o=this.angles[R],a?(h=-Math.sin(o)*this.dh,c=Math.cos(o)*this.dw,u=c*M):(h=-Math.sin(o)*this.rad,c=Math.cos(o)*this.rad,u=c*M);let k={x:c*P.x+h*l.x,y:c*P.y+h*l.y,z:c*P.z+h*l.z};this.normalize(k),this.pointArray[this.pointArrayPos]=g.x+u*E.x+h*l.x,this.pointArray[this.pointArrayPos+1]=g.y+u*E.y+h*l.y,this.pointArray[this.pointArrayPos+2]=g.z-this.dh+u*E.z+h*l.z,!S&&!w&&a&&(this.pointArray[this.pointArrayPos+f]=this.pointArray[this.pointArrayPos],this.pointArray[this.pointArrayPos+f+1]=this.pointArray[this.pointArrayPos+1],this.pointArray[this.pointArrayPos+f+2]=this.pointArray[this.pointArrayPos+2]),this.normalArray&&(S?(this.normalArray[this.pointArrayPos]=k.x,this.normalArray[this.pointArrayPos+1]=k.y,this.normalArray[this.pointArrayPos+2]=k.z,this.normalArray[this.pointArrayPos+f]=this.normalArray[this.pointArrayPos],this.normalArray[this.pointArrayPos+f+1]=this.normalArray[this.pointArrayPos+1],this.normalArray[this.pointArrayPos+f+2]=this.normalArray[this.pointArrayPos+2]):w||(this.normalArray[this.pointArrayPos+f]=k.x,this.normalArray[this.pointArrayPos+f+1]=k.y,this.normalArray[this.pointArrayPos+f+2]=k.z,this.normalArray[this.pointArrayPos+f+f]=this.normalArray[this.pointArrayPos+f],this.normalArray[this.pointArrayPos+f+f+1]=this.normalArray[this.pointArrayPos+f+1],this.normalArray[this.pointArrayPos+f+f+2]=this.normalArray[this.pointArrayPos+f+2])),!w&&(this.quality!==1||R===0)&&(this.geomIndices[this.geomTrianglePos++]=A+(R+1)%i,this.geomIndices[this.geomTrianglePos++]=A+R,this.geomIndices[this.geomTrianglePos++]=A+R+i,this.geomIndices[this.geomTrianglePos++]=A+(R+1)%i+i,this.geomIndices[this.geomTrianglePos++]=A+(R+1)%i,this.geomIndices[this.geomTrianglePos++]=A+R+i),this.pointArrayPos+=3}!S&&!w&&a&&(this.pointArrayPos+=f)}a&&(this.pointArrayPos=m+3)}else for(let o=0;o<e.m.length;o++)this.pointArray[this.pointArrayPos]=e.m[o].x,this.pointArray[this.pointArrayPos+1]=e.m[o].y,this.pointArray[this.pointArrayPos+2]=this.z,o>0&&(this.geomIndices[this.geomLinePos]=this.pointArrayPos/3-1,this.geomIndices[this.geomLinePos+1]=this.pointArrayPos/3,this.geomLinePos+=2),this.pointArrayPos+=3;let n=this.pointArrayPos;for(;r<n;)this.geomColor[r++]=this.activeColor>>16&255,this.geomColor[r++]=this.activeColor>>8&255,this.geomColor[r++]=this.activeColor&255}}drawBlock(e){switch(e.t){case 1:e.w>0&&e.w!==this.width&&(this.width=e.w,this.prepareExtrusionConstants(),this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3))),this.options.show===0&&this.setColorForFeatureValue(e.e);break;case 2:if(e.m.length>=2){let i=e.m.length-1;for(let r=0;r<=i;r++)this.pointArray[this.pointArrayPos]=e.m[r].x,this.pointArray[this.pointArrayPos+1]=e.m[r].y,this.pointArray[this.pointArrayPos+2]=this.z,this.normalArray&&(this.normalArray[this.pointArrayPos]=0,this.normalArray[this.pointArrayPos+1]=0,this.normalArray[this.pointArrayPos+2]=1),r>0&&(this.geomIndices[this.geomTravelPos]=this.pointArrayPos/3-1,this.geomIndices[this.geomTravelPos+1]=this.pointArrayPos/3,this.geomTravelPos+=2),this.pointArrayPos+=3;this.lastPos={x:e.m[i].x,y:e.m[i].y,z:this.z-.5*this.height}}break;case 3:this.drawExtrusion(e);break;case 4:this.options.showRetractions&&this.addSphere(this.lastPos,this.width*1.3,this.retractColor);break;case 5:this.options.showDeretractions&&this.addSphere(this.lastPos,this.width*1.3,this.deretractColor);break;case 6:this.options.show===2&&this.setColorForFeatureValue(e.s/60);break;case 7:this.options.show===0&&this.setColorForFeatureValue(e.e);break;case 8:e.w>0&&this.width!==e.w&&(this.width=e.w,this.prepareExtrusionConstants(),this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3)));break;case 9:this.filamentColors[e.e%this.filamentColors.length]=e.color;break;case 10:this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4,this.options.show===1&&this.setColorForFeatureValue(e.ft);break;case 11:e.w>0&&(this.width=e.w),this.lastPos.z+=.5*this.height-.5*e.h,this.height=e.h,this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3)),this.options.show===4&&this.setColorForFeatureValue(Math.round(e.h*1e3)),this.prepareExtrusionConstants();break}}freeGCodeStorage(){this.crossMesh&&(this.view.scene2.remove(this.crossMesh),this.crossGeom.dispose(),this.view.tracker.remove(this.crossMesh),this.crossMesh=null),this.extrudeMesh&&(this.gcodeGroup.remove(this.extrudeMesh),this.extrudeMesh=null,this.gcodeGroup.remove(this.extrudeMeshEnd),this.extrudeMeshEnd=null,this.extrudeGeometry.dispose(),this.extrudeGeometry=null,this.extrudeGeometryEnd.dispose(),this.extrudeGeometryEnd=null,this.basicGeometry.dispose(),this.basicGeometry=null,this.basicNormals=null,this.basicTriangleNormals=null,this.basicPoints=null,this.basicPointBuffer=null,this.basicNormalBuffer=null,this.basicTriangleNormalsBuffer=null,this.aPosArray=null,this.aSizeArray=null,this.aColor=null,this.aRot=null,this.aPosArrayEnd=null,this.aSizeArrayEnd=null,this.aColorEnd=null,this.aRotEnd=null),this.sphereMesh&&(this.gcodeGroup.remove(this.sphereMesh),this.sphereMesh=null,this.sphereGeometry.dispose(),this.sphereGeometry=null,this.basicSphereGeometry.dispose(),this.basicSphereGeometry=null,this.basicSphereNormals=null,this.basicSphereTriangleNormals=null,this.basicSpherePoints=null,this.basicSpherePointBuffer=null,this.basicSphereNormalBuffer=null,this.basicSphereTriangleNormalsBuffer=null,this.aPosSphere=null,this.aSizeSphere=null,this.aColorSphere=null),this.gcodeMesh&&(this.gcodeGroup.remove(this.gcodeMesh),this.gcodeMesh=null),this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGeometry&&this.gcodeGeometry.dispose(),this.pointBuffer&&(this.pointBuffer=null),this.normalBuffer&&(this.normalBuffer=null),this.geomBuffer&&(this.geomBuffer=null),this.colorBuffer&&(this.colorBuffer=null),this.pointArray=null,this.geomColor=null,this.geomIndices=null,this.normalArray=null}createBasicGeometry(){let e=this.quality,i=e>1?8:4,r=3*(e===0?12:4*i),n=r*3,o=this.basicPoints=new Float32Array(n),a=this.basicNormals=new Float32Array(n),l=this.basicTriangles=new Uint32Array(r),h=this.basicTriangleNormals=new Float32Array(n),u=0,c=new j,f=new j,d=new j,m=new j,p=new j,v=new j,g=new j,_=new j;function x(P,A,R){l[b++]=u/3,o[u]=P.x,a[u]=A.x,h[u++]=R.x,o[u]=P.y,a[u]=A.y,h[u++]=R.y,o[u]=P.z,a[u]=A.z,h[u++]=R.z}let b=0,y=e===0?Math.PI*.25:0,S=Math.PI*2/i,w=e===0?.5*Math.sqrt(2):.5,M=[new j(0,0,1),new j(0,-1,0),new j(0,0,-1),new j(0,-1,0)];function C(P,A,R,k,I){let L=Math.cos(P),T=Math.sin(P);R.x=A,R.y=w*L,R.z=w*T,e===0?(k.copy(M[I]),k.addScaledVector(new j(0,L,T),.2),k.normalize()):(k.x=0,k.y=L,k.z=T)}function E(){m.subVectors(d,f),_.subVectors(c,f),m.cross(_);let P=m.lengthSq();m.multiplyScalar(-1/Math.sqrt(P)),x(f,v,m),x(c,p,m),x(d,g,m)}if(e===0)c.set(-1,-.5,.5),f.set(-1,.5,.5),d.set(-1,-.5,-.5),p.set(-1,0,0),v.set(-1,0,0),g.set(-1,0,0),E(),c.set(-1,-.5,-.5),f.set(-1,.5,.5),d.set(-1,.5,-.5),p.set(-1,0,0),v.set(-1,0,0),g.set(-1,0,0),E();else for(let P=0;P<i;P++)c.set(-1.5,0,0),p.set(-1,0,0),C(y+(P+1)*S,-1,d,g),C(y+P*S,-1,f,v),E();if(e===0)c.set(-1,.5,.5),f.set(-1,-.5,.5),d.set(-1,-.5,-.5),p.set(1,0,0),v.set(1,0,0),g.set(1,0,0),E(),c.set(-1,.5,.5),f.set(-1,-.5,-.5),d.set(-1,.5,-.5),p.set(1,0,0),v.set(1,0,0),g.set(1,0,0),E();else for(let P=0;P<i;P++)C(y+(P+1)*S,2,d,g),C(y+P*S,2,c,p),f.set(2.5,0,0),v.set(1,0,0),E();this.basicCircStart=b;for(let P=0;P<i;P++)C(y+P*S,0,f,v,P),C(y+(P+1)*S,0,c,p,P),C(y+P*S,1,d,g,P),E(),C(y+(P+1)*S,0,f,v,P),C(y+(P+1)*S,1,c,p,P),C(y+P*S,1,d,g,P),E();this.basicCircEnd=b,this.basicGeometry=new pt,this.basicPointBuffer=new vt(this.basicPoints,3,!1),this.basicPointBuffer.name="Basic Points",this.basicNormalBuffer=new vt(this.basicNormals,3,!1),this.basicNormalBuffer.name="Basic normals",this.basicTriangleBuffer=new vt(this.basicTriangles,1,!1),this.basicTriangleBuffer.name="Basic triangles",this.basicTriangleNormalsBuffer=new vt(this.basicTriangleNormals,3,!1),this.basicTriangleNormalsBuffer.name="Basic triangles flat normals",this.basicGeometry.setAttribute("position",this.basicPointBuffer),this.basicGeometry.setAttribute("normal",this.basicNormalBuffer),this.basicGeometry.setAttribute("face_normal",this.basicTriangleNormalsBuffer),this.basicGeometry.setIndex(this.basicTriangleBuffer),this.basicGeometry.setDrawRange(0,r)}createBasicSphereGeometry(){let n=this.basicSpherePoints=new Float32Array(144),o=this.basicSphereNormals=new Float32Array(144),a=this.basicSphereTriangles=new Uint32Array(48),l=this.basicSphereTriangleNormals=new Float32Array(144),h=0,u=new j,c=new j,f=new j,d=new j,m=new j,p=new j,v=0,g=0,_=Math.PI*2/8;function x(S,w){a[v++]=h/3,n[h]=S.x,o[h]=w.x,l[h++]=w.x,n[h]=S.y,o[h]=w.y,l[h++]=w.y,n[h]=S.z,o[h]=w.z,l[h++]=w.z}function b(S,w,M){let C=Math.cos(S),E=Math.sin(S);w.x=C*.5,w.y=E*.5,w.z=0,M.x=C,M.y=E,M.z=0}function y(){x(u,d),x(c,m),x(f,p)}for(let S=0;S<8;S++)u.set(0,0,.5),d.set(0,0,1),b(g+(S+1)*_,f,p),b(g+S*_,c,m),y();for(let S=0;S<8;S++)b(g+(S+1)*_,f,p),b(g+S*_,u,d),c.set(0,0,-.5),m.set(0,0,-1),y();this.basicSphereGeometry=new pt,this.basicSpherePointBuffer=new vt(this.basicSpherePoints,3,!1),this.basicSpherePointBuffer.name="Basic Points",this.basicSphereNormalBuffer=new vt(this.basicSphereNormals,3,!1),this.basicSphereNormalBuffer.name="Basic normals",this.basicSphereTriangleBuffer=new vt(this.basicSphereTriangles,1,!1),this.basicSphereTriangleBuffer.name="Basic triangles",this.basicSphereTriangleNormalsBuffer=new vt(this.basicSphereTriangleNormals,3,!1),this.basicSphereTriangleNormalsBuffer.name="Basic triangles flat normals",this.basicSphereGeometry.setAttribute("position",this.basicSpherePointBuffer),this.basicSphereGeometry.setAttribute("normal",this.basicSphereNormalBuffer),this.basicSphereGeometry.setAttribute("face_normal",this.basicSphereTriangleNormalsBuffer),this.basicSphereGeometry.setIndex(this.basicSphereTriangleBuffer),this.basicSphereGeometry.setDrawRange(0,48)}addSphere(e,i,r){let n=this.numSpheres*3;this.aPosSphere[n++]=e.x,this.aPosSphere[n++]=e.y,this.aPosSphere[n++]=e.z,n=this.numSpheres*2,r===this.seamColor?(this.aSizeSphere[n++]=i*1.15,this.aSizeSphere[n]=this.height*1.1):(this.aSizeSphere[n++]=i,this.aSizeSphere[n]=this.height*1.3),n=this.numSpheres*3,r=parseInt(r.replace("#","0x")),this.aColorSphere[n++]=r>>16&255,this.aColorSphere[n++]=r>>8&255,this.aColorSphere[n]=r&255,this.numSpheres++}updateGCodeGeometry(){let e=performance.now();if(this.lastFeature=0,this.hideGCode=!1,this.featureHeadline=ws[this.options.show].name,this.features=[],this.maxF=0,this.featureMap={},this.activeColor=parseInt(this.filamentColors[0].replace("#","0x")),this.freeGCodeStorage(),!this.analyser.id)return;pi?this.createBasicGeometry():this.prepareExtrusionConstants(),this.createBasicSphereGeometry(),this.numSpheres=0,this.lastPos={x:0,y:0,z:0};let i={points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0},r=this.analyser;r.readerPos=0,this.width=.5,this.height=.2;let n=Math.min(r.layerInfo.layers[r.totalLayer].p,r.reader.byteLength);for(;r.readerPos<n;){let g=r.readBlockObj(),_=this.computeMemoryForBlock(g);i.points+=_.points,i.lines+=_.lines,i.triangles+=_.triangles,i.lineTravel+=_.lineTravel,i.filEnd+=_.filEnd,i.fil+=_.fil,i.spheres+=_.spheres}this.options.show===3&&this.addFeature(""+(1e3*this.width).toFixed(0),parseFloat((this.width*1e3).toFixed(0))),this.options.show===4&&this.addFeature(""+(1e3*this.height).toFixed(0),parseFloat((this.height*1e3).toFixed(0))),this.buildFeatureList();let o=performance.now(),a=o-e,l=i.points*12*(this.quality>=3?pi?1:2:1)+i.triangles*12+i.lineTravel*8+i.lines*8+(i.fil+i.filEnd)*39+i.spheres*23,h=i.points*3,u=i.triangles*3+i.lineTravel*2+i.lines*(pi?0:2);this.pointArray=new Float32Array(h),this.aPosSphere=new Float32Array(i.spheres*3),this.aSizeSphere=new Float32Array(i.spheres*2),this.aColorSphere=new Uint8Array(i.fil*3),pi&&(this.aPosArray=new Float32Array(i.fil*3),this.aSizeArray=new Float32Array(i.fil*3),this.aColor=new Uint8Array(i.fil*3),this.aRot=new Float32Array(i.fil*3),this.aPos=0,this.aPosArrayEnd=new Float32Array(i.filEnd*3),this.aSizeArrayEnd=new Float32Array(i.filEnd*3),this.aColorEnd=new Uint8Array(i.filEnd*3),this.aRotEnd=new Float32Array(i.filEnd*3),this.aPosEnd=0),this.normalArray=this.quality>=3&&!pi?new Float32Array(h):null,this.geomColor=new Uint8Array(h),this.geomIndices=new Uint32Array(u),this.layerIndices=[],this.pointArrayPos=0,this.geomTrianglePos=0,this.geomLinePos=3*i.triangles,this.geomLineStart=this.geomLinePos,this.geomTravelStart=this.geomTravelPos=this.geomLinePos+(pi?0:2*i.lines),this.width=.5,this.height=.2,this.z=0,this.activeColor=16711680,this.options.show===3&&this.setColorForFeatureValue(parseFloat((this.width*1e3).toFixed(0))),this.options.show===4&&this.setColorForFeatureValue(parseFloat((this.height*1e3).toFixed(0))),this.createMaterials(),this.pushLayerIndex(),this.prepareExtrusionConstants(),this.lastFeature=0,this.hideGCode=!1;for(let g=1;g<=r.totalLayer;g++){let _=r.fetchLayer(g);this.z=r.layerInfo.layers[g].h,this.lastPos.z=this.z-.5*this.height,_.forEach(x=>{this.drawBlock(x)}),this.pushLayerIndex()}let c=this.pointArrayPos;for(;c<this.pointArray.length;)this.pointArray[c++]=this.pointArray[0],this.pointArray[c++]=this.pointArray[1],this.pointArray[c++]=this.pointArray[2];let d=performance.now()-o,m=new Ei,p=this.options.model;p?(m.expandByPoint(new j(p.xMinView,p.yMinView,p.zMin)),m.expandByPoint(new j(p.xMaxView,p.yMaxView,p.zMax))):m.copy(this.view.getPrinterBox()),pi&&(this.extrudeGeometry=new qa,this.extrudeGeometry.copy(this.basicGeometry),this.extrudeGeometry.setDrawRange(this.basicCircStart,this.basicCircEnd-this.basicCircStart),this.extrudeGeometry.computeBoundingBox=()=>{},this.extrudeGeometry.computeBoundingSphere=()=>{},this.extrudeGeometry.isFilament=!0,this.extrudeGeometry.name="Filament",this.extrudeGeometry.instanceCount=i.fil,this.extrudeGeometry.setAttribute("aPos",new Rr(this.aPosArray,3,!1)),this.extrudeGeometry.setAttribute("aSize",new Rr(this.aSizeArray,3,!1)),this.extrudeGeometry.setAttribute("aColor",new Rr(this.aColor,3,!0)),this.extrudeGeometry.setAttribute("aRot",new Rr(this.aRot,3,!1)),this.extrudeGeometry.boundingBox=m,this.extrudeGeometry.boundingSphere=new Xr,m.getBoundingSphere(this.extrudeGeometry.boundingSphere),this.extrudeGeometry.addGroup(0,this.aPos,9),this.extrudeGeometry.addGroup(0,0,11),this.extrudeGeometry.groups[0].sx=0,this.extrudeGeometry.groups[0].sy=0,this.extrudeMesh=new _t(this.extrudeGeometry,this.materials),this.extrudeMesh.renderOrder=1e3,this.gcodeGroup.add(this.extrudeMesh),this.extrudeGeometryEnd=new qa,this.extrudeGeometryEnd.copy(this.basicGeometry),this.extrudeGeometryEnd.computeBoundingBox=()=>{},this.extrudeGeometryEnd.computeBoundingSphere=()=>{},this.extrudeGeometryEnd.isFilament=!0,this.extrudeGeometryEnd.name="FilamentEnd",this.extrudeGeometryEnd.instanceCount=i.filEnd,this.extrudeGeometryEnd.setAttribute("aPos",new Rr(this.aPosArrayEnd,3,!1)),this.extrudeGeometryEnd.setAttribute("aSize",new Rr(this.aSizeArrayEnd,3,!1)),this.extrudeGeometryEnd.setAttribute("aColor",new Rr(this.aColorEnd,3,!0)),this.extrudeGeometryEnd.setAttribute("aRot",new Rr(this.aRotEnd,3,!1)),this.extrudeGeometryEnd.boundingBox=m,this.extrudeGeometryEnd.boundingSphere=new Xr,m.getBoundingSphere(this.extrudeGeometryEnd.boundingSphere),this.extrudeGeometryEnd.addGroup(0,this.aPosEnd,8),this.extrudeGeometryEnd.addGroup(0,0,10),this.extrudeGeometryEnd.groups[0].startBottom=0,this.extrudeMeshEnd=new _t(this.extrudeGeometryEnd,this.materials),this.extrudeMeshEnd.renderOrder=1e3,this.gcodeGroup.add(this.extrudeMeshEnd)),this.sphereGeometry=new qa,this.sphereGeometry.copy(this.basicSphereGeometry),this.sphereGeometry.computeBoundingBox=()=>{},this.sphereGeometry.computeBoundingSphere=()=>{},this.sphereGeometry.isFilament=!0,this.sphereGeometry.name="Spheres",this.sphereGeometry.instanceCount=i.spheres,this.sphereGeometry.setAttribute("aPos",new Rr(this.aPosSphere,3,!1)),this.sphereGeometry.setAttribute("aSize",new Rr(this.aSizeSphere,2,!1)),this.sphereGeometry.setAttribute("aColor",new Rr(this.aColorSphere,3,!0)),this.sphereGeometry.boundingBox=m,this.sphereGeometry.boundingSphere=new Xr,m.getBoundingSphere(this.sphereGeometry.boundingSphere),this.sphereGeometry.addGroup(0,this.numSpheres,12),this.sphereMesh=new _t(this.sphereGeometry,this.materials),this.sphereMesh.renderOrder=1002,this.gcodeGroup.add(this.sphereMesh),this.gcodeGeometry=new pt,this.pointBuffer=new vt(this.pointArray,3,!1),this.pointBuffer.name="GCode Points",this.normalArray&&(this.normalBuffer=new vt(this.normalArray,3,!1),this.normalBuffer.name="GCode normals"),this.geomBuffer=new vt(this.geomIndices,1,!1),this.geomBuffer.name="GCode triangles",this.colorBuffer=new vt(this.geomColor,3,!0),this.colorBuffer.name="GCode Colors",this.gcodeGeometry.setAttribute("position",this.pointBuffer),this.normalArray&&this.gcodeGeometry.setAttribute("normal",this.normalBuffer),this.gcodeGeometry.setAttribute("color",this.colorBuffer),this.gcodeGeometry.setIndex(this.geomBuffer),this.gcodeGeometry.addGroup(this.quality===0?this.geomLineStart:0,0,5),this.gcodeGeometry.addGroup(0,0,3),this.gcodeGeometry.addGroup(0,this.geomTrianglePos,6),this.gcodeGeometry.addGroup(this.geomTrianglePos,0,5),this.gcodeGeometry.addGroup(this.geomTravelStart,this.geomTravelPos-this.geomTravelStart,0),pi||(this.quality===0?(this.gcodeMesh=new Zr(this.gcodeGeometry,this.materials),this.gcodeGeometry.setDrawRange(this.geomLineStart,this.geomLinePos-this.geomLineStart)):(this.gcodeMesh=new _t(this.gcodeGeometry,this.materials),this.gcodeGeometry.setDrawRange(0,this.geomTrianglePos)),this.gcodeGroup.add(this.gcodeMesh)),this.gcodeGeometryTravel=new pt,this.gcodeGeometryTravel.setAttribute("position",this.pointBuffer),this.gcodeGeometryTravel.setIndex(this.geomBuffer),this.gcodeGeometryTravel.setDrawRange(this.geomTravelStart,this.geomTravelPos-this.geomTravelStart),this.gcodeTravel=new Zr(this.gcodeGeometryTravel,this.materials[0]),this.gcodeTravelAdded=!1;let v=performance.now();this.options.live&&this.setLiveProgress(this.liveLayer,this.livePos,this.liveOffset),this.view.refresh(),this.view.setChanged()}fitObject(){let e=new Ei,i=this.options.model;i&&(e.expandByPoint(new j(i.xMinView,i.yMinView,i.zMin-(this.view.isZBelt?15:0))),e.expandByPoint(new j(i.xMaxView,i.yMaxView,i.zMax)),this.view.setObjectsBBox(e),this.view.fitBoundingBox(e))}analyseLayerPositions(e){if(this.analysedLayerNumber===e)return;this.analysedLayer=[],this.analyser.fetchLayer(e).forEach(r=>{this.appendDetailedMemoryForBlock(r,this.analysedLayer)});let i=this.layerIndices[e-1];this.analysedLayer.forEach(r=>{r.triangles+=i.triangles,r.lines+=i.lines,r.lineTravel+=i.lineTravel,r.points+=i.points,r.filEnd+=i.filEnd,r.fil+=i.fil,r.spheres+=i.spheres,i=r}),this.analysedLayerNumber=e,this.lastLivePos=0}setNozzlePosition(e){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return!1;if(this.nozzle){if(this.view.isZBelt){let i=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new j(1,0,0),i+Math.PI),this.nozzle.position.x=e.x,this.nozzle.position.y=e.y*Math.sin(i),this.nozzle.position.z=Math.cos(i)*e.y}else this.nozzle.position.x=e.x,this.nozzle.position.y=e.y,this.nozzle.position.z=e.z;this.nozzle.visible=!0,this.nozzle.needsUpdate=!0,this.nozzle.updateMatrix(),this.view.setChanged()}return!0}setLiveProgress(e,i,r){isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||(this.liveProgressBuffer.push({layer:e,pos:{x:i.x,y:i.y,z:i.z},offset:r}),this.liveProgressBuffer.length>32&&this.liveProgressBuffer.shift(),this.nozzleMoveList.length===0&&this.setNextLiveProgress(!1))}setNextLiveProgress(e){if(this.liveProgressBuffer.length===0&&!e)return;let i=0,{layer:r,pos:n,offset:o}=e?{layer:this.liveLayer,pos:this.livePos,offset:this.liveOffset}:this.liveProgressBuffer.shift();if(this.liveLayer=r,this.livePos=n,!this.gcodeMesh&&!this.extrudeMesh||r<0||r>=this.layerIndices.length)return;this.view.isZBelt&&(i=this.analyser.layerInfo.layers[r].h);let a=this.layerIndices[0],l=this.layerIndices[r-1],h=this.layerIndices[this.layerIndices.length-1];this.analyseLayerPositions(r);let u=this.analysedLayer.length,c=this.analysedLayer[this.lastLivePos],f;if(this.liveComplete)l={fil:this.aPos,filEnd:this.aPosEnd},f={fil:this.aPos,filEnd:this.aPosEnd};else if(c===void 0)l={fil:this.aPos,filEnd:this.aPosEnd},f={fil:this.aPos,filEnd:this.aPosEnd};else{let d=n.x-o.x-(c.x-c.offset.x),m=n.y-o.y-(c.y-c.offset.y),p=d*d+m*m,v=-1,g={x:0,y:0},_=0;for(let x=this.lastLivePos+1;x<u;x++){c=this.analysedLayer[x];let b=n.x-o.x-(c.x-c.offset.x),y=n.y-o.y-(c.y-c.offset.y),S=b*b+y*y;S<.0025&&(_++,S<p&&(v=x,p=S))}if(v!==-1&&(this.lastLivePos=v,c=this.analysedLayer[v],n.x+=c.offset.x-o.x,n.y+=c.offset.y-o.y,n.z+=c.offset.z-o.z),v===-1&&(v=this.lastLivePos),f=this.analysedLayer[v],f===void 0){console.log("No layer end found");return}}if(this.nozzle&&!this.liveComplete){if(this.nozzle.visible=!0,this.nozzle.matrix=new dt,this.options.smoothNozzleMove)if(this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new j(1,0,0),d+Math.PI),this.pushNozzleMove({x:n.x,y:n.y*Math.sin(d),z:Math.cos(d)*n.y,f:this.lastF*this.options.rootScope.active.state.speedMultiply*.01})}else this.pushNozzleMove({x:n.x,y:n.y,z:n.z,f:this.lastF*this.options.rootScope.active.state.speedMultiply*.01});else if(this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new j(1,0,0),d+Math.PI),this.nozzle.position.x=n.x,this.nozzle.position.y=n.y*Math.sin(d),this.nozzle.position.z=Math.cos(d)*n.y}else this.nozzle.position.x=n.x,this.nozzle.position.y=n.y,this.nozzle.position.z=n.z;this.nozzle.updateMatrix(),this.nozzle.needsUpdate=!0}else this.nozzle&&(this.nozzle.visible=!1);if(pi&&(this.extrudeGeometry.groups[0].sy=l.fil,this.extrudeGeometry.groups[0].count=f.fil,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometryEnd.groups[0].sy=l.filEnd,this.extrudeGeometryEnd.groups[0].count=f.filEnd,this.extrudeGeometryEnd.groups[0].sx=a.filEnd,this.extrudeGeometry.groups[1].count=0,this.extrudeGeometryEnd.groups[1].count=0,this.options.transparentTop?(this.extrudeGeometry.groups[1].sy=f.fil,this.extrudeGeometry.groups[1].count=h.fil,this.extrudeGeometryEnd.groups[1].sy=f.filEnd,this.extrudeGeometryEnd.groups[1].count=h.filEnd):(this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd)),this.sphereGeometry.groups[0].sy=l.spheres,this.sphereGeometry.groups[0].count=f.spheres,this.sphereGeometry.groups[0].sx=a.spheres,this.options.showRapidMotion?(this.gcodeTravelAdded||(this.gcodeGroup.add(this.gcodeTravel),this.gcodeTravelAdded=!0),this.gcodeGeometryTravel.setDrawRange(a.lineTravel,f.lineTravel-a.lineTravel)):this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGroup.matrix=new dt,this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.gcodeGroup.matrixAutoUpdate=!1;let m=new dt,p=new dt,v=new dt,g=new dt,_=new dt;v.makeRotationX(Math.PI*.25),p.makeScale(1,Math.sin(d),-1),g.makeShear(0,0,0,-Math.cos(d),0,0),_.makeTranslation(0,0,i),m.premultiply(g),m.premultiply(p),m.premultiply(_),this.gcodeGroup.applyMatrix4(m)}this.view.setChanged()}setViewRange(e,i,r){if(!this.gcodeMesh&&!this.extrudeMesh)return;let n=0,o=performance.now(),a=this.layerIndices[e-1],l=this.layerIndices[i-1],h=this.layerIndices[this.layerIndices.length-1];this.view.isZBelt&&(n=this.analyser.layerInfo.layers[i].h);let u=this.layerIndices[i];if(r!==100){if(this.analyseLayerPositions(i),u=this.analysedLayer[Math.floor(this.analysedLayer.length*r/100)],this.nozzle){if(this.nozzle.matrix=new dt,this.nozzle.visible=!0,this.view.isZBelt){let c=45*Math.PI/180;this.model?c=this.model.printerParam1*Math.PI/180:c=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180,this.nozzle.setRotationFromAxisAngle(new j(1,0,0),c+Math.PI),this.nozzle.position.x=u.x,this.nozzle.position.y=u.y*Math.sin(c),this.nozzle.position.z=n-(this.analyser.layerInfo.layers[i].h-Math.cos(c)*u.y)}else this.nozzle.position.x=u.x,this.nozzle.position.y=u.y,this.nozzle.position.z=this.analyser.layerInfo.layers[i].h;this.nozzle.updateMatrix(),this.nozzle.needsUpdate=!0}}else this.nozzle&&this.nozzle.visible&&(this.nozzle.visible=!1,this.nozzle.needsUpdate=!0);if(pi||(r!==100?this.quality===0?(this.gcodeGeometry.groups[2].start=l.lines,this.gcodeGeometry.groups[2].count=u.lines-l.lines,this.gcodeGeometry.groups[1].start=a.lines,this.gcodeGeometry.groups[1].count=l.lines-a.lines):(this.gcodeGeometry.groups[2].start=l.triangles,this.gcodeGeometry.groups[2].count=u.triangles-l.triangles,this.gcodeGeometry.groups[1].start=a.triangles,this.gcodeGeometry.groups[1].count=l.triangles-a.triangles):(this.gcodeGeometry.groups[1].count=0,this.quality===0?(this.gcodeGeometry.groups[2].start=a.lines,this.gcodeGeometry.groups[2].count=u.lines-l.lines):(this.gcodeGeometry.groups[2].start=a.triangles,this.gcodeGeometry.groups[2].count=u.triangles-a.triangles)),this.options.transparentBottom?this.quality===0?this.gcodeGeometry.groups[0].count=a.lines-this.geomLineStart:this.gcodeGeometry.groups[0].count=a.triangles:this.gcodeGeometry.groups[0].count=0,this.options.transparentTop?this.quality===0?(this.gcodeGeometry.groups[3].start=u.lines,this.gcodeGeometry.groups[3].count=h.lines-u.lines):(this.gcodeGeometry.groups[3].start=u.triangles,this.gcodeGeometry.groups[3].count=h.triangles-u.triangles):this.gcodeGeometry.groups[3].count=0),pi&&(r!==100?(this.extrudeGeometry.groups[0].sy=l.fil,this.extrudeGeometry.groups[0].count=u.fil,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometryEnd.groups[0].sy=l.filEnd,this.extrudeGeometryEnd.groups[0].count=u.filEnd,this.extrudeGeometryEnd.groups[0].sx=a.filEnd):(this.extrudeGeometry.groups[0].sy=0,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometry.groups[0].count=u.fil,this.extrudeGeometryEnd.groups[0].sy=0,this.extrudeGeometryEnd.groups[0].sx=a.filEnd,this.extrudeGeometryEnd.groups[0].count=u.filEnd),this.options.transparentBottom?(this.extrudeGeometry.groups[1].sx=a.fil,this.extrudeGeometryEnd.groups[1].sx=a.filEnd,this.extrudeGeometry.groups[1].count=a.fil,this.extrudeGeometryEnd.groups[1].count=a.filEnd,this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd):(this.extrudeGeometry.groups[1].count=0,this.extrudeGeometryEnd.groups[1].count=0),this.options.transparentTop?(this.extrudeGeometry.groups[1].sy=u.fil,this.extrudeGeometry.groups[1].count=h.fil,this.extrudeGeometryEnd.groups[1].sy=u.filEnd,this.extrudeGeometryEnd.groups[1].count=h.filEnd):(this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd)),r!==100?(this.sphereGeometry.groups[0].sy=l.spheres,this.sphereGeometry.groups[0].count=u.spheres,this.sphereGeometry.groups[0].sx=a.spheres):(this.sphereGeometry.groups[0].sy=0,this.sphereGeometry.groups[0].sx=a.spheres,this.sphereGeometry.groups[0].count=u.spheres),this.options.showRapidMotion?(this.gcodeTravelAdded||(this.gcodeGroup.add(this.gcodeTravel),this.gcodeTravelAdded=!0),this.gcodeGeometryTravel.setDrawRange(a.lineTravel,u.lineTravel-a.lineTravel)):this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGroup.matrix=new dt,this.view.isZBelt){let c=45*Math.PI/180;this.model?c=this.model.printerParam1*Math.PI/180:c=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180,this.gcodeGroup.matrixAutoUpdate=!1;let f=new dt,d=new dt,m=new dt,p=new dt,v=new dt;m.makeRotationX(Math.PI*.25),d.makeScale(1,Math.sin(c),-1),p.makeShear(0,0,0,-Math.cos(c),0,0),v.makeTranslation(0,0,n),f.premultiply(p),f.premultiply(d),f.premultiply(v),this.gcodeGroup.applyMatrix4(f)}o=performance.now()-o,this.view.setChanged()}};RSBase.component("rsBedView2d",{template:'<div ng-ref="$ctrl.content" style="width:100%;height:100%;cursor:{{ $ctrl.cursorStyle()}}"></div>',controller:["$element","$rootScope","$scope",function(t,e,i){this.bedGrid=void 0,this.p={},this.x=0,this.y=0,this.x0=0,this.y0=0,this.textureFile=null,this.textureCanvas=null,this.dragMode=0,this.zoomEnabled=!1,this.minScale=25,this.maxScale=1e3,this.intervalTimer=null,this.dirty=!1,this.lastW=0,this.lastH=0,this.show=0,this.renderCount=0,this.registerSend=!1,this.rainbowColors=["#ff0000","#ff8000","#ffff00","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff","#ff00ff","#ff0080"],this.featureHeadline="",this.features=[],this.roundFeatures=[],this.featureMap={},this.$onChanges=n=>{!this.live&&(n.showTravel||n.showPrint||n.showRetracts||n.showExtruder||n.show)&&this.drawPreviewLayer(this.lastPreviewData,this.lastPreviewPercent),this.content&&this.adjustPosZoom()},this.triggerFeaturesChanged=()=>{this.featureHeadline=ws[this.show].name,this.updateLegend&&this.updateLegend({value:{headline:this.featureHeadline,features:this.features,roundFeatures:this.roundFeatures}})},this.addFeature=(n,o)=>{if(n===void 0||o===void 0){console.log("illegal feature id");return}o===0&&this.show>=3||(this.featureMap[n]?this.featureMap[n].count++:this.featureMap[n]={id:n,value:parseFloat(""+n),count:1,index:-1})},this.sortedFeatureMapByValue=()=>{let n=Object.values(this.featureMap);return n.sort((o,a)=>o.value>a.value?1:a.value>o.value?-1:0),n},this.buildFeatureList=()=>{let n=Object.values(this.featureMap).length,o=this.sortedFeatureMapByValue();switch(o.length===0&&o.push({id:"0",value:0,count:1,index:0}),this.roundFeatures=[],this.showRetracts&&(this.roundFeatures.push({color:"#"+r(this.retractColor),name:"<?php _('Retractions') ?>"}),this.roundFeatures.push({color:"#"+r(this.unretractColor),name:"<?php _('Deretractions') ?>"})),this.features=o,this.show){case 0:this.featureInterpolate=!1,o.forEach(a=>{a.color=this.filamentColors[a.value%this.filamentColors.length],a.name="<?php _('Extruder') ?> "+(a.value+1)});break;case 1:this.featureInterpolate=!1,o.forEach(a=>{a.color=ed[a.value].color,a.name=ed[a.value].name});break;case 2:if(n<=this.rainbowColors.length)this.featureInterpolate=!1,o.forEach((a,l)=>{a.color=this.rainbowColors[l],a.name=a.id+" mm/s"});else{let a=[],l=o[0].value,h=o[n-1].value,u=this.rainbowColors.length,c=(h-l)/(u-1);for(let f=0;f<u;f++){let d=l+f*c;a.push({name:d.toFixed(0)+" mm/s",value:d,color:this.rainbowColors[f]})}this.features=a,this.featureInterpolate=!0}break;case 3:case 4:if(n<=this.rainbowColors.length)this.featureInterpolate=!1,o.forEach((a,l)=>{a.color=this.rainbowColors[l],a.name=a.id+" \xB5m"});else{let a=[],l=o[0].value,h=o[n-1].value,u=this.rainbowColors.length,c=(h-l)/(u-1);for(let f=0;f<u;f++){let d=l+f*c;a.push({name:d.toFixed(0)+" \xB5m",value:d,color:this.rainbowColors[f]})}this.features=a,this.featureInterpolate=!0}break}this.triggerFeaturesChanged()};function r(n){n<0&&(n=4294967295+n+1);let o=n.toString(16);for(;o.length<6;)o="0"+o;return o}this.setColorForFeatureValue=n=>{if(this.featureInterpolate){this.activeColor="#ff0000";let o=this.features.length;if(o===0)return;let a=Math.floor((o-1)*(n-this.features[0].value)/(this.features[o-1].value-this.features[0].value));a===o-1?a=o-2:a<o-1&&this.features[a+1].value<n&&a++;let l=a+1;if(a<0){this.activeColor=this.features[0].color;return}let h=parseInt(this.features[a].color.replace("#","0x")),u=parseInt(this.features[l].color.replace("#","0x")),c=(n-this.features[a].value)/(this.features[l].value-this.features[a].value),f=1-c,d=Math.round(c*(h>>16&255)+f*(u>>16&255)),m=Math.round(c*(h>>8&255)+f*(u>>8&255)),p=Math.round(c*(h&255)+f*(u&255));this.activeColor="#"+r((d<<16)+(m<<8)+p)}else{let o=1e20;this.features.forEach(a=>{let l=Math.abs(n-a.value);l<o&&(o=l,this.activeColor=a.color)})}},this.intervalFunction=()=>{let n=this.content[0].clientWidth,o=this.content[0].clientHeight;(n!==this.lastW||o!==this.lastH)&&(n>0&&this.registerSend===!1&&this.register&&(this.registerSend=!0,this.register({value:this})),this.lastW=n,this.lastH=o,this.adjustPosZoom()),++this.renderCount>=20&&(this.dirty=!0,this.renderCount=0),this.dirty&&(this.dirty=!1,this.app.render())},this.loadTexture=async()=>{let n=new Image;if(this.pc.shape.imageExtension!=="png"){n.onload=async()=>{if(n.height===0||n.width===0){console.warn("unknown image size - this svg is not supported");return}this.textureCanvas=this.textureCanvas||document.createElement("canvas");let a=Date.now(),l=this.textureCanvas.getContext("2d"),h,u,c=gi.getMaxTextureSize();(!c||c>2048&&Ls)&&(c=2048);let f=c>4096?4096:c,d=!1,m=document.createElement("canvas");m.width=1,m.height=1;let p=m.getContext("2d");do{h=this.textureCanvas.width=f,u=this.textureCanvas.height=Math.floor(f*n.height/n.width),l.fillStyle="#818283",l.fillRect(h-1,u-1,1,1),p.drawImage(this.textureCanvas,h-1,u-1,1,1,0,0,1,1);let g=p.getImageData(0,0,1,1).data;d=f<1e3||u<=c&&g[3]!==0,d||(f=f/2)}while(!d);l.clearRect(h-1,h-1,1,1),l.drawImage(n,0,0,h,u),m.remove();let v=Date.now()-a;this.textureBase&&this.textureBase.destroy(),this.textureBase=St.from(this.textureCanvas,{}),this.drawBed(),this.render(),this.textureCanvas.remove(),this.textureCanvas=null,n.remove(),n=null};let o=await ui.get("/printer/bed/"+this.slug+"/get_image?r="+Math.random());if(o.status===200){let h=new DOMParser().parseFromString(o.data,"text/xml").getElementsByTagName("svg")[0],u=0,c=0,f=o.data.match(/viewBox="(.*?)"/);if(f.length===2){let d=f[1].split(" ");d.length===4&&(u=Number(d[2]),c=Number(d[3]))}u!==0&&c!==0&&(h.setAttribute("width",Math.floor(u)+"px"),h.setAttribute("height",Math.floor(c)+"px")),n.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(h))}}else n.onload=()=>{this.textureBase&&this.textureBase.destroy(),this.textureBase=St.from(n,{}),this.drawBed(),this.render(),n.remove(),n=null},n.src="/printer/bed/"+this.slug+"/get_image?&r="+Math.random();return!0},this.cursorStyle=()=>{switch(this.dragMode){case 0:return"move";case 1:return"crosshair";case 2:return"crosshair"}return"pointer"},this.createApp=()=>{if(this.excludeColors=[12267302,12279591,12231720,9878056,2865704,2669227,2645946,4663482,9185466,12200059],this.lastPrintZ=0,this.lastLineType=-1,this.lastExtruder=-1,this.filamentColors=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231"],this.filamentColor=128,this.midColor=16777215,this.retractRadius=.5,this.retractColor=13185068,this.unretractColor=255,this.travelColor=6536543,this.travelWidth=.15,this.resolution=window.devicePixelRatio,this.points=[],wa.skipHello(),this.app=new jC({resizeTo:this.content[0],antialias:!0,resolution:window.devicePixelRatio,backgroundAlpha:0,width:300,height:300,autoDensity:!0,autoStart:!1}),this.pc)this.shape=Mt({},this.pc.shape.basicShape),this.shape.gridColor=this.pc.shape.gridColor,this.shape.gridSpacing=this.pc.shape.gridSpacing,this.shape.showImage=this.pc.shape.showImage,this.shape.imageZoom=this.pc.shape.imageZoom;else if(this.info)this.shape={xMin:this.info.xMin-20,xMax:this.info.xMax+20,yMin:this.info.yMin-20,yMax:this.info.yMax+20,shape:"rectangle",showImage:!1,gridSpacing:10,color:"#dddddd",gridColor:"#454545",imageZoom:100},this.info.printerType===2&&(this.shape.shape="zbelt");else{console.error("No printer config or info model provided for rs-bed-view-2d component");return}this.bedFill=wa.string2hex(this.shape.color),this.bedGrid=wa.string2hex(this.shape.gridColor),this.extruderColor=16711680,this.content[0].appendChild(this.app.view),this.shape.shape==="rectangle"||this.shape.shape==="zbelt"?(this.x0=(this.shape.xMin+this.shape.xMax)*.5,this.y0=(this.shape.yMin+this.shape.yMax)*.5):(this.x0=this.shape.x,this.y0=this.shape.y),this.x=this.y=0,this.dragX=0,this.dragY=0,this.app.renderer.plugins.interaction.on("mousedown",this.onDragStart).on("mouseup",this.onDragEnd).on("mouseupoutside",this.onDragEnd).on("mousemove",this.onDragMove).on("touchstart",this.onDragStartTouch).on("touchend",this.onDragEndTouch).on("touchendoutside",this.onDragEndTouch).on("touchmove",this.onDragMoveTouch),this.app.renderer.plugins.interaction.autoPreventDefault=!1,this.app.renderer.view.style.touchAction="auto",this.bed=new di,this.bed.addChild(new Si),this.app.stage.addChild(this.bed),this.drawBed(),this.actLayer=new di,this.lastLayer=new di,this.excludeLayer=new Si,this.selectLayer=new Si,this.lastLayer.alpha=.3,this.actLayer.addChild(new Si),this.actLayer.addChild(new Si),this.lastLayer.addChild(new Si),this.lastLayer.addChild(new Si),this.app.stage.addChild(this.lastLayer),this.app.stage.addChild(this.actLayer),this.app.stage.addChild(this.excludeLayer),this.app.stage.addChild(this.selectLayer),this.p&&this.ensureExtruder(this.p.state.activeExtruder),this.newLayer(),this.showExtruder&&(this.lastX=this.p.state.x+this.extruderOffsetX,this.lastY=this.p.state.y+this.extruderOffsetY,this.createExtruder(),this.updateExcludeRegions()),this.intervalTimer=setInterval(this.intervalFunction,25),this.app.view.addEventListener("webglcontextlost",this.conextLost),this.fitBed(),this.adjustPosZoom(),this.shape.showImage&&this.loadTexture()},this.conextLost=n=>{console.warn("context lost",n)},this.onResize=()=>{this.adjustPosZoom()},this.clearLayer=n=>{n.getChildAt(0).destroy(!0),n.getChildAt(0).destroy(!0);let o=new di;o.addChild(new Si),n.addChild(o),n.addChild(new Si)},this.newLayer=()=>{this.skipNewLayer||(this.lastLayer.getChildAt(0).destroy(!0),this.lastLayer.getChildAt(0).destroy(!0),this.lastLayer.addChild(this.actLayer.removeChildAt(0)),this.lastLayer.addChild(this.actLayer.removeChildAt(0))),this.skipNewLayer=!1;let n=new di;this.lastG=new Si,n.addChild(this.lastG),this.actLayer.addChild(n),this.actLayer.addChild(new Si),this.lastLineType=-1},this.selectRectangle=()=>(this.selectPromise=new Promise((n,o)=>{this.selectResolve=n,this.selectReject=o,this.dragMode=1}),this.selectPromise),this.selectPoint=()=>(this.selectPromise=new Promise((n,o)=>{this.selectResolve=n,this.selectReject=o,this.dragMode?(this.selectLayer.clear(),this.dragMode=0,this.dragging=0,o()):this.dragMode=2}),this.selectPromise),this.extractPinch=n=>{let o={date:new Date,distance:0},a=n.data.originalEvent.targetTouches;if(!a)return null;if(o.numTouches=a.length,a.length===2){o.isPinch=!0;let c=a[0].clientX-a[1].clientX,f=a[0].clientY-a[1].clientY;o.distance=Math.sqrt(c*c+f*f)}else o.isPinch=!1;let l={x:0,y:0};for(let c=0;c<a.length;c++)l.x+=a[c].clientX/a.length,l.y+=a[c].clientY/a.length;let h={x:0,y:0};this.app.renderer.plugins.interaction.mapPositionToPoint(h,l.x,l.y);let u=this.getGraphCoordinates(h.x,h.y);return o.centerTrans={x:u.x,y:u.y},o.center=h,o},this.onDragStart=n=>{this.lastPinch=this.extractPinch(n),this.data=n.data,this.dragMode===0?this.start={x:this.data.global.x,y:this.data.global.y}:this.dragMode===2?(this.start=this.data.getLocalPosition(this.app.stage),this.dragMode=0,this.selectLayer.clear(),this.selectResolve(this.start)):this.start=this.data.getLocalPosition(this.app.stage),this.alpha=.5,this.dragging=!0},this.onDragEnd=n=>{if(this.lastPinch=this.extractPinch(n),this.dragMode===0)this.x+=this.dragX,this.y+=this.dragY,this.dragX=0,this.dragY=0,this.dragging=!1,this.data=null;else if(this.dragMode===1){this.dragMode=0,this.dragging=!1,this.data=n.data;let o=this.data.getLocalPosition(this.app.stage);this.selectLayer.clear(),this.selectResolve({start:this.start,end:o})}this.render()},this.onDragMove=n=>{let o=n.data.originalEvent.shiftKey,a=this.extractPinch(n);if(a&&this.lastPinch&&this.lastPinch.distance){let l=this.app.stage,h=a.centerTrans,u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let v=Math.abs(this.shape.xMax-this.shape.xMin)+16,g=Math.abs(this.shape.yMax-this.shape.yMin),_=v/g,x=u/c;_>x?this.zoomBase=.01*u/v:this.zoomBase=.01*c/g}else this.zoomBase=.005*Math.min(u,c)/this.shape.radius;this.zoomBase*=.94;let f=a.distance/this.lastPinch.distance,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=(this.y+this.dragY+this.y0)*this.scale+.5*c;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let p=this.getGraphCoordinates(a.center.x,a.center.y);this.x-=p.x-h.x,this.y-=p.y-h.y,this.adjustPosZoom(),this.lastPinch=a;return}if(this.lastPinch=null,this.dragging){if(this.data=n.data,o){let l=-n.data.originalEvent.movementY*.25,h=this.zoom+l;h<this.minScale&&(h=this.minScale),h>this.maxScale&&(h=this.maxScale),this.zoom=h,this.adjustPosZoom(),this.start={x:this.data.global.x,y:this.data.global.y};return}if(this.dragMode===0){let l=(n.data.global.x-this.start.x)/this.scale,h=(n.data.global.y-this.start.y)/this.scale;this.dragX=-l,this.dragY=h,this.adjustPosZoom()}else if(this.dragMode===1){let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),this.selectLayer.beginFill(16711680,.7).drawRect(this.start.x,this.start.y,l.x-this.start.x,l.y-this.start.y).endFill()}else if(this.dragMode===2){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y)}}else if(this.dragMode){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y)}this.render()},this.onDragStartTouch=n=>{let o=this.extractPinch(n);!this.lastPinch&&o&&o.isPinch&&(this.lastPinch=o,n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()),this.data=n.data,this.dragMode===0&&this.lastPinch?this.start={x:this.lastPinch.centerTrans.x,y:this.lastPinch.centerTrans.y}:this.dragMode===2?(n.stopPropagation(),this.start=this.data.getLocalPosition(this.app.stage),this.dragMode=0,this.selectLayer.clear(),this.selectResolve(this.start)):this.start=this.data.getLocalPosition(this.app.stage),this.alpha=.5,this.dragging=!0},this.onDragEndTouch=n=>{if(this.lastPinch=null,this.dragMode===0)this.x+=this.dragX,this.y+=this.dragY,this.dragX=0,this.dragY=0,this.dragging=!1,this.data=null;else if(this.dragMode===1){this.dragMode=0,this.dragging=!1,this.data=n.data;let o=this.data.getLocalPosition(this.app.stage);this.selectLayer.clear(),this.selectResolve({start:this.start,end:o})}this.render()},this.onDragMoveTouch=n=>{let o=n.data.originalEvent.shiftKey,a=this.extractPinch(n);if(!this.lastPinch&&a&&a.isPinch)return this.lastPinch=a,this.dragMode===0&&(this.start={x:this.lastPinch.centerTrans.x,y:this.lastPinch.centerTrans.y}),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault(),!0;if(a&&this.lastPinch&&a.isPinch){n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault();let l=this.app.stage,h=this.getGraphCoordinates(this.lastPinch.center.x,this.lastPinch.center.y),u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let v=Math.abs(this.shape.xMax-this.shape.xMin)+16,g=Math.abs(this.shape.yMax-this.shape.yMin),_=v/g,x=u/c;_>x?this.zoomBase=.01*u/v:this.zoomBase=.01*c/g}else this.zoomBase=.005*Math.min(u,c)/this.shape.radius;this.zoomBase*=.94;let f=a.distance/this.lastPinch.distance,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=(this.y+this.dragY+this.y0)*this.scale+.5*c;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let p=this.getGraphCoordinates(a.center.x,a.center.y);this.x-=p.x-h.x,this.y-=p.y-h.y,this.adjustPosZoom(),this.lastPinch=a;return}if(this.lastPinch=null,this.dragging){if(this.data=n.data,o){let l=-n.data.originalEvent.movementY*.25,h=this.zoom+l;h<this.minScale&&(h=this.minScale),h>this.maxScale&&(h=this.maxScale),this.zoom=h,this.adjustPosZoom(),this.start={x:this.data.global.x,y:this.data.global.y};return}if(this.dragMode!==0){if(this.dragMode===1){let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),this.selectLayer.beginFill(16711680,.7).drawRect(this.start.x,this.start.y,l.x-this.start.x,l.y-this.start.y).endFill(),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}else if(this.dragMode===2){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}}}else if(this.dragMode){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}this.render()},this.showCursorCross=(n,o)=>{if(this.selectLayer.clear().lineStyle(.2,6328064,.9),this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let a={x:Math.min(this.shape.xMin,this.shape.xMax),y:Math.min(this.shape.yMin,this.shape.yMax)},l={x:Math.max(this.shape.xMax,this.shape.xMin),y:Math.max(this.shape.yMax,this.shape.yMin)};n>=a.x&&n<=l.x&&this.selectLayer.moveTo(n,a.y).lineTo(n,l.y),o>=a.y&&o<=l.y&&this.selectLayer.moveTo(a.x,o).lineTo(l.x,o)}else if(this.shape.shape==="circle"){let a=this.shape.radius;if(Math.abs(n)<a){let l=Math.acos(n/a),h=a*Math.sin(l);this.selectLayer.moveTo(n,-h).lineTo(n,h)}if(Math.abs(o)<a){let l=Math.asin(o/a),h=a*Math.cos(l);this.selectLayer.moveTo(-h,o).lineTo(h,o)}}},this.updateExcludeRegions=()=>{this.excludeLayer.clear();let n=e.RSPrinter.excludeRegions;for(let o=0;o<n.length;o++){let a=n[o];this.excludeLayer.beginFill(this.excludeColors[o%10],.4).drawRect(a.xmin,a.ymin,a.xmax-a.xmin,a.ymax-a.ymin).endFill()}this.render()},this.updateExcludeRegionsDelayed=()=>{setTimeout(this.updateExcludeRegions,600),setTimeout(this.updateExcludeRegions,2e3)},this.createExtruder=()=>{this.extruder||(this.extruder=new Si,this.extruder.beginFill(this.extruderColor,.7).moveTo(0,0).lineTo(3,3).lineTo(3,10).lineTo(-3,10).lineTo(-3,3).closePath().endFill(),this.extruder.position.x=this.lastX,this.extruder.position.y=this.lastY,this.app.stage.addChild(this.extruder))},this.fitBed=()=>{this.shape.shape==="rectangle"||this.shape.shape==="zbelt"?(this.x0=(this.shape.xMin+this.shape.xMax)*.5,this.y0=(this.shape.yMin+this.shape.yMax)*.5):(this.x0=this.shape.x,this.y0=this.shape.y),this.x=0,this.y=0,this.zoom=100,this.adjustPosZoom()},this.fitArea=(n,o,a,l,h)=>{let u=a-n+2*h,c=l-o+2*h;this.x=(n+a)*.5-this.x0,this.y=(o+l)*.5-this.y0;let f=u/c,d=this.content[0].clientWidth,m=this.content[0].clientHeight,p=d/m;f>p?this.zoom=d/u/this.zoomBase:this.zoom=m/c/this.zoomBase,this.adjustPosZoom()},this.getGraphCoordinates=(n,o)=>{let a={global:{x:n,y:o}};return r_.prototype.getLocalPosition.call(a,this.app.stage)},this.zoomHandler=n=>{if(!(n.shiftKey||this.easyZoom===!0))return!0;if(n.deltaY===void 0||(event.preventDefault(),!this.zoomEnabled))return!1;let a={x:0,y:0};this.app.renderer.plugins.interaction.mapPositionToPoint(a,n.clientX,n.clientY);let l=this.app.stage,h=this.getGraphCoordinates(a.x,a.y),u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let v=Math.abs(this.shape.xMax-this.shape.xMin)+16,g=Math.abs(this.shape.yMax-this.shape.yMin),_=v/g,x=u/c;_>x?this.zoomBase=.01*u/v:this.zoomBase=.01*c/g}else this.zoomBase=.005*Math.min(u,c)/(this.shape.radius+8);this.zoomBase*=.94;let f=1+n.deltaY*.01,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=.5*c+(this.y+this.dragY+this.y0)*this.scale;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let p=this.getGraphCoordinates(a.x,a.y);return this.x-=p.x-h.x,this.y-=p.y-h.y,this.adjustPosZoom(),!1},this.adjustPosZoom=()=>{let n=this.content[0].clientWidth,o=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let l=Math.abs(this.shape.xMax-this.shape.xMin)+16,h=Math.abs(this.shape.yMax-this.shape.yMin),u=l/h,c=n/o;u>c?this.zoomBase=.01*n/l:this.zoomBase=.01*o/h}else this.zoomBase=.005*Math.min(n,o)/(this.shape.radius+8);this.zoomBase*=.94,this.scale=this.zoom*this.zoomBase;let a=this.app.stage;a.scale.x=this.zoom*this.zoomBase,a.scale.y=-this.zoom*this.zoomBase,a.position.x=.5*n-(this.x+this.dragX+this.x0)*this.scale,a.position.y=.5*o+(this.y+this.dragY+this.y0)*this.scale,this.app.renderer.resize(n,o),this.app.render()},this.drawBed=()=>{let n=new Si;for(;this.bed.children.length;)this.bed.getChildAt(0).destroy(!0);this.bed.addChild(n);let o=0;if(e.theme==="dark"&&(o=16777215),this.pc)this.shape=Mt({},this.pc.shape.basicShape),this.shape.gridColor=this.pc.shape.gridColor,this.shape.gridSpacing=this.pc.shape.gridSpacing,this.shape.showImage=this.pc.shape.showImage,this.shape.imageZoom=this.pc.shape.imageZoom;else if(this.info)this.shape={xMin:this.info.xMin-20,xMax:this.info.xMax+20,yMin:this.info.yMin-20,yMax:this.info.yMax+20,shape:"rectangle",showImage:!1,gridSpacing:10,color:"#dddddd",gridColor:"#454545",imageZoom:100},this.info.printerType===2&&(this.shape.shape="zbelt");else{console.error("No printer config or info model provided for rs-bed-view-2d component");return}this.bedFill=wa.string2hex(this.shape.color),this.bedGrid=wa.string2hex(this.shape.gridColor);let a,l,h,u,c;u=this.shape.gridSpacing;let f=.01*u,d=.03*u,m=u,p=this.shape.imageZoom*.01,v=(1-p)*.5;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let g={x:Math.min(this.shape.xMin,this.shape.xMax),y:Math.min(this.shape.yMin,this.shape.yMax)},_={x:Math.max(this.shape.xMax,this.shape.xMin),y:Math.max(this.shape.yMax,this.shape.yMin)};if(n.lineStyle(.5,this.bedGrid,1),n.beginFill(this.bedFill),n.drawRect(g.x,g.y,_.x-g.x,_.y-g.y),n.endFill(),c=0,h=Math.max(Math.abs(this.shape.xMin),Math.abs(this.shape.xMax),Math.abs(this.shape.yMin),Math.abs(this.shape.yMax)),parseFloat(u)>1){for(n.lineStyle(d,this.bedGrid,1),0>this.shape.yMin&&0<this.shape.yMax&&n.moveTo(g.x,0).lineTo(_.x,0),0>this.shape.xMin&&0<this.shape.xMax&&n.moveTo(0,g.y).lineTo(0,_.y),n.lineStyle(.1,this.bedGrid,1);c+u<h;){c+=u;let y=parseInt(c/u)%5==0?d:f;n.lineStyle(y,this.bedGrid,1);let S=c;c>this.shape.yMin&&c<this.shape.yMax&&n.moveTo(g.x,S).lineTo(_.x,S),c>this.shape.xMin&&c<this.shape.xMax&&n.moveTo(S,g.y).lineTo(S,_.y),-c>this.shape.yMin&&c<this.shape.yMax&&n.moveTo(g.x,-S).lineTo(_.x,-S),-c>this.shape.xMin&&c<this.shape.xMax&&n.moveTo(-S,g.y).lineTo(-S,_.y)}n.beginFill(this.bedGrid).drawCircle(0,0,.1*u).endFill()}if(this.shape.showImage&&this.textureBase){this.textureTexture&&this.textureTexture.destroy(!1),this.textureTexture=tt.from(this.textureBase);let y=new Zt,S=_.x-g.x,w=_.y-g.y,M=S/w,C=this.textureTexture.width/this.textureTexture.height;if(M<C){let E=S/C;y.identity().scale(p*S/this.textureTexture.width,-p*E/this.textureTexture.height).translate(g.x+S*v,g.y-E*v+.5*(w-E)+E),n.lineStyle(0,16711680,0).beginTextureFill({matrix:y,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(g.x+S*v,g.y+E*v+.5*(w-E),S*p,E*p).endFill()}else{let E=w*C;y.identity().scale(p*E/this.textureTexture.width,-p*w/this.textureTexture.height).translate(g.x+v*E+.5*(S-E),g.y+w-v*w),n.lineStyle(0,16711680,0).beginTextureFill({matrix:y,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(g.x+.5*(S-E)+v*E,g.y+v*w,E*p,w*p).endFill()}}m<1&&(m=25);let x=parseInt(Math.max(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)/m);for(;x>8*5;)m*=2,x=parseInt(Math.max(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)/m);let b=5*Math.min(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)*.005;for(let y=-x*m*5;y<=x*m*5;y+=5*m){if(y>=this.shape.xMin&&y<=this.shape.xMax){let S=new Yn(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),w=b/S.height,M=S.height,C=S.width;S.y=g.y-1,S.scale.y=-1,S.height=M*w,S.width=C*w,S.x=y-.5*S.width,this.bed.addChild(S),S=new Yn(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),S.y=_.y+1+M*w,S.scale.y=-1,S.height=M*w,S.width=C*w,S.x=y-.5*S.width,this.bed.addChild(S)}if(y>=this.shape.yMin&&y<=this.shape.yMax){let S=new Yn(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),w=S.height,M=S.width,C=b/S.height;S.scale.y=-1,S.height=w*C,S.width=M*C,S.x=g.x-S.width-1,S.y=y+.5*S.height,this.bed.addChild(S),S=new Yn(y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),S.scale.y=-1,S.height=w*C,S.width=M*C,S.x=_.x+1,S.y=y+.5*S.height,this.bed.addChild(S)}}}else if(this.shape.shape==="circle"){let g={x:this.shape.x,y:this.shape.y},_=this.shape.radius;if(n.lineStyle(.5,this.bedGrid,1).beginFill(this.bedFill).drawCircle(g.x,g.y,_).endFill(),this.shape.showImage&&this.textureBase){this.textureTexture&&this.textureTexture.destroy(!1),this.textureTexture=tt.from(this.textureBase);let b=new Zt,y=2*_,S=2*_,w=this.textureTexture.width/this.textureTexture.height;if(1<w){let M=y/w;b.identity().scale(p*y/this.textureTexture.width,-p*M/this.textureTexture.height).translate(-_+v*y,-_-v*M+.5*(S-M)+M),n.lineStyle(0,16711680,0).beginTextureFill({matrix:b,texture:this.textureTexture,alpha:this.pc.shape.imageOpacity}).drawRect(-_+v*y,-_+v*M+.5*(S-M),y*p,M*p).endFill()}else{let M=S*w;b.identity().scale(p*M/this.textureTexture.width,-p*S/this.textureTexture.height).translate(-_+v*M+.5*(y-M),_-v*S),n.lineStyle(0,16711680,0).beginTextureFill({matrix:b,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(-_+v*M+.5*(y-M),-_+v*S,M*p,S*p).endFill()}}if(c=u,parseFloat(u)>=1){for(n.lineStyle(d,this.bedGrid,1),n.moveTo(g.x,g.y-_).lineTo(g.x,g.y+_),n.moveTo(g.x-_,g.y).lineTo(g.x+_,g.y),n.lineStyle(f,this.bedGrid,1);c<_;){let b=c,y=parseInt(c/u)%5==0?d:f;n.lineStyle(y,this.bedGrid,1),a=Math.asin((0-b-g.y)/_),l=_*Math.cos(a),n.moveTo(g.x-l,-b).lineTo(g.x+l,-b),a=Math.asin((b-g.x)/_),l=_*Math.cos(a),n.moveTo(b,g.y-l).lineTo(b,g.y+l),a=Math.asin((b-g.y)/_),l=_*Math.cos(a),n.moveTo(g.x-l,b).lineTo(g.x+l,b),a=Math.asin((-b-g.x)/_),l=_*Math.cos(a),n.moveTo(-b,g.y-l).lineTo(-b,g.y+l),c+=u}n.beginFill(this.bedGrid).drawCircle(0,0,.1*u).endFill()}m<1&&(m=25);let x=parseInt(_/m);for(;x>3*5;)m*=2,x=parseInt(_/m);for(let b=-m*5*x;b<=m*5*x;b+=5*m)if(b>=-_&&b<=_){let y=new Yn(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),S=5*_*.01/y.height,w=y.height,M=y.width;y.y=-_-1,y.scale.y=-1,y.height=w*S,y.width=M*S,y.x=b-.5*y.width,this.bed.addChild(y),y=new Yn(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.y=_+1+w*S,y.scale.y=-1,y.height=w*S,y.width=M*S,y.x=b-.5*y.width,this.bed.addChild(y),y=new Yn(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.scale.y=-1,y.height=w*S,y.width=M*S,y.x=-_-y.width-1,y.y=b+.5*y.height,this.bed.addChild(y),y=new Yn(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.scale.y=-1,y.height=w*S,y.width=M*S,y.x=_+1,y.y=b+.5*y.height,this.bed.addChild(y)}}},this.ensureExtruder=n=>{n===void 0||n===this.lastExtruder||(this.lastExtruder=n,this.filamentColor=parseInt(this.filamentColors[n%this.filamentColors.length].replace("#","0x")),this.pc&&this.pc.extruders.length>n?(this.extruderOffsetX=this.pc.extruders[this.lastExtruder].offsetX,this.extruderOffsetY=this.pc.extruders[this.lastExtruder].offsetY):(this.extruderOffsetX=0,this.extruderOffsetY=0),this.lastLineType!==-1&&(this.lastG=new Si,this.actLayer.getChildAt(0).addChild(this.lastG)),this.lastLineType=-1)},this.addRetract=(n,o,a)=>{n.beginFill(this.retractColor,.6).lineStyle(0).drawCircle(o,a,this.retractRadius)},this.addUnretract=(n,o,a)=>{n.beginFill(this.unretractColor,.6).lineStyle(0).drawCircle(o,a,this.retractRadius)},this.onMove=n=>{let o=Mt({},n);if(this.ensureExtruder(o.t),o.x+=this.extruderOffsetX,o.y+=this.extruderOffsetY,Math.abs(o.x-this.lastX)<.001&&Math.abs(o.y-this.lastY)<.001){let a=this.actLayer.getChildAt(1);o.de>.01?this.addUnretract(a,o.x,o.y):o.de<-.01&&this.addRetract(a,o.x,o.y),this.lastLineType=0}else if(o.de>1e-6){Math.abs(o.z-this.lastPrintZ)>1e-4&&this.newLayer();let a=this.actLayer.getChildAt(0),l=this.lastG;this.lastPrintZ=o.z,this.lastLineType!==1&&(this.lastLineType!==-1&&(l=this.lastG=new Si,a.addChild(l)),this.points=[{x:this.lastX,y:this.lastY}],l.moveTo(this.lastX,this.lastY)),this.points.push({x:o.x,y:o.y}),l.clear().lineStyle(.4,this.filamentColor,.7).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}l.lineStyle(.4*.3,this.midColor,.4).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}this.lastLineType=1}else{let a=this.actLayer.getChildAt(0),l=this.lastG;this.lastLineType!==2&&(this.lastLineType!==-1&&(l=this.lastG=new Si,a.addChild(l)),this.points=[{x:this.lastX,y:this.lastY}]),this.points.push({x:o.x,y:o.y}),l.clear().lineStyle(this.travelWidth,this.travelColor,1).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}this.lastLineType=2}this.extruder.position.x=this.lastX=o.x,this.extruder.position.y=this.lastY=o.y,this.dirty=!0},this.xyToPlainArray=(n,o)=>{let a=[];return n.forEach(l=>{o>0&&(a=a.concat([l.x,l.y])),o--}),a},this.includeFeatures=(n,o)=>{o&&(this.features=[],this.featureMap={},this.activeColor=this.filamentColors[0]),n.forEach(a=>{a.t===10?this.show===1&&this.addFeature(""+a.ft,a.ft):a.t===1?(this.show===0&&this.addFeature(a.e,a.e),this.show===2&&this.addFeature((a.s/60).toFixed(1),a.s/60),this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0)))):a.t===4||a.t===5||(a.t===6?(this.maxF=Math.max(this.maxF,a.s/60),this.show===2&&this.addFeature((a.s/60).toFixed(1),a.s/60)):a.t===8?this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0))):a.t===11?(this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0))),this.show===4&&this.addFeature(""+(1e3*a.h).toFixed(0),parseFloat((a.h*1e3).toFixed(0)))):a.t===7&&this.show===0&&this.addFeature(""+a.e,a.e))})},this.drawPreviewLayer=(n,o)=>{if(this.lastPreviewData=n,this.lastPreviewPercent=o,!n||!this.actLayer)return;this.height=.2,this.width=.4,this.show===3&&this.addFeature(""+(5*Math.round(200*this.width)).toFixed(0),parseFloat((5*Math.round(200*this.width)).toFixed(0))),this.show===4&&this.addFeature(""+(1e3*this.height).toFixed(0),parseFloat((this.height*1e3).toFixed(0))),this.includeFeatures(n,!0),this.buildFeatureList(),this.clearLayer(this.actLayer);let a=this.actLayer.getChildAt(1),l=this.actLayer.getChildAt(0).getChildAt(0),h=this.filamentColors[0],u=.4;u<.001&&(u=.001);let c,f=0,d=0,m=9999999;o<100&&(n.forEach(p=>{switch(p.t){case 2:this.showTravel&&(f+=p.m.length-1);break;case 3:this.showPrint&&(f+=p.m.length-1);break;case 4:case 5:this.showRetracts&&f++}}),m=f*o/100),n.forEach(p=>{if(!(d>m))switch(p.t){case 1:p.w>0&&p.w!==this.width&&(this.width=p.w,this.show===3&&this.setColorForFeatureValue(Math.round(p.w*1e3))),this.show===0&&this.setColorForFeatureValue(p.e),c={x:p.x,y:p.y},p.w!==0&&(u=p.w);break;case 2:if(this.showTravel){let v=p.m[0];l.lineStyle(this.travelWidth,this.travelColor,1).moveTo(v.x,v.y);let g=Math.min(p.m.length,m-d+1);for(let _=1;_<g;_++){let x=p.m[_];l.lineTo(x.x,x.y)}d+=p.m.length-1}c=p.m[p.m.length-1];break;case 3:if(this.showPrint){let v=p.m[0];l.lineStyle(this.width,parseInt(this.activeColor.replace("#","0x")),.7).moveTo(v.x,v.y);let g=Math.min(p.m.length,m-d+1);for(let _=1;_<g;_++){let x=p.m[_];l.lineTo(x.x,x.y)}l.lineStyle(this.width*.3,this.midColor,.4).moveTo(v.x,v.y);for(let _=1;_<g;_++){let x=p.m[_];l.lineTo(x.x,x.y)}d+=p.m.length-1}c=p.m[p.m.length-1];break;case 4:if(!this.showRetracts)break;this.addRetract(a,c.x,c.y),d++;break;case 5:if(!this.showRetracts)break;this.addUnretract(a,c.x,c.y),d++;break;case 6:this.show===2&&this.setColorForFeatureValue(p.s/60);break;case 7:this.show===0&&this.setColorForFeatureValue(p.e);break;case 8:this.width=p.w;break;case 9:break;case 10:this.show===1&&this.setColorForFeatureValue(p.ft);break;case 11:p.w>0&&(this.width=p.w,this.show===3&&this.setColorForFeatureValue(Math.round(p.w*200)*5)),this.height=p.h,this.show===3&&this.setColorForFeatureValue(Math.round(p.w*200)*5),this.show===4&&this.setColorForFeatureValue(Math.round(p.h*1e3));break}}),this.render()},this.drawLastLayer=(n,o)=>{this.clearLayer(this.lastLayer);let a=this.lastLayer.getChildAt(1),l=this.lastLayer.getChildAt(0).getChildAt(0);this.skipNewLayer=!0,this.lastPrintZ=o;let h=parseInt(this.filamentColors[0].replace("#","0x")),u=.4;u<.001&&(u=.001);let c={x:0,y:0};for(let f in n){if(!{}.hasOwnProperty.call(n,f))continue;let d=n[f];switch(d.t){case 1:h=parseInt(this.filamentColors[d.e%this.filamentColors.length].replace("#","0x")),c={x:d.x,y:d.y},d.w!==0&&(u=d.w);break;case 2:{let m=d.m[0];l.lineStyle(this.travelWidth,this.travelColor,1).moveTo(m.x,m.y);let p=d.m.length;for(let v=1;v<p;v++){let g=d.m[v];l.lineTo(g.x,g.y)}c=d.m[d.m.length-1]}break;case 3:{let m=d.m[0];l.lineStyle(u,h,.7).moveTo(m.x,m.y);let p=d.m.length;for(let v=1;v<p;v++){let g=d.m[v];l.lineTo(g.x,g.y)}l.lineStyle(u*.3,this.midColor,.4).moveTo(m.x,m.y);for(let v=1;v<p;v++){let g=d.m[v];l.lineTo(g.x,g.y)}c=d.m[d.m.length-1]}break;case 4:this.addRetract(a,c.x,c.y);break;case 5:this.addUnretract(a,c.x,c.y);break;case 6:break;case 7:h=parseInt(this.filamentColors[d.e%this.filamentColors.length].replace("#","0x"));break;case 8:u=d.w;break}}this.dirty=!0},this.render=()=>{this.intervalTimer?this.dirty=!0:this.app.render()},this.$postLink=()=>{this.bed=void 0,this.pc=e.printerConfig[this.slug],this.p=e.printer[this.slug],this.createApp(),$(this.content[0]).on("mousewheel",this.zoomHandler),$(this.content[0]).on("wheel",this.zoomHandler),window.addEventListener("resize",this.onResize)},this.$onDestroy=()=>{window.loosect=void 0,this.register&&this.register({value:null}),$(this.content[0]).off("mousewheel"),$(this.content[0]).off("wheel"),window.removeEventListener("resize",this.onResize),this.app.view.removeEventListener("webglcontextlost",this.conextLost),this.app&&(this.intervalTimer&&clearInterval(this.intervalTimer),this.app.destroy(!0,!0))}}],controllerAs:"$ctrl",bindings:{register:"&",updateLegend:"&",zoom:"=",live:"=",easyZoom:"=",info:"=",showExtruder:"<",showTravel:"<",showRetracts:"<",showPrint:"<",slug:"<",show:"<"}});RSBase.factory("KlipperDialog",["$uibModal","$sce","User","$http",function(t,e,i,r){return function(n,o){let a=t.open({template:`<div class="modal-header">
    <h4 class="modal-title">{{headline}}</h4>
</div>
<div class="modal-body">

  <div ng-if="page === 0" class="form-group margin-top" >
    <div>
      <label><?php _('Klipper Version') ?></label>
      <select class="form-control" ng-model="$parent.klipperVersion" ng-options="v as v.name for v in updateVersionList"></select>
    </div>
    <div class="margin-top">
      <small class=""><?php _('Select the Klipper version you want to install. Please note that the newest version of Klipper may contain breaking changes that might break installation. In that case use the second entry instead.') ?></small> 
    </div>
  </div>
    
  <div class="clearfix"></div>
  
  <div  ng-if="page === 1">
    <h4><?php _('Output') ?></h4>
    <div ng-if="channel" id="terminalCommand" style="position:relative;border:0;width:100%;height:70vh">
      <rs-terminal autofocus channel="channel" callback="terminalCallback"></rs-terminal>
    </div>
  </div>
</div>
<div class="modal-footer">    
    <button type="button" ng-if="firmwareCompiled" class="btn btn-primary" ng-click="downloadFirmware()"><i class="fa fa-download rs-bigtab"></i> <?php _('Download Firmware File') ?></button>
    <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> <?php _('Close') ?></button>
    <button type="button" ng-if="page === 0 && klipperActionName === 'update'" class="btn btn-primary" ng-click="startKlipperUpdate()"><i class="fa fa-refresh"></i> <?php _('Update') ?></button>
    <button type="button" ng-if="page === 0 && klipperActionName === 'install'" class="btn btn-primary" ng-click="startKlipperUpdate()"><i class="fa fa-play"></i> <?php _('Install') ?></button>
</div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User",function(l,h,u,c,f,d){l.downloadFirmware=function(){window.open("/printer/klipperfw/"+h.activeSlug+"?a=download","ihelper")},l.klipperVersion={},l.updateVersionList={},l.firmwareCompiled=!1,l.klipperActionName=n,n==="install"?l.headline="<?php _('Installing Klipper') ?>":n==="uninstall"?l.headline="<?php _('Uninstalling Klipper') ?>":n==="update"?l.headline="<?php _('Updating Klipper') ?>":n==="restart"?l.headline="<?php _('Restarting Klipper') ?>":n==="installInputShaping"?l.headline="<?php _('Install Input Shaping Dependencies') ?>":n==="createFirmware"?l.headline="<?php _('Create Firmware') ?>":n==="getKlipperLog"&&(l.headline="<?php _('Klipper Log') ?>"),l.channel=void 0,l.output="",this.output="";let m="",p=!1,v=g=>{this.output+=g.replace(/ /g,"&nbsp;").replace(`
`,"<br>"),$("#klipper_output").html(this.output),f(function(){var _=document.getElementById("klipper_output");_.scrollTop=_.scrollHeight})};l.startKlipperAction=function(g,_,x){l.page=1;let b=[_];x&&(b=[...b,x.git_target,""+x.format,x.url_git]),c.send("klipperAction",{action:g,config:b}).then(y=>{y.terminal_id?l.channel=y.terminal_id:l.channel=void 0})},l.startKlipperUpdate=function(){l.startKlipperAction(n,o,l.klipperVersion),p=!0},l.$on("executeOutput",(g,_)=>{_.data.name===m&&v(_.data.out)}),l.$on("executeFinished",(g,_)=>{_.data.name===m&&v(`

`+"<?php _('Operation finished with exit code @') ?>".replace("@",_.data.exitCode)),n==="restart"&&l.close()}),l.terminalCallback={onClose:()=>{console.log("closed1"),c.send("sendEvent",{event:"reloadKlipperConfig"}),n==="installInputShaping"&&setTimeout(()=>{c.send("send",{cmd:"FIRMWARE_RESTART"})},5e3)},onLine:g=>{g==="Finished compiling Klipper firmware!"&&(l.firmwareCompiled=!0)}},l.startAction=function(){l.startKlipperAction(n,o)},n==="update"?(l.page=0,r.get("https://download1.repetier.com/files/server/extras/klipper-versions.json").then(g=>{l.updateVersionList=g.data.versions,l.klipperVersion=g.data.versions[0]})):n==="install"?(l.page=0,r.get("https://download1.repetier.com/files/server/extras/klipper-versions.json").then(g=>{l.updateVersionList=g.data.versions,l.klipperVersion=g.data.versions[1]})):l.startKlipperAction(n,o),l.close=function(){u.close()}}],size:"lg",backdrop:"static"});return a.result.catch(function(l){}),a.result}}]);RSBase.factory("KlipperDialogInputShaping",["$uibModal","$sce","User",function(t,e,i){return function(r,n,o){let a=t.open({template:`<div class="modal-header" xmlns="http://www.w3.org/1999/html">
          <h4 class="modal-title"><?php _('Input Shaping') ?></h4>
          <div ng-if="phase === 0"><?php _('Installing Dependencies') ?></div>
          <div ng-if="phase === 1"><?php _('Measurement Settings') ?></div>
          <div ng-if="phase === 2"><?php _('Measuring Resonances') ?></div>
          <div ng-if="phase === 3"><?php _('Analysing Results') ?></div>
          <div ng-if="phase === 4"><?php _('Result Graphs') ?></div>
        </div>
        <div class="modal-body">
          <div ng-if="phase === 1">
            <!-- Settings -->              
            <div class="row" style="display: flex; align-items: center">
              <div class="col-sm-3 form-group checkbox">
                <label>
                  <input class="" type="checkbox" ng-model="shaperOptions.useX"><?php _('Use X Axis') ?>
                </label>
              </div>
              <div class="col-sm-3 form-group checkbox margin-top-important"  >
                <label>
                  <input class="" type="checkbox" ng-model="shaperOptions.useY"><?php _('Use Y Axis') ?>
                </label>
              </div>
            </div>
            
            <div class="row">
              <div class="col-sm-6 form-group">
                <label>Start Frequency</label>
                <input class="form-control" min="1" type="number" ng-model="shaperOptions.freqStart">
              </div> 
              <div class="col-sm-6 form-group">
                <label>End Frequency</label>
                <input class="form-control" min="1" type="number" ng-model="shaperOptions.freqEnd">
              </div>
            </div>
          </div>
          
          <div ng-if="phase === 2">
            <!-- GCode Analysis Section -->
            <h3>
              <rs-icon class="margin-right fa fa-spinner fa-spin"></rs-icon><?php _('Measuring the resonances in process. This could take a while...') ?>
            </h3>
            <div class="col-xs-12">
              <div class="progress">
                <div class="progress-bar" role="progressbar" aria-valuenow="{{measuringPercentage}}" aria-valuemin="0" aria-valuemax="100" style="width:{{measuringPercentage}}%"></div>
                <div class="metertext">{{measuringPercentage}}%</div>
              </div>
            </div>
          </div>
          
          <div ng-if="(phase === 3 || phase === 0) && channel" id="terminalCommand" style="position:relative;border:0;width:100%;height:70vh">
            <!-- Bash Analysis Section -->
            <rs-terminal channel="channel" callback="terminalCallback"></rs-terminal>
            
          </div>
          <div ng-if="phase === 4">
            <div class="images-slideshow">
              <h3 ng-if="imageData.count == 0"><?php _('Currently there are no resonance measurement graphs to show. Please use the Input Shaping Assistant to generate graphs') ?></h3>
              <div ng-repeat="image in imageData.images track by $index">
                <div class="image-slides">
                  <div style="margin: auto; display: block; width: 85%;">
                    <label><?php _('Axis: ') ?> {{image.axis}}</label>
                   
                    <div type="button" style="margin: 0;margin-left: 10px;margin-top: -3px;" ng-click="deleteImage(image)" class="margin-right btn text-danger btn-xs pull-right">
                      <i class="fa fa-trash-o" style="font-size:2em"></i>
                    </div>
                   <label class="pull-right">{{getFileDate(image)}}</label>
                  </div>
                 
                  <img ng-src="{{image.url}}" style="margin: auto; display: block; width: 85%;">
                </div>
              </div>
              <a class="slider-btn previous" ng-click="setSlides(-1)">\u276E</a>
              <a class="slider-btn next" ng-click="setSlides(1)">\u276F</a>
             
            </div>
            <div class="margin-top margin-bottom" style="display:flex; justify-content: center; text-align:center">
              <div ng-repeat="a in imageData.images track by $index">
                <span class="slideshow-dot" ng-class="{'slideshow-dot-disabled':$index !== currentIndex}" ng-click="showSlide($index)"></span>
              </div>
            </div>
          </div>
        
        <div class="modal-footer" style="padding-right: 0; padding-left: 0; padding-bottom: 0; padding-top: 15px">
          <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> <?php _('Close') ?></button>
          <button ng-if="phase === 0 && phasefinished === true" type="button" class="btn btn-primary" ng-click="proceedToSettings()"><i class="fa fa-play rs-bigtab"></i> <?php _('Next') ?></button>
          <button ng-if="phase === 1" type="button" class="btn btn-primary" ng-click="start()"><i class="fa fa-play rs-bigtab"></i> <?php _('Next') ?></button>
          <button ng-if="phase === 3 && phasefinished === true" type="button" class="btn btn-primary" ng-click="displayGallery()"><i class="fa fa-play rs-bigtab"></i> <?php _('Show Graphs') ?></button>
          <div class="clearfix">
        </div>
      `,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User","Flash",function(l,h,u,c,f,d,m){l.phase=0,l.channel=void 0,l.output="",l.imageData={},l.phasefinished=!1,l.shaperOptions={useX:!0,useY:!0,freqStart:1,freqEnd:133,hzPerSec:1},this.output="";let p="";l.currentIndex=0;function v(_){if(l.imageData.count!==0){let x,b=document.getElementsByClassName("image-slides");for(l.currentIndex=Math.min(l.imageData.count-1,l.currentIndex),_>b.length-1&&(l.currentIndex=0),_<0&&(l.currentIndex=b.length-1),x=0;x<b.length;x++)b[x].style.display="none";b[l.currentIndex].style.display="block"}}l.imageURL=function(_){return"/printer/inputshapingimage/"+h.activeSlug+"/?index="+_},l.getFileDate=function(_){return"<?php _('Creation Date: ') ?>"+new Date(_.date*1e3).toLocaleString()},l.showSlide=function(_){v(_)},l.setSlides=function(_){v(l.currentIndex+=_)},l.deleteImage=_=>{c.send("deleteInputShapingImage",{index:_.indexNumber}).then(x=>{x.ok===!0?(m.success("<?php _('Image deleted') ?>"),l.displayGallery()):x.error&&m.error("<?php _('Image could not be deleted! Reason: ') ?>"+x.error)})};let g=_=>{this.output+=_.replace(/ /g,"&nbsp;").replace(`
`,"<br>"),$("#klipper_output").html(this.output),f(function(){var x=document.getElementById("klipper_output");x.scrollTop=x.scrollHeight})};l.$on("executeOutput",(_,x)=>{x.data.name===p&&g(x.data.out)}),l.proceedToSettings=()=>{l.phase=1},l.$on("executeFinished",(_,x)=>{console.log("KlipperDialogInputShaping.executeFinished",x),x.data.name===p&&g(`

`+"<?php _('Operation finished with exit code @') ?>".replace("@",x.data.exitCode)),c.send("sendEvent",{event:"reloadKlipperConfig"})}),l.activeAxis="",l.shaperResult={},l.terminalCallback={onClose:()=>{console.log("KlipperDialogInputShaping.terminalCallback.onClose"),l.phasefinished=!0,c.send("sendEvent",{event:"reloadKlipperConfig"})},onLine:_=>{if(_==="Input Shaping Analysis: X Axis"&&(l.activeAxis="X"),_==="Input Shaping Analysis: Y Axis"&&(l.activeAxis="Y"),_.startsWith("Recommended shaper is ")){let b=_.slice(21,-2).split("@");b[0]=b[0].trim(),b[1]=b[1].trim(),l.shaperResult[l.activeAxis]={freq:b[1],shaper:b[0]}}}},l.displayGallery=function(){c.send("getInputShapingImages").then(_=>{console.log(_),_.ok===!0?(_.images.sort(function(x,b){return x.filename<b.filename?1:-1}),l.imageData=_,l.phase=4,l.imageData.count!==0&&setTimeout(()=>{v(0)},0)):_.error})},l.checkDependencies=function(){o?l.phase=1:c.send("klipperAction",{action:"installInputShaping",config:[r]}).then(_=>{_.terminal_id?l.channel=_.terminal_id:l.channel=void 0})},l.start=function(){l.phasefinished=!1,c.send("startInputShaping",l.shaperOptions).then(_=>{_.ok===!0?l.phase=2:_.error}),l.startProgressbar()},l.startProgressbar=()=>{l.measuringProgress=0,l.measuringPercentage=0;let _=0,x=0;l.shaperOptions.useX&&x++,l.shaperOptions.useY&&x++,_=x*((l.shaperOptions.freqEnd-l.shaperOptions.freqStart)/l.shaperOptions.hzPerSec+50)+10;let b=setInterval(()=>{l.measuringProgress=l.measuringProgress+_/100,l.measuringPercentage=Math.round(l.measuringProgress/_*100),l.measuringPercentage>=100&&clearInterval(b)},_*10)},l.$on("inputShapingPhase1Finished",(_,x)=>{c.send("klipperAction",{action:"inputShaping",config:[r]}).then(b=>{b.terminal_id?(l.channel=b.terminal_id,l.phase=3):l.channel=void 0})}),console.log(n),n===!0?l.displayGallery():l.checkDependencies(),l.close=function(){u.close()}}],size:"lg",backdrop:"static"});return a.result.catch(function(l){}),a.result}}]);RSBase.factory("PrinterConditionDialog",["$uibModal","$sce",function(t,e){return function(i){let r=t.open({template:`<div class="modal-header">
    <h4 class="modal-title"><span ng-bind-html="p | printerConditionIcon | unsafe"></span> {{ p | printerConditionText }}</h4>
</div>
<div class="modal-body">
<div ng-if="!p.status.active">
<p><?php _('The printer usage is deactivated. You can safely use it with other software. To connect, you need to activate the printer.') ?></p>
</div>
<div ng-if="p.status.active && p.status.online===0">
<p><?php _('Printer is not connected. Please connect the printer and enable power. Then it should appear automatically.') ?></p>
<p><?php _('If the printer still does not appear, you probably have defined wrong connection settings or they have changed in between.') ?></p>
</div>
<div ng-if="p.status.active && p.status.online">
<div ng-if="p.state.condition===1"><!-- ready -->
<p><?php _('Printer is operational.') ?></p>
</div>

<div ng-if="p.state.condition===2"><!-- shutdown -->
<p><?php _('You are connected to the controlling instance.') ?></p>
<p><?php _('The controlling instance reports, that the printer is in an error state and needs to be restarted internally. Message about the error:') ?></p>
<p>{{p.state.conditionReason}}</p>
<p><?php _('Fix the problem and try to recover.') ?></p>
</div>

<div ng-if="p.state.condition===3"><!-- killed -->
<p><?php _('Your printer reported, that it went into killed state. This is normally caused by a serious problem detected inside the printer.') ?></p>
<p><?php _('To restart the printer must be reset. For most printers with 32 bit processor we can not reset remotely. If the printer has no reset button, you need to power off the printer and eventually even unplug usb cable.') ?></p>
<p><?php _('Message from printer:') ?></p>
<p>{{p.state.conditionReason}}</p>
</div>

<div ng-if="p.state.condition===4"><!-- ignoring -->
<p><?php _('Your printer reported an internal printer problem and disabled several commands. This is normally caused by a problem detected inside the printer like temperature runaway.') ?></p>
<p><?php _('Fix the problem and try to recover. If the source is not fixed, it might go into error state again.') ?></p>
<p><?php _('Message from printer:') ?></p>
<p>{{p.state.conditionReason}}</p>
</div>

<div ng-if="p.state.condition===5"><!-- offline -->
<p><?php _('Printer is offline. Make sure it is powered and the printer is connected. It should then switch to operational automatically.') ?></p>
</div>
</div>
</div><div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> <?php _('Close') ?></button>
    <button ng-if="p.status.active && p.status.online!==0 && p.status.online && p.state.condition>=2 && p.state.condition<=4 && user.printPermission" type="button" class="btn btn-primary" ng-click="recoverBadCondition()"><i class="fa fa-wrench rs-bigtab"></i> <?php _('Try to recover') ?></button>
    <button ng-if="!p.status.active && user.printPermission" type="button" class="btn btn-primary" ng-click="activate()">
      <rs-icon icon="fa fa-link fg-success"></rs-icon> 
      <?php _('Activate') ?>
    </button>
    <div ng-if="p.status.active && p.status.online===0 && user.changeConfigPermission" class="btn btn-primary" ng-click="configure()">
                <rs-icon icon="fa fa-gear"></rs-icon>
                  <?php _('Printer Settings') ?>
              </div>
</div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$state",function(n,o,a,l,h){n.p=o.printer[i],n.recoverBadCondition=function(){l.send("recoverBadCondition",{},i),a.close()},n.configure=function(){a.close(),h.go("printerConfig.general",{slug:i})},n.activate=function(){l.send("activate",{printer:i}),a.close()},n.close=function(){a.close()}}],size:"400",backdrop:"static"});return r.result.catch(function(n){}),r.result}}]);RSPrinterModule.controller("PrinterController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","RSPrinter","RSPrinters","User","Flash","$uibModal","$state","PrinterConditionDialog",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v){let g=e.slug;t.demo=!!window.demo,r.active.state===void 0&&p.go("home"),t.printerExternalLinks=[],t.disk={},t.menuOpen=!1,t.menuFan=!1,t.menuFlow=!1,t.menuSpeed=!1,t.menuTemp=!1,t.menuBed=!1,t.menuChamber=!1,t.menuEmergency=!1,t.menuActions=!1,typeof r.active.local=="undefined"&&(r.active.local={}),typeof r.active.local.logCommands=="undefined"&&(r.active.local.logCommands=0,r.active.local.logACK=0,r.active.local.logPause=0,r.active.local.logAutoscroll=1,r.active.local.lastLogStart=0,r.active.local.logFilterM105=1),r.active.local.queueExpanded===void 0&&(r.active.local.queueExpanded=!0),t.showPage=function(S,w){w&&(w.stopPropagation(),w.preventDefault()),u.setActivePage(g,{state:S,params:{slug:g}}),p.go(S,{slug:g}),t.menuOpen=!1},t.closeMenuActions=function(){t.menuActions=!1},t.closeFan=function(){t.menuFan=!1},t.closeFlow=function(){t.menuFlow=!1},t.closeEmergency=function(){t.menuEmergency=!1},t.closeSpeed=function(){t.menuSpeed=!1},t.closeTemp=function(){t.menuTemp=!1},t.closeChamber=function(){t.menuChamber=!1},t.closeBed=function(){t.menuBed=!1},t.closeMenu=function(){t.menuOpen=!1},t.showPrinterCondition=function(){v(r.activeSlug)};function _(){t.printerExternalLinks=[],angular.forEach(r.externalLinks,function(S){S.slug===g&&S.gui&&t.printerExternalLinks.push(JSON.parse(JSON.stringify(S)))})}t.prevent=function(S){S&&(S.stopPropagation(),S.preventDefault())},t.$on("int_externalLinksChanged",_),t.executeExternalLink=function(S){t.menuOpen=!1,S.openExternal?window.open(S.href,"_blank"):p.go("printer.externalLink",{slug:g,id:S.id})},t.canPrint=f.printPermission,t.moveDistance=10,t.moveToXPos=20,t.moveToYPos=50,t.moveToZPos=0,t.idle=!0,t.printerData={moveDistance:10,moveToXPos:20,moveToYPos:50,moveToZPos:0,idle:!0,canPrint:f.printPermission},r.frontend.setVisible("showConsole",f.printPermission),r.frontend.setVisible("showTimelapseTab",r.isPro()||r.isOEM()||r.isLight()),r.titlePrepend=r.active.status.name+"@";let x=!1;t.slug=g,h.selectPrinter(g),t.cmd="",t.$on("$destroy",function(){i.send("hideMoves",{}),r.titlePrepend="",x=!0}),t.checkDisk=function(){i.send("freeSpace",{}).then(function(S){t.disk=S,t.disk.usage=100-100*(S.available/S.capacity),S.capacity<1e3*1024*1024?t.disk.class="progress-bar-warning":S.capacity<500*1024*1024?t.disk.class="progress-bar-danger":t.disk.class="progress-bar-success"})},t.$watch("active.state.isJobActive",function(){!t.active||!t.active.state||(t.printing=t.active.state.isJobActive,t.idle=r.active.status.paused||!t.active.state.isJobActive)}),t.$watch("active.status.paused",function(){!r.active||!r.active.state||!r.active.status||(t.printerData.idle=t.idle=r.active.status.paused||!t.active.state.isJobActive)}),t.$on("log",function(S,w){g===w.printer&&(r.active.local.lastLogStart=t.lastLogStart=w.data.id)}),r.$watch("active.local.logACK",function(){r.active&&r.active.local&&i.send("setLoglevel",{level:t.getLoglevel()}).then(function(){t.$broadcast("logLevelChanged",r.active)})}),r.$watch("active.local.logCommands",function(){r.active&&r.active.local&&i.send("setLoglevel",{level:t.getLoglevel()}).then(function(){t.$broadcast("logLevelChanged",r.active)})}),r.$watchCollection("activeConfig.webcams",function(){r.activeConfig&&r.activeConfig.webcams&&r.frontend.setVisible("activeWebcam",r.activeConfig.webcams.length>0)}),t.getLoglevel=function(){return 12+(r.active.local.logCommands!==0?1:0)+(r.active.local.logACK!==0?2:0)},t.previewData=0,t.$on("move",function(S,w){t.printerData.moveToXPos=t.moveToXPos=w.data.x,t.printerData.moveToYPos=t.moveToYPos=w.data.y,t.printerData.moveToZPos=t.moveToZPos=w.data.z,r.active.state.f=w.data.f,t.$broadcast("extruderPos",{x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos})}),t.exactMoves=function(){m.open({templateUrl:"/views/printer/control/printer.control.move.php?lang="+lang,scope:t,size:"sm"})},t.stopPrint=function(){l("<?php _('Confirmation required') ?>","<?php _('Really stop current print?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){t.active.status.jobid&&i.send("stopJob",{id:t.active.status.jobid})})},t.recover=function(){p.go("printer.rescue")},t.runCall=function(S){S.question?l("<?php _('Security question') ?>",S.question).then(function(){i.send("webCallExecute",{name:S.name,params:["Test"]})}):i.send("webCallExecute",{name:S.name,params:["Test"]})};let b=function(){if(!i.connected||g!==t.activeSlug||x)return;let S=12+(r.active.local.logCommands>0?1:0)+(r.active.local.logACK>0?2:0);i.send("response",{filter:S,start:(r.active.local.lastLogStart===0,-1)}).then(function(w){typeof w.state!="undefined"&&(w.list&&w.list.length>0&&(r.active.local.lastLogStart=t.lastLogStart=w.list[w.list.length-1].id),t.printerData.moveToXPos=t.moveToXPos=w.state.x,t.printerData.moveToYPos=t.moveToYPos=w.state.y,t.printerData.moveToZPos=t.moveToZPos=w.state.z,t.$broadcast("extruderPos",{x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos})),n(b,3e3)})};t.reduceConextMenu=!1;function y(){let S=0;angular.forEach(t.externalCommandsFiltered,function(w){w.remote&&w.slug===t.activeSlug&&S++}),angular.forEach(t.webCalls,function(w){w.show_in_menu&&w.slug===t.activeSlug&&S++}),t.reduceConextMenu=S>4}t.$on("connected",function(){h.selectPrinter(g),i.send("setLoglevel",{level:t.getLoglevel()}),b(),t.checkDisk(),y()}),y(),b(),t.checkDisk(),_()}]);RSPrinterModule.controller("PrinterCameraController",["$scope","$stateParams","RSCom","RSPrinter","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","User","$interval","RSPrinterConfig","Flash","SelectProject","Fullscreen",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g){let _=!1,x=function(){if(typeof n.activeConfig!="undefined")switch(t.webcammode===1&&!S&&(b(),S=!0),t.webcammode){case 1:t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation,t.webcamUrl="/printer/camjpg/"+n.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10);break;case 2:t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation,w=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+n.activeSlug+"?cam="+t.activeCam+"&wcid="+w;break;default:t.webcamRotate=0,t.webcamUrl="/img/nowebcam.png";break}},b=function(){if(t.refreshWebcamImage(),t.webcammode!==1){S=!1;return}o(b,1e3*n.activeConfig.webcams[t.activeCam].reloadInterval)},y=function(){if(n.activeConfig.webcams.length){if(t.edit){let T=n.activeConfig.webcams[t.edit.webcamId||0];k("#editimage",t.edit.webcamOrientation!==void 0?t.edit.webcamOrientation:T?T.orientation:0)}k("#editvideo",0)}};t.vmode=0,t.webcammode=0,n.active.local.selectedWebcam=n.active.local.selectedWebcam!==void 0?n.active.local.selectedWebcam:0,t.activeCam=n.active.local.selectedWebcam,t.saveActiveCam=function(){n.active.local.selectedWebcam=t.activeCam},n.globals.timelapseView||(n.globals.timelapseView={viewMode:parseInt(f.getSetting("timelapseViewMode","1")),hideFailed:parseInt(f.getSetting("timelapseViewFailed","0"))}),t.tabs=[!0,!1,!1,!1],t.activeTab=0,m.selectPrinter(t.activeSlug).then(function(){t.config=m.config}),t.selectTab=function(T){t.tabs=[!1,!1,!1,!1],t.tabs[T]=!0,t.activeTab=T};let S=!1;t.renderingVersion=0,t.toggleAll=!1,t.webcamUrl="/img/nowebcam.png",t.webcamRotate=0,t.webcammode=0,t.showCam=!0,t.webcamFull=!1,t.enableMode1=!1,t.enableMode2=!1,t.index=0,t.webcamRotateClass="",t.framerates=[{v:1,n:"1 fps"},{v:5,n:"5 fps"},{v:10,n:"10 fps"},{v:12,n:"12 fps"},{v:15,n:"15 fps"},{v:24,n:"24 fps"},{v:25,n:"25 fps"},{v:30,n:"30 fps"},{v:50,n:"50 fps"},{v:60,n:"60 fps"}],t.saveTimelapseCamera=function(){m.saveTimelapse()},t.videos={timelapses:[]},t.toggleVideos=function(){angular.forEach(t.videos.timelapses,function(T){T.selected=t.toggleAll})};let w="",M=function(){w.length>0&&(i.send("webcamCloseStream",{wcid:w}),w="")},C=function(){t.renderingVersion++,angular.forEach(t.videos.timelapses,function(T){switch(T.dateText=a("date")(T.createdSeconds*1e3,"medium"),T.enc=encodeURIComponent(T.dir),T.selected=!1,T.videoLink="/timelapse/video/"+n.activeSlug+"?entry="+T.enc+"&rand="+RSUtils.createAlphaID(10),T.renderVersion?T.renderVersion++:T.renderVersion=0,T.conversionMode){case-1:T.icon="fa fa-spinner fa-spin",T.edit=!1,T.sizeText='<?php _("Capturing") ?>';break;case 0:T.icon="fa fa-spinner fa-spin",T.edit=!0,T.sizeText='<?php _("Converting") ?>';break;case 1:T.icon="fa fa-spinner fa-spin",T.edit=!0,T.sizeText='<?php _("Converting") ?>';break;case 2:T.sizeText=a("byte")(T.videoLength),T.edit=!0,T.icon=void 0;break;case 3:T.icon="fa fa-warning",T.edit=!0,T.sizeText='<?php _("Failed") ?>';break;case 4:T.sizeText=a("byte")(T.videoLength),T.edit=!0,T.icon=void 0;break}})};t.$on("fullscreenChanged",function(){t.webcamFull=n.isFullscreen?t.webcamFull:!1,y()}),t.toggleFullscreen=function(){n.isFullscreen||(t.webcamFull=!0),g.toggleFullscreen($("#webcamArea")[0])};let E=function(){i.send("getTimelapseVideos",{}).then(function(T){t.videos=T,C()})};t.archiveVideo=function(T){v("",'<?php _("Copy Video to Project") ?>').then(function(O){i.send("projectMovieToProject",{serveruuid:O.serveruuid,projectuuid:O.uuid,timelapse:T.dir})},function(){})},t.edit=void 0,t.sliderOptions={floor:1,disableAnimation:!0,model:1,onChange:(T,O,D,F)=>{t.setImagePos(O)}},t.setImageUrl=function(){t.editimage="/timelapse/viewImage/"+n.activeSlug+"?entry="+t.edit.enc+"&image="+t.editImage};let P=!0;t.addImagePos=function(T){P&&(P=!1,T<0&&(T+=t.edit.imageCounter),t.editImage=(t.editImage+T)%t.edit.imageCounter,t.sliderOptions.model=t.editImage,t.setImageUrl())},t.setImagePos=function(T){t.editImage=T%t.edit.imageCounter,t.sliderOptions.model=t.editImage,t.setImageUrl()};let A,R=function(){t.editPlay>0?t.addImagePos(1):t.addImagePos(-1)};t.setPlay=function(T){t.editPlay=T,A&&(d.cancel(A),A=void 0),T!==0&&(t.editFPS=Math.abs(T)*10,A===void 0&&(A=d(R,1e3/t.editFPS)))},t.imageShown=function(){P=!0},t.updateViewMode=function(){f.setSetting("timelapseViewMode",n.globals.timelapseView.viewMode.toString())},t.updateHideFailed=function(){f.setSetting("timelapseViewFailed",n.globals.timelapseView.hideFailed.toString())},t.editVideo=function(T){t.edit=T,t.sliderOptions.ceil=T.imageCounter,t.index=1,t.editMode=0,t.editImage=0,t.editPlay=0,t.editFPS=10,t.setImageUrl()},t.deselectEditVideo=function(){t.edit=void 0,t.sliderOptions.ceil=0,t.index=0,t.editMode=0,t.editImage=0,t.editPlay=0,t.editFPS=10},t.toggleRecordSelection=function(T){T.selected=!T.selected},t.selectAllRecods=function(){angular.forEach(t.videos.timelapses,function(T){T.selected=!0})},t.deselectAllRecods=function(){angular.forEach(t.videos.timelapses,function(T){T.selected=!1})},t.deleteSelectedRecords=function(){h('<?php _("Security Question") ?>','<?php _("Really delete selected videos?") ?>','<?php _("Yes") ?>','<?php _("No") ?>',!0).then(function(){t.edit=void 0,t.selectTab(1),angular.forEach(t.videos.timelapses,function(T){T.selected&&l.get("/timelapse/delvideo/"+n.activeSlug+"?entry="+T.enc)})})},t.deleteVideo=function(T){h('<?php _("Security Question") ?>','<?php _("Really delete video?") ?>','<?php _("Yes") ?>','<?php _("No") ?>',!0).then(function(){t.edit=void 0,t.selectTab(1),l.get("/timelapse/delvideo/"+n.activeSlug+"?entry="+T.enc).then(function(){p.success('<?php _("Video deleted") ?>'),t.deselectEditVideo()})})},t.deleteImages=function(T){h('<?php _("Security Question") ?>','<?php _("Really delete all images?") ?>','<?php _("Yes") ?>','<?php _("No") ?>',!0).then(function(){l.get("/timelapse/delimages/"+n.activeSlug+"?entry="+T.enc).then(function(){p.success('<?php _("Images deleted") ?>'),T.conversionMode=4})})},t.closeEdit=function(){t.setPlay(0),t.deselectEditVideo(),t.edit=void 0},t.recreateVideo=function(T){l.get("/timelapse/recreateVideo/"+n.activeSlug+"?entry="+T.enc)},t.stopRecording=function(T){if(typeof T=="number"){angular.forEach(t.videos.timelapses,O=>{T===O.webcamId&&O.conversionMode===-1&&l.get("/timelapse/stoprecording/"+n.activeSlug+"?entry="+O.enc)}),E();return}l.get("/timelapse/stoprecording/"+n.activeSlug+"?entry="+T.enc),E()},t.startTimelapse=function(T){typeof T=="number"&&(l.get("/timelapse/startrecording/"+n.activeSlug+"?cam="+T),E())},t.$on("timelapseChanged",function(T,O){t.videos=O.data,C(),t.edit&&angular.forEach(t.videos.timelapses,function(D){if(D.dir===t.edit.dir){D.enc=encodeURIComponent(D.dir);let F=t.edit.conversionMode<2&&D.conversionMode>=2;t.edit=D,t.sliderOptions.ceil=D.imageCounter,F&&(t.edit.videoLink="/timelapse/video/"+n.activeSlug+"?entry="+D.enc+"&rand="+RSUtils.createAlphaID(10))}})}),E(),t.selectCam=function(){t.showCam=!0,x()},t.deselectCam=function(){t.showCam=!1,t.webcamUrl="/img/empty.png"},t.deselectVideo=function(){t.setPlay(0)},n.activeConfig.webcams&&n.activeConfig.webcams.length&&((n.activeConfig.webcams[t.activeCam].method&1)===1&&(t.webcammode=1,t.enableMode1=!0),(n.activeConfig.webcams[t.activeCam].method&2)===2&&(t.webcammode=2,t.enableMode2=!0)),t.$watch("webcammode",x);let k=function(T,O){let D=$(T);if(D.length===0)return;let F=D.parent();D[0].nodeName==="WEBSOCKET-CAMERA"&&(D=$("img",D));let B=D.width(),U=D.height(),G=0,Y=F.width(),re=1,N,z;switch(O){case 0:case 180:N=B,z=U;break;case 90:case 270:G=(B-U)/2,N=U,z=B;break}let ie=$(window).height()-(t.webcamFull?0:80),Z=0;t.webcamFull?(re=Y/N,re=Math.min(ie/z,re),Z=(ie/2+-U/2).toFixed(0)+"px"):(Y<N&&(re=Y/N),ie<z&&(re=Math.min(ie/z,re)));let ne="translateY("+Z+") scale("+re+") rotate("+O+"deg) ";D.css("-webkit-transform",ne),D.css("-ms-transform",ne),D.css("transform",ne),t.webcamFull?D.css("margin-top",0):(D.css("margin-top",((z*re-U)/2).toFixed(0)+"px"),re*z>0?F.height(re*z):F.css("height","auto"),$("#webcamArea").css("position","relative")),$(".reccam").css("left",(Y-B-2)/2+5+"px")},I=d(y,100),L=function(){!n.activeConfig||n.activeConfig.webcams.length===0||(t.webcammodes=[{id:0,name:'<?php _("Disabled") ?>'}],(n.activeConfig.webcams[t.activeCam].method&1)===1&&t.webcammodes.push({id:1,name:'<?php _("Poll Images") ?>'}),(n.activeConfig.webcams[t.activeCam].method&2)===2&&t.webcammodes.push({id:2,name:'<?php _("Motion JPG") ?>'}))};t.refreshWebcamImage=function(){t.webcammode===1&&t.showCam&&(t.webcamUrl="/printer/camjpg/"+n.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10))},t.$on("connected",function(){L(),x()}),t.$watch("activeConfig",function(){L()}),t.$watch("activeCam",function(){n.activeConfig.webcams&&n.activeConfig.webcams.length&&((n.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,M(),w=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+n.activeSlug+"?cam="+t.activeCam+"&wcid="+w,t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation):(n.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,S||(b(),S=!0)):t.webcamUrl="/img/nowebcam.png",y())}),t.$on("$destroy",function(){_=!0,t.webcammode=0,t.webcamUrl="/img/empty.png",t.setPlay(0),M(),d.cancel(I)}),t.formWebcam={$valid:!0},t.$watch("formWebcam.$valid",function(T){typeof T!="undefined"&&m.setError("webcam",t.formWebcam.$invalid)})}]);RSPrinterModule.controller("PrinterConsoleController",["$scope","$stateParams","RSCom","$rootScope","$timeout","RSOverview","P","$state","$interval","RSPrinter","User",function(t,e,i,r,n,o,a,l,h,u,c){let f=t.slug,d=!1,m=!0,p=0;t.dummy=0;let v=1,g="",_=-1,x=-1;t.local=u.local(),t.menuCommands=!1,t.wizardCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.closeWizards=function(){t.wizardCommands=!1},t.lastLogStart=0,t.webcam={};let b=/\b[TB]\d*:\s*[\d-]/,y=function(E){if(!(E.type&8)&&r.active.local.logFilterM105&&(E.text.indexOf("M105")!==-1||E.text.indexOf("M408")!==-1||E.text.indexOf("M409")!==-1||b.test(E.text)))return;let P=E.text.replace(/[<>]/ig,function(R){return"&"+(R===">"?"g":"l")+"t;"}),A=E.time+": "+P;g!==P?(r.active.log.push('<div class="log'+E.type+'">'+A+"</div>"),r.active.log.splice(0,r.active.log.length-500),v=1,g=P):(v++,r.active.log[r.active.log.length-1]='<div class="log'+E.type+'">'+A+" ("+v+")</div>"),m=!0,t.lastLogStart=E.id};t.checkCopyCommand=function(E){if(E.type==="click"&&E.target.className==="log1"){let P=E.target.innerHTML.split(": ");P=P.slice(1,P.length);let A=P.join(" "),R=k=>{let I=k.split(" ");I=I.slice(1,I.length);let L=I.join(" ");return L[0]==="N"?R(L):L};A[0]==="N"?t.cmd=R(A):t.cmd=A}},t.clearLog=function(){r.active.log=[],g="",p=t.lastLogStart,$("#logpanel").html("")},t.prefillLog=function(){let E=12+(r.active.local.logCommands>0?1:0)+(r.active.local.logACK>0?2:0);E===_&&x===r.active.local.logFilterM105||(_=E,x=r.active.local.logFilterM105,t.clearLog(),i.send("response",{filter:E,start:p}).then(function(P){r.active.log=[],angular.forEach(P.lines,function(A){y(A)})}))},t.prefillLog("firstInit"),t.$on("log",function(E,P){P.printer===f&&(r.active.local.logPause||y(P.data))}),n(function(){let E=document.getElementById("logpanel");E&&(E.scrollTop=E.scrollHeight)},200);let S=function(){if(!d){if(m){$("#logpanel").html(r.active.log.join(""));let E=document.getElementById("logpanel");E&&(E.scrollTop=E.scrollHeight),m=!1}n(S,100)}};r.cmdHistory||(r.cmdHistory=[]);let w=-1,M=function(E){r.cmdHistory.unshift(E),r.cmdHistory.length>100&&r.cmdHistory.pop(),w=-1};t.sendCmd=function(){M(t.cmd),i.send("send",{cmd:t.cmd}),t.cmd=""},t.walkHistory=function(E){E.key==="ArrowUp"&&w<r.cmdHistory.length-1?(w++,t.cmd=r.cmdHistory[w]):E.key==="ArrowDown"&&w>0&&(w--,t.cmd=r.cmdHistory[w])},t.sendGCode=function(E){M(E),i.send("send",{cmd:E})},t.sendQuickCommand=function(E){M('@quickCommand "'+E+'"'),i.send("sendQuickCommand",{name:E})},t.$on("$destroy",function(){i.send("hideMoves",{}),d=!0}),S(),t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!1,temperaturesAcc:!0,controlExtruder:!0,controlMove:!0,bed:!0});let C=function(){let E=r.active.state.activeExtruder,P=r.active.state.extruder?r.active.state.extruder.length:0;E!==void 0&&P>0&&(E=Math.min(E,P-1),t.retractSpeed=r.activeConfig.extruders[E].retractSpeed,t.extrudeSpeed=r.activeConfig.extruders[E].extrudeSpeed),t.extrudeDistance=10};t.$watch("active.state.activeExtruder",function(){C()}),t.$on("connected",function(){i.send("sendMoves",{})}),i.send("sendMoves",{}),C()}]);RSPrinterModule.controller("PrinterFilamentChangeController",["$scope","$stateParams","RSCom","$rootScope","$timeout","RSOverview","P","$state","$interval","RSPrinter","User",function(t,e,i,r,n,o,a,l,h,u,c){t.local=u.local(),t.menuCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.webcam={},t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!0,controlExtruder:!1,controlMove:!1,bed:!0}),r.frontend.setVisible("showFilamentchange",!0),r.active.status.online!==1&&l.go("printer.print",{slug:r.activeSlug}),function(){let d=r.active.state.activeExtruder;r.active&&r.active.state&&r.active.state.extruder&&r.active.state.extruder.length>0&&(t.retractSpeed=r.activeConfig.extruders[d].retractSpeed,t.extrudeSpeed=r.activeConfig.extruders[d].extrudeSpeed),t.extrudeDistance=10}(),t.$on("$destroy",function(){r.frontend.setVisible("showFilamentchange",!1)})}]);RSPrinterModule.controller("PrinterControlController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","$uibModal","User","RSPrinter","$state","$interval","$q","Flash","Fullscreen",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_){let x=null;t.webcam={},t.excludeColors=["#BB2F26","#BB5F27","#BAA428","#96BA28","#2BBA28","#28BAAB","#285FBA","#4728BA","#8C28BA","#BA287B"],t.sliderPos={x:0,y:0,z:0},t.preview2d=!0;let b=null;t.togglePreview2d=function(){event&&(event.stopPropagation(),event.preventDefault()),t.preview2d=!t.preview2d,t.preview2d&&y()},t.register3dView=B=>{b=B},t.menuCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.posText="",t.show3dMode=0,t.xSlider={floor:r.activeConfig.movement.xMin,ceil:r.activeConfig.movement.xMax,step:.01,precision:2,enforceStep:!1,showTicks:25,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(B){return B.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.xMoveTo(t.sliderPos.x):t.sliderPos.x=moveToXPos}},t.ySlider={floor:r.activeConfig.movement.yMin,ceil:r.activeConfig.movement.yMax,step:.01,precision:2,enforceStep:!1,showTicks:25,vertical:!0,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(B){return B.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.yMoveTo(t.sliderPos.y):t.sliderPos.y=moveToYPos}},t.zSlider={floor:r.activeConfig.movement.zMin,ceil:r.activeConfig.movement.zMax,step:.01,precision:2,enforceStep:!1,showTicks:25,vertical:!0,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(B){return B.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.zMoveTo(t.sliderPos.z):t.sliderPos.z=moveToZPos}},t.setPreview=function(B){var U;x=B,B&&(x.zoomEnabled=!0,x.fitBed(),x.onMove({x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos,de:0,t:(U=r.active.state.activeExtruder)!=null?U:0,w:0}),x.render())};let y=function(){if(r.active.status.jobid===0){t.layerData={};return}a.get("/printer/layeranalysis_job/"+e.slug+"?id="+r.active.status.jobid).then(function(B){let U=r.active.state.layer;t.layerData=O=B.data,O.totalLayer=O.layers.length-1,O.totalDuration=O.layers[O.totalLayer].t,O.totalHeight=O.layers[O.totalLayer].h,O.totalLines=O.layers[O.totalLayer].l;let G=O.layers.length-1;if(U>=G)return;let Y=O.layers[U-1],re=O.layers[U];a.get("/printer/layer_job/"+r.activeSlug+"?id="+r.active.status.jobid+"&start="+Y.p+"&end="+re.p).then(function(N){let z=N.data;x&&x.drawLastLayer(z,re.h)},function(){})},function(){})},S=()=>{let B=$(window).height(),U=$("#center-page").width();B===A&&U===P||(P=U,A=B,t.display=P<900?0:1,L(),C())},w=function(B){},M=function(B,U,G){let Y=B.toFixed(G);return"&nbsp;".repeat(U+G+1-Y.length)+Y},C=function(){if(L(),T(),w(f.printPermission&&t.idle),r.active.status.job!=="none"){let U=function(G){if(r.active.state.layer!==void 0){y();return}G>12||n(()=>{U(G+1)},500)};var B=U;U(0)}};t.local=d.local(),t.local===void 0&&m.go("home"),r.active.status.online!==1&&m.go("printer.print",{slug:r.activeSlug}),t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!1,temperaturesAcc:!0,controlExtruder:!0,controlMove:!0,bed:!0,hideSkirtOozeShield:!1}),t.menuList={},t.closeMenu=function(B){t.menuList[B]=!1},t.showExcludeRegion=!1,t.hsliderSize=300,t.display=-1,r.globals||(r.globals={}),angular.isObject(r.globals.control)||(r.globals.control={tempDiag:parseInt(f.getSetting("tempDiagMode","0")),tempDiagActive:parseInt(f.getSetting("tempDiagActive","0")),tempDiagAll:parseInt(f.getSetting("tempDiagAll","0")),tempDiagBed:parseInt(f.getSetting("tempDiagBed","0")),tempDiagChamber:parseInt(f.getSetting("tempDiagChamber","0"))}),function(){var G,Y;let B=r.active.state.activeExtruder,U=r.active.state.extruder?r.active.state.extruder.length:0;B!==void 0&&U>0&&(B=Math.min(B,U-1),t.retractSpeed=(G=r.activeConfig.extruders[B].retractSpeed)!=null?G:r.activeConfig.extruders[U-1].retractSpeed,t.extrudeSpeed=(Y=r.activeConfig.extruders[B].extrudeSpeed)!=null?Y:r.activeConfig.extruders[U-1].extrudeSpeed),t.extrudeDistance=10}();let P=0,A=0,R=-1,k=function(){R=-1};t.goFilamentchange=()=>{m.go("printer.filamentchange",{slug:t.activeSlug})};let I=function(){},L=function(){},T=()=>{var U;t.sliderPos.x=t.moveToXPos,t.sliderPos.y=t.moveToYPos,t.sliderPos.z=t.moveToZPos;let B=r.active.local.showAbsolutePositions;t.posText="<small>"+(B?"<?php _('Global Position') ?>":"<?php _('Local Position') ?>")+"</small><br><span class='reduced-text'>X:</span><span class='coord-text'>"+M(t.moveToXPos-(B?0:r.active.state.xOff),5,2)+" &nbsp;</span><span class='reduced-text'>Y:</span><span class='coord-text'>"+M(t.moveToYPos-(B?0:r.active.state.yOff),5,2)+" &nbsp;</span><span class='reduced-text'>Z:</span><span class='coord-text'>"+M(t.moveToZPos-(B?0:r.active.state.zOff),4,3)+"</span>"+(window.innerWidth>=900&&((U=r.active.state)!=null&&U.f)?"&nbsp;&nbsp;<span class='reduced-text'>F:</span><span class='coord-text-4'>"+M(r.active.state.f/60,4,0)+"</span><span class='reduced-text'> mm/s</span>":"")};t.toggleCoordinateSystem=function(B){t.prevent(B),r.active.local.showAbsolutePositions=!r.active.local.showAbsolutePositions,T()},t.addExcludeRegion=function(){x?(x.selectRectangle().then(function(B){let U={xmin:Math.min(B.start.x,B.end.x),xmax:Math.max(B.start.x,B.end.x),ymin:Math.min(B.start.y,B.end.y),ymax:Math.max(B.start.y,B.end.y)};U.xmax-U.xmin<=2||U.ymax-U.ymin<=2||i.send("addExcludeRegion",U)}),g.info("<?php _('Select region on printer grid.') ?>","",1e4,!0)):b&&b.toggleExcludeRegion()},t.delExcludeRegion=function(B){i.send("delExcludeRegion",d.excludeRegions[B])},t.$on("excludeRegionsStored",function(){x&&x.updateExcludeRegions()}),t.xMoveTo=function(B){t.$parent.moveToXPos=B,T(),r.active.state.x=B,i.send("move",{x:B,relative:!1})},t.yMoveTo=function(B){t.$parent.moveToYPos=B,T(),r.active.state.y=B,i.send("move",{y:B,relative:!1})},t.zMoveTo=function(B){t.$parent.moveToZPos=B,T(),r.active.state.z=B,i.send("move",{z:B,relative:!1})},t.prevent=function(B,U){B&&(B.stopPropagation(),B.preventDefault()),U&&(t.menuList[U]=!t.menuList[U])},t.toggle2DFullscreen=function(){_.toggleFullscreen($("#container-2d")[0])},t.fitPrinter=function(B){B&&(B.stopPropagation(),B.preventDefault()),x&&x.fitBed()},t.fitObject=function(B){B&&(B.stopPropagation(),B.preventDefault()),x&&O.xmin!==void 0&&x.fitArea(O.xmin,O.ymin,O.xmax,O.ymax,5)},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(B,U)=>{B==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,B==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,B==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,B&&U&&U.stopPropagation()},t.$on("$destroy",function(){i.send("hideMoves",{}),k()}),t.$watch("idle",function(){w(f.printPermission&&t.idle)}),S(),n(I,0),t.$on("windowResized",function(){S()}),t.$watch("activeConfig",function(){S()}),t.$watch("active.status.online",function(){S()}),t.$on("move",function(B,U){x&&x.onMove(U.data)}),t.speedChange=function(B){t.active.state.speedMultiply=B,i.send("setSpeedMultiply",{speed:t.active.state.speedMultiply})},t.$on("extruderPos",function(){T()}),t.extrudeDialog=function(B){i.send("send",{cmd:"T"+B+`
G92 E0`}),c.open({templateUrl:"/views/printer/control/printer.control.extrude.php?lang="+lang,scope:t,size:"sm",controller:["$scope",function(U){r.active.state.extruder.length>0&&(U.retractSpeed=r.activeConfig.extruders[B].retractSpeed,U.extrudeSpeed=r.activeConfig.extruders[B].extrudeSpeed),U.extrudeDistance=10}]})},t.$on("connected",function(){i.send("sendMoves",{})});let O={};i.send("sendMoves",{}),T(),r.cmdHistory||(r.cmdHistory=[]),t.cmd="";let D=-1,F=function(B){r.cmdHistory.unshift(B),r.cmdHistory.length>100&&r.cmdHistory.pop(),D=-1};t.sendCmd=function(){F(t.cmd),i.send("send",{cmd:t.cmd}),t.cmd=""},t.walkHistory=function(B){B.key==="ArrowUp"&&D<r.cmdHistory.length-1?(D++,t.cmd=r.cmdHistory[D]):B.key==="ArrowDown"&&D>0&&(D--,t.cmd=r.cmdHistory[D])},t.sendGCode=function(B){F(B),i.send("send",{cmd:B})},t.sendQuickCommand=function(B){F('@quickCommand "'+B+'"'),i.send("sendQuickCommand",{name:B})}}]);RSPrinterModule.controller("PrinterEepromController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter",function(t,e,i,r,n,o,a,l,h,u,c,f,d){r.frontend.setVisible("activeEEPROM",!0);let m=function(){let v=$(this),g=v.val().replace(/\\/g,"/").replace(/.*\//,"");t.uploading=!0,i.extendPing(300),$("#formuploadeeprom").ajaxSubmit({success:function(){t.uploading=!1,i.extendPing(0)},headers:{"X-Csrf-Token":i.getCookie("Csrf-Token")}}),g!==""&&v.val(""),t.$apply()};t.$on("$destroy",function(){r.frontend.setVisible("activeEEPROM",!1)});let p=function(){let v=$("#eepromFilenameUpload");v.length>0?v.on("change",m):setTimeout(p,100)};p(),d.readEEPROM()}]);RSPrinterModule.controller("PrinterKlipperConfigController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter","KlipperDialog","KlipperDialogInputShaping","StringDialog","$uibModal",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g){r.frontend.setVisible("activeKlipperConfig",!0),t.$on("$destroy",function(){r.frontend.setVisible("activeKlipperConfig",!1)}),t.page=0,t.actKlipper="",t.klipperConfig="",t.infoMsg="",t.klipperMenu=!1,t.showInstall=!1,t.configs=[],t.closeKlipperMenu=function(){t.klipperMenu=!1};function _(y){i.send("getKlipperStatus",{}).then(S=>{t.klipper=S,t.actKlipper&&(t.klipper.configs.filter(M=>M===t.actKlipper).length>0||(t.actKlipper="")),t.actKlipper.length===0&&t.klipper.configs.forEach(w=>{w===r.activeSlug&&(t.actKlipper=r.activeSlug)}),t.actKlipper.length===0&&t.klipper.configs.length>0&&(t.actKlipper=t.klipper.configs[0]),y&&b(t.actKlipper)},()=>{})}let x=/^.*-\d{8}_\d{6}$/,b=y=>{let S=!1;t.infoMsg="",y!==""?(t.klipper.installations.forEach(w=>{S|=w===y}),y===r.activeSlug?t.infoMsg="<?php _('This is the configuration of this printer.') ?>":S?t.infoMsg="<?php _('This is the configuration of an other active klipper installation') ?>":t.actKlipper.match(x)?t.infoMsg="<?php _('This is a backup of a configuration.') ?>":t.infoMsg="<?php _('This is a currently unused configuration.') ?>",i.send("getKlipperConfig",{config:y}).then(w=>{w.ok&&(t.klipperConfig=w.content)},()=>{})):(t.klipperConfig="",t.infoMsg=""),t.showInstall=!S};t.$watch("actKlipper",y=>{b(y)}),t.$on("reloadKlipperConfig",(y,S)=>{_(!0)}),t.goPage=function(y){t.page=y},t.showSampleConfigs=function(){t.closeKlipperMenu(),t.configs.length===0?i.send("getKlipperSampleConfigs",{}).then(y=>{t.configs=y.configs,console.log("configs",t.configs),t.actSample=t.configs[0],t.page=1},()=>{}):t.page=1},t.backupConfig=function(){t.closeKlipperMenu(),g.open({template:`<div class="modal-header">
    <h4 class="modal-title"><?php _('Klipper Backup Settings') ?></h4>
</div>
<div class="modal-body">

  <div class="form-group margin-top" >
    <div>
      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="edit.hideBackups"> <?php _('Hide Configuration Backups') ?>
        </label>
      </div>
      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="edit.delOldConfigBackups"> <?php _('Delete old Configurations') ?>
        </label>
      </div>
      <label><?php _('Klipper Version') ?></label>
      <select class="form-control" ng-model="edit.maxConfigBackups" ng-options="v.n as v.name for v in keepList"></select>
    </div>
    <div class="margin-top">
      <small class=""><?php _('The most recent x configuration backups will be available.') ?></small>
    </div>
  </div>

  <div class="clearfix"></div>

</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> <?php _('Close') ?></button>
  </div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User",function(y,S,w,M,C,E){y.keepList=[{n:0,name:"<?php _('No backups') ?>"},{n:1,name:"1"},{n:2,name:"2"},{n:3,name:"3"},{n:4,name:"4"},{n:5,name:"5"},{n:6,name:"6"},{n:7,name:"7"},{n:8,name:"8"},{n:9,name:"9"},{n:10,name:"10"}],y.edit=Object.assign({},{maxConfigBackups:5,delOldConfigBackups:!1,hideBackups:!1},S.activeConfig.properties.klipperBackups),y.close=function(){M.send("setPrinterSetting",{key:"klipperBackups",value:y.edit},S.activeSlug).then(()=>{_(!0)},()=>{}),w.close()}}],size:"lg",backdrop:"static"})},t.startInputShaping=function(){t.closeKlipperMenu(),p(t.actKlipper,!1,t.klipper.inputShapingInstalled).then(()=>{_(!0)})},t.installInputShaping=function(){t.closeKlipperMenu(),m("installInputShaping",t.actKlipper).then(()=>{_(!0)})},t.showInputShapingResults=function(){t.closeKlipperMenu(),p(t.actKlipper,!0).then(()=>{_(!1)})},t.installKlipper=function(){t.closeKlipperMenu(),m("install",t.actKlipper).then(()=>{_(!0)})},t.getKlipperLog=function(){t.closeKlipperMenu(),m("getKlipperLog",t.actKlipper).then(()=>{_(!0)})},t.updateKlipper=function(){t.closeKlipperMenu(),m("update",t.actKlipper).then(()=>{_(!0)})},t.uninstallKlipper=function(){t.closeKlipperMenu(),l("<?php _('Security Question') ?>","<?php _('Really uninstall this Klipper instance?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){m("uninstall",t.actKlipper).then(()=>{_(!1)})})},t.restartKlipper=function(){t.closeKlipperMenu(),i.send("klipperAction",{action:"restart",config:[t.actKlipper]})},t.createFirmware=function(){t.closeKlipperMenu(),m("createFirmware",t.actKlipper).then(()=>{_(!1)})},t.saveAs=function(y=!1){t.closeKlipperMenu(),v("<?php _('Create new Klipper Configuration') ?>","<?php _('Save configuration with new name. Note that you need to install a klipper instance if this is for a new printer. Only klipper instances with the slug name of your printer get used automatically.') ?>","","<?php _('Save') ?>").then(S=>{t.klipper.configs.includes(S)?c.error("","<?php _('Configuration with that name already exists!') ?>",1e4,!0):i.send("setKlipperConfig",{createNew:y,content:y?"":t.klipperConfig,config:S}).then(w=>{w.ok&&(t.klipper.configs.push(S),t.actKlipper=S,c.success("","<?php _('Configuration saved') ?>",2e3))})})},t.deleteConfig=function(){t.closeKlipperMenu(),l("<?php _('Security Question') ?>","<?php _('Really delete this configuration?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("klipperAction",{action:"deleteConfig",config:[t.actKlipper]}).then(y=>{y.ok&&(t.actKlipper="",t.klipperConfig="",i.send("sendEvent",{event:"reloadKlipperConfig"}),c.success("","<?php _('Configuration deleted') ?>",2e3))})},function(){})},t.saveConfig=function(){t.closeKlipperMenu(),t.actKlipper!==""&&i.send("setKlipperConfig",{config:t.actKlipper,content:t.klipperConfig}).then(y=>{y.ok&&(c.success("","<?php _('Configuration saved') ?>",2e3),t.actKlipper!==r.activeSlug||t.showInstall||!t.klipper.supportsRestart||i.send("send",{cmd:"FIRMWARE_RESTART"}))},()=>{})},t.downloadFirmware=function(){t.klipper.createdFirmware?window.open("/printer/klipperfw/"+r.activeSlug+"?a=download","ihelper"):c.error("Cannot download Firmware. Must create first!")},_(!0)}]);function gu(t){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i=/[&<>"'/]/ig;return t.replace(i,r=>e[r])}function yi(t,e,i,r){let n='<span class="'+i+'">'+(r===void 0?e:r)+"</span>",o="",a="",l="",h="",u=0,c=function(){return u===3||u===4?'<span class="v">'+gu(h)+"</span>":u===2?'<span class="p">'+gu(l)+"</span>":u===0?'<span class="cmd">'+gu(o)+"</span>":""};if(t.length>1&&(t[0]==="@"||t[1]==="@"))return n+'<span class="server">'+gu(t)+"</span>";for(let f=0;f<t.length;f++){let d=t[f];if(u===1){a+=d;continue}if(d===";"&&(n+=c(),u=1,a=";"),u===4){h+=d;continue}if(u===0){o+=d,d===" "&&(u=2,n+='<span class="cmd">'+gu(o)+"</span>",(d==="M117 "||d==="M118 "||d==="M23 "||d==="M28 "||d==="M29 "||d==="M30 "||d==="M32 ")&&(u=4,l=""));continue}if(u===2&&(l+=d,d>="A"&&d<="Z"||d>="a"&&d<="z")){n+=c(),u=3,h="";continue}u===3&&(h+=d,d===" "&&(n+=c(),u=2,l=""))}return a.length>0&&(a='<span class="comment">'+gu(a)+"</span>"),n+c()+a}RSPrinterModule.controller("PrinterRecoverController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter","$state",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){let p=!1;r.frontend.setVisible("activeRecover",!0),t.$on("$destroy",function(){r.frontend.setVisible("activeRecover",!1)});let v=r.active.recover,g=function(){v=r.active.recover,v.state===3?t.reason="<?php _('Lost Connection to Printer') ?>":v.state===4?t.reason="<?php _('Printer lost Power') ?>":v.state===2?t.reason="<?php _('Unknown Reason') ?>":v.state===-1&&!p?n(g,20):v.state===0&&m.go("printer.print"),t.startPos=v.lastACKPos};n(g,20);let _=function(){v=r.active.recover,v.lastExecKnown&&(t.startPos=v.lastExecPos);let b=0,y=[];angular.forEach(v.lines,function(S,w){t.startPos===S.p?(w&1)===1?y[w]='<div class="odd" id="marked_line">'+yi(S.g,b++,"line_add",S.p)+"</div>":y[w]='<div id="marked_line">'+yi(S.g,b++,"line_add",S.p)+"</div>":(w&1)===1?y[w]='<div class="odd">'+yi(S.g,b++,"line",S.p)+"</div>":y[w]="<div>"+yi(S.g,b++,"line",S.p)+"</div>"}),setTimeout(function(){$("#layercode").html(y.join(""));let S=document.getElementById("marked_line"),w=document.getElementById("layercode");w&&S&&(w.scrollTop=S.offsetTop-(w.offsetHeight-S.offsetHeight)*.5)},1)};_(),t.setStartPos=function(b){if(b.originalEvent.target?!b.originalEvent.target.className.startsWith("line"):!b.originalEvent.srcElement.className.startsWith("line"))return;let y=b.originalEvent.target?b.originalEvent.target.innerText:b.originalEvent.srcElement.innerText;console.log("select pos",y),t.startPos=y,_()},t.setStartPosDirectly=function(b){t.startPos=b,_()},t.startRecover=function(){r.active.recover.lastExecKnown&&(t.startPos=r.active.recover.lastExecPos),i.send("startRecover",{pos:t.startPos}).then(function(){m.go("printer.print")})},t.sendRecoverConnect=function(){i.send("sendRecoverConnect",{})},t.stopRecover=function(){l("<?php _('Confirmation required') ?>","<?php _('Really cancel interrupted print?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("cancelRecover",{}).then(function(){m.go("printer.print")})})};let x=r.$on("recoverChanged",function(b,y){y.printer===r.activeSlug&&y.data.state!==2&&y.data.state!==3&&y.data.state!==3&&m.go("printer.print"),y.printer===r.activeSlug&&_()});t.$on("$destroy",function(){p=!0,x()})}]);var Pa=class{constructor(e){this.options=e,this.loadingFullData=!1,this.id=0}assignModel(e,i){this.slug=e,this.id=i,this.source="model",this.info=null,this.layerData=null,this.layerInfo=null,this.layerInfoPromise=new Promise((r,n)=>{this.layerInfoResolve=r,this.layerInfoReject=n})}assignProject(e,i,r){this.serverid=e,this.projectid=i,this.id=r,this.source="project",this.info=null,this.layerData=null,this.layerInfo=null,this.layerInfoPromise=new Promise((n,o)=>{this.layerInfoResolve=n,this.layerInfoReject=o})}guess3dMemory(){let e=this.layerInfo.segments;return e?23*(e.countRetractions+e.countUnretractions+e.countSeams)+8*e.travelMoves+12*(e.travelSegments+e.travelMoves)+39*(e.extrusionMovesRegular+e.extrusionMovesSharp):0}async loadInfo(){if(await this.options.user.sessionStarted(),this.id===0){this.layerInfoResolve(this);return}if(this.source==="model"){let e=await ui.get("/printer/layeranalysis/"+this.slug+"?id="+this.id);this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l,this.layerInfo.layers[this.layerInfo.layers.length-1].p<100*1024*1024?(await this.loadData(),this.layerInfoResolve(this)):this.layerInfoResolve(this)}else if(this.source==="project"){let e=await ui.get(`/project/${this.serverid}/layeranalysis/${this.projectid}?id=`+encodeURIComponent(this.id));this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l,this.layerInfo.layers[this.layerInfo.layers.length-1].p<100*1024*1024?(await this.loadData(),this.layerInfoResolve(this)):this.layerInfoResolve(this)}else{let e=await ui.get("/printer/layeranalysis_job/"+this.slug+"?id="+this.id);this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l}}async loadData(){if(!(this.layerData||this.loadingFullData))if(this.loadingFullData=!0,await this.options.user.sessionStarted(),this.source==="model"){let e=await ui.get("/printer/layer_model_bin/"+this.slug+"?id="+this.id,{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}else if(this.source==="project"){let e=await ui.get(`/project/${this.serverid}/layer_bin/${this.projectid}?id=`+encodeURIComponent(this.id),{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}else{let e=await ui.get("/printer/layer_job_bin/"+this.slug+"?id="+this.id,{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}}readInt(){let e=this.reader.getInt32(this.readerPos,!0);return this.readerPos+=4,e}readFloat(){let e=this.reader.getFloat32(this.readerPos,!0);return this.readerPos+=4,e}readBlockObj(){let e=this.readInt(),i=e>>24,r=e&16777215,n=r/4,o=this.readerPos+r,a={t:i};switch(i){case 1:a.e=this.readInt(),a.s=this.readFloat(),a.w=this.readFloat(),a.x=this.readFloat(),a.y=this.readFloat();break;case 2:a.m=[],n/=2;for(let l=0;l<n;++l)a.m.push({x:this.readFloat(),y:this.readFloat()});break;case 3:a.m=[],n/=2;for(let l=0;l<n;++l)a.m.push({x:this.readFloat(),y:this.readFloat()});break;case 4:break;case 5:break;case 6:a.s=this.readFloat();break;case 7:a.e=this.readInt();break;case 8:a.w=this.readFloat();break;case 9:a.e=this.readInt(),a.color="#"+this.readInt().toString(16).padStart(6,"0");break;case 10:a.ft=this.readInt();break;case 11:a.w=this.readFloat(),a.h=this.readFloat();break;case 12:a.x=this.readFloat(),a.y=this.readFloat(),a.z=this.readFloat();break}return this.readerPos=o,a}fetchLayer(e){let i=this.layerInfo.layers[e-1],r=this.layerInfo.layers[e];if(r.p>this.reader.byteLength)return[];if(!i)return console.log("no previous layer",e),[];this.readerPos=i.p;let n=[];for(;this.readerPos<r.p;)n.push(this.readBlockObj());return n}};RSPrinterModule.controller("PrinterPreviewController",["$scope","$stateParams","$rootScope","$http","User","RSCom","$uibModal","$timeout","Fullscreen","Confirm","Flash",function(t,e,i,r,n,o,a,l,h,u,c){let f=new Pa({user:n}),d=!1;t.featureNameMap=ws,t.dummy=7,t.analyser=f,t.menuList={opt3d:!1},t.closeMenu=function(L){t.menuList[L]=!1},t.prevent=function(L,T){L&&(L.stopPropagation(),L.preventDefault()),T&&(t.menuList[T]=!t.menuList[T])},f.assignModel(e.slug,parseInt(e.model));let m=f.loadInfo(),p=null,v=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73"],g=null;t.gcodeChanged=!1,t.activeLayer=-1,t.editLayer=1,t.zoom2d=100;let _={},x=null,b=-1,y=0;t.percentSlider={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(L){return L.toFixed(0)}}},t.layerSlider={value:1,options:{floor:1,ceil:1,step:1,precision:0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(L){return L.toFixed(0)}}},t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:e.tab.length===0?0:parseInt(e.tab),extrusionWidth:.4,showExtruder:!1,show:0},t.previewOptions=Mt(Mt({},t.previewOptions),JSON.parse(n.getSetting("preview2dOptions",JSON.stringify(t.previewOptions)))),e.tab.length&&(t.previewOptions.showGcode=parseInt(e.tab)),t.$parent.previewData=e.model,t.exlist=[],t.model={},t.show3dLegend=document.body.clientWidth>500,t.show2dLegend=!0,t.featureHeadline="<?php _('Extruder') ?>",t.features=[],t.roundFeatures=[{name:"<?php _('Retract Filament') ?>",color:"#C9302C"},{name:"<?php _('Advance Filament') ?>",color:"#0000ff"}],t.updateLegend=({headline:L,features:T,roundFeatures:O})=>{t.featureHeadline=L,t.features=T,t.roundFeatures=O},t.toggle2DLegend=function(){t.show2dLegend=!t.show2dLegend},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(L,T)=>{L==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,L==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,L==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,L&&T&&T.stopPropagation()},t.saveDefault2dView=()=>{n.setSetting("preview2dOptions",JSON.stringify(t.previewOptions))},t.toggle2DFullscreen=function(){h.toggleFullscreen($("#container-2d")[0])},t.setPreview=function(L){g=L,L&&(g.zoomEnabled=!0,g.adjustPosZoom(),t.fitObject(),g.drawPreviewLayer(x,t.percentSlider.percent),t.refreshSlider())},t.height2d="70vh",t.heightGCode="70vh";let S=L=>{L===void 0&&(L=10),t.previewOptions.showGcode===0&&(window.innerHeight>500?l(()=>{let T=$("#container-2d");if(T.length){let O=T[0].getBoundingClientRect();t.height2d=Math.max(window.innerHeight-O.top-1,300).toFixed(0)+"px",window.scrollY=0}else L>0&&l(()=>{S(L-1)},50)},10):t.height2d="70vh"),t.previewOptions.showGcode===1&&(window.innerHeight>500?l(()=>{let T=$("#layercode");if(T.length){let O=T[0].getBoundingClientRect();t.heightGCode=Math.max(300,window.innerHeight-O.top-12).toFixed(0)+"px",window.scrollY=0}else L>0&&l(()=>{S(L-1)},50)},10):t.heightGCode="70vh")};t.$on("windowResized",()=>{S()}),t.imgurl=function(){return i.hasFeature(1)?"/dyn/render_image?q=models&id="+e.model+"&slug="+t.activeSlug+"&t=l":"/img/pro_l.png"};let w=0,M=0,C=function(L){if(L===t.activeLayer)return;let T=f.layerInfo.layers[L-1],O=f.layerInfo.layers[L];if(f.layerData)t.editLayer=t.activeLayer=L,t.durationElapsed=T.t,t.durationRemaining=f.layerInfo.layers[f.layerInfo.layers.length-1].t-O.t,t.duration=O.t-T.t,t.startTime=T.t,t.height=O.h,t.lineCount=O.l-T.l,x=f.fetchLayer(L),g&&g.drawPreviewLayer(x,t.percentSlider.percent);else{let D=++w;r.get("/printer/layer/"+i.activeSlug+"?id="+e.model+"&start="+T.p+"&end="+O.p).then(function(F){D<M||(M=D,t.editLayer=t.activeLayer=L,t.durationElapsed=T.t,t.durationRemaining=f.layerInfo.layers[f.layerInfo.layers.length-1].t-O.t,t.duration=O.t-T.t,t.startTime=T.t,t.height=O.h,t.lineCount=O.l-T.l,x=F.data,g&&g.drawPreviewLayer(x,t.percentSlider.percent))},function(){})}t.previewOptions.showGcode&&k(L)};t.update2dView=()=>{g&&g.drawPreviewLayer(x,t.percentSlider.percent)},t.percentSlider.options.onChange=()=>{g&&i.$applyAsync(()=>{g.drawPreviewLayer(x,t.percentSlider.percent)})};function E(){t.layerSlider.options.ceil=f.totalLayer,angular.forEach(i.activeConfig.extruders,function(L,T){t.exlist.push({col:v[T%v.length],name:"<?php _('Print Extruder @') ?>".replace("@",T+1)})}),C(1)}t.$on("gcodeInfoUpdated",function(L,T){T.data.modelId===e.model&&r.get("/printer/layeranalysis/"+e.slug+"?id="+e.model).then(function(O){setLayerdata(O.data)},function(){})});let P=[],A=0,R=function(){let L=A,T=[];angular.forEach(P,function(O,D){let F=_[""+(D+A)];if(F){let B=F.r.split(`
`);T[D]="",angular.forEach(B,function(U){U=U.trim(),U.length!==0&&((D&1)===1?T[D]+='<div class="odd">'+yi(U,L,"line_add")+"</div>":T[D]+="<div>"+yi(U,L,"line_add")+"</div>")}),F.d?(D&1)===1?T[D]+='<div class="odd" style="text-decoration: line-through;">'+yi(O,L++,"line_del")+"</div>":T[D]+='<div style="text-decoration: line-through;">'+yi(O,L++,"line_del")+"</div>":(D&1)===1?T[D]+='<div class="odd">'+yi(O,L++,"line")+"</div>":T[D]+="<div>"+yi(O,L++,"line")+"</div>"}else(D&1)===1?T[D]='<div class="odd">'+yi(O,L++,"line")+"</div>":T[D]="<div>"+yi(O,L++,"line")+"</div>"}),$("#layercode").html(T.join(""))},k=function(L){if(b===L||L<1||L>f.totalLayer)return;++y;let T=y,O=f.layerInfo.layers[L-1],D=f.layerInfo.layers[L];r.get("/printer/gcode/"+i.activeSlug+"?id="+e.model+"&start="+O.g+"&end="+D.g).then(function(F){T<y||(y=T,b=L,P=F.data.substring(0,F.data.length-1).split(`
`),A=O.l,R())},function(){})};t.download=function(){window.open("/printer/model/"+i.activeSlug+"?a=download&id="+e.model,"ihelper")},t.$watchCollection("previewOptions",function(L,T){L.showGcode!==T.showGcode&&t.toggle2DMenu(""),t.previewOptions.showGcode===1&&k(t.activeLayer),t.refreshSlider(),S()}),t.fitPrinter=function(){g&&g.fitBed()},t.fitObject=function(){g&&g.fitArea(f.layerInfo.xmin,f.layerInfo.ymin,f.layerInfo.xmax,f.layerInfo.ymax,2)},t.nextLayer=function(){t.activeLayer<f.totalLayer&&C(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&C(t.activeLayer-1)},t.layerChanged=function(){t.editLayer=parseInt(t.editLayer),t.editLayer<1&&(t.editLayer=1),t.editLayer>f.totalLayer&&(t.editLayer=f.totalLayer),C(t.editLayer)},t.layerSlider.options.onChange=()=>{t.layerChanged()},t.editLine=function(L){if(!i.user.canAddFiles||(L.originalEvent.target?!L.originalEvent.target.className.startsWith("line"):!L.originalEvent.srcElement.className.startsWith("line")))return;let T=L.originalEvent.target?L.originalEvent.target.innerText:L.originalEvent.srcElement.innerText;a.open({templateUrl:"/views/printer/control/printer.editgcode.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(O){O.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},O.edit=angular.copy(_[T]),O.edit||(O.edit={d:!1,r:""}),O.addOrig=function(){O.edit.r=(O.edit.r.trim()+`
`+O.orig).trim()+`
`,O.edit.d=!0},O.addPause=function(){O.edit.r=(O.edit.r.trim()+`
@pause Do your stuff`).trim()+`
`},O.line=T,O.orig=P[parseInt(T)-A],O.$on("modal.closing",function(){O.edit.r=O.edit.r.trim(),O.edit.d||O.edit.r.length>0?(!_[T]||angular.toJson(_[T])!==angular.toJson(O.edit))&&(_[T]=O.edit,t.gcodeChanged=!0,R()):_[T]&&(delete _[T],t.gcodeChanged=!0,R())})}]}).result.catch(function(O){})},t.refreshSlider=function(){l(function(){t.$broadcast("rzSliderForceRender")})},t.saveGCode=function(){t.model.gcodePatch=angular.toJson(_),o.send("setModelInfo",t.model).then(function(){t.gcodeChanged=!1})},t.printGCode=function(L,T){if(!T&&!i.activeConfig.general.enableQueue){c.error("<?php _('Queue is disabled') ?>");return}if(i.active.state.condition!==1&&(T=!1),L.fits)t.preparePrint=!0,o.send("copyModel",{id:L.id,autostart:T}).then(function(){t.preparePrint=!1}),T?c.success("<?php _('Print started.') ?>"):c.success("<?php _('Print copied to print queue.') ?>");else{let O=i.activeConfig.shape.basicShape,D=i.activeConfig.movement,F=`<table class="table table-bordered table-hover"><tr><th><?php _('Parameter') ?></th><th><?php _('Print') ?></th><th><?php _('Printer') ?></th></tr>`;O.shape==="circle"?F+=`<tr class="${L.radius>O.radius?"bg-danger":""}"><td><?php _('Radius Printed') ?></td><td>${L.radius}</td><td>${O.radius}</td></tr>`:(F+=`<tr class="${L.xMin<O.xMin||L.xMax>O.xMax?"bg-danger":""}"><td><?php _('Print') ?> X</td><td>${L.xMin.toFixed(2)}..${L.xMax.toFixed(2)}</td><td>${O.xMin.toFixed(2)}..${O.xMax.toFixed(2)}</td></tr>`,F+=`<tr class="${L.yMin<O.yMin||L.yMax>O.yMax?"bg-danger":""}"><td><?php _('Print') ?> Y</td><td>${L.yMin.toFixed(2)}..${L.yMax.toFixed(2)}</td><td>${O.yMin.toFixed(2)}..${O.yMax.toFixed(2)}</td></tr>`),O.shape!=="zbelt"&&(F+=`<tr class="${L.zMin<D.zMin||L.zMax>D.zMax?"bg-danger":""}"><td><?php _('Print') ?> Z</td><td>${L.zMin.toFixed(2)}..${L.zMax.toFixed(2)}</td><td>${D.zMin.toFixed(2)}..${D.zMax.toFixed(2)}</td></tr>`),F+=`<tr class="${L.xMinMove<D.xMin||L.xMaxMove>D.xMax?"bg-danger":""}"><td><?php _('Move') ?> X</td><td>${L.xMinMove.toFixed(2)}..${L.xMaxMove.toFixed(2)}</td><td>${D.xMin.toFixed(2)}..${D.xMax.toFixed(2)}</td></tr>`,F+=`<tr class="${L.yMinMove<D.yMin||L.yMaxMove>D.yMax?"bg-danger":""}"><td><?php _('Move') ?> Y</td><td>${L.yMinMove.toFixed(2)}..${L.yMaxMove.toFixed(2)}</td><td>${D.yMin.toFixed(2)}..${D.yMax.toFixed(2)}</td></tr>`,F+="</table>",u("<?php _('Security question') ?>","<?php _('According to your defined printer limits, this print will not fit inside your printer. Print anyway?') ?>",null,null,null,F).then(function(){t.preparePrint=!0,o.send("copyModel",{id:L.id,autostart:T}).then(function(B){t.preparePrint=!1,B.ok?T?c.success("<?php _('Print started.') ?>"):c.success("<?php _('Print copied to print queue.') ?>"):c.error(B.error)})})}},t.$on("$destroy",function(){d=!0,t.$parent.previewData=0});let I=o.send("modelInfo",{id:parseInt(e.model)}).then(function(L){t.model=L,_=angular.fromJson(t.model.gcodePatch)});Promise.all([I,m]).then(()=>{E()}),S()}]);var nT=hn(Qz());RSPrinterModule.controller("PrinterGCodesController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$http","Confirm","RSOverview","$state","P","$uibModal","Flash","GSettings","$filter","User","RSPrinter","StringDialog","WaitSelectorAppear","GoogleDrive","RSDropbox","RSBrowseFolder","SelectProject",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_,x,b,y,S){let w=function(){t.delAnimation=!1},M=function(){C.sortModelsBy=r.globals.gcodeView.sortBy,C.modelFilter=r.globals.gcodeView.filter,C.activeGroup=r.globals.gcodeView.group,v.sortModelsFor(r.activeSlug)};t.activeQueue=!1,t.uploading=!1,t.preparePrint=!1,t.delAnimation=!1,t.groups=[],t.dbox=b,t.selectSFile=!1,t.bfolder=y,t.in={openUrl:""},t.disk={},t.menuDirect=!1,t.menuReprint=!1,t.menuUpload=!1,t.menuAction=!1,t.menuModel={},t.uploadProgress=0,t.recentPrints=[],t.recentPrintsGroup="#",t.toggleAutostartZbelt=function(){v.setAutostartNextPrint(r.active.state.autostartNextPrint)},t.closeDirect=function(){t.menuDirect=!1},t.closeUpload=function(){t.menuUpload=!1},t.closeReprint=function(){t.menuReprint=!1},t.closeAction=function(){t.menuAction=!1},t.closeModel=function(I){t.menuModel[I]=!1},t.downloadGCode=function(I){t.menuModel[I]=!1,window.open("/printer/model/"+r.activeSlug+"?a=download&id="+I,"ihelper")};let C=v.local();C===void 0&&h.go("home"),t.$on("$destroy",function(){window.handleUpload&&delete window.handleUpload,window.quickuploadHandler&&delete window.quickuploadHandler}),r.globals||(r.globals={});let E=()=>{i.send("listLastPrints",{}).then(I=>{t.recentPrints=I.prints})};t.$on("lastPrintsChanged",()=>{E()}),E(),t.printRecent=I=>{i.send("lastPrintAction",{action:"print",file:I.name}).then(L=>{L.ok&&f.success("<?php _('Print started') ?>")}),t.menuReprint=!1},t.queueRecent=I=>{i.send("lastPrintAction",{action:"queue",file:I.name}).then(L=>{L.ok&&f.success("<?php _('G-Code queued') ?>")}),t.menuReprint=!1},t.copyRecent=I=>{i.send("lastPrintAction",{action:"copy",file:I.name,group:t.recentPrintsGroup}).then(L=>{L.ok&&f.success("<?php _('G-Code copied') ?>")}),t.menuReprint=!1},t.deleteRecent=I=>{i.send("lastPrintAction",{action:"delete",file:I.name}).then(L=>{L.ok&&f.success("<?php _('G-Code deleted') ?>")}),t.menuReprint=!1};let P=angular.fromJson(p.getSetting("gcodeGroup","{}"));r.globals.gcodeView||(r.globals.gcodeView={sortBy:parseInt(p.getSetting("gcodeSortBy","0")),viewMode:parseInt(p.getSetting("gcodeViewMode","0")),filter:"",page:1,perPage:20}),r.globals.gcodeView.group=P[t.activeSlug]?P[t.activeSlug]:"#",C.sortModelsBy=r.globals.gcodeView.sortBy,C.modelFilter=r.globals.gcodeView.filter,C.activeGroup=r.globals.gcodeView.group;let A=function(){i.send("listModelGroups",{}).then(function(I){let L=r.globals.gcodeView.group==="*";t.groups=[{id:"*",name:"<?php _('Group: All') ?>"}],angular.forEach(I.groupNames,function(T){L=L||T===r.globals.gcodeView.group,T==="#"?t.groups.push({id:"#",name:"<?php _('Group: Default') ?>"}):t.groups.push({id:T,name:"<?php _('Group:') ?> "+T})}),L||(r.globals.gcodeView.group="#",t.selectGroup()),t.groupsel=angular.copy(t.groups),t.groupsel.splice(0,1)})};A(),t.$on("modelGroupListChanged",function(){A()}),t.addGroup=function(){g("<?php _('Create Group') ?>","<?php _('Name of Group (min. 2 chars)') ?>","").then(function(I){i.send("addModelGroup",{groupName:I}).then(function(L){L.ok===!0&&(r.globals.gcodeView.group=I,t.selectGroup())})},function(){})},t.renameGroup=function(){g("<?php _('Rename Group') ?>","<?php _('Name of Group (min. 2 chars)') ?>",r.globals.gcodeView.group).then(function(I){if(I.length<2){f.error("<?php _('Group name too short.') ?>");return}i.send("renameModelGroup",{oldGroupName:r.globals.gcodeView.group,newGroupName:I}).then(function(L){L.ok===!0&&(r.globals.gcodeView.group=I,t.selectGroup())},function(){})},function(){})},t.delFilesInGroup=function(){a("<?php _('Security question') ?>","<?php _('Do you really want to delete all files in this group?') ?>").then(function(){t.delAnimation=!0;let I=0;n(function(){let L=angular.copy(t.active.models);angular.forEach(L,function(T){i.send("removeModel",{id:T.id}).then(function(){I++,I===L.length&&n(w,500),t.checkDisk()})})},50)},function(){})},t.delGroup=function(){if(!(r.globals.gcodeView.group==="#"||r.globals.gcodeView.group==="*")){if(t.active.models.length===0){i.send("delModelGroup",{groupName:r.globals.gcodeView.group,delFiles:!1}).then(function(){r.globals.gcodeView.group="#",t.selectGroup(),t.checkDisk()});return}c.open({templateUrl:"/views/printer/control/printer.print.delgroup.html?lang="+lang,size:"sm",controller:["$scope",function(I){I.infoText="Really delete group $1?".replace("$1",r.globals.gcodeView.group),I.delFiles=!1,I.confirmYes=function(){i.send("delModelGroup",{groupName:r.globals.gcodeView.group,delFiles:I.delFiles}).then(function(){r.globals.gcodeView.group="#",t.selectGroup(),I.$close()},function(){})}}]})}},t.selectGroup=function(){r.globals.gcodeView.page=1,P[t.activeSlug]!==r.globals.gcodeView.group&&(P[t.activeSlug]=r.globals.gcodeView.group,p.setSetting("gcodeGroup",angular.toJson(P))),M(r.globals.gcodeView.sortBy)},t.updateViewMode=function(){p.setSetting("gcodeViewMode",r.globals.gcodeView.viewMode.toString())},t.sortIcon=function(I){let L=I&254;return L===(r.globals.gcodeView.sortBy&254)?L===r.globals.gcodeView.sortBy?"fa-sort-asc":"fa-sort-desc":"fa-unsorted"},t.SortBy=function(I){let L=r.globals.gcodeView.sortBy,T=r.globals.gcodeView.sortBy&1,O=I&254;O===(r.globals.gcodeView.sortBy&254)?r.globals.gcodeView.sortBy=O+(1-T):r.globals.gcodeView.sortBy=I,L!==r.globals.gcodeView.sortBy&&p.setSetting("gcodeSortBy",r.globals.gcodeView.sortBy.toString()),M()},t.selectQueue=function(I,L){let T=L.target;t.activeQueue=I,$(T).tooltip({title:`<div style="width:200px;text-align:left"><h4><?php _('Job Informations') ?></h4><?php _('Printing time') ?>: `+m("hms")(I.printTime)+"<br>Extrusion: "+Math.ceil(I.filamentTotal)+" mm</div>",html:!0,placement:"right",trigger:"hover click"})},t.dequeQueue=function(I){i.send("removeJob",{id:I.id}).then(function(){t.activeQueue=!1})};let R=!0,k;t.queueOrderMoved=I=>{t.queueNotActive().splice(I,1)},t.onQueueDragStart=function(I){R=!1},t.onQueueDragEnd=function(I){let L=[];r.active.status.jobid&&L.push(r.active.status.jobid),L.push(...t.queueNotActive().map(T=>T.id)),R=!0,i.send("reorderJobs",{jobs:L}).then(function(){v.fetchPrintqueueFor(r.activeSlug)})},t.queueActive=function(){let I=r.active.status.jobid;return r.active.queue.filter(L=>L.id===I)},t.queueNotActive=function(){if(!R&&k)return k;let I=r.active.status.jobid,L=r.active.queue.filter(O=>O.id!==I),T=!k||k.length!==L.length;if(!T)for(let O=0;O<k.length;O++)T|=k[O]!==L[O];return T&&(k=L),k},t.printQueue=function(I){t.preparePrint=!0,i.send("startJob",{id:I.id}).then(function(){t.preparePrint=!1})},t.setQueueRepeat=function(I,L){L=L<1?1:L,i.send("setRepeatJob",{id:I.id,repeat:L}).then(function(){v.fetchPrintqueueFor(r.activeSlug),I.repeat=L})},t.$on("jobFinished",()=>{v.fetchPrintqueueFor(r.activeSlug)}),t.uploadGCode=function(){c.open({templateUrl:"/views/printer/dialog/uploadGCode.php?lang="+lang,controller:["$scope","$uibModalInstance","Flash",function(I,L,T){I.uploadGCode=function(O){$("#formuploadgcode").ajaxSubmit({success:function(){L.close();let D=typeof O=="object"?O:JSON.parse(O);D.error===void 0?T.success("<?php _('Upload finished') ?>"):T.error("<?php _('Upload failed') ?>: "+D.error)},headers:{"X-Csrf-Token":i.getCookie("Csrf-Token")}})},I.close=function(){L.dismiss()},I.noFile=function(){return $("#gcodeFilenameUpload").val().length===0}}]})},t.preparing=!1,t.$on("prepareJob",function(I,L){L.printer===r.activeSlug&&(t.preparing=!0)}),t.$on("prepareJobFinished",function(I,L){L.printer===r.activeSlug&&(t.preparing=!1)}),t.printGCode=function(I,L){if(!L&&!r.activeConfig.general.enableQueue){f.error("Queue is disabled");return}if(r.active.state.condition!==1&&(L=!1),I.fits)t.preparePrint=!0,i.send("copyModel",{id:I.id,autostart:L}).then(function(){t.preparePrint=!1});else{let T=r.activeConfig.shape.basicShape,O=r.activeConfig.movement,D=`<table class="table table-bordered table-hover"><tr><th><?php _('Parameter') ?></th><th><?php _('Print') ?></th><th><?php _('Printer') ?></th></tr>`;T.shape==="circle"?D+=`<tr class="${I.radius>T.radius?"bg-danger":""}"><td><?php _('Radius Printed') ?></td><td>${I.radius}</td><td>${T.radius}</td></tr>`:(D+=`<tr class="${I.xMin<T.xMin||I.xMax>T.xMax?"bg-danger":""}"><td><?php _('Print') ?> X</td><td>${I.xMin.toFixed(2)}..${I.xMax.toFixed(2)}</td><td>${T.xMin.toFixed(2)}..${T.xMax.toFixed(2)}</td></tr>`,D+=`<tr class="${I.yMin<T.yMin||I.yMax>T.yMax?"bg-danger":""}"><td><?php _('Print') ?> Y</td><td>${I.yMin.toFixed(2)}..${I.yMax.toFixed(2)}</td><td>${T.yMin.toFixed(2)}..${T.yMax.toFixed(2)}</td></tr>`),T.shape!=="zbelt"&&(D+=`<tr class="${I.zMin<O.zMin||I.zMax>O.zMax?"bg-danger":""}"><td><?php _('Print') ?> Z</td><td>${I.zMin.toFixed(2)}..${I.zMax.toFixed(2)}</td><td>${O.zMin.toFixed(2)}..${O.zMax.toFixed(2)}</td></tr>`),D+=`<tr class="${I.xMinMove<O.xMin||I.xMaxMove>O.xMax?"bg-danger":""}"><td><?php _('Move') ?> X</td><td>${I.xMinMove.toFixed(2)}..${I.xMaxMove.toFixed(2)}</td><td>${O.xMin.toFixed(2)}..${O.xMax.toFixed(2)}</td></tr>`,D+=`<tr class="${I.yMinMove<O.yMin||I.yMaxMove>O.yMax?"bg-danger":""}"><td><?php _('Move') ?> Y</td><td>${I.yMinMove.toFixed(2)}..${I.yMaxMove.toFixed(2)}</td><td>${O.yMin.toFixed(2)}..${O.yMax.toFixed(2)}</td></tr>`,D+="</table>",a("<?php _('Security question') ?>","<?php _('According to your defined printer limits, this print will not fit inside your printer. Print anyway?') ?>",null,null,null,D).then(function(){t.preparePrint=!0,i.send("copyModel",{id:I.id,autostart:L}).then(function(){t.preparePrint=!1})})}},t.queueFileSelected=function(I){return I.id===t.activeQueue.id},t.previewGCode=function(I,L){h.go("printer.preview",{model:I,tab:L})},t.copyToProject=function(I){S("","<?php _('Copy G-Code to Project') ?>").then(function(L){i.send("projectGCodeToProject",{serveruuid:L.serveruuid,projectuuid:L.uuid,modelid:I.id})},function(){})},t.tryDeleteModel=function(I){a("<?php _('Security question') ?>","<?php _('Do you really want to delete $1?') ?>".replace("$1",I.name)).then(function(){t.delAnimation=!0,n(function(){i.send("removeModel",{id:I.id}).then(function(){f.success("<?php _('File deleted') ?>"),n(w,500),t.checkDisk()})},50)})},t.newModelName=function(I){I.name.length===0&&(I.name="Unknown"),i.send("renameModel",{id:I.id,newName:I.name}).then(L=>{L.ok||f.error("<?php _('Renaming failed!') ?>")})},t.info=function(I){c.open({templateUrl:"/views/printer/control/printer.price.dialog.php?lang="+window.lang,scope:t,controller:["$scope",function(L){L.plist=[],L.noteEdit=!1,L.model=I,L.groupsel=angular.copy(t.groups),L.groupsel.splice(0,1);let T=r.serverSettings.pricing,O=T.map;L.$on("modal.closing",function(){angular.forEach(L.plist,function(F){L.model.materials[F.idx]=F.filament.u}),i.send("setModelInfo",L.model)});function D(F){if(!F)return 0;let B=0;return angular.forEach(T.filaments,function(U,G){U.u===F&&(B=G)}),B}L.filaments=T.filaments,L.currency=T.currency,angular.forEach(I.volumeUsage,function(F,B){F<=0||L.plist.push({idx:B,extruder:B+1,mm:I.extruderUsage[B],volume:F*.001,price:0,filament:T.filaments[D(I.materials[B])],weight:0})}),L.updateCalc=function(){L.weightTotal=0,L.total=T.perPrint+T.perHour*I.printTime/3600,angular.forEach(L.plist,function(F){F.weight=F.volume*F.filament.w,L.weightTotal+=F.weight,F.price=F.weight*F.filament.p/1e3,L.total+=F.price})},L.selectGroup=function(){i.send("moveModelFileToGroup",{id:I.id,groupName:I.group}).then(function(){t.selectGroup()})},L.close=function(){angular.forEach(L.plist,function(F,B){O[B.toString()+"_"+t.slug]=F.filament.u}),L.$close()},L.updateCalc()}]})},t.updateFilter=function(){t.delAnimation=!0,n(function(){C.modelFilter=r.globals.gcodeView.filter,v.sortModelsFor(r.activeSlug),n(w,500)},50)},v.sortModelsFor(r.activeSlug),t.handleUpload=function(){let I=$("#gcodeFilenameUpload"),L=I.val().replace(/\\/g,"/").replace(/.*\//,""),T=L.lastIndexOf("."),O="";T>0&&(O=L.substring(T+1)),(O==="g"||O==="gco"||O==="gcode"||O==="bgcode"||O==="3mf")&&(L=L.substring(0,T));let D=I.get(0).files[0].size;i.send("canUploadGCodeWithSize",{size:D}).then(function(F){if(F.ok){t.uploading=!0,t.uploadProgress=0;let B=()=>{t.uploading=!1,I.val(""),n(t.checkDisk,180*1e3)},U=re=>{t.uploadProgress=re},G="/printer/model/"+t.activeSlug,Y=[];for(let re of I.get(0).files)Y.push({name:re.name.replace(/\\/g,"/").replace(/.*\//,""),filename:re});i.uploadFiles({url:G,a:"upload",group:r.globals.gcodeView.group,files:Y},U).then(B).catch(function(re){console.log(re)}),L!==""&&I.val("")}else f.error("","<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},window.handleUpload=t.handleUpload,window.quickuploadHandler=function(){let I=$("#quickFilenameUpload"),L=I.val().replace(/\\/g,"/").replace(/.*\//,""),T=L.lastIndexOf("."),O="";T>0&&(O=L.substr(T+1)),(O==="g"||O==="gco"||O==="gcode"||O==="bgcode")&&(L=L.substr(0,T)),$("#quickUploadName").val(L);let D=I.get(0).files[0].size;i.send("canUploadGCodeWithSize",{size:D}).then(function(F){if(F.ok){t.uploading=!0,t.uploadProgress=0;let B=()=>{t.uploading=!1,I.val(""),n(t.checkDisk,180*1e3)},U=re=>{t.uploadProgress=re},G="/printer/job/"+t.activeSlug,Y=[];for(let re of I.get(0).files)Y.push({name:re.name.replace(/\\/g,"/").replace(/.*\//,""),filename:re});i.uploadFiles({url:G,a:"upload",autostart:Y.length===1?"1":"0",files:Y},U).then(B).catch(function(re){console.log(re)}),L!==""&&I.val("")}else f.error("","<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},t.importLink=function(I,L){if((0,nT.isURL)(t.in.openUrl,{protocols:["http","https"],require_tld:!0,require_protocol:!0,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,host_whitelist:!1,host_blacklist:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,disallow_auth:!0,validate_length:!0})){let T=[{name:"",url:t.in.openUrl,job:I,autostart:L}];console.log("arr",T),i.send("importURL",{files:T,folder:r.globals.gcodeView.group}).then(function(){f.success("<?php _('File(s) import started') ?>")})}},t.importUrlValid=!1,t.$watch("in.openUrl",()=>{t.importUrlValid=(0,nT.isURL)(t.in.openUrl,{protocols:["http","https"],require_tld:!0,require_protocol:!0,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,host_whitelist:!1,host_blacklist:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,disallow_auth:!0,validate_length:!0})}),t.dropbox=function(I){Dropbox.choose({success:function(L){let T=[],O=0;angular.forEach(L,function(D){T.push({name:D.name,url:D.link,job:I}),O+=D.bytes}),i.send("canUploadGCodeWithSize",{size:O}).then(function(D){D.ok?(_.show("Uploading Files",10),i.send("importURL",{files:T,folder:r.globals.gcodeView.group}).then(function(F){F.ok?_.bindToMsgId(F.msgId):_.hide()},function(){_.hide()})):f.error("","<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},cancel:function(){},linkType:"direct",multiselect:!0})},t.googledrive=function(){x.select().then(function(I){console.log("returned selection ",I)})},t.importFolderPath=function(I){if(I.isDir){y.activeFolderPath=I.path,y.updateFiles("");return}if(!r.activeConfig.general.enableQueue&&t.importAsJob&&r.active.status.jobid!==0)return;_.show("Uploading Files",10);let L=[{name:I.name,url:"folder://"+y.selectedFolder+I.path,job:t.importAsJob}];i.send("importURL",{files:L,folder:r.globals.gcodeView.group}).then(function(T){T.ok?_.bindToMsgId(T.msgId):_.hide()},function(){_.hide()}),t.selectSFile=!1},t.abortFileSelection=function(){t.selectSFile=!1},t.selectedFolderChanged=function(){y.activeFolderPath="",y.updateFiles()},t.importPath=function(I,L){t.selectSFile=!0,t.importAsJob=L,y.selectedFolder=I.id,y.activeFolderPath="",y.filter="gcode",y.updateFiles()},t.importSelectedFiles=function(I){let L=[],T=0;angular.forEach(y.filesInPath,function(O){O.selected&&(L.push({name:O.name,url:"folder://"+y.selectedFolder+O.path,job:t.importAsJob,autostart:I}),T+=O.size)}),L.length!==0&&(I===void 0&&(I=L.length===1),!(!r.activeConfig.general.enableQueue&&t.importAsJob&&(L.length!==1||r.active.status.jobid!==0))&&i.send("canUploadGCodeWithSize",{size:T}).then(function(O){O.ok?(_.show("Uploading Files",10),i.send("importURL",{files:L,folder:r.globals.gcodeView.group}).then(function(D){D.ok?_.bindToMsgId(D.msgId):_.hide()},function(){_.hide()}),t.selectSFile=!1):f.error("","<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)}))},t.importAllFiles=function(){angular.forEach(y.filesInPath,function(I){I.isDir||(I.selected=!0)}),t.importSelectedFiles(void 0)}}]);RSPrinterModule.controller("PrinterLogsController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","RSOverview","P","Flash","GSettings",function(t,e,i,r,n,o,a,l,h,u,c){t.printLogs=[],r.frontend.setVisible("logs",!0),t.$on("$destroy",function(){r.frontend.setVisible("logs",!1)}),t.refreshLogs=function(){i.send("listLogs",{}).then(function(f){t.printLogs=f.logs,t.active=f.active})},t.deleteLog=function(f){i.send("removeLog",{log:f.name}).then(function(){t.refreshLogs()})},t.deleteAllLogs=function(){let f=angular.copy(t.printLogs);angular.forEach(f,function(d){t.deleteLog(d)})},t.encName=function(f){return encodeURIComponent(f.name)},t.refreshLogs(),r.$watch("serverSettings.logIdle",function(){c.serverSettingsChanged()}),r.$watch("serverSettings.logPrint",function(){c.serverSettingsChanged()})}]);RSPrinterModule.controller("PrinterHistoryController",["$scope","$uibModal","RSCom","$rootScope","$timeout","$filter","RSOverview","P","Flash","User",function(t,e,i,r,n,o,a,l,h,u){r.frontend.setVisible("history",!0),t.$on("$destroy",function(){r.frontend.setVisible("history",!1)}),t.stateTexts=["<?php _('Printing') ?>","<?php _('Printed') ?>","<?php _('Aborted') ?>"],t.filter={start:0,limit:50,slug:t.activeSlug,uuid:"",allPrinter:!1,page:0},t.list=[],t.summary=[],t.year=new Date().getFullYear(),t.monthNames=["<?php _('January') ?>","<?php _('February') ?>","<?php _('March') ?>","<?php _('April') ?>","<?php _('May') ?>","<?php _('June') ?>","<?php _('July') ?>","<?php _('August') ?>","<?php _('September') ?>","<?php _('October') ?>","<?php _('November') ?>","<?php _('December') ?>"];function c(){i.send("historyList",t.filter).then(function(d){if(d.list.length===0&&t.filter.start>0){t.filter.start-=t.filter.limit;return}t.list=d.list})}function f(d){i.send("historySummary",{year:t.year,slug:t.filter.slug,allPrinter:t.filter.allPrinter}).then(function(m){t.summary=[],angular.forEach(t.monthNames,function(v,g){t.summary.push({month:v,start:new Date(d,g+1,1)/1e3,end:new Date(g===11?d+1:d,g===11?1:g+2,1)/1e3,filament:0,realTime:0,computedTime:0,numPrints:0,numAborted:0,numFinished:0,costs:0,style:{}})}),t.summary.push({month:"<?php _('Total') ?>",filament:0,realTime:0,computedTime:0,numPrints:0,numAborted:0,numFinished:0,costs:0,style:{"font-weight":"bold"}});let p=t.summary[12];angular.forEach(m.list,function(v){let g=t.summary[v.month-1];g.filament+=v.filament,g.realTime+=v.real>0?v.real:0,g.computedTime+=v.computed,g.numPrints+=v.num,g.numFinished+=v.finished,g.numAborted+=v.aborted,g.costs+=v.costs,p.filament+=v.filament,p.realTime+=v.real>0?v.real:0,p.computedTime+=v.computed,p.numPrints+=v.num,p.numFinished+=v.finished,p.numAborted+=v.aborted,p.costs+=v.costs})},function(){})}t.historyForward=function(){t.filter.start>0&&(t.filter.start-=t.filter.limit,c())},t.historyBack=function(){t.filter.start+=t.filter.limit,c()},t.statAddYear=function(d){t.year+=d,f(t.year)},t.deleteHistory=function(d){r.user.canHistory()&&i.send("historyDeleteEntry",{id:d.id}).then(function(){c(),f(t.year)})},t.editHistory=function(d){(r.user.canHistory||d.username===r.user.login)&&e.open({templateUrl:"/views/printer/control/printer.edithistory.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(m){m.edit={id:d.id,notes:d.notes},m.$on("modal.closing",function(){i.send("historySetNote",m.edit).then(function(){d.notes=m.edit.notes})}),setTimeout(function(){let p=document.getElementById("historyNote");p&&p.focus()},200)}]})},t.updateAll=function(){t.filter.start=0,c(),f(t.year)},t.export=function(){if(!r.hasWebcamSupport)return;let d=t.filter;d.page===0?window.open("/printer/export/"+d.slug+"?a=history_entries&all="+(d.allPrinter?"1":"0"),"ihelper"):window.open("/printer/export/"+d.slug+"?a=history_summary&all="+(d.allPrinter?"1":"0")+"&year="+t.year,"ihelper")},t.showReport=function({id:d,printerSlug:m}){window.open("/printer/export/"+m+"?a=history_report&id="+d,"_blank")},c(),f(t.year)}]);RSPrinterModule.factory("SelectPrinters",["$uibModal",function(t){return function(e){let i=t.open({templateUrl:"/views/printer/config/selectPrinters.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter",function(r,n,o,a){r.headline=e,r.slug=o.activeSlug,r.selections={},r.checkAll=!1,r.cancel=function(){n.dismiss()},r.unselectCheckAll=()=>{r.checkAll=!1},r.selectAllPrinters=()=>{angular.forEach(o.printerList,function(l){l&&(r.selections[l.slug]=!r.checkAll)})},r.selectPrinters=function(){let l=[];angular.forEach(r.selections,function(h,u){h&&(console.log(o.printerConfig[u]),l.push(o.printer[u].status))}),n.close({list:l})}}],size:"lg"});return i.result.catch(function(r){}),i.result}}]);RSPrinterModule.factory("RSPrinterConfig",["$rootScope","$q","RSCom","RSOverview","Flash","User",function(t,e,i,r,n,o){let a={},l="",h={},u={editSlug:"",scriptNames:[{name:"activate",title:"<?php _('Run on printer activation') ?>"},{name:"deactivate",title:"<?php _('Run on printer deactivation') ?>"},{name:"start",title:"<?php _('Run before job') ?>"},{name:"end",title:"<?php _('Run after job') ?>"},{name:"kill",title:"<?php _('Run if job is aborted') ?>"},{name:"pause",title:"<?php _('Run on pause') ?>"},{name:"continue",title:"<?php _('Run on continue') ?>"},{name:"connect",title:"<?php _('Run on connect') ?>"},{name:"connectReset",title:"<?php _('Run on reset') ?>"},{name:"shutdown",title:"<?php _('Shutdown printer') ?>"},{name:"remove_filament",title:"<?php _('Remove filament') ?>"},{name:"insert_filament",title:"<?php _('Insert filament') ?>"},{name:"insert_filament_finished",title:"<?php _('After insert filament') ?>"},{name:"before_snapshot",title:"<?php _('Before snapshot') ?>"},{name:"after_snapshot",title:"<?php _('After snapshot') ?>"},{name:"door_opened",title:"<?php _('Door opened') ?>"},{name:"door_closed",title:"<?php _('Door closed') ?>"}],toolNames:["<?php _('Extruder') ?>","<?php _('Milling head') ?>","<?php _('Laser') ?>","<?php _('Syringe') ?>","<?php _('Heated Chamber') ?>"],toolIcons:["rs rs-extruder","rs rs-mill","rs rs-laser","rs rs-syringe","rs rs-chamber"],toolDiameterName:["<?php _('Nozzle diameter') ?>","<?php _('Milling width') ?>","<?php _('Laser diameter') ?>","<?php _('Syringe diameter') ?>","<?php _('Diameter') ?>"],scripts:{},includes:[],loadedIncludes:{},scriptChanged:function(f){return this.scripts[f].command!==a[f].command},config:{buttonCommands:!1,movement:{},gcodeReplacements:[],responseEvents:[],flowPresets:[],fanPresets:[],speedPresets:[],quickCommands:[],wizardCommands:[],wizardTemplates:[],general:{},connection:{connectionMethod:0},shape:{basicShape:{}}}},c=function(){let f=0,d=e.defer(),m=!0;return f=u.scriptNames.length,o.showFeature("printer-configure-gcodes-includes")?(f++,i.send("getIncludes",{name:name.name}).then(function(p){u.includes=p.includes,angular.forEach(u.includes,v=>{u.loadedIncludes[v.name]=Object.assign({},v)}),u.loadedIncludeNames=u.includes.map(v=>v.name),f--,f===0&&(m?d.resolve():d.reject())},function(){f--,m=!1,f===0&&d.reject()})):(u.includes=[],u.loadedIncludeNames=[],u.loadedIncludes={}),angular.forEach(u.scriptNames,function(p){i.send("getScript",{name:p.name}).then(function(v){a[p.name]=v,u.scripts[p.name]=Object.assign({},v),f--,f===0&&(m?d.resolve():d.reject())},function(){f--,m=!1,f===0&&d.reject()})}),d.promise};return u.refreshWizards=function(){u.config.wizardCommands=angular.copy(t.printerConfig[u.editSlug].wizardCommands)||{}},u.hasErrors=function(){let f=!1;return angular.forEach(h,function(d){f|=d}),f},u.setError=function(f,d){h[f]=d},u.selectPrinter=function(f){let d=e.defer();return r.printerListLoadedPromise.then(function(){r.selectPrinter(f),u.editSlug=f,u.config=angular.copy(t.printerConfig[f])||{},u.config.buttonCommands&&u.config.buttonCommands.sort(function(m,p){return m.name<p.name?-1:1}),l=angular.toJson(u.config),a={},u.refreshPorts().then(c).then(function(){d.resolve(),console.log("config loaded",u)}).catch(function(){d.reject()}),h={}}),d.promise},u.hasIncludeChanged=f=>!u.loadedIncludes[f.name]||f.command!==u.loadedIncludes[f.name].command,u.hasConfigChanged=function(){let f=l!==angular.toJson(u.config);return angular.forEach(u.scriptNames,function(d){f|=u.scriptChanged(d.name)}),angular.forEach(u.includes,function(d){f|=u.hasIncludeChanged(d)}),f},u.save=function(f){let d=e.defer();if(u.hasErrors())return d.reject(),d.promise;let m=u.config.extruders.length-1;angular.forEach(u.config.extruders,function(v,g){v.num=g,v.tempMaster>m&&(v.tempMaster=v.num),v.num!==v.tempMaster&&(v.maxTemp=u.config.extruders[v.tempMaster].maxTemp)});let p=0;return t.activeConfig.general&&(u.config.general.active=t.activeConfig.general.active),i.send("setPrinterConfig",u.config,u.editSlug).then(function(){angular.forEach(u.scriptNames,function(_){p++,u.scriptChanged(_.name)&&(o.showFeature("add-printer")||o.showFeature("printer-configure-gcodes"))?i.send("setScript",{name:_.name,script:u.scripts[_.name].command}).then(function(){a[_.name]=Object.assign({},u.scripts[_.name]),p--,p===0&&(n.success("<?php _('Configuration saved') ?>","",2e3),d.resolve())}):p--});let v=u.includes.map(_=>_.name),g=JSON.stringify(v)!==JSON.stringify(u.loadedIncludeNames);angular.forEach(u.includes,function(_){u.hasIncludeChanged(_)&&(p++,g=!1,i.send("setInclude",{order:v,include:_}).then(()=>{p--,p===0&&(n.success("<?php _('Configuration saved') ?>","",2e3),d.resolve())}))}),g&&(p++,i.send("setInclude",{order:v,include:{}}).then(()=>{p--,p===0&&(n.success("<?php _('Configuration saved') ?>","",2e3),d.resolve())})),p===0&&((typeof f=="undefined"||f!==!1)&&n.success("<?php _('Configuration saved') ?>","",2e3),d.resolve())}),d.promise.then(function(){l=angular.toJson(u.config)}),d.promise},u.savePrinterSetup=function(f){let d=e.defer();return i.send("savePrinterSetup",u.config,u.editSlug).then(function(){(typeof f=="undefined"||f!==!1)&&n.success("<?php _('Setup saved') ?>","",2e3),d.resolve()}),d.promise},u.saveTimelapse=function(){let f=e.defer();return i.send("setPrinterTimelapseConfig",u.config,u.editSlug).then(function(){f.resolve()}),f.promise.then(function(){l=angular.toJson(u.config)}),f.promise},u.reset=function(){angular.copy(t.printerConfig[slug],u.config),angular.copy(a,u.scripts),h={}},u.refreshPorts=function(){let f=e.defer();return i.send("listPorts",{}).then(function(d){u.ports=d,f.resolve()}).catch(function(){f.reject()}),f.promise},u}]).controller("PrinterConfigController",["RSPrinterConfig","$scope","resA","RSFirmware","RSCom","RSPrinter","$state","PrinterConditionDialog","$rootScope",function(t,e,i,r,n,o,a,l,h){e.menuPort=!1,e.$watch("editor.general.name",function(){e.cheadline="<?php _('Printer Settings $') ?>".replace("$",e.editor.general.name)}),e.showFilamentsensorNames=!1,e.actFirmware=null,e.isKlipper=!1,e.$watch("editor.general.firmwareName",function(){e.actFirmware=r.firmwareInfoMap[e.editor.general.firmwareName],e.actFirmware&&(e.isKlipper=e.actFirmware.style=="klipper",e.showFilamentsensorNames=e.actFirmware.style=="klipper",e.isKlipper&&(e.editor.connection.serial.pingPong=!0,e.editor.connection.connectionMethod=0))}),e.conMethods=[{i:0,n:"<?php _('Serial Connection') ?>"},{i:1,n:"<?php _('Pipe/UNIX Socket') ?>"},{i:2,n:"<?php _('TCP/IP Connection') ?>"},{i:3,n:"DuetControlServer"}],e.doorModes=[{i:0,n:"<?php _('Ignore door state') ?>"},{i:1,n:"<?php _('Show warning') ?>"},{i:2,n:"<?php _('Pause and prevent XYZ moves') ?>"}],e.serverSettings.ServerOS===0&&(e.conMethods.splice(1,1),e.conMethods.splice(2,1)),e.resetOrder=[{i:0,n:"<?php _('Low to High') ?>"},{i:1,n:"<?php _('High to Low') ?>"},{i:2,n:"<?php _('Low') ?>"},{i:3,n:"<?php _('High') ?>"}],e.maxParallelCommands=[{i:0,n:"<?php _('No Limit') ?>"}];for(let u=1;u<=128;u++)e.maxParallelCommands.push({i:u,n:""+u});e.showPrinterCondition=function(){l(h.activeSlug)},e.editor=t.config,e.config=t,e.firmware=r,e.menuOpen=!1,e.testsOpen=0,e.openConTests=[],e.conTestResults=[],e.editor.connection.serial.dtr<0&&(e.editor.connection.serial.dtr=0),e.editor.connection.serial.rts<0&&(e.editor.connection.serial.rts=0),e.closeMenu=function(){e.menuOpen=!1},e.showPrinter=function(u){let c=o.getActivePage(u,{state:"printer.print",params:{slug:u}});a.get(c.state)?a.go(c.state,c.params):a.go("printer.print",c.params)},e.sendNextTest=function(){if(e.openConTests.length>0){let u=e.openConTests.shift();e.runningTest=u,n.send("communicationTest",u).then(function(){},function(){e.testsOpen--})}},e.$on("communicationTestResult",function(u,c){!c.data.error&&c.data.resendsShort<.5&&c.data.resends<.5&&c.data.resends<.5?c.data.bgClass="bg-success":!c.data.error&&c.data.resendsShort<1&&c.data.resends<1&&c.data.resends<1?c.data.bgClass="bg-warning":c.data.bgClass="bg-danger",e.conTestResults.push(c.data),e.testsOpen--,e.sendNextTest()}),e.testThisConfig=function(){e.testsOpen||(e.openConTests=[{pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:e.editor.connection.serial.maxParallelCommands}],e.testsOpen=1,e.sendNextTest())},e.testMultipleConfigs=function(){if(e.testsOpen)return;e.openConTests=[{pingPong:!0,buffer:127,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:63,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:127,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:255,parallelCommands:e.editor.connection.serial.maxParallelCommands}];let u=e.editor.connection.serial.inputBufferSize;!e.editor.connection.serial.pingPong&&u!==63&&u!==127&&u!==255&&u!==511&&e.openConTests.push({pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:e.editor.connection.serial.maxParallelCommands}),e.testsOpen=e.openConTests.length,e.sendNextTest()},e.clearTests=function(){e.conTestResults=[]},e.assignTest=function(u){e.editor.connection.serial.pingPong=u.pingPong,e.editor.connection.serial.inputBufferSize=u.bufferSize},e.templateAdd=function(u){u.push({name:"",value:100})},e.templateDel=function(u,c){u.splice(c,1)}}]).controller("PrinterConfigAdvancedController",["RSPrinterConfig","$scope","RSCom","$rootScope",function(t,e,i,r){e.activeCam=e.editor.webcams.length>0?0:-1,e.webcamMethods=[{id:0,t:"<?php _('No Webcam') ?>"},{id:1,t:"<?php _('JPG Images') ?>"},{id:2,t:"<?php _('MJPG Stream') ?>"},{id:3,t:"<?php _('JPG + MJPG Stream') ?>"}],e.frameratesTimelapse=[{v:1,n:"1 fps"},{v:5,n:"5 fps"},{v:10,n:"10 fps"},{v:12,n:"12 fps"},{v:15,n:"15 fps"},{v:24,n:"24 fps"},{v:25,n:"25 fps"},{v:30,n:"30 fps"},{v:50,n:"50 fps"},{v:60,n:"60 fps"}],e.resolutions=[{id:1,w:640,h:480,n:"640x480"},{id:2,w:320,h:240,n:"320x240"},{id:3,w:160,h:120,n:"160x120"},{id:4,w:800,h:600,n:"800x600"},{id:5,w:960,h:720,n:"960x720"},{id:6,w:1280,h:720,n:"1280x720"},{id:7,w:1280,h:960,n:"1280x960"},{id:26,w:1280,h:1024,n:"1280x1024"},{id:8,w:1920,h:1080,n:"1920x1080"},{id:27,w:2560,h:2160,n:"2560x1440"},{id:28,w:3840,h:2160,n:"3840x2160"},{id:29,w:4096,h:2160,n:"4096x2160"},{id:9,w:176,h:144,n:"176x144"},{id:10,w:320,h:176,n:"320x176"},{id:11,w:432,h:240,n:"432x240"},{id:12,w:352,h:288,n:"352x288"},{id:13,w:544,h:288,n:"544x288"},{id:14,w:640,h:360,n:"640x360"},{id:15,w:752,h:416,n:"752x416"},{id:16,w:800,h:448,n:"800x448"},{id:17,w:864,h:480,n:"864x480"},{id:18,w:960,h:544,n:"960x544"},{id:19,w:1024,h:576,n:"1024x576"},{id:20,w:1184,h:656,n:"1184x656"},{id:21,w:1392,h:768,n:"1392x768"},{id:22,w:1504,h:832,n:"1504x832"},{id:23,w:1600,h:896,n:"1600x896"},{id:24,w:1712,h:960,n:"1712x960"},{id:25,w:1792,h:1008,n:"1792x1008"},{id:26,w:1536,h:864,n:"1536x864"},{id:27,w:2304,h:1296,n:"2304x1296"},{id:28,w:4608,h:2592,n:"4608x2592"}],e.wcm={manageable:!1,mode:"",framerate:15,version:0},e.cam={resolution:e.resolutions[0],framerate:0,selectedWebcam:void 0},e.framerates=[1,5,10,15,20,24,25,30],e.addWebcam=function(){e.editor.webcams.push({dynamicUrl:"",method:3,orientation:0,pos:0,reloadInterval:3,staticUrl:"",timelapseBitrate:1e3,timelapseFramerate:30,timelapseHeight:.1,timelapseInterval:20,timelapseLayer:1,timelapseMethod:1,timelapseSelected:0,forceSnapshotPosition:!1,snapshotX:.5*(e.editor.movement.xMin+e.editor.movement.xMax),snapshotY:e.editor.movement.yMax,snapshotDelay:800,snapshotStabilizeTime:50}),e.activeCam=e.editor.webcams.length-1},e.delWebcam=function(){e.activeCam<0||(e.editor.webcams.splice(e.activeCam,1),e.editor.webcams.length<=e.activeCam&&(e.activeCam=e.editor.webcams.length-1))},e.$watch("formWebcam.$valid",function(o){typeof o!="undefined"&&t.setError("webcam",e.formWebcam.$invalid)});let n=function(o){e.wcm=o;let a=!1;angular.forEach(e.wcm.webcams,function(l){!a&&l.accessible&&(e.cam.selectedWebcam===void 0||e.cam.selectedWebcam.port===l.port)&&(e.cam.selectedWebcam=l)}),e.wcm.version>=2&&(e.cam.framerate=e.wcm.framerate,e.cam.resolution=e.resolutions[0],angular.forEach(e.resolutions,function(l){l.w===e.wcm.width&&l.h===e.wcm.height&&(e.cam.resolution=l)}))};e.updateWCM=function(){i.send("webcamStatus",{cmd:"status"}).then(function(o){n(o)})},e.canOpenStreamer=()=>e.cam.selectedWebcam&&e.cam.selectedWebcam.accessible&&e.cam.selectedWebcam.urlBackend,e.openStreamer=()=>{let o=e.cam.selectedWebcam.urlBackend.replace("127.0.0.1",location.hostname);console.log("open streamer",o),window.open(o,"_blank")},e.wcmAssign=function(){let o=e.cam.selectedWebcam;e.editor.webcams[e.activeCam].method=3,e.editor.webcams[e.activeCam].dynamicUrl=e.cam.selectedWebcam.urlMjpg,e.editor.webcams[e.activeCam].staticUrl=e.cam.selectedWebcam.urlSnapshot},e.wcmSetResolution=function(){i.send("webcam",{cmd:"setResolution",width:e.cam.resolution.w,height:e.cam.resolution.h,framerate:e.cam.framerate}).then(function(){r.$broadcast("refreshWebcam",null)})},e.wcmCmd=function(o){i.send("webcam",{cmd:o}).then(function(){o==="remove"&&(e.editor.webcams[e.activeCam].method=0),o==="restart"&&r.$broadcast("refreshWebcam",null)})},e.$on("webcamChanged",function(o,a){n(a.data)}),e.updateWCM()}]).controller("PrinterConfigExtruderController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Confirm","$rootScope","RSFirmware",function(t,e,i,r,n,o,a){e.hswStep=0;let l=!1;e.config=t,e.generalSettingsExtruder=[],e.generalSettingsFans=[],e.firmware=a.firmwareInfoMap[e.editor.general.firmwareName],e.isRepRap=e.firmware&&e.firmware.style==="reprapfirmware",e.isKlipper=e.firmware&&e.firmware.style==="klipper",e.showHeaterName=e.isKlipper||e.isRepRap,e.showFanName=e.firmware&&e.klipper,e.canSetPrecision=e.isKlipper||e.isRepRap,e.showFilamentsensorNames=e.isKlipper,e.$on("$destroy",function(){l=!0}),e.heaterIcons=r.heaterIcons,e.gcodeManualEntrys=[{i:0,n:"<?php _('Filament cooling fan') ?>"},{i:1,n:"<?php _('Heater Controlled Fan') ?>"},{i:2,n:"<?php _('Board Cooler Fan') ?>"},{i:3,n:"<?php _('Generic Fan') ?>"}],e.bedTempUp=function(c,f){let d=e.editor.heatedBeds[c].temperatures[f-1],m=e.editor.heatedBeds[c].temperatures[f];e.editor.heatedBeds[c].temperatures.splice(f-1,2,m,d)},e.bedTempDown=function(c,f){let d=e.editor.heatedBeds[c].temperatures[f],m=e.editor.heatedBeds[c].temperatures[f+1];e.editor.heatedBeds[c].temperatures.splice(f,2,m,d)},e.bedTempDel=function(c,f){e.editor.heatedBeds[c].temperatures.splice(f,1)},e.bedTempAdd=function(c){e.editor.heatedBeds[c].temperatures.push({name:"",temp:50})},e.chamberTempUp=function(c,f){let d=e.editor.heatedChambers[c].temperatures[f-1],m=e.editor.heatedChambers[c].temperatures[f];e.editor.heatedChambers[c].temperatures.splice(f-1,2,m,d)},e.chamberTempDown=function(c,f){let d=e.editor.heatedChambers[c].temperatures[f],m=e.editor.heatedChambers[c].temperatures[f+1];e.editor.heatedChambers[c].temperatures.splice(f,2,m,d)},e.chamberTempDel=function(c,f){e.editor.heatedChambers[c].temperatures.splice(f,1)},e.chamberTempAdd=function(c){e.editor.heatedChambers[c].temperatures.push({name:"",temp:50})},e.extTempUp=function(c,f){let d=c.temperatures[f-1],m=c.temperatures[f];c.temperatures.splice(f-1,2,m,d)},e.extTempDown=function(c,f){let d=c.temperatures[f],m=c.temperatures[f+1];c.temperatures.splice(f,2,m,d)},e.extTempDel=function(c,f){c.temperatures.splice(f,1)},e.extTempAdd=function(c){c.temperatures.push({name:"50\xB0C",temp:50})},e.moveExtruder=function(c,f){console.log("move",c,f),e.editor.extruders[c].temperatures.splice(f,1)},e.addBed=function(){e.editor.heatedBeds.push({heatupPerSecond:.1,lastTemp:0,offset:0,maxTemp:110,cooldownPerSecond:.1,setPrecision:0,temperatures:e.editor.heatedBeds.length===0?[]:angular.copy(e.editor.heatedBeds[0].temperatures)})},e.delBed=function(c,f){e.editor.heatedBeds.splice(c,1),f&&f.preventDefault()},e.addChamber=function(){e.editor.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,offset:0,maxTemp:110,sensorType:1,firmwareName:"",alias:"",cooldownPerSecond:.1,supportTemperature:!0,unit:"\xB0C",setPrecision:0,temperatures:e.editor.heatedChambers.length===0?[]:angular.copy(e.editor.heatedChambers[0].temperatures)})},e.delChamber=function(c,f){e.editor.heatedChambers.splice(c,1),f&&f.preventDefault()},e.addExtruder=function(){let c=e.editor.extruders.length,f=e.editor.extruders.length===0?!1:e.editor.extruders[e.editor.extruders.length-1];e.editor.extruders.push({num:c,eJerk:f?f.eJerk:40,maxSpeed:f?f.maxSpeed:30,acceleration:f?f.acceleration:5e3,extrudeSpeed:f?f.extrudeSpeed:2,retractSpeed:f?f.retractSpeed:20,heatupPerSecond:f?f.heatupPerSecond:1.5,lastTemp:0,maxTemp:f?f.maxTemp:260,cooldownPerSecond:f?f.cooldownPerSecond:1,offsetX:0,offsetY:0,offset:f?f.offset:0,toolType:f?f.toolType:0,setPrecision:0,toolDiameter:f?f.toolDiameter:.4,supportTemperature:f?f.supportTemperature:!0,tempMaster:c,changeFastDistance:f?f.changeFastDistance:20,changeSlowDistance:f?f.changeSlowDistance:20,filamentDiameter:f?f.filamentDiameter:1.75,temperatures:f?angular.copy(f.temperatures):[]})},e.addFan=function(){e.editor.fans.push({alias:"",firmwareName:"",fanType:0,firmwareId:e.editor.fans.length,min:0,max:100,readOnly:!1})},e.delFan=function(c,f){e.editor.fans.splice(c,1),f&&f.preventDefault()},e.removeExtruder=function(c,f){n("<?php _('Security Question') ?>","<?php _('Really delete this extruder?') ?>",null,null,!0).then(function(){e.editor.extruders.splice(c,1)}),f&&f.preventDefault()},e.$watch("formExtruder.$valid",function(c){typeof c!="undefined"&&t.setError("extruder",e.formExtruder.$invalid)}),e.hswStart1=function(){e.hswStep=1,e.config.save(),e.hwsMeasurements=[],angular.forEach(e.editor.heatedBeds,function(c,f){e.hwsMeasurements.push({id:1e3+f,name:"<?php _('Heated Bed') ?>",target:Math.min(50,c.maxTemp)})}),angular.forEach(e.editor.extruders,function(c,f){c.num===c.tempMaster&&c.supportTemperature&&e.hwsMeasurements.push({id:f,name:"<?php _('Extruder') ?> "+(f+1),target:Math.min(200,c.maxTemp)})})};let h=function(c){return c===0?"<?php _('Heating') ?>":c===1?"<?php _('Holding') ?>":c===2?"<?php _('Cooling') ?>":"<?php _('Finished') ?>"},u=function(){let c=!0,f=new Date().getTime();angular.forEach(e.hwsMeasurements,function(d){if(d.actTemp=d.id>=1e3?o.active.state.heatedBeds[d.id-1e3].tempRead:o.active.state.extruder[d.id].tempRead,d.mode===0)c=!1,d.actTemp>=d.target&&(d.mode=1,d.modeText=h(1),d.upEndTime=f,d.holdEndTime=f+d.holdTime);else if(d.mode===1)f>d.holdEndTime&&(d.mode=2,d.modeText=h(2),d.holdEndTime=f,d.cooldownStartTemp=d.actTemp,d.id>=1e3?o.RSPrinter.setBedTemperature(0,d.id-1e3):o.RSPrinter.setExtruderTemperature(d.id,0)),c=!1;else if(d.mode===2&&(c=!1,d.actTemp<=d.coolTarget)){d.mode=3,d.modeText=h(3),d.downEndTime=f;let m=d.id>=1e3?e.editor.heatedBeds[d.id-1e3]:e.editor.extruders[d.id];m.heatupPerSecond=(d.target-d.startTemp)*1e3/(d.upEndTime-d.startTime),m.cooldownPerSecond=(d.cooldownStartTemp-d.coolTarget)*1e3/(d.downEndTime-d.holdEndTime)}}),!c&&!l?i(u,500):c&&(e.hswStep=3,angular.forEach(e.editor.extruders,function(d){d.num!==d.tempMaster&&(d.heatupPerSecond=e.editor.extruders[d.tempMaster].heatupPerSecond,d.cooldownPerSecond=e.editor.extruders[d.tempMaster].cooldownPerSecond)}),e.config.save())};e.hswStart2=function(){let c=new Date().getTime();r.sendGCode("M80"),angular.forEach(e.hwsMeasurements,function(f){f.startTime=c,f.mode=0,f.modeText=h(0),f.id>=1e3?(f.startTemp=f.actTemp=o.active.state.heatedBeds[f.id-1e3].tempRead,f.coolTarget=f.startTemp+10,f.holdTime=6e4,o.RSPrinter.setBedTemperature(f.target,f.id-1e3)):(f.startTemp=f.actTemp=o.active.state.extruder[f.id].tempRead,f.coolTarget=Math.max(f.startTemp+10,f.target-20),f.holdTime=3e4,r.setExtruderTemperature(f.id,f.target))}),e.hswStep=2,u()},i(r.updateFirmwareAutoset,100)}]).controller("PrinterSetupController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Flash","$interval","RSPrinters","$sce","$rootScope",function(t,e,i,r,n,o,a,l,h){e.$watch("formSetup.$valid",function(){e.formSetup&&t.setError("setup",e.formSetup.$invalid)}),t.selectPrinter(h.activeSlug).then(function(){e.config=t,e.editor=t.config}),h.frontend.setVisible("activePrinterSetup",!0),e.$on("$destroy",function(){h.frontend.setVisible("activePrinterSetup",!1)})}]).controller("PrinterConfigGeneralController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Flash","$interval","RSPrinters","$sce","RSCom",function(t,e,i,r,n,o,a,l,h){e.lcdModes=[{id:0,t:"<?php _('Do not set status') ?>"},{id:1,t:"<?php _('Show ETA') ?>"},{id:2,t:"<?php _('Show ETE') ?>"},{id:3,t:"<?php _('Show Layer') ?>"},{id:4,t:"<?php _('Rotate') ?>"},{id:5,t:"<?php _('Only important messages') ?>"}],e.pauseModes=[{id:0,t:"<?php _('Just Pause') ?>"},{id:1,t:"<?php _('Pause and Disable Extruders after x seconds') ?>"},{id:2,t:"<?php _('Pause and Disable Heated Bed and Extruders after x seconds') ?>"},{id:3,t:"<?php _('Pause and Disable Heated Bed, Extruders and Chamber after x seconds') ?>"}],e.usbReconnectModes=[{id:0,t:"<?php _('Never') ?>"},{id:1,t:"<?php _('Early') ?>"},{id:2,t:"<?php _('Conservative') ?>"}],e.emergencySolutions=[{id:0,t:"<?php _('Send M112 and try a hardware reset') ?>"},{id:1,t:"<?php _('Send M112 and try a hardware reset after 1 second') ?>"},{id:2,t:"<?php _('Send M112 and try a hardware reset after 2 seconds') ?>"},{id:3,t:"<?php _('Send only M112') ?>"},{id:4,t:"<?php _('Try only a hardware reset') ?>"}],e.baudrates=[19200,38400,56e3,57600,76800,111112,115200,230400,25e4,256e3,460800,5e5,1e6],i(r.updateFirmwareAutoset,100),e.$watch("formGeneral.$valid",function(){e.formGeneral&&t.setError("general",e.formGeneral.$invalid)}),e.portWarning=!1,e.klipperApiWarning=!1;let u=function(){e.portWarning=a.printersUsingPort(e.editor.connection.serial.device,e.activeSlug),e.portWarning&&l.trustAsHtml(e.portWarning),e.editor.connection.connectionMethod===0&&e.isKlipper?h.send("hasKlipperApi",{port:e.editor.connection.serial.device}).then(function(f){f.hasApi?e.klipperApiWarning=!1:e.klipperApiWarning=" <?php _('Currently, only the regular port is visible. To ensure the best experience with Klipper, we recommend enabling the API socket and configuring it to point to @ for optimal performance.') ?>".replace("@",`'${e.editor.connection.serial.device}.api'`)},()=>{}):e.klipperApiWarning=!1};e.$watch("editor.connection.serial.device",function(){u()}),e.$watch("editor.general.firmwareName",function(){u()}),u();let c=o(t.refreshPorts,1500);e.$on("$destroy",function(){o.cancel(c)})}]).controller("PrinterConfigGCodesController",["RSPrinterConfig","$scope","$http","$rootScope","RSCom","Flash","SelectPrinters","User",function(t,e,i,r,n,o,a,l){e.editor=t.config,e.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0};function h(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,u=>(u^crypto.getRandomValues(new Uint8Array(1))[0]&15>>u/4).toString(16))}e.btn={activeButton:e.editor.buttonCommands[0],activeButtonDefault:""},e.gcodeManualEntrys={computedExpressions:"<?php _('Computed Expressions') ?>",serverCommands:"<?php _('Server Commands') ?>",repetierFirmwareGcodes:"<?php _('Repetier-Firmware G-Codes') ?>",regularExpressions:"<?php _('Regular Expressions') ?>",gcodeEditor:"<?php _('G-Code Editor') ?>"},e.selectedManualSection="serverCommands",e.setSelectedManualSection=function(u){e.selectedManualSection=u},e.showHelp=!1,e.setShowHelp=u=>{e.showHelp=u,r.setOverride("fullscreen",u)},e.showRegularExpression=()=>{e.selectedManualSection="regularExpressions",e.showHelp=!0,r.setOverride("fullscreen",!0)},e.copyToSelectedPrinters=function(u,c){t.save().then(()=>{a("<?php _('Copy G-Code to selected printers') ?>").then(f=>{if(f.list.length!==0){let d=[r.activeSlug];f.list.forEach(m=>{d.push(m.slug)}),n.send("setNewGCodesInConfig",{slugArray:d,scriptGroup:u,data:c}).then(m=>{m.ok?o.success("<?php _('Copied to selected printers') ?>","",2e3):o.error("<?php _('Copying to selected printers failed') ?>",2e3,!0)})}})},()=>{})},e.exportLocalWizard=function(u){window.open("/printer/wizards/"+r.activeSlug+'?a=export&uuid=["'+u.uuid+'"]&custom=1',"ihelper")},e.saveAsWizardTemplate=function(u){n.send("exportWizardAsTemplate",{uuid:u.uuid}).then(c=>{c.ok?o.success("<?php _('Created wizard template') ?>","",2e3):o.error("<?php _('Could not create wizard template') ?>",2e3,!0)})},e.updateButtonDefault=function(u){e.btn.activeButton=u,n.send("getDefaultButtonCommand",{name:e.btn.activeButton.name}).then(function(c){c.ok&&(e.btn.activeButtonDefault=c.command)})},e.updateButtonDefault(e.editor.buttonCommands[0]),e.activeScript=e.config.scriptNames[0],e.activeResponseEvent=e.editor.responseEvents.length>0?e.editor.responseEvents[0]:!1,e.activeReplacement=e.editor.gcodeReplacements.length>0?e.editor.gcodeReplacements[0]:!1,e.selectedCommand=e.editor.quickCommands.length>0?e.editor.quickCommands[0]:!1,e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1,e.selectedInclude=e.config.includes.length>0?e.config.includes[0]:!1,e.idxName=function(u,c,f){return c||(c=f),parseInt(u)+1+": "+c},e.addResponseEvent=function(){e.editor.responseEvents.push({event:"",expression:"",script:"",seePermission:"",editPermission:"",uuid:h()}),e.activeResponseEvent=e.editor.responseEvents[e.editor.responseEvents.length-1]},e.delResponseEvent=function(u){for(let c=0;c<e.editor.responseEvents.length;c++)if(e.editor.responseEvents[c]===u){e.editor.responseEvents.splice(c,1),e.activeResponseEvent=e.editor.responseEvents.length>0?e.editor.responseEvents[0]:!1;return}},e.addReplacement=function(){e.editor.gcodeReplacements.push({comment:"",expression:"",script:"",seePermission:"",editPermission:"",uuid:h()}),e.activeReplacement=e.editor.gcodeReplacements[e.editor.gcodeReplacements.length-1]},e.delReplacement=function(u){for(let c=0;c<e.editor.gcodeReplacements.length;c++)if(e.editor.gcodeReplacements[c]===u){e.editor.gcodeReplacements.splice(c,1),e.activeReplacement=e.editor.gcodeReplacements.length>0?e.editor.gcodeReplacements[0]:!1;return}},e.onDragEndQuickCommand=function(){if(e.selectedCommand){let u=e.selectedCommand;angular.forEach(e.editor.quickCommands,function(c){c.name===u.name&&c.command===u.command&&(e.selectedCommand=c)})}},e.selectQuickCommand=function(u){e.selectedCommand=u},e.addQuickCommand=function(){e.selectedCommand={name:"",command:"",icon:"",condition:"",editPermission:"",seePermission:""},e.editor.quickCommands.push(e.selectedCommand)},e.delQuickCommand=function(u){u||(u=e.selectedCommand);for(let c=0;c<e.editor.quickCommands.length;c++)if(e.editor.quickCommands[c]===u){e.editor.quickCommands.splice(c,1),e.selectedCommand=e.editor.quickCommands.length>0?e.editor.quickCommands[0]:!1;return}},e.quickUp=function(u){let c=e.editor.quickCommands[u];e.editor.quickCommands[u]=e.editor.quickCommands[u-1],e.editor.quickCommands[u-1]=c},e.onDragEndIncludes=function(){if(e.selectedInclude){let u=e.selectedInclude;angular.forEach(e.config.includes,function(c){c.name===u.name&&c.command===u.command&&(e.selectedInclude=c)})}},e.selectInclude=function(u){e.selectedInclude=u},e.addInclude=function(){e.selectedInclude={name:"",command:"",editPermission:"",seePermission:""},e.config.includes.push(e.selectedInclude),console.log("addInclude",e.config)},e.delInclude=function(u){u||(u=e.selectedInclude);for(let c=0;c<e.config.includes.length;c++)if(e.config.includes[c]===u){e.config.includes.splice(c,1),e.selectedInclude=e.config.includes.length>0?e.config.includes[0]:!1;return}},e.onDragEndWizardCommand=function(){if(e.selectedCommand){let u=e.selectedCommand;angular.forEach(e.editor.wizardCommands,function(c){c.name===u.name&&c.command===u.command&&(e.selectedWizardCommand=c)})}},e.selectWizardCommand=function(u){e.selectedWizardCommand=u},e.addWizardCommand=function(){e.selectedWizardCommand={name:"",command:"",icon:"",condition:"",editPermission:"",seePermission:""},e.editor.wizardCommands.push(e.selectedWizardCommand)},e.delWizardCommand=function(u){u||(u=e.selectedCommand);for(let c=0;c<e.editor.wizardCommands.length;c++)if(e.editor.wizardCommands[c]===u){e.editor.wizardCommands.splice(c,1),e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1;return}},e.saveAndTest=function(u,c){t.save().then(()=>{u==="wizardCommands"&&(t.refreshWizards(),n.send("sendWizardCommand",{uuid:e.selectedWizardCommand.uuid})),u==="quickCommands"&&n.send("sendQuickCommand",{name:e.selectedCommand.name})},()=>{})},e.$on("config",function(u,c){let f=e.selectedWizardCommand;t.refreshWizards();let d=e.editor.wizardCommands.findIndex(m=>m.command==f.command);d===-1?e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1:e.selectWizardCommand(e.editor.wizardCommands[d])}),e.$on("$destroy",()=>{r.setOverride("fullscreen",!1)}),e.$watch("formGCodes.$valid",function(){e.formGCodes&&t.setError("gcodes",e.formGCodes.$invalid)})}]).controller("PrinterConfigRecoverController",["RSPrinterConfig","$scope",function(t,e){e.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},e.activeScript=e.config.scriptNames[0],e.selectedCommand=!1,e.selectScript=function(i){e.activeScript=i},e.selectQuickCommand=function(i){e.selectedCommand=i},e.addQuickCommand=function(){e.selectedCommand={name:"",command:"",script:""},e.editor.quickCommands.push(e.selectedCommand)},e.delQuickCommand=function(i){i||(i=e.selectedCommand);for(let r=0;r<e.editor.quickCommands.length;r++)if(e.editor.quickCommands[r]===i){e.editor.quickCommands.splice(r,1),e.selectedCommand=!1;return}},e.quickUp=function(i){let r=e.editor.quickCommands[i];e.editor.quickCommands[i]=e.editor.quickCommands[i-1],e.editor.quickCommands[i-1]=r},e.$watch("formRescue.$valid",function(){e.formRescue&&t.setError("rescue",e.formRescue.$invalid)})}]).controller("PrinterConfigShapeController",["RSPrinterConfig","$scope","$timeout","RSPrinter","$rootScope",function(t,e,i,r,n){let o=null;e.sizeWarning=!1;let a=null,l=null,h=null,u=0;e.percentSlider={floor:0,ceil:100,step:1,precision:0,enforceStep:!0,showTicks:10,translate:function(v){return v.toFixed(0)}};function c(){if(!a)return;l=angular.copy(a);let v=o.x0,g=o.y0;l.forEach(_=>{if(_.m)for(let x=0;x<_.m.length;x++)_.m[x].x+=v,_.m[x].y+=g})}function f(){o&&l&&(u+=.2,u>100&&(u=0),o.drawPreviewLayer(l,u))}async function d(){let v=await ui.get("/img/demolayer.json");v.status===200&&(a=v.data,c(),h=setInterval(f,25))}function m(){if(o){let v=e.editor.shape.basicShape,g=e.editor.movement;e.sizeWarning=!1,v.shape==="rectangle"||v.shape==="zbelt"?(v.xMin<g.xMin||v.xMax>g.xMax||v.yMin<g.yMin||v.yMax>g.yMax)&&(e.sizeWarning="<?php _('The bed is larger then the defined reachable area. This can lead to unexpected interpretation of possible positions for objects on the bed!') ?>"):(-v.radius<g.xMin||v.radius.xMax>g.xMax||-v.radius<g.yMin||v.radius>g.yMax)&&(e.sizeWarning="<?php _('The bed is larger then the defined reachable area. This can lead to unexpected interpretation of possible positions for objects on the bed!') ?>"),o.zoomEnabled=!0,o.pc=e.editor,o.drawBed(),o.fitBed(),c(),o.render(),p()}}e.setPreview=function(v){o=v,m(),v&&(v.loadTexture(),a||d())},e.uploadBedImage=async function(v){let g=v.target.files;if(g.length){let _=g[0],x=_.name.substr(_.name.length-3).toLowerCase();if(x!=="svg"&&x!=="png")return;let b={headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0},y=new FormData;y.append("filename",_);let S="/printer/bed/"+n.activeSlug+"/upload_image";(await ui.post(S,y,b)).data.ok&&(e.editor.shape.imageExtension=x,await t.save(!1),e.editor=t.config,v.target.value="",o.pc=e.editor,o.loadTexture())}},e.deleteBedImage=async function(){let v={maxContentLength:1/0,maxBodyLength:1/0},g=new FormData,_="/printer/bed/"+n.activeSlug+"/del_image";(await ui.post(_,g,v)).data.ok&&(e.editor.shape.imageExtension="",await t.save(!1),e.editor=t.config,o.pc=e.editor,o.loadTexture())};let p=function(){if(!o)return;let v=$(window).height();document.body.clientWidth>=992&&v>300?$("#shapePreview").css("height",v-200+"px"):$("#shapePreview").css("height","50vh")};e.$on("windowResized",function(){p()}),p(),e.$on("$destroy",function(){h&&clearInterval(h)}),e.$watch("formShape.$valid",function(v){typeof v!="undefined"&&t.setError("shape",e.formShape.$invalid)}),e.$watchCollection("editor.shape",function(){m()}),e.$watchCollection("editor.shape.basicShape",function(){m()}),e.$watchCollection("editor.movement",function(){m()}),i(r.updateFirmwareAutoset,100)}]).controller("ConfigWizardController",["RSPrinterConfig","$scope","$timeout","RSPrinter","RSFirmware","Confirm","$state","RSPrinters","Flash","$rootScope","RSCom","$interval","$sce","KlipperDialog",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){let p=function(){!e.editor||!e.editor.connection||!e.editor.connection.serial||(e.portWarning=l.printersUsingPort(e.editor.connection.serial.device,u.activeSlug),e.portWarning&&d.trustAsHtml(e.portWarning),e.editor.connection.connectionMethod===0&&e.isKlipper?c.send("hasKlipperApi",{port:e.editor.connection.serial.device}).then(function(C){C.hasApi?e.klipperApiWarning=!1:e.klipperApiWarning=" <?php _('Currently, only the regular port is visible. To ensure the best experience with Klipper, we recommend enabling the API socket and configuring it to point to @ for optimal performance.') ?>".replace("@",`'${e.editor.connection.serial.device}.api'`)},()=>{}):e.klipperApiWarning=!1)};e.klipperApiWarning=!1,e.didInstallKlipper=!1,e.menuPort=!1,e.step=1,e.substep=0,e.newprinter={name:"",slug:""},e.editor=t.config,S(),e.config=t,window.rsc=t,e.firmware=n,e.connectionDataWrong=!1,e.portWrong=!1,e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.testBaudrate=115200,e.extruder={num:1,diameter:1.75,bed:!1},e.correctResponse=!0,e.correctFirmware=!0,e.correctFirmwareName="",e.progress=5,e.extras={heatedBed:!1,heatedChamber:!1},e.wizardsToInstall={},e.baudrates=[{id:0,t:"<?php _('Autodetect') ?>"},{id:19200,t:"19200 <?php _('baud') ?>"},{id:38400,t:"38400 <?php _('baud') ?>"},{id:56e3,t:"56000 <?php _('baud') ?>"},{id:57600,t:"57600 <?php _('baud') ?>"},{id:76800,t:"76800 <?php _('baud') ?>"},{id:111112,t:"111112 <?php _('baud') ?>"},{id:115200,t:"115200 <?php _('baud') ?>"},{id:230400,t:"230400 <?php _('baud') ?>"},{id:25e4,t:"250000 <?php _('baud') ?>"},{id:256e3,t:"256000 <?php _('baud') ?>"},{id:460800,t:"460800 <?php _('baud') ?>"},{id:5e5,t:"500000 <?php _('baud') ?>"},{id:1e6,t:"1000000 <?php _('baud') ?>"}],e.conMethods=[{i:0,n:"<?php _('Serial Connection') ?>"},{i:1,n:"<?php _('Pipe/UNIX Socket') ?>"},{i:2,n:"<?php _('TCP/IP Connection') ?>"},{i:3,n:"DuetControlServer"}],e.serverSettings.ServerOS===0&&(e.conMethods.splice(1,1),e.conMethods.splice(2,1)),e.resetOrder=[{i:-1,n:"<?php _('Autodetect') ?>"},{i:0,n:"<?php _('Low to High') ?>"},{i:1,n:"<?php _('High to Low') ?>"},{i:2,n:"<?php _('Low') ?>"},{i:3,n:"<?php _('High') ?>"}],e.rtsDtrTestOrder=[0,1];let v=0,g=[115200,25e4,230400,256e3,1e6,76800,38400,19200,57600,56e3],_=0,x=null;function b(){c.send("getKlipperStatus",{}).then(C=>{e.klipper=C,e.didInstallKlipper=!1,e.klipper.installations.forEach(E=>{e.didInstallKlipper|=E===e.newprinter.slug})},()=>{})}b(),e.installKlipper=function(){m("install",e.newprinter.slug).then(()=>{b(),e.editor.connection.serial.device="/var/lib/klipper/sockets/"+e.newprinter.slug})},e.uninstallKlipper=function(){m("uninstall",e.newprinter.slug).then(()=>{b()})};let y=f(function(){e.step===2&&t.refreshPorts()},1500);e.$on("$destroy",function(){f.cancel(y),e.substep=-1});function S(){n.firmwareInfo.forEach(C=>{C.name===e.editor.general.firmwareName&&(e.editor.general.firmwareInfo=C)}),e.isKlipper=e.editor.general.firmwareInfo?e.editor.general.firmwareInfo.style==="klipper":!1}e.$on("config",function(C,E){E.data.general.slug===e.newprinter.slug&&(u.printerConfig[E.data.general.slug]=E.data,t.selectPrinter(e.newprinter.slug).then(function(){e.editor=t.config,S();let P="";e.step===1&&(angular.forEach(t.ports,function(A){P===""&&(A.indexOf("/dev/tty.usbmodem")===0||A.indexOf("COM")===0||A.indexOf("/dev/serial/by-id")===0)&&(P=A)}),P!==""&&(e.editor.connection.serial.device=P),e.editor.connection.serial.baudrate=0,e.step=2)}))}),e.step1=function(){e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.autodetectRts="",e.autodetectDtr="",e.newprinter.errors={},e.newprinter.name.length===0&&(e.newprinter.errors.name="<?php _('No printer name given.') ?>"),!(Object.keys(e.newprinter.errors).length>0)&&(e.newprinter.slug=l.autocreateSlug(e.newprinter.name),c.send("createConfiguration",e.newprinter))},e.$watch("editor.connection.connectionMethod",C=>{C===0&&p(),C===3&&(e.editor.connection.pipe.file="/var/run/dsf/dcs.sock"),C===1&&(e.editor.connection.pipe.file==="/var/run/dsf/dcs.sock"||e.editor.connection.pipe.file==="/run/dsf/dcs.sock")&&(e.editor.connection.pipe.file="")});let w=function(){let C=e.conTests[v];e.editor.connection.serial.baudrate=e.testBaudrate=C.baud,e.editor.connection.serial.rts=C.rts,e.editor.connection.serial.dtr=C.dtr,angular.forEach(e.resetOrder,function(E){E.i===C.dtr&&(e.autodetectDtr=E.n),E.i===C.rts&&(e.autodetectRts=E.n)}),t.save(!1),e.editor=t.config,S()},M=function(){if(x=null,_++,e.active.status&&e.active.status.online===1){console.log("connection found - fetching settings"),e.substep=2,e.autodetectingBaudrate=!1,i(r.updateFirmwareSettings().then(function(){if(r.firmwareSettings.hasOwnProperty("extruderCountSend"))e.extruder.num=r.firmwareSettings.extruderCountSend;else{let C=0;for(;r.firmwareSettings.hasOwnProperty("extrMaxSpeed["+C+"]");)C++;C>0&&(e.extruder.num=C)}t.save(!1),e.editor=t.config,S(),r.firmwareSettings.hasOwnProperty("firmwareCommunicationWorking")&&r.firmwareSettings.firmwareCommunicationWorking?r.firmwareSettings.hasOwnProperty("differentFirmware")?(e.correctFirmware=!1,e.correctFirmwareName=r.firmwareSettings.differentFirmware,e.substep=0):e.step3Start():(e.correctResponse=!1,e.substep=0),r.firmwareSettings.hasOwnProperty("differentFirmware")&&(e.correctFirmware=!1,e.correctFirmwareName=r.firmwareSettings.differentFirmware,e.substep=0)}),200);return}_>70&&e.active.status.online===2&&(e.autodetectingBaudrate&&e.editor.connection.connectionMethod===0?v<e.conTests.length-1?(v++,_=-20,w(),e.progress++):(e.autodetectingBaudrateFailed=!0,e.autodetectingBaudrate=!1):(e.editor.connection.connectionMethod===0?e.connectionDataWrong=!0:e.portWrong=!0,e.substep=0)),_>120&&(e.editor.connection.connectionMethod===0?e.connectionDataWrong=!0:e.portWrong=!0,e.substep=0),e.substep===1&&(x=i(M,200))};e.step2=function(){e.substep=1,e.progress=20,e.portWrong=!1,e.connectionDataWrong=!1,e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.editor=t.config,e.editor.general.firmwareName=e.editor.general.firmwareInfo.name,S(),e.conTests=[],e.curTest=0,e.correctResponse=!0,e.correctFirmware=!0,e.editor.general.firmwareInfo.style==="klipper"&&(e.editor.connection.serial.baudrate=115200,e.editor.connection.serial.rts=2,e.editor.connection.serial.dtr=2,e.conTestMode=3);function C(A,R){e.editor.connection.serial.rts===-1?e.conTests.push({baud:A,dtr:R,rts:R}):e.conTests.push({baud:A,dtr:R,rts:e.editor.connection.serial.rts})}function E(A,R){e.editor.connection.serial.rts===-1&&e.conTests.push({baud:A,dtr:R,rts:1-R})}function P(A){e.editor.connection.serial.dtr===-1?(C(A,e.rtsDtrTestOrder[0]),C(A,e.rtsDtrTestOrder[1]),E(A,e.rtsDtrTestOrder[0]),E(A,e.rtsDtrTestOrder[1])):C(A,e.editor.connection.serial.dtr)}if(e.conTests=[],e.editor.connection.connectionMethod===0){if(e.editor.connection.serial.baudrate===0)for(let A=0;A<g.length;A++)P(g[A]);else P(e.editor.connection.serial.baudrate);e.conTests.length>1&&(e.autodetectingBaudrate=!0,e.autodetectingBaudrateFailed=!1),v=0,w(),console.log("Tests",JSON.stringify(e.conTests))}else e.editor.connection.connectionMethod===3?(e.editor.connection.serial.inputBufferSize=8e3,e.editor.connection.serial.maxParallelCommands=24,e.editor.connection.serial.pingPong=!1,t.save(!1),e.editor=t.config,S()):(t.save(!1),e.editor=t.config,S());_=0,p(),e.connectionDataWrong=!1,x==null&&(x=i(M,200))},e.step4=function(){e.progress=65,e.step=5;let C=t.config,E=r.firmwareSettings;t.config.shape.basicShape.shape==="rectangle"||t.config.shape.basicShape.shape==="zbelt"?(E.hasOwnProperty("printerType")||(t.config.general.printerVariant="cartesian"),E.hasOwnProperty("XMin")||(t.config.movement.xMin=C.shape.basicShape.xMin,E.hasOwnProperty("XLength")||(t.config.movement.xMax=C.shape.basicShape.xMax)),E.hasOwnProperty("YMin")||(t.config.movement.yMin=C.shape.basicShape.yMin,E.hasOwnProperty("YLength")||(t.config.movement.yMax=C.shape.basicShape.yMax))):(E.hasOwnProperty("printerType")||(C.general.printerVariant="delta"),E.hasOwnProperty("XMin")||(t.config.movement.xMin=-C.shape.basicShape.radius,t.config.movement.xMax=C.shape.basicShape.radius),E.hasOwnProperty("YMin")||(t.config.movement.yMin=-C.shape.basicShape.radius,t.config.movement.yMax=C.shape.basicShape.radius)),t.save(!1),e.editor=t.config,S(),e.editor.extruders=[];for(let P=0;P<e.extruder.num;P++){let A={filamentDiameter:e.extruder.diameter,cooldownPerSecond:.5,extrudeSpeed:2,heatupPerSecond:2,tempMaster:P,acceleration:5e3,lastTemp:0,maxTemp:260,offsetX:0,offsetY:0,offset:0,eJerk:30,maxSpeed:30,toolType:0,toolDiameter:.4,supportTemperature:!0,retractSpeed:30,changeFastDistance:20,changeSlowDistance:20,temperatures:[{name:"ABS 245",temp:245},{name:"PLA 210",temp:210},{name:"PLA 195",temp:195}]},R="["+P+"]";E.hasOwnProperty("extrAcceleration"+R)?A.acceleration=E["extrAcceleration"+R]:E.hasOwnProperty("extrAcceleration")&&(A.acceleration=E.extrAcceleration),E.hasOwnProperty("extrMaxSpeed"+R)?A.maxSpeed=E["extrMaxSpeed"+R]:E.hasOwnProperty("extrMaxSpeed")&&(A.maxSpeed=E.extrMaxSpeed),E.hasOwnProperty("extrJerk"+R)?A.eJerk=E["extrJerk"+R]:E.hasOwnProperty("extrJerk")&&(A.eJerk=E.extrJerk),A.retractSpeed>A.maxSpeed&&(A.retractSpeed=A.maxSpeed),e.editor.extruders.push(A)}E.hasOwnProperty("hasHeatedBed")&&(e.extras.heatedBed=E.hasHeatedBed),E.hasOwnProperty("hasHeatedChamber")&&(e.extras.heatedChamber=E.hasHeatedChamber)},e.step5=function(){e.progress=80,e.editor.extruders=[];let C=r.firmwareSettings;for(let E=0;E<e.extruder.num;E++){let P={filamentDiameter:e.extruder.diameter,cooldownPerSecond:.5,extrudeSpeed:2,heatupPerSecond:2,tempMaster:E,supportTemperature:!0,acceleration:5e3,lastTemp:0,maxTemp:260,offsetX:0,offsetY:0,eJerk:30,maxSpeed:30,retractSpeed:30,toolType:0,toolDiameter:.4,changeFastDistance:20,changeSlowDistance:20,temperatures:[{name:"ABS 255",temp:255},{name:"PLA 215",temp:215},{name:"PET 230",temp:230}]},A="["+E+"]";C.hasOwnProperty("extrAcceleration"+A)?P.acceleration=C["extrAcceleration"+A]:C.hasOwnProperty("extrAcceleration")&&(P.acceleration=C.extrAcceleration),C.hasOwnProperty("extrMaxSpeed"+A)?P.maxSpeed=C["extrMaxSpeed"+A]:C.hasOwnProperty("extrMaxSpeed")&&(P.maxSpeed=C.extrMaxSpeed),C.hasOwnProperty("extrJerk"+A)?P.eJerk=C["extrJerk"+A]:C.hasOwnProperty("extrJerk")&&(P.eJerk=C.extrJerk),P.retractSpeed>P.maxSpeed&&(P.retractSpeed=P.maxSpeed),e.editor.extruders.push(P)}e.step=6,t.save(!1),e.editor=t.config,S()},e.step6=function(){e.editor=t.config,S(),e.progress=90,e.extras.heatedBed&&e.editor.heatedBeds.length===0?e.editor.heatedBeds.push({cooldownPerSecond:.02,heatupPerSecond:.2,offset:0,alias:"",lastTemp:0,maxTemp:120,temperatures:[{name:"ABS",temp:100},{name:"PLA",temp:60},{name:"PET",temp:55}]}):e.extras.heatedBed===!1&&(e.editor.heatedBeds=[]),e.extras.heatedChamber&&e.editor.heatedChambers.length===0?e.editor.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,offset:0,alias:"",cooldownPerSecond:.1,temperatures:[]}):e.extras.heatedChamber===!1&&(e.editor.heatedChambers=[]),e.editor.fans=[];for(let k=0;k<e.editor.general.numFans;k++)e.editor.fans.push({pos:0,min:0,max:100,firmwareId:k,readOnly:!1,fanType:0,alias:"",firmwareName:""});let C=`M400 ; Wait for current moves to finish, clearing the buffer
`,E,P=t.config;for(E=0;E<e.editor.extruders.length;E++)C+="M104 T"+E+` S0 ; Disable extruder
`;e.editor.heatedBeds.length>0&&(C+=`M140 S0 ; Disable bed
`),e.editor.heatedChambers.length>0&&(C+=`M141 S0 ; Disable chamber
`);let A=`G91
@if {{state.pos_z + 5 < config.move_z_max }}
G1 Z5 F600
@endif
G90
`,R=`M84 ; Disable motor
`;t.config.shape.basicShape.shape==="rectangle"||t.config.shape.basicShape.shape==="zbelt"?(A="G1 X"+P.shape.basicShape.xMin+" Y"+P.shape.basicShape.yMax+` F9000
`,t.config.shape.basicShape.shape==="zbelt"&&(R=`; M84 ; Disable motor
`)):(P.general.printerVariant==="delta"&&(R=`; M84 ; Disable motor
`),A+="G1 X0 Y-"+P.shape.basicShape.radius+` F9000
`),t.scripts.activate=`; Runs when printer gets activated.
; At that point the printer is often not connected, so you should only use server commands here.
`,t.scripts.deactivate=`; Runs when printer gets deactivated.
; At that point the printer is likely not connected, so you should only use server commands here.
; Also runtime is limited to 5 seconds until a connection is forced to go down.
`,t.scripts.end=`; Sample end code - modify to your needs!
`+C+A+R,t.scripts.kill=`; Sample stop code - modify to your needs!
`+C+A+R,t.scripts.pause=`; Sample pause code - modify to your needs!
M83 ; relative extrusion mode
G1 E-3 F1800 ; Retract a bit to reduce oozing
`+A,t.scripts.insert_filament_finished=`; Retract to be at same retraction with new filament
; as you would be after pause start.
; Remove if you also remove the corresponding line in pause event script.
@ifPaused
G92 E0
G1 E-3 F1800
G92 E0 ; // continue will restore old extruder position
@endif
        `,angular.forEach(e.wizardsToInstall,(k,I)=>{if(k){let L=e.editor.wizardTemplates.find(T=>T.uuid===I);e.editor.wizardCommands.push(L)}}),t.save(!1),e.editor=t.config,c.send("printerConfigWizardFinished",{},t.config.slug),S(),h.success("<?php _('Printer configuration finished.') ?>"),e.editor.general.firmwareInfo.style==="klipper"&&e.didInstallKlipper?a.go("printer.klipperConfig",{slug:e.editor.general.slug}):a.go("home")},e.portWarning=!1,e.$watch("editor.connection.serial.device",function(){p()}),e.$watch("editor.general.firmwareInfo",function(){e.isKlipper=e.editor.general.firmwareInfo?e.editor.general.firmwareInfo.style==="klipper":!1,p()}),e.abort=function(){if(e.step===1){a.go("home");return}o("<?php _('Abort wizard') ?>","<?php _('Aborting the wizard will delete the settings created so far. Really abort?') ?>",!1,!1,!0).then(function(){c.send("removeConfiguration",{slug:e.newprinter.slug}).then(function(){delete u.printerConfig[e.newprinter.slug],delete u.printer[e.newprinter.slug],h.success("<?php _('Wizard aborted') ?>"),a.go("home")})})},e.conTestMode=0,e.testsOpen=0,e.openConTests=[],e.conTestResults=[],e.sendNextTest=function(){if(e.openConTests.length>0){let C=e.openConTests.shift();e.runningTest=C,c.send("communicationTest",C).then(function(){},function(){e.testsOpen--})}},e.$on("communicationTestResult",function(C,E){e.progress+=5,!E.data.error&&E.data.resendsShort<.5&&E.data.resends<.5&&E.data.resends<.5?E.data.bgClass="bg-success":!E.data.error&&E.data.resendsShort<1&&E.data.resends<1&&E.data.resends<1?E.data.bgClass="bg-warning":E.data.bgClass="bg-danger",e.conTestResults.push(E.data),e.testsOpen--,e.sendNextTest()}),e.step3=function(C){e.editor.connection.serial.pingPong=C.pingPong,e.editor.connection.serial.inputBufferSize=C.bufferSize,e.step=4,e.progress=65,t.save(!1)},e.step3Start=function(){if(e.editor.connection.connectionMethod===3){e.step=4,e.progress=65,t.save(!1);return}switch(e.progress=30,e.conTestMode){case 1:e.step3({pingPong:!0,bufferSize:127});return;case 2:e.step3({pingPong:!1,bufferSize:63});return;case 3:e.step3({pingPong:!1,bufferSize:127});return;case 4:e.step3({pingPong:!1,bufferSize:255});return}e.step=3,e.openConTests=[{pingPong:!0,buffer:127,parallelCommands:0},{pingPong:!1,buffer:63,parallelCommands:0},{pingPong:!1,buffer:127,parallelCommands:0},{pingPong:!1,buffer:255,parallelCommands:0}];let C=e.editor.connection.serial.inputBufferSize;!e.editor.connection.serial.pingPong&&C!==63&&C!==127&&C!==255&&C!==511&&e.openConTests.push({pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:0}),e.testsOpen=e.openConTests.length,e.sendNextTest()},e.repeatTests=function(){e.conTestResults=[],e.progress-=20,e.step3Start()}}]);RSPrinterModule.component("rsSidebarTemperatures",{templateUrl:"/views/printer/control/RsSidebarTemperatures.php?lang="+window.lang,controller:["$rootScope","User","RSPrinter",function(t,e,i){this.mopen={},this.closeMenu=function(r){this.mopen[r]=!1},this.RSPrinter=i,this.canPrint=e.printPermission,this.idle=!0,this.printing=!1,t.$watch("active.state.isJobActive",()=>{!t.active||!t.active.state||(this.printing=t.active.state.isJobActive,this.idle=t.active.status.paused||!t.active.state.isJobActive)}),t.$watch("active.status.paused",()=>{!t.active||!t.active.state||!t.active.status||(this.idle=t.active.status.paused||!t.active.state.isJobActive)})}]});RSPrinterModule.component("rsSidebarExtrude",{templateUrl:"/views/printer/control/RsSidebarExtrude.php?lang="+window.lang,controller:["$rootScope","User",function(t,e){this.canPrint=e.canPrint(),this.retractSpeed=10,this.extrudeSpeed=2,this.extrudeDistance=10;let i=()=>{if(!t.active||!t.active.state)return;let r=t.active.state.activeExtruder,n=t.active.state.extruder?t.active.state.extruder.length:0;r!==void 0&&n>0&&(r=Math.min(r,n-1),this.retractSpeed=t.activeConfig.extruders[r].retractSpeed,this.extrudeSpeed=t.activeConfig.extruders[r].extrudeSpeed)};t.$watch("active.state.activeExtruder",i),i()}]});RSPrinterModule.component("rsSidebarWebcam",{template:`<div>
<div class="row">
            <div class="col-sm-12" style="text-align: center;position:relative">
            <div style="position: relative;max-width:300px;display: inline-block">
              <img ng-src="{{$root.RSPrinter.printingImage('m')}}" style="width:100%;max-height:201px;max-width:268px;margin-right:10px;" ng-hide="($root.update.free && $ctrl.showWebcam) || !$ctrl.printing" ng-click="$ctrl.setShowWebcam(true)">
              <websocket-camera img-url="{{$ctrl.webcamUrl}}" img-style="width:100%;" rotate="$ctrl.webcamRotate" ng-show="$root.update.free && ($ctrl.showWebcam || !$ctrl.printing)" ng-click="$ctrl.toggleWebcam()"></websocket-camera>
              <img class="reccam" src="/img/REC.png" ng-show="$root.active.state.webcams[$ctrl.activeCam].rec && ($root.update.free && ($ctrl.showWebcam || !$ctrl.printing))" title="<?php _('Capturing') ?>" style="left:90%; position: absolute;width:21px;height:21px;top:5px">
              </div>
            </div>
            <div class="col-sm-12 margin-top" ng-if="$ctrl.printing">
                              <div class="progress active" style="margin-bottom: 0">
                    <div class="metertext">{{$root.active.status.done | number:2}}%</div>
                    <div class="progress-bar progress-bar-success" role="progressbar"
                         style="width:{{$root.active.status.done}}%"></div>
                  </div>

              <ul class="list-group condensed" style="margin-bottom:0">
                <li class="list-group-item no-border">
                  <i class="fa fa-clock-o rs-bigtab"></i> <?php _('ETA') ?>
                  <span class="pull-right">{{($root.stateTime + 1000*($root.active.status.printTime-$root.active.status.printedTimeComp))
                        | date:'short'}}</span></li>
                <li class="list-group-item no-border">
                  <i class="fa fa-clock-o rs-bigtab"></i> <?php _('ETE') ?>
                  <span class="pull-right">{{$root.active.status.printTime-$root.active.status.printedTimeComp | dhms}}</span>
                </li>
                <li class="list-group-item no-border">
                  <i class="fa fa-arrows-v rs-bigtab"></i> <?php _('Z Position') ?>
                  <span class="pull-right">{{$root.active.state.z | number:2}} mm</span></li>
                <li class="list-group-item no-border">
                  <i class="fa fa-arrows-v rs-bigtab"></i> <?php _('Layer') ?>
                  <span class="pull-right">{{$root.active.state.layer}} / {{$root.active.status.ofLayer}}</span>
                </li>
              </ul>
            </div>
          </div>
          <div class="row" ng-if="$root.user.fullStopPermission && $ctrl.printing">
            <div class="col-xs-6">
              <button ng-click="$ctrl.stopPrint()" class="btn btn-danger btn-block btn-sm">
                <i
                            class="fa fa-stop"></i> <?php _('Stop') ?>
              </button>
            </div>
            <div class="col-xs-6">
              <button ng-if="!$root.active.status.paused" ng-click="$root.RSPrinter.pausePrint()" class="btn btn-primary btn-block btn-sm">
                <i
                            class="fa fa-pause"></i>
                  <?php _('Pause') ?>
              </button>
              <button ng-show="$root.user.printPermission && $root.active.status.paused" ng-click="$root.RSPrinter.unpausePrint()" ng-disabled="$root.active.status.pauseState==3" class="btn btn-primary btn-block btn-sm">
                <i
                            class="fa fa-play"></i>
                {{$root.RSPrinter.pauseNames[$root.active.status.pauseState]}}
              </button>
            </div>
          </div>
</div>
  `,controller:["$rootScope","User","RSCom","Confirm","$scope","$timeout",function(t,e,i,r,n,o){this.showWebcam=!1,this.webcamUrl="/img/empty.png",this.showTimelapseSettings=!1,this.webcamRotate=0,this.webcammode=0,this.activeCam=0,this.stopped=!1,this.hasWebcam=t.activeConfig.webcams.length>0&&t.activeConfig.webcams[this.activeCam].method!==0;let a=!1,l="";this.stopOldStream=()=>{l.length>0&&(i.send("webcamCloseStream",{wcid:l}),l="")},this.stopPrint=()=>{r("<?php _('Confirmation required') ?>","<?php _('Really stop current print?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){t.active.status.jobid&&i.send("stopJob",{id:t.active.status.jobid})})},this.setShowWebcam=(c,f)=>{f&&(f.preventDefault(),f.stopPropagation()),(!this.hasWebcam||!t.update.free||!this.visible)&&(c=!1),!c&&this.printing===!1&&this.visible&&(c=!0),this.showWebcam!==c&&(this.showWebcam=c,c&&t.activeConfig.webcams[this.activeCam]?(t.activeConfig.webcams[this.activeCam].method&2)===2?(this.webcammode=2,this.enableMode2=!0,this.stopOldStream(),l=RSUtils.createAlphaID(10),this.webcamUrl="/printer/cammjpg/"+t.activeSlug+"?cam="+this.activeCam+"&wcid="+l,this.webcamRotate=t.activeConfig.webcams[this.activeCam].orientation):(t.activeConfig.webcams[this.activeCam].method&1)===1?(this.webcammode=1,this.enableMode1=!0,a||(u(),a=!0)):(this.webcamUrl="/img/nowebcam.png",this.webcamRotate=0):this.webcamUrl="/img/empty.png"),c||(this.webcamUrl="/img/empty.png")},this.toggleWebcam=()=>{if(t.activeConfig.webcams.length===1)this.setShowWebcam(!1);else{if(this.activeCam++,this.activeCam>=(t.isPro()?t.activeConfig.webcams.length:1)&&(this.activeCam=0,this.printing)){this.setShowWebcam(!1);return}(t.activeConfig.webcams[this.activeCam].method&2)===2?(this.enableMode2=!0,this.stopOldStream(),l=RSUtils.createAlphaID(10),this.webcamUrl="/printer/cammjpg/"+t.activeSlug+"?cam="+this.activeCam+"&wcid="+l,this.webcamRotate=t.activeConfig.webcams[this.activeCam].orientation):(t.activeConfig.webcams[this.activeCam].method&1)===1?(this.webcammode=1,this.enableMode1=!0,a||(u(),a=!0)):this.webcamUrl="/img/nowebcam.png"}};let h=()=>{this.webcamUrl="/printer/camjpg/"+t.activeSlug+"?cam="+this.activeCam+"&rand="+RSUtils.createAlphaID(10)},u=()=>{if(h(),this.webcammode!==1){a=!1;return}this.stopped||o(u,1e3*t.activeConfig.webcams[this.activeCam].reloadInterval)};this.jobChanged=(c,f)=>{f.printer===t.activeSlug&&this.setShowWebcam(!this.printing)},this.subscriptions=[],this.$onDestroy=()=>{this.webcammode=0,this.webcamUrl="",this.stopped=!0,this.webcam.comp=null,this.subscriptions.forEach(c=>c())},this.$onInit=()=>{this.subscriptions.push(t.$on("jobDeactivated",this.jobChanged)),this.subscriptions.push(t.$on("jobStarted",this.jobChanged)),this.webcam.comp=this,this.setShowWebcam(!this.printing)}}],bindings:{webcam:"=",printing:"<",visible:"<"}});RSPrinterModule.component("rsSidebarMove",{templateUrl:"/views/printer/control/RsSidebarMove.php?lang="+window.lang,bindings:{data:"="},controller:["$rootScope","$scope","User",function(t,e,i){e.printing=t.active.state.isJobActive,e.idle=t.active.status.paused||!t.active.state.isJobActive,e.$watch("active.state.isJobActive",function(){!e.active||!e.active.state||(e.printing=t.active.state.isJobActive,e.idle=t.active.status.paused||!t.active.state.isJobActive)})}]});RSPrinterModule.component("rsTemperatures",{template:`<div ng-if="$root.active.state.extruder">
<div class="table-responsive">
  <table class="table table-hover table-striped">
    <tr>
      <th style="width:40px"><rs-icon icon="fa fa-eye"></rs-icon></th>
      <th style="width:40px"></th>
      <th><?php _('Name') ?></th>
      <th><?php _('Power') ?></th>
      <th><?php _('Current') ?></th>
      <th><?php _('Target') ?></th>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.extruders track by 'e'+$index">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.extruders[$index].show"></td>
      <td style="text-align: center"><i ng-class="$root.RSPrinter.extruderIcon($index)"></i></td>
      <td>{{$root.RSPrinter.extruderName($index)}}</td>
      <td>{{$ctrl.extruderOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.extruder[$index])}}</td>
      <td>
        <div ng-if="$root.user.printPermission && e.supportTemperature" class="btn-group" rs-dropdown dropdown-append-to-body style="margin-top: -7px;margin-bottom: -7px;max-width: 100%;margin-right:10px" is-open="$ctrl.menuList['E'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px">
            {{$ctrl.asTempSet($root.active.state.extruder[$index],e)}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" digits="e.setPrecision" value="$root.active.state.extruder[$index].tempSet" changed="$root.RSPrinter.setExtruderTemperature($index,value)"></knob>
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$ctrl.closeMenu('E'+$index);$ctrl.extrudeDialog($index)" a-disabled="!($root.active.status.paused || !$root.active.state.isJobActive)"><?php _('Extrude &amp; Retract') ?></a>
            </li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setExtruderTemperature($index,0);$ctrl.closeMenu('E'+$index)"><?php _('Off') ?></a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setExtruderTemperature($parent.$index,t.temp);$ctrl.closeMenu('E'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-show="!$root.user.printPermission || !e.supportTemperature">{{$ctrl.asTempSet($root.active.state.extruder[$index],e)}}</div>
    </td>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.heatedBeds track by 'b'+$index">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.heatedBeds[$index].show"></td>
      <td style="text-align: center"><i class="rs rs-bed"></i></td>
      <td>{{$root.RSPrinter.bedName($index)}}</td>
      <td>{{$ctrl.bedOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.heatedBeds[$index])}}</td>
      <td>
        <div ng-if="$root.user.printPermission && e.supportTemperature" class="btn-group" rs-dropdown dropdown-append-to-body style="max-width: 100%;margin-right:10px;margin-bottom: -7px;margin-top:-7px" is-open="$ctrl.menuList['B'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px;">
            {{$ctrl.asTempSet($root.active.state.heatedBeds[$index],e)}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" digits="e.setPrecision" value="$root.active.state.heatedBeds[$index].tempSet" changed="$root.RSPrinter.setBedTemperature(value)"></knob>
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setBedTemperature(0, $index);$ctrl.closeMenu('B'+$index)"><?php _('Off') ?></a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setBedTemperature(t.temp,$parent.$index);$ctrl.closeMenu('B'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-if="!$root.user.printPermission">{{$ctrl.asTempSet($root.active.state.heatedBeds[$index],e)}}</div>
      </td>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.heatedChambers track by 'b'+$index">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.heatedChambers[$index].show"></td>
      <td style="text-align: center"><i ng-class="$root.RSPrinter.chamberIcon($index)"></i></td>
      <td>{{$root.RSPrinter.chamberName($index)}}</td>
      <td>{{$ctrl.chamberOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.heatedChambers[$index],e)}}</td>
      <td>
        <div ng-if="$root.user.printPermission && e.supportTemperature" class="btn-group" rs-dropdown dropdown-append-to-body style="max-width: 100%;margin-right:10px;margin-bottom: -7px;margin-top:-7px" is-open="$ctrl.menuList['C'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px">
            {{$ctrl.asTempSet($root.active.state.heatedChambers[$index],e)}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" digits="e.setPrecision" value="$root.active.state.heatedChambers[$index].tempSet" changed="$root.RSPrinter.setChamberTemperature(value,$index)"></knob>
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setChamberTemperature(0,$index);$ctrl.closeMenu('C'+$index)"><?php _('Off') ?></a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setChamberTemperature(t.temp,$parent.$index);$ctrl.closeMenu('C'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-if="!$root.user.printPermission || !e.supportTemperature">{{$ctrl.asTempSet($root.active.state.heatedChambers[$index],e)}}</div>
      </td>
    </tr>
  </table>
  </div>
  <div class="margin-left margin-right">
    <div class="checkbox visible-lg">
      <label>
        <input type="checkbox" ng-model="$root.active.tempSettings.showGraphFullWidth">
        <?php _('Show temperature graphs with full width') ?>
    </label>
    </div>
    <div class="row">
     <div ng-if="$root.active.tempSettings.extruders[$index].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden" ng-repeat="e in $root.activeConfig.extruders track by $index">
      <h4>
        <i ng-class="$root.RSPrinter.extruderIcon($index)"></i> {{$root.RSPrinter.extruderName($index)}}
      </h4>
      <temp-chart history="$root.active.state.extruder[$index].history" style="height:200px;width:100%"></temp-chart>
    </div>
    <div ng-repeat="h in $root.activeConfig.heatedBeds track by 'b'+$index" ng-if="$root.active.tempSettings.heatedBeds[$index].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden">
      <h4>
        <i class="rs rs-bed"></i> {{$root.RSPrinter.bedName($index)}}
      </h4>
      <temp-chart history="$root.active.state.heatedBeds[$index].history" unit="h.unit" show-temp-set="h.supportTemperature" style="height:200px;width:100%"></temp-chart>
    </div>
    <div ng-repeat="h in $root.activeConfig.heatedChambers track by 'c'+$index" ng-if="$root.active.tempSettings.heatedChambers[$index].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden">
      <h4>
        <i ng-class="$root.RSPrinter.chamberIcon($index)"></i> {{$root.RSPrinter.chamberName($index)}}
      </h4>
      <temp-chart history="$root.active.state.heatedChambers[$index].history" unit="h.unit" show-temp-set="h.supportTemperature" style="height:200px;width:100%"></temp-chart>
    </div>
    </div>
    <div class="well margin-top">
      <div class="row">
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-minus" style="color:#2D7495"></i> <?php _('Current Temperature') ?></div>
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-minus" style="color:#A541B4"></i> <?php _('Target Temperature') ?></div>
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-area-chart" style="color:#3E714A"></i> <?php _('Output') ?></div>
      </div>
    </div>
  </div>
</div>`,controller:["$rootScope","User","RSCom","Confirm","$scope","$uibModal",function(t,e,i,r,n,o){this.menuList={},this.closeMenu=l=>{this.menuList[l]=!1};function a(l){return l.tempSet===0?"<?php _('Off') ?>":l.output.toFixed(0)+"%"}this.asTemp=(l,h)=>{if(l.tempRead===-333)return"<?php _('DEF') ?>";if(l.tempRead===-444)return"<?php _('DEC') ?>";let u="\xB0C";return h&&h.unit&&(u=h.unit),l.tempRead.toFixed(1)+u},this.asTempSet=(l,h)=>l.tempSet===0?"<?php _('Off') ?>":l.tempSet.toFixed(h.setPrecision)+(h&&h.unit?h.unit:"\xB0C"),this.extruderOutput=l=>a(t.active.state.extruder[l]),this.bedOutput=l=>a(t.active.state.heatedBeds[l]),this.chamberOutput=l=>a(t.active.state.heatedChambers[l]),this.extrudeDialog=l=>{i.send("send",{cmd:"T"+l+`
G92 E0`}),o.open({templateUrl:"/views/printer/control/printer.control.extrude.php?lang="+lang,scope:n,size:"sm",controller:["$scope",function(h){t.active.state.extruder.length>0&&(h.retractSpeed=t.activeConfig.extruders[l].retractSpeed,h.extrudeSpeed=t.activeConfig.extruders[l].extrudeSpeed),h.extrudeDistance=10}]})},this.fixExtraEntries=()=>{t.active.tempSettings||(t.active.tempSettings={extruders:[],heatedBeds:[],heatedChambers:[],showGraphFullWidth:!1});let l=t.active.tempSettings,h=t.activeConfig;for(;l.extruders.length<h.extruders.length;)l.extruders.push({show:!0});for(;l.heatedBeds.length<h.heatedBeds.length;)l.heatedBeds.push({show:!0});for(;l.heatedChambers.length<h.heatedChambers.length;)l.heatedChambers.push({show:!0})},this.$onDestroy=()=>{},this.$onInit=()=>{this.fixExtraEntries()}}]});RSPrinterModule.factory("SelectWizards",["$uibModal",function(t){return function(){let e=t.open({templateUrl:"/views/printer/dialog/selectWizards.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter","RSCom","Flash","User",function(i,r,n,o,a,l,h){i.wizards=[n.activeConfig.wizardCommands,n.activeConfig.wizardTemplates],i.wizardSelections=[{},{}],i.showSelectedButtons=[!1,!1],i.checkAll=[!1,!1],i.tabIndex=0;let u=0;angular.forEach(i.wizards,f=>{angular.forEach(f,d=>{i.wizardSelections[u][d.uuid]=!1}),u++}),a.send("refreshWizard");let c=()=>{i.checkAll[i.tabIndex]=!1,i.showSelectedButtons[i.tabIndex]=!1,angular.forEach(i.wizardSelections[i.tabIndex],(f,d)=>{i.wizardSelections[i.tabIndex][d]=!1})};i.cancel=function(){r.dismiss()},n.$on("config",function(f,d){i.wizards=[n.activeConfig.wizardCommands,n.activeConfig.wizardTemplates]}),i.selectSingleWizard=f=>{i.checkAll[i.tabIndex]=!1,i.showSelectedButtons[i.tabIndex]=!1,angular.forEach(i.wizards[i.tabIndex],d=>{let m=d.uuid===f?!i.wizardSelections[i.tabIndex][d.uuid]:i.wizardSelections[i.tabIndex][d.uuid];i.showSelectedButtons[i.tabIndex]=i.showSelectedButtons[i.tabIndex]||m})},i.selectAllWizards=()=>{if(i.wizards[i.tabIndex].length===0){i.checkAll[i.tabIndex]=!1;return}angular.forEach(i.wizards[i.tabIndex],(f,d)=>{i.wizardSelections[i.tabIndex][f.uuid]=!i.checkAll[i.tabIndex]&&h.showFeature(f.editPermission)}),i.showSelectedButtons[i.tabIndex]=!i.checkAll[i.tabIndex],i.checkAll[i.tabIndex]=!i.checkAll[i.tabIndex]},i.wizardIsInstalled=f=>{let d=!1;return angular.forEach(i.wizards[0],(m,p)=>{m.uuid===f&&(d=!0)}),d},i.uninstallWizard=f=>{f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(d,m)=>{d&&i.wizardIsInstalled(m)&&a.send("uninstallWizard",{uuid:m})}):a.send("uninstallWizard",{uuid:f}),c()},i.installWizard=f=>{f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(d,m)=>{d&&!i.wizardIsInstalled(m)&&a.send("installWizard",{uuid:m})}):a.send("installWizard",{uuid:f}),c()},i.deleteWizard=f=>{let d=!1;f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(m,p)=>{angular.forEach(i.wizards[i.tabIndex],(v,g)=>{v.uuid===p&&v.source!==1&&(d=!0)}),m&&d&&a.send("deleteWizard",{uuid:p})}):(angular.forEach(i.wizards[i.tabIndex],(m,p)=>{m.uuid===f&&m.source!==1&&(d=!0)}),d&&a.send("deleteWizard",{uuid:f})),c()},i.importWizard=()=>{let f=$("#WizardFileImport"),d=f.val().replace(/\\/g,"/").replace(/.*\//,""),m=f.get(0).files[0].size;a.send("projectsCanUploadWithSize",{size:m}).then(function(p){p.ok?($("#UploadName").val(d),i.uploading=!0,a.extendPing(300),$("#wizardImport").ajaxSubmit({success:function(){l.success("<?php _('Upload finished') ?>"),i.uploading=!1,a.extendPing(0),f.val(""),a.send("refreshWizard"),c()},uploadProgress:function(v,g,_,x){i.uploadProgress=x},headers:{"X-Csrf-Token":a.getCookie("Csrf-Token")}}),d!==""&&f.val("")):l.error("",p.error?p.error:"<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},window.importWizard=i.importWizard,i.exportWizard=f=>{let d=[];if(f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(m,p)=>{m&&d.push('"'+p+'"')}):d.push('"'+f+'"'),d.length!==0){let m="/printer/wizards/"+n.activeSlug+"?a=export&uuid=["+d.toString()+"]&custom=";m+=i.tabIndex===0?"1":"0",console.log(m),window.open(m,"ihelper")}}}],size:"lg"});return e.result.catch(function(i){}),e.result}}]);RSPrinterModule.factory("AdvertisementController",["$uibModal","$q","$http",function(t,e,i){return function(){let r=e.defer();return i.get("/reminder/reminder.json").then(n=>{let o=t.open({templateUrl:"/views/printer/dialog/AdvertisementDialog.php?lang="+lang,backdrop:"static",keyboard:!1,controller:["$scope","$uibModalInstance","$sce",function(a,l,h){a.sliderJSONData=n.data,a.trustedContent=[],a.slideIndex=0,a.timer=5,a.sliderJSONData.contents.forEach(f=>{f.trans[window.lang]?a.trustedContent.push(h.trustAsHtml(f.trans[window.lang])):a.trustedContent.push(h.trustAsHtml(f.trans.en))}),a.slideIndex=Math.floor(Math.random()*(a.sliderJSONData.contents.length-1));let u=["<?php _('Skip') ?>","<?php _('Close') ?>","<?php _('Not now') ?>","<?php _('Nah, I\xB4m fine') ?>","<?php _('Cancel') ?>"],c=["<?php _('Support us') ?>","<?php _('Buy now') ?>","<?php _('Upgrade to pro') ?>"];a.buttonBuyText=c[Math.floor(Math.random()*c.length)],a.buttonCloseText=u[Math.floor(Math.random()*u.length)],a.moveSlide=f=>{a.slideIndex+=f,a.showSlide(a.slideIndex)},a.cancel=function(){l.close(!0)},a.$on("$destroy",()=>{r.resolve(),clearInterval(this.intervalTimer)}),a.showSlide=f=>{a.slideIndex=f,a.slideIndex<0&&(a.slideIndex=a.sliderJSONData.contents.length-1),a.slideIndex>=a.sliderJSONData.contents.length&&(a.slideIndex=0)},a.getButtonCloseText=()=>a.timer>0?"<?php _('@ seconds remaining') ?>".replace("@",a.timer.toString()):a.buttonCloseText,a.startTimer=()=>{a.timer>0?a.timer--:clearInterval(this.intervalTimer)},a.automaticSlideshow=()=>{a.sliderJSONData.contents&&(a.slideIndex>=a.sliderJSONData.contents.length-1?a.slideIndex=0:a.slideIndex++)},this.intervalTimer=setInterval(a.startTimer,1e3)}]})}),r.promise}}]);RSBase.component("rsPrintProgress3d",{template:`
<div>
<div style=" margin: 0;height:70vh;padding:0;touch-action: auto; width:100%;position:relative">
<div id="container-3d"
        class="threeDView"
        style="position:relative; margin:0;width:100%;padding:0;touch-action: none;"
        oncontextmenux="return false;"
        ng-click="toggle3DMenu('')"
   >
     <div id="gcode3dview" ng-style="{height: $root.isFullscreen ? '100vh' : $ctrl.glHeight}">
        <canvas></canvas>
        <div class="axis"><canvas></canvas></div>
     </div>     
     <div class="gc-features" ng-if="$ctrl.analyser.id && $ctrl.gcodeLoaded">
       <h3 ng-click="$ctrl.toggleLegend()">{{$ctrl.preview3d.featureHeadline}}
         <span class="pull-right margin-left">
           <i class="fa" ng-class="{'fa-caret-down':$ctrl.show3dLegend, 'fa-caret-right':!$ctrl.show3dLegend}"></i>
         </span>
       </h3>
       <div ng-if="$ctrl.show3dLegend">
       <div ng-repeat="f in $ctrl.preview3d.features track by $index">
         <div class="ft-color" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>        
        <hr ng-if="$ctrl.preview3d.roundFeatures.length">
       <div ng-repeat="f in $ctrl.preview3d.roundFeatures track by $index">
         <div class="ft-color-round" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>                
       </div>
     </div>
     <!-- Menu -->
     <div style="position: absolute;top:10px;right:10px;z-index:100">
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('opt3d', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-bars gl-2" style="position: relative"></i>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('view', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'" color-class="gl-2" style="position: relative"></rs-icon>
         </div>
       </div>
       <div ng-if="$ctrl.analyser.id" class="d-inline-block" ng-click="$ctrl.toggle3DMenu('info', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-info-circle gl-2" style="position: relative"></i>
         </div>
       </div>
       <div ng-if="$root.supportsFullscreen" class="gl-btn"  style="position:relative" title3="<?php _('Toggle Full Screen') ?>" ng-click="$ctrl.toggleFullscreen()">
         <i class="rs gl-2" style="position: relative" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i>
       </div>
     </div>
     <!-- settings menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.opt3d" ng-click="$event.stopPropagation()">
         <div class="form-group">
           <label><?php _('Quality') ?></label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.quality" 
                   ng-options="f.value as f.name for f in $ctrl.qualityNameMap"></select>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRapidMotion" 
                    ng-change="$ctrl.update3dOptions(false)">
               <?php _('Show Travel') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentTop" 
                    ng-change="$ctrl.update3dOptions(false)">
             <?php _('Show transparent top') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.orbitIfPrinting" 
                    ng-change="$ctrl.update3dOptions(false)">
             <?php _('Rotate during print') ?>
           </label>
         </div>         
         <div class="margin-bottom">
           <label><?php _('Warn if required memory exceeds') ?></label><br>
           <input type="number" style="width:120px;background: #00000080;color: #ffffff;" ng-model="$ctrl.options3d.memoryWarnSize"> MB
         </div>
         <div>
          <div class="btn btn-primary btn-block" ng-click="$ctrl.saveDefault()"><i class="fa fa-save"></i> <?php _('Default Preview') ?></div> 
        </div>
     </div>
     <div class="gc-menu" ng-if="$ctrl.menu3d.view" xng-click="$event.stopPropagation()">
       <ul>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientIsometric();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-iso.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Isometric View') ?></a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientTop();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-top.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Top View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientFront();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-front.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Front View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientLeft();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-left.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Left View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientRight();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-right.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Right View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBack();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-back.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Back View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBottom();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-bottom.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Bottom View') ?>
           </a>
         </li>
         <li class="hr"></li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.fitPrinter();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
               <?php _('Fit Printer') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.fitObject();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-object.svg'"></rs-icon>
             </div>
               <?php _('Fit Object') ?>
           </a>
         </li>
         <li class="hr" ng-if="!$root.activeConfig.isZBelt"></li>
         <li role="menuitem" ng-if="!$root.activeConfig.isZBelt">
           <a href="#" ng-click="$ctrl.toggleExcludeRegion();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon="rs rs-killregion"></rs-icon>
             </div>
               <?php _('Exclude G-Codes') ?>
           </a>
         </li>
       </ul>
     </div>
     <!-- info menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.info" ng-click="$event.stopPropagation()">
        <ul class="list-group" style="text-align: left">
          <li class="list-group-item active">
            <h4 style="margin:0"><?php _('G-Code Analysis') ?></h4>
          </li>
          <li class="list-group-item">
            <span><?php _('Number of Layers') ?>:</span>
            <span >{{$ctrl.analyser.totalLayer}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Z Height') ?>:</span>
            <span>{{$ctrl.analyser.totalHeight | number:3}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span><?php _('X Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.xmin | number:2}} - {{$ctrl.analyser.layerInfo.xmax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span><?php _('Y Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.ymin | number:2}} - {{$ctrl.analyser.layerInfo.ymax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape==='circle'">
            <span><?php _('Radius Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.radius | number:2}} mm</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Printing Time') ?>:</span>
            <span>{{$ctrl.analyser.totalDuration | dhms}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Number of Lines') ?>:</span>
            <span>{{$ctrl.analyser.totalLines}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Slicer') ?>:</span>
            <span>{{$ctrl.model.slicer}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Volumetric Extrusion') ?>:</span>
            <span>{{$ctrl.model.volumetric | yesno}}</span>
          </li>
        </ul>
     </div>
     <div ng-if="$ctrl.showMemoryWarning" class="bg-warning text-warning" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <p><?php _('To show this 3d preview, more memory than the set threshold is required. If you continue and it does not fit in memory, it will crash your browser window.') ?>
     <?php _('The print will not be affected by a possible browser crash!') ?>
     </p>
     <p>{{$ctrl.sizeMessage}}</p>
     <br>
     <div class="btn btn-warning" style="width:100%" ng-click="$ctrl.continueShow()">Continue</div>
    </div>
     <div ng-if="$root.active.status.jobid>0 && $root.active.status.analysed===0" class="bg-info text-info" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <div style="display: flex;flex-wrap: nowrap;align-items: center;">
     <div><i class="fa fa-spinner fa-spin fa-2x"></i></div>
     <div style="padding-left:10px"><?php _('Preview data gets computed. It will appear automatically once computation is finished.') ?></div>     
     </div>
    </div>
     </div>
     </div>
     <div ng-if="$ctrl.excludeRegionActive" class="bg-info text-info" 
            style="padding: 5px;">
     <?php _('Mark a region to exclude by drawing a rectangle on the bed with left mouse button down.') ?>     
     <div class="btn btn-info btn-block margin-top" ng-click="$ctrl.toggleExcludeRegion()">Abort</div>
     </div>
     </div>
`,controllerAs:"$ctrl",bindings:{slug:"<",model:"<",mode:"@",register3dView:"<"},controller:["$element","$interval","$rootScope","RSCom","$document","$sce","Fullscreen","Flash","$scope","$timeout",function(t,e,i,r,n,o,a,l,h,u){let c=!1,f=null,d=null,m=!1;this.glHeight="70vh",this.memoryGuessed=0,this.gcodeLoaded=!1,this.showMemoryWarning=!1,this.sizeMessage="",this.qualityNameMap=x_,this.featureNameMap=ws,this.show3dLegend=document.body.clientWidth>500,this.analyser=new Pa({user:i.user}),this.model=null,this.excludeRegionActive=!1,this.memoryAccepted=0,this.toggleLegend=()=>{this.show3dLegend=!this.show3dLegend},this.options3d={quality:pi?1:2,show:1,transparentTop:!1,transparentBottom:!1,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,smoothNozzleMove:!0,orbitIfPrinting:!1,memoryWarnSize:Ls?20:200},this.menu3d={opt3d:!1,view:!1,info:!1};let p=window.localStorage.getItem("gcode3dOptions");p&&(p=JSON.parse(p));let v=window.localStorage.getItem("gcodelive3dOptions");v&&(this.options3d=Mt(Mt({},this.options3d),JSON.parse(v))),p&&p.memoryWarnSize&&(this.options3d=Qs(Mt({},this.options3d),{memoryWarnSize:p.memoryWarnSize})),this.saveDefault=()=>{window.localStorage.setItem("gcodelive3dOptions",JSON.stringify(this.options3d)),p=window.localStorage.getItem("gcode3dOptions"),p&&(p=JSON.parse(p)),p&&p.memoryWarnSize?p.memoryWarnSize=this.options3d.memoryWarnSize:p={memoryWarnSize:this.options3d.memoryWarnSize},window.localStorage.setItem("gcode3dOptions",JSON.stringify(p)),l.success("<?php _('View settings stored as default for this browser') ?>")},this.toggle3DMenu=(_,x)=>{_==="opt3d"?this.menu3d.opt3d=!this.menu3d.opt3d:this.menu3d.opt3d=!1,_==="view"?this.menu3d.view=!this.menu3d.view:this.menu3d.view=!1,_==="info"?this.menu3d.info=!this.menu3d.info:this.menu3d.info=!1,_&&x&&x.stopPropagation()},this.updateAnimation=()=>{let _=this.options3d.orbitIfPrinting;this.preview3d.liveComplete&&(_=!1),_?this.preview3d.view.startAnimate(4):this.preview3d.view.stopAnimate()},this.update3dOptions=_=>{f.updateExcludeRegions(),this.gcodeLoaded&&(f.setOptions(this.options3d),_?f.updateGCodeGeometry():f.setNextLiveProgress(!0),this.updateAnimation())},h.$on("excludeRegionsStored",function(){f&&f.updateExcludeRegions()}),this.toggleFullscreen=function(){a.toggleFullscreen($("#container-3d")[0])};let g=!1;this.loadGCode=async()=>{if(f.model=this.model,this.showMemoryWarning=!1,this.analyser.layerData=null,this.analyser.loadingFullData=!1,await this.analyser.loadData(),this.gcodeLoaded=!0,this.update3dOptions(!0),this.analyser.layerData&&i.active.status.jobid){let _=i.active.state;this.preview3d.setLiveProgress(_.layer,_,{x:_.xOff,y:_.yOff,z:_.zOff}),this.preview3d.setNextLiveProgress()}},this.checkMemoryAndLoad=()=>{this.memoryGuessed=this.analyser.guess3dMemory()/1024/1024,this.memoryGuessed===0&&(this.memoryGuessed=this.analyser.totalLines*37/1024/1024),this.memoryGuessed>this.options3d.memoryWarnSize&&this.memoryGuessed>this.memoryAccepted?(this.sizeMessage="<?php _('The guessed memory required is @1 MB. Your set warning limit for this browser is @2 MB.') ?>".replace("@1",this.memoryGuessed.toFixed(0)).replace("@2",this.options3d.memoryWarnSize.toFixed(0)),this.showMemoryWarning=!0):this.loadGCode()},this.selectExcludeStart=()=>{let _=this.preview3d.view.ray.ray,x={x:_.origin.x+_.direction.x*(_.origin.z-i.activeConfig.movement.zMin),y:_.origin.y+_.direction.y*(_.origin.z-i.activeConfig.movement.zMin),z:i.activeConfig.movement.zMin};this.preview3d.drawCross(x),this.excludeRegionP1?(this.excludeRegionP2=Qs(Mt({},x),{z:i.activeConfig.movement.zMax}),this.preview3d.drawSelectionBox(this.excludeRegionP1,this.excludeRegionP2)):this.preview3d.hideSelectionBox()},this.excludeClickCallback=_=>{if(_.shiftKey===!1&&_.handleAsLeftButton){let x=this.preview3d.view.ray.ray,b={x:x.origin.x+x.direction.x*(x.origin.z-i.activeConfig.movement.zMin),y:x.origin.y+x.direction.y*(x.origin.z-i.activeConfig.movement.zMin),z:i.activeConfig.movement.zMin};this.excludeRegionP1=b}else this.excludeRegionP1=void 0},this.excludeUnclickCallback=_=>{if(this.excludeRegionP1&&_.handleAsLeftButton){let x={xmin:Math.min(this.excludeRegionP1.x,this.excludeRegionP2.x),xmax:Math.max(this.excludeRegionP1.x,this.excludeRegionP2.x),ymin:Math.min(this.excludeRegionP1.y,this.excludeRegionP2.y),ymax:Math.max(this.excludeRegionP1.y,this.excludeRegionP2.y)};if(x.xmax-x.xmin<=2||x.ymax-x.ymin<=2){this.excludeRegionP1=void 0;return}r.send("addExcludeRegion",x),this.toggleExcludeRegion()}this.excludeRegionP1=void 0},this.excludeCancelCallback=_=>{this.excludeRegionP1=void 0},this.toggleExcludeRegion=()=>{this.excludeRegionActive?(this.excludeRegionActive=!1,this.preview3d.liveComplete=!1,this.preview3d.hideSelectionBox(),this.preview3d.hideCross(),this.preview3d.view.orbitParallel.mouseButtons.LEFT=0,this.preview3d.view.orbitParallel.touches.ONE=0,this.preview3d.view.disableRaycasts(),this.preview3d.view.disablePointerCallbacks(),this.preview3d.forceRenderLoop=!1,this.preview3d.renderCallback=!1,this.preview3d.view.selectCamera(!0),this.preview3d.setNextLiveProgress(!0),this.updateAnimation()):(this.excludeRegionActive=!0,this.excludeRegionP1=null,this.preview3d.forceRenderLoop=!0,this.preview3d.view.enableRaycasts(),this.preview3d.view.clickCallback=this.excludeClickCallback,this.preview3d.view.unclickCallback=this.excludeUnclickCallback,this.preview3d.renderCallback=this.selectExcludeStart,this.preview3d.view.cancelCallback=this.excludeCancelCallback,this.preview3d.view.selectCamera(!1),this.preview3d.view.orbitParallel.mouseButtons.LEFT=-1,this.preview3d.view.orbitParallel.touches.ONE=-1,this.preview3d.view.orientTop(),this.preview3d.fitObject(),this.preview3d.liveComplete=!0,this.preview3d.hideCross(),this.preview3d.setNextLiveProgress(!0),this.updateAnimation())},this.showGcode3d=async()=>{if(f||c||g)return;let _=$("#gcode3dview");if(_.length===0||_[0].clientWidth===0||_[0].children.length===0){setTimeout(this.showGcode3d,25);return}g=!0,f=new mu(_,Mt({slug:this.slug,live:!0,rootScope:i,analyser:this.analyser,model:null},this.options3d)),this.preview3d=f,this.preview3d.view.orbit.requireShiftZoom=!0,f.view.orientIsometric(),this.fitObjectOrPrinter(),this.gcodeLoaded=!1,d=new IntersectionObserver(x=>{x[0].isIntersecting&&!m&&(m=!0),this.adjustSize()},{}),d.observe($("#gcode3dview")[0]),this.adjustSize(),gi.initialized.then(()=>{let x=()=>{!c&&!this.preview3d.setNozzlePosition(i.active.state)&&u(x,200)};u(x)}),this.preview3d.updateExcludeRegions(),this.checkForChangedJob()},this.continueShow=()=>{this.memoryAccepted=this.memoryGuessed+10,this.loadGCode()},this.adjustSize=()=>{window.innerHeight>500&&this.mode==="preview"?u(()=>{let _=t.get()[0].getBoundingClientRect();this.glHeight=Math.floor(window.innerHeight-_.top).toFixed(0)+"px",window.scrollY=0},10):this.glHeight="70vh"},h.$on("windowResized",()=>{this.adjustSize()}),this.fitObjectOrPrinter=()=>{this.preview3d.fitObject();let _=this.preview3d.options.model;f.view.isZBelt&&_&&_.zMax>i.activeConfig.movement.zMax&&f.view.fitPrinter()},this.checkForChangedJob=()=>{this.preview3d&&this.analyser.id!==i.active.status.jobid&&(i.active.status.jobid===0?(this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.updateGCodeGeometry(),this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!0,this.updateAnimation()):i.active.status.analysed===1&&(this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!1,this.updateAnimation(),this.analyser.id&&r.send("jobInfo",{id:i.active.status.jobid},this.slug).then(_=>{this.model=_,this.preview3d.options.model=_,this.fitObjectOrPrinter()}),this.analyser.loadInfo().then(()=>{this.checkMemoryAndLoad()})))},h.$on("jobDeactivated",()=>{this.preview3d&&(this.preview3d.liveComplete=!0,this.updateAnimation())}),h.$on("xgcodeAnalysisFinished",(_,x)=>{console.log("gcodeAnalysisFinished",x),x.data.slug===i.activeSlug&&x.data.modelId===i.active.status.jobid&&x.data.list==="jobs"&&(console.log("Loading new generated data"),this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!1,this.updateAnimation(),this.analyser.id&&r.send("jobInfo",{id:i.active.status.jobid},this.slug).then(b=>{this.model=b,this.preview3d.options.model=b,this.fitObjectOrPrinter()}),this.analyser.loadInfo().then(()=>{this.checkMemoryAndLoad()}))}),h.$on("move",(_,x)=>{if(x.printer===i.activeSlug&&(this.checkForChangedJob(),this.preview3d)){let b=i.active.state;this.analyser.layerData&&i.active.status.jobid?this.preview3d.setLiveProgress(x.data.l,x.data,{x:b.xOff,y:b.yOff,z:b.zOff}):(this.preview3d.liveLayer=x.data.l,this.preview3d.livePos=x.data,this.preview3d.liveOffset={x:b.xOff,y:b.yOff,z:b.zOff},this.preview3d.pushNozzleMove({x:x.data.x,y:x.data.y,z:x.data.z,f:i.activeConfig.movement.maxXYSpeed*i.active.state.speedMultiply*.01}))}}),this.$onDestroy=()=>{c=!0,d&&d.disconnect(),f&&(f.$destroy(),f=null),this.analyser=null,this.register3dView&&this.register3dView(null)},this.$onChanges=_=>{},this.$onInit=()=>{this.adjustSize(),this.showGcode3d(),this.register3dView&&this.register3dView(this)}}]});var LG=bT();RSPrinterModule.controller("ProjectController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","StringDialog","RSPrinters","User","Flash","$uibModal","$state","$anchorScroll","$sce","$interval","SelectProjectFolder","SelectPrinterGroup","SelectPrinter",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_,x,b,y){r.globals||(r.globals={}),t.$on("userSettingsChanged",function(){r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))}),r.globals.projectView||(r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))),t.savedProjectView=function(){f.setSetting("projectView",JSON.stringify(r.globals.projectView))};let S=function(C){t.activeproject=C,t.licensetext=g.trustAsHtml(C.licenseHtml);function E(P,A){return P.nameic>A.nameic?1:P.nameic<A.nameic?-1:0}t.activeproject.gcodes||(t.activeproject.gcodes=[]),angular.forEach(t.activeproject.models,function(P){var A;P.nameic=P.n.toLowerCase(),P.f=(A=P.f)!=null?A:255,P.hasImage=(P.f&&1)===1,P.hasInfo=(P.f&&2)===2,P.has3d=(P.f&&4)===4}),angular.forEach(t.activeproject.gcodes,function(P){var A;P.nameic=P.n.toLowerCase(),P.f=(A=P.f)!=null?A:255,P.hasImage=(P.f&&1)===1,P.hasInfo=(P.f&&2)===2,P.has3d=(P.f&&4)===4}),angular.forEach(t.activeproject.others,function(P){var A;P.nameic=P.n.toLowerCase(),P.f=(A=P.f)!=null?A:255,P.hasImage=(P.f&&1)===1,P.hasInfo=(P.f&&2)===2,P.has3d=(P.f&&4)===4}),t.activeproject.models.sort(E),t.activeproject.gcodes.sort(E),t.activeproject.others.sort(E),t.editmode||(t.editproject=angular.copy(t.activeproject)),w()};t.serverList=[],t.activeServer={},t.folderTree=[],t.foldersIdx=0,t.activeFolder={},t.activeproject=!1,t.editproject=!1,t.editmode=!1,t.editTags=!1,t.tags=[],t.newTagName="",t.uploading=!1,t.uploadingZip=!1,t.imageList=[],t.activeImageIndex=0,t.activeImage={n:""},t.view3d=!1,t.comment={comment:"",user:""},t.uploadProgress=0,t.menuGCode1={},t.menuGCode2={},t.closeGCode1=function(C){t.menuGCode1[C.n]=!1},t.closeGCode2=function(C){t.menuGCode2[C.n]=!1},t.go=function(C){v(C)},t.editProject=function(){t.editproject=angular.copy(t.activeproject),t.editmode=!0},t.toggleEditTags=function(){t.editTags=!t.editTags,t.editTags&&i.send("projectListTags",{serveruuid:t.activeServer.uuid}).then(function(C){if(C.ok){let P=function(A,R){return A.c>R.c?-1:A.c<R.c?1:0};var E=P;C.tags.sort(P),t.tags=C.tags}})},t.copyGCode=function(C){b("<?php _('Copy to G-Code Models') ?>").then(function(E){i.send("projectGCodeFromProject",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,file:C.n,group:E.group},E.slug).then(function(P){P.ok?d.info("<?php _('Copy G-Code ...') ?>","<?php _('G-Code copy started.') ?>",3e4,!0):d.error("",P.error,1e4,!0)})},function(){})},t.printGCode=function(C){y("<?php _('Print to G-Code') ?>").then(function({list:E,autostart:P}){angular.forEach(E,function(A){i.send("projectPrintFromProject",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,file:C.n,autostart:P},A.slug).then(function(R){R.ok?R.print?d.info("<?php _('Print G-Code ...') ?>","<?php _('Print started.') ?>",3e4,!0):d.info("<?php _('Print G-Code ...') ?>","<?php _('Print added to printing queue.') ?>",3e4,!0):d.error("",R.error,1e4,!0)})})},function(){})},t.addTag=function(){let C=!1;t.activeproject.tags.forEach(function(E){C|=E===t.newTagName}),!C&&i.send("projectAddTag",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,tag:t.newTagName,format:2}).then(function(E){E.ok?(t.activeproject.tags.push(t.newTagName),t.newTagName=""):d.error("",E.error,1e4,!0)})},t.addComment=function(){let C=!1;t.activeproject.tags.forEach(function(E){C|=E===t.newTagName}),!C&&i.send("projectAddComment",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,comment:t.comment.comment,username:t.comment.user,format:2}).then(function(E){E.ok?(S(E.project),t.comment.comment=""):d.error("",E.error,1e4,!0)},function(){})},t.deleteComment=function(C){l("<?php _('Security Question') ?>","<?php _('Really delete comment?') ?>","<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("projectDelComment",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,comment:C.comment,username:C.user,format:2}).then(function(E){E.ok?S(E.project):d.error("",E.error,1e4,!0)},function(){})},function(){})},t.delTag=function(C,E){i.send("projectDelTag",{servername:t.activeServer.name,serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,tag:C,format:2}).then(function(P){P.ok?t.activeproject.tags.splice(E,1):d.error("",P.error,1e4,!0)})},t.cancelProject=function(){t.editproject=angular.copy(t.activeproject),t.editmode=!1},t.saveProject=function(){i.send("projectsUpdateProject",{serveruuid:t.activeServer.uuid,project:t.editproject,format:2}).then(function(C){C.ok?(S(C.project),t.editproject=angular.copy(t.activeproject),t.editmode=!1):d.error("",C.error,1e4,!0)})},t.show3d=function(C){C.stopPropagation(),t.view3d=!0},t.selectView=function(C){t.view3d=!1,t.activeImageIndex=C,t.activeImage=t.imageList[C]},t.selectFolderLevel=function(C){p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:t.activeproject.parents[C].idx})};let w=function(){t.imageList=[],t.activeImageIndex=0,angular.forEach(t.activeproject.models,function(C){C.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let E=encodeURIComponent(C.n);C.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,t.imageList.push(Qs(Mt({},C),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,m:0,tp:0,t3model:"/project/"+t.activeServer.uuid+"/downloadModel/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,n:C.n}))}),angular.forEach(t.activeproject.gcodes,function(C){C.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let E=encodeURIComponent(C.n);C.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,t.imageList.push(Qs(Mt({},C),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,m:0,tp:2,gcode:!0,t3model:"/project/"+t.activeServer.uuid+"/downloadModel/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,n:C.n}))}),angular.forEach(t.activeproject.images,function(C){C.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let E=encodeURIComponent(C.n);C.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,t.imageList.push(Qs(Mt({},C),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+E+"?v="+t.activeproject.version,m:0,tp:1,n:C.n}))}),t.imageList.length===0&&t.imageList.push({t:"/img/emptyproject.png",i:"/img/emptyproject.png",m:0,n:"No files"}),angular.forEach(t.activeproject.others,function(C){let E=C.n.substring(C.n.lastIndexOf(".")).toLowerCase();C.viewable=E===".txt"||E===".md"||E===".htm"||E===".html"||E===".pdf"||E===".mp4",C.gcode=E===".gcode"||E===".gco"||E===".g"||E===".nc"||E===".tap"||E===".cnc"})};t.refreshProject=function(){let C=t.activeproject.uuid;i.send("projectsGetProject",{serveruuid:t.activeServer.uuid,uuid:C,format:2}).then(function(E){E.ok&&C===t.activeproject.uuid?S(E.project):p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})},t.$on("projectChanged",function(C,E){E.data.uuid===t.activeproject.uuid&&t.refreshProject()}),t.$on("projectDeleted",function(C,E){E.data.uuid===t.activeproject.uuid&&p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})}),t.previewGCode=function(C,E){C.f&2&&p.go("projectgcodepreview",{serverid:t.activeServer.uuid,projectid:t.activeproject.uuid,model:C.n,tab:E})},t.recomputeGCodeInfo=function(C){C.f&2&&i.send("projectReparseGCode",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:C.n})},t.info=async function(C){if(C.f&2){let E=await i.send("projectGetGCodeInfo",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:C.n});if(E.ok){let P=E.info;P.name=C.n,P.printer=C.p,m.open({templateUrl:"/views/projects/GCodeSummary.php?lang="+window.lang,scope:t,controller:["$scope",function(A){A.plist=[],A.noteEdit=!1,A.model=P;let R=r.serverSettings.pricing,k=R.map;A.$on("modal.closing",function(){angular.forEach(A.plist,function(L){A.model.materials[L.idx]=L.filament.u}),i.send("projectSetGCodeInfo",{id:C.n,serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,info:A.model})});function I(L){if(!L)return 0;let T=0;return angular.forEach(R.filaments,function(O,D){O.u===L&&(T=D)}),T}A.filaments=R.filaments,A.currency=R.currency,angular.forEach(P.volumeUsage,function(L,T){L<=0||A.plist.push({idx:T,extruder:T+1,mm:P.extruderUsage[T],volume:L*.001,price:0,filament:R.filaments[I(P.materials[T])],weight:0})}),A.updateCalc=function(){A.weightTotal=0,A.total=R.perPrint+R.perHour*P.printTime/3600,angular.forEach(A.plist,function(L){L.weight=L.volume*L.filament.w,A.weightTotal+=L.weight,L.price=L.weight*L.filament.p/1e3,A.total+=L.price})},A.close=function(){angular.forEach(A.plist,function(L,T){k[T.toString()+"_"+t.slug]=L.filament.u}),A.$close()},A.updateCalc()}]})}}},t.selectProject=function(C){i.send("projectsGetProject",{serveruuid:t.activeServer.uuid,uuid:C,format:2}).then(function(E){E.ok?(S(E.project),t.activeImage.n.length===0&&(t.activeImage={n:E.project.preview},w())):p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})};let M=_(function(){r.serverSettings.serveruuid!==t.activeServer.uuid&&i.send("projectGetProjectVersion",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid}).then(function(C){C.ok&&C.version!==t.activeproject.version&&t.refreshProject()})},1e4);t.$on("$destroy",function(){M&&(_.cancel(M),M=null)}),t.newProjectName=function(C,E,P){i.send("projectsRenameProject",{servername:t.activeServer.name,serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:P.uuid,newName:E}).then(function(A){A.ok?t.folderTree[t.foldersIdx]=t.activeFolder=A.folder:d.error("",A.error,1e4,!0)})},t.newFileName=function(C,E){i.send("projectsRenameFile",{serveruuid:t.activeServer.uuid,uuid:t.activeproject.uuid,newName:E,oldName:C,format:2}).then(function(P){P.ok?S(P.project):d.error("",P.error,1e4,!0)})},t.tryDeleteFile=function(C,E){E.stopPropagation(),l("<?php _('Security Question') ?>","<?php _('Really delete file @?') ?>".replace("@",C.n),"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("projectsDeleteFile",{serveruuid:t.activeServer.uuid,name:C.n,uuid:t.activeproject.uuid,format:2}).then(function(P){P.ok?S(P.project):d.error("",P.error,1e4,!0)})})},t.downloadFile=function(C,E){E&&E.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/download/"+t.activeproject.uuid+"/"+encodeURIComponent(C.n))},t.editGCode=async C=>{let E=await i.send("projectGetGCodeInfo",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:C.n});m.open({templateUrl:"/views/projects/editGCode.dialog.php",windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope","$uibModalInstance",function(P,A){P.file=C,P.mode=0,P.info=E.info,P.loadFile=()=>{P.mode=1,LG.get("/project/"+t.activeServer.uuid+"/download/"+t.activeproject.uuid+"/"+encodeURIComponent(C.n)).then(R=>{R.status===200&&(P.code=R.data,P.mode=2)})},P.removeGCodePatch=()=>{P.info.gcodePatch="{}",i.send("projectSetGCodeInfo",{id:C.n,serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,info:P.info})},P.cancel=function(){A.dismiss()},P.save=function(){P.mode=3;let R=new FormData;R.append("name",C.n),R.append("filename",new Blob([P.code],{type:"text/plain"}),C.n),P.percent=0,LG.post("/project/"+t.activeServer.uuid+"/replace/"+t.editproject.uuid,R,{onUploadProgress:k=>{P.percent=Math.round(k.loaded/k.total*100)},headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0}).then(()=>{A.close()})}}]}).result.catch(function(P){})},t.viewFile=function(C,E){E&&E.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/view/"+t.activeproject.uuid+"/"+encodeURIComponent(C.n),"_blank")},t.viewFileLink=function(C){let E="/project/"+t.activeServer.uuid+"/view/"+t.activeproject.uuid+"/"+encodeURIComponent(C.n);return C.n.endsWith(".mp4")&&(E+="/show.html"),E},t.selectServer=function(C){if(t.activeServer=t.loadedServer=C,e.serverid!==C.uuid){p.go("browse_projects",{serverid:C.uuid,folderid:0});return}t.selectProject(e.projectid)},t.updateServer=function(){i.send("projectsListServer",{}).then(function(C){if(C.ok){t.serverList=C.server;let E=t.serverList[0];if(angular.forEach(t.serverList,function(P){e.serverid===P.uuid&&(E=P)}),e.serverid!==E.uuid){p.go("browse_projects",{serverid:E.uuid,folderid:0});return}t.selectServer(E)}})},t.$on("remoteServersChanged",function(){t.updateServer()}),t.fullsizeImageDialog=function(C,E){m.open({templateUrl:"/views/projects/previewimage.dialog.php",windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope","$uibModalInstance",function(P){P.title=C,P.image=E}]}).result.catch(function(P){})},t.updateServer(),t.handleUpload=function(){let C=$("#FilenameUpload"),E=C.val().replace(/\\/g,"/").replace(/.*\//,""),P=C.get(0).files[0].size;i.send("projectsCanUploadWithSize",{size:P}).then(function(A){if(A.ok){t.uploading=!0;let R=()=>{t.uploading=!1,C.val(""),t.refreshProject()},k=T=>{t.uploadProgress=T},I="/project/"+t.activeServer.uuid+"/upload/"+t.editproject.uuid,L=[];for(let T of C.get(0).files)L.push({name:T.name.replace(/\\/g,"/").replace(/.*\//,""),filename:T});i.uploadFiles({url:I,a:"upload",files:L},k).then(R),E!==""&&C.val("")}else d.error("",A.error?A.error:"<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},window.handleUpload=t.handleUpload,t.$on("$destroy",()=>{delete window.handleUpload}),t.downloadAll=function(){window.open("/project/"+t.activeServer.uuid+"/downloadProject/"+t.activeproject.uuid,"ihelper"),d.info("<?php _('Building archive ...') ?>","<?php _('Download will start automatically when the project is packed.') ?>",3e4,!0)},t.exportProject=function(){window.open("/project/"+t.activeServer.uuid+"/export/"+t.activeproject.uuid,"ihelper"),d.info("<?php _('Building archive ...') ?>","<?php _('Download will start automatically when the project is packed.') ?>",3e4,!0)},t.downloadImage=function(C,E){E.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/downloadImage/"+t.activeproject.uuid+"/"+encodeURIComponent(C.n),"ihelper")},t.deleteImage=function(C,E){E.stopPropagation(),t.tryDeleteFile(C,E)},t.makePreview=function(C,E){E.stopPropagation(),(C.f&1)===1&&i.send("projectMarkPreview",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,image:C.n,format:2}).then(function(P){P.ok&&d.success("<?php _('New preview image set.') ?>")})},t.selectLicense=function(){i.send("getLicenseTemplates",{}).then(function(C){m.open({templateUrl:"/views/projects/selectlicense.dialog.php",controller:["$scope","$uibModalInstance",function(E,P){E.licenses=C.licenses;function A(k,I){return k.nameic>I.nameic?1:k.nameic<I.nameic?-1:0}angular.forEach(E.licenses,function(k){k.nameic=k.name.toLowerCase()}),E.licenses.sort(A);let R=null;E.licenses.forEach(function(k){R===null&&k.name==="No License"&&(R=k),k.name===t.activeproject.licenseFile&&(R=k)}),E.data={name:t.activeproject.name,author:t.activeproject.author?t.activeproject.author:f.isRealUser?f.getLogin():"",license:R},E.setLicense=function(){let k=E.data.license.text.replace(/\$model/gi,E.data.name).replace(/\$author/gi,E.data.author);i.send("projectSetLicense",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,license:k,licenseFile:E.data.license.name,author:E.data.author,format:2}).then(function(I){S(I.project),P.close()})}}]}).result.catch(function(E){})})}}]);var tke=bT();RSPrinterModule.controller("BrowseProjectController",["$scope","$stateParams","RSCom","$rootScope","$interval","$filter","$http","Confirm","RSOverview","StringDialog","RSPrinters","User","Flash","$uibModal","$state","$anchorScroll","WaitSelectorAppear","SelectProjectFolder",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p,v,g,_){r.globals||(r.globals={}),t.$on("userSettingsChanged",function(){r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))}),r.globals.projectView||(r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}')));let x=function(){i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:parseInt(e.folderid)}).then(function(w){w.ok?(t.folderTree=w.folder.parents,t.folderTree.push(w.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=w.folder,y(t.activeFolder)):p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})};t.projectMenuOpen={},t.serverList=[],t.activeServer={},t.folderTree=[],t.foldersIdx=1,t.activeFolder={},t.uploadProgress=0,t.uploading=!1;let b=null;t.go=function(w){v(w)},t.selectFolderLevel=function(w){p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:t.folderTree[w].idx})};let y=function(w){t.sort(),angular.forEach(w.projects,function(M){M.preview?M.previewUrl="/project/"+t.activeServer.uuid+"/mthumb/"+M.uuid+"/"+encodeURIComponent(M.preview)+"?v="+M.version:M.previewUrl="/img/emptyproject.png"})};t.selectFolder=function(w){p.go("browse_projects",{serverid:t.activeServer.uuid,folderid:w.idx})},t.selectProject=function(w){p.go("project",{projectid:w.uuid,serverid:t.activeServer.uuid})},t.search=function(){p.go("search_projects",{tag:"",search:"",serverid:t.activeServer.uuid})},t.downloadAll=function(w){t.projectMenuOpen[w.uuid]=!1,window.open("/project/"+t.activeServer.uuid+"/downloadProject/"+w.uuid,"ihelper"),d.info("<?php _('Building archive ...') ?>","<?php _('Download will start automatically when the project is packed.') ?>",3e4,!0)},t.exportProject=function(w){t.projectMenuOpen[w.uuid]=!1,window.open("/project/"+t.activeServer.uuid+"/export/"+w.uuid,"ihelper"),d.info("<?php _('Building archive ...') ?>","<?php _('Download will start automatically when the project is packed.') ?>",3e4,!0)},t.moveProject=function(w){t.projectMenuOpen[w.uuid]=!1,_(t.activeServer.uuid,"<?php _('Move Project to') ?>").then(function(M){i.send("projectCopy",{projectuuid:w.uuid,target_folder:M.idx,target_server:M.serveruuid,serveruuid:t.activeServer.uuid,move:!0}).then(function(C){C.ok?d.info("<?php _('Move Project') ?>","<?php _('Movement started. It runs as a background process and can take a while!') ?>",3e4,!0):d.error("",C.error,1e4,!0)},function(){})},function(){})},t.copyProject=function(w){t.projectMenuOpen[w.uuid]=!1,_(t.activeServer.uuid,"<?php _('Copy Project to') ?>").then(function(M){i.send("projectCopy",{projectuuid:w.uuid,target_folder:M.idx,target_server:M.serveruuid,serveruuid:t.activeServer.uuid,move:!1}).then(function(C){C.ok?d.info("<?php _('Copy Project') ?>","<?php _('Copy project started. It runs as a background process and can take a while!') ?>",3e4,!0):d.error("",C.error,1e4,!0)},function(){})},function(){})},t.addProject=function(){u("<?php _('Add Project') ?>","<?php _('Project Name') ?>","","<?php _('Create') ?>").then(function(w){i.send("projectsCreateProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,projectname:w,format:2}).then(function(M){M.ok?x():d.error("",M.error,1e4,!0)},function(){})})},t.addFolder=function(){u("<?php _('Add Folder') ?>","<?php _('Folder Name') ?>","","<?php _('Create') ?>").then(function(w){i.send("projectsCreateFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,foldername:w}).then(function(M){M.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=M.folder,angular.forEach(M.folder.folders,function(C){C.name===w&&t.selectFolder(C)})):d.error("",M.error,1e4,!0)},function(){})})},t.sort=function(){function w(M,C){return M.nameic>C.nameic?1:M.nameic<C.nameic?-1:0}angular.forEach(t.activeFolder.folders,function(M){M.nameic=M.name.toLowerCase()}),angular.forEach(t.activeFolder.projects,function(M){M.nameic=M.name.toLowerCase()}),t.activeFolder.folders.sort(w),t.activeFolder.projects.sort(w)},t.tryDeleteFolder=function(w,M){w.empty?i.send("projectsDeleteFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,folderidx:w.idx}).then(function(C){C.ok?t.folderTree[t.foldersIdx]=t.activeFolder=C.folder:d.error("",C.error,1e4,!0)}):l("<?php _('Security Question') ?>","<?php _('Folder contains other folders or projects that will also be deleted. Really delete them all?') ?>".replace("@",w.name),"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("projectsDeleteFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,folderidx:w.idx}).then(function(C){C.ok?t.folderTree[t.foldersIdx]=t.activeFolder=C.folder:d.error("",C.error,1e4,!0)})}),M.stopPropagation()},t.tryDeleteProject=function(w,M){l("<?php _('Security Question') ?>","<?php _('Really delete project @?') ?>".replace("@",w.name),"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("projectsDeleteProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:w.uuid}).then(function(C){C.ok?(t.folderTree[t.foldersIdx]=C.folder,t.activeFolder=C.folder):d.error("",C.error,1e4,!0)})}),M.stopPropagation()},t.newFolderName=function(w,M,C){i.send("projectsRenameFolder",{serveruuid:t.activeServer.uuid,idx:C.idx,newName:M}).then(function(E){E.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=E.folder,y(t.activeFolder)):d.error("",E.error,1e4,!0)})},t.newProjectName=function(w,M,C){i.send("projectsRenameProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:C.uuid,newName:M}).then(function(E){E.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=E.folder,y(t.activeFolder)):d.error("",E.error,1e4,!0)})},t.selectServer=function(w){if(!w)return;if(r.globals.projectView.lastServer=w.uuid,f.setSetting("projectView",JSON.stringify(r.globals.projectView)),t.activeServer.uuid===w.uuid){t.activeServer=t.loadedServer=w;return}t.activeServer=t.loadedServer=w;let M=0;if(e.serverid===w.uuid)e.folderid&&(M=parseInt(e.folderid));else{p.go("browse_projects",{serverid:w.uuid,folderid:1});return}i.send("projectsGetFolder",{serveruuid:w.uuid,idx:M}).then(function(C){C.ok?(t.folderTree=C.folder.parents,t.folderTree.push(C.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=C.folder,y(t.activeFolder)):p.go("browse_projects",{serverid:w.uuid,folderid:0})})},t.$on("projectFolderChanged",function(w,M){M.data.idx===t.activeFolder.idx&&M.data.server_uuid===t.activeServer.uuid&&x()}),b=n(function(){r.serverSettings.serveruuid!==t.activeServer.uuid&&i.send("projectGetFolderVersion",{serveruuid:t.activeServer.uuid,folder:parseInt(e.folderid)}).then(function(w){w.ok&&w.version!==t.activeFolder.version&&i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:parseInt(e.folderid)}).then(function(M){M.ok?(t.folderTree=M.folder.parents,t.folderTree.push(M.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=M.folder,y(t.activeFolder)):p.go("browse_projects",{serverid:s.uuid,folderid:0})})})},1e4),t.$on("$destroy",function(){b&&(n.cancel(b),b=null),delete window.handleUpload,delete window.handleUploadZip,delete window.handleUpload2,delete window.handleUploadZip2});let S=!1;t.updateServer=function(){S||(S=!0,i.send("projectsListServer",{}).then(function(w){if(w.ok){t.serverList=w.server;let M=t.serverList[0],C=r.globals.projectView.lastServer;if(e.serverid&&(C=e.serverid),angular.forEach(t.serverList,function(E){C===E.uuid&&(M=E)}),e.serverid!==M.uuid){p.go("browse_projects",{serverid:M.uuid,folderid:1});return}t.selectServer(M)}S=!1},function(){S=!1}))},t.$on("remoteServersChanged",function(){t.updateServer()}),t.updateServer(),t.uploadProject=function(w,M){let C=w.val().replace(/\\/g,"/").replace(/.*\//,""),E=0,P=[];for(let A of w.get(0).files)P.push({name:A.name.replace(/\\/g,"/").replace(/.*\//,""),filename:A}),E=A.size;i.send("projectsCanUploadWithSize",{size:5*E}).then(function(A){if(A.ok){M==="uploadZIP"?t.uploadingZip=!0:t.uploading=!0,g.show("<i class='fa fa-spinner fa-spin'></i> <?php _('Importing ...') ?>"),t.uploadProgress=0;let R=()=>{M==="uploadZIP"?t.uploadingZip=!1:t.uploading=!1,w.val(""),i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx}).then(function(L){L.ok?(t.folderTree=L.folder.parents,t.folderTree.push(L.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=L.folder,y(t.activeFolder)):d.error("",L.error,1e4,!0)}),g.hide()},k=L=>{t.uploadProgress=L,g.setProgress(L)},I="/project/"+t.activeServer.uuid+"/import/"+t.activeFolder.idx;i.uploadFiles({url:I,a:M,files:P},k).then(R).catch(function(L){console.log(L)}),C!==""&&w.val("")}else d.error("","<?php _('Disk is full. Please delete other files first.') ?>",1e4,!0)})},t.handleUpload=function(){let w=$("#FilenameUpload");t.uploadProject(w,"uploadProject")},t.handleUpload2=function(){let w=$("#FilenameUpload2");t.uploadProject(w,"uploadProject")},t.handleUploadZip=function(){let w=$("#FilenameUploadZip");t.uploadProject(w,"uploadZIP")},t.handleUploadZip2=function(){let w=$("#FilenameUploadZip2");t.uploadProject(w,"uploadZIP")},window.handleUpload=t.handleUpload,window.handleUploadZip=t.handleUploadZip,window.handleUpload2=t.handleUpload2,window.handleUploadZip2=t.handleUploadZip2}]);RSPrinterModule.controller("SearchProjectController",["$scope","$stateParams","RSCom","$rootScope","Confirm","RSOverview","StringDialog","User","Flash","$uibModal","$state","$anchorScroll",function(t,e,i,r,n,o,a,l,h,u,c,f){t.serverList=[],t.activeServer={},t.projects=[],t.activeProjects=[],t.page=1,t.perPage=24,t.maxSize=7,t.go=function(p){f(p)};let d=function(){angular.forEach(t.projects,function(p){p.preview?p.previewUrl="/project/"+t.activeServer.uuid+"/mthumb/"+p.uuid+"/"+p.preview:p.previewUrl="/img/emptyproject.png"})};t.selectProject=function(p){c.go("project",{projectid:p.uuid,serverid:t.activeServer.uuid})},t.browse=function(){c.go("browse_projects",{folderid:1,serverid:t.activeServer.uuid})},t.tryDeleteProject=function(p,v){n("<?php _('Security Question') ?>","<?php _('Really delete project @?') ?>".replace("@",p.name),"<?php _('Yes') ?>","<?php _('No') ?>",!0).then(function(){i.send("projectsDeleteProject",{serveruuid:t.activeServer.uuid,idx:p.folder,uuid:p.uuid}).then(function(g){if(g.ok){let _=t.page;t.updateSearch(),t.pageChanged(_)}})}),v.stopPropagation()},t.pageChanged=function(p){p*t.perPage>t.projects.length&&(p=parseInt((t.projects.length-1)/t.perPage)+1),t.page=p,t.activeProjects=t.projects.slice((t.page-1)*t.perPage,t.page*t.perPage)},t.newProjectName=function(p,v,g){i.send("projectsRenameProject",{serveruuid:t.activeServer.uuid,idx:g.folder,uuid:g.uuid,newName:v}).then(function(_){if(_.ok){let x=t.page;t.updateSearch(),t.pageChanged(x)}})},t.updateParams=function(){c.transitionTo("search_projects",{serveruuid:t.activeServer.uuid,tag:t.tag,search:t.search},{location:"replace",inherit:!0,relative:c.$current,notify:!1})},t.updateSearch=function(){if(t.tag===""&&t.search===""){t.projects=[],t.pageChanged(1);return}i.send("projectSearch",{serveruuid:t.activeServer.uuid,tag:t.tag,search:t.search}).then(function(p){if(p.ok){let g=function(_,x){return _.nameic>x.nameic?1:_.nameic<x.nameic?-1:0};var v=g;angular.forEach(p.projects,function(_){_.nameic=_.name.toLowerCase()}),p.projects.sort(g),t.projects=p.projects,t.pageChanged(1),d(t.activeFolder),t.updateParams()}})},t.selectTag=function(p){t.tag=p,t.updateSearch()},t.selectServer=function(p){t.activeServer.uuid!==p.uuid&&(t.activeServer=t.loadedServer=p,e.serverid===p.uuid?t.updateSearch():c.go("search_projects",{serverid:p.uuid,tag:t.tag,search:t.search}))},t.tags=[];let m=function(){i.send("projectListTags",{serveruuid:e.serverid}).then(function(p){if(p.ok){let g=function(_,x){return _.c>x.c?-1:_.c<x.c?1:0};var v=g;p.tags.sort(g),t.tags=p.tags}})};t.updateServer=function(){i.send("projectsListServer",{}).then(function(p){if(p.ok){t.serverList=p.server;let v=t.serverList[0];if(angular.forEach(t.serverList,function(g){e.serverid===g.uuid&&(v=g)}),e.serverid!==v.uuid){c.go("search_projects",{serverid:v.uuid,tag:t.tag,search:t.search});return}t.selectServer(v)}})},t.tag=e.tag,t.search=e.search,m(),t.updateServer()}]);RSPrinterModule.component("rsModelView",{template:`<div style="width:100%;height:100%;position:relative" class="model3d"><div ng-if="$root.supportsFullscreen" class="gl-btn right" ng-class="{glactive:plate.WorkMode==0}" title2="{{$ctrl.tToggleFS}}" style="top:10px;right:52px;" ng-click="$ctrl.toggleFullscreen()"><i class="rs gl-2" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i></div><div class="gl-btn" ng-class="{glactive:plate.WorkMode==1}" title2="{{$ctrl.tAutomaticRotation}}" style="top:10px;left:10px;width:34px;" ng-click="$ctrl.toggleAnimation()"><i class="rs gl-2" style="width:34px" ng-class="{'rs-3d-play':!$ctrl.playing,'rs-3d-pause':$ctrl.playing}"></i></div><div class="gl-btn" style="top:10px;left:52px;width: 33px;" title2="{{$ctrl.tCenterView}}" ng-click="$ctrl.centerView()"><i class="rs rs-3d-centerview gl-2"></i></div><div ng-if="!$root.isFullscreen" class="gl-btn" id="cpicon" style="top:10px;left:94px;width:32px" title2="{{$ctrl.tChangeColor}}" ng-click="$ctrl.showColorpicker()"><input type="text" id="previewcp" ng-model="$ctrl.modelColor" style="display:none" colorpicker required ng-change="$ctrl.colorChanged()"><i class="rs rs-3d-colorpicker gl-2" ></i></div><div class="threeDView" style="position: absolute;left:0;right:0;top:0;bottom:0"><canvas></canvas><div class="axis"><canvas></canvas></div></div></div>`,bindings:{url:"<"},controller:["$rootScope","Fullscreen","$element",function(t,e,i){let r,n,o,a,l,h,u,c,f=this;this.geometryHelper={},this.tToggleFS="<?php _('Toggle Full Screen') ?>",this.tChangeColor="<?php _('Change Color') ?>",this.tCenterView="<?php _('Center View') ?>",this.tAutomaticRotation="<?php _('Automatic Rotation') ?>",this.modelColor="#c07100",this.$onInit=function(){},this.$onDestroy=function(){this.geometryHelper={},r!==void 0&&r.disconnect(),a=null,l=null,u=null,c=null,r=null,i.innerHTML=""},this.$onChanges=function(m){m.url&&this.updateModel()},this.toggleFullscreen=function(){e.toggleFullscreen($(".model3d")[0])},this.showColorpicker=function(){setTimeout(function(){jQuery("#previewcp").spectrum("show")},10)},this.colorChanged=function(){f.geometryHelper.modelMat.color=new Ye(parseInt(this.modelColor.replace("#","0x"))),r.setChanged()};let d=0;this.helpersLoaded=function(){return d===0},this.playing=!1,this.toggleAnimation=function(){r.toggleAnimate(4),this.playing=!this.playing},this.updateBed=m=>{r.zMin=0,r.addSquareBed(m)},this.updateModel=()=>{new ih().load(this.url,function(p){if(!p){console.error("error loading model!");return}for(r===void 0&&(o=$(".threeDView"),r=new qh(o,!1,t,!1,!1),n=r.scene,l=new Pr,n.add(l),r.addAxis(),h=r.tracker.add(new ir({color:12611840,shininess:70,vertexColors:!1,specular:2631720,flatShading:!0,side:qt,transparent:!1})),f.geometryHelper.modelMat=h),u=new Ei;l.children.length;){let _=l.children[0];l.remove(_),r.tracker.remove(_),r.tracker.remove(_.geometry)}p.forEach(_=>{let x=r.tracker.add(_.geometry),b=new _t(x,h);b.castShadow=!1,b.receiveShadow=!1,l.add(b),u.expandByObject(l,!1)});let v=new j;u.getCenter(v),l.translateX(-v.x),l.translateY(-v.y),l.translateZ(-u.min.z),u=new Ei().setFromObject(l),r.setObjectsBBox(u),r.setPrinterBox(u);let g=new j;u.getSize(g),r.setSize(g.x,g.y,g.z),f.updateBed(Math.max(g.x,g.y)),r.addLights(),r.setObjectsBBox(u),r.orientIsometric()})},this.centerView=function(){r&&(r.setObjectsBBox(u),r.orientIsometric())}}]});RSPrinterModule.component("rsLeftRightScroller",{template:'<div class="lrScroller"><div class="box"><div class="scroller scroller-left" ng-click="$ctrl.scrollLeft()"><i class="fa fa-chevron-left fa-3x"></i></div><div class="scroller scroller-right" ng-click="$ctrl.scrollRight()"><i class="fa fa-chevron-right fa-3x"></i></div><div class="wrapper"><div class="list"><ng-transclude></ng-transclude></div></div></div></div>',bindings:{},transclude:!0,controller:["$rootScope","$element","$timeout",function(t,e,i){let r=null,n=!1,o=function(){return $(".list",e).outerWidth()},a=function(){return $(".list",e).position().left},l=function(){let c=a(),f=$(".wrapper",e).outerWidth()-138;-c+f<o()?$(".scroller-right",e).fadeIn(300):$(".scroller-right",e).fadeOut(300),c<0?$(".scroller-left").fadeIn(300):($(".item",e).animate({left:"-="+c+"px"},"slow"),$(".scroller-left",e).fadeOut(300))};this.$onInit=function(){$(window).resize(l)},this.$onDestroy=function(){$(window).off("resize",l),r&&i.cancel(r)};let h=0;function u(){let c=o();c!==h&&(h=c,l()),r=i(u,1e3)}this.$postLink=function(){i(u,500)},this.scrollLeft=function(){if(n)return;n=!0;let c=$(".wrapper",e).outerWidth()-138,f=a();f+c>0&&(c=-f),$(".list",e).animate({left:"+="+c+"px"},400,function(){n=!1,l()})},this.scrollRight=function(){if(n)return;let c=$(".wrapper",e).outerWidth()-138,f=a(),d=o();n=!0,-f+c>d&&(c=-(d+f)),$(".list",e).animate({left:"+="+-c+"px"},400,function(){n=!1,l()})}}]});RSPrinterModule.factory("SelectProjectFolder",["$uibModal","RSCom",function(t,e){return function(i,r){let n=t.open({templateUrl:"/views/projects/selectProjectFolder.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.headline=r,o.serverList=[],o.activeServer={},o.folderTree=[],o.foldersIdx=1,o.activeFolder={},o.cancel=function(){a.dismiss()},o.selectFolder=function(){a.close({idx:o.activeFolder.idx,serveruuid:o.activeServer.uuid})},o.sort=function(){function l(h,u){return h.nameic>u.nameic?1:h.nameic<u.nameic?-1:0}angular.forEach(o.activeFolder.folders,function(h){h.nameic=h.name.toLowerCase()}),angular.forEach(o.activeFolder.projects,function(h){h.nameic=h.name.toLowerCase()}),o.activeFolder.folders.sort(l)},o.selectServer=function(l){o.activeServer.uuid!==l.uuid&&(o.activeServer=o.loadedServer=l,e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:1}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())}))},o.goFolder=function(l){e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:l.idx}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())})},o.$on("projectFolderChanged",function(l,h){h.data.idx===o.activeFolder.idx&&h.data.server_uuid===o.activeServer.uuid&&e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:o.activeFolder.idx}).then(function(u){u.ok&&(o.folderTree=u.folder.parents,o.folderTree.push(u.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=u.folder,o.sort())})}),o.updateServer=function(){e.send("projectsListServer",{}).then(function(l){if(l.ok){o.serverList=l.server;let h=o.serverList[0];angular.forEach(o.serverList,function(u){i===u.uuid&&(h=u)}),o.selectServer(h)}})},o.updateServer()}],size:"lg"});return n.result.catch(function(o){}),n.result}}]);RSPrinterModule.factory("SelectProject",["$uibModal","RSCom",function(t,e){return function(i,r){let n=t.open({templateUrl:"/views/projects/selectProject.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.headline=r,o.serverList=[],o.activeServer={},o.folderTree=[],o.foldersIdx=1,o.activeFolder={},o.activeProject=void 0,o.setActive=function(l){o.activeProject=l},o.cancel=function(){a.dismiss()},o.selectProject=function(){a.close({uuid:o.activeProject.uuid,serveruuid:o.activeServer.uuid})},o.sort=function(){function l(h,u){return h.nameic>u.nameic?1:h.nameic<u.nameic?-1:0}angular.forEach(o.activeFolder.folders,function(h){h.nameic=h.name.toLowerCase()}),angular.forEach(o.activeFolder.projects,function(h){h.nameic=h.name.toLowerCase()}),o.activeFolder.folders.sort(l),o.activeFolder.projects.sort(l)},o.selectServer=function(l){o.activeServer.uuid!==l.uuid&&(o.activeServer=o.loadedServer=l,e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:1}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())}))},o.goFolder=function(l){e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:l.idx}).then(function(h){h.ok&&(o.activeProject=void 0,o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())})},o.$on("projectFolderChanged",function(l,h){h.data.idx===o.activeFolder.idx&&h.data.server_uuid===o.activeServer.uuid&&e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:o.activeFolder.idx}).then(function(u){u.ok&&(o.folderTree=u.folder.parents,o.folderTree.push(u.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=u.folder,o.sort())})}),o.updateServer=function(){e.send("projectsListServer",{}).then(function(l){if(l.ok){o.serverList=l.server;let h=o.serverList[0];angular.forEach(o.serverList,function(u){i===u.uuid&&(h=u)}),o.selectServer(h)}})},o.updateServer()}],size:"lg"});return n.result.catch(function(o){}),n.result}}]);RSPrinterModule.factory("SelectPrinter",["$uibModal",function(t){return function(e){let i=t.open({templateUrl:"/views/projects/selectPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter",function(r,n,o,a){r.headline=e,r.selections={},r.checkAllIdle=!1,r.checkAll=!1;for(let l in o.printer)o.printer.hasOwnProperty(l)&&a.fetchPrintqueueFor(l);r.cancel=function(){n.dismiss()},r.selectPrinter=function(l,h){n.close({list:[l],autostart:h})},r.unselectCheckAll=()=>{r.checkAll=!1,r.checkAllIdle=!1},r.selectAllPrinters=l=>{angular.forEach(o.printerList,function(h,u){h&&h.active&&h.online&&(l?(r.selections[h.slug]=h.job=="none",r.checkAll=!1):(r.selections[h.slug]=!0,r.checkAllIdle=!1))})},r.selectPrinters=function(l){let h=[];angular.forEach(r.selections,function(u,c){u&&h.push(o.printer[c].status)}),n.close({list:h,autostart:l})}}],size:"lg"});return i.result.catch(function(r){}),i.result}}]);RSPrinterModule.factory("SelectPrinterGroup",["$uibModal","RSCom",function(t,e){return function(i){let r=t.open({templateUrl:"/views/projects/selectPrinterGroup.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope",function(n,o,a){n.headline=i,n.cancel=function(){o.dismiss()},n.selectPrinter=function(h,u){o.close({slug:h,group:u})},n.groupsBySlug={};let l=function(){angular.forEach(a.printerList,function(h){n.groupsBySlug[h.slug]=[{id:"#",name:"<?php _('Group: Default') ?>"}],e.send("listModelGroups",{},h.slug).then(function(u){angular.forEach(u.groupNames,function(c){c!=="#"&&n.groupsBySlug[h.slug].push({id:c,name:"<?php _('Group:') ?> "+c})})})})};l(),n.$on("modelGroupListChanged",function(){l()})}],size:"lg"});return r.result.catch(function(n){}),r.result}}]);RSPrinterModule.controller("ProjectGCodePreviewController",["$scope","$stateParams","$rootScope","$http","User","RSCom","$uibModal","$timeout","Fullscreen","Confirm","Flash","$state",function(t,e,i,r,n,o,a,l,h,u,c,f){let d=new Pa({user:n}),m=!1;t.featureNameMap=ws,t.dummy=7,t.analyser=d,t.menuList={opt3d:!1},t.closeMenu=function(T){t.menuList[T]=!1},t.prevent=function(T,O){T&&(T.stopPropagation(),T.preventDefault()),O&&(t.menuList[O]=!t.menuList[O])},d.assignProject(e.serverid,e.projectid,e.model);let p=d.loadInfo(),v=null,g=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231"],_=null;t.gcodeChanged=!1,t.activeLayer=-1,t.editLayer=1,t.zoom2d=100;let x={},b=null,y=-1,S=0;t.percentSlider={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(T){return T.toFixed(0)}}},t.layerSlider={value:1,options:{floor:1,ceil:1,step:1,precision:0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(T){return T.toFixed(0)}}},t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:e.tab.length===0?0:parseInt(e.tab),extrusionWidth:.4,showExtruder:!1,show:0},t.previewOptions=Mt(Mt({},t.previewOptions),JSON.parse(n.getSetting("preview2dOptions",JSON.stringify(t.previewOptions)))),e.tab.length&&(t.previewOptions.showGcode=parseInt(e.tab)),t.$parent.previewData=e.model,t.exlist=[],t.model=!1,t.show3dLegend=document.body.clientWidth>500,t.show2dLegend=!0,t.featureHeadline="<?php _('Extruder') ?>",t.features=[],t.roundFeatures=[{name:"<?php _('Retract Filament') ?>",color:"#C9302C"},{name:"<?php _('Advance Filament') ?>",color:"#0000ff"}],t.updateLegend=({headline:T,features:O,roundFeatures:D})=>{t.featureHeadline=T,t.features=O,t.roundFeatures=D},t.toggle2DLegend=function(){t.show2dLegend=!t.show2dLegend},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(T,O)=>{T==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,T==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,T==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,T&&O&&O.stopPropagation()},t.saveDefault2dView=()=>{n.setSetting("preview2dOptions",JSON.stringify(t.previewOptions))},t.toggle2DFullscreen=function(){h.toggleFullscreen($("#container-2d")[0])},t.setPreview=function(T){_=T,T&&(_.zoomEnabled=!0,_.adjustPosZoom(),t.fitObject(),_.drawPreviewLayer(b,t.percentSlider.percent),t.refreshSlider())},t.height2d="70vh",t.heightGCode="70vh";let w=T=>{T===void 0&&(T=10),t.previewOptions.showGcode===0&&(window.innerHeight>500?l(()=>{let O=$("#container-2d");if(O.length){let D=O[0].getBoundingClientRect();t.height2d=Math.max(window.innerHeight-D.top-1,300).toFixed(0)+"px",window.scrollY=0}else T>0&&l(()=>{w(T-1)},50)},10):t.height2d="70vh"),t.previewOptions.showGcode===1&&(window.innerHeight>500?l(()=>{let O=$("#layercode");if(O.length){let D=O[0].getBoundingClientRect();t.heightGCode=Math.max(300,window.innerHeight-D.top-12).toFixed(0)+"px",window.scrollY=0}else T>0&&l(()=>{w(T-1)},50)},10):t.heightGCode="70vh")};t.$on("windowResized",()=>{w()}),t.imgurl=function(){return`/project/${e.serverid}/image/${e.projectid}/`+encodeURIComponent(e.model)};let M=0,C=0,E=function(T){if(T===t.activeLayer)return;let O=d.layerInfo.layers[T-1],D=d.layerInfo.layers[T];if(d.layerData)t.editLayer=t.activeLayer=T,t.durationElapsed=O.t,t.durationRemaining=d.layerInfo.layers[d.layerInfo.layers.length-1].t-D.t,t.duration=D.t-O.t,t.startTime=O.t,t.height=D.h,t.lineCount=D.l-O.l,b=d.fetchLayer(T),_&&_.drawPreviewLayer(b,t.percentSlider.percent);else{let F=++M;r.get(`/project/${e.serverid}/layer/${e.projectid}?id=`+encodeURIComponent(e.model)+"&start="+O.p+"&end="+D.p).then(function(B){F<C||(C=F,t.editLayer=t.activeLayer=T,t.durationElapsed=O.t,t.durationRemaining=d.layerInfo.layers[d.layerInfo.layers.length-1].t-D.t,t.duration=D.t-O.t,t.startTime=O.t,t.height=D.h,t.lineCount=D.l-O.l,b=B.data,_&&_.drawPreviewLayer(b,t.percentSlider.percent))},function(){})}t.previewOptions.showGcode&&I(T)};t.update2dView=()=>{_&&_.drawPreviewLayer(b,t.percentSlider.percent)},t.percentSlider.options.onChange=()=>{_&&i.$applyAsync(()=>{_.drawPreviewLayer(b,t.percentSlider.percent)})};function P(){t.layerSlider.options.ceil=d.totalLayer;for(let T=0;T<t.model.extruderUsage.length;T++)t.exlist.push({col:g[T%g.length],name:"<?php _('Print Extruder @') ?>".replace("@",T+1)});E(1)}t.$on("gcodeInfoUpdated",function(T,O){O.data.modelId===e.model&&r.get(`/project/${e.serverid}/layeranalysis/${e.projectid}?id=`+encodeURIComponent(e.model)).then(function(D){setLayerdata(D.data)},function(){})});let A=[],R=0,k=function(){let T=R,O=[];angular.forEach(A,function(D,F){let B=x[""+(F+R)];if(B){let U=B.r.split(`
`);O[F]="",angular.forEach(U,function(G){G=G.trim(),G.length!==0&&((F&1)===1?O[F]+='<div class="odd">'+yi(G,T,"line_add")+"</div>":O[F]+="<div>"+yi(G,T,"line_add")+"</div>")}),B.d?(F&1)===1?O[F]+='<div class="odd" style="text-decoration: line-through;">'+yi(D,T++,"line_del")+"</div>":O[F]+='<div style="text-decoration: line-through;">'+yi(D,T++,"line_del")+"</div>":(F&1)===1?O[F]+='<div class="odd">'+yi(D,T++,"line")+"</div>":O[F]+="<div>"+yi(D,T++,"line")+"</div>"}else(F&1)===1?O[F]='<div class="odd">'+yi(D,T++,"line")+"</div>":O[F]="<div>"+yi(D,T++,"line")+"</div>"}),$("#layercode").html(O.join(""))},I=function(T){if(y===T||T<1||T>d.totalLayer)return;++S;let O=S,D=d.layerInfo.layers[T-1],F=d.layerInfo.layers[T];r.get(`/project/${e.serverid}/gcode/${e.projectid}?id=`+encodeURIComponent(e.model)+"&start="+D.g+"&end="+F.g).then(function(B){O<S||(S=O,y=T,A=B.data.substring(0,B.data.length-1).split(`
`),R=D.l,k())},function(){})};t.download=function(){let T=`/project/${e.serverid}/download/${e.projectid}/${encodeURIComponent(e.model)}`;window.open(T,"ihelper")},t.$watchCollection("previewOptions",function(T,O){T.showGcode!==O.showGcode&&t.toggle2DMenu(""),t.previewOptions.showGcode===1&&I(t.activeLayer),t.refreshSlider(),w()}),t.fitPrinter=function(){_&&_.fitBed()},t.fitObject=function(){_&&_.fitArea(d.layerInfo.xmin,d.layerInfo.ymin,d.layerInfo.xmax,d.layerInfo.ymax,2)},t.nextLayer=function(){t.activeLayer<d.totalLayer&&E(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&E(t.activeLayer-1)},t.layerChanged=function(){t.editLayer=parseInt(t.editLayer),t.editLayer<1&&(t.editLayer=1),t.editLayer>d.totalLayer&&(t.editLayer=d.totalLayer),E(t.editLayer)},t.layerSlider.options.onChange=()=>{t.layerChanged()},t.editLine=function(T){if(!i.user.canAddFiles||(T.originalEvent.target?!T.originalEvent.target.className.startsWith("line"):!T.originalEvent.srcElement.className.startsWith("line")))return;let O=T.originalEvent.target?T.originalEvent.target.innerText:T.originalEvent.srcElement.innerText;a.open({templateUrl:"/views/printer/control/printer.editgcode.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(D){D.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},D.edit=angular.copy(x[O]),D.edit||(D.edit={d:!1,r:""}),D.addOrig=function(){D.edit.r=(D.edit.r.trim()+`
`+D.orig).trim()+`
`,D.edit.d=!0},D.addPause=function(){D.edit.r=(D.edit.r.trim()+`
@pause Do your stuff`).trim()+`
`},D.line=O,D.orig=A[parseInt(O)-R],D.$on("modal.closing",function(){D.edit.r=D.edit.r.trim(),D.edit.d||D.edit.r.length>0?(!x[O]||angular.toJson(x[O])!==angular.toJson(D.edit))&&(x[O]=D.edit,t.gcodeChanged=!0,k()):x[O]&&(delete x[O],t.gcodeChanged=!0,k())})}]}).result.catch(function(D){})},t.refreshSlider=function(){l(function(){t.$broadcast("rzSliderForceRender")})},t.saveGCode=function(){t.model.gcodePatch=angular.toJson(x),o.send("projectSetGCodeInfo",{id:e.model,serveruuid:e.serverid,projectid:e.projectid,info:t.model}).then(function(){t.gcodeChanged=!1})},t.printGCode=function(T,O){if(!O&&!i.activeConfig.general.enableQueue){c.error("<?php _('Queue is disabled') ?>");return}if(i.active.state.condition!==1&&(O=!1),T.fits)t.preparePrint=!0,o.send("copyModel",{id:T.id,autostart:O}).then(function(){t.preparePrint=!1}),O?c.success("<?php _('Print started.') ?>"):c.success("<?php _('Print copied to print queue.') ?>");else{let D=i.activeConfig.shape.basicShape,F=i.activeConfig.movement,B=`<table class="table table-bordered table-hover"><tr><th><?php _('Parameter') ?></th><th><?php _('Print') ?></th><th><?php _('Printer') ?></th></tr>`;D.shape==="circle"?B+=`<tr class="${T.radius>D.radius?"bg-danger":""}"><td><?php _('Radius Printed') ?></td><td>${T.radius}</td><td>${D.radius}</td></tr>`:(B+=`<tr class="${T.xMin<D.xMin||T.xMax>D.xMax?"bg-danger":""}"><td><?php _('Print') ?> X</td><td>${T.xMin.toFixed(2)}..${T.xMax.toFixed(2)}</td><td>${D.xMin.toFixed(2)}..${D.xMax.toFixed(2)}</td></tr>`,B+=`<tr class="${T.yMin<D.yMin||T.yMax>D.yMax?"bg-danger":""}"><td><?php _('Print') ?> Y</td><td>${T.yMin.toFixed(2)}..${T.yMax.toFixed(2)}</td><td>${D.yMin.toFixed(2)}..${D.yMax.toFixed(2)}</td></tr>`),D.shape!=="zbelt"&&(B+=`<tr class="${T.zMin<F.zMin||T.zMax>F.zMax?"bg-danger":""}"><td><?php _('Print') ?> Z</td><td>${T.zMin.toFixed(2)}..${T.zMax.toFixed(2)}</td><td>${F.zMin.toFixed(2)}..${F.zMax.toFixed(2)}</td></tr>`),B+=`<tr class="${T.xMinMove<F.xMin||T.xMaxMove>F.xMax?"bg-danger":""}"><td><?php _('Move') ?> X</td><td>${T.xMinMove.toFixed(2)}..${T.xMaxMove.toFixed(2)}</td><td>${F.xMin.toFixed(2)}..${F.xMax.toFixed(2)}</td></tr>`,B+=`<tr class="${T.yMinMove<F.yMin||T.yMaxMove>F.yMax?"bg-danger":""}"><td><?php _('Move') ?> Y</td><td>${T.yMinMove.toFixed(2)}..${T.yMaxMove.toFixed(2)}</td><td>${F.yMin.toFixed(2)}..${F.yMax.toFixed(2)}</td></tr>`,B+="</table>",u("<?php _('Security question') ?>","<?php _('According to your defined printer limits, this print will not fit inside your printer. Print anyway?') ?>",null,null,null,B).then(function(){t.preparePrint=!0,o.send("copyModel",{id:T.id,autostart:O}).then(function(U){t.preparePrint=!1,U.ok?O?c.success("<?php _('Print started.') ?>"):c.success("<?php _('Print copied to print queue.') ?>"):c.error(U.error)})})}},t.backProject=()=>{f.go("project",{serverid:e.serverid,projectid:e.projectid})},t.$on("$destroy",function(){m=!0,t.$parent.previewData=0});let L=o.send("projectGetGCodeInfo",{id:e.model,serveruuid:e.serverid,projectid:e.projectid}).then(function(T){t.model=T.info,x=angular.fromJson(t.model.gcodePatch)});Promise.all([L,p]).then(()=>{P()}),w()}]);RSBase.component("rsGcode3d",{template:`
<div id="container-3d"
        class="threeDView"
        style="position:relative; margin:0;width:100%;padding:0px;touch-action: none;"
        oncontextmenux="return false;"
        ng-click="toggle3DMenu('')"
   >
     <div id="gcode3dview" ng-style="{height: $root.isFullscreen ? '100vh' : $ctrl.glHeight}">
        <canvas></canvas>
        <div class="axis"><canvas></canvas></div>
     </div>     
     <div class="gc-features" ng-if="$ctrl.gcodeLoaded">
       <h3 ng-click="$ctrl.toggleLegend()">{{$ctrl.preview3d.featureHeadline}}
         <span class="pull-right margin-left">
           <i class="fa" ng-class="{'fa-caret-down':$ctrl.show3dLegend, 'fa-caret-right':!$ctrl.show3dLegend}"></i>
         </span>
       </h3>
       <div ng-if="$ctrl.show3dLegend">
       <div ng-repeat="f in $ctrl.preview3d.features track by $index">
         <div class="ft-color" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>        
        <hr ng-if="$ctrl.preview3d.roundFeatures.length">
       <div ng-repeat="f in $ctrl.preview3d.roundFeatures track by $index">
         <div class="ft-color-round" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>                
       </div>
     </div>
     <div ng-if="$ctrl.showSlider" style="position: absolute;right:-20px;width:60px;top:5px;bottom:40px" class="slidervr rsslider label_z_range slider-autohide">
       <rzslider rz-slider-model="$ctrl.layerRangeSlider.minValue" rz-slider-high="$ctrl.layerRangeSlider.maxValue" rz-slider-options="$ctrl.layerRangeSlider.options"></rzslider>
     </div>
     <div ng-if="$ctrl.showSlider" style="padding-right:0;bottom:0;position:absolute;left:5px;right:40px" class="sliderhb rsslider label_percent slider-autohide">
       <rzslider rz-slider-model="$ctrl.percentSlider3d.percent" rz-slider-options="$ctrl.percentSlider3d.options"></rzslider>
     </div>
     <!-- Menu -->
     <div style="position: absolute;top:10px;right:60px;z-index:100">
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('opt3d', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-bars gl-2" style="position: relative"></i>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('view', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'" color-class="gl-2" style="position: relative"></rs-icon>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('info', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-info-circle gl-2" style="position: relative"></i>
         </div>
       </div>
       <div ng-if="$root.supportsFullscreen" class="gl-btn"  style="position:relative" title3="<?php _('Toggle Full Screen') ?>" ng-click="$ctrl.toggleFullscreen()">
         <i class="rs gl-2" style="position: relative" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i>
       </div>
     </div>
     <!-- settings menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.opt3d" ng-click="$event.stopPropagation()">
         <div class="form-group">
           <label><?php _('Quality') ?></label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.quality" 
                   ng-options="f.value as f.name for f in $ctrl.qualityNameMap"></select>
         </div>
         <div class="form-group">
           <label><?php _('Color Scheme') ?></label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.show" 
                   ng-options="f.value as f.name for f in $ctrl.featureNameMap"></select>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRapidMotion" 
                    ng-change="$ctrl.update3dOptions(false)">
               <?php _('Show Travel') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRetractions" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Show Retractions') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showDeretractions" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Show Deretractions') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showSeams" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Show Seams') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideSkirtOozeShield" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Hide Skirt/Ooze Shield') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideSupport" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Hide Support') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideInfill" 
                    ng-change="$ctrl.update3dOptions(true)">
             <?php _('Hide internal infill') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentTop" 
                    ng-change="$ctrl.update3dOptions(false)">
             <?php _('Show transparent top') ?>
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentBottom" ng-change="$ctrl.update3dOptions(false)">
             <?php _('Show transparent bottom') ?>
           </label>
         </div>
         <div class="margin-bottom">
           <label><?php _('Warn if required memory exceeds') ?></label><br>
           <input type="number" style="width:120px;background: #00000080;color: #ffffff;" ng-model="$ctrl.options3d.memoryWarnSize"> MB
         </div>
         <div>
          <div class="btn btn-primary btn-block" ng-click="$ctrl.saveDefault()"><i class="fa fa-save"></i> <?php _('Default Preview') ?></div> 
        </div>
     </div>
     <div class="gc-menu" ng-if="$ctrl.menu3d.view" xng-click="$event.stopPropagation()">
       <ul>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientIsometric();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-iso.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Isometric View') ?></a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientTop();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-top.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Top View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientFront();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-front.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Front View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientLeft();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-left.svg'" color-class="text-primary"></rs-icon>
             </div>
             <?php _('Left View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientRight();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-right.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Right View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBack();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-back.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Back View') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBottom();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-bottom.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             <?php _('Bottom View') ?>
           </a>
         </li>
         <li class="hr"></li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.fitPrinter();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
               <?php _('Fit Printer') ?>
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.fitObject();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-object.svg'"></rs-icon>
             </div>
               <?php _('Fit Object') ?>
           </a>
         </li>
       </ul>
     </div>
     <!-- info menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.info" ng-click="$event.stopPropagation()">
        <ul class="list-group" style="text-align: left">
          <li class="list-group-item active">
            <h4 style="margin:0"><?php _('G-Code Analysis') ?></h4>
          </li>
          <li class="list-group-item">
            <span><?php _('Number of Layers') ?>:</span>
            <span >{{$ctrl.analyser.totalLayer}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Z Height') ?>:</span>
            <span>{{$ctrl.analyser.totalHeight | number:3}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span><?php _('X Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.xmin | number:2}} - {{$ctrl.analyser.layerInfo.xmax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span><?php _('Y Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.ymin | number:2}} - {{$ctrl.analyser.layerInfo.ymax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape==='circle'">
            <span><?php _('Radius Printed') ?>:</span>
            <span>{{$ctrl.analyser.layerInfo.radius | number:2}} mm</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Printing Time') ?>:</span>
            <span>{{$ctrl.analyser.totalDuration | dhms}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Total Number of Lines') ?>:</span>
            <span>{{$ctrl.analyser.totalLines}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Slicer') ?>:</span>
            <span>{{$ctrl.model.slicer}}</span>
          </li>
          <li class="list-group-item">
            <span><?php _('Volumetric Extrusion') ?>:</span>
            <span>{{$ctrl.model.volumetric | yesno}}</span>
          </li>
        </ul>
     </div>
     <div ng-if="$ctrl.showMemoryWarning" class="bg-warning text-warning" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <p><?php _('To show this 3d preview, more memory than the set threshold is required. If you continue and it does not fit in memory, it will crash your browser window.') ?></p>
     <p>{{$ctrl.sizeMessage}}</p>
     <br>
     <div class="btn btn-warning" style="width:100%" ng-click="$ctrl.continueShow()">Continue</div>
    </div>
     </div>`,controllerAs:"$ctrl",bindings:{analyser:"<",slug:"<",model:"<",mode:"@"},controller:["$element","$interval","$rootScope","RSCom","$document","$sce","Fullscreen","Flash","$scope","$timeout",function(t,e,i,r,n,o,a,l,h,u){let c=!1,f="",d=null,m=null,p=!1;this.glHeight="70vh",this.memoryGuessed=0,this.gcodeLoaded=!1,this.showMemoryWarning=!1,this.sizeMessage="The guessed memory required is 56 MB",this.qualityNameMap=x_,this.featureNameMap=ws,this.show3dLegend=document.body.clientWidth>500,this.showSlider=!1,this.toggleLegend=()=>{this.show3dLegend=!this.show3dLegend},this.range3DChanged=()=>{let _=this.layerRangeSlider.minValue+"#"+this.layerRangeSlider.maxValue+"#"+this.percentSlider3d.percent;_!==f&&(f=_,d.setViewRange(this.layerRangeSlider.minValue,this.layerRangeSlider.maxValue,this.percentSlider3d.percent))},this.layerRangeSlider={minValue:1,maxValue:1,options:{floor:1,ceil:1,step:1,precision:0,minRange:0,maxRange:1,pushRange:!0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(_){return _.toFixed(0)},onChange:()=>{this.range3DChanged()}}},this.percentSlider3d={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(_){return _.toFixed(0)},onChange:()=>{this.range3DChanged()}}},this.options3d={quality:pi?1:2,show:1,transparentTop:!1,transparentBottom:!0,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,memoryWarnSize:Ls?20:200},this.menu3d={opt3d:!1,view:!1,info:!1};let v=window.localStorage.getItem("gcode3dOptions");v&&(this.options3d=Mt(Mt({},this.options3d),JSON.parse(v))),this.saveDefault=()=>{window.localStorage.setItem("gcode3dOptions",JSON.stringify(this.options3d)),l.success("<?php _('Preview settings stored as default for this browser') ?>")},this.toggle3DMenu=(_,x)=>{_==="opt3d"?this.menu3d.opt3d=!this.menu3d.opt3d:this.menu3d.opt3d=!1,_==="view"?this.menu3d.view=!this.menu3d.view:this.menu3d.view=!1,_==="info"?this.menu3d.info=!this.menu3d.info:this.menu3d.info=!1,_&&x&&x.stopPropagation()},this.update3dOptions=_=>{this.gcodeLoaded&&(d.setOptions(this.options3d),_&&d.updateGCodeGeometry(),d.setViewRange(this.layerRangeSlider.minValue,this.layerRangeSlider.maxValue,this.percentSlider3d.percent))},this.toggleFullscreen=function(){a.toggleFullscreen($("#container-3d")[0])};let g=!1;this.loadGCode=async()=>{this.showMemoryWarning=!1,await this.analyser.loadData(),this.gcodeLoaded=!0,this.update3dOptions(!0)},this.showGcode3d=async()=>{if(d||c||g)return;let _=$("#gcode3dview");if(_.length===0||_[0].clientWidth===0||_[0].children.length===0){console.log("wait dom 3d"),setTimeout(this.showGcode3d,25);return}g=!0,this.layerRangeSlider.maxValue=this.analyser.totalLayer,this.layerRangeSlider.options.ceil=this.analyser.totalLayer,this.layerRangeSlider.options.maxRange=this.analyser.totalLayer;let x=1;for(;this.analyser.totalLayer>0&&this.analyser.totalLayer/x>10;)x*=10;this.layerRangeSlider.options.showTicks=x,this.showSlider=this.mode==="preview",d=new mu(_,Mt({slug:this.slug,rootScope:i,analyser:this.analyser,model:this.model},this.options3d)),this.preview3d=d,this.memoryGuessed=this.analyser.guess3dMemory()/1024/1024,this.memoryGuessed===0&&(this.memoryGuessed=this.analyser.totalLines*37/1024/1024,console.log("fallback memory guess",this.memoryGuessed)),d.view.orientIsometric(),d.fitObject(),this.gcodeLoaded=!1,m=new IntersectionObserver(b=>{b[0].isIntersecting&&!p&&(p=!0),this.adjustSize()},{}),m.observe($("#gcode3dview")[0]),this.adjustSize(),i.$broadcast("rzSliderForceRender"),this.memoryGuessed>this.options3d.memoryWarnSize?(this.sizeMessage="<?php _('The guessed memory required is @1 MB. Your set warning limit for this browser is @2 MB.') ?>".replace("@1",this.memoryGuessed.toFixed(0)).replace("@2",this.options3d.memoryWarnSize.toFixed(0)),this.showMemoryWarning=!0):await this.loadGCode()},this.continueShow=()=>{this.loadGCode()},this.adjustSize=()=>{window.innerHeight>500&&this.mode==="preview"?u(()=>{let _=t.get()[0].getBoundingClientRect();this.glHeight=Math.floor(window.innerHeight-_.top).toFixed(0)+"px",window.scrollY=0},10):this.glHeight="70vh"},h.$on("windowResized",()=>{this.adjustSize()}),this.$onDestroy=()=>{c=!0,m&&m.disconnect(),d&&(d.$destroy(),d=null),this.analyser=null},this.$onChanges=_=>{_.analyser&&this.analyser&&this.analyser.layerInfoPromise.then(()=>{this.showGcode3d()})},this.$onInit=()=>{this.adjustSize(),this.analyser&&this.analyser.layerInfoPromise.then(()=>{this.showGcode3d()})}}]});Bt.PackerPos=function(t,e){this.x=t||0,this.y=e||0};Bt.PackerPos.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y};Bt.PackerRect=function(t,e,i,r,n){this.x=t,this.y=e,this.w=i,this.h=r,this.obj=n};Bt.PackerRect.prototype.containsPoint=function(t){return t.x>=this.x&&t.y>=this.y&&t.x<this.x+this.w&&t.y<this.y+this.h};Bt.PackerRect.prototype.containsRect=function(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.w<=this.x+this.w&&t.y+t.h<=this.y+this.h};Bt.PackerRect.prototype.intersects=function(t){return this.w>0&&this.h>0&&t.w>0&&t.h>0&&t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h};Bt.PackerRect.prototype.greater=function(t,e){return t.w>e.w&&t.w>e.h||t.h>e.w&&t.h>e.h};Bt.RectPacker=function(t,e){this.size=new Bt.PackerRect(0,0,t,e,null),this.vRects=[],this.vPositions=[],this.vPositions.push(new Bt.PackerPos(0,0)),this.area=0};Bt.RectPacker.prototype.end=function(){this.vPositions=[],this.vRects=[],this.size.w=0};Bt.RectPacker.prototype.isOK=function(){return this.size.w>0};Bt.RectPacker.prototype.w=function(){return this.size.w};Bt.RectPacker.prototype.h=function(){return this.size.h};Bt.RectPacker.prototype.totalArea=function(){return this.size.w*this.size.h};Bt.RectPacker.prototype.isFree=function(t){if(!this.size.containsRect(t))return!1;let e=!0;return angular.forEach(this.vRects,function(i){i.intersects(t)&&(e=!1)}),e};Bt.RectPacker.prototype.addPosition=function(t){let e=!1,i=0,r;angular.forEach(this.vPositions,function(n){t.x+t.y<n.x+n.y&&(e=!0,r=i),i++}),e?this.vPositions.splice(i,0,t):this.vPositions.push(t)};Bt.RectPacker.prototype.addRect=function(t){this.vRects.push(t),this.area+=t.w*t.h,this.addPosition(new Bt.PackerPos(t.x,t.y+t.h)),this.addPosition(new Bt.PackerPos(t.x+t.w,t.y))};Bt.RectPacker.prototype.addAtEmptySpot=function(t){let e=!1,i;for(i=0;i<this.vPositions.length;i++){let r=this.vPositions[i],n=new Bt.PackerRect(r.x,r.y,t.w,t.h,t.obj);if(this.isFree(n)){t=n,e=!0;break}i++}if(e){this.vPositions.splice(i,1);let r,n;for(r=1;r<=t.x&&this.isFree(new Bt.PackerRect(t.x-r,t.y,t.w,t.h,t.obj));r++);for(n=1;n<=t.y&&this.isFree(new Bt.PackerRect(t.x,t.y-n,t.w,t.h,t.obj));n++);n>r?t.y-=n-1:t.x-=r-1,this.addRect(t)}return e};Bt.RectPacker.prototype.addAtEmptySpotAutoGrow=function(t,e,i){if(t.w<=0)return!0;let r=this.size.w,n=this.size.h;for(;!this.addAtEmptySpot(t);){let o=this.size.w,a=this.size.h;if(o>=e&&a>=i)return this.size.w=r,this.size.h=n,!1;if(o<e&&(o<a||o===a&&t.w>=t.h)?this.size.w=Math.min(e,o+10):this.size.h=Math.min(i,a+10),this.addAtEmptySpot(t)||(o!==this.size.w?(this.size.w=o,a<e&&(this.size.h=Math.min(i,a+10))):(this.size.h=a,o<e&&(this.size.w=Math.min(e,o+10))),(o!==this.size.w||a!==this.size.h)&&this.addAtEmptySpot(t)))break;this.size.w=o,this.size.h=a,o<e&&(this.size.w=Math.min(e,o+10)),a<i&&(this.size.h=Math.min(i,a+10))}return!0};var Z_=class{constructor(e,i){Kn(this,"loadModel",()=>{this.group=new THREE.Group,this.group2=new THREE.Group,this.group3=new THREE.Group,this.plate.view.scene2.add(this.group2),this.plate.view.scene2.add(this.group3),this.plate.view.getScene().add(this.group),this.data.format===".stl"&&new THREE.STLLoader().load("/slicer/getmodel/"+this.plate.slug+"/"+this.plate.plateId+"?id="+this.data.id,i=>{this.geometry=i,this.material=new THREE.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200});let r=new THREE.Mesh(i,this.material);r.castShadow=!0,r.receiveShadow=!1,r.model=this,this.glModel=r,this.glId=r.id,this.selMaterial=new THREE.MeshBasicMaterial({transparent:!0,opacity:.8,color:16776960,side:THREE.BackSide}),this.plate.centerIfNeeded(this),this.updatePosition(),this.group.add(r),this.plate.view.refresh(),this.plate.saveSetup(),this.plate.selectModel(this,!0)})});this.data=e,this.plate=i,this.color=16733491,this.glModel=null,this.selectionModel=null,this.group=null,this.selected=!1,this._arrX=null,this._arrY=null,this._arrZ=null,this._rotX=null,this._rotY=null,this._rotZ=null,this.quaternionZ=new THREE.Quaternion,this.quaternionX=new THREE.Quaternion,this.quaternionY=new THREE.Quaternion,this.hoverActive=!1,this.activeWorkMode=this.plate.WorkModes.NONE,this.group=null,this.group2=null,this.group3=null,this.actionStart=null,this.actionLast=null,this.lastAngle=0,this.startRotX=null,this.startRotY=null,this.startRotZ=null,setTimeout(this.loadModel,0)}destroy(){this.updateWorkMode(plate.WorkModes.NONE),this.group&&(this.plate.view.getScene().remove(this.group),this.plate.view.scene2.remove(this.group2),this.plate.view.scene2.remove(this.group3)),this.plate.primary===this&&(this.plate.primary=null),this.plate=null,this.geometry=null}hover(e){!this.glModel||e===this.hoverActive||(this.hoverActive=e,this.hoverActive?this.glModel.material.color.setHex(16776960):this.glModel.material.color.setHex(this.color),this.glModel.material.needsUpdate=!0)}nearestPointToRay(e,i){let r=this.plate.view.ray.ray,n=r.direction.dot(r.direction),o=r.direction.dot(i),a=i.dot(i),l=r.origin.clone().sub(e),h=l.dot(r.direction),u=l.dot(i),c=n*a-o*o;if(c===0)return;let f=(n*u-o*h)/c;return i.clone().multiplyScalar(f)}moveActionStart(e){this.actionStart=this.group.position.clone();let i=this.nearestPointToRay(this.actionStart,ds[e]);i!==void 0&&(this.actionLast=i)}moveActionMove(e){let i=this.nearestPointToRay(this.actionStart,ds[e]);if(i!==void 0){let r=i.clone().sub(this.actionLast);switch(e){case 0:if(r.x===0)return;this.data.posx+=r.x;break;case 1:if(r.y===0)return;this.data.posy+=r.y;break;case 2:if(r.z===0)return;this.data.posz+=r.z;break}this.actionLast=i,this.plate.setupChanged()}}scaleActionStart(e){let i=this.nearestPointToRay(this.group.position,ds[e]);i!==void 0&&(this.actionStart=i.clone(),this.actionLast=i)}scaleActionMove(e){let i=this.nearestPointToRay(this.group.position,ds[e]);if(i!==void 0){let r=i.clone().sub(this.actionLast),n=1;this.plate.view.ctrlKey&&(n=.01),this.plate.view.shiftKey&&(n=5);let o=100*(r.getComponent(e)/this.actionStart.getComponent(e));if(o===0)return;let a=this.data.scalex,l=this.data.scaley,h=this.data.scalez;if(this.plate.lockScale)a=Math.max(n,Math.round((a+o)/n)*n),l=Math.max(n,Math.round((l+o)/n)*n),h=Math.max(n,Math.round((h+o)/n)*n);else switch(e){case 0:a=Math.max(n,Math.round((a+o)/n)*n);break;case 1:l=Math.max(n,Math.round((l+o)/n)*n);break;case 2:h=Math.max(n,Math.round((h+o)/n)*n);break}if(a===this.data.scalex&&l===this.data.scaley&&h===this.data.scalez)return;this.data.scalex=a,this.data.scaley=l,this.data.scalez=h,this.actionLast=i,this.plate.setupChanged()}}rayPlaneIntersection(e,i){let r=ds[i],n=e.direction.dot(r);if(n!==0){let o=-e.origin.dot(ds[i])/n;return e.direction.clone().multiplyScalar(o).add(e.origin)}}rayPlaneDir(e,i){let r=this.rayPlaneIntersection(e,i);if(r!==void 0)switch(r.sub(this.group.position),i){case 0:return-Math.atan2(r.y,r.z)*180/Math.PI;case 1:return Math.atan2(r.x,r.z)*180/Math.PI;case 2:return-Math.atan2(r.x,r.y)*180/Math.PI}}rotateActionStart(e){this.startRotX=this.data.rotx,this.startRotY=this.data.roty,this.startRotZ=this.data.rotz,this.lastAngle=this.rayPlaneDir(this.plate.view.ray.ray,e)}rotateAxis(e,i){let r=new THREE.Euler(this.data.rotx*Math.PI/180,this.data.roty*Math.PI/180,this.data.rotz*Math.PI/180,"XYZ");this.quaternionX.setFromAxisAngle(e,i),this.quaternionY.setFromEuler(r),this.quaternionZ.multiplyQuaternions(this.quaternionX,this.quaternionY),this.quaternionZ.normalize(),r.setFromQuaternion(this.quaternionZ,"XYZ"),this.data.rotx=r.x*180/Math.PI,this.data.roty=r.y*180/Math.PI,this.data.rotz=r.z*180/Math.PI,this.updatePosition()}rotateActionMove(e){let i=this.rayPlaneDir(this.plate.view.ray.ray,e);if(Number.isNaN(i))return;let r=i-this.lastAngle,n=.1;this.plate.view.shiftKey&&(n=15),r=Math.round(r/n)*n;let o=new THREE.Euler(this.startRotX*Math.PI/180,this.startRotY*Math.PI/180,this.startRotZ*Math.PI/180,"XYZ");this.quaternionX.setFromAxisAngle(ds[e],r*Math.PI/180),this.quaternionY.setFromEuler(o),this.quaternionY.multiplyQuaternions(this.quaternionX,this.quaternionY),this.quaternionY.normalize(),o.setFromQuaternion(this.quaternionY,"XYZ"),this.data.rotx=o.x*180/Math.PI,this.data.roty=o.y*180/Math.PI,this.data.rotz=o.z*180/Math.PI,this.plate.setupChanged()}updateWorkMode(e){this.plate.view.disposed||e!==this.activeWorkMode&&(this._arrX&&(this.group2.remove(this._arrX,this._arrY,this._arrZ),this.group3.remove(this._arrX,this._arrY,this._arrZ),this.plate.removeActionObject(this._arrX),this.plate.removeActionObject(this._arrY),this.plate.removeActionObject(this._arrZ),this._arrX=this._arrY=this._arrZ=null),this._rotX&&(this.group2.remove(this._rotX,this._rotY,this._rotZ),this.plate.removeActionObject(this._rotX),this.plate.removeActionObject(this._rotY),this.plate.removeActionObject(this._rotZ),this._rotX=this._rotY=this._rotZ=null),gi.initialized.then(()=>{if(this.activeWorkMode=e,!this.selected)return;let i=gi.getGeometryHelper(),r=gi.getAxisMaterials();switch(e){case this.plate.WorkModes.MOVE_OBJECT:this._arrX=new THREE.Mesh(i.arrowX,r.x),this._arrY=new THREE.Mesh(i.arrowY,r.y),this._arrZ=new THREE.Mesh(i.arrowZ,r.z),this._arrX.actionSelect=()=>{this.moveActionStart(0)},this._arrX.actionMove=()=>{this.moveActionMove(0)},this._arrY.actionSelect=()=>{this.moveActionStart(1)},this._arrY.actionMove=()=>{this.moveActionMove(1)},this._arrZ.actionSelect=()=>{this.moveActionStart(2)},this._arrZ.actionMove=()=>{this.moveActionMove(2)},this.group2.add(this._arrX),this.group2.add(this._arrY),this.group2.add(this._arrZ),this.plate.addActionObject(this._arrX),this.plate.addActionObject(this._arrY),this.plate.addActionObject(this._arrZ);break;case this.plate.WorkModes.SCALE_OBJECT:this._arrX=new THREE.Mesh(i.scaleX,r.x.clone()),this._arrY=new THREE.Mesh(i.scaleY,r.y.clone()),this._arrZ=new THREE.Mesh(i.scaleZ,r.z.clone()),this._arrX.actionSelect=()=>{this.scaleActionStart(0)},this._arrX.actionMove=()=>{this.scaleActionMove(0)},this._arrY.actionSelect=()=>{this.scaleActionStart(1)},this._arrY.actionMove=()=>{this.scaleActionMove(1)},this._arrZ.actionSelect=()=>{this.scaleActionStart(2)},this._arrZ.actionMove=()=>{this.scaleActionMove(2)},this.group3.add(this._arrX),this.group3.add(this._arrY),this.group3.add(this._arrZ),this.plate.addActionObject(this._arrX),this.plate.addActionObject(this._arrY),this.plate.addActionObject(this._arrZ);break;case this.plate.WorkModes.ROTATE_OBJECT:this._rotX=new THREE.Mesh(i.rotateX,r.x.clone()),this._rotY=new THREE.Mesh(i.rotateY,r.y.clone()),this._rotZ=new THREE.Mesh(i.rotateZ,r.z.clone()),this._rotX.actionSelect=()=>{this.rotateActionStart(0)},this._rotX.actionMove=()=>{this.rotateActionMove(0)},this._rotY.actionSelect=()=>{this.rotateActionStart(1)},this._rotY.actionMove=()=>{this.rotateActionMove(1)},this._rotZ.actionSelect=()=>{this.rotateActionStart(2)},this._rotZ.actionMove=()=>{this.rotateActionMove(2)},this.group2.add(this._rotX),this.group2.add(this._rotY),this.group2.add(this._rotZ),this.plate.addActionObject(this._rotX),this.plate.addActionObject(this._rotY),this.plate.addActionObject(this._rotZ);break}}))}rescaleGroups(){if(!this.group)return;let i=this.group.position.distanceTo(this.plate.view.camera.position)*.002;this.group2.scale.set(i,i,i),this.group3.scale.set(i,i,i),this.group2.updateMatrix(),this.group3.updateMatrix()}landObject(){let e=new THREE.Box3().setFromObject(this.glModel);this.data.posz-=e.min.z,this.plate.setupChanged()}centerObject(){let e=new THREE.Box3().setFromObject(this.glModel),i=new j;e.getCenter(i);let r=new j;this.plate.view.getPrinterBox().getCenter(r),this.data.posx+=r.x-i.x,this.data.posy+=r.y-i.y,this.plate.setupChanged()}resetScale(){this.data.scalex=this.data.scaley=this.data.scalez=100,this.plate.setupChanged()}resetRotation(){this.data.rotx=this.data.roty=this.data.rotz=0,this.plate.setupChanged()}setSelected(e){e!==this.selected&&(this.selected=e,e?this.updateWorkMode(this.plate.WorkMode):this.updateWorkMode(this.plate.WorkModes.NONE))}deepestPoint(){let e=null,i=new THREE.Vector3;{let r=this.glModel.geometry.attributes.position,n=r.count,o=r.array;for(let a=0;a<n;a+=3)i.set(o[a],o[a+1],o[a+2]).applyMatrix4(this.glModel.matrixWorld),e===null?e=i.clone():i.z<e.z&&e.copy(i)}return e}smallestAngleTo(e,i){let r,n,o=1e3,a=new THREE.Vector3,l=new THREE.Vector3;{let h=this.glModel.geometry.attributes.position,u=h.count,c=h.array;for(let f=0;f<u;f+=3)a.set(c[f],c[f+1],c[f+2]).applyMatrix4(this.glModel.matrixWorld).sub(e),r=a.length(),n=a.z/r,n<o&&r>=i&&(o=n,l.copy(a))}return{v:l,alpha:Math.asin(o)}}smallestYZAngleTo(e,i){let r,n,o=1e3,a=new THREE.Vector3,l=new THREE.Vector3;{let h=this.glModel.geometry.attributes.position,u=h.count,c=h.array;for(let f=0;f<u;f+=3)a.set(c[f],c[f+1],c[f+2]).applyMatrix4(this.glModel.matrixWorld).sub(e),r=Math.sqrt(a.z*a.z+a.y*a.y),n=a.z/r,Math.abs(a.z)>.01&&n<o&&r>=i&&(o=n,l.copy(a))}return{v:l,alpha:Math.asin(o)}}layFlat(){this.boundingBox=new THREE.Box3().setFromObject(this.glModel);let e=this.boundingBox.size().length()*.025,i=this.deepestPoint(),r=this.smallestAngleTo(i,e);this.rotateAxis(ds[2],-Math.atan2(r.v.y,r.v.x)),this.rotateAxis(ds[1],r.alpha),i=this.deepestPoint(),r=this.smallestYZAngleTo(i,e),this.rotateAxis(ds[0],r.v.y>0?-r.alpha:r.alpha),this.landObject()}updatePosition(){if(this.glModel===null)return;let e=this.data,i=this.group;i.position.set(e.posx,e.posy,e.posz),i.rotation.set(e.rotx*Math.PI/180,e.roty*Math.PI/180,e.rotz*Math.PI/180),i.scale.set(e.scalex*.01,e.scaley*.01,e.scalez*.01),i.updateMatrix(),i=this.glModel,i.position.set(e.transx,e.transy,e.transz),this.group2.position.set(e.posx,e.posy,e.posz),this.group3.position.set(e.posx,e.posy,e.posz),this.group3.rotation.set(e.rotx*Math.PI/180,e.roty*Math.PI/180,e.rotz*Math.PI/180),this.group2.updateMatrix(),this.group3.updateMatrix(),this.group.updateMatrixWorld(),this.glModel.updateMatrixWorld()}};var K_=class{constructor(e,i,r,n,o,a){Kn(this,"savePlate",()=>{this.saveTimeout=null,this.ignoreRefresh=!0,this.RSCom.send("plateSet",{setup:this.plate,id:this.plateId}),this.dataDirty=!1});Kn(this,"refreshPlate",()=>{if(this.ignoreRefresh){this.ignoreRefresh=!1;return}this.RSCom.send("plateGet",{id:this.plateId}).then(e=>{this.plate=e.setup,this.name=e.name;let i=this.$scope.activeConfig.extruders.length;for(this.plate.filaments||(this.plate.filaments=[]);this.plate.filaments.length<i;)this.plate.filaments.push({});this.plate.printSetup||(this.plate.printSetup=""),this.updateLoadedModels(),this.$scope.$emit("intPlateChanged",this.plate)})});Kn(this,"updateCallback",()=>{angular.forEach(this.models,r=>{r.rescaleGroups()});let e,i;if(this.dragObject===null&&(e=this.view.ray.intersectObjects(this.actionObjects),e.length>0?(i=e[0].object,this.hoverObject!==i&&(this.hoverObject&&this.hoverObject.material.color.setHex(this.hoverOldColor),this.hoverOldColor=i.material.color.getHex(),this.hoverObject=i,i.material.color.setHex(this.hoverColor))):(this.hoverObject&&this.hoverObject.material.color.setHex(this.hoverOldColor),this.hoverObject=null)),this.view.orbit.enabled=this.dragObject===null,this.hoverObject===null){let r=[];angular.forEach(this.models,n=>{n.glModel&&r.push(n.glModel)}),e=this.view.ray.intersectObjects(r),i=null,e.length>0&&(i=e[0].object.model),angular.forEach(this.models,n=>{n.hover(n===i)})}this.dragObject&&(this.dragObject.actionMove(),this.view.orbit.resetState())});Kn(this,"clickCallback",e=>{this.hoverObject?this.hoverObject.actionSelect&&(this.view.orbit.resetState(),this.dragObject=this.hoverObject,this.dragObject.actionSelect(e)):this.dragObject=null});Kn(this,"unclickCallback",()=>{this.dragObject=null});this.slug=e,this.$scope=a,this.plateId=i,this.RSCom=r,this.view=n,this.User=o,this.models=[],this.plate={},this.lockScale=!0,this.name="unknown",this.primary=void 0,this.hoverColor=16776960,this.wireframe=!1,this.loadedModels={},this.dataDirty=!0,this.config={},this.ignoreRefresh=!1,this.centerWhenLoaded=[],this.actionObjects=[],this.saveTimeout=null,this.WorkModes={NONE:-1,MOVE_OBJECT:0,ROTATE_OBJECT:1,SCALE_OBJECT:2},this.WorkMode=this.WorkModes.MOVE_OBJECT,this.hoverOldColor=null,this.hoverObject=null,this.dragObject=null,this.refreshPlate(),this.view.renderCallback=this.updateCallback,this.view.clickCallback=this.clickCallback,this.view.unclickCallback=this.unclickCallback,gi.initialized.then(()=>{let l=gi.getGeometryHelper(),h=gi.getAxisMaterials();this.view.sceneAxis.add(new THREE.Mesh(l.arrowX,h.x)),this.view.sceneAxis.add(new THREE.Mesh(l.arrowY,h.y)),this.view.sceneAxis.add(new THREE.Mesh(l.arrowZ,h.z))})}setWorkMode(e){this.WorkMode=e,angular.forEach(this.models,i=>{i.updateWorkMode(e)})}resetScale(){angular.forEach(this.models,e=>{e.selected&&e.resetScale()})}resetRotation(){angular.forEach(this.models,e=>{e.selected&&e.resetRotation()})}requiresCentering(e){this.centerWhenLoaded.push(e)}selectObjectRotateMode(){this.setWorkMode(this.WorkModes.ROTATE_OBJECT)}selectObjectScaleMode(){this.setWorkMode(this.WorkModes.SCALE_OBJECT)}selectObjectMoveMode(){this.setWorkMode(this.WorkModes.MOVE_OBJECT)}selectModel(e,i){this.primary=e,i&&angular.forEach(this.models,r=>{r.setSelected(r===e)}),setTimeout(()=>{this.$scope.$apply()},0)}fitObject(e){let i=new THREE.Box3().setFromObject(e.glModel);this.view.fitBoundingBox(i)}saveSetup(){this.dataDirty&&(this.saveTimeout!==null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(this.savePlate,300))}startSlicing(e){let i={targetModels:e,gcodeName:this.plate.sliceName,inputFiles:[]};angular.forEach(this.models,r=>{let n=r.glModel.matrixWorld.elements;i.inputFiles.push({file:r.data.file,trans:[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]],extruder:r.data.extruder})}),this.RSCom.send("plateSlice",{id:this.plateId,config:this.config})}setupChanged(){angular.forEach(this.models,e=>{e.updatePosition()}),this.view.refresh(),this.dataDirty=!0,this.saveSetup(),setTimeout(()=>{this.$scope.$apply()},0)}duplicate(){angular.forEach(this.models,e=>{e.selected&&this.RSCom.send("plateDuplicateModel",{id:this.plateId,modelId:e.data.id}).then(i=>{i.ok&&this.centerWhenLoaded.push(i.id)})})}centerIfNeeded(e){let i=-1;angular.forEach(this.centerWhenLoaded,(r,n)=>{r===e.data.id&&(i=n)}),i!==-1&&(this.autoposition(),this.centerWhenLoaded.splice(i,1))}autoposition(){if(this.models.length===0)return;let e=this.view.getPrinterBox(),i=new THREE.Vector3;if(e.getCenter(i),this.models.length===1){let f=this.models[0],d=new THREE.Box3().setFromObject(f.glModel),m=new THREE.Vector3;d.getCenter(m);let p=f.data;p.transx=-m.x,p.transy=-m.y,p.transz=-m.z,p.posx+=i.x,p.posy+=i.y,p.posz+=m.z-d.min.z,f.glModel.position.set(p.posx,p.posy,p.posz),f.glModel.updateMatrix(),this.setupChanged();return}let r=new Bt.RectPacker(1,1),n=3,o=e.max.x-e.min.x,a=e.max.y-e.min.y,l=e.min.x,h=e.min.y;if(this.autosizeFailed=!1,angular.forEach(this.models,f=>{f.boundingBox=new THREE.Box3().setFromObject(f.glModel);let d=2*n+Math.ceil(f.boundingBox.max.x-f.boundingBox.min.x),m=2*n+Math.ceil(f.boundingBox.max.y-f.boundingBox.min.y);r.addAtEmptySpotAutoGrow(new Bt.PackerRect(0,0,d,m,f),o,a)||(this.autosizeFailed=!0)}),this.autosizeFailed)return;let u=(o-r.w())/2,c=(a-r.h())/2;angular.forEach(r.vRects,f=>{let d=f.obj,m=l+u+f.x+n,p=h+c+f.y+n;d.data.posx+=m-d.boundingBox.min.x,d.data.posy+=p-d.boundingBox.min.y}),this.setupChanged()}updateLoadedModels(){angular.forEach(this.loadedModels,e=>{e.deleted=!0}),angular.forEach(this.plate.models,e=>{console.log("updateLoadedModels",e),this.loadedModels[e.id]||(console.log("updateLoadedLoadinf",e),this.loadedModels[e.id]=new Z_(e,this));let i=this.loadedModels[e.id];i.deleted=!1,angular.extend(i.data,e),i.updatePosition()}),this.models=[],this.plate.models=[],angular.forEach(this.loadedModels,e=>{e.deleted?(e.destroy(),delete this.loadedModels[e.data.id]):(this.plate.sliceName||(this.plate.sliceName=e.data.name),this.models.push(e),this.plate.models.push(e.data))})}landObjects(){angular.forEach(this.models,e=>{e.selected&&e.landObject()})}centerObjects(){angular.forEach(this.models,e=>{e.selected&&e.centerObject()})}layFlat(){angular.forEach(this.models,e=>{e.selected&&e.layFlat()})}removeActionObject(e){let i=-1;angular.forEach(this.actionObjects,(r,n)=>{r===e&&(i=n)}),i!==-1&&this.actionObjects.splice(i,1)}addActionObject(e){this.removeActionObject(e),this.actionObjects.push(e)}};function Jde(){return{lists:{infillPattern:[{id:0,text:"Automatic"},{id:1,text:"Lines"},{id:2,text:"Grid"}]},groups:[{id:0,name:"Printer",key:"printer",vis:"p"},{id:1,name:"Extruder",key:"extruder",vis:"e"},{id:2,name:"Filament",key:"filament",vis:"f"},{id:3,name:"Layer and Perimeter",key:"layer",vis:"po"},{id:4,name:"Speed",key:"speed",vis:"po"},{id:5,name:"Support",key:"support",vis:"po"},{id:6,name:"Skirt and Brim",key:"skirt",vis:"po"},{id:7,name:"Multiple Extruders",key:"multiple",vis:"po"},{id:8,name:"Infill",key:"infill",vis:"po"},{id:9,name:"G-Codes",key:"gcodes",vis:"po"}],params:[{name:"nozzleWidth",type:"float",group:"extruder",text:"Nozzle Width",unit:"mm",min:.05,max:100,step:.05,default:.4,vis:"e"},{name:"offsetX",type:"float",group:"extruder",text:"Offset X",unit:"mm",min:-1e5,max:1e5,step:1,default:0,vis:"e"},{name:"offsetY",type:"float",group:"extruder",text:"Offset Y",unit:"mm",min:-1e5,max:1e5,step:1,default:0,vis:"e"},{name:"retractLength",type:"float",group:"extruder",text:"Retraction Length",unit:"mm",min:0,max:100,step:.5,default:4,vis:"e"},{name:"retractSpeed",type:"float",group:"extruder",text:"Retraction Length",unit:"mm",min:1,max:1e3,step:1,default:40,vis:"e"},{name:"retractZLift",type:"float",group:"extruder",text:"Z Lift on Retraction",unit:"mm",min:1,max:1e3,step:1,default:40,vis:"e"},{name:"filamentDiameter",type:"int",group:"filament",text:"Filament Diameter",unit:"mm",min:0,max:1e3,step:1,default:1.75,vis:"f"},{name:"extrusionMultiplier",type:"int",group:"filament",text:"Extrusion Multiplier",unit:"%",min:1,max:1e3,step:1,default:100,vis:"f"},{name:"filamentTemperature",type:"int",group:"filament",text:"Filament Temperature",unit:"\xB0C",min:0,max:1e3,step:1,default:190,vis:"f"},{name:"bedTemperature",type:"int",group:"filament",text:"Heated Bed Temperature",unit:"\xB0C",min:0,max:1e3,step:1,default:0,vis:"f"},{name:"filamentMinSpeed",type:"float",group:"filament",text:"Minimum Print Speed",unit:"mm/s",min:0,step:1,default:10,vis:"f"},{name:"filamentMaxSpeed",type:"float",group:"filament",text:"Maximum Print Speed",unit:"mm/s, 0 = off",min:0,step:1,default:0,vis:"f"},{name:"filamentMaxVolume",type:"int",group:"filament",text:"Maximum Print Volume",unit:"mm^3/s, 0 = off",min:0,step:1,default:0,vis:"f"},{name:"fanAlwaysOn",type:"bool",group:"filament",text:"Keep Fan Always On",default:!1,vis:"f"},{name:"automaticFan",type:"bool",group:"filament",text:"Automatic Fan Cooling",default:!1,vis:"f"},{name:"minFanSpeed",type:"int",group:"filament",text:"Minimum Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"maxFanSpeed",type:"int",group:"filament",text:"Maximum Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"bridgesFanSpeed",type:"int",group:"filament",text:"Bridges Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"disbaleFanFirstLayer",type:"int",group:"filament",text:"Disable Fan on First x Layer",unit:"%",min:0,max:100,step:1,default:2,vis:"f"},{name:"retractOnLayerChange",type:"bool",group:"printer",text:"Retract on Layer Change",vis:"e",default:!0},{name:"firmwareRetraction",type:"bool",group:"printer",text:"Firmware Retraction",vis:"p",default:!1},{name:"volumetricExtrusion",type:"bool",group:"printer",text:"Volumetric Extrusion",vis:"p",default:!1},{name:"layerHeight",type:"float",group:"layer",text:"Layer Height",unit:"mm",min:.001,max:100,step:.01,default:.2,vis:"po"},{name:"firstLayerHeight",type:"float",group:"layer",text:"First Layer Height",unit:"mm",min:.001,max:100,step:.01,default:.2,vis:"po"},{name:"numPerimeter",type:"int",group:"layer",text:"Number of Perimeters",unit:"",min:1,max:1e3,default:3,vis:"po"},{name:"numBottomSolidLayer",type:"int",group:"layer",text:"Number of Solid Bottom Layer",unit:"",min:0,max:1e3,default:3,vis:"po"},{name:"numTopSolidLayer",type:"int",group:"layer",text:"Number of Solid Top Layer",unit:"",min:0,max:1e3,default:3,vis:"po"},{name:"avoidCrossingPerimeter",type:"bool",group:"layer",text:"Avoid Crossing Perimeter",default:!0,vis:"po"},{name:"externalPerimeterFirst",type:"bool",group:"layer",text:"External Perimeter First",default:!1,vis:"po"},{name:"startGCode",type:"gcode",group:"gcodes",text:"Start G-Code",vis:"p",default:""},{name:"infillDensity",type:"float",group:"infill",text:"Infill Density",unit:"%",min:0,max:100,step:1,default:30,vis:"po"},{name:"infillPattern",type:"list",group:"infill",text:"Infill Pattern",list:"infillPattern",vis:"po",default:0},{name:"infillWidth",type:"float",group:"infill",text:"Infill Width",unit:"mm, 0 = auto",min:0,max:100,step:.01,default:0,vis:"po"},{name:"solidInfillWidth",type:"float",group:"infill",text:"Solid Infill Width",unit:"mm, 0 = auto",min:0,max:100,step:.01,default:0,vis:"po"},{name:"infillAngle",type:"float",group:"infill",text:"Infill Angle",unit:"%",min:0,max:360,step:1,default:45,vis:"po"},{name:"infillPerimeterOverlap",type:"float",group:"infill",text:"Infill Perimeter Overlap",unit:"%",min:0,max:100,step:1,default:15,vis:"po"},{name:"speedDefault",type:"float",group:"speed",text:"Default Speed for Unset Speeds",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedFirstLayer",type:"float",group:"speed",text:"First Layer Speed",unit:"mm/s, 0 = default",min:1,step:1,default:25,vis:"po"},{name:"speedPerimeter",type:"float",group:"speed",text:"Speed for Perimeter",unit:"mm/s, 0 = default",min:1,step:1,default:40,vis:"po"},{name:"speedOuterPerimeter",type:"float",group:"extruder",text:"Speed Outer Perimeter",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedInfill",type:"float",group:"speed",text:"Speed for Infill",unit:"mm/s, 0 = default",min:1,step:1,default:60,vis:"po"},{name:"speedSolidInfill",type:"float",group:"speed",text:"Speeds for Solid Infills",unit:"mm/s, 0 = default",min:1,step:1,default:40,vis:"po"},{name:"speedOuterSolidInfill",type:"float",group:"speed",text:"Speeds for Outer Solid Infills",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedGapInfill",type:"float",group:"speed",text:"Speeds for Gap Infills",unit:"mm/s, 0 = default",min:1,step:1,default:20,vis:"po"},{name:"speedSupport",type:"float",group:"speed",text:"Speed for Support",unit:"mm/s, 0 = default",min:1,step:1,default:45,vis:"po"},{name:"speedBridges",type:"float",group:"speed",text:"Speed for Bridges",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedTravel",type:"float",group:"speed",text:"Speed for Travel Moves",unit:"mm/s, 0 = default",min:1,step:1,default:150,vis:"po"},{name:"addSkirt",type:"bool",group:"skirt",text:"Add Skirt",default:!0,vis:"po"},{name:"skirtDistance",type:"float",group:"skirt",text:"Distance between Skirt and Print",unit:"mm",min:0,max:1e4,step:1,default:6,vis:"po"},{name:"minSkirtExtrusion",type:"float",group:"skirt",text:"Minimum Extrusion for Skirt",unit:"mm",min:0,max:1e4,step:1,default:10,vis:"po"},{name:"addBrim",type:"bool",group:"skirt",text:"Add Brim",default:!1,vis:"po"},{name:"brimWidth",type:"float",group:"skirt",text:"Brim Width",unit:"mm",min:0,max:1e4,step:1,default:10,vis:"po"},{name:"endGCode",type:"gcode",group:"gcodes",text:"End G-Code",vis:"p",default:""},{name:"beforeLayerGCode",type:"gcode",group:"gcodes",text:"Before Layer Change G-Code",vis:"p",default:""},{name:"afterLayerGCode",type:"gcode",group:"gcodes",text:"After Layer Change G-Code",vis:"p",default:""}]}}RSBase.factory("SlicerOptions",[function(){let t={all:Jde(),print:[],extruder:[],filament:[],group:[],paramByName:{},printGroups:[],overrideGroups:[]};return angular.forEach(t.all.params,function(e){e.vis.indexOf("p")>-1&&t.print.push(e),e.vis.indexOf("e")>-1&&t.extruder.push(e),e.vis.indexOf("f")>-1&&t.filament.push(e),e.vis.indexOf("g")>-1&&t.group.push(e),t.paramByName[e.name]=e}),angular.forEach(t.all.groups,function(e){e.vis.indexOf("p")>=0&&t.printGroups.push(e),e.vis.indexOf("o")>=0&&t.overrideGroups.push(e)}),t.newBasicConfig=function(e,i,r){let n={name:e,id:i,extruder:[]};for(angular.forEach(t.print,function(o){n[o.name]=o.default});n.extruder.length<r;)n.extruder.push({});return angular.forEach(t.extruder,function(o){for(let a=0;a<r;a++)n.extruder[a][o.name]=o.default}),n},t.repairBasicConfig=function(e,i){for(;e.extruder.length<i;)e.extruder.push({});return e.extruder.splice(i,e.extruder.length-i),angular.forEach(t.print,function(r){typeof e[r.name]=="undefined"&&(e[r.name]=r.default)}),angular.forEach(t.extruder,function(r){for(let n=0;n<i;n++)typeof e.extruder[n][r.name]=="undefined"&&(e.extruder[n][r.name]=r.default)}),e},t.newFilamentConfig=function(e,i){let r={name:e,id:i};return angular.forEach(t.filament,function(n){r[n.name]=n.default}),r},t.repairFilamentConfig=function(e,i){return angular.forEach(t.filament,function(r){typeof e[r.name]=="undefined"&&(e[r.name]=r.default)}),e},t.newId=function(e,i){let r=0;return angular.forEach(e,function(n){let o=parseInt(n.id.substr(1));o>r&&(r=o)}),i+(r+1)},t.indexForId=function(e,i){for(let r=0;r<e.length;r++)if(e[r].id===i)return r;return 0},t.entryForId=function(e,i){for(let r=0;r<e.length;r++)if(e[r].id===i)return e[r];return e[0]},t}]);RSBase.directive("rsSlicerOption",["$compile","SlicerOptions",function(t,e){let i=function(r){if(r.type==="bool")return'<div class="checkbox"><label><input type="checkbox" ng-model="value[v]" ng-change="changed()">'+r.text+"</label></div>";if(r.type==="float")return r.unit&&r.unit.length>0?'<div class="form-group"><label>'+r.text+'</label><div class="input-group"><input type="number" class="nospin form-control" step="any" ng-model="value[v]" ng-change="changed()"><span class="input-group-addon">'+r.unit+"</span></div></div>":'<div class="form-group"><label>'+r.text+'</label><input type="number" class="nospin form-control" step="any" ng-model="value[v]" ng-change="changed()"></div>';if(r.type==="int")return r.unit&&r.unit.length>0?'<div class="form-group"><label>'+r.text+'</label><div class="input-group"><input type="number" class="form-control" step="1" ng-model="value[v]" ng-change="changed()"><span class="input-group-addon">'+r.unit+"</span></div></div>":'<div class="form-group"><label>'+r.text+'</label><input type="number" class="form-control" step="1" ng-model="value[v]" ng-change="changed()"></div>';if(r.type==="gcode")return"<div><label>"+r.text+'</label><rs-gcode-editor ng-model="value[v]" ng-change="changed()" style="width:100%; overflow-y: auto; "></rs-gcode-editor><!--<ui-codemirror ui-codemirror-opts="editorOptions" ng-model="value[v]" ng-change="changed()" style="width:100%;height:100px"></ui-codemirror>--></div>';if(r.type==="list")return'<div class="form-group"><label>'+r.text+'</label><select class="form-control" ng-model="value[v]" ng-options="o.id as o.text for o in so.all.lists.'+r.list+'"></select></div>'};return{restrict:"E",replace:!0,scope:{value:"=",changed:"&"},link:function(r,n,o){r.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},r.so=e;let a=e.paramByName[o.name?o.name:value.id];r.v=o.name?o.name:"val",n.html(i(a)).show(),t(n.contents())(r)}}}]);RSPrinterModule.controller("PlatesController",["$scope","RSCom","$state","Confirm","P","Flash","User",function(t,e,i,r,n,o,a){t.plates=[],t.plateName="",t.addPrivatePlate=function(){e.send("plateCreate",{name:t.plateName,user:a.getLogin()}).then(function(h){t.editPlate(h.plateId)})},t.addPublicPlate=function(){e.send("plateCreate",{name:t.plateName,user:""}).then(function(h){console.log("Plate id created",h.plateId)})},t.editPlate=function(h){i.go("slicer",{slug:t.activeSlug,plateid:h})},t.deletePlate=function(h){r("<?php _('Security Question') ?>","<?php _('Really delete plate $1?') ?>".replace("$1",h.name),null,null,!0).then(function(){e.send("plateDelete",{id:h.id}).then(function(){o.success("<?php _('Plate deleted') ?>")})})};let l=function(){e.send("platesList",{}).then(function(h){t.plates=h.plates})};t.$on("platesChanged",l),l()}]);RSPrinterModule.controller("EditPlateController",["$scope","RSCom","$state","Confirm","Flash","User","RSOverview","$timeout","P","resA","$rootScope","$uibModal","$http","StringDialog","SlicerOptions",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,p){let v=function(G){if(A===G||G<1||G>t.totalLayer)return;++R;let Y=R,re=t.layerData.layers[G-1],N=t.layerData.layers[G];d.get("/slicer/gcode/"+c.activeSlug+"/"+t.plate.plateId+"?start="+re.g+"&end="+N.g).then(function(z){let ie=z.data;if(Y<R)return;R=Y,A=G;let Z=ie.substr(0,ie.length-1).split(`
`),ne=re.l;angular.forEach(Z,function(K,ae){(ae&1)===1?Z[ae]='<div class="odd">'+k(K,ne++)+"</div>":Z[ae]="<div>"+k(K,ne++)+"</div>"}),$("#layercode").html(Z.join(""))})},_,x,b=function(G){if(G===t.activeLayer)return;let Y=++I,re=t.layerData.layers[G-1],N=t.layerData.layers[G];d.get("/slicer/layer/"+t.activeSlug+"/"+t.plate.plateId+"?start="+re.p+"&end="+N.p).then(function(z){let ie=z.data;Y<L||(L=Y,t.activeLayer=G,t.duration=N.t-re.t,t.startTime=re.t,t.height=N.h,t.lineCount=N.l-re.l,x=ie,S.setPos(G),null.controls.batchDraw(),null.drawPreviewLayer(x,_))}),t.previewOptions.showGcode&&v(G)},y,S=null.createSlider(1,function(G){b(Math.round(G))});a.selectPrinter(i.params.slug);let w=i.params.plateid,M=!1,C;t.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0};let E=function(){let G=$(".threeDView");if(G.length===0){l(E,30);return}if(y){C=new qh(G,i.params.slug,c,"#openglgroup");let re=new THREE.Scene;C.setScene(re),C.addPrinter(),C.addLights(),y=!1,t.plate=new K_(t.activeSlug,w,e,C,o,t),t.$on("plateChanged",t.plate.refreshPlate),t.$on("connected",t.plate.refreshPlate)}let Y=$(window).height();G.height(Y-100),$(".slicerLeft").height(Y-50),$(".slicerRight").height(Y-70),C.refresh()};t.uploadFile=function(){f.open({templateUrl:"/views/printer/slicer/uploadModel.php?lang="+lang,scope:t,controller:["$scope","$uibModalInstance","Flash",function(G,Y,re){G.uploading=!1;let N=function(){let ie=$(this),Z=ie.val().replace(/\\/g,"/").replace(/.*\//,"");$("#modelUploadName").val(Z),G.uploading=!0,e.extendPing(300),$("#formuploadmodel").ajaxSubmit({success:function(ne){console.log("upload data",ne),ne.ok&&t.plate.requiresCentering(ne.id),re.success("<?php _('Upload finished') ?>"),G.uploading=!1,e.extendPing(0),ie.val(""),Y.close()},headers:{"X-Csrf-Token":e.getCookie("Csrf-Token")}}),Z!==""&&ie.val(""),t.$apply()},z=function(){let ie=$("#modelFilenameUpload");ie.length>0?ie.on("change",N):setTimeout(z,100)};z(),t.close=function(){Y.dismiss()}}]}).result.catch(function(G){})},t.uploadUrl=function(){},t.deleteModel=function(G){r("<?php _('Security question') ?>","<?php _('Do you really want to delete $1?') ?>".replace("$1",G.name)).then(function(){e.send("plateDeleteModel",{id:w,modelId:G.id})})},t.$on("windowResized",E),l(E,100),t.$on("$destroy",function(){console.log("destroy scope"),C!==void 0&&C.disconnect()}),t.activeLayer=-1,null.connectPrinter(c.activeConfig),null.zoomEnabled=!0,null.disableCursor();let P=["#000080","#FC00FF","59BDBE","D0A766"];t.exlist=[],t.model={},angular.forEach(c.activeConfig.extruders,function(G,Y){t.exlist.push({col:P[Y%P.length],name:"<?php _('Print Extruder @') ?>".replace("@",Y+1)})}),x=null;let A=-1,R=0;_=100,t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:0,extrusionWidth:.4},null.preparePreview(t.previewOptions);let k=function(G,Y){let re='<span class="line">'+Y+"</span>",N="",z="",ie="",Z="",ne=0,K=function(){return ne===3||ne===4?'<span class="v">'+Z+"</span>":ne===2?'<span class="p">'+ie+"</span>":ne===0?'<span class="cmd">'+N+"</span>":""};if(G.length>1&&(G[0]==="@"||G[1]==="@"))return re+'<span class="server">'+G+"</span>";for(let ae=0;ae<G.length;ae++){let ue=G[ae];if(ne===1){z+=ue;continue}if(ue===";"&&(re+=K(),ne=1,z=";"),ne===4){Z+=ue;continue}if(ne===0){N+=ue,ue===" "&&(ne=2,re+='<span class="cmd">'+N+"</span>",(ue==="M117 "||ue==="M23 "||ue==="M28 "||ue==="M29 "||ue==="M30 "||ue==="M32 ")&&(ne=4,ie=""));continue}if(ne===2&&(ie+=ue,ue>="A"&&ue<="Z"||ue>="a"&&ue<="z")){re+=K(),ne=3,Z="";continue}ne===3&&(Z+=ue,ue===" "&&(re+=K(),ne=2,ie=""))}return z.length>0&&(z='<span class="comment">'+z+"</span>"),re+K()+z};t.$watchCollection("previewOptions",function(){t.previewOptions.showGcode===1&&v(t.activeLayer),x&&null.drawPreviewLayer(x,_)}),t.fitPrinter=function(){null.fitPrinter()},t.fitObject=function(){null.fitArea(t.layerData.xmin,t.layerData.ymin,t.layerData.xmax,t.layerData.ymax,2)};let I=0,L=0,T=function(G){_=G,null.drawPreviewLayer(x,_)},O=null.createSlider(3,function(G){T(Math.round(G))});O.setMinMax(0,100,"%:","%"),O.setPos(_),O.callbackDelay=0,t.$on("$destroy",function(){null.$destroy(),t.$parent.previewData=0}),t.nextLayer=function(){t.activeLayer<t.totalLayer&&b(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&b(t.activeLayer-1)},t.showGCode=function(){o.sessionStarted().then(function(){d.get("/slicer/layeranalysis/"+t.activeSlug+"/"+t.plate.plateId).then(function(G){t.layerData=G.data,t.totalLayer=t.layerData.layers.length-1,t.totalDuration=t.layerData.layers[t.totalLayer].t,t.totalHeight=t.layerData.layers[t.totalLayer].h,t.totalLines=t.layerData.layers[t.totalLayer].l,S.setMinMax(1,t.layerData.layers.length-1,"L:","L"),t.fitObject(),t.viewmode=2,b(1)})})},t.viewmode=0,t.$on("intPlateChanged",function(G,Y){console.log("intPlateChanged",Y),Y.slicerRunning?t.viewmode=1:t.viewmode===1&&Y.hasSlice&&t.showGCode()}),t.printGCode=function(){e.send("platePrintGCode",{id:t.plate.plateId}).then(function(){i.go("printer.print",{slug:t.activeSlug})})},t.storeGCode=function(){e.send("plateStoreGCode",{id:t.plate.plateId}).then(function(){i.go("printer.print",{slug:t.activeSlug})})},t.slicerConfig={},t.so=p,t.editSlicer=!1,t.slicerEditorActive=[!0,!1,!1,!1],t.extruderNames=[],t.ss={PID:void 0,FID:void 0,pGroup:0,groupMode:0,editGroupCat:0,editGroupGroup:void 0};let D=c.activeConfig.extruders.length;if(D===0)t.extruderNames.push({id:0,name:"<?php _('Tool') ?> 1"});else for(let G=1;G<=D;G++)t.extruderNames.push({id:G-1,name:"<?php _('Extruder') ?> "+G});y=!0;let F=!1,B=function(G){angular.forEach(t.slicerEditorActive,function(Y,re){t.slicerEditorActive[re]=!1}),t.slicerEditorActive[G]=!0,t.editSlicer=!0};t.updateSlicerPos=function(){t.ss.PID||angular.forEach(t.slicerConfig.printConfigs,function(G){t.ss.PID||(t.ss.PID=G.id)}),t.ss.FID||angular.forEach(t.slicerConfig.filamentConfigs,function(G){t.ss.FID||(t.ss.FID=G.id)}),t.ss.P=p.indexForId(t.slicerConfig.printConfigs,t.ss.PID),t.ss.F=p.indexForId(t.slicerConfig.filamentConfigs,t.ss.FID),t.activePrintConfig=t.slicerConfig.printConfigs[t.ss.P],t.activeFilamentConfig=t.slicerConfig.filamentConfigs[t.ss.F]},t.selectPrintGroup=function(G){t.ss.pGroup=G;let Y=p.printGroups[G];t.ss.pParams=[],angular.forEach(p.print,function(re){re.group===Y.key&&t.ss.pParams.push(re)})},t.selectFilamentGroup=function(G){t.ss.fGroup=G};let U=function(){if(F){F=!1;return}e.send("getSlicerConfig",{}).then(function(G){t.slicerConfig=G,angular.forEach(t.slicerConfig.printConfigs,function(Y){p.repairBasicConfig(Y,t.activeConfig.extruders.length)}),t.slicerConfig.filamentConfigs.length===0&&t.slicerConfig.filamentConfigs.push(p.newFilamentConfig("Default","F1")),angular.forEach(t.slicerConfig.filamentConfigs,function(Y){p.repairFilamentConfig(Y)}),t.slicerConfig.categories.length===0&&t.slicerConfig.categories.push({name:"Misc",id:"C1",ref:0}),t.updateSlicerPos(),console.log("slicer config",t.slicerConfig)})};t.sendChangedSlicerConfig=function(){F=!0,e.send("setSlicerConfig",t.slicerConfig),console.log("slicer config",t.slicerConfig)},t.$on("slicerConfigChanged",function(){U()}),t.selectPrintGroup(0),U(),t.editPrintConfigs=function(){t.activePrintConfig=p.entryForId(t.slicerConfig.printConfigs,t.plate.plate.printSetup),B(0)},t.closeSlicerEditor=function(){t.editSlicer=!1},t.newBasicConfig=function(){m("<?php _('Create Basic Configuration') ?>","<?php _('Configuration Name') ?>","","<?php _('Create') ?>").then(function(G){let Y=p.newId(t.slicerConfig.printConfigs,"P"),re=p.newBasicConfig(G,Y,D);console.log("Config "+G,re),t.slicerConfig.printConfigs.push(re),t.slicerConfig.printConfigs.sortOn("name"),t.ss.PID=re.id,t.updateSlicerPos(),t.sendChangedSlicerConfig()})},t.delBasicConfig=function(){t.slicerConfig.printConfigs.length<2||(t.slicerConfig.printConfigs.splice(t.ss.F,1),t.ss.PID=void 0,t.updateSlicerPos(),t.sendChangedSlicerConfig())},t.newFilamentConfig=function(){m("<?php _('Create Filament Configuration') ?>","<?php _('Configuration Name') ?>","","<?php _('Create') ?>").then(function(G){let Y=p.newId(t.slicerConfig.filamentConfigs,"F"),re=p.newFilamentConfig(G,Y);console.log("Config "+G,re),t.slicerConfig.filamentConfigs.push(re),t.slicerConfig.filamentConfigs.sortOn("name"),t.ss.FID=re.id,t.updateSlicerPos(),t.sendChangedSlicerConfig()})},t.delFilamentConfig=function(){t.slicerConfig.filamentConfigs.length<2||(t.slicerConfig.filamentConfigs.splice(t.ss.F,1),t.ss.FID=void 0,t.updateSlicerPos(),t.sendChangedSlicerConfig())},t.addCategory=function(){m("<?php _('Create New Category') ?>","<?php _('Category Name') ?>","","<?php _('Create') ?>").then(function(G){let Y=p.newId(t.slicerConfig.categories,"C"),re={name:G,id:Y,ref:0};t.slicerConfig.categories.push(re),t.slicerConfig.categories.sortOn("name"),t.sendChangedSlicerConfig()})},t.delCategory=function(G){t.slicerConfig.categories[G].ref===0&&t.slicerConfig.categories.splice(G,1)},t.categoryNameChanged=function(G){G.name.length===0&&(G.name="Unknown"),t.slicerConfig.categories.sortOn("name"),t.sendChangedSlicerConfig()},t.selectEditGroupGroup=function(G){t.ss.editGroupCat=G;let Y=t.slicerConfig.categories[G];t.ss.gParams=[],angular.forEach(t.slicerConfig.groups,function(re){re.cat===Y.id&&t.ss.gParams.push(re)})},t.addGroup=function(){m("<?php _('Create New Group') ?>","<?php _('Group Name') ?>","","<?php _('Create') ?>").then(function(G){let Y=p.newId(t.slicerConfig.groups,"G"),re=t.slicerConfig.groups[t.ss.editGroupCat];re.ref++;let N={name:G,id:Y,cat:re.id,params:[]};t.slicerConfig.groups.push(N),t.slicerConfig.groups.sortOn("name"),t.ss.GID=Y,t.sendChangedSlicerConfig()})}}]);var Q_=Mt({showTerminal:!0},window.uiOptions);function OG(){return"<?php _('PROJECT_OS_ID') ?>"}window.RSGSettingsModule=angular.module("RSGSettings",["ui.router","RSBase"]).config(["$stateProvider","RSRegistryProvider",function(t,e){t.state("gsettings.pushMessages",{url:"/pushMessages",templateUrl:"/views/gsettings/pushMessages.php?lang="+window.lang,controller:"PushMessageController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings",{url:"/gsettings",templateUrl:"/views/gsettings/gsettings.php?lang="+window.lang,controller:["RSGS",function(i){}],resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.price",{url:"/price",templateUrl:"/views/gsettings/price.php?lang="+window.lang,controller:"PriceController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.mqtt",{url:"/mqtt",templateUrl:"/views/gsettings/mqtt.php?lang="+window.lang,controller:"MQTTController"}).state("gsettings.webserver",{url:"/webserver",templateUrl:"/views/gsettings/webserver.php?lang="+window.lang,controller:"WebserverController",resolve:{IPS:["RSCom",function(i){return i.send("networkInterfaces",{})}]}}).state("gsettings.loginTerminal",{url:"/login-terminal",templateUrl:"/views/gsettings/loginTerminal.php?lang="+window.lang,controller:"LoginTerminalController"}).state("gsettings.connectivity",{url:"/connectivity",templateUrl:"/views/gsettings/connectivity.php?lang="+window.lang,controller:"ConnectivityController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.wlan",{url:"/wlan",templateUrl:"/views/gsettings/wlan.php?lang="+window.lang,controller:"WLANController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.timelapse",{url:"/timelapse",templateUrl:"/views/gsettings/timelapse.php?lang="+window.lang,controller:"TimelapseController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.folders",{url:"/folders",templateUrl:"/views/gsettings/folders.php?lang="+window.lang,controller:"FolderController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.previewimages",{url:"/previewimages",templateUrl:"/views/gsettings/previewimages.php?lang="+window.lang,controller:"PreviewImagesController",resolve:{PSetting:["RSCom",function(i){return i.send("getRenderSettings",{})}]}}).state("gsettings.cloud",{url:"/cloud",templateUrl:"/views/gsettings/cloud.php?lang="+window.lang,controller:"CloudController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.gui",{url:"/gui",templateUrl:"/views/gsettings/gui.php?lang="+window.lang,controller:"GUIController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.reports",{url:"/reports",templateUrl:"/views/gsettings/reports.php?lang="+window.lang,controller:"ReportsController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.web_actions",{url:"/web_actions",templateUrl:"/views/gsettings/webActions.php?lang="+window.lang,controller:"WebActionController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.gpio",{url:"/gpio",templateUrl:"/views/gsettings/gpio.php?lang="+window.lang,controller:"GPIOController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.externalLinks",{url:"/externalLinks",templateUrl:"/views/gsettings/externalLinks.php?lang="+window.lang,controller:"ExternalLinksController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.maintainerMode",{url:"/maintainerMode",templateUrl:"/views/gsettings/maintainerMode.php?lang="+window.lang,controller:"MaintainerModeController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}),e.registerGlobalSettingsDialog("<?php _('Connectivity') ?>","gsettings.connectivity","fa fa-signal",0,"config-connectivity"),e.registerGlobalSettingsDialog("<?php _('GUI') ?>","gsettings.gui","fa fa-desktop",0,"config-gui"),e.registerGlobalSettingsDialog("<?php _('Network/Time') ?>","gsettings.wlan","fa fa-wifi",0,"config-network"),e.registerGlobalSettingsDialog("<?php _('Timelapse') ?>","gsettings.timelapse","rs rs-timelapse",0,"config-timelapse"),e.registerGlobalSettingsDialog("<?php _('Push Messages') ?>","gsettings.pushMessages","rs rs-pushmessage",0,"config-push-messages"),e.registerGlobalSettingsDialog("<?php _('Preview Images') ?>","gsettings.previewimages","fa fa-image",1,"config-preview-images"),e.registerGlobalSettingsDialog("<?php _('Printing Costs') ?>","gsettings.price","fa fa-money",0,"config-printing-costs"),e.registerGlobalSettingsDialog("MQTT","gsettings.mqtt","rs rs-mqtt",0,"config-mqtt"),e.registerGlobalSettingsDialog("<?php _('Webserver') ?>","gsettings.webserver","fa fa-shield",0,"config-webserver"),OG()!=="0"&&Q_.showTerminal&&e.registerGlobalSettingsDialog("<?php _('Terminal') ?>","gsettings.loginTerminal","fa fa-terminal",0,"config-terminal"),e.registerGlobalSettingsDialog("<?php _('Folders') ?>","gsettings.folders","fa fa-folder-o",0,"config-folders"),e.registerGlobalSettingsDialog("<?php _('Print Reports') ?>","gsettings.reports","fa fa-file-pdf-o",0,"config-print-reports"),e.registerGlobalSettingsDialog("<?php _('Web Actions') ?>","gsettings.web_actions","fa fa-globe",0,"config-web-actions"),OG()==="2"&&e.registerGlobalSettingsDialog("<?php _('GPIO Pins') ?>","gsettings.gpio","rs rs-gpio",0,"config-gpio"),e.registerGlobalSettingsDialog("<?php _('External Links') ?>","gsettings.externalLinks","fa fa-globe",0,"config-external-links")}]);RSGSettingsModule.controller("PriceController",["$scope","$rootScope","RSGS","GSettings","Flash","$filter",function(t,e,i,r,n,o){t.price=angular.copy(e.serverSettings.pricing),t.save=function(){e.serverSettings.pricing=t.price,r.serverSettingsChanged().then(function(){n.success("<?php _('Pricing saved') ?>","",2e3)},function(){})},t.onDragEnd=function(){},t.addFilament=function(){t.price.filaments.push({u:RSUtils.createAlphaID(10),n:"<?php _('Material') ?>",p:25,w:1.2})},t.delFilament=function(a){a<0||a>=t.price.filaments.length||t.price.filaments.length<2||t.price.filaments.splice(a,1)}}]);RSGSettingsModule.controller("MQTTController",["$scope","$rootScope","RSCom","Flash","$filter",function(t,e,i,r,n){t.mqttVersion=[{id:0,name:"Default 3.1.1 with fallback to 3.1"},{id:3,name:"3.1"},{id:4,name:"3.1.1"},{id:5,name:"5.0"}],t.readMQTT=function(){i.send("getMQTTConfig",{}).then(function(a){console.log("MQTT setting:",a),a.ok&&(t.mqtt=a.mqtt)})},t.readMQTT();function o(){i.send("getMQTTState",{}).then(a=>{t.mqttState=a.mqtt})}o(),t.$on("mqttState",(a,l)=>{console.log("mqttState",l),t.mqttState=l.data}),t.$on("connected",()=>{t.readMQTT(),o()}),t.saveMQTT=function(){i.send("setMQTTConfig",{mqtt:t.mqtt}).then(function(a){a.ok&&(t.mqtt=a.mqtt,r.success("<?php _('MQTT settings saved') ?>","",2e3))})},t.addEventException=function(a){a.length>0&&t.mqtt.eventExceptions.indexOf(a)===-1&&t.mqtt.eventExceptions.push(a)}}]);RSGSettingsModule.controller("LoginTerminalController",["$scope","$rootScope","Flash","RSCom",function(t,e,i,r){t.showTerm=!1,t.channel="";let n=function(){e.user.showFeature("config-terminal")&&(t.showTerm=!0,r.send("loginTerminal",{}).then(o=>{o.terminal_id&&(t.channel=o.terminal_id)}))};Q_.showTerminal&&n()}]);RSGSettingsModule.controller("PreviewImagesController",["$scope","$rootScope","GSettings","Flash","$filter","RSCom","PSetting","$uibModal",function(t,e,i,r,n,o,a,l){t.preview=a,t.preview.overrideOrientation===void 0&&(t.preview.overrideOrientation=!1,t.preview.overrideTheta=72,t.preview.overridePhi=225,t.preview.overrideThetaBelt=132,t.preview.overridePhiBelt=155),t.resetOrientation=function(){t.preview.overrideTheta=72,t.preview.overridePhi=225,t.preview.overrideThetaBelt=132,t.preview.overridePhiBelt=155},t.colors=[{v:"",n:"<?php _('Individual') ?>"},{v:"#ff9800",n:"<?php _('Gold') ?>"},{v:"#ff5B01",n:"<?php _('Copper') ?>"},{v:"#b06026",n:"<?php _('Brown') ?>"},{v:"#ff3131",n:"<?php _('Red') ?>"},{v:"#ff019d",n:"<?php _('Pink') ?>"},{v:"#CC01ff",n:"<?php _('Purple') ?>"},{v:"#292eff",n:"<?php _('Blue') ?>"},{v:"#016dff",n:"<?php _('Light Blue') ?>"},{v:"#ffff00",n:"<?php _('Yellow') ?>"},{v:"#c6ff01",n:"<?php _('Lime') ?>"},{v:"#43e743",n:"<?php _('Green') ?>"},{v:"#5ca082",n:"<?php _('Olive') ?>"},{v:"#ffffff",n:"<?php _('White') ?>"},{v:"#aeaeae",n:"<?php _('Silver') ?>"},{v:"#272727",n:"<?php _('Black') ?>"},{v:"#42ccd6",n:"<?php _('Turquoise') ?>"}],t.aliasOptions=[{id:1,t:"<?php _('No Antialiasing') ?>"},{id:2,t:"<?php _('Low') ?>"},{id:3,t:"<?php _('Good') ?>"},{id:4,t:"<?php _('High') ?>"}],t.shadowOptions=[{v:0,n:"<?php _('Hard (Computation Speed: Fast)') ?>"},{v:1,n:"<?php _('Soft (Computation Speed: Slow)') ?>"},{v:2,n:"<?php _('Individual Advanced Settings (You can adjust any parameters)') ?>"}],t.computationMethods=[{v:!0,n:"<?php _('Rendering - Hard shadows (Computation Speed: Fast)') ?>"},{v:!1,n:"<?php _('Raytracing - Soft shadows (Computation Speed: Slow)') ?>"}],t.fullsizeImage=function(u){let c='<div class="modal-body pointer" ng-click="$dismiss()"><img src="'+u+'" alt="" style="max-width:100%"></div>';l.open({template:c,windowTemplateUrl:"/views/basic/fullsizeImage.html?lang="+window.lang}).result.catch(function(f){})},t.fullsizeDialog=function(u){l.open({templateUrl:"/views/gsettings/"+u+"?lang="+window.lang,windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang}).result.catch(function(c){})};let h=function(){let u=l.open({templateUrl:"/views/gsettings/preview.1.dialog.php?lang="+window.lang,windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope",function(c){c.use=function(f){c.$close(f)},c.imgheight=function(){return $("#colorimg").height()}}]}).result;return u.catch(function(c){}),u};t.matColor=function(u){h().then(function(c){t.preview.colors[u]=c},function(){})},t.save=function(){let u=t.preview;u.shadow===0?(u.renderShadows=!0,u.raytraceReflections=!0,u.gcodeAntialiasFactor=3,u.renderModels=!0):u.shadow===1&&(u.renderShadows=!0,u.raytraceReflections=!0,u.gcodeAntialiasFactor=3,u.renderModels=!1,u.raytraceShadowSamples=10,u.raytraceReflectionSamples=10),u.raytraceAntialias=u.renderAntialiasFactor=u.gcodeAntialiasFactor,u.raytraceShadows=u.renderShadows,u.raytraceReflections=u.renderReflections,o.send("setRenderSettings",u).then(function(){r.success("<?php _('Preview image settings saved') ?>")})},t.reset=function(){o.send("resetRenderSettings",t.preview).then(function(u){t.preview=u,r.success("<?php _('Reset preview image settings') ?>")})},t.recompute=function(){o.send("updateAllRenderings",t.preview).then(function(){r.success("<?php _('Refreshing renderings started') ?>")})}}]);RSGSettingsModule.controller("ConnectivityController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","$interval","InputText","Info",function(t,e,i,r,n,o,a,l,h,u,c){t.connect={},t.externalAccess=angular.copy(e.serverSettings.externalAccess),r.send("getCommunicationSettings",{}).then(function(m){t.connect=m}),t.newServerName=function(){u.input(t.connect.servername,{headline:"<?php _('Change Server Name') ?>",inputText:"<?php _('New Name') ?>",regex:"^[a-zA-Z0-9][a-zA-Z0-9-]*$"}).then(function(m){r.send("newServerName",{name:m}).then(function(p){t.connect=p})},function(){})},t.newServerUUID=function(){e.serverSettings.backend_uuid.length>0?c("<?php _('Information') ?>","<?php _('You are associated to an online account with this UUID. You need to remove the cloud connection before changing your UUID.') ?>"):r.send("newServerUUID",{}).then(function(m){t.connect=m})},t.newAPIKey=function(){r.send("newAPIKey",{}).then(function(m){t.connect=m})},t.saveRemoteServer=function(){r.send("setRemoteServer",{remoteServer:t.connect.remoteServer}).then(function(m){t.connect=m,o.success("<?php _('Changes saved') ?>")})},t.remoteUp=function(m){t.connect.remoteServer.splice(m-1,0,t.connect.remoteServer.splice(m,1)[0]),t.saveRemoteServer()},t.remoteDown=function(m){t.connect.remoteServer.splice(m+1,0,t.connect.remoteServer.splice(m,1)[0]),t.saveRemoteServer()},t.newRemote=function(){t.connect.remoteServer.push({name:"",apikey:"",port:3344,ip:"",computations:!0,projects:!0}),t.editRemote(t.connect.remoteServer.length-1)},t.editRemote=function(m){a.open({backdrop:"static",templateUrl:"/views/gsettings/connectivity.remote.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(p){p.e=angular.copy(t.connect.remoteServer[m]),p.applyChanges=function(){p.$close(),t.connect.remoteServer.splice(m,1,p.e),t.saveRemoteServer()},p.delete=function(){l("<?php _('Confirmation required') ?>","<?php _('Really delete this remote server?') ?>",null,null,!0).then(function(){p.$close(),t.connect.remoteServer.splice(m,1),t.saveRemoteServer()},function(){})}}]}).result.catch(function(p){})},t.remoteStatus={};let f=function(){r.send("getCloudStatus",{}).then(function(m){t.remoteStatus={},angular.forEach(m.remoteServer,function(p){t.remoteStatus[p.ip+":"+p.port]=p,p.info="",p.reachable?p.apiKeyStatus<1?p.info="<?php _('Invalid API key') ?>":(p.info="<?php _('Available services') ?>:<ul>",angular.forEach(p.services,function(v){p.info+="<li>"+v.name+"</li>"}),p.info+="</ul>"):p.apiKeyStatus===-2?p.info="<?php _('Waiting for next query!') ?>":p.info="<?php _('Server is not reachable!') ?>"})})};t.findStatus=function(m){return t.remoteStatus[m.ip+":"+m.port]};let d=h(f,5e3);t.$on("$destroy",function(){h.cancel(d)}),t.saveDomain=function(){e.serverSettings.externalAccess=t.externalAccess,n.serverSettingsChanged().then(function(){o.success("<?php _('Domain settings saved') ?>","",2e3)},function(){})},f()}]);RSGSettingsModule.controller("TimelapseController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","$interval","User","$http",function(t,e,i,r,n,o,a,l,h,u,c){t.timelapse=angular.extend({ffmpeg:"",threads:1,includeWatermark:!0,watermarkPosition:0,minFreeStorage:500,firstFrameSec:1,lastFrameSec:1,delImageAfterConversion:!0},angular.copy(e.serverSettings.timelapse));let f=function(){t.watermarkImage="/timelapse/watermark/"+RSUtils.createAlphaID(8)};f(),t.threads=[{id:1,name:"<?php _('1 Thread') ?>"},{id:2,name:"<?php _('2 Threads') ?>"},{id:3,name:"<?php _('3 Threads') ?>"},{id:4,name:"<?php _('4 Threads') ?>"}],t.save=function(){e.serverSettings.timelapse=angular.copy(t.timelapse),n.serverSettingsChanged().then(function(){o.success("<?php _('Timelapse settings saved') ?>","",2e3)},function(){})};let d=function(){let p=$(this),v=p.val().replace(/\\/g,"/").replace(/.*\//,""),g=v.lastIndexOf("."),_="";if(g>0&&(_=v.substr(g+1)),_!=="png"){o.error("<?php _('Wrong file format') ?>");return}$("#quickUploadName").val(v),t.uploading=!0,r.extendPing(300),$("#formuploadquick").ajaxSubmit({success:function(x){console.log("finished",x),x.ok?o.success("<?php _('Upload finished') ?>"):o.error(x.msg),t.uploading=!1,r.extendPing(0),f(),t.$apply()},headers:{"X-Csrf-Token":r.getCookie("Csrf-Token")}}),v!==""&&p.val(""),t.$apply()},m=function(){let p=$("#quickFilenameUpload");p.length>0?p.on("change",d):setTimeout(m,100)};m(),t.deleteWatermark=function(){c.get("/timelapse/deleteWatermark").then(f,function(){})}}]);RSGSettingsModule.controller("FolderController",["$scope","$rootScope","RSGS","Flash","$filter","RSCom",function(t,e,i,r,n,o){t.folders=[],t.browsing=!1,t.browseFolder="",t.browseFiles=[],function(){o.send("getFolders",{}).then(function(h){t.folders=h.folders})}(),t.newFolder={name:"",dir:""};let l=function(){e.serverSettings.folders=angular.copy(t.folders),o.send("setFolders",{folders:t.folders}).then(function(){r.success("<?php _('Folders saved') ?>","",2e3)})};t.addFolder=function(){let h=1;angular.forEach(t.folders,function(u){u.id>=h&&(h=u.id+1)}),t.folders.push({id:h,name:t.newFolder.name,dir:t.newFolder.dir}),l()},t.onDragEnd=function(){l()},t.delFolder=function(h){h<0||h>=t.folders.length||(t.folders.splice(h,1),l())},t.browseTo=function(h,u){o.send("listFilesystemFolders",{root:h,next:u}).then(function(c){c.ok?(t.browseFiles=c.folders,t.browseFolder=c.root):(t.browseFiles=[],t.browseFolder="",t.browseTo("",""))})},t.selectDir=function(){t.browsing=!0,t.browseTo(t.newFolder.dir,"")},t.selectBrowse=function(){t.newFolder.dir=t.browseFolder,t.browsing=!1},t.abortBrowse=function(){t.browsing=!1}}]);RSGSettingsModule.controller("WebActionController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){let l=new RegExp("^https?:\\/\\/((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?))","i");t.edit=!1;let h=!1;t.editCall=function(c){t.edit=angular.copy(c),h=angular.copy(c)},t.addCall=function(){h=!1,t.edit={name:"",show_name:"",slug:"",method:"GET",post:"",url:"",icon:"",pos:-1,show_in_menu:!0,content_type:"application/json",question:""}},t.save=function(){h!==!1&&t.edit.name!==h.name?a.send("webCallRemove",{name:h.name}).then(function(){a.send("webCallSet",t.edit),t.edit=!1}):(a.send("webCallSet",t.edit),t.edit=!1)},t.remove=function(c){o("<?php _('Security question') ?>","<?php _('Really delete web action $1?') ?>".replace("$1",c.show_name)).then(function(){a.send("webCallRemove",{name:c.name})})},t.onMoveWebaction=function(c){t.webCalls.splice(c,1)},t.onDragEnd=function(){let c={};for(let f=0;f<e.webCalls.length;f++)e.webCalls[f].pos=f,c[e.webCalls[f].name]=f;a.send("webCallsReorder",{order:c})},t.up=function(c){let f=!1;angular.forEach(e.webCalls,function(d){if(d.name===c.name){let m={};m[d.name]=f.pos,m[f.name]=d.pos,a.send("webCallsReorder",{order:m})}f=d})},t.down=function(c){let f=!1;angular.forEach(e.webCalls,function(d){if(f&&f.name===c.name){let m={};m[d.name]=f.pos,m[f.name]=d.pos,a.send("webCallsReorder",{order:m})}f=d})},t.cancel=function(){t.edit=!1},t.runCall=function(c){c.question?o("<?php _('Security question') ?>",c.question).then(function(){a.send("webCallExecute",{name:c.name,params:["Test"]})}):a.send("webCallExecute",{name:c.name,params:["Test"]})},t.testSave=function(){let c=!0;return(!t.edit.name||t.edit.name.length===0)&&(c=!1),(!t.edit.show_name||t.edit.show_name.length===0)&&(c=!1),angular.forEach(e.webCalls,function(f){f.name===t.edit.name&&f.pos!==t.edit.pos&&(c=!1)}),(!t.edit.url||!l.test(t.edit.url))&&(c=!1),!c};function u(){let c=[{n:"<?php _('Global Function') ?>",s:""}];angular.forEach(e.printerList,function(f){c.push({n:f.name,s:f.slug})}),t.slugList=c}u()}]);RSGSettingsModule.controller("GPIOController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){let l=!1;t.operations=[{id:0,name:"<?php _('Run G-Code on change') ?>"},{id:1,name:"<?php _('Run external command on change') ?>"},{id:2,name:"<?php _('Run web action on change') ?>"},{id:3,name:"<?php _('Set output on/off') ?>"},{id:4,name:"<?php _('Set PWM output') ?>"}],t.edge=[{id:0,name:"<?php _('Rising') ?>"},{id:1,name:"<?php _('Falling') ?>"},{id:2,name:"<?php _('Both') ?>"}],t.bias=[{id:0,name:"<?php _('Default') ?>"},{id:1,name:"<?php _('Pull up') ?>"},{id:2,name:"<?php _('Pull down') ?>"},{id:2,name:"<?php _('Disable') ?>"}],t.drive=[{id:0,name:"<?php _('Default') ?>"},{id:1,name:"<?php _('Open Drain') ?>"},{id:2,name:"<?php _('Open Source') ?>"}],t.createData={operation:0,name:""},t.edit=!1;let h=!1;t.editCall=function(c){t.edit=angular.copy(c),h=angular.copy(c)},t.addGPIO=function(){l=!0,a.send("GPIOCreate",t.createData).then(function(){t.createData.name=""})},t.$on("gpioChanged",function(){e.gpio.length&&l&&(l=!1,t.editCall(e.gpio[e.gpio.length-1]))}),t.save=function(){a.send("GPIOUpdate",t.edit),t.edit=!1},t.remove=function(c){o("<?php _('Security question') ?>","<?php _('Really delete GPIO operation $1?') ?>".replace("$1",c.name)).then(function(){a.send("GPIODelete",{uuid:c.uuid})})},t.onDragEnd=function(){let c={};angular.forEach(e.gpio,function(f,d){c[f.uuid]=d}),a.send("GPIOReorder",{order:c})},t.up=function(c){let f=!1;angular.forEach(e.gpio,function(d){if(d.uuid===c.uuid){let m={};m[d.uuid]=f.pos,m[f.uuid]=d.pos,a.send("GPIOReorder",{order:m})}f=d})},t.down=function(c){let f=!1;angular.forEach(e.gpio,function(d){if(f&&f.uuid===c.uuid){let m={};m[d.uuid]=f.pos,m[f.uuid]=d.pos,a.send("GPIOReorder",{order:m})}f=d})},t.cancel=function(){t.edit=!1},t.testSave=function(){let c=!0;return(!t.edit.name||t.edit.name.length===0)&&(c=!1),!c};function u(){let c=[{n:"<?php _('Global Function') ?>",s:""}],f=[{n:"<?php _('Please select') ?>",s:""}];angular.forEach(e.printerList,function(d){c.push({n:d.name,s:d.slug}),f.push({n:d.name,s:d.slug})}),t.slugList=c,t.slugList2=f}u()}]);RSGSettingsModule.controller("ExternalLinksController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){t.editLinks=[],t.edit=!1;function l(){t.editLinks=[],angular.forEach(e.externalLinks,function(u){u.modifyable&&t.editLinks.push(JSON.parse(JSON.stringify(u)))})}l(),t.$on("int_externalLinksChanged",function(){l()}),t.edit=!1,t.permSettings={config:!1,print:!1},t.setConfigPermBitmapOptions=function(u){t.permSettings.config=(8&u)===8||u===0,t.permSettings.print=(1&u)===1||u===0},t.editLink=function(u){t.edit=u,t.setConfigPermBitmapOptions(u.configPerm),console.log(t.edit.configPerm)},t.addLink=function(){t.edit={href:"",title:"",icon:"",modifyable:!0,slug:"",openExternal:!0,touchscreen:!1,gui:!0,configPerm:0},t.setConfigPermBitmapOptions(0),t.editLinks.push(t.edit)},t.getConfigPermBitmap=function(){let u=0;return t.permSettings.config&&(u+=8),t.permSettings.print&&(u+=1),u},t.save=function(){t.testSave()&&(t.edit.configPerm=t.getConfigPermBitmap(),a.send("setExternalLinks",{list:t.editLinks}),t.edit=!1)},t.remove=function(u){o("<?php _('Security question') ?>","<?php _('Really delete external link $1?') ?>".replace("$1",u.title)).then(function(){let c=t.editLinks.indexOf(u);c!==-1&&t.editLinks.splice(c,1),t.save()})},t.onDragEnd=function(){t.save()},t.cancel=function(){t.edit=!1,l()},t.testSave=function(){let u=!0;return t.edit&&(!t.edit.title||t.edit.href.length===0)&&(u=!1),u},t.$on("int_externalLinksChanged",()=>{l()});function h(){let u=[{n:"<?php _('Global Function') ?>",s:""}],c=[{n:"<?php _('Please select') ?>",s:""}];angular.forEach(e.printerList,function(f){u.push({n:f.name,s:f.slug}),c.push({n:f.name,s:f.slug})}),t.slugList=u,t.slugList2=c}h()}]);RSGSettingsModule.controller("ExternalLinkPrinterController",["$scope","$rootScope","$stateParams","$interval","$sce",function(t,e,i,r,n){let o=parseInt(i.id);t.link={};function a(){if(t.link=e.externalLinks[o],t.link){let u=window.location.host.match(/(.*?)(:\d+)?$/)[1];t.linkFixed=t.link.href.replace("0.0.0.0",u),e.frontend.setPrinterTabNameByState("printer.externalLink",t.link.title),e.frontend.setPrinterTabIconByState("printer.externalLink",t.link.icon?t.link.icon:"fa fa-external-link rs-bigtab")}}t.$on("int_externalLinksChanged",a,o),t.trustSrc=function(u){return n.trustAsResourceUrl(u)},t.iframeHeight="200px";function l(){let u=$("#externalLinkFrame")[0];if(u){let c=u.getBoundingClientRect();t.iframeHeight=window.innerHeight-c.top-25+"px"}}a(),e.frontend.setVisible("externalLink",!0);let h=r(l,1e3);t.$on("$destroy",function(){e.frontend.setVisible("externalLink",!1),r.cancel(h)})}]);RSGSettingsModule.controller("TerminalCommandController",["$scope","$rootScope","Flash","$stateParams","RSCom","$interval","$sce","$timeout",function(t,e,i,r,n,o,a,l){let h=parseInt(r.id),u=-1;t.link={},t.channel="",t.terminalCallback={onLine:m=>{}};function c(){let m=e.externalCommands.filter(p=>p.id==h);if(m.length){if(t.link=m[0],t.link.id===u)return;u=t.link.id,e.frontend.setPrinterTabNameByState("printer.terminalCommand",t.link.name),e.frontend.setPrinterTabIconByState("printer.terminalCommand",t.link.icon?t.link.icon:"fa fa-terminal rs-bigtab"),n.send("runExternalCommand",{id:t.link.id}).then(p=>{p.terminal_id&&(t.channel=p.terminal_id)})}}t.trustSrc=function(m){return a.trustAsResourceUrl(m)},t.iframeHeight="200px";function f(){let m=$("#terminalCommand")[0];if(m){let p=m.getBoundingClientRect(),v=window.innerHeight-p.top-25+"px";v!==t.iframeHeight&&(t.iframeHeight=v,l(()=>{e.$broadcast("windowResized")},0))}}t.$on("int_externalLinksChanged",c),c(),e.frontend.setVisible("terminalCommand",!0);let d=o(f,1e3);t.$on("$destroy",function(){e.frontend.setVisible("terminalCommand",!1),o.cancel(d)})}]);var $de=/^$|^((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\/\d+$/,epe=/^$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/\d+$/,Ia=/^$|^((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])$/,DG=/^$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,IG=/^\d+$/;RSGSettingsModule.controller("WLANController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","Wifi","InputText",function(t,e,i,r,n,o,a,l,h,u){t.wlanstate={active:0,hideIgnored:!0},t.wifi=h,t.edit=!1,t.eth={ok:!1},t.passwordMethods=[{v:"none",n:'<?php _("No Encryption") ?>'},{v:"psk2",n:'<?php _("PSK2") ?>'},{v:"psk",n:'<?php _("PSK") ?>'}];let c=new Date;function f(d){return d=d.toFixed(0),d.length===1?"0"+d:d}t.settime={},t.settime.datetime=1+c.getMonth()+"/"+c.getDate()+"/"+c.getFullYear()+" "+c.getHours()+":"+f(c.getMinutes())+":"+f(c.getSeconds()),h.updateRouterList(),t.$on("connected",function(){h.updateRouterList()}),t.editHostname=function(){u.input(h.getHostname(),{headline:'<?php _("Change Hostname") ?>',inputText:'<?php _("New Hostname") ?>',regex:"^[a-zA-Z0-9][a-zA-Z0-9-]{0,63}$"}).then(function(d){d!==h.getHostname()&&h.setHostname(d)},function(){})},t.editSSID=function(){u.input(h.getAPSSID(),{headline:'<?php _("Change AP SSID") ?>',inputText:'<?php _("New SSID") ?>',regex:"^[a-zA-Z0-9:_-]{0,32}$"}).then(function(d){d!==h.getAPSSID()&&h.setAPSSID(d)},function(){})},t.editAPPassword=function(){u.input("",{headline:'<?php _("Change Password") ?>',inputText:'<?php _("New Password") ?>'}).then(function(d){h.setAPPassword(d)},function(){})},t.editChannel=function(){a.open({templateUrl:"/views/gsettings/wlan.channel.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeChannel=h.getAPChannel(),d.set=function(){d.activeChannel!==h.getAPChannel()&&h.setAPChannel(d.activeChannel),d.$close()}}]}).result.catch(function(d){})},t.editMode=function(){a.open({templateUrl:"/views/gsettings/wlan.mode.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeMode=h.getAPMode(),d.set=function(){d.activeMode!==h.getAPMode()&&h.setAPMode(d.activeMode),d.$close()}}]}).result.catch(function(d){})},t.editRegion=function(){a.open({templateUrl:"/views/gsettings/wlan.region.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeCountry=h.getRegion(),d.set=function(){d.activeMode!==h.getRegion()&&h.setRegion(d.activeCountry),d.$close()}}]}).result.catch(function(d){})},t.verifyWifiEdit=function(){let d=t.edit.data;t.err_wifi_ipv4Address=Ia.test(d.ipv4Address)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","192.168.1.89"),t.err_wifi_ipv4Nameserver=Ia.test(d.ipv4Nameserver)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","8.8.8.8"),t.err_wifi_ipv4Gateway=Ia.test(d.ipv4Gateway)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","192.168.1.1"),t.err_wifi_ipv4MaskBits=IG.test(d.ipv4MaskBits)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","24"),t.err_wifi_ipv6Address=Ia.test(d.ipv6Address)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","fe80::dea6:32ff:fe16:987"),t.err_wifi_ipv6Nameserver=Ia.test(d.ipv6Nameserver)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","2001:4860:4860::8888"),t.err_wifi_ipv6Gateway=Ia.test(d.ipv6Gateway)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","fe80::3a64:edfa:fe2d:32c4"),t.err_wifi_ipv6MaskBits=IG.test(d.ipv6MaskBits)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","64"),t.wifiValidated=!0,t.wifiHasErrors=(t.err_wifi_ipv4Address+t.err_wifi_ipv4Nameserver+t.err_wifi_ipv4Gateway+t.err_wifi_ipv4MaskBits+t.err_wifi_ipv6Address+t.err_wifi_ipv6Nameserver+t.err_wifi_ipv6Gateway+t.err_wifi_ipv6MaskBits).length!==0},t.editConnection=function(d){t.edit=Object.assign({},d),t.err_wifi_ipv4Address="",t.err_wifi_ipv4Nameserver="",t.err_wifi_ipv4Gateway="",t.err_wifi_ipv4MaskBits="",t.err_wifi_ipv6Address="",t.err_wifi_ipv6Nameserver="",t.err_wifi_ipv6Gateway="",t.err_wifi_ipv6MaskBits="",t.wifiValidated=!1,t.wlanstate.active=2},t.disableEdit=function(){t.edit=!1},t.updateConnection=function(){t.verifyWifiEdit(),t.wifiHasErrors?o.error('<?php _("Invalid values. Please fix them before saving.") ?>'):r.send("wifiSetSSIDData",t.edit.data).then(function(d){d.ok&&(t.edit.data=d.data,o.success('<?php _("New connection data stored.") ?>'))})},t.disconnect=function(){t.edit.data.active=!1,r.send("wifiSetSSIDData",t.edit.data),t.wlanstate.active=0,t.edit=!1},t.canConnect=function(){return!t.edit||!t.edit.data?!1:t.edit.data.passwordMethod==="none"?!0:t.edit.data.password.length>0},t.connect=function({SSID:d}){t.verifyWifiEdit(),t.wifiHasErrors?o.error('<?php _("Invalid values. Please fix them before saving.") ?>'):r.send("wifiSetSSIDData",t.edit.data).then(function(){t.edit=!1,t.wlanstate.active=0,h.connect(d).then(function(m){},function(){}),o.success("Connection request send")})},t.refresh=function(){h.refreshRouterList(),o.success('<?php _("Refresh wlan stations") ?>')},t.tzMode=0,t.editTimezone=function(){r.send("timezoneList",{}).then(function(d){t.tzList=d.list,t.tzList1=[];let m={};angular.forEach(d.list,function(p){let v=p.split("/")[0];m[v]||(m[v]=!0,t.tzList1.push(v))}),t.tzMode=1})},t.setDateTime=function(){r.send("setDateTime",{datetime:t.settime.datetime})},t.selectRegion=function(d){t.tzRegion=d,t.tzList2=[];let m=d+"/";angular.forEach(t.tzList,function(p){p.indexOf(m)===0&&t.tzList2.push(p.substr(m.length))}),t.tzList2.length?t.tzMode=2:t.setTimezone("")},t.setTimezone=function(d){d&&(t.tzRegion+="/"+d),r.send("timezoneSet",{timezone:t.tzRegion}).then(function(m){m.ok&&(h.routerListResponse.timezone=t.tzRegion,o.success('<?php _("New timezone set.") ?>')),t.tzMode=0})},t.verifyEth=function(){let d=h.routerListResponse.ethernet;t.err_eth_ipv4_addresses=$de.test(d.ipv4_addresses)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","192.168.1.89/24"),t.err_eth_ipv4_dns=Ia.test(d.ipv4_dns)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","8.8.8.8"),t.err_eth_ipv4_gateway=Ia.test(d.ipv4_gateway)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","192.168.1.1"),t.err_eth_ipv6_addresses=epe.test(d.ipv6_addresses)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","fe80::dea6:32ff:fe16:987/64"),t.err_eth_ipv6_dns=DG.test(d.ipv6_dns)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","2001:4860:4860::8888"),t.err_eth_ipv6_gateway=DG.test(d.ipv6_gateway)?"":"<?php _('Illegal syntax. Example: @') ?>".replace("@","fe80::3a64:edfa:fe2d:32c4"),t.hasEthErrors=(t.err_eth_ipv4_addresses+t.err_eth_ipv4_dns+t.err_eth_ipv4_gateway+t.err_eth_ipv6_addresses+t.err_eth_ipv6_dns+t.err_eth_ipv6_gateway).length!==0,t.ethValidated=!0},t.getEth=function(){t.err_eth_ipv4_addresses="",t.err_eth_ipv4_dns="",t.err_eth_ipv4_gateway="",t.err_eth_ipv6_addresses="",t.err_eth_ipv6_dns="",t.err_eth_ipv6_gateway=""},t.setEth=function(){t.verifyEth(),t.hasEthErrors?o.error('<?php _("Invalid values. Please fix them before saving.") ?>'):r.send("ethernetSet",h.routerListResponse.ethernet).then(function(){o.success('<?php _("New connection data stored.") ?>')})},t.getEth()}]);RSGSettingsModule.controller("MaintainerModeController",["$scope","$rootScope","RSGS","Flash","$filter","RSCom",function(t,e,i,r,n,o){t.changePassword={oldPassword:"",newPassword:""},t.password="",t.setPassword=function(){o.send("setMaintainerPassword",t.changePassword).then(function(a){a.ok?r.success("<?php _('Password changed') ?>","",2e3):r.error("Wrong old password!","",2e3)})},t.enableMaintainer=async function(){let a=await o.send("switchMaintainer",{enable:!0,password:t.password});t.password="",a.ok?setTimeout(()=>{e.$broadcast("connected")},500):r.error("<?php _('Wrong password!') ?>","",2e3)},t.disableMaintainer=function(){o.send("switchMaintainer",{enable:!1})}}]);RSBase.controller("WebserverController",["$scope","$rootScope","$http","RSCom","IPS","Flash",function(t,e,i,r,n){t.loaded=!1,t.edit={newDNS:"",newIP:""},t.ips=n,t.fetchWebserverState=function(){r.send("webserverGetHTTPSConfig",{}).then(function(o){t.webserverState=o.state,t.webserverData=o.data,t.loaded=!0})},t.dataChanged=function(){console.log("webserverSetHTTPSConfig",t.webserverData),r.send("webserverSetHTTPSConfig",t.webserverData).then(function(o){t.webserverState=o.state,t.webserverData=o.data,t.loaded=!0})},t.removeIp=function(o){console.log("removeIp",o),t.webserverData.ipList.splice(t.webserverData.ipList.indexOf(o),1),t.dataChanged()},t.removeDNS=function(o){console.log("removeDNS",o),t.webserverData.dnsList.splice(t.webserverData.dnsList.indexOf(o),1),t.dataChanged()},t.addDNS=function(){t.edit.newDNS!==""&&t.webserverData.dnsList.indexOf(t.edit.newDNS)===-1&&t.webserverData.dnsList.push(t.edit.newDNS),t.edit.newDNS="",t.dataChanged()},t.addIp=function(){t.edit.newIp!==""&&t.webserverData.ipList.indexOf(t.edit.newIp)===-1&&t.webserverData.ipList.push(t.edit.newIp),t.edit.newIp="",t.dataChanged()},t.addActiveIPs=function(){n.ipv4.forEach(function(o){t.webserverData.ipList.indexOf(o.ip)===-1&&t.webserverData.ipList.push(o.ip)}),n.ipv6.forEach(function(o){t.webserverData.ipList.indexOf(o.ip)===-1&&t.webserverData.ipList.push(o.ip)}),t.dataChanged()},t.generateCertificate=function(){t.dataChanged(),r.send("webserverCreateCert",{}).then(function(o){console.log("webserverGenerateCertificate",o),o.ok?Flash.success("<?php _('New certificate created') ?>"):Flash.error("<?php _('Error creating new certificate') ?>: "+o.error)})},t.deleteCert=function(){r.send("webserverDeleteCert",{}).then(function(o){console.log("webserverDeleteCert",o),o.ok?Flash.success("<?php _('Certificate deleted') ?>"):Flash.error("<?php _('Error deleting certificate') ?>: "+o.error)})},t.noFile=function(){return document.getElementById("keyFile").files.length===0||document.getElementById("certFile").files.length===0},t.certFile=function(){let o=document.getElementById("certFile").files;return o.length===0?"<?php _('Drag File Here') ?>":o[0].name},t.keyFile=function(){let o=document.getElementById("keyFile").files;return o.length===0?"<?php _('Drag File Here') ?>":o[0].name},t.uploadCert=function(){let o=new FormData;o.append("keyfile",document.getElementById("keyFile").files[0]),o.append("certfile",document.getElementById("certFile").files[0]),i.post("/global/webserver/uploadCerts",o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){t.dataChanged()})},e.$on("connected",function(){t.fetchWebserverState()}),e.$on("webserverSettingChanged",function(){t.fetchWebserverState()}),t.fetchWebserverState()}]);RSGSettingsModule.controller("CloudController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","Wifi","InputText",function(t,e,i,r,n,o,a,l,h,u){t.login={login:"",password:""},t.error=!1,t.createCloud=function(){console.log("create cloud"),r.send("globalCloudRegister",t.login).then(function(c){console.log("rcr",c),c.ok?t.error="":t.error=c.error})}}]);RSGSettingsModule.controller("GUIController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","User",function(t,e,i,r,n,o,a){e.$watchCollection("serverSettings.gui",function(){n.serverSettingsChanged()}),e.$watch("serverSettings.animatedLogin",function(){n.serverSettingsChanged()}),t.setLeftPrinterList=function(h){a.setSetting("leftPrinterList",h)};let l=function(){let h=e.serverSettings.frontSetting;h||(h={goWebInterface:!1,language:"en",listPerPage:10,listSort:0,listType:0,showEmergency:!0,showFullscreen:!1,unlockPin:"",lockOnScreensaver:!1,autopopupMessages:!1,showScrollbars:!0},e.serverSettings.frontSetting=h),t.lockScreen=h.lockOnScreensaver===void 0?!1:h.lockOnScreensaver,t.unlockPin=h.unlockPin===void 0||h.unlockPin===""?"":"######",h.autopopupMessages=h.autopopupMessages===void 0?!1:h.autopopupMessages,e.serverSettings.gui.printerNamePos=e.serverSettings.gui.printerNamePos===void 0?1:e.serverSettings.gui.printerNamePos,t.canSaveDisplay=!0,t.hideLeftSide=a.getSetting("leftPrinterList","0"),h.showScrollbars=h.showScrollbars===void 0?!0:h.showScrollbars};l(),t.saveDisplay=function(){t.canSaveDisplay&&(e.serverSettings.frontSetting.lockOnScreensaver=t.lockScreen,t.unlockPin!=="######"&&(e.serverSettings.frontSetting.unlockPin=t.unlockPin===""||!e.serverSettings.frontSetting.lockOnScreensaver?"":CryptoJS.SHA512(t.unlockPin).toString()),n.serverSettingsChanged(),o.success("<?php _('Settings Saved') ?>","",3e3,!0),l())},e.$watch("serverSettings.frontSetting",function(){l()}),t.$watch("unlockPin",function(){t.unlockPin==="#####"&&(t.unlockPin=""),t.canSaveDisplay=t.unlockPin==="######"||/^\d?\d?\d?\d?\d?\d?$/.test(t.unlockPin)})}]);RSGSettingsModule.controller("ReportsController",["$scope","$rootScope","RSGS","Flash","GSettings",function(t,e,i,r,n){t.report={Mode:e.serverSettings.reportMode,Webcam:e.serverSettings.reportWebcam,Costs:e.serverSettings.reportCosts,Message:e.serverSettings.reportMessage,Aborted:e.serverSettings.reportAborted},t.save=function(){e.serverSettings.reportMode=t.report.Mode,e.serverSettings.reportWebcam=t.report.Webcam,e.serverSettings.reportCosts=t.report.Costs,e.serverSettings.reportMessage=t.report.Message,e.serverSettings.reportAborted=t.report.Aborted,n.serverSettingsChanged().then(function(){r.success("<?php _('Print report settings saved') ?>","",2e3)},function(){})}}]);RSBase.controller("AboutController",["$scope","$rootScope","$http","$sce",function(t,e,i,r){t.licenseMap={MIT:'<p>The MIT License (MIT)</p><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p><p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p><p>THE SOFTWARE IS PROVIDED "AS IS" , WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>',"Apache-2.0":'<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:</p> <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">https://www.apache.org/licenses/LICENSE-2.0.html</a> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an AS IS  BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>'},t.thirdParty='<?php _("3rd party software used in @") ?>'.replace("@",'<?php _("PROJECT_NAME") ?>'),t.extraLicenses=[],i.get("/licenses.json").then(function(n){angular.forEach(n,function(o,a){t.extraLicenses.push({name:a,license:t.licenseMap[o.licenses],home:o.repository})})},function(){}),t.supporter=!1,i.get("/global/supporter").then(function(n){n.data.ok&&(t.supporter=r.trustAsHtml(n.data.supporter||""))},function(){})}]);(function(){let t={name:"<?php _('Wizards') ?>",icon:"fa fa-magic rs-bigtab",visible:"showWizard",state:"printer.wizards",feature:"show-wizards",prio:4990,requireOnline:!1,requireActive:!0},e={name:"<?php _('Offset Calibration') ?>",icon:"rs rs-extruder",visible:"showWizardMic",state:"printer.microscope",prio:4990,requireOnline:!1,requireActive:!0},i={name:"<?php _('Wizards') ?>",icon:"fa fa-magic",feature:"show-wizards",prio:4990,requireOnline:!1,requireActive:!0};window.RSWizardModule=angular.module("RSWizard",["ui.router","RSBase","RSPrinter"]).run(["$state","RSFrontend","$rootScope",function(r,n,o){i.exec=function(){r.go("printer.wizards",{slug:o.activeSlug})}}]).config(["$stateProvider","RSFrontendProvider",function(r,n){n.registerPrinterMenuEntry(i),n.registerPrinterTab(t),n.registerPrinterTab(e),n.setVisible("showWizard",!1),r.state("printer.wizards",{url:"/wizards",templateUrl:"/views/wizards/wizards.php?lang="+window.lang,controller:"WizardController"}).state("printer.microscope",{url:"/microscope",templateUrl:"/views/wizards/microscopeWizard.php?lang="+window.lang,controller:"MicroscopeWizardController"})}])})();RSWizardModule.controller("WizardController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout","RSPrinter","SelectWizards","KlipperDialog","$interval",function(t,e,i,r,n,o,a,l,h,u){e.frontend.setVisible("showWizard",!0);let c=u(a.updateVisibleWizards,5e3);a.setActivePage(e.activeSlug,{state:"printer.wizards",params:{slug:e.activeSlug}}),t.$on("$destroy",function(){u.cancel(c),e.frontend.setVisible("showWizard",!1)}),t.openManager=function(){l()},a.updateVisibleWizards()}]);RSWizardModule.controller("MicroscopeWizardController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout","$interval","User","RSPrinter","Confirm",function(t,e,i,r,n,o,a,l,h,u){let c=function(){if(t.refreshWebcamImage(),t.webcammode!==1){_=!1;return}o(c,1e3*e.activeConfig.webcams[t.activeCam].reloadInterval)},f=function(){if(e.activeConfig.webcams.length===0)return;let b=$("#webcamimage");if(b.length===0)return;let y=b.parent();if(t.setShowWebcam(!0),t.showWebcam===!1){y.css("height","auto");return}let S=b.width(),w=b.height(),M=0,C=y.width(),E=1,P,A;switch(e.activeConfig.webcams[t.activeCam].orientation){case 0:case 180:P=S,A=w;break;case 90:case 270:M=(S-w)/2,P=w,A=S;break}C<P&&(E=C/P);let R="scale("+E+") rotate("+e.activeConfig.webcams[t.activeCam].orientation+"deg)";b.css("-webkit-transform",R),b.css("-ms-transform",R),b.css("transform",R),b.css("margin-left",(C-S-2)/2+"px"),b.css("margin-top",(A*E-w)/2+"px"),E*A>0?y.height(E*A):y.css("height","auto"),$(".reccam").css("left",(C-S-2)/2+20+"px")},d=a(f,100),m="",p=function(){m.length>0&&(i.send("webcamCloseStream",{wcid:m}),m="")};t.step=1,i.send("sendEvent",{event:"wizardMicroscope",data:{step:1,printer:e.activeSlug}}),t.errorStepsKnown=!1,t.step2=function(){t.step=2,t.firstExtruder=e.active.state.activeExtruder,i.send("sendEvent",{event:"wizardMicroscope",data:{step:t.step,printer:e.activeSlug,firstExtruder:t.firstExtruder}})},t.step3=function(){t.step=3,t.x1=t.moveToXPos,t.y1=t.moveToYPos,t.z1=t.moveToZPos,i.send("sendEvent",{event:"wizardMicroscope",data:{step:t.step,printer:e.activeSlug}})},t.step4=function(){t.step=4,t.x2=t.moveToXPos,t.y2=t.moveToYPos,t.z2=t.moveToZPos,t.diffx=t.x1-t.x2,t.diffy=t.y1-t.y2,t.diffz=t.z1-t.z2,t.secondExtruder=e.active.state.activeExtruder,t.var1=!1,angular.forEach(h.eepromData,function(b){b.text==="Steps per mm"&&(t.errorStepsKnown=!0,t.errorXSteps=Math.round(b.value*t.diffx),t.errorYSteps=Math.round(b.value*t.diffy),t.errorZSteps=Math.round(b.value*t.diffz)),b.text.indexOf("X-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorXSteps=Math.round(b.value*t.diffx)),b.text.indexOf("Y-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorYSteps=Math.round(b.value*t.diffy)),b.text.indexOf("Z-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorZSteps=Math.round(b.value*t.diffz)),b.text.indexOf("Extr.1 X-offset [steps]")===0&&e.activeConfig.general.eepromType==="repetier"&&t.errorStepsKnown&&(t.var1=!0),b.text.indexOf("Tool 1 X Offset [mm]")===0&&e.activeConfig.general.eepromType==="repetier"&&(t.var1=!0)}),t.autoUpdate=t.var1,i.send("sendEvent",{event:"wizardMicroscope",data:{step:t.step,printer:e.activeSlug,diffX:t.diffx,diffY:t.diffy,diffZ:t.diffz,firstExtruder:t.firstExtruder,secondExtruder:t.secondExtruder}})},t.home=function(){u("<?php _('Home Printer') ?>","<?php _('Make sure no obstacles are in the way for homing! Start homing?') ?>").then(function(){h.sendGCode("@runButtonCommand homeAll")},function(){})},t.setEntryAutomatic=function(){if(t.var1){let b="Extr."+(t.secondExtruder+1)+" ",y="Tool "+(t.secondExtruder+1)+" ";angular.forEach(h.eepromData,function(S){S.text.indexOf(b+"X-offset [steps]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.errorXSteps)),S.text.indexOf(b+"Y-offset [steps]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.errorYSteps)),S.text.indexOf(b+"Z-offset [steps]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.errorZSteps)),S.text.indexOf(y+"X Offset [mm]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.diffx)),S.text.indexOf(y+"Y Offset [mm]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.diffy)),S.text.indexOf(y+"Z Offset [mm]")===0&&(S.value=""+Math.round(parseFloat(S.value)+t.diffz))}),h.saveEeprom(),t.autoUpdate=!1}},t.activeCam=0;let v=!1,g=!1;t.hasWebcam=t.activeConfig.webcams.length>0&&t.activeConfig.webcams[t.activeCam].method!==0,t.webcamUrl="/img/empty.png",t.showWebcam=!1,t.webcammode=0,t.$on("$destroy",function(){t.webcammode=0,t.webcamUrl="/img/empty.png",v!==!1&&$(v).attr("src","/img/empty.png"),a.cancel(d),g=!0,i.send("sendEvent",{event:"wizardMicroscope",data:{step:0,printer:e.activeSlug}})});let _=!1;t.setShowWebcam=function(b,y){(!t.hasWebcam||!e.update.free)&&(b=!1),!b&&t.printing===!1&&(b=!0),t.showWebcam!==b&&(t.showWebcam=b,b?(e.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,p(),m=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+e.activeSlug+"?cam="+t.activeCam+"&wcid="+m):(e.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,_||(c(),_=!0)):t.webcamUrl="/img/nowebcam.png":t.webcamUrl="/img/empty.png"),b||(t.webcamUrl="/img/empty.png"),y&&(y.preventDefault(),y.stopPropagation())},t.toggleWebcam=function(){e.activeConfig.webcams.length===1?t.setShowWebcam(!1,$event):(t.activeCam++,t.activeCam>=e.activeConfig.webcams.length&&(t.activeCam=0),(e.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,p(),m=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+e.activeSlug+"?cam="+t.activeCam+"&wcid="+m):(e.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,_||(c(),_=!0)):t.webcamUrl="/img/nowebcam.png",f())},t.refreshWebcamImage=function(){t.webcamUrl="/printer/camjpg/"+e.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10)};let x=function(){let b=$("#webcamimage");b.length===0?o(x,10):(v=b[0],t.printing||t.setShowWebcam(!0))};t.hasWebcam&&(x(),t.setShowWebcam(!0,void 0)),e.frontend.setVisible("showWizardMic",!0),t.$on("$destroy",function(){e.frontend.setVisible("showWizardMic",!1),p()}),h.readEEPROM()}]);RSUserModule.config(["$stateProvider",function(t){t.state("login",{url:"/login",templateUrl:"/views/user/login.php?lang="+window.lang,controller:"UserLoginController"}).state("userconfig",{url:"/userconfig",templateUrl:"/views/user/user.php?lang="+window.lang,controller:"UserConfigController"}).state("userprofile",{url:"/userprofile",templateUrl:"/views/user/editProfile.php?lang="+window.lang,controller:"UserProfileController",resolve:{P:["RSOverview",function(e){return e.printerListLoadedPromise}]}})}]).controller("UserLoginController",["$scope","$rootScope","RSCom","User","$location","$http","$state","$interval",function(t,e,i,r,n,o,a,l){if(r.isLoggedIn){a.go("home");return}let h;t.login="",t.password="",t.animatedLogin=!1,t.rememberMe=!1,e.loginerror=!1,h=l(r.recheckLogin,3e3),t.sendLogin=function(){o.post("/global/user/verify",{}).then(function(u){o.post("/global/user/login",{login:t.login,password:CryptoJS.SHA512(i.getCookie("Csrf-Token")+CryptoJS.MD5(t.login+t.password).toString()).toString(),rememberMe:t.rememberMe}).then(function(c){c=c.data,c.error?e.loginerror=c.error:(r.setCredentials(c),(typeof e.pathAfterLogin=="undefined"||e.pathAfterLogin==="/login")&&(e.pathAfterLogin="/"),n.path(e.pathAfterLogin),i.startConnection(),e.$broadcast("connected"),i.updateImportant())})})},window.scrollTo(0,0),setTimeout(function(){$("#login").focus()},1e3),r.recheckLogin(),t.$on("$destroy",()=>{h&&l.cancel(h)})}]).controller("UserConfigController",["$scope","$rootScope","RSCom","$state","Confirm","$uibModal","User","RSPasswordCheck",function(t,e,i,r,n,o,a,l){if(!a.manageAccountsPermission&&!a.adminPermission){r.go("home");return}t.userlist=!1;let h=function(){i.send("userlist",{}).then(function(u){t.userlist=u,u.loginRequired===!1&&a.getLogin()!=="global"&&a.logout()})};h(),t.createUser=function(){let u=t.userlist===!1||t.userlist.users.length===0&&a.adminPermission;o.open({backdrop:"static",templateUrl:"/views/user/createUserDialog.php?lang="+lang,controller:["$scope",function(c){c.error="",c.ro=u,c.roa=u,c.passwordError=!1,c.passwordError2=!1,c.loginError=!1,c.edituser={login:"",name:"",print:a.printPermission?1:0,readfiles:a.readPermission?1:0,addfiles:a.addPermission?1:0,deletefiles:a.delPermission?1:0,configure:a.changeConfigPermission?1:0,history:a.historyPermission?1:0,seeprojects:a.seeProjectsPermission?1:0,editprojects:a.editProjectsPermission?1:0,seeallprinters:1,fullStop:a.fullStopPermission?1:0,changePasswords:a.changePasswordPermission?1:0,manageAccounts:u?1:0,admin:u?1:0,password:"",password2:""},c.$watchCollection("edituser",function(f,d){d.admin===0&&f.admin===1?(c.ro=!0,c.roa=!1,f.print=1,f.readfiles=1,f.addfiles=1,f.deletefiles=1,f.configure=1,f.history=1,f.seeprojects=1,f.editprojects=1,f.seeallprinters=1,f.fullStop=1,f.manageAccounts=1):d.admin===1&&f.admin===0&&(c.ro=!1)}),c.checkValid=function(){c.edituser.editprojects&&!c.edituser.seeprojects&&(c.edituser.editprojects=0)},c.sendCreateUser=function(){c.error="";let f=0;if(c.edituser.print===1&&(f+=1),c.edituser.addfiles===1&&(f+=2),c.edituser.deletefiles===1&&(f+=4),c.edituser.configure===1&&(f+=8),c.edituser.history===1&&(f+=16),c.edituser.seeprojects===1&&(f+=32),c.edituser.editprojects===1&&(f+=64),c.edituser.seeallprinters===1&&(f+=128),c.edituser.readfiles===1&&(f+=256),c.edituser.fullStop===1&&(f+=512),c.edituser.manageAccounts===1&&(f+=1024),c.edituser.admin===1&&(f+=2048),c.edituser.changePasswords===1&&(f+=4096),c.passwordError=!1,c.passwordError2=!1,c.loginError=!1,c.edituser.login.length===0){c.loginError=!0;return}if(c.edituser.password.length===0){c.passwordError2=!0;return}if(c.edituser.password!==c.edituser.password2){c.passwordError=!0;return}let d=l(c.edituser.password);if(d){c.error=d;return}i.send("createUser",{login:c.edituser.login,name:c.edituser.name,password:CryptoJS.MD5(c.edituser.login+c.edituser.password).toString(),permissions:f}).then(function(m){m.success?(h(),c.$close()):c.error=m.error})}}]}).result.catch(function(c){})},t.editUser=function(u){o.open({backdrop:"static",templateUrl:"/views/user/editUserDialog.php?lang="+lang,controller:["$scope",function(c){c.error="",c.passwordError=!1,c.ro=u.login===a.getLogin()||u.permissions&2048,c.roa=u.login===a.getLogin(),c.edituser={apikey:u.apikey,login:u.login,name:u.name,print:u.permissions&1?1:0,addfiles:u.permissions&2?1:0,deletefiles:u.permissions&4?1:0,configure:u.permissions&8?1:0,history:u.permissions&16?1:0,seeprojects:u.permissions&32?1:0,editprojects:u.permissions&64?1:0,seeallprinters:u.permissions&128?1:0,readfiles:u.permissions&256?1:0,fullStop:u.permissions&512?1:0,manageAccounts:u.permissions&1024?1:0,admin:u.permissions&2048?1:0,changePasswords:u.permissions&4096?1:0,password:"",password2:""},c.$watchCollection("edituser",function(f,d){d.admin===0&&f.admin===1?(c.ro=!0,c.roa=!1,f.print=1,f.readfiles=1,f.addfiles=1,f.deletefiles=1,f.configure=1,f.history=1,f.seeprojects=1,f.editprojects=1,f.seeallprinters=1,f.fullStop=1,f.manageAccounts=1,f.changePasswords=1):d.admin===1&&f.admin===0&&(c.ro=!1)}),i.send("canDeleteUser",{login:u.login}).then(f=>{c.cdu=f}),c.sendEditUser=function(){c.error="";let f=0;if(c.edituser.print===1&&(f+=1),c.edituser.addfiles===1&&(f+=2),c.edituser.deletefiles===1&&(f+=4),c.edituser.configure===1&&(f+=8),c.edituser.history===1&&(f+=16),c.edituser.seeprojects===1&&(f+=32),c.edituser.editprojects===1&&(f+=64),c.edituser.seeallprinters===1&&(f+=128),c.edituser.readfiles===1&&(f+=256),c.edituser.fullStop===1&&(f+=512),c.edituser.manageAccounts===1&&(f+=1024),c.edituser.admin===1&&(f+=2048),c.edituser.changePasswords===1&&(f+=4096),c.edituser.password.length>0){let d=l(c.edituser.password);if(d){c.error=d;return}}c.passwordError=!1,i.send("updateUser",{login:c.edituser.login,name:c.edituser.name,password:c.edituser.password.length===0?"":CryptoJS.MD5(c.edituser.login+c.edituser.password).toString(),permissions:f}).then(function(d){d.ok?(h(),c.$close()):c.error=d.error})},c.checkValid=function(){c.edituser.editprojects&&!c.edituser.seeprojects&&(c.edituser.editprojects=0)},c.deleteUser=function(f){c.cdu.canDelete&&n('<?php _("Delete User") ?>','<?php _("Really delete this user?") ?>','<?php _("Yes, delete user") ?>','<?php _("No") ?>',!0).then(function(){c.cdu.managedUsers>0?n('<?php _("Delete User") ?>','<?php _("The user has @ managed users. Delete them as well?") ?>'.replace("@",c.cdu.managedUsers),'<?php _("Delete managed users") ?>','<?php _("Keep managed users") ?>',!0).then(()=>{console.log("del managed"),i.send("deleteUser",{login:f,deleteManaged:!0}).then(function(){h(),c.$close()})},()=>{console.log("keep managed"),i.send("deleteUser",{login:f,deleteManaged:!1}).then(function(){h(),c.$close()})}):i.send("deleteUser",{login:f,deleteManaged:!1}).then(function(){h(),c.$close()})})},c.renewApiKey=function(){i.send("newUserAPIKey",{login:u.login}).then(function(f){c.edituser.apikey=f.apikey})}}]}).result.catch(function(c){})}}]).controller("UserProfileController",["$scope","$rootScope","RSCom","$state","Confirm","RSPasswordCheck","Flash",function(t,e,i,r,n,o,a){if(!e.user.isRealUser){r.go("home");return}t.error="",t.errorPw="";let l=function(){i.send("userProfile",{}).then(function(h){t.passwordError=!1,t.u=h,t.edituser={login:h.login,name:h.name,print:h.permissions&1?1:0,addfiles:h.permissions&2?1:0,deletefiles:h.permissions&4?1:0,configure:h.permissions&8?1:0,history:h.permissions&16?1:0,seeprojects:h.permissions&32?1:0,editprojects:h.permissions&64?1:0,seeallprinters:h.permissions&128?1:0,readfiles:h.permissions&256?1:0,fullStop:h.permissions&512?1:0,manageAccounts:h.permissions&1024?1:0,changePasswords:h.permissions&4096?1:0,admin:h.permissions&2048?1:0,password:"",password2:"",oldPassword:""},i.send("canDeleteUser",{login:h.login}).then(u=>{t.cdu=u})})};l(),t.sendEditUser=function(){t.error="",t.errorPw="";let h=0;if(t.edituser.print===1&&(h+=1),t.edituser.addfiles===1&&(h+=2),t.edituser.deletefiles===1&&(h+=4),t.edituser.configure===1&&(h+=8),t.edituser.history===1&&(h+=16),t.edituser.seeprojects===1&&(h+=32),t.edituser.editprojects===1&&(h+=64),t.edituser.seeallprinters===1&&(h+=128),t.edituser.readfiles===1&&(h+=256),t.edituser.fullStop===1&&(h+=512),t.passwordError=!1,t.edituser.password.length>0){if(t.edituser.password!==t.edituser.password2){t.errorPw="<?php _('Password and repeated password do not match!') ?>";return}let u=o(t.edituser.password);if(u){t.errorPw=u;return}}i.send("updateUser",{login:t.edituser.login,name:t.edituser.name,password:t.edituser.password.length===0?"":CryptoJS.MD5(t.edituser.login+t.edituser.password).toString(),oldPassword:t.edituser.oldPassword.length===0?"":CryptoJS.MD5(t.edituser.login+t.edituser.oldPassword).toString(),permissions:h}).then(function(u){u.ok?(l(),t.edituser.password.length===0?a.success("<?php _('User name changed.') ?>"):a.success("<?php _('New password set.') ?>")):t.edituser.password.length===0?t.error=u.error:t.errorPw="<?php _('Old password is wrong!') ?>"})},t.deleteUser=function(h){t.cdu.canDelete&&n('<?php _("Delete User") ?>','<?php _("Really delete this user?") ?>','<?php _("Yes, delete user") ?>','<?php _("No") ?>',!0).then(function(){t.cdu.managedUsers>0?n('<?php _("Delete User") ?>','<?php _("The user has @ managed users. Delete them as well?") ?>'.replace("@",t.cdu.managedUsers),'<?php _("Delete managed users") ?>','<?php _("Keep managed users") ?>',!0).then(()=>{console.log("del managed"),i.send("deleteUser",{login:h,deleteManaged:!0})},()=>{console.log("keep managed"),i.send("deleteUser",{login:h,deleteManaged:!1})}):i.send("deleteUser",{login:h,deleteManaged:!1})})},t.renewApiKey=function(){i.send("newUserAPIKey",{login:t.u.login}).then(function(h){t.u.apikey=h.apikey})}}]);RSBase.factory("RSDropbox",["$rootScope","$timeout",function(t,e){let i={hasDropbox:!1};if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){$("body").append('<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="0ql2jlxr9mc57yn"><\/script>');let r=0,n=function(){i.hasDropbox=typeof window.Dropbox=="object",r++,r<50&&!i.hasDropbox&&e(n,200)};e(n,200)}return t.db=i,i}]);RSBase.factory("GoogleDrive",["$rootScope","$q",function(t,e){var i={},r="AIzaSyA4tBIY1Kmads1Zex7Qj6DkZrZND2-GBlY",n="769905759455-eug2a9066m1np11lfsh35s5kum78870v.apps.googleusercontent.com",o=["https://www.googleapis.com/auth/drive.readonly"],a=!1,l;function h(){gapi.load("auth",{callback:u}),gapi.load("picker",{callback:c})}function u(){console.log("onAuthApiLoad"),window.gapi.auth.authorize({client_id:n,scope:o,immediate:!1},f)}function c(){console.log("onPickerApiLoad"),a=!0,d()}function f(v){console.log("handleAuthResult",v),v&&!v.error&&(l=v.access_token,d())}function d(){if(console.log("createPicker"),a&&l){var v=new google.picker.PickerBuilder().addView(google.picker.ViewId.DOCS).setOAuthToken(l).setDeveloperKey(r).enableFeature("MULTISELECT_ENABLED").setCallback(p).build();v.setVisible(!0)}}var m=null;i.select=function(){return m=e.defer(),a==!1?h():d(),m.promise};function p(v){var g="nothing";if(v[google.picker.Response.ACTION]==google.picker.Action.PICKED){var _=v[google.picker.Response.DOCUMENTS][0];g=_[google.picker.Document.URL]}console.log(v),m.resolve(v)}return i}]);RSBase.factory("WaitSelectorAppear",["$rootScope",function(t){let e="",i={};return window.prg=i,$('<div id="progressWindow" style="display:none"><div class="modal-backdrop in" style="z-index:5000;"></div><div class="progressWin"><h1></h1><div class="progress" style="display:block"><div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" style="width: 0;"></div></div></div></div>').prependTo($("body")),i.show=function(n,o){i.setProgress(o),i.setTitle(n),$("#progressWindow").show()},i.hide=function(){$("#progressWindow").hide()},i.setProgress=function(n){typeof n=="undefined"&&(n=-1),n<0?$("#progressWindow .progress").hide():($("#progressWindow .progress").show(),$("#progressWindow .progress-bar").css("width",n+"%"))},i.setTitle=function(n){typeof n=="undefined"&&(n=""),$("#progressWindow h1").html(n)},i.bindToMsgId=function(n){e=n},t.$on("progressUpdate",function(n,o){o.data.msgId===e&&(o.data.finished&&i.hide(),i.setProgress(o.data.progress))}),t.$on("disconnected",function(){i.hide()}),i}]);RSBase.factory("InputText",["$uibModal",function(t){let e={};return e.input=function(i,r){let n={headline:"",okText:"<?php _('Ok') ?>",newString:i,inputText:"",regex:void 0};n=angular.extend(n,r),n.regex&&(n.regex=RegExp(n.regex));let o=t.open({backdrop:"static",templateUrl:"/views/services/inputString.modal.php?lang="+lang,size:"sm",controller:["$scope",function(a){a.data=n,a.isInvalid=function(){return n.regex?!n.regex.test(n.newString):!1},a.set=function(){a.isInvalid()||a.$close(a.data.newString)}}]}).result;return o.catch(function(a){}),o},e}]);RSBase.controller("PrivacyPolicyController",["$scope","$rootScope","$timeout","$http","RSCom","$state","User","RSOverview","RSMessages","RSRegistry","GSettings","RSFrontend","$uibModal","Flash",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){t.policy="Loading policy ...",t.accepted=e.serverSettings.policy_accepted,r.get("/privacypolicy/privacypolicy."+lang+".txt").then(function(p){t.policy=p.data}),t.accept=function(){e.serverSettings.policy_accepted=!0,c.serverSettingsChanged().then(function(){m.success("<?php _('Thank you for accepting the privacy policy') ?>","",5e3),o.go("home")})}}]);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

event-lite/event-lite.js:
  (**
   * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
   *
   * @copyright Yusuke Kawasaki
   * @license MIT
   * @constructor
   * @see https://github.com/kawanet/event-lite
   * @see http://kawanet.github.io/event-lite/EventLite.html
   * @example
   * var EventLite = require("event-lite");
   *
   * function MyClass() {...}             // your class
   *
   * EventLite.mixin(MyClass.prototype);  // import event methods
   *
   * var obj = new MyClass();
   * obj.on("foo", function() {...});     // add event listener
   * obj.once("bar", function() {...});   // add one-time event listener
   * obj.emit("foo");                     // dispatch event
   * obj.emit("bar");                     // dispatch another event
   * obj.off("foo");                      // remove event listener
   *)

object-assign/index.js:
  (*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *)

punycode/punycode.js:
  (*! https://mths.be/punycode v1.3.2 by @mathias *)

@pixi/polyfill/dist/esm/polyfill.mjs:
  (*!
   * @pixi/polyfill - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/polyfill is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/constants/dist/esm/constants.mjs:
  (*!
   * @pixi/constants - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/constants is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/settings/dist/esm/settings.mjs:
  (*!
   * @pixi/settings - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/settings is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/utils/dist/esm/utils.mjs:
  (*!
   * @pixi/utils - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/utils is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/math/dist/esm/math.mjs:
  (*!
   * @pixi/math - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/math is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/display/dist/esm/display.mjs:
  (*!
   * @pixi/display - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/display is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/extensions/dist/esm/extensions.mjs:
  (*!
   * @pixi/extensions - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/extensions is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/runner/dist/esm/runner.mjs:
  (*!
   * @pixi/runner - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/runner is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/ticker/dist/esm/ticker.mjs:
  (*!
   * @pixi/ticker - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/ticker is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/core/dist/esm/core.mjs:
  (*!
   * @pixi/core - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/core is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/accessibility/dist/esm/accessibility.mjs:
  (*!
   * @pixi/accessibility - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/accessibility is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/interaction/dist/esm/interaction.mjs:
  (*!
   * @pixi/interaction - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/interaction is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/extract/dist/esm/extract.mjs:
  (*!
   * @pixi/extract - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/extract is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/loaders/dist/esm/loaders.mjs:
  (*!
   * @pixi/loaders - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/loaders is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/compressed-textures/dist/esm/compressed-textures.mjs:
  (*!
   * @pixi/compressed-textures - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/compressed-textures is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/particle-container/dist/esm/particle-container.mjs:
  (*!
   * @pixi/particle-container - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/particle-container is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/graphics/dist/esm/graphics.mjs:
  (*!
   * @pixi/graphics - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/graphics is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/sprite/dist/esm/sprite.mjs:
  (*!
   * @pixi/sprite - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/sprite is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/text/dist/esm/text.mjs:
  (*!
   * @pixi/text - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/text is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/prepare/dist/esm/prepare.mjs:
  (*!
   * @pixi/prepare - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/prepare is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/spritesheet/dist/esm/spritesheet.mjs:
  (*!
   * @pixi/spritesheet - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/spritesheet is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/sprite-tiling/dist/esm/sprite-tiling.mjs:
  (*!
   * @pixi/sprite-tiling - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/sprite-tiling is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/mesh/dist/esm/mesh.mjs:
  (*!
   * @pixi/mesh - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/mesh is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/text-bitmap/dist/esm/text-bitmap.mjs:
  (*!
   * @pixi/text-bitmap - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/text-bitmap is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-alpha/dist/esm/filter-alpha.mjs:
  (*!
   * @pixi/filter-alpha - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-alpha is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-blur/dist/esm/filter-blur.mjs:
  (*!
   * @pixi/filter-blur - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-color-matrix/dist/esm/filter-color-matrix.mjs:
  (*!
   * @pixi/filter-color-matrix - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-color-matrix is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-displacement/dist/esm/filter-displacement.mjs:
  (*!
   * @pixi/filter-displacement - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-displacement is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-fxaa/dist/esm/filter-fxaa.mjs:
  (*!
   * @pixi/filter-fxaa - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-fxaa is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-noise/dist/esm/filter-noise.mjs:
  (*!
   * @pixi/filter-noise - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/filter-noise is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/mixin-cache-as-bitmap/dist/esm/mixin-cache-as-bitmap.mjs:
  (*!
   * @pixi/mixin-cache-as-bitmap - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mixin-get-child-by-name/dist/esm/mixin-get-child-by-name.mjs:
  (*!
   * @pixi/mixin-get-child-by-name - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/mixin-get-child-by-name is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mixin-get-global-position/dist/esm/mixin-get-global-position.mjs:
  (*!
   * @pixi/mixin-get-global-position - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/mixin-get-global-position is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/app/dist/esm/app.mjs:
  (*!
   * @pixi/app - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/app is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mesh-extras/dist/esm/mesh-extras.mjs:
  (*!
   * @pixi/mesh-extras - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/mesh-extras is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/sprite-animated/dist/esm/sprite-animated.mjs:
  (*!
   * @pixi/sprite-animated - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * @pixi/sprite-animated is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

pixi.js/dist/esm/pixi.mjs:
  (*!
   * pixi.js - v6.5.10
   * Compiled Thu, 06 Jul 2023 15:25:11 UTC
   *
   * pixi.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
*/
